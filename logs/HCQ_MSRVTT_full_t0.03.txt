Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 1072.1127078533173 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 50.208431243896484 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 366.5455513000488 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 60.80437231063843 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch0.pth ...
Done in 1.900s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch0.pth ...
Done in 3.262s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.0
 MSRVTT_full_val/t2v_metrics/R5: 1.2072434607645874
 MSRVTT_full_val/t2v_metrics/R10: 1.6096579476861168
 MSRVTT_full_val/t2v_metrics/R50: 8.450704225352112
 MSRVTT_full_val/t2v_metrics/MedR: 252.0
 MSRVTT_full_val/t2v_metrics/MeanR: 251.21730382293762
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_val/v2t_metrics/R1: 0.0
 MSRVTT_full_val/v2t_metrics/R5: 0.8048289738430584
 MSRVTT_full_val/v2t_metrics/R10: 2.0120724346076457
 MSRVTT_full_val/v2t_metrics/R50: 9.054325955734406
 MSRVTT_full_val/v2t_metrics/MedR: 243.0
 MSRVTT_full_val/v2t_metrics/MeanR: 247.7344064386318
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/t2v_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/t2v_metrics/R5: 0.20066889632107024
 MSRVTT_full_test/t2v_metrics/R10: 0.26755852842809363
 MSRVTT_full_test/t2v_metrics/R50: 1.705685618729097
 MSRVTT_full_test/t2v_metrics/MedR: 1515.0
 MSRVTT_full_test/t2v_metrics/MeanR: 1498.5565217391304
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.12154652794863813
 MSRVTT_full_test/v2t_metrics/R1: 0.06688963210702341
 MSRVTT_full_test/v2t_metrics/R5: 0.16722408026755853
 MSRVTT_full_test/v2t_metrics/R10: 0.3010033444816054
 MSRVTT_full_test/v2t_metrics/R50: 1.806020066889632
 MSRVTT_full_test/v2t_metrics/MedR: 1471.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1495.3264214046824
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.14987975740993859
 mnt_best       : 0.12154652794863813
 not_improved_count: 0
Train Epoch: 1 [1/250 128/32000 (0%)] Loss: 10.07163 (QuantReg: 22.44304) QuantErr: 22.44304 batch_time=36.88526 
Train Epoch: 1 [12/250 1536/32000 (5%)] Loss: 9.14985 (QuantReg: 22.58221) QuantErr: 22.58221 batch_time=0.51423 
Train Epoch: 1 [23/250 2944/32000 (9%)] Loss: 7.19915 (QuantReg: 22.68928) QuantErr: 22.68928 batch_time=0.55835 
Train Epoch: 1 [34/250 4352/32000 (14%)] Loss: 6.95077 (QuantReg: 22.65341) QuantErr: 22.65341 batch_time=0.51208 
Train Epoch: 1 [45/250 5760/32000 (18%)] Loss: 6.51322 (QuantReg: 22.56908) QuantErr: 22.56908 batch_time=0.51408 
Train Epoch: 1 [56/250 7168/32000 (22%)] Loss: 6.10260 (QuantReg: 22.60261) QuantErr: 22.60261 batch_time=0.86390 
Train Epoch: 1 [67/250 8576/32000 (27%)] Loss: 6.08555 (QuantReg: 22.56160) QuantErr: 22.56160 batch_time=0.51654 
Train Epoch: 1 [78/250 9984/32000 (31%)] Loss: 5.88390 (QuantReg: 22.52276) QuantErr: 22.52276 batch_time=0.51298 
Train Epoch: 1 [89/250 11392/32000 (36%)] Loss: 5.20239 (QuantReg: 22.54940) QuantErr: 22.54940 batch_time=0.51478 
Train Epoch: 1 [100/250 12800/32000 (40%)] Loss: 5.58778 (QuantReg: 22.57510) QuantErr: 22.57510 batch_time=0.51255 
Train Epoch: 1 [111/250 14208/32000 (44%)] Loss: 5.10567 (QuantReg: 22.61690) QuantErr: 22.61690 batch_time=0.51746 
Train Epoch: 1 [122/250 15616/32000 (49%)] Loss: 4.75096 (QuantReg: 22.64125) QuantErr: 22.64125 batch_time=0.51815 
Train Epoch: 1 [133/250 17024/32000 (53%)] Loss: 4.73739 (QuantReg: 22.60570) QuantErr: 22.60570 batch_time=0.55566 
Train Epoch: 1 [144/250 18432/32000 (58%)] Loss: 4.63561 (QuantReg: 22.61405) QuantErr: 22.61405 batch_time=0.70746 
Train Epoch: 1 [155/250 19840/32000 (62%)] Loss: 4.76398 (QuantReg: 22.57742) QuantErr: 22.57742 batch_time=0.51160 
Train Epoch: 1 [166/250 21248/32000 (66%)] Loss: 5.03232 (QuantReg: 22.60584) QuantErr: 22.60584 batch_time=0.53423 
Train Epoch: 1 [177/250 22656/32000 (71%)] Loss: 4.72348 (QuantReg: 22.60962) QuantErr: 22.60962 batch_time=0.52140 
Train Epoch: 1 [188/250 24064/32000 (75%)] Loss: 4.36171 (QuantReg: 22.63739) QuantErr: 22.63739 batch_time=0.53385 
Train Epoch: 1 [199/250 25472/32000 (80%)] Loss: 4.34856 (QuantReg: 22.66554) QuantErr: 22.66554 batch_time=0.51857 
Train Epoch: 1 [210/250 26880/32000 (84%)] Loss: 4.08942 (QuantReg: 22.61238) QuantErr: 22.61238 batch_time=0.53075 
Train Epoch: 1 [221/250 28288/32000 (88%)] Loss: 4.53708 (QuantReg: 22.65799) QuantErr: 22.65799 batch_time=0.51599 
Train Epoch: 1 [232/250 29696/32000 (93%)] Loss: 4.18667 (QuantReg: 22.66867) QuantErr: 22.66867 batch_time=1.99536 
Train Epoch: 1 [243/250 31104/32000 (97%)] Loss: 3.89483 (QuantReg: 22.63844) QuantErr: 22.63844 batch_time=0.52573 
Train Epoch: 1 codebook_update_time=1.83743
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch1.pth ...
Done in 4.152s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch1.pth ...
Done in 8.245s
 epoch          : 1
 loss           : 5.322831031799317
 quant_reg      : 22.60752113342285
 quant_err      : 22.60752113342285
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 250
 MSRVTT_full_val/t2v_metrics/R1: 18.91348088531187
 MSRVTT_full_val/t2v_metrics/R5: 51.50905432595574
 MSRVTT_full_val/t2v_metrics/R10: 65.79476861167002
 MSRVTT_full_val/t2v_metrics/R50: 95.57344064386318
 MSRVTT_full_val/t2v_metrics/MedR: 5.0
 MSRVTT_full_val/t2v_metrics/MeanR: 12.629778672032193
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 40.020465433364784
 MSRVTT_full_val/v2t_metrics/R1: 22.334004024144868
 MSRVTT_full_val/v2t_metrics/R5: 55.1307847082495
 MSRVTT_full_val/v2t_metrics/R10: 72.63581488933602
 MSRVTT_full_val/v2t_metrics/R50: 94.96981891348088
 MSRVTT_full_val/v2t_metrics/MedR: 5.0
 MSRVTT_full_val/v2t_metrics/MeanR: 11.645875251509054
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 44.720212557156664
 MSRVTT_full_test/t2v_metrics/R1: 6.120401337792642
 MSRVTT_full_test/t2v_metrics/R5: 20.434782608695652
 MSRVTT_full_test/t2v_metrics/R10: 31.77257525083612
 MSRVTT_full_test/t2v_metrics/R50: 65.91973244147157
 MSRVTT_full_test/t2v_metrics/MedR: 24.0
 MSRVTT_full_test/t2v_metrics/MeanR: 68.62976588628763
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 15.839231758877157
 MSRVTT_full_test/v2t_metrics/R1: 5.351170568561873
 MSRVTT_full_test/v2t_metrics/R5: 22.073578595317727
 MSRVTT_full_test/v2t_metrics/R10: 34.88294314381271
 MSRVTT_full_test/v2t_metrics/R50: 70.90301003344482
 MSRVTT_full_test/v2t_metrics/MedR: 20.0
 MSRVTT_full_test/v2t_metrics/MeanR: 63.51270903010033
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 16.0316499149504
 mnt_best       : 15.839231758877157
 not_improved_count: 0
Train Epoch: 2 [1/250 128/32000 (0%)] Loss: 3.37613 (QuantReg: 9.21660) QuantErr: 9.21660 batch_time=37.14332 
Train Epoch: 2 [12/250 1536/32000 (5%)] Loss: 3.89424 (QuantReg: 9.48522) QuantErr: 9.48522 batch_time=0.53044 
Train Epoch: 2 [23/250 2944/32000 (9%)] Loss: 3.88970 (QuantReg: 9.46349) QuantErr: 9.46349 batch_time=0.86264 
Train Epoch: 2 [34/250 4352/32000 (14%)] Loss: 3.71609 (QuantReg: 9.71268) QuantErr: 9.71268 batch_time=0.50104 
Train Epoch: 2 [45/250 5760/32000 (18%)] Loss: 3.64000 (QuantReg: 10.04311) QuantErr: 10.04311 batch_time=0.51790 
Train Epoch: 2 [56/250 7168/32000 (22%)] Loss: 3.68747 (QuantReg: 9.95534) QuantErr: 9.95534 batch_time=0.51569 
Train Epoch: 2 [67/250 8576/32000 (27%)] Loss: 3.90090 (QuantReg: 10.17908) QuantErr: 10.17908 batch_time=7.04421 
Train Epoch: 2 [78/250 9984/32000 (31%)] Loss: 3.43839 (QuantReg: 10.55268) QuantErr: 10.55268 batch_time=0.52234 
Train Epoch: 2 [89/250 11392/32000 (36%)] Loss: 4.05509 (QuantReg: 10.58119) QuantErr: 10.58119 batch_time=0.51599 
Train Epoch: 2 [100/250 12800/32000 (40%)] Loss: 3.39653 (QuantReg: 10.87788) QuantErr: 10.87788 batch_time=0.51841 
Train Epoch: 2 [111/250 14208/32000 (44%)] Loss: 3.46991 (QuantReg: 10.81184) QuantErr: 10.81184 batch_time=0.50610 
Train Epoch: 2 [122/250 15616/32000 (49%)] Loss: 3.20299 (QuantReg: 11.34046) QuantErr: 11.34046 batch_time=0.55514 
Train Epoch: 2 [133/250 17024/32000 (53%)] Loss: 3.15164 (QuantReg: 11.01907) QuantErr: 11.01907 batch_time=0.51325 
Train Epoch: 2 [144/250 18432/32000 (58%)] Loss: 3.39487 (QuantReg: 11.49088) QuantErr: 11.49088 batch_time=0.50762 
Train Epoch: 2 [155/250 19840/32000 (62%)] Loss: 3.24435 (QuantReg: 11.44485) QuantErr: 11.44485 batch_time=0.51529 
Train Epoch: 2 [166/250 21248/32000 (66%)] Loss: 3.13060 (QuantReg: 12.09984) QuantErr: 12.09984 batch_time=0.54018 
Train Epoch: 2 [177/250 22656/32000 (71%)] Loss: 3.38170 (QuantReg: 12.00167) QuantErr: 12.00167 batch_time=0.50626 
Train Epoch: 2 [188/250 24064/32000 (75%)] Loss: 3.45304 (QuantReg: 11.91750) QuantErr: 11.91750 batch_time=0.51094 
Train Epoch: 2 [199/250 25472/32000 (80%)] Loss: 3.06302 (QuantReg: 11.84294) QuantErr: 11.84294 batch_time=0.51343 
Train Epoch: 2 [210/250 26880/32000 (84%)] Loss: 2.93531 (QuantReg: 12.10814) QuantErr: 12.10814 batch_time=0.53597 
Train Epoch: 2 [221/250 28288/32000 (88%)] Loss: 2.65595 (QuantReg: 12.59027) QuantErr: 12.59027 batch_time=0.51031 
Train Epoch: 2 [232/250 29696/32000 (93%)] Loss: 3.84863 (QuantReg: 12.53828) QuantErr: 12.53828 batch_time=0.51763 
Train Epoch: 2 [243/250 31104/32000 (97%)] Loss: 3.35970 (QuantReg: 12.73001) QuantErr: 12.73001 batch_time=0.85995 
Train Epoch: 2 codebook_update_time=1.77051
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch2.pth ...
Done in 4.107s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch2.pth ...
Done in 8.567s
removing stale ckpt [epoch 1] [took 0.00s]
removing stale ckpt [epoch 0] [took 0.00s]
 epoch          : 2
 loss           : 3.4692099075317384
 quant_reg      : 11.069162174224854
 quant_err      : 11.069162174224854
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 21.730382293762574
 MSRVTT_full_val/t2v_metrics/R5: 60.160965794768615
 MSRVTT_full_val/t2v_metrics/R10: 75.0503018108652
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.263581488933601
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 46.1223616140089
 MSRVTT_full_val/v2t_metrics/R1: 27.766599597585515
 MSRVTT_full_val/v2t_metrics/R5: 66.80080482897384
 MSRVTT_full_val/v2t_metrics/R10: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 9.195171026156942
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 52.87061918640973
 MSRVTT_full_test/t2v_metrics/R1: 8.22742474916388
 MSRVTT_full_test/t2v_metrics/R5: 25.183946488294314
 MSRVTT_full_test/t2v_metrics/R10: 38.12709030100334
 MSRVTT_full_test/t2v_metrics/R50: 72.5752508361204
 MSRVTT_full_test/t2v_metrics/MedR: 18.0
 MSRVTT_full_test/t2v_metrics/MeanR: 57.90133779264214
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 19.9162295504241
 MSRVTT_full_test/v2t_metrics/R1: 9.297658862876254
 MSRVTT_full_test/v2t_metrics/R5: 29.130434782608695
 MSRVTT_full_test/v2t_metrics/R10: 43.41137123745819
 MSRVTT_full_test/v2t_metrics/R50: 78.19397993311037
 MSRVTT_full_test/v2t_metrics/MedR: 14.0
 MSRVTT_full_test/v2t_metrics/MeanR: 47.21638795986622
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 22.739174413894624
 mnt_best       : 19.9162295504241
 not_improved_count: 0
Train Epoch: 3 [1/250 128/32000 (0%)] Loss: 2.86868 (QuantReg: 10.13303) QuantErr: 10.13303 batch_time=46.18404 
Train Epoch: 3 [12/250 1536/32000 (5%)] Loss: 3.04221 (QuantReg: 10.43336) QuantErr: 10.43336 batch_time=0.50498 
Train Epoch: 3 [23/250 2944/32000 (9%)] Loss: 3.49498 (QuantReg: 11.00048) QuantErr: 11.00048 batch_time=0.51886 
Train Epoch: 3 [34/250 4352/32000 (14%)] Loss: 2.54167 (QuantReg: 10.58392) QuantErr: 10.58392 batch_time=0.52454 
Train Epoch: 3 [45/250 5760/32000 (18%)] Loss: 3.21632 (QuantReg: 10.59972) QuantErr: 10.59972 batch_time=0.52256 
Train Epoch: 3 [56/250 7168/32000 (22%)] Loss: 2.55063 (QuantReg: 10.78984) QuantErr: 10.78984 batch_time=0.63004 
Train Epoch: 3 [67/250 8576/32000 (27%)] Loss: 2.74329 (QuantReg: 10.97769) QuantErr: 10.97769 batch_time=1.12899 
Train Epoch: 3 [78/250 9984/32000 (31%)] Loss: 3.01732 (QuantReg: 11.15390) QuantErr: 11.15390 batch_time=0.50723 
Train Epoch: 3 [89/250 11392/32000 (36%)] Loss: 3.05169 (QuantReg: 11.24109) QuantErr: 11.24109 batch_time=0.51274 
Train Epoch: 3 [100/250 12800/32000 (40%)] Loss: 2.64742 (QuantReg: 10.80637) QuantErr: 10.80637 batch_time=0.51305 
Train Epoch: 3 [111/250 14208/32000 (44%)] Loss: 2.90437 (QuantReg: 10.91076) QuantErr: 10.91076 batch_time=0.50699 
Train Epoch: 3 [122/250 15616/32000 (49%)] Loss: 2.46468 (QuantReg: 11.28045) QuantErr: 11.28045 batch_time=0.51856 
Train Epoch: 3 [133/250 17024/32000 (53%)] Loss: 2.98496 (QuantReg: 11.45219) QuantErr: 11.45219 batch_time=0.52044 
Train Epoch: 3 [144/250 18432/32000 (58%)] Loss: 2.73101 (QuantReg: 11.75332) QuantErr: 11.75332 batch_time=0.51282 
Train Epoch: 3 [155/250 19840/32000 (62%)] Loss: 3.56095 (QuantReg: 11.12946) QuantErr: 11.12946 batch_time=0.52203 
Train Epoch: 3 [166/250 21248/32000 (66%)] Loss: 2.20741 (QuantReg: 12.26190) QuantErr: 12.26190 batch_time=0.52147 
Train Epoch: 3 [177/250 22656/32000 (71%)] Loss: 2.43232 (QuantReg: 11.77834) QuantErr: 11.77834 batch_time=0.50901 
Train Epoch: 3 [188/250 24064/32000 (75%)] Loss: 3.10274 (QuantReg: 11.67128) QuantErr: 11.67128 batch_time=0.64323 
Train Epoch: 3 [199/250 25472/32000 (80%)] Loss: 2.52749 (QuantReg: 11.38377) QuantErr: 11.38377 batch_time=0.50866 
Train Epoch: 3 [210/250 26880/32000 (84%)] Loss: 2.80325 (QuantReg: 12.06316) QuantErr: 12.06316 batch_time=0.50648 
Train Epoch: 3 [221/250 28288/32000 (88%)] Loss: 2.48682 (QuantReg: 12.17610) QuantErr: 12.17610 batch_time=0.59237 
Train Epoch: 3 [232/250 29696/32000 (93%)] Loss: 2.28751 (QuantReg: 12.50578) QuantErr: 12.50578 batch_time=0.51313 
Train Epoch: 3 [243/250 31104/32000 (97%)] Loss: 2.57791 (QuantReg: 12.23411) QuantErr: 12.23411 batch_time=0.50834 
Train Epoch: 3 codebook_update_time=1.80932
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch3.pth ...
Done in 4.212s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch3.pth ...
Done in 8.730s
removing stale ckpt [epoch 2] [took 0.01s]
 epoch          : 3
 loss           : 2.839450550079346
 quant_reg      : 11.386959846496582
 quant_err      : 11.386959846496582
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 750
 MSRVTT_full_val/t2v_metrics/R1: 26.358148893360163
 MSRVTT_full_val/t2v_metrics/R5: 61.77062374245473
 MSRVTT_full_val/t2v_metrics/R10: 76.45875251509054
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.941649899396378
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 49.9315100665697
 MSRVTT_full_val/v2t_metrics/R1: 28.772635814889338
 MSRVTT_full_val/v2t_metrics/R5: 67.40442655935614
 MSRVTT_full_val/v2t_metrics/R10: 81.69014084507042
 MSRVTT_full_val/v2t_metrics/R50: 96.98189134808852
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.885311871227364
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 54.11021222699967
 MSRVTT_full_test/t2v_metrics/R1: 8.22742474916388
 MSRVTT_full_test/t2v_metrics/R5: 27.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 40.36789297658863
 MSRVTT_full_test/t2v_metrics/R50: 74.84949832775919
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 52.866889632107025
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 20.909463150973767
 MSRVTT_full_test/v2t_metrics/R1: 10.066889632107024
 MSRVTT_full_test/v2t_metrics/R5: 30.13377926421405
 MSRVTT_full_test/v2t_metrics/R10: 44.91638795986622
 MSRVTT_full_test/v2t_metrics/R50: 78.8628762541806
 MSRVTT_full_test/v2t_metrics/MedR: 13.0
 MSRVTT_full_test/v2t_metrics/MeanR: 46.751505016722405
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 23.884596642799266
 mnt_best       : 20.909463150973767
 not_improved_count: 0
Train Epoch: 4 [1/250 128/32000 (0%)] Loss: 3.05658 (QuantReg: 10.71497) QuantErr: 10.71497 batch_time=38.55935 
Train Epoch: 4 [12/250 1536/32000 (5%)] Loss: 2.63842 (QuantReg: 10.91070) QuantErr: 10.91070 batch_time=0.51291 
Train Epoch: 4 [23/250 2944/32000 (9%)] Loss: 2.02187 (QuantReg: 11.15519) QuantErr: 11.15519 batch_time=0.49759 
Train Epoch: 4 [34/250 4352/32000 (14%)] Loss: 2.29530 (QuantReg: 11.07648) QuantErr: 11.07648 batch_time=0.49855 
Train Epoch: 4 [45/250 5760/32000 (18%)] Loss: 2.61993 (QuantReg: 11.06623) QuantErr: 11.06623 batch_time=0.51269 
Train Epoch: 4 [56/250 7168/32000 (22%)] Loss: 2.89794 (QuantReg: 11.05982) QuantErr: 11.05982 batch_time=0.50358 
Train Epoch: 4 [67/250 8576/32000 (27%)] Loss: 2.90399 (QuantReg: 11.34473) QuantErr: 11.34473 batch_time=3.21297 
Train Epoch: 4 [78/250 9984/32000 (31%)] Loss: 2.75123 (QuantReg: 11.57728) QuantErr: 11.57728 batch_time=0.55654 
Train Epoch: 4 [89/250 11392/32000 (36%)] Loss: 2.52306 (QuantReg: 11.43376) QuantErr: 11.43376 batch_time=0.50019 
Train Epoch: 4 [100/250 12800/32000 (40%)] Loss: 2.42666 (QuantReg: 11.59499) QuantErr: 11.59499 batch_time=0.50455 
Train Epoch: 4 [111/250 14208/32000 (44%)] Loss: 2.69995 (QuantReg: 11.95218) QuantErr: 11.95218 batch_time=0.50754 
Train Epoch: 4 [122/250 15616/32000 (49%)] Loss: 2.66752 (QuantReg: 11.64118) QuantErr: 11.64118 batch_time=0.51486 
Train Epoch: 4 [133/250 17024/32000 (53%)] Loss: 2.40668 (QuantReg: 11.73919) QuantErr: 11.73919 batch_time=0.50509 
Train Epoch: 4 [144/250 18432/32000 (58%)] Loss: 2.57764 (QuantReg: 12.02380) QuantErr: 12.02380 batch_time=0.49960 
Train Epoch: 4 [155/250 19840/32000 (62%)] Loss: 2.80421 (QuantReg: 12.09879) QuantErr: 12.09879 batch_time=0.51952 
Train Epoch: 4 [166/250 21248/32000 (66%)] Loss: 2.84282 (QuantReg: 12.13315) QuantErr: 12.13315 batch_time=0.53699 
Train Epoch: 4 [177/250 22656/32000 (71%)] Loss: 2.89860 (QuantReg: 12.01942) QuantErr: 12.01942 batch_time=0.51599 
Train Epoch: 4 [188/250 24064/32000 (75%)] Loss: 2.60206 (QuantReg: 12.30133) QuantErr: 12.30133 batch_time=0.54410 
Train Epoch: 4 [199/250 25472/32000 (80%)] Loss: 2.65087 (QuantReg: 12.09037) QuantErr: 12.09037 batch_time=0.50307 
Train Epoch: 4 [210/250 26880/32000 (84%)] Loss: 2.30069 (QuantReg: 12.19093) QuantErr: 12.19093 batch_time=0.50533 
Train Epoch: 4 [221/250 28288/32000 (88%)] Loss: 2.30599 (QuantReg: 12.41026) QuantErr: 12.41026 batch_time=0.52402 
Train Epoch: 4 [232/250 29696/32000 (93%)] Loss: 2.50746 (QuantReg: 11.81514) QuantErr: 11.81514 batch_time=0.54827 
Train Epoch: 4 [243/250 31104/32000 (97%)] Loss: 2.31071 (QuantReg: 12.11436) QuantErr: 12.11436 batch_time=0.50537 
Train Epoch: 4 codebook_update_time=1.68333
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch4.pth ...
Done in 4.938s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch4.pth ...
Done in 9.483s
removing stale ckpt [epoch 3] [took 0.09s]
 epoch          : 4
 loss           : 2.530116229534149
 quant_reg      : 11.727557594299316
 quant_err      : 11.727557594299316
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 26.156941649899398
 MSRVTT_full_val/t2v_metrics/R5: 60.76458752515091
 MSRVTT_full_val/t2v_metrics/R10: 75.25150905432595
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.03420523138833
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 49.27019076152064
 MSRVTT_full_val/v2t_metrics/R1: 29.979879275653925
 MSRVTT_full_val/v2t_metrics/R5: 69.01408450704226
 MSRVTT_full_val/v2t_metrics/R10: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R50: 97.1830985915493
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.271629778672033
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 54.97029141612748
 MSRVTT_full_test/t2v_metrics/R1: 9.130434782608695
 MSRVTT_full_test/t2v_metrics/R5: 27.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 40.668896321070235
 MSRVTT_full_test/t2v_metrics/R50: 73.91304347826087
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 55.166220735785956
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 21.710506534655792
 MSRVTT_full_test/v2t_metrics/R1: 10.200668896321071
 MSRVTT_full_test/v2t_metrics/R5: 32.04013377926422
 MSRVTT_full_test/v2t_metrics/R10: 45.919732441471574
 MSRVTT_full_test/v2t_metrics/R50: 80.16722408026756
 MSRVTT_full_test/v2t_metrics/MedR: 12.0
 MSRVTT_full_test/v2t_metrics/MeanR: 43.69498327759197
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 24.666494868438544
 mnt_best       : 21.710506534655792
 not_improved_count: 0
Train Epoch: 5 [1/250 128/32000 (0%)] Loss: 2.53039 (QuantReg: 11.60401) QuantErr: 11.60401 batch_time=39.48403 
Train Epoch: 5 [12/250 1536/32000 (5%)] Loss: 2.66982 (QuantReg: 11.51499) QuantErr: 11.51499 batch_time=0.50382 
Train Epoch: 5 [23/250 2944/32000 (9%)] Loss: 2.68353 (QuantReg: 11.57970) QuantErr: 11.57970 batch_time=0.52426 
Train Epoch: 5 [34/250 4352/32000 (14%)] Loss: 1.97732 (QuantReg: 12.12161) QuantErr: 12.12161 batch_time=0.63261 
Train Epoch: 5 [45/250 5760/32000 (18%)] Loss: 2.19710 (QuantReg: 11.53810) QuantErr: 11.53810 batch_time=0.49688 
Train Epoch: 5 [56/250 7168/32000 (22%)] Loss: 2.33807 (QuantReg: 12.56094) QuantErr: 12.56094 batch_time=0.56133 
Train Epoch: 5 [67/250 8576/32000 (27%)] Loss: 2.24588 (QuantReg: 11.81902) QuantErr: 11.81902 batch_time=0.50529 
Train Epoch: 5 [78/250 9984/32000 (31%)] Loss: 2.45381 (QuantReg: 11.89145) QuantErr: 11.89145 batch_time=0.51985 
Train Epoch: 5 [89/250 11392/32000 (36%)] Loss: 2.06593 (QuantReg: 12.07801) QuantErr: 12.07801 batch_time=0.51006 
Train Epoch: 5 [100/250 12800/32000 (40%)] Loss: 2.49321 (QuantReg: 12.17547) QuantErr: 12.17547 batch_time=0.51864 
Train Epoch: 5 [111/250 14208/32000 (44%)] Loss: 2.19582 (QuantReg: 12.37942) QuantErr: 12.37942 batch_time=1.36397 
Train Epoch: 5 [122/250 15616/32000 (49%)] Loss: 2.19402 (QuantReg: 12.48748) QuantErr: 12.48748 batch_time=0.49952 
Train Epoch: 5 [133/250 17024/32000 (53%)] Loss: 2.48398 (QuantReg: 12.49574) QuantErr: 12.49574 batch_time=1.74359 
Train Epoch: 5 [144/250 18432/32000 (58%)] Loss: 1.64503 (QuantReg: 12.55041) QuantErr: 12.55041 batch_time=0.52035 
Train Epoch: 5 [155/250 19840/32000 (62%)] Loss: 2.18599 (QuantReg: 12.68144) QuantErr: 12.68144 batch_time=0.54054 
Train Epoch: 5 [166/250 21248/32000 (66%)] Loss: 2.19244 (QuantReg: 12.58201) QuantErr: 12.58201 batch_time=0.54983 
Train Epoch: 5 [177/250 22656/32000 (71%)] Loss: 2.01512 (QuantReg: 12.90346) QuantErr: 12.90346 batch_time=0.50612 
Train Epoch: 5 [188/250 24064/32000 (75%)] Loss: 2.45513 (QuantReg: 12.39349) QuantErr: 12.39349 batch_time=0.50819 
Train Epoch: 5 [199/250 25472/32000 (80%)] Loss: 2.11731 (QuantReg: 12.57325) QuantErr: 12.57325 batch_time=0.50675 
Train Epoch: 5 [210/250 26880/32000 (84%)] Loss: 2.11270 (QuantReg: 12.24753) QuantErr: 12.24753 batch_time=0.50474 
Train Epoch: 5 [221/250 28288/32000 (88%)] Loss: 2.18508 (QuantReg: 12.64841) QuantErr: 12.64841 batch_time=0.50912 
Train Epoch: 5 [232/250 29696/32000 (93%)] Loss: 1.87572 (QuantReg: 12.65288) QuantErr: 12.65288 batch_time=0.73858 
Train Epoch: 5 [243/250 31104/32000 (97%)] Loss: 2.05006 (QuantReg: 12.59836) QuantErr: 12.59836 batch_time=0.50090 
Train Epoch: 5 codebook_update_time=1.73781
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch5.pth ...
Done in 5.663s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch5.pth ...
Done in 10.939s
removing stale ckpt [epoch 4] [took 0.00s]
 epoch          : 5
 loss           : 2.22903994846344
 quant_reg      : 12.258356712341309
 quant_err      : 12.258356712341309
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 1250
 MSRVTT_full_val/t2v_metrics/R1: 28.973843058350102
 MSRVTT_full_val/t2v_metrics/R5: 64.38631790744466
 MSRVTT_full_val/t2v_metrics/R10: 79.27565392354124
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.619718309859156
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.88264578852061
 MSRVTT_full_val/v2t_metrics/R1: 32.394366197183096
 MSRVTT_full_val/v2t_metrics/R5: 71.83098591549296
 MSRVTT_full_val/v2t_metrics/R10: 84.10462776659959
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.682092555331992
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.05866818029883
 MSRVTT_full_test/t2v_metrics/R1: 10.033444816053512
 MSRVTT_full_test/t2v_metrics/R5: 30.568561872909697
 MSRVTT_full_test/t2v_metrics/R10: 42.642140468227424
 MSRVTT_full_test/t2v_metrics/R50: 76.75585284280936
 MSRVTT_full_test/t2v_metrics/MedR: 15.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.40367892976589
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.560690994798122
 MSRVTT_full_test/v2t_metrics/R1: 11.404682274247492
 MSRVTT_full_test/v2t_metrics/R5: 34.247491638795985
 MSRVTT_full_test/v2t_metrics/R10: 48.82943143812709
 MSRVTT_full_test/v2t_metrics/R50: 82.37458193979933
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 38.3376254180602
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 26.71762657129169
 mnt_best       : 23.560690994798122
 not_improved_count: 0
Train Epoch: 6 [1/250 128/32000 (0%)] Loss: 2.26929 (QuantReg: 12.02267) QuantErr: 12.02267 batch_time=37.63608 
Train Epoch: 6 [12/250 1536/32000 (5%)] Loss: 2.27975 (QuantReg: 11.64983) QuantErr: 11.64983 batch_time=0.58712 
Train Epoch: 6 [23/250 2944/32000 (9%)] Loss: 1.73164 (QuantReg: 12.35945) QuantErr: 12.35945 batch_time=0.51115 
Train Epoch: 6 [34/250 4352/32000 (14%)] Loss: 2.21024 (QuantReg: 12.11651) QuantErr: 12.11651 batch_time=0.51060 
Train Epoch: 6 [45/250 5760/32000 (18%)] Loss: 1.51822 (QuantReg: 12.53956) QuantErr: 12.53956 batch_time=0.50472 
Train Epoch: 6 [56/250 7168/32000 (22%)] Loss: 1.79521 (QuantReg: 12.59847) QuantErr: 12.59847 batch_time=0.50375 
Train Epoch: 6 [67/250 8576/32000 (27%)] Loss: 2.04995 (QuantReg: 12.68151) QuantErr: 12.68151 batch_time=1.04863 
Train Epoch: 6 [78/250 9984/32000 (31%)] Loss: 1.59847 (QuantReg: 12.27142) QuantErr: 12.27142 batch_time=0.51500 
Train Epoch: 6 [89/250 11392/32000 (36%)] Loss: 2.15196 (QuantReg: 12.41911) QuantErr: 12.41911 batch_time=0.51230 
Train Epoch: 6 [100/250 12800/32000 (40%)] Loss: 2.01630 (QuantReg: 12.60903) QuantErr: 12.60903 batch_time=0.51596 
Train Epoch: 6 [111/250 14208/32000 (44%)] Loss: 1.95969 (QuantReg: 12.28639) QuantErr: 12.28639 batch_time=0.51189 
Train Epoch: 6 [122/250 15616/32000 (49%)] Loss: 2.02476 (QuantReg: 12.82800) QuantErr: 12.82800 batch_time=0.52611 
Train Epoch: 6 [133/250 17024/32000 (53%)] Loss: 2.01150 (QuantReg: 12.36328) QuantErr: 12.36328 batch_time=0.50604 
Train Epoch: 6 [144/250 18432/32000 (58%)] Loss: 2.14915 (QuantReg: 12.34011) QuantErr: 12.34011 batch_time=3.41047 
Train Epoch: 6 [155/250 19840/32000 (62%)] Loss: 1.71130 (QuantReg: 12.65826) QuantErr: 12.65826 batch_time=0.50943 
Train Epoch: 6 [166/250 21248/32000 (66%)] Loss: 1.74564 (QuantReg: 12.70969) QuantErr: 12.70969 batch_time=0.50652 
Train Epoch: 6 [177/250 22656/32000 (71%)] Loss: 2.10798 (QuantReg: 13.00653) QuantErr: 13.00653 batch_time=0.50560 
Train Epoch: 6 [188/250 24064/32000 (75%)] Loss: 1.78610 (QuantReg: 13.03165) QuantErr: 13.03165 batch_time=0.51513 
Train Epoch: 6 [199/250 25472/32000 (80%)] Loss: 1.99212 (QuantReg: 12.88212) QuantErr: 12.88212 batch_time=0.50312 
Train Epoch: 6 [210/250 26880/32000 (84%)] Loss: 1.74709 (QuantReg: 12.69743) QuantErr: 12.69743 batch_time=0.67429 
Train Epoch: 6 [221/250 28288/32000 (88%)] Loss: 1.84053 (QuantReg: 12.92586) QuantErr: 12.92586 batch_time=0.52045 
Train Epoch: 6 [232/250 29696/32000 (93%)] Loss: 2.06794 (QuantReg: 12.72392) QuantErr: 12.72392 batch_time=0.51906 
Train Epoch: 6 [243/250 31104/32000 (97%)] Loss: 1.97267 (QuantReg: 12.94688) QuantErr: 12.94688 batch_time=0.55566 
Train Epoch: 6 codebook_update_time=1.71382
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch6.pth ...
Done in 22.866s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch6.pth ...
Done in 26.931s
removing stale ckpt [epoch 5] [took 0.00s]
 epoch          : 6
 loss           : 2.0427571654319765
 quant_reg      : 12.524294567108154
 quant_err      : 12.524294567108154
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 28.973843058350102
 MSRVTT_full_val/t2v_metrics/R5: 63.38028169014085
 MSRVTT_full_val/t2v_metrics/R10: 78.67203219315896
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.164989939637827
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.47191072923643
 MSRVTT_full_val/v2t_metrics/R1: 30.58350100603622
 MSRVTT_full_val/v2t_metrics/R5: 71.83098591549296
 MSRVTT_full_val/v2t_metrics/R10: 84.10462776659959
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.917505030181086
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.9560207902503
 MSRVTT_full_test/t2v_metrics/R1: 10.167224080267559
 MSRVTT_full_test/t2v_metrics/R5: 30.100334448160535
 MSRVTT_full_test/t2v_metrics/R10: 43.54515050167224
 MSRVTT_full_test/t2v_metrics/R50: 76.8561872909699
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 49.51371237458194
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.708523277152377
 MSRVTT_full_test/v2t_metrics/R1: 11.605351170568563
 MSRVTT_full_test/v2t_metrics/R5: 35.08361204013378
 MSRVTT_full_test/v2t_metrics/R10: 48.46153846153846
 MSRVTT_full_test/v2t_metrics/R50: 81.40468227424749
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 40.009698996655516
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.02215170518202
 mnt_best       : 23.708523277152377
 not_improved_count: 0
Train Epoch: 7 [1/250 128/32000 (0%)] Loss: 2.11845 (QuantReg: 11.95550) QuantErr: 11.95550 batch_time=36.73879 
Train Epoch: 7 [12/250 1536/32000 (5%)] Loss: 1.75488 (QuantReg: 12.86716) QuantErr: 12.86716 batch_time=0.51570 
Train Epoch: 7 [23/250 2944/32000 (9%)] Loss: 2.20637 (QuantReg: 12.65231) QuantErr: 12.65231 batch_time=0.65486 
Train Epoch: 7 [34/250 4352/32000 (14%)] Loss: 2.00931 (QuantReg: 12.88451) QuantErr: 12.88451 batch_time=0.53476 
Train Epoch: 7 [45/250 5760/32000 (18%)] Loss: 1.82850 (QuantReg: 12.70363) QuantErr: 12.70363 batch_time=0.53793 
Train Epoch: 7 [56/250 7168/32000 (22%)] Loss: 2.02988 (QuantReg: 12.43126) QuantErr: 12.43126 batch_time=0.66614 
Train Epoch: 7 [67/250 8576/32000 (27%)] Loss: 2.09071 (QuantReg: 13.06501) QuantErr: 13.06501 batch_time=1.01563 
Train Epoch: 7 [78/250 9984/32000 (31%)] Loss: 2.13406 (QuantReg: 12.69611) QuantErr: 12.69611 batch_time=0.52605 
Train Epoch: 7 [89/250 11392/32000 (36%)] Loss: 2.05106 (QuantReg: 12.71241) QuantErr: 12.71241 batch_time=0.56524 
Train Epoch: 7 [100/250 12800/32000 (40%)] Loss: 1.82571 (QuantReg: 12.57809) QuantErr: 12.57809 batch_time=0.53090 
Train Epoch: 7 [111/250 14208/32000 (44%)] Loss: 2.20379 (QuantReg: 12.82801) QuantErr: 12.82801 batch_time=0.99496 
Train Epoch: 7 [122/250 15616/32000 (49%)] Loss: 1.36100 (QuantReg: 13.31719) QuantErr: 13.31719 batch_time=0.50341 
Train Epoch: 7 [133/250 17024/32000 (53%)] Loss: 1.61685 (QuantReg: 12.80344) QuantErr: 12.80344 batch_time=0.51126 
Train Epoch: 7 [144/250 18432/32000 (58%)] Loss: 2.09452 (QuantReg: 12.70422) QuantErr: 12.70422 batch_time=0.52421 
Train Epoch: 7 [155/250 19840/32000 (62%)] Loss: 1.89118 (QuantReg: 12.55594) QuantErr: 12.55594 batch_time=0.52464 
Train Epoch: 7 [166/250 21248/32000 (66%)] Loss: 1.54514 (QuantReg: 12.94401) QuantErr: 12.94401 batch_time=0.51541 
Train Epoch: 7 [177/250 22656/32000 (71%)] Loss: 1.60751 (QuantReg: 13.25112) QuantErr: 13.25112 batch_time=0.57809 
Train Epoch: 7 [188/250 24064/32000 (75%)] Loss: 1.90999 (QuantReg: 12.86511) QuantErr: 12.86511 batch_time=0.51142 
Train Epoch: 7 [199/250 25472/32000 (80%)] Loss: 1.37900 (QuantReg: 13.04923) QuantErr: 13.04923 batch_time=0.56873 
Train Epoch: 7 [210/250 26880/32000 (84%)] Loss: 1.70703 (QuantReg: 13.41481) QuantErr: 13.41481 batch_time=1.23767 
Train Epoch: 7 [221/250 28288/32000 (88%)] Loss: 2.42377 (QuantReg: 12.96762) QuantErr: 12.96762 batch_time=0.52140 
Train Epoch: 7 [232/250 29696/32000 (93%)] Loss: 1.79393 (QuantReg: 13.06324) QuantErr: 13.06324 batch_time=0.89900 
Train Epoch: 7 [243/250 31104/32000 (97%)] Loss: 2.06764 (QuantReg: 13.02359) QuantErr: 13.02359 batch_time=0.51105 
Train Epoch: 7 codebook_update_time=2.02892
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch7.pth ...
Done in 24.319s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch7.pth ...
Done in 28.416s
removing stale ckpt [epoch 6] [took 0.02s]
 epoch          : 7
 loss           : 1.8848004941940308
 quant_reg      : 12.87858529663086
 quant_err      : 12.87858529663086
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 1750
 MSRVTT_full_val/t2v_metrics/R1: 30.18108651911469
 MSRVTT_full_val/t2v_metrics/R5: 66.39839034205231
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.231388329979879
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.52395641215783
 MSRVTT_full_val/v2t_metrics/R1: 31.99195171026157
 MSRVTT_full_val/v2t_metrics/R5: 70.4225352112676
 MSRVTT_full_val/v2t_metrics/R10: 84.10462776659959
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.531187122736418
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 57.4368695035054
 MSRVTT_full_test/t2v_metrics/R1: 10.735785953177258
 MSRVTT_full_test/t2v_metrics/R5: 32.642140468227424
 MSRVTT_full_test/t2v_metrics/R10: 46.42140468227425
 MSRVTT_full_test/t2v_metrics/R50: 78.79598662207358
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.33277591973244
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.338267519005676
 MSRVTT_full_test/v2t_metrics/R1: 11.605351170568563
 MSRVTT_full_test/v2t_metrics/R5: 34.71571906354515
 MSRVTT_full_test/v2t_metrics/R10: 48.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 82.04013377926421
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 39.034113712374584
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.00765508800257
 mnt_best       : 25.338267519005676
 not_improved_count: 0
Train Epoch: 8 [1/250 128/32000 (0%)] Loss: 1.77664 (QuantReg: 12.71163) QuantErr: 12.71163 batch_time=31.96356 
Train Epoch: 8 [12/250 1536/32000 (5%)] Loss: 2.05509 (QuantReg: 12.81573) QuantErr: 12.81573 batch_time=0.50872 
Train Epoch: 8 [23/250 2944/32000 (9%)] Loss: 2.36071 (QuantReg: 12.51158) QuantErr: 12.51158 batch_time=0.94886 
Train Epoch: 8 [34/250 4352/32000 (14%)] Loss: 1.80041 (QuantReg: 13.05244) QuantErr: 13.05244 batch_time=0.51382 
Train Epoch: 8 [45/250 5760/32000 (18%)] Loss: 2.04531 (QuantReg: 12.77402) QuantErr: 12.77402 batch_time=0.51929 
Train Epoch: 8 [56/250 7168/32000 (22%)] Loss: 1.81729 (QuantReg: 12.57228) QuantErr: 12.57228 batch_time=0.52997 
Train Epoch: 8 [67/250 8576/32000 (27%)] Loss: 1.70293 (QuantReg: 13.16150) QuantErr: 13.16150 batch_time=0.54332 
Train Epoch: 8 [78/250 9984/32000 (31%)] Loss: 1.58848 (QuantReg: 13.13439) QuantErr: 13.13439 batch_time=0.52550 
Train Epoch: 8 [89/250 11392/32000 (36%)] Loss: 1.88265 (QuantReg: 13.02473) QuantErr: 13.02473 batch_time=0.79046 
Train Epoch: 8 [100/250 12800/32000 (40%)] Loss: 1.78298 (QuantReg: 13.00465) QuantErr: 13.00465 batch_time=0.53236 
Train Epoch: 8 [111/250 14208/32000 (44%)] Loss: 1.66055 (QuantReg: 13.29060) QuantErr: 13.29060 batch_time=0.51348 
Train Epoch: 8 [122/250 15616/32000 (49%)] Loss: 2.44289 (QuantReg: 13.33665) QuantErr: 13.33665 batch_time=0.49596 
Train Epoch: 8 [133/250 17024/32000 (53%)] Loss: 1.61513 (QuantReg: 13.07630) QuantErr: 13.07630 batch_time=0.50792 
Train Epoch: 8 [144/250 18432/32000 (58%)] Loss: 1.64609 (QuantReg: 13.14705) QuantErr: 13.14705 batch_time=0.51516 
Train Epoch: 8 [155/250 19840/32000 (62%)] Loss: 2.10053 (QuantReg: 13.28791) QuantErr: 13.28791 batch_time=0.51283 
Train Epoch: 8 [166/250 21248/32000 (66%)] Loss: 1.50396 (QuantReg: 13.11203) QuantErr: 13.11203 batch_time=0.52028 
Train Epoch: 8 [177/250 22656/32000 (71%)] Loss: 2.11753 (QuantReg: 13.30127) QuantErr: 13.30127 batch_time=0.51628 
Train Epoch: 8 [188/250 24064/32000 (75%)] Loss: 1.87874 (QuantReg: 13.40938) QuantErr: 13.40938 batch_time=0.54811 
Train Epoch: 8 [199/250 25472/32000 (80%)] Loss: 1.33270 (QuantReg: 13.52777) QuantErr: 13.52777 batch_time=1.81242 
Train Epoch: 8 [210/250 26880/32000 (84%)] Loss: 1.26971 (QuantReg: 13.46170) QuantErr: 13.46170 batch_time=0.51319 
Train Epoch: 8 [221/250 28288/32000 (88%)] Loss: 1.34864 (QuantReg: 13.72565) QuantErr: 13.72565 batch_time=0.52091 
Train Epoch: 8 [232/250 29696/32000 (93%)] Loss: 1.00556 (QuantReg: 13.29458) QuantErr: 13.29458 batch_time=0.53439 
Train Epoch: 8 [243/250 31104/32000 (97%)] Loss: 1.39702 (QuantReg: 13.30097) QuantErr: 13.30097 batch_time=0.50677 
Train Epoch: 8 codebook_update_time=1.72731
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch8.pth ...
Done in 4.611s
removing stale ckpt [epoch 7] [took 0.00s]
 epoch          : 8
 loss           : 1.770752371788025
 quant_reg      : 13.045510845184326
 quant_err      : 13.045510845184326
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 28.772635814889338
 MSRVTT_full_val/t2v_metrics/R5: 63.58148893360161
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.438631790744466
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.80454624918084
 MSRVTT_full_val/v2t_metrics/R1: 34.20523138832998
 MSRVTT_full_val/v2t_metrics/R5: 71.0261569416499
 MSRVTT_full_val/v2t_metrics/R10: 84.70824949698189
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.738430583501006
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.039887164113026
 MSRVTT_full_test/t2v_metrics/R1: 10.936454849498327
 MSRVTT_full_test/t2v_metrics/R5: 32.441471571906355
 MSRVTT_full_test/t2v_metrics/R10: 44.5819397993311
 MSRVTT_full_test/t2v_metrics/R50: 78.06020066889631
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.5628762541806
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.102213775137557
 MSRVTT_full_test/v2t_metrics/R1: 12.575250836120402
 MSRVTT_full_test/v2t_metrics/R5: 36.020066889632105
 MSRVTT_full_test/v2t_metrics/R10: 51.103678929765884
 MSRVTT_full_test/v2t_metrics/R50: 83.74581939799332
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.287290969899665
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.49953533274866
 mnt_best       : 25.338267519005676
 not_improved_count: 1
Train Epoch: 9 [1/250 128/32000 (0%)] Loss: 1.98917 (QuantReg: 12.75271) QuantErr: 12.75271 batch_time=39.71745 
Train Epoch: 9 [12/250 1536/32000 (5%)] Loss: 1.61426 (QuantReg: 12.96981) QuantErr: 12.96981 batch_time=0.50739 
Train Epoch: 9 [23/250 2944/32000 (9%)] Loss: 2.05270 (QuantReg: 13.00939) QuantErr: 13.00939 batch_time=0.55240 
Train Epoch: 9 [34/250 4352/32000 (14%)] Loss: 2.01773 (QuantReg: 12.89952) QuantErr: 12.89952 batch_time=0.51339 
Train Epoch: 9 [45/250 5760/32000 (18%)] Loss: 2.11309 (QuantReg: 12.83890) QuantErr: 12.83890 batch_time=0.51598 
Train Epoch: 9 [56/250 7168/32000 (22%)] Loss: 1.83943 (QuantReg: 13.09502) QuantErr: 13.09502 batch_time=0.52760 
Train Epoch: 9 [67/250 8576/32000 (27%)] Loss: 1.62836 (QuantReg: 12.99808) QuantErr: 12.99808 batch_time=0.54115 
Train Epoch: 9 [78/250 9984/32000 (31%)] Loss: 1.44199 (QuantReg: 13.15097) QuantErr: 13.15097 batch_time=0.51207 
Train Epoch: 9 [89/250 11392/32000 (36%)] Loss: 1.93259 (QuantReg: 13.06588) QuantErr: 13.06588 batch_time=0.52286 
Train Epoch: 9 [100/250 12800/32000 (40%)] Loss: 1.68815 (QuantReg: 13.29938) QuantErr: 13.29938 batch_time=0.51428 
Train Epoch: 9 [111/250 14208/32000 (44%)] Loss: 1.81522 (QuantReg: 13.31697) QuantErr: 13.31697 batch_time=0.51807 
Train Epoch: 9 [122/250 15616/32000 (49%)] Loss: 1.50635 (QuantReg: 13.49733) QuantErr: 13.49733 batch_time=0.52945 
Train Epoch: 9 [133/250 17024/32000 (53%)] Loss: 1.68361 (QuantReg: 13.46684) QuantErr: 13.46684 batch_time=0.51469 
Train Epoch: 9 [144/250 18432/32000 (58%)] Loss: 1.78861 (QuantReg: 13.61482) QuantErr: 13.61482 batch_time=1.55888 
Train Epoch: 9 [155/250 19840/32000 (62%)] Loss: 1.86873 (QuantReg: 13.69716) QuantErr: 13.69716 batch_time=0.56656 
Train Epoch: 9 [166/250 21248/32000 (66%)] Loss: 1.76745 (QuantReg: 13.43184) QuantErr: 13.43184 batch_time=0.51828 
Train Epoch: 9 [177/250 22656/32000 (71%)] Loss: 1.20505 (QuantReg: 13.71965) QuantErr: 13.71965 batch_time=1.11511 
Train Epoch: 9 [188/250 24064/32000 (75%)] Loss: 1.42763 (QuantReg: 13.83530) QuantErr: 13.83530 batch_time=0.50252 
Train Epoch: 9 [199/250 25472/32000 (80%)] Loss: 1.42807 (QuantReg: 13.65457) QuantErr: 13.65457 batch_time=0.53268 
Train Epoch: 9 [210/250 26880/32000 (84%)] Loss: 1.30568 (QuantReg: 13.40729) QuantErr: 13.40729 batch_time=0.50528 
Train Epoch: 9 [221/250 28288/32000 (88%)] Loss: 1.54088 (QuantReg: 13.56817) QuantErr: 13.56817 batch_time=0.55060 
Train Epoch: 9 [232/250 29696/32000 (93%)] Loss: 1.56940 (QuantReg: 13.67107) QuantErr: 13.67107 batch_time=1.83822 
Train Epoch: 9 [243/250 31104/32000 (97%)] Loss: 1.06578 (QuantReg: 13.99704) QuantErr: 13.99704 batch_time=0.51530 
Train Epoch: 9 codebook_update_time=1.79570
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch9.pth ...
Done in 5.949s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch9.pth ...
Done in 10.325s
removing stale ckpt [epoch 8] [took 0.00s]
 epoch          : 9
 loss           : 1.6411672859191895
 quant_reg      : 13.367284130096435
 quant_err      : 13.367284130096435
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 2250
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 65.99597585513078
 MSRVTT_full_val/t2v_metrics/R10: 80.28169014084507
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.839034205231388
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.80268027960629
 MSRVTT_full_val/v2t_metrics/R1: 34.60764587525151
 MSRVTT_full_val/v2t_metrics/R5: 73.03822937625755
 MSRVTT_full_val/v2t_metrics/R10: 85.11066398390342
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.702213279678069
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.919579606191704
 MSRVTT_full_test/t2v_metrics/R1: 11.237458193979933
 MSRVTT_full_test/t2v_metrics/R5: 34.080267558528426
 MSRVTT_full_test/t2v_metrics/R10: 47.19063545150502
 MSRVTT_full_test/t2v_metrics/R50: 79.66555183946488
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.787290969899665
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.242727454052577
 MSRVTT_full_test/v2t_metrics/R1: 13.010033444816054
 MSRVTT_full_test/v2t_metrics/R5: 37.92642140468227
 MSRVTT_full_test/v2t_metrics/R10: 51.67224080267559
 MSRVTT_full_test/v2t_metrics/R50: 83.64548494983278
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.607357859531774
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.43241227300731
 mnt_best       : 26.242727454052577
 not_improved_count: 0
Train Epoch: 10 [1/250 128/32000 (0%)] Loss: 1.38048 (QuantReg: 13.03663) QuantErr: 13.03663 batch_time=36.97880 
Train Epoch: 10 [12/250 1536/32000 (5%)] Loss: 1.45071 (QuantReg: 13.45818) QuantErr: 13.45818 batch_time=0.50243 
Train Epoch: 10 [23/250 2944/32000 (9%)] Loss: 1.47931 (QuantReg: 13.28318) QuantErr: 13.28318 batch_time=0.51352 
Train Epoch: 10 [34/250 4352/32000 (14%)] Loss: 1.27936 (QuantReg: 13.07540) QuantErr: 13.07540 batch_time=0.50754 
Train Epoch: 10 [45/250 5760/32000 (18%)] Loss: 1.39493 (QuantReg: 13.81783) QuantErr: 13.81783 batch_time=0.50018 
Train Epoch: 10 [56/250 7168/32000 (22%)] Loss: 2.29585 (QuantReg: 13.25865) QuantErr: 13.25865 batch_time=0.56576 
Train Epoch: 10 [67/250 8576/32000 (27%)] Loss: 1.41632 (QuantReg: 13.53897) QuantErr: 13.53897 batch_time=0.54184 
Train Epoch: 10 [78/250 9984/32000 (31%)] Loss: 1.51856 (QuantReg: 13.27279) QuantErr: 13.27279 batch_time=0.51382 
Train Epoch: 10 [89/250 11392/32000 (36%)] Loss: 1.59457 (QuantReg: 13.23723) QuantErr: 13.23723 batch_time=0.50092 
Train Epoch: 10 [100/250 12800/32000 (40%)] Loss: 2.08513 (QuantReg: 13.10910) QuantErr: 13.10910 batch_time=0.50646 
Train Epoch: 10 [111/250 14208/32000 (44%)] Loss: 1.26913 (QuantReg: 13.67716) QuantErr: 13.67716 batch_time=0.50035 
Train Epoch: 10 [122/250 15616/32000 (49%)] Loss: 1.69039 (QuantReg: 13.67557) QuantErr: 13.67557 batch_time=0.56816 
Train Epoch: 10 [133/250 17024/32000 (53%)] Loss: 1.90578 (QuantReg: 13.56019) QuantErr: 13.56019 batch_time=1.98819 
Train Epoch: 10 [144/250 18432/32000 (58%)] Loss: 2.02950 (QuantReg: 13.48510) QuantErr: 13.48510 batch_time=0.51100 
Train Epoch: 10 [155/250 19840/32000 (62%)] Loss: 1.26685 (QuantReg: 13.88254) QuantErr: 13.88254 batch_time=0.51878 
Train Epoch: 10 [166/250 21248/32000 (66%)] Loss: 1.22747 (QuantReg: 13.84581) QuantErr: 13.84581 batch_time=0.49691 
Train Epoch: 10 [177/250 22656/32000 (71%)] Loss: 2.51161 (QuantReg: 13.40407) QuantErr: 13.40407 batch_time=0.52308 
Train Epoch: 10 [188/250 24064/32000 (75%)] Loss: 1.33813 (QuantReg: 14.22072) QuantErr: 14.22072 batch_time=0.49429 
Train Epoch: 10 [199/250 25472/32000 (80%)] Loss: 1.21347 (QuantReg: 14.27179) QuantErr: 14.27179 batch_time=4.92224 
Train Epoch: 10 [210/250 26880/32000 (84%)] Loss: 1.44381 (QuantReg: 13.82871) QuantErr: 13.82871 batch_time=0.55543 
Train Epoch: 10 [221/250 28288/32000 (88%)] Loss: 1.42483 (QuantReg: 13.44580) QuantErr: 13.44580 batch_time=0.49423 
Train Epoch: 10 [232/250 29696/32000 (93%)] Loss: 2.09457 (QuantReg: 13.50370) QuantErr: 13.50370 batch_time=0.50822 
Train Epoch: 10 [243/250 31104/32000 (97%)] Loss: 1.89563 (QuantReg: 13.47798) QuantErr: 13.47798 batch_time=0.52446 
Train Epoch: 10 codebook_update_time=1.68792
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch10.pth ...
Done in 4.703s
removing stale ckpt [epoch 9] [took 0.00s]
 epoch          : 10
 loss           : 1.5519173178672792
 quant_reg      : 13.521942432403565
 quant_err      : 13.521942432403565
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 30.18108651911469
 MSRVTT_full_val/t2v_metrics/R5: 65.59356136820925
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.235412474849095
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.48227602609188
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.303822937625754
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.57067393676297
 MSRVTT_full_test/t2v_metrics/R1: 11.638795986622073
 MSRVTT_full_test/t2v_metrics/R5: 32.10702341137124
 MSRVTT_full_test/t2v_metrics/R10: 45.18394648829432
 MSRVTT_full_test/t2v_metrics/R50: 79.66555183946488
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.921571906354515
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.65453143986109
 MSRVTT_full_test/v2t_metrics/R1: 12.240802675585284
 MSRVTT_full_test/v2t_metrics/R5: 37.525083612040135
 MSRVTT_full_test/v2t_metrics/R10: 53.57859531772575
 MSRVTT_full_test/v2t_metrics/R50: 84.51505016722408
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.3566889632107
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.0875826089776
 mnt_best       : 26.242727454052577
 not_improved_count: 1
Train Epoch: 11 [1/250 128/32000 (0%)] Loss: 1.30805 (QuantReg: 13.44690) QuantErr: 13.44690 batch_time=40.38943 
Train Epoch: 11 [12/250 1536/32000 (5%)] Loss: 1.33218 (QuantReg: 13.66147) QuantErr: 13.66147 batch_time=0.54308 
Train Epoch: 11 [23/250 2944/32000 (9%)] Loss: 1.51671 (QuantReg: 13.30803) QuantErr: 13.30803 batch_time=0.51216 
Train Epoch: 11 [34/250 4352/32000 (14%)] Loss: 1.51730 (QuantReg: 13.60312) QuantErr: 13.60312 batch_time=0.50746 
Train Epoch: 11 [45/250 5760/32000 (18%)] Loss: 1.62537 (QuantReg: 13.85503) QuantErr: 13.85503 batch_time=0.50727 
Train Epoch: 11 [56/250 7168/32000 (22%)] Loss: 1.32904 (QuantReg: 13.77028) QuantErr: 13.77028 batch_time=0.50593 
Train Epoch: 11 [67/250 8576/32000 (27%)] Loss: 1.81721 (QuantReg: 13.59519) QuantErr: 13.59519 batch_time=0.54132 
Train Epoch: 11 [78/250 9984/32000 (31%)] Loss: 1.43994 (QuantReg: 13.99275) QuantErr: 13.99275 batch_time=0.50229 
Train Epoch: 11 [89/250 11392/32000 (36%)] Loss: 1.51552 (QuantReg: 13.39406) QuantErr: 13.39406 batch_time=0.52196 
Train Epoch: 11 [100/250 12800/32000 (40%)] Loss: 1.65050 (QuantReg: 13.52925) QuantErr: 13.52925 batch_time=0.51756 
Train Epoch: 11 [111/250 14208/32000 (44%)] Loss: 1.73249 (QuantReg: 13.57458) QuantErr: 13.57458 batch_time=0.52343 
Train Epoch: 11 [122/250 15616/32000 (49%)] Loss: 1.60901 (QuantReg: 14.00465) QuantErr: 14.00465 batch_time=0.50703 
Train Epoch: 11 [133/250 17024/32000 (53%)] Loss: 1.87021 (QuantReg: 13.47239) QuantErr: 13.47239 batch_time=0.51501 
Train Epoch: 11 [144/250 18432/32000 (58%)] Loss: 1.58429 (QuantReg: 13.62381) QuantErr: 13.62381 batch_time=0.61912 
Train Epoch: 11 [155/250 19840/32000 (62%)] Loss: 1.47941 (QuantReg: 13.65485) QuantErr: 13.65485 batch_time=1.52910 
Train Epoch: 11 [166/250 21248/32000 (66%)] Loss: 1.53024 (QuantReg: 13.53959) QuantErr: 13.53959 batch_time=0.56802 
Train Epoch: 11 [177/250 22656/32000 (71%)] Loss: 1.42734 (QuantReg: 13.63213) QuantErr: 13.63213 batch_time=0.52762 
Train Epoch: 11 [188/250 24064/32000 (75%)] Loss: 1.08461 (QuantReg: 13.80403) QuantErr: 13.80403 batch_time=0.50286 
Train Epoch: 11 [199/250 25472/32000 (80%)] Loss: 1.22786 (QuantReg: 14.18938) QuantErr: 14.18938 batch_time=0.50690 
Train Epoch: 11 [210/250 26880/32000 (84%)] Loss: 1.51101 (QuantReg: 14.03917) QuantErr: 14.03917 batch_time=0.58163 
Train Epoch: 11 [221/250 28288/32000 (88%)] Loss: 1.49444 (QuantReg: 14.20695) QuantErr: 14.20695 batch_time=0.50484 
Train Epoch: 11 [232/250 29696/32000 (93%)] Loss: 1.20050 (QuantReg: 14.16360) QuantErr: 14.16360 batch_time=0.50876 
Train Epoch: 11 [243/250 31104/32000 (97%)] Loss: 1.06494 (QuantReg: 14.43571) QuantErr: 14.43571 batch_time=0.50460 
Train Epoch: 11 codebook_update_time=1.76664
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch11.pth ...
Done in 14.392s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch11.pth ...
Done in 22.681s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 1.4493475635051727
 quant_reg      : 13.80793920135498
 quant_err      : 13.80793920135498
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 2750
 MSRVTT_full_val/t2v_metrics/R1: 30.784708249496983
 MSRVTT_full_val/t2v_metrics/R5: 66.39839034205231
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.6579476861167
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.06649225011874
 MSRVTT_full_val/v2t_metrics/R1: 34.20523138832998
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.7082494969818915
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.61404554818994
 MSRVTT_full_test/t2v_metrics/R1: 11.672240802675585
 MSRVTT_full_test/t2v_metrics/R5: 33.54515050167224
 MSRVTT_full_test/t2v_metrics/R10: 46.68896321070234
 MSRVTT_full_test/t2v_metrics/R50: 79.29765886287625
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.32809364548495
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.343050904901073
 MSRVTT_full_test/v2t_metrics/R1: 13.210702341137123
 MSRVTT_full_test/v2t_metrics/R5: 37.82608695652174
 MSRVTT_full_test/v2t_metrics/R10: 53.57859531772575
 MSRVTT_full_test/v2t_metrics/R50: 84.48160535117057
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.31003344481606
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.915955768901217
 mnt_best       : 26.343050904901073
 not_improved_count: 0
Train Epoch: 12 [1/250 128/32000 (0%)] Loss: 1.44723 (QuantReg: 13.65227) QuantErr: 13.65227 batch_time=38.45015 
Train Epoch: 12 [12/250 1536/32000 (5%)] Loss: 1.72914 (QuantReg: 13.67579) QuantErr: 13.67579 batch_time=0.52019 
Train Epoch: 12 [23/250 2944/32000 (9%)] Loss: 1.25751 (QuantReg: 13.72788) QuantErr: 13.72788 batch_time=0.55637 
Train Epoch: 12 [34/250 4352/32000 (14%)] Loss: 1.32388 (QuantReg: 13.68119) QuantErr: 13.68119 batch_time=0.51703 
Train Epoch: 12 [45/250 5760/32000 (18%)] Loss: 1.02860 (QuantReg: 14.09898) QuantErr: 14.09898 batch_time=0.53968 
Train Epoch: 12 [56/250 7168/32000 (22%)] Loss: 1.28008 (QuantReg: 13.91757) QuantErr: 13.91757 batch_time=0.51727 
Train Epoch: 12 [67/250 8576/32000 (27%)] Loss: 1.16021 (QuantReg: 13.83839) QuantErr: 13.83839 batch_time=0.51462 
Train Epoch: 12 [78/250 9984/32000 (31%)] Loss: 1.37663 (QuantReg: 13.74630) QuantErr: 13.74630 batch_time=0.53377 
Train Epoch: 12 [89/250 11392/32000 (36%)] Loss: 1.19566 (QuantReg: 13.63184) QuantErr: 13.63184 batch_time=0.58786 
Train Epoch: 12 [100/250 12800/32000 (40%)] Loss: 1.51718 (QuantReg: 13.78066) QuantErr: 13.78066 batch_time=0.52553 
Train Epoch: 12 [111/250 14208/32000 (44%)] Loss: 1.17387 (QuantReg: 13.83499) QuantErr: 13.83499 batch_time=0.53347 
Train Epoch: 12 [122/250 15616/32000 (49%)] Loss: 1.55719 (QuantReg: 13.90688) QuantErr: 13.90688 batch_time=0.53811 
Train Epoch: 12 [133/250 17024/32000 (53%)] Loss: 1.10180 (QuantReg: 14.06961) QuantErr: 14.06961 batch_time=0.52736 
Train Epoch: 12 [144/250 18432/32000 (58%)] Loss: 1.04491 (QuantReg: 14.58882) QuantErr: 14.58882 batch_time=0.53038 
Train Epoch: 12 [155/250 19840/32000 (62%)] Loss: 1.64531 (QuantReg: 13.80930) QuantErr: 13.80930 batch_time=0.51833 
Train Epoch: 12 [166/250 21248/32000 (66%)] Loss: 1.01049 (QuantReg: 14.21872) QuantErr: 14.21872 batch_time=0.54575 
Train Epoch: 12 [177/250 22656/32000 (71%)] Loss: 1.20116 (QuantReg: 14.25621) QuantErr: 14.25621 batch_time=0.57402 
Train Epoch: 12 [188/250 24064/32000 (75%)] Loss: 1.69134 (QuantReg: 13.67521) QuantErr: 13.67521 batch_time=0.50762 
Train Epoch: 12 [199/250 25472/32000 (80%)] Loss: 1.43713 (QuantReg: 13.65826) QuantErr: 13.65826 batch_time=0.50526 
Train Epoch: 12 [210/250 26880/32000 (84%)] Loss: 1.77693 (QuantReg: 13.93455) QuantErr: 13.93455 batch_time=1.71968 
Train Epoch: 12 [221/250 28288/32000 (88%)] Loss: 1.45457 (QuantReg: 13.63896) QuantErr: 13.63896 batch_time=0.52871 
Train Epoch: 12 [232/250 29696/32000 (93%)] Loss: 1.39487 (QuantReg: 14.18503) QuantErr: 14.18503 batch_time=0.53480 
Train Epoch: 12 [243/250 31104/32000 (97%)] Loss: 1.50285 (QuantReg: 14.33307) QuantErr: 14.33307 batch_time=0.55271 
Train Epoch: 12 codebook_update_time=1.66686
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch12.pth ...
Done in 6.613s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch12.pth ...
Done in 12.617s
removing stale ckpt [epoch 11] [took 0.00s]
 epoch          : 12
 loss           : 1.3786621069908143
 quant_reg      : 13.926246883392334
 quant_err      : 13.926246883392334
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 67.00201207243461
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.138832997987928
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.21161466408808
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.189134808853119
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.006609124988245
 MSRVTT_full_test/t2v_metrics/R1: 11.97324414715719
 MSRVTT_full_test/t2v_metrics/R5: 34.94983277591973
 MSRVTT_full_test/t2v_metrics/R10: 48.42809364548495
 MSRVTT_full_test/t2v_metrics/R50: 81.00334448160535
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.30334448160535
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.263698558292255
 MSRVTT_full_test/v2t_metrics/R1: 13.244147157190636
 MSRVTT_full_test/v2t_metrics/R5: 39.096989966555185
 MSRVTT_full_test/v2t_metrics/R10: 55.18394648829432
 MSRVTT_full_test/v2t_metrics/R50: 85.11705685618729
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.57759197324415
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.57220000562679
 mnt_best       : 27.263698558292255
 not_improved_count: 0
Train Epoch: 13 [1/250 128/32000 (0%)] Loss: 1.22077 (QuantReg: 14.00204) QuantErr: 14.00204 batch_time=37.57890 
Train Epoch: 13 [12/250 1536/32000 (5%)] Loss: 1.86167 (QuantReg: 13.45687) QuantErr: 13.45687 batch_time=4.84795 
Train Epoch: 13 [23/250 2944/32000 (9%)] Loss: 1.34994 (QuantReg: 14.12304) QuantErr: 14.12304 batch_time=0.50667 
Train Epoch: 13 [34/250 4352/32000 (14%)] Loss: 1.14189 (QuantReg: 14.08197) QuantErr: 14.08197 batch_time=0.50863 
Train Epoch: 13 [45/250 5760/32000 (18%)] Loss: 1.25568 (QuantReg: 14.00688) QuantErr: 14.00688 batch_time=1.35022 
Train Epoch: 13 [56/250 7168/32000 (22%)] Loss: 1.37488 (QuantReg: 14.35078) QuantErr: 14.35078 batch_time=0.52891 
Train Epoch: 13 [67/250 8576/32000 (27%)] Loss: 1.37141 (QuantReg: 14.18127) QuantErr: 14.18127 batch_time=0.54103 
Train Epoch: 13 [78/250 9984/32000 (31%)] Loss: 1.69926 (QuantReg: 14.28839) QuantErr: 14.28839 batch_time=0.50165 
Train Epoch: 13 [89/250 11392/32000 (36%)] Loss: 1.16105 (QuantReg: 13.77132) QuantErr: 13.77132 batch_time=0.54979 
Train Epoch: 13 [100/250 12800/32000 (40%)] Loss: 1.54584 (QuantReg: 14.04511) QuantErr: 14.04511 batch_time=0.50516 
Train Epoch: 13 [111/250 14208/32000 (44%)] Loss: 1.44215 (QuantReg: 13.84797) QuantErr: 13.84797 batch_time=0.52350 
Train Epoch: 13 [122/250 15616/32000 (49%)] Loss: 0.98403 (QuantReg: 14.24296) QuantErr: 14.24296 batch_time=0.53431 
Train Epoch: 13 [133/250 17024/32000 (53%)] Loss: 1.25480 (QuantReg: 14.38118) QuantErr: 14.38118 batch_time=0.51911 
Train Epoch: 13 [144/250 18432/32000 (58%)] Loss: 1.32666 (QuantReg: 14.30749) QuantErr: 14.30749 batch_time=0.52971 
Train Epoch: 13 [155/250 19840/32000 (62%)] Loss: 1.53844 (QuantReg: 13.91843) QuantErr: 13.91843 batch_time=0.50767 
Train Epoch: 13 [166/250 21248/32000 (66%)] Loss: 1.15471 (QuantReg: 13.98852) QuantErr: 13.98852 batch_time=0.51055 
Train Epoch: 13 [177/250 22656/32000 (71%)] Loss: 1.02734 (QuantReg: 14.54011) QuantErr: 14.54011 batch_time=0.61834 
Train Epoch: 13 [188/250 24064/32000 (75%)] Loss: 1.76653 (QuantReg: 13.97441) QuantErr: 13.97441 batch_time=0.60295 
Train Epoch: 13 [199/250 25472/32000 (80%)] Loss: 1.03933 (QuantReg: 14.69055) QuantErr: 14.69055 batch_time=0.50802 
Train Epoch: 13 [210/250 26880/32000 (84%)] Loss: 1.72690 (QuantReg: 14.32969) QuantErr: 14.32969 batch_time=0.52545 
Train Epoch: 13 [221/250 28288/32000 (88%)] Loss: 1.54842 (QuantReg: 14.35689) QuantErr: 14.35689 batch_time=0.51318 
Train Epoch: 13 [232/250 29696/32000 (93%)] Loss: 1.11829 (QuantReg: 14.24028) QuantErr: 14.24028 batch_time=0.52064 
Train Epoch: 13 [243/250 31104/32000 (97%)] Loss: 1.34593 (QuantReg: 14.40843) QuantErr: 14.40843 batch_time=0.92388 
Train Epoch: 13 codebook_update_time=1.80115
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch13.pth ...
Done in 4.072s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch13.pth ...
Done in 8.021s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 1.317027200460434
 quant_reg      : 14.150179462432861
 quant_err      : 14.150179462432861
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 3250
 MSRVTT_full_val/t2v_metrics/R1: 31.58953722334004
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.645875251509055
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.33646260996741
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.219315895372233
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.28225899062843
 MSRVTT_full_test/t2v_metrics/R1: 12.040133779264215
 MSRVTT_full_test/t2v_metrics/R5: 35.551839464882946
 MSRVTT_full_test/t2v_metrics/R10: 48.96321070234114
 MSRVTT_full_test/t2v_metrics/R50: 79.49832775919732
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.34615384615385
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.57112109266316
 MSRVTT_full_test/v2t_metrics/R1: 14.51505016722408
 MSRVTT_full_test/v2t_metrics/R5: 40.33444816053512
 MSRVTT_full_test/v2t_metrics/R10: 54.71571906354515
 MSRVTT_full_test/v2t_metrics/R50: 85.35117056856187
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.16421404682274
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.759153906063084
 mnt_best       : 27.57112109266316
 not_improved_count: 0
Train Epoch: 14 [1/250 128/32000 (0%)] Loss: 1.05656 (QuantReg: 14.11441) QuantErr: 14.11441 batch_time=37.88346 
Train Epoch: 14 [12/250 1536/32000 (5%)] Loss: 1.70573 (QuantReg: 14.28553) QuantErr: 14.28553 batch_time=0.52283 
Train Epoch: 14 [23/250 2944/32000 (9%)] Loss: 1.33255 (QuantReg: 14.25108) QuantErr: 14.25108 batch_time=0.57378 
Train Epoch: 14 [34/250 4352/32000 (14%)] Loss: 1.20870 (QuantReg: 14.04397) QuantErr: 14.04397 batch_time=0.55684 
Train Epoch: 14 [45/250 5760/32000 (18%)] Loss: 1.59684 (QuantReg: 14.15369) QuantErr: 14.15369 batch_time=0.54857 
Train Epoch: 14 [56/250 7168/32000 (22%)] Loss: 1.28529 (QuantReg: 14.08165) QuantErr: 14.08165 batch_time=0.52432 
Train Epoch: 14 [67/250 8576/32000 (27%)] Loss: 1.52112 (QuantReg: 14.10736) QuantErr: 14.10736 batch_time=0.55942 
Train Epoch: 14 [78/250 9984/32000 (31%)] Loss: 1.53429 (QuantReg: 13.88581) QuantErr: 13.88581 batch_time=0.66616 
Train Epoch: 14 [89/250 11392/32000 (36%)] Loss: 0.97121 (QuantReg: 14.08434) QuantErr: 14.08434 batch_time=0.55202 
Train Epoch: 14 [100/250 12800/32000 (40%)] Loss: 1.23670 (QuantReg: 14.04921) QuantErr: 14.04921 batch_time=0.52231 
Train Epoch: 14 [111/250 14208/32000 (44%)] Loss: 1.09710 (QuantReg: 14.31238) QuantErr: 14.31238 batch_time=0.58720 
Train Epoch: 14 [122/250 15616/32000 (49%)] Loss: 1.57524 (QuantReg: 13.80048) QuantErr: 13.80048 batch_time=0.53327 
Train Epoch: 14 [133/250 17024/32000 (53%)] Loss: 1.06450 (QuantReg: 14.52403) QuantErr: 14.52403 batch_time=0.51890 
Train Epoch: 14 [144/250 18432/32000 (58%)] Loss: 0.95397 (QuantReg: 14.31596) QuantErr: 14.31596 batch_time=2.67340 
Train Epoch: 14 [155/250 19840/32000 (62%)] Loss: 1.22827 (QuantReg: 14.39271) QuantErr: 14.39271 batch_time=0.50646 
Train Epoch: 14 [166/250 21248/32000 (66%)] Loss: 1.01029 (QuantReg: 14.39787) QuantErr: 14.39787 batch_time=0.56151 
Train Epoch: 14 [177/250 22656/32000 (71%)] Loss: 0.97429 (QuantReg: 14.20917) QuantErr: 14.20917 batch_time=0.52306 
Train Epoch: 14 [188/250 24064/32000 (75%)] Loss: 1.58543 (QuantReg: 14.57169) QuantErr: 14.57169 batch_time=0.50811 
Train Epoch: 14 [199/250 25472/32000 (80%)] Loss: 1.22738 (QuantReg: 14.32255) QuantErr: 14.32255 batch_time=0.51849 
Train Epoch: 14 [210/250 26880/32000 (84%)] Loss: 1.53740 (QuantReg: 14.27053) QuantErr: 14.27053 batch_time=2.98643 
Train Epoch: 14 [221/250 28288/32000 (88%)] Loss: 1.29868 (QuantReg: 14.41371) QuantErr: 14.41371 batch_time=0.51388 
Train Epoch: 14 [232/250 29696/32000 (93%)] Loss: 1.17884 (QuantReg: 14.61811) QuantErr: 14.61811 batch_time=0.51495 
Train Epoch: 14 [243/250 31104/32000 (97%)] Loss: 1.25525 (QuantReg: 14.29929) QuantErr: 14.29929 batch_time=0.52290 
Train Epoch: 14 codebook_update_time=1.68222
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch14.pth ...
Done in 3.751s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 1.271657412290573
 quant_reg      : 14.25413032913208
 quant_err      : 14.25413032913208
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 29.77867203219316
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.722334004024145
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.29022462298815
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 73.64185110663983
 MSRVTT_full_val/v2t_metrics/R10: 84.90945674044265
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.3843058350100605
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.72694834711691
 MSRVTT_full_test/t2v_metrics/R1: 11.906354515050166
 MSRVTT_full_test/t2v_metrics/R5: 33.74581939799331
 MSRVTT_full_test/t2v_metrics/R10: 46.48829431438127
 MSRVTT_full_test/t2v_metrics/R50: 77.95986622073579
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.54080267558528
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.532660488316225
 MSRVTT_full_test/v2t_metrics/R1: 13.377926421404682
 MSRVTT_full_test/v2t_metrics/R5: 38.2943143812709
 MSRVTT_full_test/v2t_metrics/R10: 53.41137123745819
 MSRVTT_full_test/v2t_metrics/R50: 84.58193979933111
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.04531772575251
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.133687240677588
 mnt_best       : 27.57112109266316
 not_improved_count: 1
Train Epoch: 15 [1/250 128/32000 (0%)] Loss: 1.52414 (QuantReg: 13.93040) QuantErr: 13.93040 batch_time=33.16319 
Train Epoch: 15 [12/250 1536/32000 (5%)] Loss: 1.12583 (QuantReg: 14.23211) QuantErr: 14.23211 batch_time=0.54253 
Train Epoch: 15 [23/250 2944/32000 (9%)] Loss: 1.07802 (QuantReg: 14.25939) QuantErr: 14.25939 batch_time=0.51411 
Train Epoch: 15 [34/250 4352/32000 (14%)] Loss: 1.36387 (QuantReg: 14.21986) QuantErr: 14.21986 batch_time=0.52804 
Train Epoch: 15 [45/250 5760/32000 (18%)] Loss: 1.19470 (QuantReg: 14.36109) QuantErr: 14.36109 batch_time=0.51299 
Train Epoch: 15 [56/250 7168/32000 (22%)] Loss: 1.52660 (QuantReg: 14.05234) QuantErr: 14.05234 batch_time=0.53382 
Train Epoch: 15 [67/250 8576/32000 (27%)] Loss: 1.62010 (QuantReg: 14.33631) QuantErr: 14.33631 batch_time=1.14578 
Train Epoch: 15 [78/250 9984/32000 (31%)] Loss: 0.97412 (QuantReg: 14.45049) QuantErr: 14.45049 batch_time=0.50402 
Train Epoch: 15 [89/250 11392/32000 (36%)] Loss: 1.51047 (QuantReg: 14.25784) QuantErr: 14.25784 batch_time=1.67238 
Train Epoch: 15 [100/250 12800/32000 (40%)] Loss: 1.30346 (QuantReg: 14.46433) QuantErr: 14.46433 batch_time=0.56749 
Train Epoch: 15 [111/250 14208/32000 (44%)] Loss: 1.55404 (QuantReg: 14.27022) QuantErr: 14.27022 batch_time=0.51086 
Train Epoch: 15 [122/250 15616/32000 (49%)] Loss: 1.02299 (QuantReg: 14.13624) QuantErr: 14.13624 batch_time=0.50025 
Train Epoch: 15 [133/250 17024/32000 (53%)] Loss: 1.19471 (QuantReg: 14.39443) QuantErr: 14.39443 batch_time=0.50966 
Train Epoch: 15 [144/250 18432/32000 (58%)] Loss: 1.37555 (QuantReg: 14.30704) QuantErr: 14.30704 batch_time=0.94756 
Train Epoch: 15 [155/250 19840/32000 (62%)] Loss: 1.22512 (QuantReg: 14.09487) QuantErr: 14.09487 batch_time=0.52822 
Train Epoch: 15 [166/250 21248/32000 (66%)] Loss: 1.37864 (QuantReg: 14.57727) QuantErr: 14.57727 batch_time=0.51377 
Train Epoch: 15 [177/250 22656/32000 (71%)] Loss: 1.32415 (QuantReg: 14.46058) QuantErr: 14.46058 batch_time=0.52513 
Train Epoch: 15 [188/250 24064/32000 (75%)] Loss: 1.16502 (QuantReg: 14.50969) QuantErr: 14.50969 batch_time=0.51985 
Train Epoch: 15 [199/250 25472/32000 (80%)] Loss: 1.06732 (QuantReg: 14.57021) QuantErr: 14.57021 batch_time=0.65586 
Train Epoch: 15 [210/250 26880/32000 (84%)] Loss: 1.40057 (QuantReg: 14.23043) QuantErr: 14.23043 batch_time=0.52007 
Train Epoch: 15 [221/250 28288/32000 (88%)] Loss: 1.43621 (QuantReg: 14.58199) QuantErr: 14.58199 batch_time=0.53356 
Train Epoch: 15 [232/250 29696/32000 (93%)] Loss: 1.39455 (QuantReg: 14.55030) QuantErr: 14.55030 batch_time=0.50741 
Train Epoch: 15 [243/250 31104/32000 (97%)] Loss: 1.29132 (QuantReg: 14.15588) QuantErr: 14.15588 batch_time=0.51057 
Train Epoch: 15 codebook_update_time=1.65914
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch15.pth ...
Done in 4.033s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch15.pth ...
Done in 8.300s
removing stale ckpt [epoch 14] [took 0.00s]
 epoch          : 15
 loss           : 1.2063311808109283
 quant_reg      : 14.394946002960205
 quant_err      : 14.394946002960205
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 3750
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.933601609657948
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.72870035369991
 MSRVTT_full_val/v2t_metrics/R1: 36.01609657947686
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.221327967806841
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.88442690312809
 MSRVTT_full_test/t2v_metrics/R1: 12.74247491638796
 MSRVTT_full_test/t2v_metrics/R5: 35.4180602006689
 MSRVTT_full_test/t2v_metrics/R10: 50.76923076923077
 MSRVTT_full_test/t2v_metrics/R50: 80.80267558528428
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.12040133779264
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.40270572107494
 MSRVTT_full_test/v2t_metrics/R1: 14.080267558528428
 MSRVTT_full_test/v2t_metrics/R5: 40.468227424749166
 MSRVTT_full_test/v2t_metrics/R10: 55.11705685618729
 MSRVTT_full_test/v2t_metrics/R50: 85.58528428093645
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.01923076923077
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.550315234356827
 mnt_best       : 28.40270572107494
 not_improved_count: 0
Train Epoch: 16 [1/250 128/32000 (0%)] Loss: 1.14015 (QuantReg: 14.11074) QuantErr: 14.11074 batch_time=33.32494 
Train Epoch: 16 [12/250 1536/32000 (5%)] Loss: 1.12564 (QuantReg: 14.60899) QuantErr: 14.60899 batch_time=0.51433 
Train Epoch: 16 [23/250 2944/32000 (9%)] Loss: 1.36375 (QuantReg: 14.31919) QuantErr: 14.31919 batch_time=1.59756 
Train Epoch: 16 [34/250 4352/32000 (14%)] Loss: 1.02083 (QuantReg: 14.50081) QuantErr: 14.50081 batch_time=0.51676 
Train Epoch: 16 [45/250 5760/32000 (18%)] Loss: 1.11237 (QuantReg: 14.48205) QuantErr: 14.48205 batch_time=0.52293 
Train Epoch: 16 [56/250 7168/32000 (22%)] Loss: 1.30515 (QuantReg: 14.24771) QuantErr: 14.24771 batch_time=0.50341 
Train Epoch: 16 [67/250 8576/32000 (27%)] Loss: 1.29634 (QuantReg: 14.71136) QuantErr: 14.71136 batch_time=0.52336 
Train Epoch: 16 [78/250 9984/32000 (31%)] Loss: 1.08059 (QuantReg: 14.42943) QuantErr: 14.42943 batch_time=0.51664 
Train Epoch: 16 [89/250 11392/32000 (36%)] Loss: 1.12575 (QuantReg: 14.71898) QuantErr: 14.71898 batch_time=0.52710 
Train Epoch: 16 [100/250 12800/32000 (40%)] Loss: 0.99347 (QuantReg: 14.66437) QuantErr: 14.66437 batch_time=0.54387 
Train Epoch: 16 [111/250 14208/32000 (44%)] Loss: 1.36069 (QuantReg: 15.12825) QuantErr: 15.12825 batch_time=0.58191 
Train Epoch: 16 [122/250 15616/32000 (49%)] Loss: 1.26732 (QuantReg: 14.64848) QuantErr: 14.64848 batch_time=0.50018 
Train Epoch: 16 [133/250 17024/32000 (53%)] Loss: 1.43143 (QuantReg: 14.53520) QuantErr: 14.53520 batch_time=0.86149 
Train Epoch: 16 [144/250 18432/32000 (58%)] Loss: 0.97977 (QuantReg: 14.78213) QuantErr: 14.78213 batch_time=0.50976 
Train Epoch: 16 [155/250 19840/32000 (62%)] Loss: 1.11748 (QuantReg: 14.69895) QuantErr: 14.69895 batch_time=0.52023 
Train Epoch: 16 [166/250 21248/32000 (66%)] Loss: 1.19187 (QuantReg: 14.51307) QuantErr: 14.51307 batch_time=0.52026 
Train Epoch: 16 [177/250 22656/32000 (71%)] Loss: 1.21931 (QuantReg: 14.31055) QuantErr: 14.31055 batch_time=0.53112 
Train Epoch: 16 [188/250 24064/32000 (75%)] Loss: 0.87107 (QuantReg: 14.55420) QuantErr: 14.55420 batch_time=0.51002 
Train Epoch: 16 [199/250 25472/32000 (80%)] Loss: 1.23188 (QuantReg: 14.74849) QuantErr: 14.74849 batch_time=0.51762 
Train Epoch: 16 [210/250 26880/32000 (84%)] Loss: 1.14178 (QuantReg: 14.85642) QuantErr: 14.85642 batch_time=0.59454 
Train Epoch: 16 [221/250 28288/32000 (88%)] Loss: 0.95998 (QuantReg: 14.93270) QuantErr: 14.93270 batch_time=0.53040 
Train Epoch: 16 [232/250 29696/32000 (93%)] Loss: 1.14014 (QuantReg: 14.41719) QuantErr: 14.41719 batch_time=0.51325 
Train Epoch: 16 [243/250 31104/32000 (97%)] Loss: 1.15560 (QuantReg: 14.83085) QuantErr: 14.83085 batch_time=0.56785 
Train Epoch: 16 codebook_update_time=1.68117
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch16.pth ...
Done in 3.822s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch16.pth ...
Done in 7.579s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 1.1869946722984315
 quant_reg      : 14.55491015625
 quant_err      : 14.55491015625
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.448692152917505
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.08626271287999
 MSRVTT_full_val/v2t_metrics/R1: 38.028169014084504
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.627766599597585
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.702488755662635
 MSRVTT_full_test/t2v_metrics/R1: 13.244147157190636
 MSRVTT_full_test/t2v_metrics/R5: 37.22408026755853
 MSRVTT_full_test/t2v_metrics/R10: 50.33444816053512
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 39.76923076923077
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.167850706056257
 MSRVTT_full_test/v2t_metrics/R1: 15.150501672240802
 MSRVTT_full_test/v2t_metrics/R5: 41.27090301003344
 MSRVTT_full_test/v2t_metrics/R10: 56.42140468227425
 MSRVTT_full_test/v2t_metrics/R50: 85.41806020066889
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.705183946488294
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.797315158022826
 mnt_best       : 29.167850706056257
 not_improved_count: 0
Train Epoch: 17 [1/250 128/32000 (0%)] Loss: 1.08115 (QuantReg: 14.24253) QuantErr: 14.24253 batch_time=37.38708 
Train Epoch: 17 [12/250 1536/32000 (5%)] Loss: 1.29968 (QuantReg: 14.37054) QuantErr: 14.37054 batch_time=0.50603 
Train Epoch: 17 [23/250 2944/32000 (9%)] Loss: 1.08648 (QuantReg: 14.42526) QuantErr: 14.42526 batch_time=0.51665 
Train Epoch: 17 [34/250 4352/32000 (14%)] Loss: 0.96268 (QuantReg: 14.46453) QuantErr: 14.46453 batch_time=0.50574 
Train Epoch: 17 [45/250 5760/32000 (18%)] Loss: 1.32959 (QuantReg: 14.55111) QuantErr: 14.55111 batch_time=0.50843 
Train Epoch: 17 [56/250 7168/32000 (22%)] Loss: 1.04275 (QuantReg: 14.42172) QuantErr: 14.42172 batch_time=0.51737 
Train Epoch: 17 [67/250 8576/32000 (27%)] Loss: 0.84057 (QuantReg: 14.89284) QuantErr: 14.89284 batch_time=0.64494 
Train Epoch: 17 [78/250 9984/32000 (31%)] Loss: 1.32903 (QuantReg: 14.63833) QuantErr: 14.63833 batch_time=0.51798 
Train Epoch: 17 [89/250 11392/32000 (36%)] Loss: 1.01973 (QuantReg: 14.90652) QuantErr: 14.90652 batch_time=0.52909 
Train Epoch: 17 [100/250 12800/32000 (40%)] Loss: 1.14300 (QuantReg: 14.81841) QuantErr: 14.81841 batch_time=0.88362 
Train Epoch: 17 [111/250 14208/32000 (44%)] Loss: 1.09883 (QuantReg: 14.61087) QuantErr: 14.61087 batch_time=0.50799 
Train Epoch: 17 [122/250 15616/32000 (49%)] Loss: 1.18283 (QuantReg: 14.30366) QuantErr: 14.30366 batch_time=0.50756 
Train Epoch: 17 [133/250 17024/32000 (53%)] Loss: 0.96507 (QuantReg: 14.56871) QuantErr: 14.56871 batch_time=0.51644 
Train Epoch: 17 [144/250 18432/32000 (58%)] Loss: 1.64472 (QuantReg: 14.53598) QuantErr: 14.53598 batch_time=1.21059 
Train Epoch: 17 [155/250 19840/32000 (62%)] Loss: 1.11526 (QuantReg: 14.86455) QuantErr: 14.86455 batch_time=0.56605 
Train Epoch: 17 [166/250 21248/32000 (66%)] Loss: 0.93176 (QuantReg: 14.33688) QuantErr: 14.33688 batch_time=0.50598 
Train Epoch: 17 [177/250 22656/32000 (71%)] Loss: 1.01445 (QuantReg: 14.67972) QuantErr: 14.67972 batch_time=0.53816 
Train Epoch: 17 [188/250 24064/32000 (75%)] Loss: 1.03749 (QuantReg: 14.76098) QuantErr: 14.76098 batch_time=0.50352 
Train Epoch: 17 [199/250 25472/32000 (80%)] Loss: 1.31726 (QuantReg: 14.99365) QuantErr: 14.99365 batch_time=0.50614 
Train Epoch: 17 [210/250 26880/32000 (84%)] Loss: 1.07869 (QuantReg: 15.04386) QuantErr: 15.04386 batch_time=0.51260 
Train Epoch: 17 [221/250 28288/32000 (88%)] Loss: 0.94285 (QuantReg: 14.75431) QuantErr: 14.75431 batch_time=0.52024 
Train Epoch: 17 [232/250 29696/32000 (93%)] Loss: 1.17806 (QuantReg: 15.17875) QuantErr: 15.17875 batch_time=0.97377 
Train Epoch: 17 [243/250 31104/32000 (97%)] Loss: 1.14740 (QuantReg: 14.99329) QuantErr: 14.99329 batch_time=0.50655 
Train Epoch: 17 codebook_update_time=1.66822
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch17.pth ...
Done in 3.780s
removing stale ckpt [epoch 16] [took 0.00s]
 epoch          : 17
 loss           : 1.1247402217388154
 quant_reg      : 14.688026969909668
 quant_err      : 14.688026969909668
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 4250
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.696177062374246
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.64322397153723
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.062374245472837
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.805826527896386
 MSRVTT_full_test/t2v_metrics/R1: 12.107023411371237
 MSRVTT_full_test/t2v_metrics/R5: 35.05016722408027
 MSRVTT_full_test/t2v_metrics/R10: 48.561872909699
 MSRVTT_full_test/t2v_metrics/R50: 79.83277591973244
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.94882943143813
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.41622368974405
 MSRVTT_full_test/v2t_metrics/R1: 14.481605351170568
 MSRVTT_full_test/v2t_metrics/R5: 40.76923076923077
 MSRVTT_full_test/v2t_metrics/R10: 55.785953177257525
 MSRVTT_full_test/v2t_metrics/R50: 85.51839464882943
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.962709030100335
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.0546737554319
 mnt_best       : 29.167850706056257
 not_improved_count: 1
Train Epoch: 18 [1/250 128/32000 (0%)] Loss: 1.15280 (QuantReg: 14.71646) QuantErr: 14.71646 batch_time=37.28721 
Train Epoch: 18 [12/250 1536/32000 (5%)] Loss: 1.27681 (QuantReg: 14.69401) QuantErr: 14.69401 batch_time=0.51263 
Train Epoch: 18 [23/250 2944/32000 (9%)] Loss: 1.03115 (QuantReg: 14.53836) QuantErr: 14.53836 batch_time=0.53499 
Train Epoch: 18 [34/250 4352/32000 (14%)] Loss: 1.09610 (QuantReg: 14.42389) QuantErr: 14.42389 batch_time=0.73234 
Train Epoch: 18 [45/250 5760/32000 (18%)] Loss: 1.18832 (QuantReg: 14.50923) QuantErr: 14.50923 batch_time=0.51105 
Train Epoch: 18 [56/250 7168/32000 (22%)] Loss: 1.11001 (QuantReg: 14.68563) QuantErr: 14.68563 batch_time=0.54106 
Train Epoch: 18 [67/250 8576/32000 (27%)] Loss: 1.43681 (QuantReg: 14.64087) QuantErr: 14.64087 batch_time=0.51043 
Train Epoch: 18 [78/250 9984/32000 (31%)] Loss: 1.18867 (QuantReg: 14.68440) QuantErr: 14.68440 batch_time=0.50015 
Train Epoch: 18 [89/250 11392/32000 (36%)] Loss: 0.91309 (QuantReg: 14.52930) QuantErr: 14.52930 batch_time=0.54219 
Train Epoch: 18 [100/250 12800/32000 (40%)] Loss: 1.03748 (QuantReg: 14.74716) QuantErr: 14.74716 batch_time=1.29321 
Train Epoch: 18 [111/250 14208/32000 (44%)] Loss: 0.98006 (QuantReg: 14.71742) QuantErr: 14.71742 batch_time=0.50242 
Train Epoch: 18 [122/250 15616/32000 (49%)] Loss: 1.43381 (QuantReg: 14.49988) QuantErr: 14.49988 batch_time=0.51613 
Train Epoch: 18 [133/250 17024/32000 (53%)] Loss: 1.45359 (QuantReg: 14.98404) QuantErr: 14.98404 batch_time=0.50308 
Train Epoch: 18 [144/250 18432/32000 (58%)] Loss: 1.01588 (QuantReg: 14.73481) QuantErr: 14.73481 batch_time=0.50762 
Train Epoch: 18 [155/250 19840/32000 (62%)] Loss: 1.13110 (QuantReg: 15.00533) QuantErr: 15.00533 batch_time=0.52889 
Train Epoch: 18 [166/250 21248/32000 (66%)] Loss: 1.38639 (QuantReg: 14.88729) QuantErr: 14.88729 batch_time=0.50197 
Train Epoch: 18 [177/250 22656/32000 (71%)] Loss: 1.04148 (QuantReg: 14.94428) QuantErr: 14.94428 batch_time=0.53383 
Train Epoch: 18 [188/250 24064/32000 (75%)] Loss: 0.85824 (QuantReg: 15.01385) QuantErr: 15.01385 batch_time=0.51452 
Train Epoch: 18 [199/250 25472/32000 (80%)] Loss: 1.01242 (QuantReg: 14.79202) QuantErr: 14.79202 batch_time=0.51473 
Train Epoch: 18 [210/250 26880/32000 (84%)] Loss: 1.36675 (QuantReg: 14.86843) QuantErr: 14.86843 batch_time=0.50569 
Train Epoch: 18 [221/250 28288/32000 (88%)] Loss: 1.06521 (QuantReg: 14.83928) QuantErr: 14.83928 batch_time=0.51974 
Train Epoch: 18 [232/250 29696/32000 (93%)] Loss: 0.68903 (QuantReg: 14.99168) QuantErr: 14.99168 batch_time=1.33705 
Train Epoch: 18 [243/250 31104/32000 (97%)] Loss: 0.91883 (QuantReg: 15.10513) QuantErr: 15.10513 batch_time=0.57349 
Train Epoch: 18 codebook_update_time=1.79090
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch18.pth ...
Done in 4.452s
removing stale ckpt [epoch 17] [took 0.01s]
 epoch          : 18
 loss           : 1.0764820563793183
 quant_reg      : 14.759714859008788
 quant_err      : 14.759714859008788
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.826961770623742
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.886899238711436
 MSRVTT_full_val/v2t_metrics/R1: 36.61971830985915
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 99.3963782696177
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.51307847082495
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.6155605548654
 MSRVTT_full_test/t2v_metrics/R1: 12.14046822742475
 MSRVTT_full_test/t2v_metrics/R5: 35.68561872909699
 MSRVTT_full_test/t2v_metrics/R10: 48.82943143812709
 MSRVTT_full_test/t2v_metrics/R50: 80.06688963210702
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.905351170568565
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.65689654112172
 MSRVTT_full_test/v2t_metrics/R1: 14.31438127090301
 MSRVTT_full_test/v2t_metrics/R5: 40.50167224080268
 MSRVTT_full_test/v2t_metrics/R10: 55.51839464882943
 MSRVTT_full_test/v2t_metrics/R50: 85.75250836120401
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.86889632107024
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.809790712226597
 mnt_best       : 29.167850706056257
 not_improved_count: 2
Train Epoch: 19 [1/250 128/32000 (0%)] Loss: 0.99827 (QuantReg: 14.74317) QuantErr: 14.74317 batch_time=34.83104 
Train Epoch: 19 [12/250 1536/32000 (5%)] Loss: 1.01795 (QuantReg: 14.80152) QuantErr: 14.80152 batch_time=0.59123 
Train Epoch: 19 [23/250 2944/32000 (9%)] Loss: 1.23033 (QuantReg: 14.49195) QuantErr: 14.49195 batch_time=0.53445 
Train Epoch: 19 [34/250 4352/32000 (14%)] Loss: 1.06888 (QuantReg: 14.83167) QuantErr: 14.83167 batch_time=0.52604 
Train Epoch: 19 [45/250 5760/32000 (18%)] Loss: 0.98192 (QuantReg: 14.91051) QuantErr: 14.91051 batch_time=0.50366 
Train Epoch: 19 [56/250 7168/32000 (22%)] Loss: 1.16000 (QuantReg: 14.92126) QuantErr: 14.92126 batch_time=0.51107 
Train Epoch: 19 [67/250 8576/32000 (27%)] Loss: 1.01056 (QuantReg: 14.75498) QuantErr: 14.75498 batch_time=0.51520 
Train Epoch: 19 [78/250 9984/32000 (31%)] Loss: 1.29660 (QuantReg: 14.94460) QuantErr: 14.94460 batch_time=0.50453 
Train Epoch: 19 [89/250 11392/32000 (36%)] Loss: 1.12325 (QuantReg: 14.59085) QuantErr: 14.59085 batch_time=0.53630 
Train Epoch: 19 [100/250 12800/32000 (40%)] Loss: 1.09401 (QuantReg: 15.05604) QuantErr: 15.05604 batch_time=0.53018 
Train Epoch: 19 [111/250 14208/32000 (44%)] Loss: 0.85748 (QuantReg: 15.13736) QuantErr: 15.13736 batch_time=0.52082 
Train Epoch: 19 [122/250 15616/32000 (49%)] Loss: 1.09160 (QuantReg: 15.14093) QuantErr: 15.14093 batch_time=0.51912 
Train Epoch: 19 [133/250 17024/32000 (53%)] Loss: 1.17511 (QuantReg: 14.90985) QuantErr: 14.90985 batch_time=0.56850 
Train Epoch: 19 [144/250 18432/32000 (58%)] Loss: 0.77014 (QuantReg: 14.75482) QuantErr: 14.75482 batch_time=0.51503 
Train Epoch: 19 [155/250 19840/32000 (62%)] Loss: 1.23141 (QuantReg: 15.03089) QuantErr: 15.03089 batch_time=0.54282 
Train Epoch: 19 [166/250 21248/32000 (66%)] Loss: 0.73805 (QuantReg: 14.72744) QuantErr: 14.72744 batch_time=0.51362 
Train Epoch: 19 [177/250 22656/32000 (71%)] Loss: 1.13136 (QuantReg: 15.00104) QuantErr: 15.00104 batch_time=0.52957 
Train Epoch: 19 [188/250 24064/32000 (75%)] Loss: 1.16453 (QuantReg: 14.86610) QuantErr: 14.86610 batch_time=0.60253 
Train Epoch: 19 [199/250 25472/32000 (80%)] Loss: 1.02879 (QuantReg: 14.92262) QuantErr: 14.92262 batch_time=0.52153 
Train Epoch: 19 [210/250 26880/32000 (84%)] Loss: 0.70730 (QuantReg: 15.17178) QuantErr: 15.17178 batch_time=0.53668 
Train Epoch: 19 [221/250 28288/32000 (88%)] Loss: 0.81240 (QuantReg: 15.11202) QuantErr: 15.11202 batch_time=0.57350 
Train Epoch: 19 [232/250 29696/32000 (93%)] Loss: 0.81512 (QuantReg: 14.99130) QuantErr: 14.99130 batch_time=0.52411 
Train Epoch: 19 [243/250 31104/32000 (97%)] Loss: 0.98238 (QuantReg: 15.00480) QuantErr: 15.00480 batch_time=0.51478 
Train Epoch: 19 codebook_update_time=1.79890
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch19.pth ...
Done in 17.749s
removing stale ckpt [epoch 18] [took 0.10s]
 epoch          : 19
 loss           : 1.0518959176540374
 quant_reg      : 14.887351947784424
 quant_err      : 14.887351947784424
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 4750
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 67.00201207243461
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.879275653923541
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.10979883137706
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.989939637826962
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.389752071758
 MSRVTT_full_test/t2v_metrics/R1: 12.040133779264215
 MSRVTT_full_test/t2v_metrics/R5: 35.05016722408027
 MSRVTT_full_test/t2v_metrics/R10: 48.59531772575251
 MSRVTT_full_test/t2v_metrics/R50: 79.36454849498328
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.2247491638796
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.37192098117146
 MSRVTT_full_test/v2t_metrics/R1: 15.050167224080267
 MSRVTT_full_test/v2t_metrics/R5: 41.03678929765886
 MSRVTT_full_test/v2t_metrics/R10: 56.220735785953174
 MSRVTT_full_test/v2t_metrics/R50: 85.78595317725753
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.086454849498324
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.62398997570848
 mnt_best       : 29.167850706056257
 not_improved_count: 3
Train Epoch: 20 [1/250 128/32000 (0%)] Loss: 1.11364 (QuantReg: 14.68868) QuantErr: 14.68868 batch_time=35.79354 
Train Epoch: 20 [12/250 1536/32000 (5%)] Loss: 1.18109 (QuantReg: 14.84031) QuantErr: 14.84031 batch_time=0.49737 
Train Epoch: 20 [23/250 2944/32000 (9%)] Loss: 1.06011 (QuantReg: 14.71311) QuantErr: 14.71311 batch_time=0.49984 
Train Epoch: 20 [34/250 4352/32000 (14%)] Loss: 0.95623 (QuantReg: 15.18576) QuantErr: 15.18576 batch_time=0.53721 
Train Epoch: 20 [45/250 5760/32000 (18%)] Loss: 1.22685 (QuantReg: 15.11294) QuantErr: 15.11294 batch_time=0.86754 
Train Epoch: 20 [56/250 7168/32000 (22%)] Loss: 1.06684 (QuantReg: 14.78510) QuantErr: 14.78510 batch_time=0.56378 
Train Epoch: 20 [67/250 8576/32000 (27%)] Loss: 0.99734 (QuantReg: 15.22428) QuantErr: 15.22428 batch_time=0.49675 
Train Epoch: 20 [78/250 9984/32000 (31%)] Loss: 0.90575 (QuantReg: 14.89783) QuantErr: 14.89783 batch_time=0.53601 
Train Epoch: 20 [89/250 11392/32000 (36%)] Loss: 1.32784 (QuantReg: 14.70013) QuantErr: 14.70013 batch_time=0.53924 
Train Epoch: 20 [100/250 12800/32000 (40%)] Loss: 0.99448 (QuantReg: 15.21436) QuantErr: 15.21436 batch_time=0.52065 
Train Epoch: 20 [111/250 14208/32000 (44%)] Loss: 0.95283 (QuantReg: 15.26111) QuantErr: 15.26111 batch_time=0.55876 
Train Epoch: 20 [122/250 15616/32000 (49%)] Loss: 0.75530 (QuantReg: 14.97293) QuantErr: 14.97293 batch_time=0.52113 
Train Epoch: 20 [133/250 17024/32000 (53%)] Loss: 1.17201 (QuantReg: 14.92442) QuantErr: 14.92442 batch_time=0.49977 
Train Epoch: 20 [144/250 18432/32000 (58%)] Loss: 1.20010 (QuantReg: 14.94155) QuantErr: 14.94155 batch_time=0.50754 
Train Epoch: 20 [155/250 19840/32000 (62%)] Loss: 1.24051 (QuantReg: 14.66883) QuantErr: 14.66883 batch_time=0.64502 
Train Epoch: 20 [166/250 21248/32000 (66%)] Loss: 1.31836 (QuantReg: 15.09877) QuantErr: 15.09877 batch_time=0.51496 
Train Epoch: 20 [177/250 22656/32000 (71%)] Loss: 0.92081 (QuantReg: 15.36550) QuantErr: 15.36550 batch_time=0.52206 
Train Epoch: 20 [188/250 24064/32000 (75%)] Loss: 0.84428 (QuantReg: 15.37300) QuantErr: 15.37300 batch_time=0.54639 
Train Epoch: 20 [199/250 25472/32000 (80%)] Loss: 0.83835 (QuantReg: 14.78513) QuantErr: 14.78513 batch_time=1.32786 
Train Epoch: 20 [210/250 26880/32000 (84%)] Loss: 1.35047 (QuantReg: 14.68263) QuantErr: 14.68263 batch_time=0.52213 
Train Epoch: 20 [221/250 28288/32000 (88%)] Loss: 1.46351 (QuantReg: 14.70525) QuantErr: 14.70525 batch_time=0.51762 
Train Epoch: 20 [232/250 29696/32000 (93%)] Loss: 0.95663 (QuantReg: 15.04986) QuantErr: 15.04986 batch_time=1.68554 
Train Epoch: 20 [243/250 31104/32000 (97%)] Loss: 0.75547 (QuantReg: 15.49776) QuantErr: 15.49776 batch_time=0.55465 
Train Epoch: 20 codebook_update_time=1.77862
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch20.pth ...
Done in 12.918s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 1.0300509622097016
 quant_reg      : 14.96867242050171
 quant_err      : 14.96867242050171
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.303822937625754
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.22863650252017
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.577464788732394
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.62731405287191
 MSRVTT_full_test/t2v_metrics/R1: 12.74247491638796
 MSRVTT_full_test/t2v_metrics/R5: 36.12040133779264
 MSRVTT_full_test/t2v_metrics/R10: 50.2675585284281
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.73511705685619
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.494741114100528
 MSRVTT_full_test/v2t_metrics/R1: 14.983277591973245
 MSRVTT_full_test/v2t_metrics/R5: 41.67224080267559
 MSRVTT_full_test/v2t_metrics/R10: 56.2876254180602
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.30836120401338
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.75584965619502
 mnt_best       : 29.167850706056257
 not_improved_count: 4
Train Epoch: 21 [1/250 128/32000 (0%)] Loss: 0.88219 (QuantReg: 14.71282) QuantErr: 14.71282 batch_time=37.79226 
Train Epoch: 21 [12/250 1536/32000 (5%)] Loss: 0.99802 (QuantReg: 15.07703) QuantErr: 15.07703 batch_time=0.50689 
Train Epoch: 21 [23/250 2944/32000 (9%)] Loss: 1.09192 (QuantReg: 14.77371) QuantErr: 14.77371 batch_time=0.53962 
Train Epoch: 21 [34/250 4352/32000 (14%)] Loss: 0.89471 (QuantReg: 15.23071) QuantErr: 15.23071 batch_time=0.49683 
Train Epoch: 21 [45/250 5760/32000 (18%)] Loss: 0.74352 (QuantReg: 14.88121) QuantErr: 14.88121 batch_time=0.51470 
Train Epoch: 21 [56/250 7168/32000 (22%)] Loss: 0.72040 (QuantReg: 15.43949) QuantErr: 15.43949 batch_time=0.50217 
Train Epoch: 21 [67/250 8576/32000 (27%)] Loss: 1.09862 (QuantReg: 14.90139) QuantErr: 14.90139 batch_time=0.50490 
Train Epoch: 21 [78/250 9984/32000 (31%)] Loss: 1.23799 (QuantReg: 14.79056) QuantErr: 14.79056 batch_time=0.49792 
Train Epoch: 21 [89/250 11392/32000 (36%)] Loss: 1.13700 (QuantReg: 15.01719) QuantErr: 15.01719 batch_time=0.53027 
Train Epoch: 21 [100/250 12800/32000 (40%)] Loss: 1.13099 (QuantReg: 14.71630) QuantErr: 14.71630 batch_time=0.50972 
Train Epoch: 21 [111/250 14208/32000 (44%)] Loss: 0.95168 (QuantReg: 14.87416) QuantErr: 14.87416 batch_time=0.52453 
Train Epoch: 21 [122/250 15616/32000 (49%)] Loss: 0.94227 (QuantReg: 15.22579) QuantErr: 15.22579 batch_time=0.55411 
Train Epoch: 21 [133/250 17024/32000 (53%)] Loss: 0.81576 (QuantReg: 14.97811) QuantErr: 14.97811 batch_time=0.56388 
Train Epoch: 21 [144/250 18432/32000 (58%)] Loss: 1.07844 (QuantReg: 15.18257) QuantErr: 15.18257 batch_time=0.51839 
Train Epoch: 21 [155/250 19840/32000 (62%)] Loss: 1.09016 (QuantReg: 14.94589) QuantErr: 14.94589 batch_time=0.56439 
Train Epoch: 21 [166/250 21248/32000 (66%)] Loss: 0.82085 (QuantReg: 15.30415) QuantErr: 15.30415 batch_time=0.52157 
Train Epoch: 21 [177/250 22656/32000 (71%)] Loss: 1.15254 (QuantReg: 15.43667) QuantErr: 15.43667 batch_time=0.50846 
Train Epoch: 21 [188/250 24064/32000 (75%)] Loss: 0.88795 (QuantReg: 14.95394) QuantErr: 14.95394 batch_time=0.51818 
Train Epoch: 21 [199/250 25472/32000 (80%)] Loss: 1.06413 (QuantReg: 15.22336) QuantErr: 15.22336 batch_time=1.65847 
Train Epoch: 21 [210/250 26880/32000 (84%)] Loss: 1.19969 (QuantReg: 14.96173) QuantErr: 14.96173 batch_time=0.50324 
Train Epoch: 21 [221/250 28288/32000 (88%)] Loss: 1.02276 (QuantReg: 15.34186) QuantErr: 15.34186 batch_time=0.51785 
Train Epoch: 21 [232/250 29696/32000 (93%)] Loss: 0.95224 (QuantReg: 15.50491) QuantErr: 15.50491 batch_time=0.51665 
Train Epoch: 21 [243/250 31104/32000 (97%)] Loss: 0.72989 (QuantReg: 15.05896) QuantErr: 15.05896 batch_time=0.52840 
Train Epoch: 21 codebook_update_time=2.79846
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch21.pth ...
Done in 4.059s
removing stale ckpt [epoch 20] [took 0.00s]
 epoch          : 21
 loss           : 0.994107204914093
 quant_reg      : 15.046250076293946
 quant_err      : 15.046250076293946
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 5250
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.782696177062374
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.196429902434076
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.545271629778672
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.75359576207574
 MSRVTT_full_test/t2v_metrics/R1: 12.307692307692308
 MSRVTT_full_test/t2v_metrics/R5: 34.5819397993311
 MSRVTT_full_test/t2v_metrics/R10: 48.929765886287626
 MSRVTT_full_test/t2v_metrics/R50: 78.96321070234114
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.293645484949835
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.51268903454108
 MSRVTT_full_test/v2t_metrics/R1: 14.247491638795987
 MSRVTT_full_test/v2t_metrics/R5: 40.5685618729097
 MSRVTT_full_test/v2t_metrics/R10: 54.71571906354515
 MSRVTT_full_test/v2t_metrics/R50: 85.15050167224081
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.40903010033445
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.623750732213356
 mnt_best       : 29.167850706056257
 not_improved_count: 5
Train Epoch: 22 [1/250 128/32000 (0%)] Loss: 1.08301 (QuantReg: 14.74937) QuantErr: 14.74937 batch_time=44.50912 
Train Epoch: 22 [12/250 1536/32000 (5%)] Loss: 1.05536 (QuantReg: 15.04367) QuantErr: 15.04367 batch_time=0.51363 
Train Epoch: 22 [23/250 2944/32000 (9%)] Loss: 0.90010 (QuantReg: 14.93180) QuantErr: 14.93180 batch_time=0.64684 
Train Epoch: 22 [34/250 4352/32000 (14%)] Loss: 0.85072 (QuantReg: 14.71546) QuantErr: 14.71546 batch_time=0.53821 
Train Epoch: 22 [45/250 5760/32000 (18%)] Loss: 0.82418 (QuantReg: 15.22423) QuantErr: 15.22423 batch_time=0.54155 
Train Epoch: 22 [56/250 7168/32000 (22%)] Loss: 0.89131 (QuantReg: 15.09506) QuantErr: 15.09506 batch_time=0.54383 
Train Epoch: 22 [67/250 8576/32000 (27%)] Loss: 1.12630 (QuantReg: 14.86544) QuantErr: 14.86544 batch_time=0.51742 
Train Epoch: 22 [78/250 9984/32000 (31%)] Loss: 0.99892 (QuantReg: 14.86953) QuantErr: 14.86953 batch_time=0.50971 
Train Epoch: 22 [89/250 11392/32000 (36%)] Loss: 1.15952 (QuantReg: 14.54354) QuantErr: 14.54354 batch_time=0.52303 
Train Epoch: 22 [100/250 12800/32000 (40%)] Loss: 0.98276 (QuantReg: 15.20782) QuantErr: 15.20782 batch_time=0.51335 
Train Epoch: 22 [111/250 14208/32000 (44%)] Loss: 1.22097 (QuantReg: 14.88124) QuantErr: 14.88124 batch_time=0.51698 
Train Epoch: 22 [122/250 15616/32000 (49%)] Loss: 0.95044 (QuantReg: 15.14523) QuantErr: 15.14523 batch_time=0.55927 
Train Epoch: 22 [133/250 17024/32000 (53%)] Loss: 1.02062 (QuantReg: 14.98363) QuantErr: 14.98363 batch_time=0.73305 
Train Epoch: 22 [144/250 18432/32000 (58%)] Loss: 1.15294 (QuantReg: 15.07353) QuantErr: 15.07353 batch_time=0.51988 
Train Epoch: 22 [155/250 19840/32000 (62%)] Loss: 0.94233 (QuantReg: 15.25478) QuantErr: 15.25478 batch_time=0.50433 
Train Epoch: 22 [166/250 21248/32000 (66%)] Loss: 1.12169 (QuantReg: 15.09331) QuantErr: 15.09331 batch_time=0.58014 
Train Epoch: 22 [177/250 22656/32000 (71%)] Loss: 1.09889 (QuantReg: 15.13705) QuantErr: 15.13705 batch_time=0.53727 
Train Epoch: 22 [188/250 24064/32000 (75%)] Loss: 0.99292 (QuantReg: 15.25557) QuantErr: 15.25557 batch_time=0.51296 
Train Epoch: 22 [199/250 25472/32000 (80%)] Loss: 1.00412 (QuantReg: 14.99486) QuantErr: 14.99486 batch_time=0.52543 
Train Epoch: 22 [210/250 26880/32000 (84%)] Loss: 0.98193 (QuantReg: 15.22152) QuantErr: 15.22152 batch_time=0.50116 
Train Epoch: 22 [221/250 28288/32000 (88%)] Loss: 0.95130 (QuantReg: 15.08689) QuantErr: 15.08689 batch_time=0.52125 
Train Epoch: 22 [232/250 29696/32000 (93%)] Loss: 0.97596 (QuantReg: 15.08822) QuantErr: 15.08822 batch_time=0.55736 
Train Epoch: 22 [243/250 31104/32000 (97%)] Loss: 0.76077 (QuantReg: 15.38774) QuantErr: 15.38774 batch_time=0.55929 
Train Epoch: 22 codebook_update_time=1.75229
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch22.pth ...
Done in 7.810s
removing stale ckpt [epoch 21] [took 0.00s]
 epoch          : 22
 loss           : 0.9653692934513092
 quant_reg      : 15.113958358764648
 quant_err      : 15.113958358764648
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.99195171026157
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.04540954266531
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.545271629778672
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.89136362263433
 MSRVTT_full_test/t2v_metrics/R1: 12.274247491638796
 MSRVTT_full_test/t2v_metrics/R5: 34.8494983277592
 MSRVTT_full_test/t2v_metrics/R10: 47.85953177257525
 MSRVTT_full_test/t2v_metrics/R50: 79.4648829431438
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.53745819397993
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.356043396014037
 MSRVTT_full_test/v2t_metrics/R1: 14.949832775919733
 MSRVTT_full_test/v2t_metrics/R5: 41.73913043478261
 MSRVTT_full_test/v2t_metrics/R10: 56.95652173913044
 MSRVTT_full_test/v2t_metrics/R50: 86.52173913043478
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.9056856187291
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.87817710060494
 mnt_best       : 29.167850706056257
 not_improved_count: 6
Train Epoch: 23 [1/250 128/32000 (0%)] Loss: 1.07088 (QuantReg: 14.73655) QuantErr: 14.73655 batch_time=41.57201 
Train Epoch: 23 [12/250 1536/32000 (5%)] Loss: 1.15223 (QuantReg: 15.40728) QuantErr: 15.40728 batch_time=0.55078 
Train Epoch: 23 [23/250 2944/32000 (9%)] Loss: 0.74162 (QuantReg: 15.13586) QuantErr: 15.13586 batch_time=0.50658 
Train Epoch: 23 [34/250 4352/32000 (14%)] Loss: 0.96583 (QuantReg: 15.01766) QuantErr: 15.01766 batch_time=0.58115 
Train Epoch: 23 [45/250 5760/32000 (18%)] Loss: 0.88624 (QuantReg: 15.01886) QuantErr: 15.01886 batch_time=0.50318 
Train Epoch: 23 [56/250 7168/32000 (22%)] Loss: 0.88857 (QuantReg: 15.17453) QuantErr: 15.17453 batch_time=0.52407 
Train Epoch: 23 [67/250 8576/32000 (27%)] Loss: 0.91094 (QuantReg: 15.11397) QuantErr: 15.11397 batch_time=1.39392 
Train Epoch: 23 [78/250 9984/32000 (31%)] Loss: 1.04265 (QuantReg: 15.18656) QuantErr: 15.18656 batch_time=1.72544 
Train Epoch: 23 [89/250 11392/32000 (36%)] Loss: 0.99781 (QuantReg: 14.85796) QuantErr: 14.85796 batch_time=0.55934 
Train Epoch: 23 [100/250 12800/32000 (40%)] Loss: 0.85197 (QuantReg: 15.24621) QuantErr: 15.24621 batch_time=0.52948 
Train Epoch: 23 [111/250 14208/32000 (44%)] Loss: 1.12258 (QuantReg: 15.20350) QuantErr: 15.20350 batch_time=0.52383 
Train Epoch: 23 [122/250 15616/32000 (49%)] Loss: 1.00672 (QuantReg: 15.03983) QuantErr: 15.03983 batch_time=0.50660 
Train Epoch: 23 [133/250 17024/32000 (53%)] Loss: 0.93174 (QuantReg: 15.09395) QuantErr: 15.09395 batch_time=0.74060 
Train Epoch: 23 [144/250 18432/32000 (58%)] Loss: 1.12339 (QuantReg: 15.35553) QuantErr: 15.35553 batch_time=0.51816 
Train Epoch: 23 [155/250 19840/32000 (62%)] Loss: 1.23860 (QuantReg: 15.23234) QuantErr: 15.23234 batch_time=0.50666 
Train Epoch: 23 [166/250 21248/32000 (66%)] Loss: 1.02535 (QuantReg: 15.04140) QuantErr: 15.04140 batch_time=0.50856 
Train Epoch: 23 [177/250 22656/32000 (71%)] Loss: 0.61975 (QuantReg: 15.59239) QuantErr: 15.59239 batch_time=0.51122 
Train Epoch: 23 [188/250 24064/32000 (75%)] Loss: 1.05884 (QuantReg: 15.35284) QuantErr: 15.35284 batch_time=0.50815 
Train Epoch: 23 [199/250 25472/32000 (80%)] Loss: 0.74917 (QuantReg: 15.68449) QuantErr: 15.68449 batch_time=0.52929 
Train Epoch: 23 [210/250 26880/32000 (84%)] Loss: 0.75992 (QuantReg: 15.41901) QuantErr: 15.41901 batch_time=0.50040 
Train Epoch: 23 [221/250 28288/32000 (88%)] Loss: 0.62270 (QuantReg: 15.55800) QuantErr: 15.55800 batch_time=0.51379 
Train Epoch: 23 [232/250 29696/32000 (93%)] Loss: 0.81819 (QuantReg: 15.33492) QuantErr: 15.33492 batch_time=0.51492 
Train Epoch: 23 [243/250 31104/32000 (97%)] Loss: 1.20147 (QuantReg: 14.74747) QuantErr: 14.74747 batch_time=0.51181 
Train Epoch: 23 codebook_update_time=1.83953
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch23.pth ...
Done in 4.358s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 0.9680070414543152
 quant_reg      : 15.188550323486329
 quant_err      : 15.188550323486329
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 5750
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.080482897384305
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.269222544685825
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.883299798792756
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.98890382945575
 MSRVTT_full_test/t2v_metrics/R1: 12.341137123745819
 MSRVTT_full_test/t2v_metrics/R5: 35.551839464882946
 MSRVTT_full_test/t2v_metrics/R10: 49.331103678929765
 MSRVTT_full_test/t2v_metrics/R50: 80.10033444816054
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.48494983277592
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.868442347284937
 MSRVTT_full_test/v2t_metrics/R1: 14.849498327759198
 MSRVTT_full_test/v2t_metrics/R5: 41.50501672240803
 MSRVTT_full_test/v2t_metrics/R10: 55.953177257525084
 MSRVTT_full_test/v2t_metrics/R50: 86.65551839464882
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.84933110367893
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.54960399335846
 mnt_best       : 29.167850706056257
 not_improved_count: 7
Train Epoch: 24 [1/250 128/32000 (0%)] Loss: 1.20167 (QuantReg: 14.86333) QuantErr: 14.86333 batch_time=36.80964 
Train Epoch: 24 [12/250 1536/32000 (5%)] Loss: 0.86176 (QuantReg: 15.15681) QuantErr: 15.15681 batch_time=0.52584 
Train Epoch: 24 [23/250 2944/32000 (9%)] Loss: 0.78487 (QuantReg: 15.32063) QuantErr: 15.32063 batch_time=0.53087 
Train Epoch: 24 [34/250 4352/32000 (14%)] Loss: 1.07321 (QuantReg: 15.31993) QuantErr: 15.31993 batch_time=0.51111 
Train Epoch: 24 [45/250 5760/32000 (18%)] Loss: 1.11964 (QuantReg: 14.91765) QuantErr: 14.91765 batch_time=0.50861 
Train Epoch: 24 [56/250 7168/32000 (22%)] Loss: 0.61824 (QuantReg: 15.30587) QuantErr: 15.30587 batch_time=0.51345 
Train Epoch: 24 [67/250 8576/32000 (27%)] Loss: 0.59285 (QuantReg: 15.50866) QuantErr: 15.50866 batch_time=1.42001 
Train Epoch: 24 [78/250 9984/32000 (31%)] Loss: 0.87787 (QuantReg: 15.22406) QuantErr: 15.22406 batch_time=0.52701 
Train Epoch: 24 [89/250 11392/32000 (36%)] Loss: 0.77131 (QuantReg: 15.20734) QuantErr: 15.20734 batch_time=0.51539 
Train Epoch: 24 [100/250 12800/32000 (40%)] Loss: 0.88122 (QuantReg: 15.26997) QuantErr: 15.26997 batch_time=0.54859 
Train Epoch: 24 [111/250 14208/32000 (44%)] Loss: 1.17587 (QuantReg: 15.07680) QuantErr: 15.07680 batch_time=0.51305 
Train Epoch: 24 [122/250 15616/32000 (49%)] Loss: 1.05647 (QuantReg: 15.04338) QuantErr: 15.04338 batch_time=0.53572 
Train Epoch: 24 [133/250 17024/32000 (53%)] Loss: 0.80471 (QuantReg: 15.33008) QuantErr: 15.33008 batch_time=0.52361 
Train Epoch: 24 [144/250 18432/32000 (58%)] Loss: 1.30648 (QuantReg: 15.52603) QuantErr: 15.52603 batch_time=0.73367 
Train Epoch: 24 [155/250 19840/32000 (62%)] Loss: 0.92818 (QuantReg: 14.93282) QuantErr: 14.93282 batch_time=0.54075 
Train Epoch: 24 [166/250 21248/32000 (66%)] Loss: 0.70984 (QuantReg: 15.48723) QuantErr: 15.48723 batch_time=0.52857 
Train Epoch: 24 [177/250 22656/32000 (71%)] Loss: 0.74828 (QuantReg: 15.55713) QuantErr: 15.55713 batch_time=0.52758 
Train Epoch: 24 [188/250 24064/32000 (75%)] Loss: 0.75673 (QuantReg: 15.35392) QuantErr: 15.35392 batch_time=0.52091 
Train Epoch: 24 [199/250 25472/32000 (80%)] Loss: 0.90326 (QuantReg: 15.05811) QuantErr: 15.05811 batch_time=0.50871 
Train Epoch: 24 [210/250 26880/32000 (84%)] Loss: 0.71808 (QuantReg: 15.57653) QuantErr: 15.57653 batch_time=0.51256 
Train Epoch: 24 [221/250 28288/32000 (88%)] Loss: 1.20598 (QuantReg: 15.06582) QuantErr: 15.06582 batch_time=0.51090 
Train Epoch: 24 [232/250 29696/32000 (93%)] Loss: 1.16400 (QuantReg: 15.31400) QuantErr: 15.31400 batch_time=0.54093 
Train Epoch: 24 [243/250 31104/32000 (97%)] Loss: 0.91281 (QuantReg: 15.24326) QuantErr: 15.24326 batch_time=0.52908 
Train Epoch: 24 codebook_update_time=1.68444
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch24.pth ...
Done in 11.397s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 0.9181335773468018
 quant_reg      : 15.288576347351075
 quant_err      : 15.288576347351075
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.959758551307847
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.34390171907921
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.959758551307847
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.02649544546896
 MSRVTT_full_test/t2v_metrics/R1: 13.076923076923077
 MSRVTT_full_test/t2v_metrics/R5: 35.51839464882943
 MSRVTT_full_test/t2v_metrics/R10: 49.56521739130435
 MSRVTT_full_test/t2v_metrics/R50: 79.56521739130434
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.989297658862874
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.44757848397556
 MSRVTT_full_test/v2t_metrics/R1: 14.816053511705686
 MSRVTT_full_test/v2t_metrics/R5: 42.17391304347826
 MSRVTT_full_test/v2t_metrics/R10: 57.65886287625418
 MSRVTT_full_test/v2t_metrics/R50: 85.68561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.90050167224081
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.027890527534765
 mnt_best       : 29.167850706056257
 not_improved_count: 8
Train Epoch: 25 [1/250 128/32000 (0%)] Loss: 1.11583 (QuantReg: 15.10406) QuantErr: 15.10406 batch_time=33.06520 
Train Epoch: 25 [12/250 1536/32000 (5%)] Loss: 0.86873 (QuantReg: 15.16351) QuantErr: 15.16351 batch_time=0.53212 
Train Epoch: 25 [23/250 2944/32000 (9%)] Loss: 0.86119 (QuantReg: 15.62433) QuantErr: 15.62433 batch_time=0.55639 
Train Epoch: 25 [34/250 4352/32000 (14%)] Loss: 1.03350 (QuantReg: 15.08522) QuantErr: 15.08522 batch_time=0.51439 
Train Epoch: 25 [45/250 5760/32000 (18%)] Loss: 0.88383 (QuantReg: 15.12312) QuantErr: 15.12312 batch_time=0.50513 
Train Epoch: 25 [56/250 7168/32000 (22%)] Loss: 0.88831 (QuantReg: 15.29494) QuantErr: 15.29494 batch_time=0.60555 
Train Epoch: 25 [67/250 8576/32000 (27%)] Loss: 1.10914 (QuantReg: 15.05123) QuantErr: 15.05123 batch_time=2.49200 
Train Epoch: 25 [78/250 9984/32000 (31%)] Loss: 0.94312 (QuantReg: 15.41839) QuantErr: 15.41839 batch_time=0.51347 
Train Epoch: 25 [89/250 11392/32000 (36%)] Loss: 0.66675 (QuantReg: 15.49926) QuantErr: 15.49926 batch_time=0.51506 
Train Epoch: 25 [100/250 12800/32000 (40%)] Loss: 0.95979 (QuantReg: 15.25173) QuantErr: 15.25173 batch_time=0.52213 
Train Epoch: 25 [111/250 14208/32000 (44%)] Loss: 1.06944 (QuantReg: 15.09920) QuantErr: 15.09920 batch_time=0.50910 
Train Epoch: 25 [122/250 15616/32000 (49%)] Loss: 0.68836 (QuantReg: 15.32741) QuantErr: 15.32741 batch_time=0.49975 
Train Epoch: 25 [133/250 17024/32000 (53%)] Loss: 0.82589 (QuantReg: 15.31435) QuantErr: 15.31435 batch_time=0.82094 
Train Epoch: 25 [144/250 18432/32000 (58%)] Loss: 0.95433 (QuantReg: 15.35775) QuantErr: 15.35775 batch_time=0.52393 
Train Epoch: 25 [155/250 19840/32000 (62%)] Loss: 1.03539 (QuantReg: 15.38885) QuantErr: 15.38885 batch_time=0.51518 
Train Epoch: 25 [166/250 21248/32000 (66%)] Loss: 1.16824 (QuantReg: 15.02726) QuantErr: 15.02726 batch_time=0.51788 
Train Epoch: 25 [177/250 22656/32000 (71%)] Loss: 0.85965 (QuantReg: 15.40062) QuantErr: 15.40062 batch_time=0.52023 
Train Epoch: 25 [188/250 24064/32000 (75%)] Loss: 0.86034 (QuantReg: 15.70058) QuantErr: 15.70058 batch_time=0.52418 
Train Epoch: 25 [199/250 25472/32000 (80%)] Loss: 0.75658 (QuantReg: 15.45531) QuantErr: 15.45531 batch_time=0.53502 
Train Epoch: 25 [210/250 26880/32000 (84%)] Loss: 0.97649 (QuantReg: 15.23516) QuantErr: 15.23516 batch_time=0.51250 
Train Epoch: 25 [221/250 28288/32000 (88%)] Loss: 0.95299 (QuantReg: 15.31593) QuantErr: 15.31593 batch_time=0.53449 
Train Epoch: 25 [232/250 29696/32000 (93%)] Loss: 0.97569 (QuantReg: 15.31904) QuantErr: 15.31904 batch_time=0.51573 
Train Epoch: 25 [243/250 31104/32000 (97%)] Loss: 1.05761 (QuantReg: 15.19843) QuantErr: 15.19843 batch_time=0.52418 
Train Epoch: 25 codebook_update_time=1.91601
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch25.pth ...
Done in 4.436s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch25.pth ...
Done in 9.079s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 0.9293005900382996
 quant_reg      : 15.31930411529541
 quant_err      : 15.31930411529541
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 6250
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 98.79275653923541
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.468812877263582
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.90449641599657
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.5674044265593565
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.15906969618825
 MSRVTT_full_test/t2v_metrics/R1: 13.578595317725753
 MSRVTT_full_test/t2v_metrics/R5: 36.75585284280937
 MSRVTT_full_test/t2v_metrics/R10: 50.23411371237458
 MSRVTT_full_test/t2v_metrics/R50: 80.43478260869566
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.004347826086956
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.26802144441938
 MSRVTT_full_test/v2t_metrics/R1: 16.220735785953178
 MSRVTT_full_test/v2t_metrics/R5: 42.675585284280935
 MSRVTT_full_test/v2t_metrics/R10: 58.42809364548495
 MSRVTT_full_test/v2t_metrics/R50: 87.1571906354515
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.649163879598664
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.32605686956765
 mnt_best       : 29.26802144441938
 not_improved_count: 0
Train Epoch: 26 [1/250 128/32000 (0%)] Loss: 1.00419 (QuantReg: 15.15445) QuantErr: 15.15445 batch_time=46.68266 
Train Epoch: 26 [12/250 1536/32000 (5%)] Loss: 1.06321 (QuantReg: 14.96137) QuantErr: 14.96137 batch_time=0.52125 
Train Epoch: 26 [23/250 2944/32000 (9%)] Loss: 0.59196 (QuantReg: 15.50936) QuantErr: 15.50936 batch_time=0.50655 
Train Epoch: 26 [34/250 4352/32000 (14%)] Loss: 0.84333 (QuantReg: 15.25859) QuantErr: 15.25859 batch_time=0.51173 
Train Epoch: 26 [45/250 5760/32000 (18%)] Loss: 0.83603 (QuantReg: 15.38070) QuantErr: 15.38070 batch_time=0.54551 
Train Epoch: 26 [56/250 7168/32000 (22%)] Loss: 1.01525 (QuantReg: 15.45967) QuantErr: 15.45967 batch_time=0.51328 
Train Epoch: 26 [67/250 8576/32000 (27%)] Loss: 0.82352 (QuantReg: 15.50976) QuantErr: 15.50976 batch_time=0.54322 
Train Epoch: 26 [78/250 9984/32000 (31%)] Loss: 1.02368 (QuantReg: 15.57250) QuantErr: 15.57250 batch_time=0.52215 
Train Epoch: 26 [89/250 11392/32000 (36%)] Loss: 0.82773 (QuantReg: 15.34837) QuantErr: 15.34837 batch_time=0.51701 
Train Epoch: 26 [100/250 12800/32000 (40%)] Loss: 0.79992 (QuantReg: 15.18580) QuantErr: 15.18580 batch_time=0.50718 
Train Epoch: 26 [111/250 14208/32000 (44%)] Loss: 0.81163 (QuantReg: 15.54451) QuantErr: 15.54451 batch_time=0.50853 
Train Epoch: 26 [122/250 15616/32000 (49%)] Loss: 0.74836 (QuantReg: 15.37173) QuantErr: 15.37173 batch_time=0.53161 
Train Epoch: 26 [133/250 17024/32000 (53%)] Loss: 0.71521 (QuantReg: 15.07134) QuantErr: 15.07134 batch_time=0.81582 
Train Epoch: 26 [144/250 18432/32000 (58%)] Loss: 0.90481 (QuantReg: 15.27190) QuantErr: 15.27190 batch_time=0.50610 
Train Epoch: 26 [155/250 19840/32000 (62%)] Loss: 1.11998 (QuantReg: 15.01709) QuantErr: 15.01709 batch_time=0.50974 
Train Epoch: 26 [166/250 21248/32000 (66%)] Loss: 0.93597 (QuantReg: 15.37944) QuantErr: 15.37944 batch_time=0.50175 
Train Epoch: 26 [177/250 22656/32000 (71%)] Loss: 0.86882 (QuantReg: 15.16767) QuantErr: 15.16767 batch_time=0.53005 
Train Epoch: 26 [188/250 24064/32000 (75%)] Loss: 0.75122 (QuantReg: 15.51637) QuantErr: 15.51637 batch_time=0.52985 
Train Epoch: 26 [199/250 25472/32000 (80%)] Loss: 0.89542 (QuantReg: 15.57244) QuantErr: 15.57244 batch_time=0.56740 
Train Epoch: 26 [210/250 26880/32000 (84%)] Loss: 0.70879 (QuantReg: 15.54506) QuantErr: 15.54506 batch_time=0.51226 
Train Epoch: 26 [221/250 28288/32000 (88%)] Loss: 1.53564 (QuantReg: 15.31309) QuantErr: 15.31309 batch_time=0.57265 
Train Epoch: 26 [232/250 29696/32000 (93%)] Loss: 0.78601 (QuantReg: 15.53435) QuantErr: 15.53435 batch_time=0.52865 
Train Epoch: 26 [243/250 31104/32000 (97%)] Loss: 0.75265 (QuantReg: 15.52596) QuantErr: 15.52596 batch_time=0.50731 
Train Epoch: 26 codebook_update_time=1.72906
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch26.pth ...
Done in 13.004s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 0.9145314338207244
 quant_reg      : 15.383981231689454
 quant_err      : 15.383981231689454
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 72.63581488933602
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.76056338028169
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.891893865268734
 MSRVTT_full_val/v2t_metrics/R1: 40.84507042253521
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.674044265593562
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.4304779301931
 MSRVTT_full_test/t2v_metrics/R1: 13.076923076923077
 MSRVTT_full_test/t2v_metrics/R5: 36.220735785953174
 MSRVTT_full_test/t2v_metrics/R10: 48.79598662207358
 MSRVTT_full_test/t2v_metrics/R50: 79.63210702341136
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.01705685618729
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.484962167407875
 MSRVTT_full_test/v2t_metrics/R1: 14.68227424749164
 MSRVTT_full_test/v2t_metrics/R5: 42.34113712374582
 MSRVTT_full_test/v2t_metrics/R10: 57.458193979933114
 MSRVTT_full_test/v2t_metrics/R50: 86.45484949832776
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.434448160535116
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.93335231256011
 mnt_best       : 29.26802144441938
 not_improved_count: 1
Train Epoch: 27 [1/250 128/32000 (0%)] Loss: 0.69963 (QuantReg: 15.68610) QuantErr: 15.68610 batch_time=31.09475 
Train Epoch: 27 [12/250 1536/32000 (5%)] Loss: 1.26202 (QuantReg: 15.48325) QuantErr: 15.48325 batch_time=0.50775 
Train Epoch: 27 [23/250 2944/32000 (9%)] Loss: 0.84058 (QuantReg: 15.58459) QuantErr: 15.58459 batch_time=1.45175 
Train Epoch: 27 [34/250 4352/32000 (14%)] Loss: 0.83222 (QuantReg: 15.52718) QuantErr: 15.52718 batch_time=0.50164 
Train Epoch: 27 [45/250 5760/32000 (18%)] Loss: 0.82687 (QuantReg: 15.36082) QuantErr: 15.36082 batch_time=0.50340 
Train Epoch: 27 [56/250 7168/32000 (22%)] Loss: 0.63069 (QuantReg: 15.75527) QuantErr: 15.75527 batch_time=0.49655 
Train Epoch: 27 [67/250 8576/32000 (27%)] Loss: 0.75331 (QuantReg: 15.45935) QuantErr: 15.45935 batch_time=0.52363 
Train Epoch: 27 [78/250 9984/32000 (31%)] Loss: 0.76508 (QuantReg: 15.33594) QuantErr: 15.33594 batch_time=0.51300 
Train Epoch: 27 [89/250 11392/32000 (36%)] Loss: 0.75715 (QuantReg: 15.60513) QuantErr: 15.60513 batch_time=0.50202 
Train Epoch: 27 [100/250 12800/32000 (40%)] Loss: 0.90991 (QuantReg: 15.30443) QuantErr: 15.30443 batch_time=0.50136 
Train Epoch: 27 [111/250 14208/32000 (44%)] Loss: 0.73917 (QuantReg: 15.82269) QuantErr: 15.82269 batch_time=0.86050 
Train Epoch: 27 [122/250 15616/32000 (49%)] Loss: 0.85285 (QuantReg: 15.50687) QuantErr: 15.50687 batch_time=0.51031 
Train Epoch: 27 [133/250 17024/32000 (53%)] Loss: 0.99397 (QuantReg: 15.51238) QuantErr: 15.51238 batch_time=0.90382 
Train Epoch: 27 [144/250 18432/32000 (58%)] Loss: 0.69807 (QuantReg: 15.53209) QuantErr: 15.53209 batch_time=2.17924 
Train Epoch: 27 [155/250 19840/32000 (62%)] Loss: 0.76233 (QuantReg: 15.80987) QuantErr: 15.80987 batch_time=0.51415 
Train Epoch: 27 [166/250 21248/32000 (66%)] Loss: 0.92731 (QuantReg: 15.49606) QuantErr: 15.49606 batch_time=0.54669 
Train Epoch: 27 [177/250 22656/32000 (71%)] Loss: 1.04628 (QuantReg: 15.31691) QuantErr: 15.31691 batch_time=0.53959 
Train Epoch: 27 [188/250 24064/32000 (75%)] Loss: 0.89815 (QuantReg: 15.30859) QuantErr: 15.30859 batch_time=0.51459 
Train Epoch: 27 [199/250 25472/32000 (80%)] Loss: 1.01217 (QuantReg: 15.57834) QuantErr: 15.57834 batch_time=0.54960 
Train Epoch: 27 [210/250 26880/32000 (84%)] Loss: 0.67028 (QuantReg: 15.90482) QuantErr: 15.90482 batch_time=2.68840 
Train Epoch: 27 [221/250 28288/32000 (88%)] Loss: 0.76737 (QuantReg: 15.39704) QuantErr: 15.39704 batch_time=0.51134 
Train Epoch: 27 [232/250 29696/32000 (93%)] Loss: 0.82748 (QuantReg: 15.43439) QuantErr: 15.43439 batch_time=0.50792 
Train Epoch: 27 [243/250 31104/32000 (97%)] Loss: 0.83960 (QuantReg: 15.50018) QuantErr: 15.50018 batch_time=0.52860 
Train Epoch: 27 codebook_update_time=2.00313
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch27.pth ...
Done in 3.915s
removing stale ckpt [epoch 26] [took 0.00s]
 epoch          : 27
 loss           : 0.8789231538772583
 quant_reg      : 15.46539085006714
 quant_err      : 15.46539085006714
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 6750
 MSRVTT_full_val/t2v_metrics/R1: 35.412474849094565
 MSRVTT_full_val/t2v_metrics/R5: 73.2394366197183
 MSRVTT_full_val/t2v_metrics/R10: 84.50704225352112
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.23943661971831
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.29269896482319
 MSRVTT_full_val/v2t_metrics/R1: 41.4486921529175
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 88.73239436619718
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.426559356136821
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.30978531213898
 MSRVTT_full_test/t2v_metrics/R1: 12.809364548494983
 MSRVTT_full_test/t2v_metrics/R5: 36.35451505016722
 MSRVTT_full_test/t2v_metrics/R10: 50.03344481605351
 MSRVTT_full_test/t2v_metrics/R50: 80.60200668896321
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.6438127090301
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.561572568623323
 MSRVTT_full_test/v2t_metrics/R1: 15.518394648829432
 MSRVTT_full_test/v2t_metrics/R5: 43.61204013377927
 MSRVTT_full_test/v2t_metrics/R10: 57.725752508361204
 MSRVTT_full_test/v2t_metrics/R50: 86.98996655518394
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.231772575250837
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.93185476377085
 mnt_best       : 29.26802144441938
 not_improved_count: 2
Train Epoch: 28 [1/250 128/32000 (0%)] Loss: 0.65362 (QuantReg: 15.32743) QuantErr: 15.32743 batch_time=34.46010 
Train Epoch: 28 [12/250 1536/32000 (5%)] Loss: 0.96363 (QuantReg: 15.47751) QuantErr: 15.47751 batch_time=0.71205 
Train Epoch: 28 [23/250 2944/32000 (9%)] Loss: 0.87337 (QuantReg: 15.24441) QuantErr: 15.24441 batch_time=0.51560 
Train Epoch: 28 [34/250 4352/32000 (14%)] Loss: 0.90622 (QuantReg: 15.64286) QuantErr: 15.64286 batch_time=0.50614 
Train Epoch: 28 [45/250 5760/32000 (18%)] Loss: 1.01953 (QuantReg: 15.25099) QuantErr: 15.25099 batch_time=0.50378 
Train Epoch: 28 [56/250 7168/32000 (22%)] Loss: 0.78028 (QuantReg: 15.63137) QuantErr: 15.63137 batch_time=0.52279 
Train Epoch: 28 [67/250 8576/32000 (27%)] Loss: 1.16647 (QuantReg: 15.43457) QuantErr: 15.43457 batch_time=2.36602 
Train Epoch: 28 [78/250 9984/32000 (31%)] Loss: 0.68827 (QuantReg: 15.82746) QuantErr: 15.82746 batch_time=1.05933 
Train Epoch: 28 [89/250 11392/32000 (36%)] Loss: 1.02520 (QuantReg: 15.37961) QuantErr: 15.37961 batch_time=0.51548 
Train Epoch: 28 [100/250 12800/32000 (40%)] Loss: 1.12949 (QuantReg: 15.44825) QuantErr: 15.44825 batch_time=0.49822 
Train Epoch: 28 [111/250 14208/32000 (44%)] Loss: 0.82388 (QuantReg: 15.41858) QuantErr: 15.41858 batch_time=0.50383 
Train Epoch: 28 [122/250 15616/32000 (49%)] Loss: 0.90694 (QuantReg: 15.73790) QuantErr: 15.73790 batch_time=0.50244 
Train Epoch: 28 [133/250 17024/32000 (53%)] Loss: 0.98959 (QuantReg: 15.60515) QuantErr: 15.60515 batch_time=0.54620 
Train Epoch: 28 [144/250 18432/32000 (58%)] Loss: 1.09459 (QuantReg: 15.23411) QuantErr: 15.23411 batch_time=0.51305 
Train Epoch: 28 [155/250 19840/32000 (62%)] Loss: 1.03392 (QuantReg: 15.32863) QuantErr: 15.32863 batch_time=0.50708 
Train Epoch: 28 [166/250 21248/32000 (66%)] Loss: 0.67044 (QuantReg: 15.49541) QuantErr: 15.49541 batch_time=0.53469 
Train Epoch: 28 [177/250 22656/32000 (71%)] Loss: 1.07379 (QuantReg: 15.51407) QuantErr: 15.51407 batch_time=0.51601 
Train Epoch: 28 [188/250 24064/32000 (75%)] Loss: 0.83381 (QuantReg: 15.27264) QuantErr: 15.27264 batch_time=0.51256 
Train Epoch: 28 [199/250 25472/32000 (80%)] Loss: 0.63005 (QuantReg: 15.66508) QuantErr: 15.66508 batch_time=0.56327 
Train Epoch: 28 [210/250 26880/32000 (84%)] Loss: 0.84205 (QuantReg: 15.73549) QuantErr: 15.73549 batch_time=0.51716 
Train Epoch: 28 [221/250 28288/32000 (88%)] Loss: 0.83826 (QuantReg: 15.46405) QuantErr: 15.46405 batch_time=0.51476 
Train Epoch: 28 [232/250 29696/32000 (93%)] Loss: 1.19183 (QuantReg: 15.33419) QuantErr: 15.33419 batch_time=0.50972 
Train Epoch: 28 [243/250 31104/32000 (97%)] Loss: 0.77771 (QuantReg: 15.68325) QuantErr: 15.68325 batch_time=0.50849 
Train Epoch: 28 codebook_update_time=2.25666
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch28.pth ...
Done in 4.432s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 0.8719354639053345
 quant_reg      : 15.527329044342041
 quant_err      : 15.527329044342041
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 33.199195171026155
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 84.10462776659959
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.6156941649899395
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.150443951536296
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.668008048289739
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.42168626825222
 MSRVTT_full_test/t2v_metrics/R1: 12.709030100334449
 MSRVTT_full_test/t2v_metrics/R5: 37.05685618729097
 MSRVTT_full_test/t2v_metrics/R10: 50.10033444816054
 MSRVTT_full_test/t2v_metrics/R50: 79.76588628762542
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.84314381270903
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.68185274693112
 MSRVTT_full_test/v2t_metrics/R1: 15.518394648829432
 MSRVTT_full_test/v2t_metrics/R5: 44.280936454849495
 MSRVTT_full_test/v2t_metrics/R10: 58.66220735785953
 MSRVTT_full_test/v2t_metrics/R50: 86.52173913043478
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.115384615384617
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.287882326891854
 mnt_best       : 29.26802144441938
 not_improved_count: 3
Train Epoch: 29 [1/250 128/32000 (0%)] Loss: 0.84336 (QuantReg: 15.63772) QuantErr: 15.63772 batch_time=35.08878 
Train Epoch: 29 [12/250 1536/32000 (5%)] Loss: 0.89779 (QuantReg: 15.57067) QuantErr: 15.57067 batch_time=0.52469 
Train Epoch: 29 [23/250 2944/32000 (9%)] Loss: 1.13105 (QuantReg: 15.42500) QuantErr: 15.42500 batch_time=0.52700 
Train Epoch: 29 [34/250 4352/32000 (14%)] Loss: 0.93382 (QuantReg: 15.29334) QuantErr: 15.29334 batch_time=0.62148 
Train Epoch: 29 [45/250 5760/32000 (18%)] Loss: 0.83116 (QuantReg: 15.77827) QuantErr: 15.77827 batch_time=0.50580 
Train Epoch: 29 [56/250 7168/32000 (22%)] Loss: 0.95050 (QuantReg: 15.58288) QuantErr: 15.58288 batch_time=0.70344 
Train Epoch: 29 [67/250 8576/32000 (27%)] Loss: 0.83827 (QuantReg: 15.68495) QuantErr: 15.68495 batch_time=0.54153 
Train Epoch: 29 [78/250 9984/32000 (31%)] Loss: 0.98735 (QuantReg: 15.48761) QuantErr: 15.48761 batch_time=0.58882 
Train Epoch: 29 [89/250 11392/32000 (36%)] Loss: 0.68149 (QuantReg: 15.75963) QuantErr: 15.75963 batch_time=0.52809 
Train Epoch: 29 [100/250 12800/32000 (40%)] Loss: 0.69046 (QuantReg: 15.50257) QuantErr: 15.50257 batch_time=0.53381 
Train Epoch: 29 [111/250 14208/32000 (44%)] Loss: 1.14620 (QuantReg: 15.43463) QuantErr: 15.43463 batch_time=0.52998 
Train Epoch: 29 [122/250 15616/32000 (49%)] Loss: 0.73233 (QuantReg: 15.94958) QuantErr: 15.94958 batch_time=0.50506 
Train Epoch: 29 [133/250 17024/32000 (53%)] Loss: 1.11023 (QuantReg: 15.49113) QuantErr: 15.49113 batch_time=2.02482 
Train Epoch: 29 [144/250 18432/32000 (58%)] Loss: 0.73937 (QuantReg: 15.59114) QuantErr: 15.59114 batch_time=0.50767 
Train Epoch: 29 [155/250 19840/32000 (62%)] Loss: 0.76170 (QuantReg: 15.44122) QuantErr: 15.44122 batch_time=0.50998 
Train Epoch: 29 [166/250 21248/32000 (66%)] Loss: 0.76086 (QuantReg: 15.68143) QuantErr: 15.68143 batch_time=0.53659 
Train Epoch: 29 [177/250 22656/32000 (71%)] Loss: 0.95921 (QuantReg: 15.40483) QuantErr: 15.40483 batch_time=0.53323 
Train Epoch: 29 [188/250 24064/32000 (75%)] Loss: 0.76360 (QuantReg: 15.47852) QuantErr: 15.47852 batch_time=0.51569 
Train Epoch: 29 [199/250 25472/32000 (80%)] Loss: 1.01146 (QuantReg: 15.64367) QuantErr: 15.64367 batch_time=0.51098 
Train Epoch: 29 [210/250 26880/32000 (84%)] Loss: 0.63754 (QuantReg: 15.86978) QuantErr: 15.86978 batch_time=0.51722 
Train Epoch: 29 [221/250 28288/32000 (88%)] Loss: 0.79257 (QuantReg: 15.30864) QuantErr: 15.30864 batch_time=0.52119 
Train Epoch: 29 [232/250 29696/32000 (93%)] Loss: 0.91759 (QuantReg: 15.50036) QuantErr: 15.50036 batch_time=0.53779 
Train Epoch: 29 [243/250 31104/32000 (97%)] Loss: 0.70263 (QuantReg: 15.76680) QuantErr: 15.76680 batch_time=0.50940 
Train Epoch: 29 codebook_update_time=1.86516
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch29.pth ...
Done in 3.958s
removing stale ckpt [epoch 28] [took 0.00s]
 epoch          : 29
 loss           : 0.8679173574447632
 quant_reg      : 15.570372512817382
 quant_err      : 15.570372512817382
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 7250
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 72.63581488933602
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.925553319919517
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.10338248400499
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.923541247484909
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.058210950234
 MSRVTT_full_test/t2v_metrics/R1: 12.909698996655518
 MSRVTT_full_test/t2v_metrics/R5: 36.45484949832776
 MSRVTT_full_test/t2v_metrics/R10: 49.86622073578595
 MSRVTT_full_test/t2v_metrics/R50: 79.4648829431438
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.50501672240803
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.630304061116306
 MSRVTT_full_test/v2t_metrics/R1: 15.451505016722408
 MSRVTT_full_test/v2t_metrics/R5: 42.80936454849498
 MSRVTT_full_test/v2t_metrics/R10: 58.36120401337793
 MSRVTT_full_test/v2t_metrics/R50: 86.35451505016722
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.08294314381271
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.79698330408277
 mnt_best       : 29.26802144441938
 not_improved_count: 4
Train Epoch: 30 [1/250 128/32000 (0%)] Loss: 0.75614 (QuantReg: 15.71743) QuantErr: 15.71743 batch_time=37.78873 
Train Epoch: 30 [12/250 1536/32000 (5%)] Loss: 0.92823 (QuantReg: 15.47034) QuantErr: 15.47034 batch_time=0.50114 
Train Epoch: 30 [23/250 2944/32000 (9%)] Loss: 0.86633 (QuantReg: 15.57993) QuantErr: 15.57993 batch_time=0.50634 
Train Epoch: 30 [34/250 4352/32000 (14%)] Loss: 0.99695 (QuantReg: 15.46736) QuantErr: 15.46736 batch_time=0.49789 
Train Epoch: 30 [45/250 5760/32000 (18%)] Loss: 0.75863 (QuantReg: 15.62908) QuantErr: 15.62908 batch_time=0.50200 
Train Epoch: 30 [56/250 7168/32000 (22%)] Loss: 0.89129 (QuantReg: 15.85603) QuantErr: 15.85603 batch_time=0.50593 
Train Epoch: 30 [67/250 8576/32000 (27%)] Loss: 0.85918 (QuantReg: 15.46793) QuantErr: 15.46793 batch_time=0.50717 
Train Epoch: 30 [78/250 9984/32000 (31%)] Loss: 0.70654 (QuantReg: 15.81659) QuantErr: 15.81659 batch_time=0.51283 
Train Epoch: 30 [89/250 11392/32000 (36%)] Loss: 0.96976 (QuantReg: 15.41413) QuantErr: 15.41413 batch_time=0.61633 
Train Epoch: 30 [100/250 12800/32000 (40%)] Loss: 0.81764 (QuantReg: 15.83444) QuantErr: 15.83444 batch_time=0.53020 
Train Epoch: 30 [111/250 14208/32000 (44%)] Loss: 0.84018 (QuantReg: 15.60864) QuantErr: 15.60864 batch_time=0.56627 
Train Epoch: 30 [122/250 15616/32000 (49%)] Loss: 0.77531 (QuantReg: 15.66846) QuantErr: 15.66846 batch_time=0.50197 
Train Epoch: 30 [133/250 17024/32000 (53%)] Loss: 0.86310 (QuantReg: 15.70682) QuantErr: 15.70682 batch_time=0.50591 
Train Epoch: 30 [144/250 18432/32000 (58%)] Loss: 0.89604 (QuantReg: 15.44040) QuantErr: 15.44040 batch_time=1.89025 
Train Epoch: 30 [155/250 19840/32000 (62%)] Loss: 0.85227 (QuantReg: 15.73946) QuantErr: 15.73946 batch_time=0.53105 
Train Epoch: 30 [166/250 21248/32000 (66%)] Loss: 0.85003 (QuantReg: 15.67525) QuantErr: 15.67525 batch_time=0.54731 
Train Epoch: 30 [177/250 22656/32000 (71%)] Loss: 0.81247 (QuantReg: 15.56623) QuantErr: 15.56623 batch_time=1.02097 
Train Epoch: 30 [188/250 24064/32000 (75%)] Loss: 0.59351 (QuantReg: 15.81837) QuantErr: 15.81837 batch_time=0.50363 
Train Epoch: 30 [199/250 25472/32000 (80%)] Loss: 1.32361 (QuantReg: 15.69576) QuantErr: 15.69576 batch_time=0.50169 
Train Epoch: 30 [210/250 26880/32000 (84%)] Loss: 0.84285 (QuantReg: 15.66199) QuantErr: 15.66199 batch_time=0.52215 
Train Epoch: 30 [221/250 28288/32000 (88%)] Loss: 0.78235 (QuantReg: 15.74935) QuantErr: 15.74935 batch_time=0.57064 
Train Epoch: 30 [232/250 29696/32000 (93%)] Loss: 1.01611 (QuantReg: 15.78370) QuantErr: 15.78370 batch_time=0.50878 
Train Epoch: 30 [243/250 31104/32000 (97%)] Loss: 0.96072 (QuantReg: 15.83520) QuantErr: 15.83520 batch_time=0.52397 
Train Epoch: 30 codebook_update_time=1.78502
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch30.pth ...
Done in 4.006s
removing stale ckpt [epoch 29] [took 0.05s]
 epoch          : 30
 loss           : 0.8333151965141297
 quant_reg      : 15.635584442138672
 quant_err      : 15.635584442138672
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.7565392354124745
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.11618203851008
 MSRVTT_full_val/v2t_metrics/R1: 40.44265593561368
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.72635814889336
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.2908981974845
 MSRVTT_full_test/t2v_metrics/R1: 12.842809364548495
 MSRVTT_full_test/t2v_metrics/R5: 35.51839464882943
 MSRVTT_full_test/t2v_metrics/R10: 48.39464882943144
 MSRVTT_full_test/t2v_metrics/R50: 79.1638795986622
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.022742474916384
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.052413749546922
 MSRVTT_full_test/v2t_metrics/R1: 15.785953177257525
 MSRVTT_full_test/v2t_metrics/R5: 43.47826086956522
 MSRVTT_full_test/v2t_metrics/R10: 57.9933110367893
 MSRVTT_full_test/v2t_metrics/R50: 85.81939799331104
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.293311036789298
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.14341523014017
 mnt_best       : 29.26802144441938
 not_improved_count: 5
Train Epoch: 31 [1/250 128/32000 (0%)] Loss: 1.10494 (QuantReg: 15.66084) QuantErr: 15.66084 batch_time=36.60047 
Train Epoch: 31 [12/250 1536/32000 (5%)] Loss: 0.89979 (QuantReg: 15.66211) QuantErr: 15.66211 batch_time=0.51161 
Train Epoch: 31 [23/250 2944/32000 (9%)] Loss: 1.17980 (QuantReg: 15.43818) QuantErr: 15.43818 batch_time=0.53222 
Train Epoch: 31 [34/250 4352/32000 (14%)] Loss: 0.76363 (QuantReg: 15.46931) QuantErr: 15.46931 batch_time=0.49932 
Train Epoch: 31 [45/250 5760/32000 (18%)] Loss: 0.82693 (QuantReg: 15.48731) QuantErr: 15.48731 batch_time=0.51281 
Train Epoch: 31 [56/250 7168/32000 (22%)] Loss: 1.17699 (QuantReg: 14.93964) QuantErr: 14.93964 batch_time=0.49828 
Train Epoch: 31 [67/250 8576/32000 (27%)] Loss: 0.77687 (QuantReg: 15.62860) QuantErr: 15.62860 batch_time=3.13307 
Train Epoch: 31 [78/250 9984/32000 (31%)] Loss: 0.93325 (QuantReg: 15.75442) QuantErr: 15.75442 batch_time=0.51266 
Train Epoch: 31 [89/250 11392/32000 (36%)] Loss: 0.98731 (QuantReg: 15.76297) QuantErr: 15.76297 batch_time=0.50760 
Train Epoch: 31 [100/250 12800/32000 (40%)] Loss: 0.78920 (QuantReg: 15.46367) QuantErr: 15.46367 batch_time=0.51209 
Train Epoch: 31 [111/250 14208/32000 (44%)] Loss: 0.73013 (QuantReg: 15.81702) QuantErr: 15.81702 batch_time=0.54060 
Train Epoch: 31 [122/250 15616/32000 (49%)] Loss: 0.77267 (QuantReg: 15.74387) QuantErr: 15.74387 batch_time=0.57237 
Train Epoch: 31 [133/250 17024/32000 (53%)] Loss: 0.79225 (QuantReg: 15.79646) QuantErr: 15.79646 batch_time=0.51710 
Train Epoch: 31 [144/250 18432/32000 (58%)] Loss: 1.18267 (QuantReg: 15.69358) QuantErr: 15.69358 batch_time=0.75108 
Train Epoch: 31 [155/250 19840/32000 (62%)] Loss: 0.84847 (QuantReg: 15.58245) QuantErr: 15.58245 batch_time=0.53466 
Train Epoch: 31 [166/250 21248/32000 (66%)] Loss: 0.73250 (QuantReg: 15.41177) QuantErr: 15.41177 batch_time=0.50796 
Train Epoch: 31 [177/250 22656/32000 (71%)] Loss: 1.05030 (QuantReg: 15.42341) QuantErr: 15.42341 batch_time=0.53814 
Train Epoch: 31 [188/250 24064/32000 (75%)] Loss: 0.81950 (QuantReg: 15.91805) QuantErr: 15.91805 batch_time=0.50194 
Train Epoch: 31 [199/250 25472/32000 (80%)] Loss: 0.70361 (QuantReg: 15.90170) QuantErr: 15.90170 batch_time=0.52438 
Train Epoch: 31 [210/250 26880/32000 (84%)] Loss: 1.05025 (QuantReg: 15.54885) QuantErr: 15.54885 batch_time=0.51694 
Train Epoch: 31 [221/250 28288/32000 (88%)] Loss: 0.64447 (QuantReg: 16.05157) QuantErr: 16.05157 batch_time=0.52024 
Train Epoch: 31 [232/250 29696/32000 (93%)] Loss: 0.91480 (QuantReg: 15.67420) QuantErr: 15.67420 batch_time=0.50950 
Train Epoch: 31 [243/250 31104/32000 (97%)] Loss: 0.95999 (QuantReg: 15.69007) QuantErr: 15.69007 batch_time=0.50820 
Train Epoch: 31 codebook_update_time=1.76768
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch31.pth ...
Done in 4.465s
removing stale ckpt [epoch 30] [took 0.00s]
 epoch          : 31
 loss           : 0.855839806318283
 quant_reg      : 15.687697700500488
 quant_err      : 15.687697700500488
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 7750
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 83.90342052313883
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 6.957746478873239
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.11462156189779
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.522132796780684
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.77938520579916
 MSRVTT_full_test/t2v_metrics/R1: 12.842809364548495
 MSRVTT_full_test/t2v_metrics/R5: 37.19063545150502
 MSRVTT_full_test/t2v_metrics/R10: 50.50167224080268
 MSRVTT_full_test/t2v_metrics/R50: 80.5685618729097
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.78294314381271
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.893476375114865
 MSRVTT_full_test/v2t_metrics/R1: 15.819397993311037
 MSRVTT_full_test/v2t_metrics/R5: 43.47826086956522
 MSRVTT_full_test/v2t_metrics/R10: 58.862876254180605
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.052508361204012
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.337436184040584
 mnt_best       : 29.26802144441938
 not_improved_count: 6
Train Epoch: 32 [1/250 128/32000 (0%)] Loss: 0.56785 (QuantReg: 15.77507) QuantErr: 15.77507 batch_time=35.65377 
Train Epoch: 32 [12/250 1536/32000 (5%)] Loss: 0.82407 (QuantReg: 15.84934) QuantErr: 15.84934 batch_time=0.50951 
Train Epoch: 32 [23/250 2944/32000 (9%)] Loss: 0.82085 (QuantReg: 15.73279) QuantErr: 15.73279 batch_time=0.51111 
Train Epoch: 32 [34/250 4352/32000 (14%)] Loss: 0.75278 (QuantReg: 15.91129) QuantErr: 15.91129 batch_time=2.06086 
Train Epoch: 32 [45/250 5760/32000 (18%)] Loss: 0.54178 (QuantReg: 15.92314) QuantErr: 15.92314 batch_time=0.51007 
Train Epoch: 32 [56/250 7168/32000 (22%)] Loss: 0.89905 (QuantReg: 15.56235) QuantErr: 15.56235 batch_time=0.50312 
Train Epoch: 32 [67/250 8576/32000 (27%)] Loss: 0.60361 (QuantReg: 15.85377) QuantErr: 15.85377 batch_time=0.59813 
Train Epoch: 32 [78/250 9984/32000 (31%)] Loss: 0.78316 (QuantReg: 15.59369) QuantErr: 15.59369 batch_time=0.52196 
Train Epoch: 32 [89/250 11392/32000 (36%)] Loss: 0.97854 (QuantReg: 15.68833) QuantErr: 15.68833 batch_time=0.52363 
Train Epoch: 32 [100/250 12800/32000 (40%)] Loss: 0.88591 (QuantReg: 15.58624) QuantErr: 15.58624 batch_time=0.51384 
Train Epoch: 32 [111/250 14208/32000 (44%)] Loss: 0.94633 (QuantReg: 16.08913) QuantErr: 16.08913 batch_time=0.60303 
Train Epoch: 32 [122/250 15616/32000 (49%)] Loss: 0.68829 (QuantReg: 15.50508) QuantErr: 15.50508 batch_time=0.50437 
Train Epoch: 32 [133/250 17024/32000 (53%)] Loss: 0.79166 (QuantReg: 15.74040) QuantErr: 15.74040 batch_time=2.85211 
Train Epoch: 32 [144/250 18432/32000 (58%)] Loss: 0.87776 (QuantReg: 15.68695) QuantErr: 15.68695 batch_time=0.52699 
Train Epoch: 32 [155/250 19840/32000 (62%)] Loss: 0.71551 (QuantReg: 15.80227) QuantErr: 15.80227 batch_time=0.51354 
Train Epoch: 32 [166/250 21248/32000 (66%)] Loss: 0.92002 (QuantReg: 15.91237) QuantErr: 15.91237 batch_time=0.51213 
Train Epoch: 32 [177/250 22656/32000 (71%)] Loss: 0.93251 (QuantReg: 16.03703) QuantErr: 16.03703 batch_time=0.51533 
Train Epoch: 32 [188/250 24064/32000 (75%)] Loss: 0.95763 (QuantReg: 15.93555) QuantErr: 15.93555 batch_time=0.50459 
Train Epoch: 32 [199/250 25472/32000 (80%)] Loss: 0.75442 (QuantReg: 16.03712) QuantErr: 16.03712 batch_time=0.92164 
Train Epoch: 32 [210/250 26880/32000 (84%)] Loss: 1.01626 (QuantReg: 15.82521) QuantErr: 15.82521 batch_time=0.51602 
Train Epoch: 32 [221/250 28288/32000 (88%)] Loss: 0.69639 (QuantReg: 15.93114) QuantErr: 15.93114 batch_time=0.52106 
Train Epoch: 32 [232/250 29696/32000 (93%)] Loss: 0.85270 (QuantReg: 15.57127) QuantErr: 15.57127 batch_time=0.52563 
Train Epoch: 32 [243/250 31104/32000 (97%)] Loss: 0.67187 (QuantReg: 15.95955) QuantErr: 15.95955 batch_time=0.69187 
Train Epoch: 32 codebook_update_time=2.05764
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch32.pth ...
Done in 3.970s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 0.8237549180984497
 quant_reg      : 15.749908618927002
 quant_err      : 15.749908618927002
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 72.23340040241449
 MSRVTT_full_val/t2v_metrics/R10: 84.30583501006036
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.382293762575452
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.57258407957656
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.537223340040241
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.6695894271987
 MSRVTT_full_test/t2v_metrics/R1: 12.709030100334449
 MSRVTT_full_test/t2v_metrics/R5: 37.123745819397996
 MSRVTT_full_test/t2v_metrics/R10: 50.5685618729097
 MSRVTT_full_test/t2v_metrics/R50: 79.93311036789298
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.544147157190636
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.788228017597525
 MSRVTT_full_test/v2t_metrics/R1: 15.551839464882944
 MSRVTT_full_test/v2t_metrics/R5: 43.17725752508361
 MSRVTT_full_test/v2t_metrics/R10: 57.558528428093645
 MSRVTT_full_test/v2t_metrics/R50: 86.75585284280936
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.45066889632107
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.81028514681095
 mnt_best       : 29.26802144441938
 not_improved_count: 7
Train Epoch: 33 [1/250 128/32000 (0%)] Loss: 0.84966 (QuantReg: 16.05456) QuantErr: 16.05456 batch_time=34.78909 
Train Epoch: 33 [12/250 1536/32000 (5%)] Loss: 0.63160 (QuantReg: 15.57871) QuantErr: 15.57871 batch_time=0.49831 
Train Epoch: 33 [23/250 2944/32000 (9%)] Loss: 0.91458 (QuantReg: 15.98327) QuantErr: 15.98327 batch_time=0.58019 
Train Epoch: 33 [34/250 4352/32000 (14%)] Loss: 0.64668 (QuantReg: 15.13467) QuantErr: 15.13467 batch_time=0.52073 
Train Epoch: 33 [45/250 5760/32000 (18%)] Loss: 0.68893 (QuantReg: 15.97183) QuantErr: 15.97183 batch_time=0.51478 
Train Epoch: 33 [56/250 7168/32000 (22%)] Loss: 0.79189 (QuantReg: 15.86026) QuantErr: 15.86026 batch_time=0.54073 
Train Epoch: 33 [67/250 8576/32000 (27%)] Loss: 0.95716 (QuantReg: 15.72684) QuantErr: 15.72684 batch_time=0.80405 
Train Epoch: 33 [78/250 9984/32000 (31%)] Loss: 0.78171 (QuantReg: 15.45346) QuantErr: 15.45346 batch_time=0.50551 
Train Epoch: 33 [89/250 11392/32000 (36%)] Loss: 0.85170 (QuantReg: 15.49485) QuantErr: 15.49485 batch_time=0.50481 
Train Epoch: 33 [100/250 12800/32000 (40%)] Loss: 0.87563 (QuantReg: 15.53103) QuantErr: 15.53103 batch_time=0.51183 
Train Epoch: 33 [111/250 14208/32000 (44%)] Loss: 0.93274 (QuantReg: 15.63601) QuantErr: 15.63601 batch_time=0.98463 
Train Epoch: 33 [122/250 15616/32000 (49%)] Loss: 0.85022 (QuantReg: 15.80457) QuantErr: 15.80457 batch_time=0.53252 
Train Epoch: 33 [133/250 17024/32000 (53%)] Loss: 1.15898 (QuantReg: 15.58595) QuantErr: 15.58595 batch_time=0.50750 
Train Epoch: 33 [144/250 18432/32000 (58%)] Loss: 0.89306 (QuantReg: 15.88402) QuantErr: 15.88402 batch_time=0.51098 
Train Epoch: 33 [155/250 19840/32000 (62%)] Loss: 0.75245 (QuantReg: 15.61965) QuantErr: 15.61965 batch_time=0.57914 
Train Epoch: 33 [166/250 21248/32000 (66%)] Loss: 0.77710 (QuantReg: 15.93407) QuantErr: 15.93407 batch_time=0.49596 
Train Epoch: 33 [177/250 22656/32000 (71%)] Loss: 0.69180 (QuantReg: 15.83490) QuantErr: 15.83490 batch_time=0.57230 
Train Epoch: 33 [188/250 24064/32000 (75%)] Loss: 0.97883 (QuantReg: 15.83645) QuantErr: 15.83645 batch_time=0.84711 
Train Epoch: 33 [199/250 25472/32000 (80%)] Loss: 0.75700 (QuantReg: 15.60698) QuantErr: 15.60698 batch_time=0.51680 
Train Epoch: 33 [210/250 26880/32000 (84%)] Loss: 0.74539 (QuantReg: 16.03506) QuantErr: 16.03506 batch_time=0.73239 
Train Epoch: 33 [221/250 28288/32000 (88%)] Loss: 1.14685 (QuantReg: 15.48672) QuantErr: 15.48672 batch_time=0.53858 
Train Epoch: 33 [232/250 29696/32000 (93%)] Loss: 0.84738 (QuantReg: 15.79594) QuantErr: 15.79594 batch_time=0.50470 
Train Epoch: 33 [243/250 31104/32000 (97%)] Loss: 0.80127 (QuantReg: 15.81681) QuantErr: 15.81681 batch_time=0.52096 
Train Epoch: 33 codebook_update_time=1.72589
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch33.pth ...
Done in 4.250s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch33.pth ...
Done in 8.299s
removing stale ckpt [epoch 32] [took 0.00s]
 epoch          : 33
 loss           : 0.8156179502010346
 quant_reg      : 15.78623278427124
 quant_err      : 15.78623278427124
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 8250
 MSRVTT_full_val/t2v_metrics/R1: 33.199195171026155
 MSRVTT_full_val/t2v_metrics/R5: 73.03822937625755
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.203219315895372
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.72051194573498
 MSRVTT_full_val/v2t_metrics/R1: 40.84507042253521
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.4325955734406435
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.80549985285046
 MSRVTT_full_test/t2v_metrics/R1: 13.879598662207357
 MSRVTT_full_test/t2v_metrics/R5: 37.759197324414714
 MSRVTT_full_test/t2v_metrics/R10: 51.57190635451505
 MSRVTT_full_test/t2v_metrics/R50: 81.03678929765886
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.8876254180602
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.010342305584274
 MSRVTT_full_test/v2t_metrics/R1: 16.354515050167223
 MSRVTT_full_test/v2t_metrics/R5: 44.046822742474916
 MSRVTT_full_test/v2t_metrics/R10: 58.69565217391305
 MSRVTT_full_test/v2t_metrics/R50: 86.68896321070234
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.744816053511705
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.83796110644172
 mnt_best       : 30.010342305584274
 not_improved_count: 0
Train Epoch: 34 [1/250 128/32000 (0%)] Loss: 0.83473 (QuantReg: 15.89251) QuantErr: 15.89251 batch_time=35.24255 
Train Epoch: 34 [12/250 1536/32000 (5%)] Loss: 0.63949 (QuantReg: 15.90378) QuantErr: 15.90378 batch_time=0.52737 
Train Epoch: 34 [23/250 2944/32000 (9%)] Loss: 0.73827 (QuantReg: 15.89573) QuantErr: 15.89573 batch_time=0.49984 
Train Epoch: 34 [34/250 4352/32000 (14%)] Loss: 0.84336 (QuantReg: 15.85497) QuantErr: 15.85497 batch_time=0.51022 
Train Epoch: 34 [45/250 5760/32000 (18%)] Loss: 0.90816 (QuantReg: 15.94292) QuantErr: 15.94292 batch_time=0.50580 
Train Epoch: 34 [56/250 7168/32000 (22%)] Loss: 0.85272 (QuantReg: 15.77679) QuantErr: 15.77679 batch_time=0.49688 
Train Epoch: 34 [67/250 8576/32000 (27%)] Loss: 0.88588 (QuantReg: 15.73760) QuantErr: 15.73760 batch_time=0.50824 
Train Epoch: 34 [78/250 9984/32000 (31%)] Loss: 1.12761 (QuantReg: 15.60671) QuantErr: 15.60671 batch_time=0.51224 
Train Epoch: 34 [89/250 11392/32000 (36%)] Loss: 0.91623 (QuantReg: 15.77165) QuantErr: 15.77165 batch_time=0.49834 
Train Epoch: 34 [100/250 12800/32000 (40%)] Loss: 1.19449 (QuantReg: 15.75666) QuantErr: 15.75666 batch_time=0.51607 
Train Epoch: 34 [111/250 14208/32000 (44%)] Loss: 1.01491 (QuantReg: 15.36122) QuantErr: 15.36122 batch_time=0.50341 
Train Epoch: 34 [122/250 15616/32000 (49%)] Loss: 0.86454 (QuantReg: 15.71531) QuantErr: 15.71531 batch_time=0.50239 
Train Epoch: 34 [133/250 17024/32000 (53%)] Loss: 0.81565 (QuantReg: 15.90188) QuantErr: 15.90188 batch_time=0.49969 
Train Epoch: 34 [144/250 18432/32000 (58%)] Loss: 0.95294 (QuantReg: 15.62059) QuantErr: 15.62059 batch_time=1.91830 
Train Epoch: 34 [155/250 19840/32000 (62%)] Loss: 0.76380 (QuantReg: 16.07829) QuantErr: 16.07829 batch_time=0.51666 
Train Epoch: 34 [166/250 21248/32000 (66%)] Loss: 0.99244 (QuantReg: 15.40417) QuantErr: 15.40417 batch_time=0.52841 
Train Epoch: 34 [177/250 22656/32000 (71%)] Loss: 0.68428 (QuantReg: 15.85239) QuantErr: 15.85239 batch_time=0.50572 
Train Epoch: 34 [188/250 24064/32000 (75%)] Loss: 0.97877 (QuantReg: 15.57505) QuantErr: 15.57505 batch_time=0.51436 
Train Epoch: 34 [199/250 25472/32000 (80%)] Loss: 0.69095 (QuantReg: 15.67322) QuantErr: 15.67322 batch_time=0.49848 
Train Epoch: 34 [210/250 26880/32000 (84%)] Loss: 0.88700 (QuantReg: 15.77204) QuantErr: 15.77204 batch_time=0.51607 
Train Epoch: 34 [221/250 28288/32000 (88%)] Loss: 0.72435 (QuantReg: 16.00351) QuantErr: 16.00351 batch_time=0.51389 
Train Epoch: 34 [232/250 29696/32000 (93%)] Loss: 0.67492 (QuantReg: 15.95577) QuantErr: 15.95577 batch_time=0.52837 
Train Epoch: 34 [243/250 31104/32000 (97%)] Loss: 1.04353 (QuantReg: 16.06798) QuantErr: 16.06798 batch_time=0.52496 
Train Epoch: 34 codebook_update_time=1.74585
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch34.pth ...
Done in 3.905s
removing stale ckpt [epoch 33] [took 0.01s]
 epoch          : 34
 loss           : 0.8440262293815612
 quant_reg      : 15.794074935913086
 quant_err      : 15.794074935913086
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.629778672032193
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.86337596086109
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.770623742454728
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.920855114438865
 MSRVTT_full_test/t2v_metrics/R1: 13.143812709030101
 MSRVTT_full_test/t2v_metrics/R5: 36.12040133779264
 MSRVTT_full_test/t2v_metrics/R10: 49.063545150501675
 MSRVTT_full_test/t2v_metrics/R50: 79.1638795986622
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.881270903010034
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.559084728797963
 MSRVTT_full_test/v2t_metrics/R1: 16.48829431438127
 MSRVTT_full_test/v2t_metrics/R5: 43.87959866220736
 MSRVTT_full_test/v2t_metrics/R10: 58.09364548494983
 MSRVTT_full_test/v2t_metrics/R50: 86.52173913043478
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.29799331103679
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.76874402062743
 mnt_best       : 30.010342305584274
 not_improved_count: 1
Train Epoch: 35 [1/250 128/32000 (0%)] Loss: 0.77909 (QuantReg: 15.83306) QuantErr: 15.83306 batch_time=37.59864 
Train Epoch: 35 [12/250 1536/32000 (5%)] Loss: 0.84455 (QuantReg: 15.85473) QuantErr: 15.85473 batch_time=0.53834 
Train Epoch: 35 [23/250 2944/32000 (9%)] Loss: 1.01157 (QuantReg: 15.74072) QuantErr: 15.74072 batch_time=0.51910 
Train Epoch: 35 [34/250 4352/32000 (14%)] Loss: 1.00037 (QuantReg: 15.74618) QuantErr: 15.74618 batch_time=0.51018 
Train Epoch: 35 [45/250 5760/32000 (18%)] Loss: 0.86737 (QuantReg: 15.74448) QuantErr: 15.74448 batch_time=0.54695 
Train Epoch: 35 [56/250 7168/32000 (22%)] Loss: 0.78352 (QuantReg: 15.77641) QuantErr: 15.77641 batch_time=0.52330 
Train Epoch: 35 [67/250 8576/32000 (27%)] Loss: 0.75702 (QuantReg: 16.05093) QuantErr: 16.05093 batch_time=0.51526 
Train Epoch: 35 [78/250 9984/32000 (31%)] Loss: 1.18185 (QuantReg: 15.98081) QuantErr: 15.98081 batch_time=0.51508 
Train Epoch: 35 [89/250 11392/32000 (36%)] Loss: 0.87036 (QuantReg: 15.77636) QuantErr: 15.77636 batch_time=0.55694 
Train Epoch: 35 [100/250 12800/32000 (40%)] Loss: 0.83018 (QuantReg: 15.78521) QuantErr: 15.78521 batch_time=0.53676 
Train Epoch: 35 [111/250 14208/32000 (44%)] Loss: 0.97466 (QuantReg: 15.66821) QuantErr: 15.66821 batch_time=0.50821 
Train Epoch: 35 [122/250 15616/32000 (49%)] Loss: 0.78950 (QuantReg: 15.70780) QuantErr: 15.70780 batch_time=0.50166 
Train Epoch: 35 [133/250 17024/32000 (53%)] Loss: 1.18956 (QuantReg: 15.55150) QuantErr: 15.55150 batch_time=0.50247 
Train Epoch: 35 [144/250 18432/32000 (58%)] Loss: 0.75252 (QuantReg: 16.05492) QuantErr: 16.05492 batch_time=0.51188 
Train Epoch: 35 [155/250 19840/32000 (62%)] Loss: 0.70363 (QuantReg: 15.78128) QuantErr: 15.78128 batch_time=4.27053 
Train Epoch: 35 [166/250 21248/32000 (66%)] Loss: 0.86074 (QuantReg: 15.86690) QuantErr: 15.86690 batch_time=0.49563 
Train Epoch: 35 [177/250 22656/32000 (71%)] Loss: 0.69699 (QuantReg: 16.27424) QuantErr: 16.27424 batch_time=0.52351 
Train Epoch: 35 [188/250 24064/32000 (75%)] Loss: 0.66938 (QuantReg: 15.67579) QuantErr: 15.67579 batch_time=0.51195 
Train Epoch: 35 [199/250 25472/32000 (80%)] Loss: 0.70353 (QuantReg: 16.20577) QuantErr: 16.20577 batch_time=1.34616 
Train Epoch: 35 [210/250 26880/32000 (84%)] Loss: 0.60232 (QuantReg: 15.97450) QuantErr: 15.97450 batch_time=0.84235 
Train Epoch: 35 [221/250 28288/32000 (88%)] Loss: 0.78016 (QuantReg: 15.96745) QuantErr: 15.96745 batch_time=0.51009 
Train Epoch: 35 [232/250 29696/32000 (93%)] Loss: 0.74922 (QuantReg: 16.03587) QuantErr: 16.03587 batch_time=0.51768 
Train Epoch: 35 [243/250 31104/32000 (97%)] Loss: 0.71829 (QuantReg: 15.98294) QuantErr: 15.98294 batch_time=0.51345 
Train Epoch: 35 codebook_update_time=1.95614
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch35.pth ...
Done in 4.695s
removing stale ckpt [epoch 34] [took 0.01s]
 epoch          : 35
 loss           : 0.8035579087734223
 quant_reg      : 15.852295238494873
 quant_err      : 15.852295238494873
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 8750
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.028169014084508
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.26796668415914
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.0040241448692155
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.84218343123728
 MSRVTT_full_test/t2v_metrics/R1: 13.277591973244148
 MSRVTT_full_test/t2v_metrics/R5: 35.48494983277592
 MSRVTT_full_test/t2v_metrics/R10: 49.49832775919732
 MSRVTT_full_test/t2v_metrics/R50: 79.26421404682274
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.606020066889634
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.570511370829383
 MSRVTT_full_test/v2t_metrics/R1: 15.88628762541806
 MSRVTT_full_test/v2t_metrics/R5: 43.07692307692308
 MSRVTT_full_test/v2t_metrics/R10: 57.424749163879596
 MSRVTT_full_test/v2t_metrics/R50: 86.72240802675586
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.400668896321065
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.998159024166966
 mnt_best       : 30.010342305584274
 not_improved_count: 2
Train Epoch: 36 [1/250 128/32000 (0%)] Loss: 0.77848 (QuantReg: 15.73421) QuantErr: 15.73421 batch_time=38.78301 
Train Epoch: 36 [12/250 1536/32000 (5%)] Loss: 0.95448 (QuantReg: 15.93629) QuantErr: 15.93629 batch_time=0.63308 
Train Epoch: 36 [23/250 2944/32000 (9%)] Loss: 0.54470 (QuantReg: 15.65562) QuantErr: 15.65562 batch_time=0.53556 
Train Epoch: 36 [34/250 4352/32000 (14%)] Loss: 0.71904 (QuantReg: 15.70197) QuantErr: 15.70197 batch_time=0.52989 
Train Epoch: 36 [45/250 5760/32000 (18%)] Loss: 0.90830 (QuantReg: 15.88430) QuantErr: 15.88430 batch_time=0.52321 
Train Epoch: 36 [56/250 7168/32000 (22%)] Loss: 0.59610 (QuantReg: 15.74477) QuantErr: 15.74477 batch_time=0.51275 
Train Epoch: 36 [67/250 8576/32000 (27%)] Loss: 0.75226 (QuantReg: 16.05237) QuantErr: 16.05237 batch_time=0.51463 
Train Epoch: 36 [78/250 9984/32000 (31%)] Loss: 0.88983 (QuantReg: 16.07909) QuantErr: 16.07909 batch_time=0.50271 
Train Epoch: 36 [89/250 11392/32000 (36%)] Loss: 0.98237 (QuantReg: 15.72538) QuantErr: 15.72538 batch_time=0.50938 
Train Epoch: 36 [100/250 12800/32000 (40%)] Loss: 0.82759 (QuantReg: 15.90773) QuantErr: 15.90773 batch_time=0.51698 
Train Epoch: 36 [111/250 14208/32000 (44%)] Loss: 0.96825 (QuantReg: 15.70470) QuantErr: 15.70470 batch_time=0.51258 
Train Epoch: 36 [122/250 15616/32000 (49%)] Loss: 0.91080 (QuantReg: 15.90340) QuantErr: 15.90340 batch_time=0.51235 
Train Epoch: 36 [133/250 17024/32000 (53%)] Loss: 0.83853 (QuantReg: 15.62241) QuantErr: 15.62241 batch_time=0.51315 
Train Epoch: 36 [144/250 18432/32000 (58%)] Loss: 0.92939 (QuantReg: 16.09636) QuantErr: 16.09636 batch_time=0.50164 
Train Epoch: 36 [155/250 19840/32000 (62%)] Loss: 0.68716 (QuantReg: 15.93045) QuantErr: 15.93045 batch_time=0.50381 
Train Epoch: 36 [166/250 21248/32000 (66%)] Loss: 0.97074 (QuantReg: 15.84905) QuantErr: 15.84905 batch_time=0.56457 
Train Epoch: 36 [177/250 22656/32000 (71%)] Loss: 0.92096 (QuantReg: 15.76148) QuantErr: 15.76148 batch_time=0.51782 
Train Epoch: 36 [188/250 24064/32000 (75%)] Loss: 0.59413 (QuantReg: 16.03748) QuantErr: 16.03748 batch_time=0.52384 
Train Epoch: 36 [199/250 25472/32000 (80%)] Loss: 0.68965 (QuantReg: 15.95448) QuantErr: 15.95448 batch_time=3.52624 
Train Epoch: 36 [210/250 26880/32000 (84%)] Loss: 0.80350 (QuantReg: 15.86451) QuantErr: 15.86451 batch_time=0.62817 
Train Epoch: 36 [221/250 28288/32000 (88%)] Loss: 0.96143 (QuantReg: 15.53254) QuantErr: 15.53254 batch_time=0.52712 
Train Epoch: 36 [232/250 29696/32000 (93%)] Loss: 0.86612 (QuantReg: 15.82601) QuantErr: 15.82601 batch_time=0.50613 
Train Epoch: 36 [243/250 31104/32000 (97%)] Loss: 0.68897 (QuantReg: 15.55500) QuantErr: 15.55500 batch_time=0.52793 
Train Epoch: 36 codebook_update_time=1.97648
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch36.pth ...
Done in 3.982s
removing stale ckpt [epoch 35] [took 0.00s]
 epoch          : 36
 loss           : 0.804773226737976
 quant_reg      : 15.896825847625733
 quant_err      : 15.896825847625733
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.849094567404427
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.32287747605494
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.832997987927565
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.39224943782713
 MSRVTT_full_test/t2v_metrics/R1: 13.545150501672241
 MSRVTT_full_test/t2v_metrics/R5: 37.65886287625418
 MSRVTT_full_test/t2v_metrics/R10: 50.40133779264214
 MSRVTT_full_test/t2v_metrics/R50: 80.50167224080268
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.94448160535117
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.514201208632326
 MSRVTT_full_test/v2t_metrics/R1: 15.953177257525084
 MSRVTT_full_test/v2t_metrics/R5: 45.28428093645485
 MSRVTT_full_test/v2t_metrics/R10: 58.39464882943144
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.21036789297659
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.81148681442706
 mnt_best       : 30.010342305584274
 not_improved_count: 3
Train Epoch: 37 [1/250 128/32000 (0%)] Loss: 0.80383 (QuantReg: 15.85588) QuantErr: 15.85588 batch_time=33.36500 
Train Epoch: 37 [12/250 1536/32000 (5%)] Loss: 0.68594 (QuantReg: 15.81771) QuantErr: 15.81771 batch_time=5.62158 
Train Epoch: 37 [23/250 2944/32000 (9%)] Loss: 0.78522 (QuantReg: 15.71581) QuantErr: 15.71581 batch_time=0.50610 
Train Epoch: 37 [34/250 4352/32000 (14%)] Loss: 0.71397 (QuantReg: 15.90193) QuantErr: 15.90193 batch_time=0.57336 
Train Epoch: 37 [45/250 5760/32000 (18%)] Loss: 0.79157 (QuantReg: 15.95148) QuantErr: 15.95148 batch_time=0.51503 
Train Epoch: 37 [56/250 7168/32000 (22%)] Loss: 1.02658 (QuantReg: 15.61892) QuantErr: 15.61892 batch_time=0.51828 
Train Epoch: 37 [67/250 8576/32000 (27%)] Loss: 1.00400 (QuantReg: 15.78842) QuantErr: 15.78842 batch_time=0.50225 
Train Epoch: 37 [78/250 9984/32000 (31%)] Loss: 0.69958 (QuantReg: 15.89716) QuantErr: 15.89716 batch_time=0.52255 
Train Epoch: 37 [89/250 11392/32000 (36%)] Loss: 0.74621 (QuantReg: 16.02994) QuantErr: 16.02994 batch_time=0.50581 
Train Epoch: 37 [100/250 12800/32000 (40%)] Loss: 0.70628 (QuantReg: 15.59940) QuantErr: 15.59940 batch_time=0.50224 
Train Epoch: 37 [111/250 14208/32000 (44%)] Loss: 0.72773 (QuantReg: 15.86658) QuantErr: 15.86658 batch_time=0.50633 
Train Epoch: 37 [122/250 15616/32000 (49%)] Loss: 0.72466 (QuantReg: 15.92834) QuantErr: 15.92834 batch_time=0.53604 
Train Epoch: 37 [133/250 17024/32000 (53%)] Loss: 0.82769 (QuantReg: 15.77047) QuantErr: 15.77047 batch_time=0.54801 
Train Epoch: 37 [144/250 18432/32000 (58%)] Loss: 1.01597 (QuantReg: 15.76184) QuantErr: 15.76184 batch_time=0.51655 
Train Epoch: 37 [155/250 19840/32000 (62%)] Loss: 0.78582 (QuantReg: 15.70597) QuantErr: 15.70597 batch_time=0.51738 
Train Epoch: 37 [166/250 21248/32000 (66%)] Loss: 0.76623 (QuantReg: 15.90211) QuantErr: 15.90211 batch_time=0.51465 
Train Epoch: 37 [177/250 22656/32000 (71%)] Loss: 0.92250 (QuantReg: 15.99821) QuantErr: 15.99821 batch_time=0.55311 
Train Epoch: 37 [188/250 24064/32000 (75%)] Loss: 1.00139 (QuantReg: 15.74870) QuantErr: 15.74870 batch_time=0.52407 
Train Epoch: 37 [199/250 25472/32000 (80%)] Loss: 0.78203 (QuantReg: 16.10174) QuantErr: 16.10174 batch_time=0.51039 
Train Epoch: 37 [210/250 26880/32000 (84%)] Loss: 0.99158 (QuantReg: 15.87350) QuantErr: 15.87350 batch_time=0.51792 
Train Epoch: 37 [221/250 28288/32000 (88%)] Loss: 0.75590 (QuantReg: 16.36189) QuantErr: 16.36189 batch_time=0.51336 
Train Epoch: 37 [232/250 29696/32000 (93%)] Loss: 1.06116 (QuantReg: 15.60568) QuantErr: 15.60568 batch_time=0.52216 
Train Epoch: 37 [243/250 31104/32000 (97%)] Loss: 0.70315 (QuantReg: 16.15632) QuantErr: 16.15632 batch_time=0.54048 
Train Epoch: 37 codebook_update_time=1.95958
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch37.pth ...
Done in 8.539s
removing stale ckpt [epoch 36] [took 0.00s]
 epoch          : 37
 loss           : 0.8153117527961731
 quant_reg      : 15.905914489746094
 quant_err      : 15.905914489746094
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 9250
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 73.03822937625755
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.698189134808853
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.06860924729432
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.1368209255533195
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.02708277593675
 MSRVTT_full_test/t2v_metrics/R1: 13.478260869565217
 MSRVTT_full_test/t2v_metrics/R5: 35.719063545150505
 MSRVTT_full_test/t2v_metrics/R10: 50.06688963210702
 MSRVTT_full_test/t2v_metrics/R50: 80.13377926421404
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.021070234113715
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.886494712223364
 MSRVTT_full_test/v2t_metrics/R1: 15.785953177257525
 MSRVTT_full_test/v2t_metrics/R5: 43.812709030100336
 MSRVTT_full_test/v2t_metrics/R10: 58.76254180602007
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.31153846153846
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.38142162994411
 mnt_best       : 30.010342305584274
 not_improved_count: 4
Train Epoch: 38 [1/250 128/32000 (0%)] Loss: 0.92704 (QuantReg: 15.84357) QuantErr: 15.84357 batch_time=37.28114 
Train Epoch: 38 [12/250 1536/32000 (5%)] Loss: 0.76715 (QuantReg: 16.01461) QuantErr: 16.01461 batch_time=0.55048 
Train Epoch: 38 [23/250 2944/32000 (9%)] Loss: 0.58642 (QuantReg: 15.92600) QuantErr: 15.92600 batch_time=0.50404 
Train Epoch: 38 [34/250 4352/32000 (14%)] Loss: 0.82106 (QuantReg: 15.87570) QuantErr: 15.87570 batch_time=0.50392 
Train Epoch: 38 [45/250 5760/32000 (18%)] Loss: 0.91189 (QuantReg: 15.84486) QuantErr: 15.84486 batch_time=0.51649 
Train Epoch: 38 [56/250 7168/32000 (22%)] Loss: 0.96959 (QuantReg: 16.01270) QuantErr: 16.01270 batch_time=0.49784 
Train Epoch: 38 [67/250 8576/32000 (27%)] Loss: 0.81999 (QuantReg: 15.74141) QuantErr: 15.74141 batch_time=0.50216 
Train Epoch: 38 [78/250 9984/32000 (31%)] Loss: 0.59378 (QuantReg: 16.16617) QuantErr: 16.16617 batch_time=0.54541 
Train Epoch: 38 [89/250 11392/32000 (36%)] Loss: 0.65732 (QuantReg: 15.99120) QuantErr: 15.99120 batch_time=0.50759 
Train Epoch: 38 [100/250 12800/32000 (40%)] Loss: 0.59924 (QuantReg: 16.20472) QuantErr: 16.20472 batch_time=0.50839 
Train Epoch: 38 [111/250 14208/32000 (44%)] Loss: 0.92821 (QuantReg: 15.78723) QuantErr: 15.78723 batch_time=0.51036 
Train Epoch: 38 [122/250 15616/32000 (49%)] Loss: 0.86627 (QuantReg: 15.77039) QuantErr: 15.77039 batch_time=0.50690 
Train Epoch: 38 [133/250 17024/32000 (53%)] Loss: 0.80088 (QuantReg: 16.06184) QuantErr: 16.06184 batch_time=0.51225 
Train Epoch: 38 [144/250 18432/32000 (58%)] Loss: 0.79978 (QuantReg: 15.88798) QuantErr: 15.88798 batch_time=0.51412 
Train Epoch: 38 [155/250 19840/32000 (62%)] Loss: 0.62327 (QuantReg: 16.22132) QuantErr: 16.22132 batch_time=0.50294 
Train Epoch: 38 [166/250 21248/32000 (66%)] Loss: 0.89674 (QuantReg: 15.84307) QuantErr: 15.84307 batch_time=0.52134 
Train Epoch: 38 [177/250 22656/32000 (71%)] Loss: 0.75662 (QuantReg: 15.90761) QuantErr: 15.90761 batch_time=0.50430 
Train Epoch: 38 [188/250 24064/32000 (75%)] Loss: 0.87111 (QuantReg: 16.07361) QuantErr: 16.07361 batch_time=0.50948 
Train Epoch: 38 [199/250 25472/32000 (80%)] Loss: 0.77654 (QuantReg: 15.87975) QuantErr: 15.87975 batch_time=0.51689 
Train Epoch: 38 [210/250 26880/32000 (84%)] Loss: 0.81661 (QuantReg: 15.84176) QuantErr: 15.84176 batch_time=0.50868 
Train Epoch: 38 [221/250 28288/32000 (88%)] Loss: 0.87076 (QuantReg: 16.08201) QuantErr: 16.08201 batch_time=0.50667 
Train Epoch: 38 [232/250 29696/32000 (93%)] Loss: 0.70448 (QuantReg: 15.75932) QuantErr: 15.75932 batch_time=0.50285 
Train Epoch: 38 [243/250 31104/32000 (97%)] Loss: 0.71267 (QuantReg: 16.08140) QuantErr: 16.08140 batch_time=0.49858 
Train Epoch: 38 codebook_update_time=1.68963
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch38.pth ...
Done in 4.209s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 0.7967770192623138
 quant_reg      : 15.942020343780518
 quant_err      : 15.942020343780518
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.237424547283702
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.40616623112189
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.818913480885312
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.03431473126028
 MSRVTT_full_test/t2v_metrics/R1: 12.307692307692308
 MSRVTT_full_test/t2v_metrics/R5: 36.35451505016722
 MSRVTT_full_test/t2v_metrics/R10: 49.49832775919732
 MSRVTT_full_test/t2v_metrics/R50: 79.49832775919732
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.16220735785953
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.082892514257118
 MSRVTT_full_test/v2t_metrics/R1: 16.120401337792643
 MSRVTT_full_test/v2t_metrics/R5: 43.87959866220736
 MSRVTT_full_test/v2t_metrics/R10: 58.561872909699
 MSRVTT_full_test/v2t_metrics/R50: 86.52173913043478
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.930434782608696
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.600668114683685
 mnt_best       : 30.010342305584274
 not_improved_count: 5
Train Epoch: 39 [1/250 128/32000 (0%)] Loss: 0.90241 (QuantReg: 16.06859) QuantErr: 16.06859 batch_time=35.41490 
Train Epoch: 39 [12/250 1536/32000 (5%)] Loss: 0.94858 (QuantReg: 15.81013) QuantErr: 15.81013 batch_time=0.54234 
Train Epoch: 39 [23/250 2944/32000 (9%)] Loss: 0.66001 (QuantReg: 15.91640) QuantErr: 15.91640 batch_time=0.50830 
Train Epoch: 39 [34/250 4352/32000 (14%)] Loss: 0.98354 (QuantReg: 16.07678) QuantErr: 16.07678 batch_time=0.51447 
Train Epoch: 39 [45/250 5760/32000 (18%)] Loss: 0.66257 (QuantReg: 15.79832) QuantErr: 15.79832 batch_time=0.55194 
Train Epoch: 39 [56/250 7168/32000 (22%)] Loss: 0.68435 (QuantReg: 15.98407) QuantErr: 15.98407 batch_time=0.51020 
Train Epoch: 39 [67/250 8576/32000 (27%)] Loss: 0.69291 (QuantReg: 15.87504) QuantErr: 15.87504 batch_time=0.51736 
Train Epoch: 39 [78/250 9984/32000 (31%)] Loss: 0.59033 (QuantReg: 16.13064) QuantErr: 16.13064 batch_time=0.71974 
Train Epoch: 39 [89/250 11392/32000 (36%)] Loss: 0.63562 (QuantReg: 15.79721) QuantErr: 15.79721 batch_time=0.55296 
Train Epoch: 39 [100/250 12800/32000 (40%)] Loss: 0.69930 (QuantReg: 16.20242) QuantErr: 16.20242 batch_time=0.51963 
Train Epoch: 39 [111/250 14208/32000 (44%)] Loss: 0.61896 (QuantReg: 15.88315) QuantErr: 15.88315 batch_time=0.50488 
Train Epoch: 39 [122/250 15616/32000 (49%)] Loss: 0.61882 (QuantReg: 16.30003) QuantErr: 16.30003 batch_time=0.73887 
Train Epoch: 39 [133/250 17024/32000 (53%)] Loss: 0.83238 (QuantReg: 16.03750) QuantErr: 16.03750 batch_time=0.50682 
Train Epoch: 39 [144/250 18432/32000 (58%)] Loss: 0.89386 (QuantReg: 15.70218) QuantErr: 15.70218 batch_time=2.20876 
Train Epoch: 39 [155/250 19840/32000 (62%)] Loss: 0.71049 (QuantReg: 15.85899) QuantErr: 15.85899 batch_time=0.52259 
Train Epoch: 39 [166/250 21248/32000 (66%)] Loss: 0.56742 (QuantReg: 16.07706) QuantErr: 16.07706 batch_time=0.50514 
Train Epoch: 39 [177/250 22656/32000 (71%)] Loss: 0.73167 (QuantReg: 16.24235) QuantErr: 16.24235 batch_time=0.50595 
Train Epoch: 39 [188/250 24064/32000 (75%)] Loss: 0.80700 (QuantReg: 15.82185) QuantErr: 15.82185 batch_time=0.51017 
Train Epoch: 39 [199/250 25472/32000 (80%)] Loss: 0.66953 (QuantReg: 16.21862) QuantErr: 16.21862 batch_time=0.50668 
Train Epoch: 39 [210/250 26880/32000 (84%)] Loss: 0.75287 (QuantReg: 16.46850) QuantErr: 16.46850 batch_time=1.80164 
Train Epoch: 39 [221/250 28288/32000 (88%)] Loss: 0.78164 (QuantReg: 16.18755) QuantErr: 16.18755 batch_time=0.52959 
Train Epoch: 39 [232/250 29696/32000 (93%)] Loss: 0.59720 (QuantReg: 16.35186) QuantErr: 16.35186 batch_time=1.38307 
Train Epoch: 39 [243/250 31104/32000 (97%)] Loss: 0.69629 (QuantReg: 16.02779) QuantErr: 16.02779 batch_time=0.73333 
Train Epoch: 39 codebook_update_time=1.76958
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch39.pth ...
Done in 3.996s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 0.7750494577884675
 quant_reg      : 16.028795692443847
 quant_err      : 16.028795692443847
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 9750
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 73.03822937625755
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.730382293762576
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.53942929636464
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.907444668008048
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.93602706374773
 MSRVTT_full_test/t2v_metrics/R1: 13.612040133779264
 MSRVTT_full_test/t2v_metrics/R5: 36.82274247491639
 MSRVTT_full_test/t2v_metrics/R10: 49.7324414715719
 MSRVTT_full_test/t2v_metrics/R50: 80.13377926421404
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.50200668896321
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.21189363114097
 MSRVTT_full_test/v2t_metrics/R1: 16.02006688963211
 MSRVTT_full_test/v2t_metrics/R5: 44.247491638795985
 MSRVTT_full_test/v2t_metrics/R10: 58.99665551839465
 MSRVTT_full_test/v2t_metrics/R50: 86.95652173913044
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.26220735785953
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.71044044124251
 mnt_best       : 30.010342305584274
 not_improved_count: 6
Train Epoch: 40 [1/250 128/32000 (0%)] Loss: 0.81200 (QuantReg: 16.00931) QuantErr: 16.00931 batch_time=35.85153 
Train Epoch: 40 [12/250 1536/32000 (5%)] Loss: 0.79112 (QuantReg: 16.06882) QuantErr: 16.06882 batch_time=7.91758 
Train Epoch: 40 [23/250 2944/32000 (9%)] Loss: 0.77815 (QuantReg: 15.96714) QuantErr: 15.96714 batch_time=0.52635 
Train Epoch: 40 [34/250 4352/32000 (14%)] Loss: 0.72067 (QuantReg: 15.89235) QuantErr: 15.89235 batch_time=0.51263 
Train Epoch: 40 [45/250 5760/32000 (18%)] Loss: 0.93584 (QuantReg: 15.86232) QuantErr: 15.86232 batch_time=0.51403 
Train Epoch: 40 [56/250 7168/32000 (22%)] Loss: 0.96082 (QuantReg: 16.21065) QuantErr: 16.21065 batch_time=0.51174 
Train Epoch: 40 [67/250 8576/32000 (27%)] Loss: 0.86390 (QuantReg: 16.02258) QuantErr: 16.02258 batch_time=0.51746 
Train Epoch: 40 [78/250 9984/32000 (31%)] Loss: 0.69502 (QuantReg: 16.23616) QuantErr: 16.23616 batch_time=0.51164 
Train Epoch: 40 [89/250 11392/32000 (36%)] Loss: 1.11336 (QuantReg: 15.74550) QuantErr: 15.74550 batch_time=0.51387 
Train Epoch: 40 [100/250 12800/32000 (40%)] Loss: 0.61561 (QuantReg: 15.92028) QuantErr: 15.92028 batch_time=0.51698 
Train Epoch: 40 [111/250 14208/32000 (44%)] Loss: 0.74513 (QuantReg: 15.92025) QuantErr: 15.92025 batch_time=0.50838 
Train Epoch: 40 [122/250 15616/32000 (49%)] Loss: 0.62395 (QuantReg: 16.03361) QuantErr: 16.03361 batch_time=0.51727 
Train Epoch: 40 [133/250 17024/32000 (53%)] Loss: 0.85829 (QuantReg: 16.11704) QuantErr: 16.11704 batch_time=0.51083 
Train Epoch: 40 [144/250 18432/32000 (58%)] Loss: 0.76566 (QuantReg: 15.91540) QuantErr: 15.91540 batch_time=0.50995 
Train Epoch: 40 [155/250 19840/32000 (62%)] Loss: 0.82483 (QuantReg: 16.07299) QuantErr: 16.07299 batch_time=0.62415 
Train Epoch: 40 [166/250 21248/32000 (66%)] Loss: 1.00959 (QuantReg: 15.97951) QuantErr: 15.97951 batch_time=0.50074 
Train Epoch: 40 [177/250 22656/32000 (71%)] Loss: 0.89324 (QuantReg: 16.07601) QuantErr: 16.07601 batch_time=0.51004 
Train Epoch: 40 [188/250 24064/32000 (75%)] Loss: 1.11518 (QuantReg: 15.94688) QuantErr: 15.94688 batch_time=0.51444 
Train Epoch: 40 [199/250 25472/32000 (80%)] Loss: 0.83759 (QuantReg: 16.05171) QuantErr: 16.05171 batch_time=0.50952 
Train Epoch: 40 [210/250 26880/32000 (84%)] Loss: 0.76582 (QuantReg: 16.00019) QuantErr: 16.00019 batch_time=0.54926 
Train Epoch: 40 [221/250 28288/32000 (88%)] Loss: 0.74486 (QuantReg: 16.18826) QuantErr: 16.18826 batch_time=0.50976 
Train Epoch: 40 [232/250 29696/32000 (93%)] Loss: 0.92552 (QuantReg: 15.93989) QuantErr: 15.93989 batch_time=0.56472 
Train Epoch: 40 [243/250 31104/32000 (97%)] Loss: 0.75120 (QuantReg: 15.83031) QuantErr: 15.83031 batch_time=0.50517 
Train Epoch: 40 codebook_update_time=1.74362
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch40.pth ...
Done in 4.210s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 0.7926914470195771
 quant_reg      : 16.02171457672119
 quant_err      : 16.02171457672119
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.46881287726358
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.79904838258233
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.237424547283702
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.02048517200912
 MSRVTT_full_test/t2v_metrics/R1: 13.311036789297658
 MSRVTT_full_test/t2v_metrics/R5: 37.19063545150502
 MSRVTT_full_test/t2v_metrics/R10: 50.36789297658863
 MSRVTT_full_test/t2v_metrics/R50: 79.66555183946488
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.17056856187291
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.21458728500271
 MSRVTT_full_test/v2t_metrics/R1: 15.752508361204013
 MSRVTT_full_test/v2t_metrics/R5: 44.147157190635454
 MSRVTT_full_test/v2t_metrics/R10: 58.69565217391305
 MSRVTT_full_test/v2t_metrics/R50: 86.42140468227424
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.56220735785953
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.431250660967656
 mnt_best       : 30.010342305584274
 not_improved_count: 7
Train Epoch: 41 [1/250 128/32000 (0%)] Loss: 0.87397 (QuantReg: 15.85189) QuantErr: 15.85189 batch_time=37.66322 
Train Epoch: 41 [12/250 1536/32000 (5%)] Loss: 0.94446 (QuantReg: 15.67366) QuantErr: 15.67366 batch_time=0.52217 
Train Epoch: 41 [23/250 2944/32000 (9%)] Loss: 0.79869 (QuantReg: 16.07437) QuantErr: 16.07437 batch_time=0.51853 
Train Epoch: 41 [34/250 4352/32000 (14%)] Loss: 0.88724 (QuantReg: 16.00207) QuantErr: 16.00207 batch_time=0.50950 
Train Epoch: 41 [45/250 5760/32000 (18%)] Loss: 0.45436 (QuantReg: 16.04689) QuantErr: 16.04689 batch_time=0.52803 
Train Epoch: 41 [56/250 7168/32000 (22%)] Loss: 0.86375 (QuantReg: 15.60504) QuantErr: 15.60504 batch_time=0.50390 
Train Epoch: 41 [67/250 8576/32000 (27%)] Loss: 1.05545 (QuantReg: 15.62996) QuantErr: 15.62996 batch_time=0.52643 
Train Epoch: 41 [78/250 9984/32000 (31%)] Loss: 0.71994 (QuantReg: 16.09771) QuantErr: 16.09771 batch_time=0.52382 
Train Epoch: 41 [89/250 11392/32000 (36%)] Loss: 0.77837 (QuantReg: 16.11593) QuantErr: 16.11593 batch_time=0.53557 
Train Epoch: 41 [100/250 12800/32000 (40%)] Loss: 0.60233 (QuantReg: 16.29374) QuantErr: 16.29374 batch_time=0.50934 
Train Epoch: 41 [111/250 14208/32000 (44%)] Loss: 0.89299 (QuantReg: 16.00466) QuantErr: 16.00466 batch_time=0.49908 
Train Epoch: 41 [122/250 15616/32000 (49%)] Loss: 0.85192 (QuantReg: 16.05619) QuantErr: 16.05619 batch_time=0.58628 
Train Epoch: 41 [133/250 17024/32000 (53%)] Loss: 0.65330 (QuantReg: 16.18209) QuantErr: 16.18209 batch_time=0.74198 
Train Epoch: 41 [144/250 18432/32000 (58%)] Loss: 0.63620 (QuantReg: 16.07147) QuantErr: 16.07147 batch_time=0.52138 
Train Epoch: 41 [155/250 19840/32000 (62%)] Loss: 0.80567 (QuantReg: 16.08654) QuantErr: 16.08654 batch_time=0.51936 
Train Epoch: 41 [166/250 21248/32000 (66%)] Loss: 0.75917 (QuantReg: 16.23032) QuantErr: 16.23032 batch_time=0.49692 
Train Epoch: 41 [177/250 22656/32000 (71%)] Loss: 0.86074 (QuantReg: 16.07048) QuantErr: 16.07048 batch_time=0.49481 
Train Epoch: 41 [188/250 24064/32000 (75%)] Loss: 0.94801 (QuantReg: 15.99893) QuantErr: 15.99893 batch_time=0.52075 
Train Epoch: 41 [199/250 25472/32000 (80%)] Loss: 0.71091 (QuantReg: 15.94265) QuantErr: 15.94265 batch_time=0.50961 
Train Epoch: 41 [210/250 26880/32000 (84%)] Loss: 0.69271 (QuantReg: 16.27373) QuantErr: 16.27373 batch_time=0.50178 
Train Epoch: 41 [221/250 28288/32000 (88%)] Loss: 0.79315 (QuantReg: 16.13568) QuantErr: 16.13568 batch_time=0.52502 
Train Epoch: 41 [232/250 29696/32000 (93%)] Loss: 0.73557 (QuantReg: 16.20527) QuantErr: 16.20527 batch_time=0.49864 
Train Epoch: 41 [243/250 31104/32000 (97%)] Loss: 0.95346 (QuantReg: 16.01051) QuantErr: 16.01051 batch_time=0.51244 
Train Epoch: 41 codebook_update_time=2.02854
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch41.pth ...
Done in 4.340s
removing stale ckpt [epoch 40] [took 0.08s]
 epoch          : 41
 loss           : 0.7979262294769287
 quant_reg      : 16.078081062316894
 quant_err      : 16.078081062316894
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 10250
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.824949698189135
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.64263102132182
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.818913480885312
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.47621554409965
 MSRVTT_full_test/t2v_metrics/R1: 13.74581939799331
 MSRVTT_full_test/t2v_metrics/R5: 37.458193979933114
 MSRVTT_full_test/t2v_metrics/R10: 50.635451505016725
 MSRVTT_full_test/t2v_metrics/R50: 80.06688963210702
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.55284280936455
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.652231693819164
 MSRVTT_full_test/v2t_metrics/R1: 16.65551839464883
 MSRVTT_full_test/v2t_metrics/R5: 44.414715719063544
 MSRVTT_full_test/v2t_metrics/R10: 59.23076923076923
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.95484949832776
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.25419518619928
 mnt_best       : 30.010342305584274
 not_improved_count: 8
Train Epoch: 42 [1/250 128/32000 (0%)] Loss: 0.75831 (QuantReg: 15.84440) QuantErr: 15.84440 batch_time=37.37034 
Train Epoch: 42 [12/250 1536/32000 (5%)] Loss: 0.77511 (QuantReg: 15.90892) QuantErr: 15.90892 batch_time=0.51902 
Train Epoch: 42 [23/250 2944/32000 (9%)] Loss: 0.76699 (QuantReg: 16.00538) QuantErr: 16.00538 batch_time=0.50356 
Train Epoch: 42 [34/250 4352/32000 (14%)] Loss: 0.72877 (QuantReg: 16.26972) QuantErr: 16.26972 batch_time=0.52338 
Train Epoch: 42 [45/250 5760/32000 (18%)] Loss: 0.86441 (QuantReg: 16.15681) QuantErr: 16.15681 batch_time=0.50725 
Train Epoch: 42 [56/250 7168/32000 (22%)] Loss: 0.80740 (QuantReg: 16.14363) QuantErr: 16.14363 batch_time=0.52531 
Train Epoch: 42 [67/250 8576/32000 (27%)] Loss: 0.65517 (QuantReg: 16.21370) QuantErr: 16.21370 batch_time=0.50183 
Train Epoch: 42 [78/250 9984/32000 (31%)] Loss: 0.96393 (QuantReg: 15.96284) QuantErr: 15.96284 batch_time=0.51657 
Train Epoch: 42 [89/250 11392/32000 (36%)] Loss: 0.83190 (QuantReg: 16.04300) QuantErr: 16.04300 batch_time=0.51808 
Train Epoch: 42 [100/250 12800/32000 (40%)] Loss: 0.77852 (QuantReg: 16.30977) QuantErr: 16.30977 batch_time=0.55081 
Train Epoch: 42 [111/250 14208/32000 (44%)] Loss: 0.94826 (QuantReg: 16.10751) QuantErr: 16.10751 batch_time=0.62910 
Train Epoch: 42 [122/250 15616/32000 (49%)] Loss: 1.05776 (QuantReg: 16.35321) QuantErr: 16.35321 batch_time=0.53787 
Train Epoch: 42 [133/250 17024/32000 (53%)] Loss: 0.74957 (QuantReg: 16.15493) QuantErr: 16.15493 batch_time=0.53942 
Train Epoch: 42 [144/250 18432/32000 (58%)] Loss: 0.73718 (QuantReg: 16.02589) QuantErr: 16.02589 batch_time=0.53909 
Train Epoch: 42 [155/250 19840/32000 (62%)] Loss: 1.01947 (QuantReg: 16.07640) QuantErr: 16.07640 batch_time=0.51297 
Train Epoch: 42 [166/250 21248/32000 (66%)] Loss: 0.76866 (QuantReg: 16.08737) QuantErr: 16.08737 batch_time=0.50615 
Train Epoch: 42 [177/250 22656/32000 (71%)] Loss: 0.98553 (QuantReg: 16.07833) QuantErr: 16.07833 batch_time=0.52729 
Train Epoch: 42 [188/250 24064/32000 (75%)] Loss: 0.72547 (QuantReg: 16.07822) QuantErr: 16.07822 batch_time=0.52173 
Train Epoch: 42 [199/250 25472/32000 (80%)] Loss: 0.76613 (QuantReg: 16.37337) QuantErr: 16.37337 batch_time=0.50483 
Train Epoch: 42 [210/250 26880/32000 (84%)] Loss: 0.85137 (QuantReg: 16.13311) QuantErr: 16.13311 batch_time=1.71106 
Train Epoch: 42 [221/250 28288/32000 (88%)] Loss: 0.63016 (QuantReg: 16.22002) QuantErr: 16.22002 batch_time=0.51913 
Train Epoch: 42 [232/250 29696/32000 (93%)] Loss: 0.85952 (QuantReg: 16.06927) QuantErr: 16.06927 batch_time=0.59226 
Train Epoch: 42 [243/250 31104/32000 (97%)] Loss: 0.60875 (QuantReg: 16.13875) QuantErr: 16.13875 batch_time=0.59212 
Train Epoch: 42 codebook_update_time=1.93795
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch42.pth ...
Done in 4.198s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 0.7982240756750106
 quant_reg      : 16.09552607345581
 quant_err      : 16.09552607345581
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 36.01609657947686
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.804828973843058
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.96147593703644
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.665995975855131
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.97434343442784
 MSRVTT_full_test/t2v_metrics/R1: 13.678929765886288
 MSRVTT_full_test/t2v_metrics/R5: 37.458193979933114
 MSRVTT_full_test/t2v_metrics/R10: 50.96989966555184
 MSRVTT_full_test/t2v_metrics/R50: 81.1371237458194
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.968227424749166
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.669091246348632
 MSRVTT_full_test/v2t_metrics/R1: 16.82274247491639
 MSRVTT_full_test/v2t_metrics/R5: 44.013377926421406
 MSRVTT_full_test/v2t_metrics/R10: 59.531772575250834
 MSRVTT_full_test/v2t_metrics/R50: 86.65551839464882
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.459866220735787
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.32456077603074
 mnt_best       : 30.010342305584274
 not_improved_count: 9
Train Epoch: 43 [1/250 128/32000 (0%)] Loss: 0.95519 (QuantReg: 16.16320) QuantErr: 16.16320 batch_time=39.17415 
Train Epoch: 43 [12/250 1536/32000 (5%)] Loss: 0.91858 (QuantReg: 16.08674) QuantErr: 16.08674 batch_time=0.50875 
Train Epoch: 43 [23/250 2944/32000 (9%)] Loss: 0.83361 (QuantReg: 15.98929) QuantErr: 15.98929 batch_time=0.66438 
Train Epoch: 43 [34/250 4352/32000 (14%)] Loss: 0.71147 (QuantReg: 16.24961) QuantErr: 16.24961 batch_time=0.50092 
Train Epoch: 43 [45/250 5760/32000 (18%)] Loss: 0.84672 (QuantReg: 16.20486) QuantErr: 16.20486 batch_time=0.52460 
Train Epoch: 43 [56/250 7168/32000 (22%)] Loss: 0.77125 (QuantReg: 16.31932) QuantErr: 16.31932 batch_time=0.51269 
Train Epoch: 43 [67/250 8576/32000 (27%)] Loss: 0.66602 (QuantReg: 16.02016) QuantErr: 16.02016 batch_time=0.49785 
Train Epoch: 43 [78/250 9984/32000 (31%)] Loss: 0.77517 (QuantReg: 16.15662) QuantErr: 16.15662 batch_time=0.53279 
Train Epoch: 43 [89/250 11392/32000 (36%)] Loss: 0.86913 (QuantReg: 16.14101) QuantErr: 16.14101 batch_time=0.50425 
Train Epoch: 43 [100/250 12800/32000 (40%)] Loss: 0.80865 (QuantReg: 16.06999) QuantErr: 16.06999 batch_time=0.51360 
Train Epoch: 43 [111/250 14208/32000 (44%)] Loss: 1.00105 (QuantReg: 16.21379) QuantErr: 16.21379 batch_time=0.52243 
Train Epoch: 43 [122/250 15616/32000 (49%)] Loss: 1.08709 (QuantReg: 15.98336) QuantErr: 15.98336 batch_time=0.51280 
Train Epoch: 43 [133/250 17024/32000 (53%)] Loss: 0.80373 (QuantReg: 16.26680) QuantErr: 16.26680 batch_time=0.50137 
Train Epoch: 43 [144/250 18432/32000 (58%)] Loss: 0.59523 (QuantReg: 16.16816) QuantErr: 16.16816 batch_time=0.50275 
Train Epoch: 43 [155/250 19840/32000 (62%)] Loss: 0.91981 (QuantReg: 16.14732) QuantErr: 16.14732 batch_time=0.49803 
Train Epoch: 43 [166/250 21248/32000 (66%)] Loss: 0.79613 (QuantReg: 16.11819) QuantErr: 16.11819 batch_time=0.56524 
Train Epoch: 43 [177/250 22656/32000 (71%)] Loss: 0.70531 (QuantReg: 16.03078) QuantErr: 16.03078 batch_time=0.54573 
Train Epoch: 43 [188/250 24064/32000 (75%)] Loss: 0.78703 (QuantReg: 16.16683) QuantErr: 16.16683 batch_time=0.51459 
Train Epoch: 43 [199/250 25472/32000 (80%)] Loss: 0.54511 (QuantReg: 16.27726) QuantErr: 16.27726 batch_time=2.31460 
Train Epoch: 43 [210/250 26880/32000 (84%)] Loss: 0.77441 (QuantReg: 16.38478) QuantErr: 16.38478 batch_time=0.87539 
Train Epoch: 43 [221/250 28288/32000 (88%)] Loss: 0.92776 (QuantReg: 16.27157) QuantErr: 16.27157 batch_time=0.50707 
Train Epoch: 43 [232/250 29696/32000 (93%)] Loss: 0.68717 (QuantReg: 16.09064) QuantErr: 16.09064 batch_time=0.51323 
Train Epoch: 43 [243/250 31104/32000 (97%)] Loss: 0.95700 (QuantReg: 16.15269) QuantErr: 16.15269 batch_time=0.49947 
Train Epoch: 43 codebook_update_time=1.84866
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch43.pth ...
Done in 4.058s
removing stale ckpt [epoch 42] [took 0.00s]
 epoch          : 43
 loss           : 0.7852059967517853
 quant_reg      : 16.123239151000977
 quant_err      : 16.123239151000977
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 10750
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.54728370221328
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.81344855666956
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.7847082494969815
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.35276588578414
 MSRVTT_full_test/t2v_metrics/R1: 13.879598662207357
 MSRVTT_full_test/t2v_metrics/R5: 37.25752508361204
 MSRVTT_full_test/t2v_metrics/R10: 50.13377926421405
 MSRVTT_full_test/t2v_metrics/R50: 80.3010033444816
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.68996655518394
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.596506554087824
 MSRVTT_full_test/v2t_metrics/R1: 16.588628762541806
 MSRVTT_full_test/v2t_metrics/R5: 45.18394648829432
 MSRVTT_full_test/v2t_metrics/R10: 59.79933110367893
 MSRVTT_full_test/v2t_metrics/R50: 86.68896321070234
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.91304347826087
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.52196578869846
 mnt_best       : 30.010342305584274
 not_improved_count: 10
Train Epoch: 44 [1/250 128/32000 (0%)] Loss: 0.53402 (QuantReg: 16.30028) QuantErr: 16.30028 batch_time=37.47157 
Train Epoch: 44 [12/250 1536/32000 (5%)] Loss: 0.59761 (QuantReg: 16.06598) QuantErr: 16.06598 batch_time=0.50478 
Train Epoch: 44 [23/250 2944/32000 (9%)] Loss: 0.63715 (QuantReg: 16.09130) QuantErr: 16.09130 batch_time=0.65452 
Train Epoch: 44 [34/250 4352/32000 (14%)] Loss: 0.73153 (QuantReg: 16.08972) QuantErr: 16.08972 batch_time=0.51758 
Train Epoch: 44 [45/250 5760/32000 (18%)] Loss: 0.91078 (QuantReg: 16.16870) QuantErr: 16.16870 batch_time=0.51576 
Train Epoch: 44 [56/250 7168/32000 (22%)] Loss: 0.60737 (QuantReg: 15.80736) QuantErr: 15.80736 batch_time=0.49703 
Train Epoch: 44 [67/250 8576/32000 (27%)] Loss: 0.71326 (QuantReg: 16.28925) QuantErr: 16.28925 batch_time=1.64529 
Train Epoch: 44 [78/250 9984/32000 (31%)] Loss: 1.00136 (QuantReg: 16.19761) QuantErr: 16.19761 batch_time=2.98973 
Train Epoch: 44 [89/250 11392/32000 (36%)] Loss: 0.69405 (QuantReg: 16.28419) QuantErr: 16.28419 batch_time=0.98699 
Train Epoch: 44 [100/250 12800/32000 (40%)] Loss: 0.72931 (QuantReg: 16.14457) QuantErr: 16.14457 batch_time=0.50779 
Train Epoch: 44 [111/250 14208/32000 (44%)] Loss: 0.83071 (QuantReg: 16.51024) QuantErr: 16.51024 batch_time=0.51611 
Train Epoch: 44 [122/250 15616/32000 (49%)] Loss: 0.86194 (QuantReg: 16.16108) QuantErr: 16.16108 batch_time=0.52011 
Train Epoch: 44 [133/250 17024/32000 (53%)] Loss: 0.74102 (QuantReg: 16.19123) QuantErr: 16.19123 batch_time=0.51134 
Train Epoch: 44 [144/250 18432/32000 (58%)] Loss: 0.85190 (QuantReg: 15.92244) QuantErr: 15.92244 batch_time=0.52516 
Train Epoch: 44 [155/250 19840/32000 (62%)] Loss: 0.90112 (QuantReg: 16.25306) QuantErr: 16.25306 batch_time=0.51094 
Train Epoch: 44 [166/250 21248/32000 (66%)] Loss: 0.72602 (QuantReg: 16.33513) QuantErr: 16.33513 batch_time=0.50645 
Train Epoch: 44 [177/250 22656/32000 (71%)] Loss: 0.74131 (QuantReg: 15.84715) QuantErr: 15.84715 batch_time=0.49967 
Train Epoch: 44 [188/250 24064/32000 (75%)] Loss: 0.78923 (QuantReg: 15.90787) QuantErr: 15.90787 batch_time=0.50683 
Train Epoch: 44 [199/250 25472/32000 (80%)] Loss: 0.81179 (QuantReg: 16.11623) QuantErr: 16.11623 batch_time=0.52782 
Train Epoch: 44 [210/250 26880/32000 (84%)] Loss: 0.69651 (QuantReg: 16.33215) QuantErr: 16.33215 batch_time=1.06386 
Train Epoch: 44 [221/250 28288/32000 (88%)] Loss: 0.74939 (QuantReg: 16.20157) QuantErr: 16.20157 batch_time=0.60113 
Train Epoch: 44 [232/250 29696/32000 (93%)] Loss: 0.55505 (QuantReg: 16.06217) QuantErr: 16.06217 batch_time=0.51602 
Train Epoch: 44 [243/250 31104/32000 (97%)] Loss: 0.81074 (QuantReg: 16.24698) QuantErr: 16.24698 batch_time=0.52498 
Train Epoch: 44 codebook_update_time=1.96645
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch44.pth ...
Done in 4.370s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch44.pth ...
Done in 8.355s
removing stale ckpt [epoch 43] [took 0.01s]
 epoch          : 44
 loss           : 0.7801804416179657
 quant_reg      : 16.149608779907226
 quant_err      : 16.149608779907226
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 35.412474849094565
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.738430583501006
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.56903843937294
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.6519114688128775
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.40699395702902
 MSRVTT_full_test/t2v_metrics/R1: 14.11371237458194
 MSRVTT_full_test/t2v_metrics/R5: 38.2943143812709
 MSRVTT_full_test/t2v_metrics/R10: 50.76923076923077
 MSRVTT_full_test/t2v_metrics/R50: 80.0
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.901672240802675
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.161901319895293
 MSRVTT_full_test/v2t_metrics/R1: 16.321070234113712
 MSRVTT_full_test/v2t_metrics/R5: 45.45150501672241
 MSRVTT_full_test/v2t_metrics/R10: 59.79933110367893
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.63695652173913
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.39955011757668
 mnt_best       : 30.161901319895293
 not_improved_count: 0
Train Epoch: 45 [1/250 128/32000 (0%)] Loss: 0.80016 (QuantReg: 16.06585) QuantErr: 16.06585 batch_time=34.62983 
Train Epoch: 45 [12/250 1536/32000 (5%)] Loss: 0.64749 (QuantReg: 16.25156) QuantErr: 16.25156 batch_time=0.54865 
Train Epoch: 45 [23/250 2944/32000 (9%)] Loss: 0.83848 (QuantReg: 16.03408) QuantErr: 16.03408 batch_time=0.52902 
Train Epoch: 45 [34/250 4352/32000 (14%)] Loss: 0.59993 (QuantReg: 16.39151) QuantErr: 16.39151 batch_time=0.51562 
Train Epoch: 45 [45/250 5760/32000 (18%)] Loss: 0.76407 (QuantReg: 16.17680) QuantErr: 16.17680 batch_time=0.50684 
Train Epoch: 45 [56/250 7168/32000 (22%)] Loss: 0.47513 (QuantReg: 16.08198) QuantErr: 16.08198 batch_time=0.50938 
Train Epoch: 45 [67/250 8576/32000 (27%)] Loss: 0.85434 (QuantReg: 16.01054) QuantErr: 16.01054 batch_time=5.02853 
Train Epoch: 45 [78/250 9984/32000 (31%)] Loss: 1.04216 (QuantReg: 15.96775) QuantErr: 15.96775 batch_time=0.60984 
Train Epoch: 45 [89/250 11392/32000 (36%)] Loss: 0.83224 (QuantReg: 16.14500) QuantErr: 16.14500 batch_time=0.53697 
Train Epoch: 45 [100/250 12800/32000 (40%)] Loss: 0.59983 (QuantReg: 15.93662) QuantErr: 15.93662 batch_time=0.49863 
Train Epoch: 45 [111/250 14208/32000 (44%)] Loss: 0.91420 (QuantReg: 16.30141) QuantErr: 16.30141 batch_time=0.50850 
Train Epoch: 45 [122/250 15616/32000 (49%)] Loss: 0.81890 (QuantReg: 16.16551) QuantErr: 16.16551 batch_time=0.53209 
Train Epoch: 45 [133/250 17024/32000 (53%)] Loss: 0.81078 (QuantReg: 16.17829) QuantErr: 16.17829 batch_time=0.56161 
Train Epoch: 45 [144/250 18432/32000 (58%)] Loss: 0.75528 (QuantReg: 16.28402) QuantErr: 16.28402 batch_time=0.51116 
Train Epoch: 45 [155/250 19840/32000 (62%)] Loss: 0.81141 (QuantReg: 16.26599) QuantErr: 16.26599 batch_time=0.52379 
Train Epoch: 45 [166/250 21248/32000 (66%)] Loss: 0.65100 (QuantReg: 16.06024) QuantErr: 16.06024 batch_time=0.60644 
Train Epoch: 45 [177/250 22656/32000 (71%)] Loss: 0.74093 (QuantReg: 16.21754) QuantErr: 16.21754 batch_time=0.57525 
Train Epoch: 45 [188/250 24064/32000 (75%)] Loss: 0.70247 (QuantReg: 16.50184) QuantErr: 16.50184 batch_time=0.50995 
Train Epoch: 45 [199/250 25472/32000 (80%)] Loss: 0.53652 (QuantReg: 16.43390) QuantErr: 16.43390 batch_time=0.53483 
Train Epoch: 45 [210/250 26880/32000 (84%)] Loss: 0.83182 (QuantReg: 16.12716) QuantErr: 16.12716 batch_time=0.52077 
Train Epoch: 45 [221/250 28288/32000 (88%)] Loss: 0.80201 (QuantReg: 16.08386) QuantErr: 16.08386 batch_time=0.58162 
Train Epoch: 45 [232/250 29696/32000 (93%)] Loss: 0.48952 (QuantReg: 16.28167) QuantErr: 16.28167 batch_time=0.51763 
Train Epoch: 45 [243/250 31104/32000 (97%)] Loss: 0.78645 (QuantReg: 16.03121) QuantErr: 16.03121 batch_time=0.53414 
Train Epoch: 45 codebook_update_time=1.70668
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch45.pth ...
Done in 18.138s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 0.7653548872470856
 quant_reg      : 16.199973316192626
 quant_err      : 16.199973316192626
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 11250
 MSRVTT_full_val/t2v_metrics/R1: 37.42454728370221
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.619718309859155
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.45720777614964
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 78.67203219315896
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.716297786720322
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.46087658489442
 MSRVTT_full_test/t2v_metrics/R1: 13.779264214046822
 MSRVTT_full_test/t2v_metrics/R5: 37.85953177257525
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 80.13377926421404
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.744816053511705
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.794979645336426
 MSRVTT_full_test/v2t_metrics/R1: 16.989966555183948
 MSRVTT_full_test/v2t_metrics/R5: 44.64882943143812
 MSRVTT_full_test/v2t_metrics/R10: 59.76588628762542
 MSRVTT_full_test/v2t_metrics/R50: 86.12040133779264
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.72926421404682
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.65759012011889
 mnt_best       : 30.161901319895293
 not_improved_count: 1
Train Epoch: 46 [1/250 128/32000 (0%)] Loss: 0.78079 (QuantReg: 15.89922) QuantErr: 15.89922 batch_time=42.59423 
Train Epoch: 46 [12/250 1536/32000 (5%)] Loss: 0.77379 (QuantReg: 16.20284) QuantErr: 16.20284 batch_time=0.51417 
Train Epoch: 46 [23/250 2944/32000 (9%)] Loss: 0.62613 (QuantReg: 16.17996) QuantErr: 16.17996 batch_time=0.50129 
Train Epoch: 46 [34/250 4352/32000 (14%)] Loss: 0.66632 (QuantReg: 16.19332) QuantErr: 16.19332 batch_time=0.50465 
Train Epoch: 46 [45/250 5760/32000 (18%)] Loss: 0.91660 (QuantReg: 16.08576) QuantErr: 16.08576 batch_time=0.55997 
Train Epoch: 46 [56/250 7168/32000 (22%)] Loss: 0.67691 (QuantReg: 16.21723) QuantErr: 16.21723 batch_time=0.55725 
Train Epoch: 46 [67/250 8576/32000 (27%)] Loss: 0.83357 (QuantReg: 16.38101) QuantErr: 16.38101 batch_time=0.53847 
Train Epoch: 46 [78/250 9984/32000 (31%)] Loss: 0.83802 (QuantReg: 16.28344) QuantErr: 16.28344 batch_time=0.50456 
Train Epoch: 46 [89/250 11392/32000 (36%)] Loss: 0.91679 (QuantReg: 16.21534) QuantErr: 16.21534 batch_time=0.97671 
Train Epoch: 46 [100/250 12800/32000 (40%)] Loss: 0.78071 (QuantReg: 16.03172) QuantErr: 16.03172 batch_time=0.51921 
Train Epoch: 46 [111/250 14208/32000 (44%)] Loss: 0.63815 (QuantReg: 15.95441) QuantErr: 15.95441 batch_time=0.50548 
Train Epoch: 46 [122/250 15616/32000 (49%)] Loss: 0.80506 (QuantReg: 16.26923) QuantErr: 16.26923 batch_time=0.52362 
Train Epoch: 46 [133/250 17024/32000 (53%)] Loss: 0.85399 (QuantReg: 16.16465) QuantErr: 16.16465 batch_time=0.53561 
Train Epoch: 46 [144/250 18432/32000 (58%)] Loss: 0.81599 (QuantReg: 16.08749) QuantErr: 16.08749 batch_time=0.50772 
Train Epoch: 46 [155/250 19840/32000 (62%)] Loss: 0.66694 (QuantReg: 16.31494) QuantErr: 16.31494 batch_time=0.52159 
Train Epoch: 46 [166/250 21248/32000 (66%)] Loss: 0.65454 (QuantReg: 16.36418) QuantErr: 16.36418 batch_time=0.51607 
Train Epoch: 46 [177/250 22656/32000 (71%)] Loss: 0.75587 (QuantReg: 16.39242) QuantErr: 16.39242 batch_time=0.61676 
Train Epoch: 46 [188/250 24064/32000 (75%)] Loss: 0.71244 (QuantReg: 16.33911) QuantErr: 16.33911 batch_time=0.51035 
Train Epoch: 46 [199/250 25472/32000 (80%)] Loss: 0.74609 (QuantReg: 16.27343) QuantErr: 16.27343 batch_time=0.50546 
Train Epoch: 46 [210/250 26880/32000 (84%)] Loss: 0.63802 (QuantReg: 16.59628) QuantErr: 16.59628 batch_time=0.50445 
Train Epoch: 46 [221/250 28288/32000 (88%)] Loss: 0.58047 (QuantReg: 16.13717) QuantErr: 16.13717 batch_time=0.51326 
Train Epoch: 46 [232/250 29696/32000 (93%)] Loss: 0.70414 (QuantReg: 16.49713) QuantErr: 16.49713 batch_time=0.51326 
Train Epoch: 46 [243/250 31104/32000 (97%)] Loss: 0.60018 (QuantReg: 16.26308) QuantErr: 16.26308 batch_time=0.51950 
Train Epoch: 46 codebook_update_time=1.74701
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch46.pth ...
Done in 3.943s
removing stale ckpt [epoch 45] [took 0.00s]
 epoch          : 46
 loss           : 0.7777354333400727
 quant_reg      : 16.203947479248047
 quant_err      : 16.203947479248047
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.722334004024145
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.503952350301084
 MSRVTT_full_val/v2t_metrics/R1: 41.85110663983903
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.645875251509055
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.82610076441028
 MSRVTT_full_test/t2v_metrics/R1: 13.478260869565217
 MSRVTT_full_test/t2v_metrics/R5: 37.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 50.43478260869565
 MSRVTT_full_test/t2v_metrics/R50: 80.06688963210702
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.53612040133779
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.43711378329302
 MSRVTT_full_test/v2t_metrics/R1: 17.157190635451506
 MSRVTT_full_test/v2t_metrics/R5: 44.81605351170568
 MSRVTT_full_test/v2t_metrics/R10: 60.40133779264214
 MSRVTT_full_test/v2t_metrics/R50: 86.68896321070234
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.810702341137123
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.94530018508029
 mnt_best       : 30.161901319895293
 not_improved_count: 2
Train Epoch: 47 [1/250 128/32000 (0%)] Loss: 0.74466 (QuantReg: 16.38967) QuantErr: 16.38967 batch_time=38.04033 
Train Epoch: 47 [12/250 1536/32000 (5%)] Loss: 0.88823 (QuantReg: 16.05024) QuantErr: 16.05024 batch_time=0.50726 
Train Epoch: 47 [23/250 2944/32000 (9%)] Loss: 0.78880 (QuantReg: 16.03461) QuantErr: 16.03461 batch_time=0.54807 
Train Epoch: 47 [34/250 4352/32000 (14%)] Loss: 0.67355 (QuantReg: 16.15151) QuantErr: 16.15151 batch_time=0.53143 
Train Epoch: 47 [45/250 5760/32000 (18%)] Loss: 0.82743 (QuantReg: 16.40755) QuantErr: 16.40755 batch_time=0.51254 
Train Epoch: 47 [56/250 7168/32000 (22%)] Loss: 0.74110 (QuantReg: 16.01315) QuantErr: 16.01315 batch_time=0.56186 
Train Epoch: 47 [67/250 8576/32000 (27%)] Loss: 0.96266 (QuantReg: 16.17450) QuantErr: 16.17450 batch_time=0.52930 
Train Epoch: 47 [78/250 9984/32000 (31%)] Loss: 0.66449 (QuantReg: 16.08105) QuantErr: 16.08105 batch_time=0.55313 
Train Epoch: 47 [89/250 11392/32000 (36%)] Loss: 0.72683 (QuantReg: 16.35304) QuantErr: 16.35304 batch_time=0.53975 
Train Epoch: 47 [100/250 12800/32000 (40%)] Loss: 0.61667 (QuantReg: 16.15942) QuantErr: 16.15942 batch_time=0.52564 
Train Epoch: 47 [111/250 14208/32000 (44%)] Loss: 1.04019 (QuantReg: 15.95749) QuantErr: 15.95749 batch_time=0.50503 
Train Epoch: 47 [122/250 15616/32000 (49%)] Loss: 0.54783 (QuantReg: 16.24518) QuantErr: 16.24518 batch_time=0.50924 
Train Epoch: 47 [133/250 17024/32000 (53%)] Loss: 0.81034 (QuantReg: 16.51333) QuantErr: 16.51333 batch_time=0.63579 
Train Epoch: 47 [144/250 18432/32000 (58%)] Loss: 0.73407 (QuantReg: 16.22635) QuantErr: 16.22635 batch_time=0.51053 
Train Epoch: 47 [155/250 19840/32000 (62%)] Loss: 0.79852 (QuantReg: 16.15050) QuantErr: 16.15050 batch_time=0.59640 
Train Epoch: 47 [166/250 21248/32000 (66%)] Loss: 0.79785 (QuantReg: 16.42081) QuantErr: 16.42081 batch_time=0.77860 
Train Epoch: 47 [177/250 22656/32000 (71%)] Loss: 0.94495 (QuantReg: 15.93385) QuantErr: 15.93385 batch_time=0.52241 
Train Epoch: 47 [188/250 24064/32000 (75%)] Loss: 0.59031 (QuantReg: 16.24168) QuantErr: 16.24168 batch_time=0.55333 
Train Epoch: 47 [199/250 25472/32000 (80%)] Loss: 0.68001 (QuantReg: 16.12419) QuantErr: 16.12419 batch_time=0.51230 
Train Epoch: 47 [210/250 26880/32000 (84%)] Loss: 0.76146 (QuantReg: 16.28006) QuantErr: 16.28006 batch_time=0.52114 
Train Epoch: 47 [221/250 28288/32000 (88%)] Loss: 0.88012 (QuantReg: 16.26067) QuantErr: 16.26067 batch_time=0.53774 
Train Epoch: 47 [232/250 29696/32000 (93%)] Loss: 0.73211 (QuantReg: 16.21805) QuantErr: 16.21805 batch_time=0.57135 
Train Epoch: 47 [243/250 31104/32000 (97%)] Loss: 0.72542 (QuantReg: 16.24655) QuantErr: 16.24655 batch_time=0.52193 
Train Epoch: 47 codebook_update_time=1.78114
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch47.pth ...
Done in 4.384s
removing stale ckpt [epoch 46] [took 0.00s]
 epoch          : 47
 loss           : 0.7840416440963746
 quant_reg      : 16.229077495574952
 quant_err      : 16.229077495574952
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 11750
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.93158953722334
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.48723379280618
 MSRVTT_full_val/v2t_metrics/R1: 41.04627766599597
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.812877263581489
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.33853711120267
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 37.725752508361204
 MSRVTT_full_test/t2v_metrics/R10: 51.33779264214047
 MSRVTT_full_test/t2v_metrics/R50: 80.80267558528428
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.5561872909699
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.099688660326468
 MSRVTT_full_test/v2t_metrics/R1: 16.989966555183948
 MSRVTT_full_test/v2t_metrics/R5: 44.51505016722408
 MSRVTT_full_test/v2t_metrics/R10: 59.86622073578595
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.756521739130434
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.64186420858402
 mnt_best       : 30.161901319895293
 not_improved_count: 3
Train Epoch: 48 [1/250 128/32000 (0%)] Loss: 0.96086 (QuantReg: 16.00288) QuantErr: 16.00288 batch_time=34.11138 
Train Epoch: 48 [12/250 1536/32000 (5%)] Loss: 0.81282 (QuantReg: 16.42603) QuantErr: 16.42603 batch_time=0.52679 
Train Epoch: 48 [23/250 2944/32000 (9%)] Loss: 0.63814 (QuantReg: 16.28669) QuantErr: 16.28669 batch_time=0.50409 
Train Epoch: 48 [34/250 4352/32000 (14%)] Loss: 0.62917 (QuantReg: 16.35599) QuantErr: 16.35599 batch_time=0.72970 
Train Epoch: 48 [45/250 5760/32000 (18%)] Loss: 0.86950 (QuantReg: 15.92486) QuantErr: 15.92486 batch_time=0.51065 
Train Epoch: 48 [56/250 7168/32000 (22%)] Loss: 0.77864 (QuantReg: 16.44241) QuantErr: 16.44241 batch_time=0.50875 
Train Epoch: 48 [67/250 8576/32000 (27%)] Loss: 0.73017 (QuantReg: 16.40143) QuantErr: 16.40143 batch_time=0.50598 
Train Epoch: 48 [78/250 9984/32000 (31%)] Loss: 0.72084 (QuantReg: 16.15727) QuantErr: 16.15727 batch_time=0.51720 
Train Epoch: 48 [89/250 11392/32000 (36%)] Loss: 0.72931 (QuantReg: 16.25270) QuantErr: 16.25270 batch_time=0.52005 
Train Epoch: 48 [100/250 12800/32000 (40%)] Loss: 0.79179 (QuantReg: 16.22963) QuantErr: 16.22963 batch_time=0.54124 
Train Epoch: 48 [111/250 14208/32000 (44%)] Loss: 0.68950 (QuantReg: 16.25888) QuantErr: 16.25888 batch_time=0.52298 
Train Epoch: 48 [122/250 15616/32000 (49%)] Loss: 0.81289 (QuantReg: 16.21891) QuantErr: 16.21891 batch_time=0.51389 
Train Epoch: 48 [133/250 17024/32000 (53%)] Loss: 0.76420 (QuantReg: 16.09376) QuantErr: 16.09376 batch_time=0.52791 
Train Epoch: 48 [144/250 18432/32000 (58%)] Loss: 0.83369 (QuantReg: 16.20535) QuantErr: 16.20535 batch_time=3.09342 
Train Epoch: 48 [155/250 19840/32000 (62%)] Loss: 0.68666 (QuantReg: 16.57979) QuantErr: 16.57979 batch_time=0.55736 
Train Epoch: 48 [166/250 21248/32000 (66%)] Loss: 0.92017 (QuantReg: 16.00540) QuantErr: 16.00540 batch_time=0.51156 
Train Epoch: 48 [177/250 22656/32000 (71%)] Loss: 0.60889 (QuantReg: 16.34658) QuantErr: 16.34658 batch_time=0.87004 
Train Epoch: 48 [188/250 24064/32000 (75%)] Loss: 0.77634 (QuantReg: 16.25653) QuantErr: 16.25653 batch_time=0.51864 
Train Epoch: 48 [199/250 25472/32000 (80%)] Loss: 0.93540 (QuantReg: 16.37536) QuantErr: 16.37536 batch_time=1.41482 
Train Epoch: 48 [210/250 26880/32000 (84%)] Loss: 0.77682 (QuantReg: 16.44465) QuantErr: 16.44465 batch_time=0.51212 
Train Epoch: 48 [221/250 28288/32000 (88%)] Loss: 0.80171 (QuantReg: 16.24307) QuantErr: 16.24307 batch_time=0.51294 
Train Epoch: 48 [232/250 29696/32000 (93%)] Loss: 1.10315 (QuantReg: 16.43626) QuantErr: 16.43626 batch_time=0.51093 
Train Epoch: 48 [243/250 31104/32000 (97%)] Loss: 1.00387 (QuantReg: 16.05289) QuantErr: 16.05289 batch_time=0.50337 
Train Epoch: 48 codebook_update_time=2.07276
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch48.pth ...
Done in 9.846s
removing stale ckpt [epoch 47] [took 0.00s]
 epoch          : 48
 loss           : 0.7828560163974762
 quant_reg      : 16.248652542114257
 quant_err      : 16.248652542114257
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 34.40643863179074
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.798792756539235
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.856306635951306
 MSRVTT_full_val/v2t_metrics/R1: 41.24748490945674
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.802816901408451
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.46383430566094
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 50.53511705685619
 MSRVTT_full_test/t2v_metrics/R50: 80.20066889632108
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.57692307692308
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.89768651036695
 MSRVTT_full_test/v2t_metrics/R1: 16.889632107023413
 MSRVTT_full_test/v2t_metrics/R5: 44.94983277591973
 MSRVTT_full_test/v2t_metrics/R10: 59.197324414715716
 MSRVTT_full_test/v2t_metrics/R50: 87.05685618729098
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.493645484949834
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.553589143134104
 mnt_best       : 30.161901319895293
 not_improved_count: 4
Train Epoch: 49 [1/250 128/32000 (0%)] Loss: 0.65309 (QuantReg: 16.11764) QuantErr: 16.11764 batch_time=35.31457 
Train Epoch: 49 [12/250 1536/32000 (5%)] Loss: 0.63443 (QuantReg: 16.30828) QuantErr: 16.30828 batch_time=0.99734 
Train Epoch: 49 [23/250 2944/32000 (9%)] Loss: 0.80778 (QuantReg: 16.26589) QuantErr: 16.26589 batch_time=0.52016 
Train Epoch: 49 [34/250 4352/32000 (14%)] Loss: 0.79352 (QuantReg: 16.43264) QuantErr: 16.43264 batch_time=0.51632 
Train Epoch: 49 [45/250 5760/32000 (18%)] Loss: 0.60808 (QuantReg: 16.39274) QuantErr: 16.39274 batch_time=0.51294 
Train Epoch: 49 [56/250 7168/32000 (22%)] Loss: 0.92296 (QuantReg: 16.30609) QuantErr: 16.30609 batch_time=0.58758 
Train Epoch: 49 [67/250 8576/32000 (27%)] Loss: 0.74611 (QuantReg: 16.44738) QuantErr: 16.44738 batch_time=0.55618 
Train Epoch: 49 [78/250 9984/32000 (31%)] Loss: 0.70385 (QuantReg: 16.13299) QuantErr: 16.13299 batch_time=0.52026 
Train Epoch: 49 [89/250 11392/32000 (36%)] Loss: 0.93866 (QuantReg: 16.12859) QuantErr: 16.12859 batch_time=0.51963 
Train Epoch: 49 [100/250 12800/32000 (40%)] Loss: 0.73503 (QuantReg: 16.20374) QuantErr: 16.20374 batch_time=0.59548 
Train Epoch: 49 [111/250 14208/32000 (44%)] Loss: 0.77480 (QuantReg: 16.36367) QuantErr: 16.36367 batch_time=0.51383 
Train Epoch: 49 [122/250 15616/32000 (49%)] Loss: 0.94578 (QuantReg: 16.02334) QuantErr: 16.02334 batch_time=0.53470 
Train Epoch: 49 [133/250 17024/32000 (53%)] Loss: 0.93209 (QuantReg: 16.05102) QuantErr: 16.05102 batch_time=0.73406 
Train Epoch: 49 [144/250 18432/32000 (58%)] Loss: 0.85821 (QuantReg: 16.37221) QuantErr: 16.37221 batch_time=1.91234 
Train Epoch: 49 [155/250 19840/32000 (62%)] Loss: 0.75728 (QuantReg: 16.38530) QuantErr: 16.38530 batch_time=0.51046 
Train Epoch: 49 [166/250 21248/32000 (66%)] Loss: 0.79989 (QuantReg: 16.28245) QuantErr: 16.28245 batch_time=0.52820 
Train Epoch: 49 [177/250 22656/32000 (71%)] Loss: 0.71084 (QuantReg: 16.21251) QuantErr: 16.21251 batch_time=0.55515 
Train Epoch: 49 [188/250 24064/32000 (75%)] Loss: 0.80444 (QuantReg: 16.22945) QuantErr: 16.22945 batch_time=0.53773 
Train Epoch: 49 [199/250 25472/32000 (80%)] Loss: 0.75117 (QuantReg: 16.51492) QuantErr: 16.51492 batch_time=2.13580 
Train Epoch: 49 [210/250 26880/32000 (84%)] Loss: 0.88699 (QuantReg: 16.30087) QuantErr: 16.30087 batch_time=0.53547 
Train Epoch: 49 [221/250 28288/32000 (88%)] Loss: 0.90797 (QuantReg: 16.43074) QuantErr: 16.43074 batch_time=0.51524 
Train Epoch: 49 [232/250 29696/32000 (93%)] Loss: 0.57077 (QuantReg: 16.45877) QuantErr: 16.45877 batch_time=0.53952 
Train Epoch: 49 [243/250 31104/32000 (97%)] Loss: 0.69576 (QuantReg: 16.17607) QuantErr: 16.17607 batch_time=0.51091 
Train Epoch: 49 codebook_update_time=1.81752
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch49.pth ...
Done in 4.272s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 0.7803766349554062
 quant_reg      : 16.275002754211425
 quant_err      : 16.275002754211425
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 12250
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.142857142857142
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.108849459152104
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.593561368209255
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.24523465823576
 MSRVTT_full_test/t2v_metrics/R1: 13.812709030100335
 MSRVTT_full_test/t2v_metrics/R5: 37.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 50.836120401337794
 MSRVTT_full_test/t2v_metrics/R50: 80.06688963210702
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.24247491638796
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.75712553907832
 MSRVTT_full_test/v2t_metrics/R1: 16.65551839464883
 MSRVTT_full_test/v2t_metrics/R5: 44.68227424749164
 MSRVTT_full_test/v2t_metrics/R10: 59.03010033444816
 MSRVTT_full_test/v2t_metrics/R50: 86.98996655518394
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.806688963210703
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.28490738805648
 mnt_best       : 30.161901319895293
 not_improved_count: 5
Train Epoch: 50 [1/250 128/32000 (0%)] Loss: 0.73274 (QuantReg: 16.40310) QuantErr: 16.40310 batch_time=36.95418 
Train Epoch: 50 [12/250 1536/32000 (5%)] Loss: 0.62743 (QuantReg: 16.20858) QuantErr: 16.20858 batch_time=0.51258 
Train Epoch: 50 [23/250 2944/32000 (9%)] Loss: 0.77395 (QuantReg: 16.29543) QuantErr: 16.29543 batch_time=0.51376 
Train Epoch: 50 [34/250 4352/32000 (14%)] Loss: 0.67915 (QuantReg: 16.48580) QuantErr: 16.48580 batch_time=0.64963 
Train Epoch: 50 [45/250 5760/32000 (18%)] Loss: 0.97183 (QuantReg: 16.10206) QuantErr: 16.10206 batch_time=0.56482 
Train Epoch: 50 [56/250 7168/32000 (22%)] Loss: 0.63118 (QuantReg: 16.31772) QuantErr: 16.31772 batch_time=0.50496 
Train Epoch: 50 [67/250 8576/32000 (27%)] Loss: 0.67966 (QuantReg: 16.41157) QuantErr: 16.41157 batch_time=0.53013 
Train Epoch: 50 [78/250 9984/32000 (31%)] Loss: 0.89035 (QuantReg: 16.21814) QuantErr: 16.21814 batch_time=0.50586 
Train Epoch: 50 [89/250 11392/32000 (36%)] Loss: 0.74513 (QuantReg: 16.35063) QuantErr: 16.35063 batch_time=0.52203 
Train Epoch: 50 [100/250 12800/32000 (40%)] Loss: 0.69325 (QuantReg: 16.20255) QuantErr: 16.20255 batch_time=0.91564 
Train Epoch: 50 [111/250 14208/32000 (44%)] Loss: 0.79540 (QuantReg: 16.23659) QuantErr: 16.23659 batch_time=0.54580 
Train Epoch: 50 [122/250 15616/32000 (49%)] Loss: 0.75495 (QuantReg: 16.49421) QuantErr: 16.49421 batch_time=0.52283 
Train Epoch: 50 [133/250 17024/32000 (53%)] Loss: 0.71578 (QuantReg: 16.32539) QuantErr: 16.32539 batch_time=0.56967 
Train Epoch: 50 [144/250 18432/32000 (58%)] Loss: 0.86454 (QuantReg: 15.93587) QuantErr: 15.93587 batch_time=0.54633 
Train Epoch: 50 [155/250 19840/32000 (62%)] Loss: 0.90869 (QuantReg: 16.29229) QuantErr: 16.29229 batch_time=0.50427 
Train Epoch: 50 [166/250 21248/32000 (66%)] Loss: 0.56605 (QuantReg: 16.64040) QuantErr: 16.64040 batch_time=0.52164 
Train Epoch: 50 [177/250 22656/32000 (71%)] Loss: 0.79988 (QuantReg: 16.32457) QuantErr: 16.32457 batch_time=0.51811 
Train Epoch: 50 [188/250 24064/32000 (75%)] Loss: 0.89536 (QuantReg: 16.27827) QuantErr: 16.27827 batch_time=0.50579 
Train Epoch: 50 [199/250 25472/32000 (80%)] Loss: 0.54601 (QuantReg: 16.49225) QuantErr: 16.49225 batch_time=0.51304 
Train Epoch: 50 [210/250 26880/32000 (84%)] Loss: 0.87583 (QuantReg: 16.43953) QuantErr: 16.43953 batch_time=3.32385 
Train Epoch: 50 [221/250 28288/32000 (88%)] Loss: 0.79268 (QuantReg: 16.14494) QuantErr: 16.14494 batch_time=0.51437 
Train Epoch: 50 [232/250 29696/32000 (93%)] Loss: 0.79240 (QuantReg: 16.31493) QuantErr: 16.31493 batch_time=0.51289 
Train Epoch: 50 [243/250 31104/32000 (97%)] Loss: 0.74224 (QuantReg: 16.30404) QuantErr: 16.30404 batch_time=0.50788 
Train Epoch: 50 codebook_update_time=1.75803
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/checkpoint-epoch50.pth ...
Done in 4.461s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 0.7744896559715271
 quant_reg      : 16.307924732208253
 quant_err      : 16.307924732208253
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 35.814889336016094
 MSRVTT_full_val/t2v_metrics/R5: 71.42857142857143
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.855130784708249
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.53710071824128
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.744466800804829
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.89230761946675
 MSRVTT_full_test/t2v_metrics/R1: 13.545150501672241
 MSRVTT_full_test/t2v_metrics/R5: 37.625418060200666
 MSRVTT_full_test/t2v_metrics/R10: 51.070234113712374
 MSRVTT_full_test/t2v_metrics/R50: 79.79933110367892
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.48327759197324
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.63541449830244
 MSRVTT_full_test/v2t_metrics/R1: 16.05351170568562
 MSRVTT_full_test/v2t_metrics/R5: 44.34782608695652
 MSRVTT_full_test/v2t_metrics/R10: 59.096989966555185
 MSRVTT_full_test/v2t_metrics/R50: 86.22073578595318
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.3943143812709
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.780507548232976
 mnt_best       : 30.161901319895293
 not_improved_count: 6
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/trained_model.pth ...
Ckpt loaded at epoch 44.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 14.11371237458194
 t2v_metrics/R5/final_eval: 38.2943143812709
 t2v_metrics/R10/final_eval: 50.76923076923077
 t2v_metrics/R50/final_eval: 80.0
 t2v_metrics/MedR/final_eval: 10.0
 t2v_metrics/MeanR/final_eval: 45.901672240802675
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 30.161901319895293
 v2t_metrics/R1/final_eval: 16.321070234113712
 v2t_metrics/R5/final_eval: 45.45150501672241
 v2t_metrics/R10/final_eval: 59.79933110367893
 v2t_metrics/R50/final_eval: 86.8561872909699
 v2t_metrics/MedR/final_eval: 7.0
 v2t_metrics/MeanR/final_eval: 31.63695652173913
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 35.39955011757668
Best epoch for the monitored metric: 44
Script took 04h31m11s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_t0.03/trained_model.pth
