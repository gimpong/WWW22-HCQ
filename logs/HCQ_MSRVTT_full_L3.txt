Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 779.2634873390198 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 40.29928660392761 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 234.78307271003723 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 189.54125547409058 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch0.pth ...
Done in 2.973s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch0.pth ...
Done in 4.373s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.2012072434607646
 MSRVTT_full_val/t2v_metrics/R5: 1.408450704225352
 MSRVTT_full_val/t2v_metrics/R10: 2.414486921529175
 MSRVTT_full_val/t2v_metrics/R50: 11.87122736418511
 MSRVTT_full_val/t2v_metrics/MedR: 260.0
 MSRVTT_full_val/t2v_metrics/MeanR: 255.46277665995976
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.8811909738205008
 MSRVTT_full_val/v2t_metrics/R1: 0.2012072434607646
 MSRVTT_full_val/v2t_metrics/R5: 0.8048289738430584
 MSRVTT_full_val/v2t_metrics/R10: 1.6096579476861168
 MSRVTT_full_val/v2t_metrics/R50: 8.048289738430583
 MSRVTT_full_val/v2t_metrics/MedR: 256.0
 MSRVTT_full_val/v2t_metrics/MeanR: 254.8450704225352
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.6387931798664787
 MSRVTT_full_test/t2v_metrics/R1: 0.0
 MSRVTT_full_test/t2v_metrics/R5: 0.23411371237458195
 MSRVTT_full_test/t2v_metrics/R10: 0.33444816053511706
 MSRVTT_full_test/t2v_metrics/R50: 1.37123745819398
 MSRVTT_full_test/t2v_metrics/MedR: 1505.5
 MSRVTT_full_test/t2v_metrics/MeanR: 1503.0210702341137
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/v2t_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/v2t_metrics/R5: 0.13377926421404682
 MSRVTT_full_test/v2t_metrics/R10: 0.36789297658862874
 MSRVTT_full_test/v2t_metrics/R50: 1.5384615384615385
 MSRVTT_full_test/v2t_metrics/MedR: 1517.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1510.3939799331104
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.11807185067980144
 mnt_best       : 0.0
 not_improved_count: 0
Train Epoch: 1 [1/250 128/32000 (0%)] Loss: 32.85585 (QuantReg: 22.79831) QuantErr: 22.79831 batch_time=27.10723 
Train Epoch: 1 [12/250 1536/32000 (5%)] Loss: 30.24445 (QuantReg: 22.79816) QuantErr: 22.79816 batch_time=0.41417 
Train Epoch: 1 [23/250 2944/32000 (9%)] Loss: 25.95213 (QuantReg: 22.70061) QuantErr: 22.70061 batch_time=0.44227 
Train Epoch: 1 [34/250 4352/32000 (14%)] Loss: 23.20899 (QuantReg: 22.68929) QuantErr: 22.68929 batch_time=0.44028 
Train Epoch: 1 [45/250 5760/32000 (18%)] Loss: 21.87263 (QuantReg: 22.69030) QuantErr: 22.69030 batch_time=0.46217 
Train Epoch: 1 [56/250 7168/32000 (22%)] Loss: 20.50840 (QuantReg: 22.60241) QuantErr: 22.60241 batch_time=0.43017 
Train Epoch: 1 [67/250 8576/32000 (27%)] Loss: 18.98234 (QuantReg: 22.59351) QuantErr: 22.59351 batch_time=0.43487 
Train Epoch: 1 [78/250 9984/32000 (31%)] Loss: 19.21747 (QuantReg: 22.57938) QuantErr: 22.57938 batch_time=0.43519 
Train Epoch: 1 [89/250 11392/32000 (36%)] Loss: 18.31880 (QuantReg: 22.58747) QuantErr: 22.58747 batch_time=0.44302 
Train Epoch: 1 [100/250 12800/32000 (40%)] Loss: 18.24098 (QuantReg: 22.65045) QuantErr: 22.65045 batch_time=0.46865 
Train Epoch: 1 [111/250 14208/32000 (44%)] Loss: 17.85880 (QuantReg: 22.57447) QuantErr: 22.57447 batch_time=0.45083 
Train Epoch: 1 [122/250 15616/32000 (49%)] Loss: 14.92087 (QuantReg: 22.59782) QuantErr: 22.59782 batch_time=0.55086 
Train Epoch: 1 [133/250 17024/32000 (53%)] Loss: 15.72481 (QuantReg: 22.66413) QuantErr: 22.66413 batch_time=8.37643 
Train Epoch: 1 [144/250 18432/32000 (58%)] Loss: 16.75700 (QuantReg: 22.61890) QuantErr: 22.61890 batch_time=0.43899 
Train Epoch: 1 [155/250 19840/32000 (62%)] Loss: 14.59371 (QuantReg: 22.66484) QuantErr: 22.66484 batch_time=0.44155 
Train Epoch: 1 [166/250 21248/32000 (66%)] Loss: 15.56373 (QuantReg: 22.63058) QuantErr: 22.63058 batch_time=0.45319 
Train Epoch: 1 [177/250 22656/32000 (71%)] Loss: 15.68122 (QuantReg: 22.65586) QuantErr: 22.65586 batch_time=0.44552 
Train Epoch: 1 [188/250 24064/32000 (75%)] Loss: 15.27050 (QuantReg: 22.65612) QuantErr: 22.65612 batch_time=0.48328 
Train Epoch: 1 [199/250 25472/32000 (80%)] Loss: 14.09276 (QuantReg: 22.63098) QuantErr: 22.63098 batch_time=0.45889 
Train Epoch: 1 [210/250 26880/32000 (84%)] Loss: 14.03891 (QuantReg: 22.61277) QuantErr: 22.61277 batch_time=0.44215 
Train Epoch: 1 [221/250 28288/32000 (88%)] Loss: 12.75415 (QuantReg: 22.67994) QuantErr: 22.67994 batch_time=0.43350 
Train Epoch: 1 [232/250 29696/32000 (93%)] Loss: 14.71962 (QuantReg: 22.64540) QuantErr: 22.64540 batch_time=0.44640 
Train Epoch: 1 [243/250 31104/32000 (97%)] Loss: 13.93099 (QuantReg: 22.65827) QuantErr: 22.65827 batch_time=0.44139 
Train Epoch: 1 codebook_update_time=1.34918
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch1.pth ...
Done in 3.649s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch1.pth ...
Done in 7.374s
 epoch          : 1
 loss           : 18.242241424560547
 quant_reg      : 22.648892669677736
 quant_err      : 22.648892669677736
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 250
 MSRVTT_full_val/t2v_metrics/R1: 17.10261569416499
 MSRVTT_full_val/t2v_metrics/R5: 50.503018108651915
 MSRVTT_full_val/t2v_metrics/R10: 65.79476861167002
 MSRVTT_full_val/t2v_metrics/R50: 93.96378269617706
 MSRVTT_full_val/t2v_metrics/MedR: 5.0
 MSRVTT_full_val/t2v_metrics/MeanR: 13.498993963782697
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 38.446523743195385
 MSRVTT_full_val/v2t_metrics/R1: 19.517102615694164
 MSRVTT_full_val/v2t_metrics/R5: 57.947686116700204
 MSRVTT_full_val/v2t_metrics/R10: 72.63581488933602
 MSRVTT_full_val/v2t_metrics/R50: 95.17102615694165
 MSRVTT_full_val/v2t_metrics/MedR: 5.0
 MSRVTT_full_val/v2t_metrics/MeanR: 11.857142857142858
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 43.4711122904589
 MSRVTT_full_test/t2v_metrics/R1: 5.719063545150502
 MSRVTT_full_test/t2v_metrics/R5: 20.668896321070235
 MSRVTT_full_test/t2v_metrics/R10: 31.304347826086957
 MSRVTT_full_test/t2v_metrics/R50: 65.58528428093645
 MSRVTT_full_test/t2v_metrics/MedR: 25.5
 MSRVTT_full_test/t2v_metrics/MeanR: 74.09749163879599
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 15.467339674929313
 MSRVTT_full_test/v2t_metrics/R1: 6.321070234113712
 MSRVTT_full_test/v2t_metrics/R5: 23.244147157190636
 MSRVTT_full_test/v2t_metrics/R10: 35.752508361204015
 MSRVTT_full_test/v2t_metrics/R50: 71.53846153846153
 MSRVTT_full_test/v2t_metrics/MedR: 20.0
 MSRVTT_full_test/v2t_metrics/MeanR: 63.796321070234114
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 17.38348776826853
 mnt_best       : 15.467339674929313
 not_improved_count: 0
Train Epoch: 2 [1/250 128/32000 (0%)] Loss: 14.05858 (QuantReg: 11.44015) QuantErr: 11.44015 batch_time=33.85238 
Train Epoch: 2 [12/250 1536/32000 (5%)] Loss: 15.80260 (QuantReg: 11.66120) QuantErr: 11.66120 batch_time=0.48300 
Train Epoch: 2 [23/250 2944/32000 (9%)] Loss: 11.82563 (QuantReg: 11.86171) QuantErr: 11.86171 batch_time=0.48084 
Train Epoch: 2 [34/250 4352/32000 (14%)] Loss: 12.30206 (QuantReg: 12.08834) QuantErr: 12.08834 batch_time=0.43984 
Train Epoch: 2 [45/250 5760/32000 (18%)] Loss: 14.12353 (QuantReg: 12.19362) QuantErr: 12.19362 batch_time=0.46291 
Train Epoch: 2 [56/250 7168/32000 (22%)] Loss: 13.40150 (QuantReg: 12.25146) QuantErr: 12.25146 batch_time=0.45172 
Train Epoch: 2 [67/250 8576/32000 (27%)] Loss: 13.15391 (QuantReg: 12.83502) QuantErr: 12.83502 batch_time=0.44582 
Train Epoch: 2 [78/250 9984/32000 (31%)] Loss: 12.19179 (QuantReg: 13.11477) QuantErr: 13.11477 batch_time=0.43983 
Train Epoch: 2 [89/250 11392/32000 (36%)] Loss: 11.23748 (QuantReg: 12.64319) QuantErr: 12.64319 batch_time=0.50028 
Train Epoch: 2 [100/250 12800/32000 (40%)] Loss: 14.97452 (QuantReg: 13.53232) QuantErr: 13.53232 batch_time=0.44849 
Train Epoch: 2 [111/250 14208/32000 (44%)] Loss: 12.47355 (QuantReg: 12.97190) QuantErr: 12.97190 batch_time=0.43342 
Train Epoch: 2 [122/250 15616/32000 (49%)] Loss: 12.42081 (QuantReg: 13.28956) QuantErr: 13.28956 batch_time=0.46063 
Train Epoch: 2 [133/250 17024/32000 (53%)] Loss: 11.54886 (QuantReg: 13.54886) QuantErr: 13.54886 batch_time=0.43339 
Train Epoch: 2 [144/250 18432/32000 (58%)] Loss: 12.27464 (QuantReg: 13.64693) QuantErr: 13.64693 batch_time=0.45355 
Train Epoch: 2 [155/250 19840/32000 (62%)] Loss: 12.60571 (QuantReg: 14.13509) QuantErr: 14.13509 batch_time=0.43445 
Train Epoch: 2 [166/250 21248/32000 (66%)] Loss: 11.72826 (QuantReg: 13.73311) QuantErr: 13.73311 batch_time=0.44196 
Train Epoch: 2 [177/250 22656/32000 (71%)] Loss: 10.69299 (QuantReg: 13.92267) QuantErr: 13.92267 batch_time=0.79373 
Train Epoch: 2 [188/250 24064/32000 (75%)] Loss: 11.13158 (QuantReg: 13.98775) QuantErr: 13.98775 batch_time=0.42682 
Train Epoch: 2 [199/250 25472/32000 (80%)] Loss: 10.67053 (QuantReg: 14.34211) QuantErr: 14.34211 batch_time=0.48876 
Train Epoch: 2 [210/250 26880/32000 (84%)] Loss: 9.73153 (QuantReg: 13.91892) QuantErr: 13.91892 batch_time=0.42375 
Train Epoch: 2 [221/250 28288/32000 (88%)] Loss: 10.52122 (QuantReg: 14.34412) QuantErr: 14.34412 batch_time=0.44492 
Train Epoch: 2 [232/250 29696/32000 (93%)] Loss: 11.74605 (QuantReg: 13.92942) QuantErr: 13.92942 batch_time=0.44236 
Train Epoch: 2 [243/250 31104/32000 (97%)] Loss: 10.39697 (QuantReg: 14.45884) QuantErr: 14.45884 batch_time=0.42397 
Train Epoch: 2 codebook_update_time=1.26764
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch2.pth ...
Done in 4.280s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch2.pth ...
Done in 8.266s
removing stale ckpt [epoch 1] [took 0.00s]
removing stale ckpt [epoch 0] [took 0.00s]
 epoch          : 2
 loss           : 12.149146018981934
 quant_reg      : 13.244106685638428
 quant_err      : 13.244106685638428
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 23.541247484909455
 MSRVTT_full_val/t2v_metrics/R5: 57.545271629778675
 MSRVTT_full_val/t2v_metrics/R10: 74.64788732394366
 MSRVTT_full_val/t2v_metrics/R50: 96.37826961770624
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 11.058350100603622
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 46.58923143305815
 MSRVTT_full_val/v2t_metrics/R1: 26.156941649899398
 MSRVTT_full_val/v2t_metrics/R5: 63.98390342052314
 MSRVTT_full_val/v2t_metrics/R10: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R50: 96.579476861167
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 9.45271629778672
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 51.00340562230017
 MSRVTT_full_test/t2v_metrics/R1: 8.093645484949834
 MSRVTT_full_test/t2v_metrics/R5: 26.220735785953178
 MSRVTT_full_test/t2v_metrics/R10: 37.424749163879596
 MSRVTT_full_test/t2v_metrics/R50: 72.37458193979933
 MSRVTT_full_test/t2v_metrics/MedR: 18.0
 MSRVTT_full_test/t2v_metrics/MeanR: 59.63779264214047
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 19.951826064649484
 MSRVTT_full_test/v2t_metrics/R1: 10.200668896321071
 MSRVTT_full_test/v2t_metrics/R5: 29.498327759197323
 MSRVTT_full_test/v2t_metrics/R10: 43.61204013377927
 MSRVTT_full_test/v2t_metrics/R50: 77.82608695652173
 MSRVTT_full_test/v2t_metrics/MedR: 14.0
 MSRVTT_full_test/v2t_metrics/MeanR: 49.825752508361205
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 23.587259423090664
 mnt_best       : 19.951826064649484
 not_improved_count: 0
Train Epoch: 3 [1/250 128/32000 (0%)] Loss: 10.65837 (QuantReg: 11.61483) QuantErr: 11.61483 batch_time=30.30607 
Train Epoch: 3 [12/250 1536/32000 (5%)] Loss: 10.29684 (QuantReg: 11.42953) QuantErr: 11.42953 batch_time=0.42967 
Train Epoch: 3 [23/250 2944/32000 (9%)] Loss: 10.71062 (QuantReg: 11.76652) QuantErr: 11.76652 batch_time=0.41779 
Train Epoch: 3 [34/250 4352/32000 (14%)] Loss: 9.85394 (QuantReg: 11.94877) QuantErr: 11.94877 batch_time=0.43386 
Train Epoch: 3 [45/250 5760/32000 (18%)] Loss: 11.39816 (QuantReg: 12.01004) QuantErr: 12.01004 batch_time=0.41490 
Train Epoch: 3 [56/250 7168/32000 (22%)] Loss: 10.32315 (QuantReg: 12.21951) QuantErr: 12.21951 batch_time=0.43030 
Train Epoch: 3 [67/250 8576/32000 (27%)] Loss: 8.47892 (QuantReg: 11.80438) QuantErr: 11.80438 batch_time=0.42354 
Train Epoch: 3 [78/250 9984/32000 (31%)] Loss: 9.26555 (QuantReg: 12.39084) QuantErr: 12.39084 batch_time=0.41790 
Train Epoch: 3 [89/250 11392/32000 (36%)] Loss: 10.92874 (QuantReg: 12.26325) QuantErr: 12.26325 batch_time=0.41602 
Train Epoch: 3 [100/250 12800/32000 (40%)] Loss: 10.22449 (QuantReg: 12.64115) QuantErr: 12.64115 batch_time=0.96238 
Train Epoch: 3 [111/250 14208/32000 (44%)] Loss: 10.02801 (QuantReg: 12.10319) QuantErr: 12.10319 batch_time=0.42404 
Train Epoch: 3 [122/250 15616/32000 (49%)] Loss: 9.79375 (QuantReg: 12.41067) QuantErr: 12.41067 batch_time=0.86968 
Train Epoch: 3 [133/250 17024/32000 (53%)] Loss: 12.21120 (QuantReg: 12.67897) QuantErr: 12.67897 batch_time=0.44497 
Train Epoch: 3 [144/250 18432/32000 (58%)] Loss: 10.73918 (QuantReg: 12.80380) QuantErr: 12.80380 batch_time=0.45082 
Train Epoch: 3 [155/250 19840/32000 (62%)] Loss: 10.35908 (QuantReg: 12.80953) QuantErr: 12.80953 batch_time=0.43869 
Train Epoch: 3 [166/250 21248/32000 (66%)] Loss: 9.47240 (QuantReg: 12.62194) QuantErr: 12.62194 batch_time=0.41549 
Train Epoch: 3 [177/250 22656/32000 (71%)] Loss: 9.69389 (QuantReg: 13.03466) QuantErr: 13.03466 batch_time=0.45215 
Train Epoch: 3 [188/250 24064/32000 (75%)] Loss: 10.10056 (QuantReg: 12.48081) QuantErr: 12.48081 batch_time=0.42132 
Train Epoch: 3 [199/250 25472/32000 (80%)] Loss: 9.85667 (QuantReg: 13.01988) QuantErr: 13.01988 batch_time=0.42051 
Train Epoch: 3 [210/250 26880/32000 (84%)] Loss: 10.11460 (QuantReg: 12.95218) QuantErr: 12.95218 batch_time=0.43164 
Train Epoch: 3 [221/250 28288/32000 (88%)] Loss: 11.27119 (QuantReg: 12.78079) QuantErr: 12.78079 batch_time=0.43680 
Train Epoch: 3 [232/250 29696/32000 (93%)] Loss: 9.43257 (QuantReg: 12.88197) QuantErr: 12.88197 batch_time=0.42465 
Train Epoch: 3 [243/250 31104/32000 (97%)] Loss: 9.93975 (QuantReg: 13.19816) QuantErr: 13.19816 batch_time=0.41415 
Train Epoch: 3 codebook_update_time=1.04502
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch3.pth ...
Done in 6.373s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch3.pth ...
Done in 11.133s
removing stale ckpt [epoch 2] [took 0.01s]
 epoch          : 3
 loss           : 10.152871868133545
 quant_reg      : 12.493335159301758
 quant_err      : 12.493335159301758
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 750
 MSRVTT_full_val/t2v_metrics/R1: 25.35211267605634
 MSRVTT_full_val/t2v_metrics/R5: 61.3682092555332
 MSRVTT_full_val/t2v_metrics/R10: 75.25150905432595
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.967806841046277
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 48.92050596898273
 MSRVTT_full_val/v2t_metrics/R1: 27.16297786720322
 MSRVTT_full_val/v2t_metrics/R5: 67.00201207243461
 MSRVTT_full_val/v2t_metrics/R10: 79.07444668008048
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.458752515090543
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 52.40432468026335
 MSRVTT_full_test/t2v_metrics/R1: 8.762541806020067
 MSRVTT_full_test/t2v_metrics/R5: 28.46153846153846
 MSRVTT_full_test/t2v_metrics/R10: 40.836120401337794
 MSRVTT_full_test/t2v_metrics/R50: 75.15050167224081
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 53.18361204013378
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 21.67592552242988
 MSRVTT_full_test/v2t_metrics/R1: 10.96989966555184
 MSRVTT_full_test/v2t_metrics/R5: 32.474916387959865
 MSRVTT_full_test/v2t_metrics/R10: 45.48494983277592
 MSRVTT_full_test/v2t_metrics/R50: 80.20066889632108
 MSRVTT_full_test/v2t_metrics/MedR: 13.0
 MSRVTT_full_test/v2t_metrics/MeanR: 44.96020066889632
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.304988192837534
 mnt_best       : 21.67592552242988
 not_improved_count: 0
Train Epoch: 4 [1/250 128/32000 (0%)] Loss: 10.31193 (QuantReg: 11.66770) QuantErr: 11.66770 batch_time=36.93729 
Train Epoch: 4 [12/250 1536/32000 (5%)] Loss: 8.79738 (QuantReg: 11.96855) QuantErr: 11.96855 batch_time=0.42476 
Train Epoch: 4 [23/250 2944/32000 (9%)] Loss: 9.47104 (QuantReg: 12.23875) QuantErr: 12.23875 batch_time=0.42412 
Train Epoch: 4 [34/250 4352/32000 (14%)] Loss: 7.17666 (QuantReg: 12.47117) QuantErr: 12.47117 batch_time=0.44178 
Train Epoch: 4 [45/250 5760/32000 (18%)] Loss: 9.17817 (QuantReg: 12.14473) QuantErr: 12.14473 batch_time=0.49074 
Train Epoch: 4 [56/250 7168/32000 (22%)] Loss: 8.88997 (QuantReg: 12.22786) QuantErr: 12.22786 batch_time=0.45623 
Train Epoch: 4 [67/250 8576/32000 (27%)] Loss: 9.63442 (QuantReg: 11.93797) QuantErr: 11.93797 batch_time=0.43540 
Train Epoch: 4 [78/250 9984/32000 (31%)] Loss: 8.64141 (QuantReg: 11.63585) QuantErr: 11.63585 batch_time=0.42241 
Train Epoch: 4 [89/250 11392/32000 (36%)] Loss: 8.77465 (QuantReg: 11.97766) QuantErr: 11.97766 batch_time=0.43122 
Train Epoch: 4 [100/250 12800/32000 (40%)] Loss: 9.92321 (QuantReg: 12.26371) QuantErr: 12.26371 batch_time=0.43668 
Train Epoch: 4 [111/250 14208/32000 (44%)] Loss: 9.58786 (QuantReg: 12.07858) QuantErr: 12.07858 batch_time=0.43794 
Train Epoch: 4 [122/250 15616/32000 (49%)] Loss: 10.81381 (QuantReg: 12.13236) QuantErr: 12.13236 batch_time=0.44493 
Train Epoch: 4 [133/250 17024/32000 (53%)] Loss: 9.62987 (QuantReg: 12.43481) QuantErr: 12.43481 batch_time=0.42654 
Train Epoch: 4 [144/250 18432/32000 (58%)] Loss: 8.64977 (QuantReg: 12.24317) QuantErr: 12.24317 batch_time=0.44077 
Train Epoch: 4 [155/250 19840/32000 (62%)] Loss: 10.06771 (QuantReg: 12.29246) QuantErr: 12.29246 batch_time=0.42478 
Train Epoch: 4 [166/250 21248/32000 (66%)] Loss: 7.87638 (QuantReg: 12.59364) QuantErr: 12.59364 batch_time=0.46705 
Train Epoch: 4 [177/250 22656/32000 (71%)] Loss: 9.43943 (QuantReg: 13.11007) QuantErr: 13.11007 batch_time=0.45901 
Train Epoch: 4 [188/250 24064/32000 (75%)] Loss: 7.50602 (QuantReg: 12.77980) QuantErr: 12.77980 batch_time=0.45439 
Train Epoch: 4 [199/250 25472/32000 (80%)] Loss: 9.82948 (QuantReg: 12.78378) QuantErr: 12.78378 batch_time=0.78410 
Train Epoch: 4 [210/250 26880/32000 (84%)] Loss: 8.06569 (QuantReg: 12.84405) QuantErr: 12.84405 batch_time=0.43416 
Train Epoch: 4 [221/250 28288/32000 (88%)] Loss: 8.86313 (QuantReg: 12.66839) QuantErr: 12.66839 batch_time=0.42944 
Train Epoch: 4 [232/250 29696/32000 (93%)] Loss: 8.93842 (QuantReg: 12.82486) QuantErr: 12.82486 batch_time=0.42524 
Train Epoch: 4 [243/250 31104/32000 (97%)] Loss: 7.50736 (QuantReg: 12.37204) QuantErr: 12.37204 batch_time=0.47474 
Train Epoch: 4 codebook_update_time=1.42433
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch4.pth ...
Done in 5.043s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch4.pth ...
Done in 10.435s
removing stale ckpt [epoch 3] [took 0.03s]
 epoch          : 4
 loss           : 9.002852266311645
 quant_reg      : 12.361520969390869
 quant_err      : 12.361520969390869
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 27.56539235412475
 MSRVTT_full_val/t2v_metrics/R5: 63.38028169014085
 MSRVTT_full_val/t2v_metrics/R10: 77.2635814889336
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.680080482897385
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 51.297680273044755
 MSRVTT_full_val/v2t_metrics/R1: 30.58350100603622
 MSRVTT_full_val/v2t_metrics/R5: 70.82494969818913
 MSRVTT_full_val/v2t_metrics/R10: 81.89134808853119
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.867203219315895
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.18717083334731
 MSRVTT_full_test/t2v_metrics/R1: 9.297658862876254
 MSRVTT_full_test/t2v_metrics/R5: 28.46153846153846
 MSRVTT_full_test/t2v_metrics/R10: 42.240802675585286
 MSRVTT_full_test/t2v_metrics/R50: 76.5886287625418
 MSRVTT_full_test/t2v_metrics/MedR: 15.0
 MSRVTT_full_test/t2v_metrics/MeanR: 51.384949832775916
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.359120364198922
 MSRVTT_full_test/v2t_metrics/R1: 11.57190635451505
 MSRVTT_full_test/v2t_metrics/R5: 33.34448160535117
 MSRVTT_full_test/v2t_metrics/R10: 48.76254180602007
 MSRVTT_full_test/v2t_metrics/R50: 82.14046822742475
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 40.63779264214047
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 26.597352270564038
 mnt_best       : 22.359120364198922
 not_improved_count: 0
Train Epoch: 5 [1/250 128/32000 (0%)] Loss: 8.90941 (QuantReg: 11.99209) QuantErr: 11.99209 batch_time=28.50364 
Train Epoch: 5 [12/250 1536/32000 (5%)] Loss: 8.49190 (QuantReg: 11.84129) QuantErr: 11.84129 batch_time=0.68130 
Train Epoch: 5 [23/250 2944/32000 (9%)] Loss: 7.95471 (QuantReg: 11.65466) QuantErr: 11.65466 batch_time=0.48135 
Train Epoch: 5 [34/250 4352/32000 (14%)] Loss: 8.00352 (QuantReg: 12.59978) QuantErr: 12.59978 batch_time=0.44437 
Train Epoch: 5 [45/250 5760/32000 (18%)] Loss: 9.16129 (QuantReg: 12.34573) QuantErr: 12.34573 batch_time=0.42934 
Train Epoch: 5 [56/250 7168/32000 (22%)] Loss: 7.88464 (QuantReg: 12.31339) QuantErr: 12.31339 batch_time=0.44284 
Train Epoch: 5 [67/250 8576/32000 (27%)] Loss: 10.82199 (QuantReg: 11.94291) QuantErr: 11.94291 batch_time=1.13375 
Train Epoch: 5 [78/250 9984/32000 (31%)] Loss: 8.68495 (QuantReg: 12.19099) QuantErr: 12.19099 batch_time=0.42721 
Train Epoch: 5 [89/250 11392/32000 (36%)] Loss: 6.87733 (QuantReg: 12.08893) QuantErr: 12.08893 batch_time=0.44007 
Train Epoch: 5 [100/250 12800/32000 (40%)] Loss: 7.11855 (QuantReg: 12.59900) QuantErr: 12.59900 batch_time=0.44615 
Train Epoch: 5 [111/250 14208/32000 (44%)] Loss: 7.55683 (QuantReg: 12.58483) QuantErr: 12.58483 batch_time=0.45264 
Train Epoch: 5 [122/250 15616/32000 (49%)] Loss: 7.17518 (QuantReg: 12.36936) QuantErr: 12.36936 batch_time=0.44525 
Train Epoch: 5 [133/250 17024/32000 (53%)] Loss: 8.41648 (QuantReg: 12.22748) QuantErr: 12.22748 batch_time=0.44294 
Train Epoch: 5 [144/250 18432/32000 (58%)] Loss: 7.60112 (QuantReg: 12.70938) QuantErr: 12.70938 batch_time=0.43896 
Train Epoch: 5 [155/250 19840/32000 (62%)] Loss: 9.04991 (QuantReg: 12.52275) QuantErr: 12.52275 batch_time=0.44535 
Train Epoch: 5 [166/250 21248/32000 (66%)] Loss: 8.52421 (QuantReg: 12.35206) QuantErr: 12.35206 batch_time=0.43573 
Train Epoch: 5 [177/250 22656/32000 (71%)] Loss: 7.33847 (QuantReg: 12.69287) QuantErr: 12.69287 batch_time=0.43115 
Train Epoch: 5 [188/250 24064/32000 (75%)] Loss: 8.00619 (QuantReg: 12.16542) QuantErr: 12.16542 batch_time=0.43239 
Train Epoch: 5 [199/250 25472/32000 (80%)] Loss: 8.85616 (QuantReg: 12.49319) QuantErr: 12.49319 batch_time=0.47686 
Train Epoch: 5 [210/250 26880/32000 (84%)] Loss: 9.71512 (QuantReg: 12.52973) QuantErr: 12.52973 batch_time=0.44321 
Train Epoch: 5 [221/250 28288/32000 (88%)] Loss: 8.47287 (QuantReg: 12.62864) QuantErr: 12.62864 batch_time=0.44384 
Train Epoch: 5 [232/250 29696/32000 (93%)] Loss: 7.73925 (QuantReg: 12.70618) QuantErr: 12.70618 batch_time=0.43179 
Train Epoch: 5 [243/250 31104/32000 (97%)] Loss: 7.30802 (QuantReg: 12.49784) QuantErr: 12.49784 batch_time=0.53626 
Train Epoch: 5 codebook_update_time=1.08141
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch5.pth ...
Done in 4.477s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch5.pth ...
Done in 9.547s
removing stale ckpt [epoch 4] [took 0.40s]
 epoch          : 5
 loss           : 8.167788110733031
 quant_reg      : 12.389640781402587
 quant_err      : 12.389640781402587
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 1250
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 65.3923541247485
 MSRVTT_full_val/t2v_metrics/R10: 78.26961770623743
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.853118712273641
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.174761494211175
 MSRVTT_full_val/v2t_metrics/R1: 32.59557344064386
 MSRVTT_full_val/v2t_metrics/R5: 72.03219315895372
 MSRVTT_full_val/v2t_metrics/R10: 84.70824949698189
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.090543259557344
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.3718767685367
 MSRVTT_full_test/t2v_metrics/R1: 10.200668896321071
 MSRVTT_full_test/t2v_metrics/R5: 30.20066889632107
 MSRVTT_full_test/t2v_metrics/R10: 44.64882943143812
 MSRVTT_full_test/t2v_metrics/R50: 78.06020066889631
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.551839464882946
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.959905277738173
 MSRVTT_full_test/v2t_metrics/R1: 12.040133779264215
 MSRVTT_full_test/v2t_metrics/R5: 35.618729096989966
 MSRVTT_full_test/v2t_metrics/R10: 49.59866220735786
 MSRVTT_full_test/v2t_metrics/R50: 83.4113712374582
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 38.31605351170568
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.70723776396443
 mnt_best       : 23.959905277738173
 not_improved_count: 0
Train Epoch: 6 [1/250 128/32000 (0%)] Loss: 7.88574 (QuantReg: 12.22206) QuantErr: 12.22206 batch_time=32.49376 
Train Epoch: 6 [12/250 1536/32000 (5%)] Loss: 6.80999 (QuantReg: 12.29603) QuantErr: 12.29603 batch_time=0.43975 
Train Epoch: 6 [23/250 2944/32000 (9%)] Loss: 7.19587 (QuantReg: 11.87659) QuantErr: 11.87659 batch_time=0.43327 
Train Epoch: 6 [34/250 4352/32000 (14%)] Loss: 7.09944 (QuantReg: 12.19299) QuantErr: 12.19299 batch_time=0.42493 
Train Epoch: 6 [45/250 5760/32000 (18%)] Loss: 9.06539 (QuantReg: 12.44792) QuantErr: 12.44792 batch_time=0.42979 
Train Epoch: 6 [56/250 7168/32000 (22%)] Loss: 8.11404 (QuantReg: 12.16321) QuantErr: 12.16321 batch_time=0.43498 
Train Epoch: 6 [67/250 8576/32000 (27%)] Loss: 8.31902 (QuantReg: 12.39706) QuantErr: 12.39706 batch_time=0.43243 
Train Epoch: 6 [78/250 9984/32000 (31%)] Loss: 6.64396 (QuantReg: 12.65998) QuantErr: 12.65998 batch_time=0.43590 
Train Epoch: 6 [89/250 11392/32000 (36%)] Loss: 8.74998 (QuantReg: 12.44786) QuantErr: 12.44786 batch_time=0.46531 
Train Epoch: 6 [100/250 12800/32000 (40%)] Loss: 7.93206 (QuantReg: 12.50525) QuantErr: 12.50525 batch_time=0.45195 
Train Epoch: 6 [111/250 14208/32000 (44%)] Loss: 8.68394 (QuantReg: 12.27596) QuantErr: 12.27596 batch_time=0.43842 
Train Epoch: 6 [122/250 15616/32000 (49%)] Loss: 7.24970 (QuantReg: 12.76235) QuantErr: 12.76235 batch_time=0.42977 
Train Epoch: 6 [133/250 17024/32000 (53%)] Loss: 6.64610 (QuantReg: 12.50012) QuantErr: 12.50012 batch_time=0.94689 
Train Epoch: 6 [144/250 18432/32000 (58%)] Loss: 7.06418 (QuantReg: 12.09987) QuantErr: 12.09987 batch_time=0.42391 
Train Epoch: 6 [155/250 19840/32000 (62%)] Loss: 6.89471 (QuantReg: 12.54438) QuantErr: 12.54438 batch_time=0.48992 
Train Epoch: 6 [166/250 21248/32000 (66%)] Loss: 6.42478 (QuantReg: 12.29005) QuantErr: 12.29005 batch_time=0.45833 
Train Epoch: 6 [177/250 22656/32000 (71%)] Loss: 7.10157 (QuantReg: 12.75937) QuantErr: 12.75937 batch_time=0.44784 
Train Epoch: 6 [188/250 24064/32000 (75%)] Loss: 6.92043 (QuantReg: 12.50571) QuantErr: 12.50571 batch_time=0.43505 
Train Epoch: 6 [199/250 25472/32000 (80%)] Loss: 7.27868 (QuantReg: 12.36143) QuantErr: 12.36143 batch_time=0.44087 
Train Epoch: 6 [210/250 26880/32000 (84%)] Loss: 9.07490 (QuantReg: 12.26240) QuantErr: 12.26240 batch_time=0.46277 
Train Epoch: 6 [221/250 28288/32000 (88%)] Loss: 7.28481 (QuantReg: 12.45054) QuantErr: 12.45054 batch_time=0.43387 
Train Epoch: 6 [232/250 29696/32000 (93%)] Loss: 6.77181 (QuantReg: 12.39041) QuantErr: 12.39041 batch_time=0.70905 
Train Epoch: 6 [243/250 31104/32000 (97%)] Loss: 7.56019 (QuantReg: 12.50840) QuantErr: 12.50840 batch_time=0.43126 
Train Epoch: 6 codebook_update_time=0.95561
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch6.pth ...
Done in 5.157s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch6.pth ...
Done in 9.926s
removing stale ckpt [epoch 5] [took 0.00s]
 epoch          : 6
 loss           : 7.497154237747193
 quant_reg      : 12.412101139068604
 quant_err      : 12.412101139068604
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 68.2092555331992
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.167002012072434
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.397369685249735
 MSRVTT_full_val/v2t_metrics/R1: 36.21730382293762
 MSRVTT_full_val/v2t_metrics/R5: 71.83098591549296
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.2635814889336014
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.64016644917069
 MSRVTT_full_test/t2v_metrics/R1: 11.57190635451505
 MSRVTT_full_test/t2v_metrics/R5: 31.97324414715719
 MSRVTT_full_test/t2v_metrics/R10: 46.38795986622073
 MSRVTT_full_test/t2v_metrics/R50: 79.79933110367892
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.96521739130435
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.79480776901778
 MSRVTT_full_test/v2t_metrics/R1: 12.876254180602007
 MSRVTT_full_test/v2t_metrics/R5: 37.09030100334448
 MSRVTT_full_test/v2t_metrics/R10: 51.30434782608695
 MSRVTT_full_test/v2t_metrics/R50: 84.34782608695652
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.762040133779266
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.044775464060663
 mnt_best       : 25.79480776901778
 not_improved_count: 0
Train Epoch: 7 [1/250 128/32000 (0%)] Loss: 6.93888 (QuantReg: 12.28726) QuantErr: 12.28726 batch_time=30.99012 
Train Epoch: 7 [12/250 1536/32000 (5%)] Loss: 7.27485 (QuantReg: 12.50452) QuantErr: 12.50452 batch_time=0.44402 
Train Epoch: 7 [23/250 2944/32000 (9%)] Loss: 7.76974 (QuantReg: 12.29829) QuantErr: 12.29829 batch_time=0.48129 
Train Epoch: 7 [34/250 4352/32000 (14%)] Loss: 6.50671 (QuantReg: 12.15404) QuantErr: 12.15404 batch_time=0.45313 
Train Epoch: 7 [45/250 5760/32000 (18%)] Loss: 7.17130 (QuantReg: 12.08091) QuantErr: 12.08091 batch_time=0.44617 
Train Epoch: 7 [56/250 7168/32000 (22%)] Loss: 6.87438 (QuantReg: 12.32976) QuantErr: 12.32976 batch_time=0.44975 
Train Epoch: 7 [67/250 8576/32000 (27%)] Loss: 5.35414 (QuantReg: 12.56063) QuantErr: 12.56063 batch_time=0.43981 
Train Epoch: 7 [78/250 9984/32000 (31%)] Loss: 7.24873 (QuantReg: 12.57069) QuantErr: 12.57069 batch_time=0.76445 
Train Epoch: 7 [89/250 11392/32000 (36%)] Loss: 9.66635 (QuantReg: 12.47940) QuantErr: 12.47940 batch_time=0.46530 
Train Epoch: 7 [100/250 12800/32000 (40%)] Loss: 6.91855 (QuantReg: 12.49908) QuantErr: 12.49908 batch_time=0.44992 
Train Epoch: 7 [111/250 14208/32000 (44%)] Loss: 7.88489 (QuantReg: 12.74257) QuantErr: 12.74257 batch_time=0.47250 
Train Epoch: 7 [122/250 15616/32000 (49%)] Loss: 7.01074 (QuantReg: 12.47091) QuantErr: 12.47091 batch_time=0.47692 
Train Epoch: 7 [133/250 17024/32000 (53%)] Loss: 6.63992 (QuantReg: 12.37680) QuantErr: 12.37680 batch_time=0.45889 
Train Epoch: 7 [144/250 18432/32000 (58%)] Loss: 6.59783 (QuantReg: 12.44419) QuantErr: 12.44419 batch_time=0.47996 
Train Epoch: 7 [155/250 19840/32000 (62%)] Loss: 6.14962 (QuantReg: 12.67053) QuantErr: 12.67053 batch_time=0.44771 
Train Epoch: 7 [166/250 21248/32000 (66%)] Loss: 6.11798 (QuantReg: 12.57398) QuantErr: 12.57398 batch_time=0.47351 
Train Epoch: 7 [177/250 22656/32000 (71%)] Loss: 8.49627 (QuantReg: 12.55269) QuantErr: 12.55269 batch_time=0.45787 
Train Epoch: 7 [188/250 24064/32000 (75%)] Loss: 5.77290 (QuantReg: 12.74343) QuantErr: 12.74343 batch_time=0.43700 
Train Epoch: 7 [199/250 25472/32000 (80%)] Loss: 7.21919 (QuantReg: 12.34632) QuantErr: 12.34632 batch_time=0.44400 
Train Epoch: 7 [210/250 26880/32000 (84%)] Loss: 6.89077 (QuantReg: 12.61974) QuantErr: 12.61974 batch_time=0.46004 
Train Epoch: 7 [221/250 28288/32000 (88%)] Loss: 8.04173 (QuantReg: 12.59745) QuantErr: 12.59745 batch_time=0.42481 
Train Epoch: 7 [232/250 29696/32000 (93%)] Loss: 6.51762 (QuantReg: 12.68763) QuantErr: 12.68763 batch_time=0.44838 
Train Epoch: 7 [243/250 31104/32000 (97%)] Loss: 5.82662 (QuantReg: 12.62302) QuantErr: 12.62302 batch_time=0.46808 
Train Epoch: 7 codebook_update_time=0.99875
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch7.pth ...
Done in 4.478s
removing stale ckpt [epoch 6] [took 0.01s]
 epoch          : 7
 loss           : 6.896228610992432
 quant_reg      : 12.54117406463623
 quant_err      : 12.54117406463623
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 1750
 MSRVTT_full_val/t2v_metrics/R1: 29.979879275653925
 MSRVTT_full_val/t2v_metrics/R5: 66.19718309859155
 MSRVTT_full_val/t2v_metrics/R10: 80.28169014084507
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.056338028169014
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.21198364268388
 MSRVTT_full_val/v2t_metrics/R1: 32.19315895372233
 MSRVTT_full_val/v2t_metrics/R5: 73.8430583501006
 MSRVTT_full_val/v2t_metrics/R10: 84.10462776659959
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.633802816901408
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.47421328413947
 MSRVTT_full_test/t2v_metrics/R1: 10.535117056856187
 MSRVTT_full_test/t2v_metrics/R5: 32.0066889632107
 MSRVTT_full_test/t2v_metrics/R10: 46.220735785953174
 MSRVTT_full_test/t2v_metrics/R50: 79.4648829431438
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.13210702341137
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.978843280619966
 MSRVTT_full_test/v2t_metrics/R1: 13.210702341137123
 MSRVTT_full_test/v2t_metrics/R5: 36.92307692307692
 MSRVTT_full_test/v2t_metrics/R10: 51.63879598662207
 MSRVTT_full_test/v2t_metrics/R50: 83.84615384615384
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.65919732441471
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.31342963638325
 mnt_best       : 25.79480776901778
 not_improved_count: 1
Train Epoch: 8 [1/250 128/32000 (0%)] Loss: 7.22019 (QuantReg: 12.15557) QuantErr: 12.15557 batch_time=33.27092 
Train Epoch: 8 [12/250 1536/32000 (5%)] Loss: 6.17785 (QuantReg: 12.43646) QuantErr: 12.43646 batch_time=0.42178 
Train Epoch: 8 [23/250 2944/32000 (9%)] Loss: 7.22998 (QuantReg: 12.38549) QuantErr: 12.38549 batch_time=1.28782 
Train Epoch: 8 [34/250 4352/32000 (14%)] Loss: 5.86753 (QuantReg: 12.86735) QuantErr: 12.86735 batch_time=0.43121 
Train Epoch: 8 [45/250 5760/32000 (18%)] Loss: 7.51360 (QuantReg: 12.53601) QuantErr: 12.53601 batch_time=0.49433 
Train Epoch: 8 [56/250 7168/32000 (22%)] Loss: 7.32752 (QuantReg: 12.49819) QuantErr: 12.49819 batch_time=0.46656 
Train Epoch: 8 [67/250 8576/32000 (27%)] Loss: 6.60464 (QuantReg: 12.70031) QuantErr: 12.70031 batch_time=1.83349 
Train Epoch: 8 [78/250 9984/32000 (31%)] Loss: 7.84239 (QuantReg: 12.41584) QuantErr: 12.41584 batch_time=0.42622 
Train Epoch: 8 [89/250 11392/32000 (36%)] Loss: 6.97365 (QuantReg: 12.61724) QuantErr: 12.61724 batch_time=0.42671 
Train Epoch: 8 [100/250 12800/32000 (40%)] Loss: 5.57214 (QuantReg: 12.60995) QuantErr: 12.60995 batch_time=0.50249 
Train Epoch: 8 [111/250 14208/32000 (44%)] Loss: 6.39321 (QuantReg: 12.73845) QuantErr: 12.73845 batch_time=0.45243 
Train Epoch: 8 [122/250 15616/32000 (49%)] Loss: 5.38301 (QuantReg: 12.52012) QuantErr: 12.52012 batch_time=0.45196 
Train Epoch: 8 [133/250 17024/32000 (53%)] Loss: 7.14389 (QuantReg: 12.43758) QuantErr: 12.43758 batch_time=0.44238 
Train Epoch: 8 [144/250 18432/32000 (58%)] Loss: 6.29462 (QuantReg: 13.01608) QuantErr: 13.01608 batch_time=0.43872 
Train Epoch: 8 [155/250 19840/32000 (62%)] Loss: 7.06885 (QuantReg: 12.57707) QuantErr: 12.57707 batch_time=0.43885 
Train Epoch: 8 [166/250 21248/32000 (66%)] Loss: 5.86382 (QuantReg: 12.51130) QuantErr: 12.51130 batch_time=0.43169 
Train Epoch: 8 [177/250 22656/32000 (71%)] Loss: 6.68648 (QuantReg: 12.49541) QuantErr: 12.49541 batch_time=0.43740 
Train Epoch: 8 [188/250 24064/32000 (75%)] Loss: 5.49521 (QuantReg: 12.60040) QuantErr: 12.60040 batch_time=0.44089 
Train Epoch: 8 [199/250 25472/32000 (80%)] Loss: 7.42338 (QuantReg: 12.94781) QuantErr: 12.94781 batch_time=0.44258 
Train Epoch: 8 [210/250 26880/32000 (84%)] Loss: 7.10308 (QuantReg: 12.67116) QuantErr: 12.67116 batch_time=0.48044 
Train Epoch: 8 [221/250 28288/32000 (88%)] Loss: 6.14804 (QuantReg: 12.75378) QuantErr: 12.75378 batch_time=0.46535 
Train Epoch: 8 [232/250 29696/32000 (93%)] Loss: 5.50959 (QuantReg: 12.79637) QuantErr: 12.79637 batch_time=0.41954 
Train Epoch: 8 [243/250 31104/32000 (97%)] Loss: 4.48604 (QuantReg: 12.61043) QuantErr: 12.61043 batch_time=0.46992 
Train Epoch: 8 codebook_update_time=1.23016
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch8.pth ...
Done in 4.480s
removing stale ckpt [epoch 7] [took 0.00s]
 epoch          : 8
 loss           : 6.4480590171813965
 quant_reg      : 12.580614009857177
 quant_err      : 12.580614009857177
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 29.175050301810867
 MSRVTT_full_val/t2v_metrics/R5: 66.19718309859155
 MSRVTT_full_val/t2v_metrics/R10: 80.0804828973843
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.515090543259557
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.67753972581272
 MSRVTT_full_val/v2t_metrics/R1: 31.58953722334004
 MSRVTT_full_val/v2t_metrics/R5: 72.63581488933602
 MSRVTT_full_val/v2t_metrics/R10: 84.10462776659959
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.456740442655936
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 57.78804335794677
 MSRVTT_full_test/t2v_metrics/R1: 10.568561872909699
 MSRVTT_full_test/t2v_metrics/R5: 32.240802675585286
 MSRVTT_full_test/t2v_metrics/R10: 45.35117056856188
 MSRVTT_full_test/t2v_metrics/R50: 78.82943143812709
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.09397993311037
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.90787898458717
 MSRVTT_full_test/v2t_metrics/R1: 13.143812709030101
 MSRVTT_full_test/v2t_metrics/R5: 36.72240802675585
 MSRVTT_full_test/v2t_metrics/R10: 51.67224080267559
 MSRVTT_full_test/v2t_metrics/R50: 83.87959866220736
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.841638795986626
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.217066100022908
 mnt_best       : 25.79480776901778
 not_improved_count: 2
Train Epoch: 9 [1/250 128/32000 (0%)] Loss: 7.88506 (QuantReg: 12.04969) QuantErr: 12.04969 batch_time=30.95169 
Train Epoch: 9 [12/250 1536/32000 (5%)] Loss: 5.92583 (QuantReg: 12.53598) QuantErr: 12.53598 batch_time=0.44683 
Train Epoch: 9 [23/250 2944/32000 (9%)] Loss: 7.57962 (QuantReg: 12.45527) QuantErr: 12.45527 batch_time=0.44787 
Train Epoch: 9 [34/250 4352/32000 (14%)] Loss: 6.08396 (QuantReg: 12.45638) QuantErr: 12.45638 batch_time=0.43487 
Train Epoch: 9 [45/250 5760/32000 (18%)] Loss: 5.71013 (QuantReg: 12.65966) QuantErr: 12.65966 batch_time=0.43390 
Train Epoch: 9 [56/250 7168/32000 (22%)] Loss: 6.71653 (QuantReg: 12.74411) QuantErr: 12.74411 batch_time=0.43963 
Train Epoch: 9 [67/250 8576/32000 (27%)] Loss: 6.50825 (QuantReg: 12.74573) QuantErr: 12.74573 batch_time=1.49929 
Train Epoch: 9 [78/250 9984/32000 (31%)] Loss: 5.47563 (QuantReg: 12.52899) QuantErr: 12.52899 batch_time=0.79829 
Train Epoch: 9 [89/250 11392/32000 (36%)] Loss: 6.82530 (QuantReg: 12.51484) QuantErr: 12.51484 batch_time=0.44205 
Train Epoch: 9 [100/250 12800/32000 (40%)] Loss: 5.18514 (QuantReg: 12.75487) QuantErr: 12.75487 batch_time=0.44074 
Train Epoch: 9 [111/250 14208/32000 (44%)] Loss: 5.31345 (QuantReg: 12.81301) QuantErr: 12.81301 batch_time=0.51774 
Train Epoch: 9 [122/250 15616/32000 (49%)] Loss: 6.48690 (QuantReg: 12.82190) QuantErr: 12.82190 batch_time=0.45007 
Train Epoch: 9 [133/250 17024/32000 (53%)] Loss: 6.11182 (QuantReg: 12.60709) QuantErr: 12.60709 batch_time=3.81412 
Train Epoch: 9 [144/250 18432/32000 (58%)] Loss: 6.98611 (QuantReg: 12.22885) QuantErr: 12.22885 batch_time=0.45639 
Train Epoch: 9 [155/250 19840/32000 (62%)] Loss: 5.94510 (QuantReg: 12.74417) QuantErr: 12.74417 batch_time=0.42817 
Train Epoch: 9 [166/250 21248/32000 (66%)] Loss: 7.36745 (QuantReg: 12.64758) QuantErr: 12.64758 batch_time=0.43158 
Train Epoch: 9 [177/250 22656/32000 (71%)] Loss: 5.24982 (QuantReg: 12.86215) QuantErr: 12.86215 batch_time=0.43290 
Train Epoch: 9 [188/250 24064/32000 (75%)] Loss: 6.62141 (QuantReg: 12.91276) QuantErr: 12.91276 batch_time=0.42894 
Train Epoch: 9 [199/250 25472/32000 (80%)] Loss: 4.72670 (QuantReg: 12.94839) QuantErr: 12.94839 batch_time=1.86866 
Train Epoch: 9 [210/250 26880/32000 (84%)] Loss: 5.63188 (QuantReg: 12.97427) QuantErr: 12.97427 batch_time=0.50367 
Train Epoch: 9 [221/250 28288/32000 (88%)] Loss: 6.56272 (QuantReg: 12.90164) QuantErr: 12.90164 batch_time=0.43615 
Train Epoch: 9 [232/250 29696/32000 (93%)] Loss: 5.82022 (QuantReg: 12.81933) QuantErr: 12.81933 batch_time=0.42890 
Train Epoch: 9 [243/250 31104/32000 (97%)] Loss: 5.46131 (QuantReg: 13.34725) QuantErr: 13.34725 batch_time=0.45245 
Train Epoch: 9 codebook_update_time=1.27577
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch9.pth ...
Done in 4.899s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch9.pth ...
Done in 28.125s
removing stale ckpt [epoch 8] [took 0.00s]
 epoch          : 9
 loss           : 6.178337562561035
 quant_reg      : 12.69364302444458
 quant_err      : 12.69364302444458
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 2250
 MSRVTT_full_val/t2v_metrics/R1: 29.577464788732396
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 78.87323943661971
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.396378269617706
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.13568610119686
 MSRVTT_full_val/v2t_metrics/R1: 33.40040241448692
 MSRVTT_full_val/v2t_metrics/R5: 74.04426559356136
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.617706237424548
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.67212975630632
 MSRVTT_full_test/t2v_metrics/R1: 12.006688963210703
 MSRVTT_full_test/t2v_metrics/R5: 32.474916387959865
 MSRVTT_full_test/t2v_metrics/R10: 45.38461538461539
 MSRVTT_full_test/t2v_metrics/R50: 78.99665551839465
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.509698996655516
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.059134477812105
 MSRVTT_full_test/v2t_metrics/R1: 13.979933110367893
 MSRVTT_full_test/v2t_metrics/R5: 38.26086956521739
 MSRVTT_full_test/v2t_metrics/R10: 53.47826086956522
 MSRVTT_full_test/v2t_metrics/R50: 84.54849498327759
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.438294314381274
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.58292842602312
 mnt_best       : 26.059134477812105
 not_improved_count: 0
Train Epoch: 10 [1/250 128/32000 (0%)] Loss: 5.80324 (QuantReg: 13.01300) QuantErr: 13.01300 batch_time=37.00398 
Train Epoch: 10 [12/250 1536/32000 (5%)] Loss: 4.98373 (QuantReg: 12.76316) QuantErr: 12.76316 batch_time=0.42678 
Train Epoch: 10 [23/250 2944/32000 (9%)] Loss: 6.11358 (QuantReg: 12.88920) QuantErr: 12.88920 batch_time=0.42729 
Train Epoch: 10 [34/250 4352/32000 (14%)] Loss: 6.00877 (QuantReg: 12.67776) QuantErr: 12.67776 batch_time=0.43582 
Train Epoch: 10 [45/250 5760/32000 (18%)] Loss: 6.94251 (QuantReg: 12.26119) QuantErr: 12.26119 batch_time=0.58164 
Train Epoch: 10 [56/250 7168/32000 (22%)] Loss: 5.68771 (QuantReg: 12.63270) QuantErr: 12.63270 batch_time=0.43372 
Train Epoch: 10 [67/250 8576/32000 (27%)] Loss: 6.42622 (QuantReg: 12.74110) QuantErr: 12.74110 batch_time=0.48654 
Train Epoch: 10 [78/250 9984/32000 (31%)] Loss: 5.46889 (QuantReg: 12.84187) QuantErr: 12.84187 batch_time=0.45065 
Train Epoch: 10 [89/250 11392/32000 (36%)] Loss: 7.34552 (QuantReg: 12.48493) QuantErr: 12.48493 batch_time=0.43240 
Train Epoch: 10 [100/250 12800/32000 (40%)] Loss: 7.87407 (QuantReg: 12.50287) QuantErr: 12.50287 batch_time=0.46578 
Train Epoch: 10 [111/250 14208/32000 (44%)] Loss: 5.30487 (QuantReg: 12.67660) QuantErr: 12.67660 batch_time=0.43724 
Train Epoch: 10 [122/250 15616/32000 (49%)] Loss: 5.91518 (QuantReg: 12.70086) QuantErr: 12.70086 batch_time=0.43650 
Train Epoch: 10 [133/250 17024/32000 (53%)] Loss: 6.34737 (QuantReg: 12.66086) QuantErr: 12.66086 batch_time=0.44332 
Train Epoch: 10 [144/250 18432/32000 (58%)] Loss: 5.11401 (QuantReg: 12.81498) QuantErr: 12.81498 batch_time=0.44242 
Train Epoch: 10 [155/250 19840/32000 (62%)] Loss: 4.69636 (QuantReg: 12.87346) QuantErr: 12.87346 batch_time=0.43283 
Train Epoch: 10 [166/250 21248/32000 (66%)] Loss: 5.71119 (QuantReg: 12.97631) QuantErr: 12.97631 batch_time=0.64298 
Train Epoch: 10 [177/250 22656/32000 (71%)] Loss: 5.27334 (QuantReg: 12.91722) QuantErr: 12.91722 batch_time=0.42847 
Train Epoch: 10 [188/250 24064/32000 (75%)] Loss: 6.33470 (QuantReg: 13.03710) QuantErr: 13.03710 batch_time=0.44713 
Train Epoch: 10 [199/250 25472/32000 (80%)] Loss: 5.89766 (QuantReg: 12.79606) QuantErr: 12.79606 batch_time=0.46550 
Train Epoch: 10 [210/250 26880/32000 (84%)] Loss: 5.59353 (QuantReg: 12.88054) QuantErr: 12.88054 batch_time=0.45343 
Train Epoch: 10 [221/250 28288/32000 (88%)] Loss: 6.35207 (QuantReg: 12.81186) QuantErr: 12.81186 batch_time=0.43033 
Train Epoch: 10 [232/250 29696/32000 (93%)] Loss: 4.80781 (QuantReg: 12.57023) QuantErr: 12.57023 batch_time=0.43694 
Train Epoch: 10 [243/250 31104/32000 (97%)] Loss: 4.45508 (QuantReg: 12.80535) QuantErr: 12.80535 batch_time=0.43534 
Train Epoch: 10 codebook_update_time=1.12655
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch10.pth ...
Done in 5.002s
removing stale ckpt [epoch 9] [took 0.13s]
 epoch          : 10
 loss           : 5.773538927078247
 quant_reg      : 12.686797508239746
 quant_err      : 12.686797508239746
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 28.37022132796781
 MSRVTT_full_val/t2v_metrics/R5: 67.00201207243461
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.181086519114688
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.48328288926259
 MSRVTT_full_val/v2t_metrics/R1: 35.61368209255533
 MSRVTT_full_val/v2t_metrics/R5: 71.62977867203219
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.869215291750503
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.38612061200483
 MSRVTT_full_test/t2v_metrics/R1: 11.605351170568563
 MSRVTT_full_test/t2v_metrics/R5: 32.441471571906355
 MSRVTT_full_test/t2v_metrics/R10: 45.25083612040134
 MSRVTT_full_test/t2v_metrics/R50: 78.66220735785953
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.84280936454849
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.73130505478652
 MSRVTT_full_test/v2t_metrics/R1: 13.010033444816054
 MSRVTT_full_test/v2t_metrics/R5: 38.66220735785953
 MSRVTT_full_test/v2t_metrics/R10: 54.180602006688964
 MSRVTT_full_test/v2t_metrics/R50: 84.38127090301003
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.461371237458195
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.093287090384013
 mnt_best       : 26.059134477812105
 not_improved_count: 1
Train Epoch: 11 [1/250 128/32000 (0%)] Loss: 5.80956 (QuantReg: 12.62844) QuantErr: 12.62844 batch_time=34.41549 
Train Epoch: 11 [12/250 1536/32000 (5%)] Loss: 4.24614 (QuantReg: 12.92875) QuantErr: 12.92875 batch_time=0.43612 
Train Epoch: 11 [23/250 2944/32000 (9%)] Loss: 6.10636 (QuantReg: 12.95179) QuantErr: 12.95179 batch_time=0.42159 
Train Epoch: 11 [34/250 4352/32000 (14%)] Loss: 6.01269 (QuantReg: 12.50086) QuantErr: 12.50086 batch_time=0.45845 
Train Epoch: 11 [45/250 5760/32000 (18%)] Loss: 5.75457 (QuantReg: 12.54735) QuantErr: 12.54735 batch_time=0.45393 
Train Epoch: 11 [56/250 7168/32000 (22%)] Loss: 5.16062 (QuantReg: 12.77864) QuantErr: 12.77864 batch_time=0.46421 
Train Epoch: 11 [67/250 8576/32000 (27%)] Loss: 5.51560 (QuantReg: 12.75253) QuantErr: 12.75253 batch_time=0.67832 
Train Epoch: 11 [78/250 9984/32000 (31%)] Loss: 5.25266 (QuantReg: 12.52953) QuantErr: 12.52953 batch_time=0.42482 
Train Epoch: 11 [89/250 11392/32000 (36%)] Loss: 6.25288 (QuantReg: 12.85794) QuantErr: 12.85794 batch_time=0.42795 
Train Epoch: 11 [100/250 12800/32000 (40%)] Loss: 5.46716 (QuantReg: 12.56282) QuantErr: 12.56282 batch_time=0.42981 
Train Epoch: 11 [111/250 14208/32000 (44%)] Loss: 6.04858 (QuantReg: 12.96050) QuantErr: 12.96050 batch_time=0.42355 
Train Epoch: 11 [122/250 15616/32000 (49%)] Loss: 6.53729 (QuantReg: 12.47635) QuantErr: 12.47635 batch_time=0.55226 
Train Epoch: 11 [133/250 17024/32000 (53%)] Loss: 5.53903 (QuantReg: 12.61777) QuantErr: 12.61777 batch_time=0.93085 
Train Epoch: 11 [144/250 18432/32000 (58%)] Loss: 5.42825 (QuantReg: 13.04634) QuantErr: 13.04634 batch_time=0.45273 
Train Epoch: 11 [155/250 19840/32000 (62%)] Loss: 5.60686 (QuantReg: 12.60651) QuantErr: 12.60651 batch_time=1.81795 
Train Epoch: 11 [166/250 21248/32000 (66%)] Loss: 5.66431 (QuantReg: 12.93976) QuantErr: 12.93976 batch_time=0.44208 
Train Epoch: 11 [177/250 22656/32000 (71%)] Loss: 6.29899 (QuantReg: 12.64462) QuantErr: 12.64462 batch_time=0.46505 
Train Epoch: 11 [188/250 24064/32000 (75%)] Loss: 5.36502 (QuantReg: 12.86254) QuantErr: 12.86254 batch_time=0.47346 
Train Epoch: 11 [199/250 25472/32000 (80%)] Loss: 6.37710 (QuantReg: 12.53551) QuantErr: 12.53551 batch_time=0.43628 
Train Epoch: 11 [210/250 26880/32000 (84%)] Loss: 5.71089 (QuantReg: 12.49591) QuantErr: 12.49591 batch_time=0.42000 
Train Epoch: 11 [221/250 28288/32000 (88%)] Loss: 5.81933 (QuantReg: 13.10112) QuantErr: 13.10112 batch_time=0.42504 
Train Epoch: 11 [232/250 29696/32000 (93%)] Loss: 6.09075 (QuantReg: 12.74083) QuantErr: 12.74083 batch_time=0.47600 
Train Epoch: 11 [243/250 31104/32000 (97%)] Loss: 5.49151 (QuantReg: 13.18763) QuantErr: 13.18763 batch_time=0.48625 
Train Epoch: 11 codebook_update_time=1.12809
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch11.pth ...
Done in 14.436s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 5.532399850845337
 quant_reg      : 12.74368141555786
 quant_err      : 12.74368141555786
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 2750
 MSRVTT_full_val/t2v_metrics/R1: 28.169014084507044
 MSRVTT_full_val/t2v_metrics/R5: 65.79476861167002
 MSRVTT_full_val/t2v_metrics/R10: 76.65995975855131
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.995975855130784
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.180775908139246
 MSRVTT_full_val/v2t_metrics/R1: 33.40040241448692
 MSRVTT_full_val/v2t_metrics/R5: 73.03822937625755
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.056338028169014
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.53942929636464
 MSRVTT_full_test/t2v_metrics/R1: 10.903010033444817
 MSRVTT_full_test/t2v_metrics/R5: 31.73913043478261
 MSRVTT_full_test/t2v_metrics/R10: 44.74916387959866
 MSRVTT_full_test/t2v_metrics/R50: 77.49163879598662
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.59849498327759
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.925399068489554
 MSRVTT_full_test/v2t_metrics/R1: 12.909698996655518
 MSRVTT_full_test/v2t_metrics/R5: 37.19063545150502
 MSRVTT_full_test/v2t_metrics/R10: 53.07692307692308
 MSRVTT_full_test/v2t_metrics/R50: 84.24749163879599
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.63026755852843
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.42739494105359
 mnt_best       : 26.059134477812105
 not_improved_count: 2
Train Epoch: 12 [1/250 128/32000 (0%)] Loss: 4.85163 (QuantReg: 12.86046) QuantErr: 12.86046 batch_time=39.47857 
Train Epoch: 12 [12/250 1536/32000 (5%)] Loss: 5.51196 (QuantReg: 12.81888) QuantErr: 12.81888 batch_time=0.41452 
Train Epoch: 12 [23/250 2944/32000 (9%)] Loss: 5.46875 (QuantReg: 12.70908) QuantErr: 12.70908 batch_time=0.43919 
Train Epoch: 12 [34/250 4352/32000 (14%)] Loss: 6.28325 (QuantReg: 12.51942) QuantErr: 12.51942 batch_time=0.43692 
Train Epoch: 12 [45/250 5760/32000 (18%)] Loss: 4.89320 (QuantReg: 12.67175) QuantErr: 12.67175 batch_time=0.42015 
Train Epoch: 12 [56/250 7168/32000 (22%)] Loss: 4.99552 (QuantReg: 12.80762) QuantErr: 12.80762 batch_time=0.41829 
Train Epoch: 12 [67/250 8576/32000 (27%)] Loss: 5.70627 (QuantReg: 12.72831) QuantErr: 12.72831 batch_time=0.44094 
Train Epoch: 12 [78/250 9984/32000 (31%)] Loss: 5.90601 (QuantReg: 12.95348) QuantErr: 12.95348 batch_time=0.43599 
Train Epoch: 12 [89/250 11392/32000 (36%)] Loss: 5.70583 (QuantReg: 12.50048) QuantErr: 12.50048 batch_time=0.42042 
Train Epoch: 12 [100/250 12800/32000 (40%)] Loss: 5.03456 (QuantReg: 12.83111) QuantErr: 12.83111 batch_time=0.44584 
Train Epoch: 12 [111/250 14208/32000 (44%)] Loss: 4.21780 (QuantReg: 12.41409) QuantErr: 12.41409 batch_time=0.43739 
Train Epoch: 12 [122/250 15616/32000 (49%)] Loss: 4.23376 (QuantReg: 12.78825) QuantErr: 12.78825 batch_time=0.64242 
Train Epoch: 12 [133/250 17024/32000 (53%)] Loss: 3.23299 (QuantReg: 12.94927) QuantErr: 12.94927 batch_time=0.44874 
Train Epoch: 12 [144/250 18432/32000 (58%)] Loss: 6.57112 (QuantReg: 12.62480) QuantErr: 12.62480 batch_time=0.41910 
Train Epoch: 12 [155/250 19840/32000 (62%)] Loss: 4.96964 (QuantReg: 13.04479) QuantErr: 13.04479 batch_time=0.44657 
Train Epoch: 12 [166/250 21248/32000 (66%)] Loss: 4.65857 (QuantReg: 13.11139) QuantErr: 13.11139 batch_time=0.44319 
Train Epoch: 12 [177/250 22656/32000 (71%)] Loss: 5.37976 (QuantReg: 13.22591) QuantErr: 13.22591 batch_time=1.23823 
Train Epoch: 12 [188/250 24064/32000 (75%)] Loss: 4.65683 (QuantReg: 13.01100) QuantErr: 13.01100 batch_time=0.42047 
Train Epoch: 12 [199/250 25472/32000 (80%)] Loss: 5.01269 (QuantReg: 12.93755) QuantErr: 12.93755 batch_time=0.41694 
Train Epoch: 12 [210/250 26880/32000 (84%)] Loss: 4.35198 (QuantReg: 12.77905) QuantErr: 12.77905 batch_time=0.41926 
Train Epoch: 12 [221/250 28288/32000 (88%)] Loss: 5.69386 (QuantReg: 12.89334) QuantErr: 12.89334 batch_time=0.43055 
Train Epoch: 12 [232/250 29696/32000 (93%)] Loss: 5.17093 (QuantReg: 13.19380) QuantErr: 13.19380 batch_time=0.79115 
Train Epoch: 12 [243/250 31104/32000 (97%)] Loss: 5.11430 (QuantReg: 12.72889) QuantErr: 12.72889 batch_time=0.42895 
Train Epoch: 12 codebook_update_time=1.01701
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch12.pth ...
Done in 23.294s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch12.pth ...
Done in 28.096s
removing stale ckpt [epoch 11] [took 0.02s]
 epoch          : 12
 loss           : 5.208314287185669
 quant_reg      : 12.785920459747315
 quant_err      : 12.785920459747315
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 31.388329979879277
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.806841046277666
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.80694796812396
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.388329979879276
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.19591273567722
 MSRVTT_full_test/t2v_metrics/R1: 11.872909698996656
 MSRVTT_full_test/t2v_metrics/R5: 34.91638795986622
 MSRVTT_full_test/t2v_metrics/R10: 49.531772575250834
 MSRVTT_full_test/t2v_metrics/R50: 80.76923076923077
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.332441471571904
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.38357306223415
 MSRVTT_full_test/v2t_metrics/R1: 14.749163879598662
 MSRVTT_full_test/v2t_metrics/R5: 40.836120401337794
 MSRVTT_full_test/v2t_metrics/R10: 55.852842809364546
 MSRVTT_full_test/v2t_metrics/R50: 85.65217391304348
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.8061872909699
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.28140188168761
 mnt_best       : 27.38357306223415
 not_improved_count: 0
Train Epoch: 13 [1/250 128/32000 (0%)] Loss: 5.49318 (QuantReg: 12.92590) QuantErr: 12.92590 batch_time=33.74323 
Train Epoch: 13 [12/250 1536/32000 (5%)] Loss: 5.53372 (QuantReg: 12.80486) QuantErr: 12.80486 batch_time=0.44357 
Train Epoch: 13 [23/250 2944/32000 (9%)] Loss: 4.21354 (QuantReg: 12.73759) QuantErr: 12.73759 batch_time=0.43085 
Train Epoch: 13 [34/250 4352/32000 (14%)] Loss: 5.83326 (QuantReg: 12.72560) QuantErr: 12.72560 batch_time=0.43599 
Train Epoch: 13 [45/250 5760/32000 (18%)] Loss: 3.99604 (QuantReg: 12.67945) QuantErr: 12.67945 batch_time=0.43612 
Train Epoch: 13 [56/250 7168/32000 (22%)] Loss: 3.71657 (QuantReg: 13.27030) QuantErr: 13.27030 batch_time=0.45471 
Train Epoch: 13 [67/250 8576/32000 (27%)] Loss: 4.54245 (QuantReg: 12.72006) QuantErr: 12.72006 batch_time=0.43870 
Train Epoch: 13 [78/250 9984/32000 (31%)] Loss: 4.48123 (QuantReg: 12.82285) QuantErr: 12.82285 batch_time=0.43077 
Train Epoch: 13 [89/250 11392/32000 (36%)] Loss: 5.07666 (QuantReg: 12.51180) QuantErr: 12.51180 batch_time=0.42638 
Train Epoch: 13 [100/250 12800/32000 (40%)] Loss: 4.78694 (QuantReg: 12.86067) QuantErr: 12.86067 batch_time=0.42282 
Train Epoch: 13 [111/250 14208/32000 (44%)] Loss: 4.98178 (QuantReg: 12.76111) QuantErr: 12.76111 batch_time=0.43454 
Train Epoch: 13 [122/250 15616/32000 (49%)] Loss: 5.24371 (QuantReg: 12.78134) QuantErr: 12.78134 batch_time=0.45948 
Train Epoch: 13 [133/250 17024/32000 (53%)] Loss: 5.21429 (QuantReg: 12.59617) QuantErr: 12.59617 batch_time=0.44129 
Train Epoch: 13 [144/250 18432/32000 (58%)] Loss: 4.90764 (QuantReg: 12.73357) QuantErr: 12.73357 batch_time=0.42249 
Train Epoch: 13 [155/250 19840/32000 (62%)] Loss: 3.75816 (QuantReg: 12.79078) QuantErr: 12.79078 batch_time=0.48660 
Train Epoch: 13 [166/250 21248/32000 (66%)] Loss: 5.34505 (QuantReg: 12.59012) QuantErr: 12.59012 batch_time=0.44014 
Train Epoch: 13 [177/250 22656/32000 (71%)] Loss: 4.75594 (QuantReg: 13.03182) QuantErr: 13.03182 batch_time=0.81261 
Train Epoch: 13 [188/250 24064/32000 (75%)] Loss: 5.06536 (QuantReg: 12.75699) QuantErr: 12.75699 batch_time=0.43014 
Train Epoch: 13 [199/250 25472/32000 (80%)] Loss: 4.93186 (QuantReg: 12.94472) QuantErr: 12.94472 batch_time=0.42413 
Train Epoch: 13 [210/250 26880/32000 (84%)] Loss: 5.24353 (QuantReg: 12.72422) QuantErr: 12.72422 batch_time=0.42343 
Train Epoch: 13 [221/250 28288/32000 (88%)] Loss: 4.58857 (QuantReg: 13.25368) QuantErr: 13.25368 batch_time=0.43810 
Train Epoch: 13 [232/250 29696/32000 (93%)] Loss: 6.26059 (QuantReg: 12.86953) QuantErr: 12.86953 batch_time=0.45878 
Train Epoch: 13 [243/250 31104/32000 (97%)] Loss: 4.39982 (QuantReg: 12.85880) QuantErr: 12.85880 batch_time=0.43417 
Train Epoch: 13 codebook_update_time=1.17270
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch13.pth ...
Done in 3.972s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 5.072538291931152
 quant_reg      : 12.848708503723145
 quant_err      : 12.848708503723145
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 3250
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.305835010060363
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.15128224821894
 MSRVTT_full_val/v2t_metrics/R1: 37.02213279678068
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.633802816901408
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.737009705923704
 MSRVTT_full_test/t2v_metrics/R1: 11.672240802675585
 MSRVTT_full_test/t2v_metrics/R5: 33.67892976588629
 MSRVTT_full_test/t2v_metrics/R10: 46.82274247491639
 MSRVTT_full_test/t2v_metrics/R50: 79.29765886287625
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.02742474916388
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.403193351241686
 MSRVTT_full_test/v2t_metrics/R1: 14.414715719063546
 MSRVTT_full_test/v2t_metrics/R5: 40.5685618729097
 MSRVTT_full_test/v2t_metrics/R10: 56.08695652173913
 MSRVTT_full_test/v2t_metrics/R50: 85.35117056856187
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.19364548494983
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.010013420043464
 mnt_best       : 27.38357306223415
 not_improved_count: 1
Train Epoch: 14 [1/250 128/32000 (0%)] Loss: 5.81442 (QuantReg: 12.71445) QuantErr: 12.71445 batch_time=34.18989 
Train Epoch: 14 [12/250 1536/32000 (5%)] Loss: 3.98032 (QuantReg: 13.13276) QuantErr: 13.13276 batch_time=0.42828 
Train Epoch: 14 [23/250 2944/32000 (9%)] Loss: 4.25002 (QuantReg: 12.95084) QuantErr: 12.95084 batch_time=0.43563 
Train Epoch: 14 [34/250 4352/32000 (14%)] Loss: 3.97096 (QuantReg: 12.75461) QuantErr: 12.75461 batch_time=0.42741 
Train Epoch: 14 [45/250 5760/32000 (18%)] Loss: 5.43122 (QuantReg: 12.95874) QuantErr: 12.95874 batch_time=0.44316 
Train Epoch: 14 [56/250 7168/32000 (22%)] Loss: 4.78748 (QuantReg: 12.86394) QuantErr: 12.86394 batch_time=0.43130 
Train Epoch: 14 [67/250 8576/32000 (27%)] Loss: 4.96865 (QuantReg: 12.60582) QuantErr: 12.60582 batch_time=0.44384 
Train Epoch: 14 [78/250 9984/32000 (31%)] Loss: 5.10833 (QuantReg: 12.41806) QuantErr: 12.41806 batch_time=0.44754 
Train Epoch: 14 [89/250 11392/32000 (36%)] Loss: 4.16652 (QuantReg: 13.04499) QuantErr: 13.04499 batch_time=0.46960 
Train Epoch: 14 [100/250 12800/32000 (40%)] Loss: 3.80807 (QuantReg: 13.31240) QuantErr: 13.31240 batch_time=0.42260 
Train Epoch: 14 [111/250 14208/32000 (44%)] Loss: 3.78466 (QuantReg: 13.02935) QuantErr: 13.02935 batch_time=0.44390 
Train Epoch: 14 [122/250 15616/32000 (49%)] Loss: 5.60844 (QuantReg: 13.23104) QuantErr: 13.23104 batch_time=0.43768 
Train Epoch: 14 [133/250 17024/32000 (53%)] Loss: 4.90777 (QuantReg: 12.92118) QuantErr: 12.92118 batch_time=2.83851 
Train Epoch: 14 [144/250 18432/32000 (58%)] Loss: 5.55328 (QuantReg: 12.65683) QuantErr: 12.65683 batch_time=0.41612 
Train Epoch: 14 [155/250 19840/32000 (62%)] Loss: 5.03727 (QuantReg: 13.01292) QuantErr: 13.01292 batch_time=0.41383 
Train Epoch: 14 [166/250 21248/32000 (66%)] Loss: 5.45262 (QuantReg: 12.88829) QuantErr: 12.88829 batch_time=0.41756 
Train Epoch: 14 [177/250 22656/32000 (71%)] Loss: 5.33051 (QuantReg: 12.57675) QuantErr: 12.57675 batch_time=0.42330 
Train Epoch: 14 [188/250 24064/32000 (75%)] Loss: 5.96692 (QuantReg: 12.74470) QuantErr: 12.74470 batch_time=0.42790 
Train Epoch: 14 [199/250 25472/32000 (80%)] Loss: 5.40900 (QuantReg: 13.14830) QuantErr: 13.14830 batch_time=0.43348 
Train Epoch: 14 [210/250 26880/32000 (84%)] Loss: 5.50296 (QuantReg: 12.94911) QuantErr: 12.94911 batch_time=0.41804 
Train Epoch: 14 [221/250 28288/32000 (88%)] Loss: 4.63731 (QuantReg: 13.01787) QuantErr: 13.01787 batch_time=0.45087 
Train Epoch: 14 [232/250 29696/32000 (93%)] Loss: 4.56155 (QuantReg: 13.21176) QuantErr: 13.21176 batch_time=0.44149 
Train Epoch: 14 [243/250 31104/32000 (97%)] Loss: 4.98631 (QuantReg: 13.08484) QuantErr: 13.08484 batch_time=0.43788 
Train Epoch: 14 codebook_update_time=0.97665
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch14.pth ...
Done in 3.852s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 4.858015194892883
 quant_reg      : 12.87810097503662
 quant_err      : 12.87810097503662
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.020120724346077
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.341860427251135
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.494969818913481
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.259101346122165
 MSRVTT_full_test/t2v_metrics/R1: 12.006688963210703
 MSRVTT_full_test/t2v_metrics/R5: 34.88294314381271
 MSRVTT_full_test/t2v_metrics/R10: 48.32775919732441
 MSRVTT_full_test/t2v_metrics/R50: 80.2675585284281
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.76254180602007
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.252792718717174
 MSRVTT_full_test/v2t_metrics/R1: 14.68227424749164
 MSRVTT_full_test/v2t_metrics/R5: 41.03678929765886
 MSRVTT_full_test/v2t_metrics/R10: 56.48829431438127
 MSRVTT_full_test/v2t_metrics/R50: 86.38795986622074
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.851003344481605
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.40721590551757
 mnt_best       : 27.38357306223415
 not_improved_count: 2
Train Epoch: 15 [1/250 128/32000 (0%)] Loss: 5.08349 (QuantReg: 12.76031) QuantErr: 12.76031 batch_time=38.16022 
Train Epoch: 15 [12/250 1536/32000 (5%)] Loss: 4.10501 (QuantReg: 13.14082) QuantErr: 13.14082 batch_time=0.43143 
Train Epoch: 15 [23/250 2944/32000 (9%)] Loss: 5.41930 (QuantReg: 12.90268) QuantErr: 12.90268 batch_time=0.43860 
Train Epoch: 15 [34/250 4352/32000 (14%)] Loss: 5.42652 (QuantReg: 12.57979) QuantErr: 12.57979 batch_time=0.67289 
Train Epoch: 15 [45/250 5760/32000 (18%)] Loss: 4.80126 (QuantReg: 12.82047) QuantErr: 12.82047 batch_time=0.45392 
Train Epoch: 15 [56/250 7168/32000 (22%)] Loss: 5.18442 (QuantReg: 12.86601) QuantErr: 12.86601 batch_time=0.42380 
Train Epoch: 15 [67/250 8576/32000 (27%)] Loss: 5.60370 (QuantReg: 12.65144) QuantErr: 12.65144 batch_time=0.43655 
Train Epoch: 15 [78/250 9984/32000 (31%)] Loss: 5.13353 (QuantReg: 12.82859) QuantErr: 12.82859 batch_time=0.42893 
Train Epoch: 15 [89/250 11392/32000 (36%)] Loss: 4.07025 (QuantReg: 13.11568) QuantErr: 13.11568 batch_time=0.47268 
Train Epoch: 15 [100/250 12800/32000 (40%)] Loss: 4.92883 (QuantReg: 12.62067) QuantErr: 12.62067 batch_time=0.45028 
Train Epoch: 15 [111/250 14208/32000 (44%)] Loss: 3.84878 (QuantReg: 12.94265) QuantErr: 12.94265 batch_time=0.44842 
Train Epoch: 15 [122/250 15616/32000 (49%)] Loss: 4.50434 (QuantReg: 12.78616) QuantErr: 12.78616 batch_time=0.44453 
Train Epoch: 15 [133/250 17024/32000 (53%)] Loss: 4.15734 (QuantReg: 13.06217) QuantErr: 13.06217 batch_time=0.43088 
Train Epoch: 15 [144/250 18432/32000 (58%)] Loss: 4.92104 (QuantReg: 12.91008) QuantErr: 12.91008 batch_time=1.49783 
Train Epoch: 15 [155/250 19840/32000 (62%)] Loss: 4.21350 (QuantReg: 12.82538) QuantErr: 12.82538 batch_time=0.43078 
Train Epoch: 15 [166/250 21248/32000 (66%)] Loss: 5.09935 (QuantReg: 12.79439) QuantErr: 12.79439 batch_time=0.43652 
Train Epoch: 15 [177/250 22656/32000 (71%)] Loss: 4.52236 (QuantReg: 13.02978) QuantErr: 13.02978 batch_time=0.42684 
Train Epoch: 15 [188/250 24064/32000 (75%)] Loss: 4.90993 (QuantReg: 12.65930) QuantErr: 12.65930 batch_time=0.55415 
Train Epoch: 15 [199/250 25472/32000 (80%)] Loss: 4.70365 (QuantReg: 13.07147) QuantErr: 13.07147 batch_time=0.43399 
Train Epoch: 15 [210/250 26880/32000 (84%)] Loss: 4.22555 (QuantReg: 13.07132) QuantErr: 13.07132 batch_time=0.44017 
Train Epoch: 15 [221/250 28288/32000 (88%)] Loss: 3.23033 (QuantReg: 13.07854) QuantErr: 13.07854 batch_time=0.44366 
Train Epoch: 15 [232/250 29696/32000 (93%)] Loss: 4.04429 (QuantReg: 12.84018) QuantErr: 12.84018 batch_time=0.44236 
Train Epoch: 15 [243/250 31104/32000 (97%)] Loss: 4.87335 (QuantReg: 12.87399) QuantErr: 12.87399 batch_time=0.42713 
Train Epoch: 15 codebook_update_time=1.05126
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch15.pth ...
Done in 4.403s
removing stale ckpt [epoch 14] [took 0.01s]
 epoch          : 15
 loss           : 4.706735206604004
 quant_reg      : 12.881005752563476
 quant_err      : 12.881005752563476
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 3750
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 66.19718309859155
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.114688128772636
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.252505095472664
 MSRVTT_full_val/v2t_metrics/R1: 32.59557344064386
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.810865191146881
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.64791975002318
 MSRVTT_full_test/t2v_metrics/R1: 11.638795986622073
 MSRVTT_full_test/t2v_metrics/R5: 33.21070234113712
 MSRVTT_full_test/t2v_metrics/R10: 46.45484949832776
 MSRVTT_full_test/t2v_metrics/R50: 78.62876254180603
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.48595317725753
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.186194606061765
 MSRVTT_full_test/v2t_metrics/R1: 14.51505016722408
 MSRVTT_full_test/v2t_metrics/R5: 40.468227424749166
 MSRVTT_full_test/v2t_metrics/R10: 55.785953177257525
 MSRVTT_full_test/v2t_metrics/R50: 85.55183946488295
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.060367892976586
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.000187798106076
 mnt_best       : 27.38357306223415
 not_improved_count: 3
Train Epoch: 16 [1/250 128/32000 (0%)] Loss: 4.87879 (QuantReg: 12.93907) QuantErr: 12.93907 batch_time=31.57805 
Train Epoch: 16 [12/250 1536/32000 (5%)] Loss: 5.25032 (QuantReg: 12.94713) QuantErr: 12.94713 batch_time=0.43952 
Train Epoch: 16 [23/250 2944/32000 (9%)] Loss: 5.09922 (QuantReg: 12.76017) QuantErr: 12.76017 batch_time=2.69611 
Train Epoch: 16 [34/250 4352/32000 (14%)] Loss: 4.53019 (QuantReg: 13.02910) QuantErr: 13.02910 batch_time=1.21517 
Train Epoch: 16 [45/250 5760/32000 (18%)] Loss: 4.57906 (QuantReg: 12.61362) QuantErr: 12.61362 batch_time=0.45013 
Train Epoch: 16 [56/250 7168/32000 (22%)] Loss: 3.58209 (QuantReg: 12.65675) QuantErr: 12.65675 batch_time=0.42898 
Train Epoch: 16 [67/250 8576/32000 (27%)] Loss: 5.13360 (QuantReg: 13.02537) QuantErr: 13.02537 batch_time=0.94486 
Train Epoch: 16 [78/250 9984/32000 (31%)] Loss: 3.27656 (QuantReg: 12.87080) QuantErr: 12.87080 batch_time=0.44941 
Train Epoch: 16 [89/250 11392/32000 (36%)] Loss: 5.46346 (QuantReg: 12.91924) QuantErr: 12.91924 batch_time=0.46179 
Train Epoch: 16 [100/250 12800/32000 (40%)] Loss: 3.78205 (QuantReg: 12.95104) QuantErr: 12.95104 batch_time=0.43365 
Train Epoch: 16 [111/250 14208/32000 (44%)] Loss: 4.52641 (QuantReg: 13.01365) QuantErr: 13.01365 batch_time=0.44089 
Train Epoch: 16 [122/250 15616/32000 (49%)] Loss: 5.27899 (QuantReg: 12.97845) QuantErr: 12.97845 batch_time=0.46793 
Train Epoch: 16 [133/250 17024/32000 (53%)] Loss: 4.49196 (QuantReg: 13.02305) QuantErr: 13.02305 batch_time=0.46991 
Train Epoch: 16 [144/250 18432/32000 (58%)] Loss: 4.35305 (QuantReg: 13.11005) QuantErr: 13.11005 batch_time=1.09032 
Train Epoch: 16 [155/250 19840/32000 (62%)] Loss: 4.87412 (QuantReg: 12.57498) QuantErr: 12.57498 batch_time=0.48248 
Train Epoch: 16 [166/250 21248/32000 (66%)] Loss: 4.22001 (QuantReg: 12.91315) QuantErr: 12.91315 batch_time=0.44480 
Train Epoch: 16 [177/250 22656/32000 (71%)] Loss: 4.78013 (QuantReg: 13.00235) QuantErr: 13.00235 batch_time=0.44139 
Train Epoch: 16 [188/250 24064/32000 (75%)] Loss: 5.13644 (QuantReg: 12.55851) QuantErr: 12.55851 batch_time=0.43738 
Train Epoch: 16 [199/250 25472/32000 (80%)] Loss: 4.48424 (QuantReg: 12.92617) QuantErr: 12.92617 batch_time=0.47388 
Train Epoch: 16 [210/250 26880/32000 (84%)] Loss: 4.63523 (QuantReg: 13.03879) QuantErr: 13.03879 batch_time=0.46931 
Train Epoch: 16 [221/250 28288/32000 (88%)] Loss: 5.13038 (QuantReg: 12.78190) QuantErr: 12.78190 batch_time=0.44344 
Train Epoch: 16 [232/250 29696/32000 (93%)] Loss: 4.11045 (QuantReg: 12.95421) QuantErr: 12.95421 batch_time=0.43174 
Train Epoch: 16 [243/250 31104/32000 (97%)] Loss: 4.08566 (QuantReg: 12.86608) QuantErr: 12.86608 batch_time=0.41917 
Train Epoch: 16 codebook_update_time=1.01364
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch16.pth ...
Done in 3.782s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 4.526156377792359
 quant_reg      : 12.917806930541992
 quant_err      : 12.917806930541992
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.42655935613682
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.43968014854706
 MSRVTT_full_val/v2t_metrics/R1: 35.412474849094565
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 97.1830985915493
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.770623742454728
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.71242493083207
 MSRVTT_full_test/t2v_metrics/R1: 11.939799331103679
 MSRVTT_full_test/t2v_metrics/R5: 33.91304347826087
 MSRVTT_full_test/t2v_metrics/R10: 47.69230769230769
 MSRVTT_full_test/t2v_metrics/R50: 80.33444816053512
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.32408026755853
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.828972720453233
 MSRVTT_full_test/v2t_metrics/R1: 15.250836120401338
 MSRVTT_full_test/v2t_metrics/R5: 41.37123745819398
 MSRVTT_full_test/v2t_metrics/R10: 56.08695652173913
 MSRVTT_full_test/v2t_metrics/R50: 85.65217391304348
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.04598662207358
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.83104300377727
 mnt_best       : 27.38357306223415
 not_improved_count: 4
Train Epoch: 17 [1/250 128/32000 (0%)] Loss: 4.95587 (QuantReg: 12.93223) QuantErr: 12.93223 batch_time=30.29751 
Train Epoch: 17 [12/250 1536/32000 (5%)] Loss: 4.00861 (QuantReg: 13.05960) QuantErr: 13.05960 batch_time=0.42254 
Train Epoch: 17 [23/250 2944/32000 (9%)] Loss: 4.42310 (QuantReg: 12.54632) QuantErr: 12.54632 batch_time=0.43635 
Train Epoch: 17 [34/250 4352/32000 (14%)] Loss: 4.55178 (QuantReg: 13.01689) QuantErr: 13.01689 batch_time=0.43216 
Train Epoch: 17 [45/250 5760/32000 (18%)] Loss: 3.31633 (QuantReg: 12.89155) QuantErr: 12.89155 batch_time=0.42399 
Train Epoch: 17 [56/250 7168/32000 (22%)] Loss: 4.17540 (QuantReg: 12.80234) QuantErr: 12.80234 batch_time=0.44188 
Train Epoch: 17 [67/250 8576/32000 (27%)] Loss: 4.60625 (QuantReg: 12.78346) QuantErr: 12.78346 batch_time=0.57381 
Train Epoch: 17 [78/250 9984/32000 (31%)] Loss: 2.96639 (QuantReg: 13.16974) QuantErr: 13.16974 batch_time=0.43894 
Train Epoch: 17 [89/250 11392/32000 (36%)] Loss: 4.14899 (QuantReg: 13.01037) QuantErr: 13.01037 batch_time=0.45786 
Train Epoch: 17 [100/250 12800/32000 (40%)] Loss: 5.35815 (QuantReg: 12.42680) QuantErr: 12.42680 batch_time=0.45194 
Train Epoch: 17 [111/250 14208/32000 (44%)] Loss: 5.65356 (QuantReg: 12.70117) QuantErr: 12.70117 batch_time=0.43609 
Train Epoch: 17 [122/250 15616/32000 (49%)] Loss: 3.90646 (QuantReg: 13.12895) QuantErr: 13.12895 batch_time=0.44001 
Train Epoch: 17 [133/250 17024/32000 (53%)] Loss: 4.57375 (QuantReg: 13.08396) QuantErr: 13.08396 batch_time=1.07885 
Train Epoch: 17 [144/250 18432/32000 (58%)] Loss: 4.53621 (QuantReg: 12.82728) QuantErr: 12.82728 batch_time=0.44187 
Train Epoch: 17 [155/250 19840/32000 (62%)] Loss: 4.38409 (QuantReg: 13.28491) QuantErr: 13.28491 batch_time=0.43790 
Train Epoch: 17 [166/250 21248/32000 (66%)] Loss: 3.80575 (QuantReg: 12.90569) QuantErr: 12.90569 batch_time=0.42952 
Train Epoch: 17 [177/250 22656/32000 (71%)] Loss: 5.63633 (QuantReg: 12.76990) QuantErr: 12.76990 batch_time=0.43480 
Train Epoch: 17 [188/250 24064/32000 (75%)] Loss: 4.65625 (QuantReg: 13.07565) QuantErr: 13.07565 batch_time=0.44296 
Train Epoch: 17 [199/250 25472/32000 (80%)] Loss: 4.10383 (QuantReg: 12.93972) QuantErr: 12.93972 batch_time=0.44248 
Train Epoch: 17 [210/250 26880/32000 (84%)] Loss: 4.51311 (QuantReg: 12.67879) QuantErr: 12.67879 batch_time=0.43861 
Train Epoch: 17 [221/250 28288/32000 (88%)] Loss: 5.31465 (QuantReg: 12.95510) QuantErr: 12.95510 batch_time=0.43371 
Train Epoch: 17 [232/250 29696/32000 (93%)] Loss: 4.12360 (QuantReg: 12.87393) QuantErr: 12.87393 batch_time=0.42976 
Train Epoch: 17 [243/250 31104/32000 (97%)] Loss: 3.67612 (QuantReg: 13.01567) QuantErr: 13.01567 batch_time=0.42183 
Train Epoch: 17 codebook_update_time=0.90872
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch17.pth ...
Done in 3.682s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch17.pth ...
Done in 7.235s
removing stale ckpt [epoch 16] [took 0.00s]
 epoch          : 17
 loss           : 4.450270254135132
 quant_reg      : 12.969017776489258
 quant_err      : 12.969017776489258
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 4250
 MSRVTT_full_val/t2v_metrics/R1: 33.601609657947684
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.132796780684105
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.282011310962965
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.311871227364185
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.36360053983531
 MSRVTT_full_test/t2v_metrics/R1: 12.74247491638796
 MSRVTT_full_test/t2v_metrics/R5: 34.8494983277592
 MSRVTT_full_test/t2v_metrics/R10: 48.862876254180605
 MSRVTT_full_test/t2v_metrics/R50: 79.96655518394648
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.65083612040134
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.89179397115229
 MSRVTT_full_test/v2t_metrics/R1: 15.217391304347826
 MSRVTT_full_test/v2t_metrics/R5: 43.31103678929766
 MSRVTT_full_test/v2t_metrics/R10: 57.65886287625418
 MSRVTT_full_test/v2t_metrics/R50: 86.08695652173913
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.589130434782604
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.620302796272625
 mnt_best       : 27.89179397115229
 not_improved_count: 0
Train Epoch: 18 [1/250 128/32000 (0%)] Loss: 4.61122 (QuantReg: 12.89560) QuantErr: 12.89560 batch_time=31.25709 
Train Epoch: 18 [12/250 1536/32000 (5%)] Loss: 5.39247 (QuantReg: 13.00704) QuantErr: 13.00704 batch_time=0.44036 
Train Epoch: 18 [23/250 2944/32000 (9%)] Loss: 4.35235 (QuantReg: 12.39058) QuantErr: 12.39058 batch_time=0.46502 
Train Epoch: 18 [34/250 4352/32000 (14%)] Loss: 4.15741 (QuantReg: 12.82939) QuantErr: 12.82939 batch_time=0.44238 
Train Epoch: 18 [45/250 5760/32000 (18%)] Loss: 4.36760 (QuantReg: 13.05039) QuantErr: 13.05039 batch_time=0.43152 
Train Epoch: 18 [56/250 7168/32000 (22%)] Loss: 4.55457 (QuantReg: 12.74512) QuantErr: 12.74512 batch_time=0.71522 
Train Epoch: 18 [67/250 8576/32000 (27%)] Loss: 4.40522 (QuantReg: 12.64292) QuantErr: 12.64292 batch_time=1.93877 
Train Epoch: 18 [78/250 9984/32000 (31%)] Loss: 4.39566 (QuantReg: 12.78606) QuantErr: 12.78606 batch_time=0.42310 
Train Epoch: 18 [89/250 11392/32000 (36%)] Loss: 3.92274 (QuantReg: 13.07661) QuantErr: 13.07661 batch_time=0.42508 
Train Epoch: 18 [100/250 12800/32000 (40%)] Loss: 4.01084 (QuantReg: 13.07814) QuantErr: 13.07814 batch_time=0.55975 
Train Epoch: 18 [111/250 14208/32000 (44%)] Loss: 3.82849 (QuantReg: 13.10753) QuantErr: 13.10753 batch_time=0.45449 
Train Epoch: 18 [122/250 15616/32000 (49%)] Loss: 5.72042 (QuantReg: 12.98011) QuantErr: 12.98011 batch_time=0.45100 
Train Epoch: 18 [133/250 17024/32000 (53%)] Loss: 4.17511 (QuantReg: 12.80007) QuantErr: 12.80007 batch_time=0.42279 
Train Epoch: 18 [144/250 18432/32000 (58%)] Loss: 3.82482 (QuantReg: 12.81382) QuantErr: 12.81382 batch_time=1.69642 
Train Epoch: 18 [155/250 19840/32000 (62%)] Loss: 3.95797 (QuantReg: 12.97879) QuantErr: 12.97879 batch_time=0.44146 
Train Epoch: 18 [166/250 21248/32000 (66%)] Loss: 3.90755 (QuantReg: 12.81016) QuantErr: 12.81016 batch_time=0.44847 
Train Epoch: 18 [177/250 22656/32000 (71%)] Loss: 4.16285 (QuantReg: 13.09091) QuantErr: 13.09091 batch_time=0.44940 
Train Epoch: 18 [188/250 24064/32000 (75%)] Loss: 4.13207 (QuantReg: 12.87642) QuantErr: 12.87642 batch_time=0.42752 
Train Epoch: 18 [199/250 25472/32000 (80%)] Loss: 4.97481 (QuantReg: 13.03168) QuantErr: 13.03168 batch_time=0.43924 
Train Epoch: 18 [210/250 26880/32000 (84%)] Loss: 4.14606 (QuantReg: 12.98039) QuantErr: 12.98039 batch_time=0.42596 
Train Epoch: 18 [221/250 28288/32000 (88%)] Loss: 3.87154 (QuantReg: 13.18864) QuantErr: 13.18864 batch_time=0.42218 
Train Epoch: 18 [232/250 29696/32000 (93%)] Loss: 4.94541 (QuantReg: 12.91005) QuantErr: 12.91005 batch_time=0.44264 
Train Epoch: 18 [243/250 31104/32000 (97%)] Loss: 4.57665 (QuantReg: 13.04416) QuantErr: 13.04416 batch_time=0.43027 
Train Epoch: 18 codebook_update_time=0.96714
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch18.pth ...
Done in 3.886s
removing stale ckpt [epoch 17] [took 0.00s]
 epoch          : 18
 loss           : 4.301696144104004
 quant_reg      : 12.974472511291504
 quant_err      : 12.974472511291504
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 80.28169014084507
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.51307847082495
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.28249174104778
 MSRVTT_full_val/v2t_metrics/R1: 36.01609657947686
 MSRVTT_full_val/v2t_metrics/R5: 73.64185110663983
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.887323943661972
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.36455872117894
 MSRVTT_full_test/t2v_metrics/R1: 12.274247491638796
 MSRVTT_full_test/t2v_metrics/R5: 35.35117056856188
 MSRVTT_full_test/t2v_metrics/R10: 48.59531772575251
 MSRVTT_full_test/t2v_metrics/R50: 79.03010033444816
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.907023411371235
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.62682862180728
 MSRVTT_full_test/v2t_metrics/R1: 15.183946488294314
 MSRVTT_full_test/v2t_metrics/R5: 41.50501672240803
 MSRVTT_full_test/v2t_metrics/R10: 56.38795986622073
 MSRVTT_full_test/v2t_metrics/R50: 85.81939799331104
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.19046822742475
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.87687622018817
 mnt_best       : 27.89179397115229
 not_improved_count: 1
Train Epoch: 19 [1/250 128/32000 (0%)] Loss: 3.77151 (QuantReg: 12.81918) QuantErr: 12.81918 batch_time=38.72158 
Train Epoch: 19 [12/250 1536/32000 (5%)] Loss: 3.67171 (QuantReg: 13.25140) QuantErr: 13.25140 batch_time=0.43492 
Train Epoch: 19 [23/250 2944/32000 (9%)] Loss: 6.07602 (QuantReg: 12.80316) QuantErr: 12.80316 batch_time=0.43425 
Train Epoch: 19 [34/250 4352/32000 (14%)] Loss: 3.87803 (QuantReg: 13.11252) QuantErr: 13.11252 batch_time=0.42975 
Train Epoch: 19 [45/250 5760/32000 (18%)] Loss: 4.24562 (QuantReg: 13.05787) QuantErr: 13.05787 batch_time=0.43654 
Train Epoch: 19 [56/250 7168/32000 (22%)] Loss: 3.69349 (QuantReg: 12.96724) QuantErr: 12.96724 batch_time=0.91646 
Train Epoch: 19 [67/250 8576/32000 (27%)] Loss: 3.79538 (QuantReg: 13.04872) QuantErr: 13.04872 batch_time=0.43811 
Train Epoch: 19 [78/250 9984/32000 (31%)] Loss: 4.24388 (QuantReg: 13.10923) QuantErr: 13.10923 batch_time=0.43265 
Train Epoch: 19 [89/250 11392/32000 (36%)] Loss: 3.52776 (QuantReg: 12.93653) QuantErr: 12.93653 batch_time=1.04558 
Train Epoch: 19 [100/250 12800/32000 (40%)] Loss: 4.65636 (QuantReg: 12.81062) QuantErr: 12.81062 batch_time=0.44012 
Train Epoch: 19 [111/250 14208/32000 (44%)] Loss: 4.36864 (QuantReg: 12.85508) QuantErr: 12.85508 batch_time=0.45910 
Train Epoch: 19 [122/250 15616/32000 (49%)] Loss: 4.15598 (QuantReg: 13.03612) QuantErr: 13.03612 batch_time=0.45658 
Train Epoch: 19 [133/250 17024/32000 (53%)] Loss: 4.63538 (QuantReg: 13.17627) QuantErr: 13.17627 batch_time=0.47841 
Train Epoch: 19 [144/250 18432/32000 (58%)] Loss: 3.06507 (QuantReg: 13.03884) QuantErr: 13.03884 batch_time=1.60494 
Train Epoch: 19 [155/250 19840/32000 (62%)] Loss: 3.79198 (QuantReg: 12.75776) QuantErr: 12.75776 batch_time=0.46833 
Train Epoch: 19 [166/250 21248/32000 (66%)] Loss: 4.00218 (QuantReg: 13.06667) QuantErr: 13.06667 batch_time=0.44477 
Train Epoch: 19 [177/250 22656/32000 (71%)] Loss: 3.36305 (QuantReg: 12.98733) QuantErr: 12.98733 batch_time=0.44408 
Train Epoch: 19 [188/250 24064/32000 (75%)] Loss: 3.21159 (QuantReg: 13.05785) QuantErr: 13.05785 batch_time=0.43140 
Train Epoch: 19 [199/250 25472/32000 (80%)] Loss: 4.20792 (QuantReg: 12.98831) QuantErr: 12.98831 batch_time=0.43492 
Train Epoch: 19 [210/250 26880/32000 (84%)] Loss: 3.90125 (QuantReg: 13.06150) QuantErr: 13.06150 batch_time=0.43192 
Train Epoch: 19 [221/250 28288/32000 (88%)] Loss: 3.08775 (QuantReg: 12.96344) QuantErr: 12.96344 batch_time=0.44367 
Train Epoch: 19 [232/250 29696/32000 (93%)] Loss: 3.45363 (QuantReg: 13.14857) QuantErr: 13.14857 batch_time=0.52376 
Train Epoch: 19 [243/250 31104/32000 (97%)] Loss: 3.38010 (QuantReg: 13.08946) QuantErr: 13.08946 batch_time=0.44257 
Train Epoch: 19 codebook_update_time=1.19209
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch19.pth ...
Done in 21.464s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch19.pth ...
Done in 25.346s
removing stale ckpt [epoch 18] [took 0.00s]
 epoch          : 19
 loss           : 4.131071610450745
 quant_reg      : 13.038872783660889
 quant_err      : 13.038872783660889
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 4750
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.00804828973843
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.49936999397212
 MSRVTT_full_val/v2t_metrics/R1: 35.010060362173036
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.503018108651911
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.734954754201844
 MSRVTT_full_test/t2v_metrics/R1: 12.508361204013378
 MSRVTT_full_test/t2v_metrics/R5: 35.618729096989966
 MSRVTT_full_test/t2v_metrics/R10: 49.93311036789298
 MSRVTT_full_test/t2v_metrics/R50: 81.43812709030101
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.64682274247492
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.124781097729134
 MSRVTT_full_test/v2t_metrics/R1: 15.618729096989966
 MSRVTT_full_test/v2t_metrics/R5: 42.508361204013376
 MSRVTT_full_test/v2t_metrics/R10: 57.357859531772576
 MSRVTT_full_test/v2t_metrics/R50: 86.95652173913044
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.52675585284281
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.6437448108678
 mnt_best       : 28.124781097729134
 not_improved_count: 0
Train Epoch: 20 [1/250 128/32000 (0%)] Loss: 3.96220 (QuantReg: 13.03906) QuantErr: 13.03906 batch_time=29.23924 
Train Epoch: 20 [12/250 1536/32000 (5%)] Loss: 3.96371 (QuantReg: 13.04517) QuantErr: 13.04517 batch_time=0.42230 
Train Epoch: 20 [23/250 2944/32000 (9%)] Loss: 4.11967 (QuantReg: 12.73654) QuantErr: 12.73654 batch_time=0.64152 
Train Epoch: 20 [34/250 4352/32000 (14%)] Loss: 4.17032 (QuantReg: 13.01086) QuantErr: 13.01086 batch_time=0.48506 
Train Epoch: 20 [45/250 5760/32000 (18%)] Loss: 3.72973 (QuantReg: 12.99183) QuantErr: 12.99183 batch_time=0.44604 
Train Epoch: 20 [56/250 7168/32000 (22%)] Loss: 4.70278 (QuantReg: 12.82199) QuantErr: 12.82199 batch_time=0.44730 
Train Epoch: 20 [67/250 8576/32000 (27%)] Loss: 3.09854 (QuantReg: 13.12180) QuantErr: 13.12180 batch_time=0.41443 
Train Epoch: 20 [78/250 9984/32000 (31%)] Loss: 3.75585 (QuantReg: 12.98705) QuantErr: 12.98705 batch_time=0.42258 
Train Epoch: 20 [89/250 11392/32000 (36%)] Loss: 5.05529 (QuantReg: 12.89619) QuantErr: 12.89619 batch_time=0.44273 
Train Epoch: 20 [100/250 12800/32000 (40%)] Loss: 4.65720 (QuantReg: 12.74560) QuantErr: 12.74560 batch_time=0.43725 
Train Epoch: 20 [111/250 14208/32000 (44%)] Loss: 4.28867 (QuantReg: 12.96842) QuantErr: 12.96842 batch_time=0.45946 
Train Epoch: 20 [122/250 15616/32000 (49%)] Loss: 4.52640 (QuantReg: 13.03464) QuantErr: 13.03464 batch_time=0.46960 
Train Epoch: 20 [133/250 17024/32000 (53%)] Loss: 4.74789 (QuantReg: 13.38414) QuantErr: 13.38414 batch_time=0.87108 
Train Epoch: 20 [144/250 18432/32000 (58%)] Loss: 4.27772 (QuantReg: 13.00341) QuantErr: 13.00341 batch_time=2.08410 
Train Epoch: 20 [155/250 19840/32000 (62%)] Loss: 3.82258 (QuantReg: 13.14600) QuantErr: 13.14600 batch_time=0.44055 
Train Epoch: 20 [166/250 21248/32000 (66%)] Loss: 4.73798 (QuantReg: 13.29318) QuantErr: 13.29318 batch_time=0.43470 
Train Epoch: 20 [177/250 22656/32000 (71%)] Loss: 3.41288 (QuantReg: 13.17700) QuantErr: 13.17700 batch_time=0.44333 
Train Epoch: 20 [188/250 24064/32000 (75%)] Loss: 3.68435 (QuantReg: 13.15936) QuantErr: 13.15936 batch_time=0.48110 
Train Epoch: 20 [199/250 25472/32000 (80%)] Loss: 4.45399 (QuantReg: 12.82166) QuantErr: 12.82166 batch_time=0.42886 
Train Epoch: 20 [210/250 26880/32000 (84%)] Loss: 3.48651 (QuantReg: 12.96548) QuantErr: 12.96548 batch_time=0.42426 
Train Epoch: 20 [221/250 28288/32000 (88%)] Loss: 3.89735 (QuantReg: 13.18647) QuantErr: 13.18647 batch_time=0.43405 
Train Epoch: 20 [232/250 29696/32000 (93%)] Loss: 4.48126 (QuantReg: 12.97877) QuantErr: 12.97877 batch_time=0.44157 
Train Epoch: 20 [243/250 31104/32000 (97%)] Loss: 5.43895 (QuantReg: 12.81112) QuantErr: 12.81112 batch_time=0.45612 
Train Epoch: 20 codebook_update_time=0.91588
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch20.pth ...
Done in 3.746s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 4.105284695625305
 quant_reg      : 12.998554313659668
 quant_err      : 12.998554313659668
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 68.41046277665995
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.273641851106639
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.24225779934601
 MSRVTT_full_val/v2t_metrics/R1: 36.01609657947686
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.161971830985915
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.21842796564471
 MSRVTT_full_test/t2v_metrics/R1: 12.341137123745819
 MSRVTT_full_test/t2v_metrics/R5: 35.953177257525084
 MSRVTT_full_test/t2v_metrics/R10: 48.72909698996656
 MSRVTT_full_test/t2v_metrics/R50: 80.03344481605352
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.610033444816054
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.85866316581945
 MSRVTT_full_test/v2t_metrics/R1: 15.986622073578594
 MSRVTT_full_test/v2t_metrics/R5: 41.97324414715719
 MSRVTT_full_test/v2t_metrics/R10: 56.72240802675585
 MSRVTT_full_test/v2t_metrics/R50: 86.05351170568562
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.45117056856188
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.63782977312891
 mnt_best       : 28.124781097729134
 not_improved_count: 1
Train Epoch: 21 [1/250 128/32000 (0%)] Loss: 4.65731 (QuantReg: 13.23760) QuantErr: 13.23760 batch_time=32.96652 
Train Epoch: 21 [12/250 1536/32000 (5%)] Loss: 4.13057 (QuantReg: 12.73814) QuantErr: 12.73814 batch_time=0.45553 
Train Epoch: 21 [23/250 2944/32000 (9%)] Loss: 3.84928 (QuantReg: 13.08974) QuantErr: 13.08974 batch_time=0.45628 
Train Epoch: 21 [34/250 4352/32000 (14%)] Loss: 4.71247 (QuantReg: 13.12657) QuantErr: 13.12657 batch_time=0.43088 
Train Epoch: 21 [45/250 5760/32000 (18%)] Loss: 3.64747 (QuantReg: 13.04280) QuantErr: 13.04280 batch_time=0.42746 
Train Epoch: 21 [56/250 7168/32000 (22%)] Loss: 4.79212 (QuantReg: 12.81944) QuantErr: 12.81944 batch_time=0.48139 
Train Epoch: 21 [67/250 8576/32000 (27%)] Loss: 3.26490 (QuantReg: 13.25830) QuantErr: 13.25830 batch_time=0.46406 
Train Epoch: 21 [78/250 9984/32000 (31%)] Loss: 4.54522 (QuantReg: 12.67501) QuantErr: 12.67501 batch_time=1.00415 
Train Epoch: 21 [89/250 11392/32000 (36%)] Loss: 5.18898 (QuantReg: 13.08761) QuantErr: 13.08761 batch_time=0.57743 
Train Epoch: 21 [100/250 12800/32000 (40%)] Loss: 3.59702 (QuantReg: 13.29301) QuantErr: 13.29301 batch_time=0.43709 
Train Epoch: 21 [111/250 14208/32000 (44%)] Loss: 4.58111 (QuantReg: 12.75196) QuantErr: 12.75196 batch_time=0.44054 
Train Epoch: 21 [122/250 15616/32000 (49%)] Loss: 3.77653 (QuantReg: 12.94325) QuantErr: 12.94325 batch_time=0.42649 
Train Epoch: 21 [133/250 17024/32000 (53%)] Loss: 3.41293 (QuantReg: 13.22358) QuantErr: 13.22358 batch_time=0.75188 
Train Epoch: 21 [144/250 18432/32000 (58%)] Loss: 4.39486 (QuantReg: 12.94885) QuantErr: 12.94885 batch_time=0.43922 
Train Epoch: 21 [155/250 19840/32000 (62%)] Loss: 3.75935 (QuantReg: 12.79629) QuantErr: 12.79629 batch_time=0.43752 
Train Epoch: 21 [166/250 21248/32000 (66%)] Loss: 3.31653 (QuantReg: 13.34051) QuantErr: 13.34051 batch_time=0.43598 
Train Epoch: 21 [177/250 22656/32000 (71%)] Loss: 2.92475 (QuantReg: 13.46619) QuantErr: 13.46619 batch_time=0.43452 
Train Epoch: 21 [188/250 24064/32000 (75%)] Loss: 3.30104 (QuantReg: 13.25583) QuantErr: 13.25583 batch_time=0.44174 
Train Epoch: 21 [199/250 25472/32000 (80%)] Loss: 4.93392 (QuantReg: 13.11196) QuantErr: 13.11196 batch_time=0.48685 
Train Epoch: 21 [210/250 26880/32000 (84%)] Loss: 3.48417 (QuantReg: 13.29486) QuantErr: 13.29486 batch_time=1.58825 
Train Epoch: 21 [221/250 28288/32000 (88%)] Loss: 3.61212 (QuantReg: 13.06298) QuantErr: 13.06298 batch_time=0.43441 
Train Epoch: 21 [232/250 29696/32000 (93%)] Loss: 3.41293 (QuantReg: 13.22577) QuantErr: 13.22577 batch_time=0.42803 
Train Epoch: 21 [243/250 31104/32000 (97%)] Loss: 3.53530 (QuantReg: 13.43521) QuantErr: 13.43521 batch_time=1.11580 
Train Epoch: 21 codebook_update_time=0.84955
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch21.pth ...
Done in 9.988s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch21.pth ...
Done in 13.743s
removing stale ckpt [epoch 20] [took 0.00s]
 epoch          : 21
 loss           : 4.04403293800354
 quant_reg      : 13.039393028259278
 quant_err      : 13.039393028259278
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 5250
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.599597585513078
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.34540382727882
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 75.45271629778672
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.313883299798793
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.299320276654676
 MSRVTT_full_test/t2v_metrics/R1: 12.575250836120402
 MSRVTT_full_test/t2v_metrics/R5: 37.591973244147155
 MSRVTT_full_test/t2v_metrics/R10: 51.03678929765886
 MSRVTT_full_test/t2v_metrics/R50: 81.70568561872909
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.8876254180602
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.895599434810975
 MSRVTT_full_test/v2t_metrics/R1: 16.45484949832776
 MSRVTT_full_test/v2t_metrics/R5: 44.74916387959866
 MSRVTT_full_test/v2t_metrics/R10: 58.42809364548495
 MSRVTT_full_test/v2t_metrics/R50: 86.92307692307692
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.81020066889632
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.04022224681093
 mnt_best       : 28.895599434810975
 not_improved_count: 0
Train Epoch: 22 [1/250 128/32000 (0%)] Loss: 3.10792 (QuantReg: 13.21903) QuantErr: 13.21903 batch_time=41.12420 
Train Epoch: 22 [12/250 1536/32000 (5%)] Loss: 4.55134 (QuantReg: 12.82853) QuantErr: 12.82853 batch_time=0.42797 
Train Epoch: 22 [23/250 2944/32000 (9%)] Loss: 4.75444 (QuantReg: 12.59263) QuantErr: 12.59263 batch_time=0.42861 
Train Epoch: 22 [34/250 4352/32000 (14%)] Loss: 3.61561 (QuantReg: 13.03934) QuantErr: 13.03934 batch_time=0.43599 
Train Epoch: 22 [45/250 5760/32000 (18%)] Loss: 2.98698 (QuantReg: 13.53819) QuantErr: 13.53819 batch_time=0.45929 
Train Epoch: 22 [56/250 7168/32000 (22%)] Loss: 4.29846 (QuantReg: 13.03065) QuantErr: 13.03065 batch_time=0.44620 
Train Epoch: 22 [67/250 8576/32000 (27%)] Loss: 3.92528 (QuantReg: 13.29344) QuantErr: 13.29344 batch_time=0.42633 
Train Epoch: 22 [78/250 9984/32000 (31%)] Loss: 4.76706 (QuantReg: 13.04596) QuantErr: 13.04596 batch_time=0.44039 
Train Epoch: 22 [89/250 11392/32000 (36%)] Loss: 3.39624 (QuantReg: 13.14160) QuantErr: 13.14160 batch_time=0.44644 
Train Epoch: 22 [100/250 12800/32000 (40%)] Loss: 3.66688 (QuantReg: 13.11042) QuantErr: 13.11042 batch_time=0.48317 
Train Epoch: 22 [111/250 14208/32000 (44%)] Loss: 2.35831 (QuantReg: 13.41136) QuantErr: 13.41136 batch_time=0.44969 
Train Epoch: 22 [122/250 15616/32000 (49%)] Loss: 3.78592 (QuantReg: 12.83675) QuantErr: 12.83675 batch_time=0.42885 
Train Epoch: 22 [133/250 17024/32000 (53%)] Loss: 3.01423 (QuantReg: 13.11929) QuantErr: 13.11929 batch_time=0.45010 
Train Epoch: 22 [144/250 18432/32000 (58%)] Loss: 3.53158 (QuantReg: 12.95429) QuantErr: 12.95429 batch_time=2.30412 
Train Epoch: 22 [155/250 19840/32000 (62%)] Loss: 3.52868 (QuantReg: 13.13930) QuantErr: 13.13930 batch_time=0.44754 
Train Epoch: 22 [166/250 21248/32000 (66%)] Loss: 4.43225 (QuantReg: 12.88996) QuantErr: 12.88996 batch_time=0.47181 
Train Epoch: 22 [177/250 22656/32000 (71%)] Loss: 3.68348 (QuantReg: 13.39226) QuantErr: 13.39226 batch_time=0.51003 
Train Epoch: 22 [188/250 24064/32000 (75%)] Loss: 3.11632 (QuantReg: 13.17904) QuantErr: 13.17904 batch_time=0.42805 
Train Epoch: 22 [199/250 25472/32000 (80%)] Loss: 3.83086 (QuantReg: 12.98013) QuantErr: 12.98013 batch_time=0.47313 
Train Epoch: 22 [210/250 26880/32000 (84%)] Loss: 3.28904 (QuantReg: 13.22611) QuantErr: 13.22611 batch_time=0.43493 
Train Epoch: 22 [221/250 28288/32000 (88%)] Loss: 4.08335 (QuantReg: 13.16899) QuantErr: 13.16899 batch_time=0.42341 
Train Epoch: 22 [232/250 29696/32000 (93%)] Loss: 3.77870 (QuantReg: 12.92808) QuantErr: 12.92808 batch_time=0.42297 
Train Epoch: 22 [243/250 31104/32000 (97%)] Loss: 3.66963 (QuantReg: 12.94789) QuantErr: 12.94789 batch_time=0.42127 
Train Epoch: 22 codebook_update_time=0.97789
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch22.pth ...
Done in 4.410s
removing stale ckpt [epoch 21] [took 0.00s]
 epoch          : 22
 loss           : 3.8537007217407226
 quant_reg      : 13.047436988830567
 quant_err      : 13.047436988830567
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.217303822937627
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.34872354391932
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 88.73239436619718
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.084507042253521
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.40092211257132
 MSRVTT_full_test/t2v_metrics/R1: 12.876254180602007
 MSRVTT_full_test/t2v_metrics/R5: 36.15384615384615
 MSRVTT_full_test/t2v_metrics/R10: 49.46488294314381
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.449498327759194
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.449873793527487
 MSRVTT_full_test/v2t_metrics/R1: 16.254180602006688
 MSRVTT_full_test/v2t_metrics/R5: 43.74581939799331
 MSRVTT_full_test/v2t_metrics/R10: 58.2943143812709
 MSRVTT_full_test/v2t_metrics/R50: 87.29096989966555
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.1871237458194
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.60795561660233
 mnt_best       : 28.895599434810975
 not_improved_count: 1
Train Epoch: 23 [1/250 128/32000 (0%)] Loss: 4.46934 (QuantReg: 13.24918) QuantErr: 13.24918 batch_time=32.35731 
Train Epoch: 23 [12/250 1536/32000 (5%)] Loss: 4.42424 (QuantReg: 13.08488) QuantErr: 13.08488 batch_time=0.44476 
Train Epoch: 23 [23/250 2944/32000 (9%)] Loss: 2.92823 (QuantReg: 12.92838) QuantErr: 12.92838 batch_time=0.42521 
Train Epoch: 23 [34/250 4352/32000 (14%)] Loss: 4.13854 (QuantReg: 12.96326) QuantErr: 12.96326 batch_time=0.43597 
Train Epoch: 23 [45/250 5760/32000 (18%)] Loss: 4.11081 (QuantReg: 13.12212) QuantErr: 13.12212 batch_time=0.46223 
Train Epoch: 23 [56/250 7168/32000 (22%)] Loss: 3.69247 (QuantReg: 12.95800) QuantErr: 12.95800 batch_time=0.46834 
Train Epoch: 23 [67/250 8576/32000 (27%)] Loss: 4.42618 (QuantReg: 13.25324) QuantErr: 13.25324 batch_time=1.16616 
Train Epoch: 23 [78/250 9984/32000 (31%)] Loss: 3.72901 (QuantReg: 13.00954) QuantErr: 13.00954 batch_time=0.45599 
Train Epoch: 23 [89/250 11392/32000 (36%)] Loss: 4.07207 (QuantReg: 12.97969) QuantErr: 12.97969 batch_time=0.44268 
Train Epoch: 23 [100/250 12800/32000 (40%)] Loss: 3.63085 (QuantReg: 12.97687) QuantErr: 12.97687 batch_time=0.41803 
Train Epoch: 23 [111/250 14208/32000 (44%)] Loss: 3.05616 (QuantReg: 13.37155) QuantErr: 13.37155 batch_time=0.43957 
Train Epoch: 23 [122/250 15616/32000 (49%)] Loss: 4.57648 (QuantReg: 12.78763) QuantErr: 12.78763 batch_time=0.42285 
Train Epoch: 23 [133/250 17024/32000 (53%)] Loss: 3.06103 (QuantReg: 12.92505) QuantErr: 12.92505 batch_time=2.65067 
Train Epoch: 23 [144/250 18432/32000 (58%)] Loss: 3.43973 (QuantReg: 13.05459) QuantErr: 13.05459 batch_time=2.15870 
Train Epoch: 23 [155/250 19840/32000 (62%)] Loss: 5.06197 (QuantReg: 12.75715) QuantErr: 12.75715 batch_time=0.42595 
Train Epoch: 23 [166/250 21248/32000 (66%)] Loss: 4.55947 (QuantReg: 12.77858) QuantErr: 12.77858 batch_time=0.44335 
Train Epoch: 23 [177/250 22656/32000 (71%)] Loss: 3.29079 (QuantReg: 12.99652) QuantErr: 12.99652 batch_time=0.43194 
Train Epoch: 23 [188/250 24064/32000 (75%)] Loss: 3.99151 (QuantReg: 13.27382) QuantErr: 13.27382 batch_time=0.43495 
Train Epoch: 23 [199/250 25472/32000 (80%)] Loss: 4.10196 (QuantReg: 13.01502) QuantErr: 13.01502 batch_time=0.44046 
Train Epoch: 23 [210/250 26880/32000 (84%)] Loss: 4.07744 (QuantReg: 13.14007) QuantErr: 13.14007 batch_time=0.44931 
Train Epoch: 23 [221/250 28288/32000 (88%)] Loss: 4.22030 (QuantReg: 13.03472) QuantErr: 13.03472 batch_time=0.42790 
Train Epoch: 23 [232/250 29696/32000 (93%)] Loss: 4.02356 (QuantReg: 13.15798) QuantErr: 13.15798 batch_time=0.42073 
Train Epoch: 23 [243/250 31104/32000 (97%)] Loss: 3.73251 (QuantReg: 13.27301) QuantErr: 13.27301 batch_time=0.42340 
Train Epoch: 23 codebook_update_time=1.55212
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch23.pth ...
Done in 3.658s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch23.pth ...
Done in 14.527s
removing stale ckpt [epoch 22] [took 0.04s]
 epoch          : 23
 loss           : 3.8186384439468384
 quant_reg      : 13.083483741760254
 quant_err      : 13.083483741760254
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 5750
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.531187122736418
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.96157303584092
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.21327967806841
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.069695180889816
 MSRVTT_full_test/t2v_metrics/R1: 12.909698996655518
 MSRVTT_full_test/t2v_metrics/R5: 37.357859531772576
 MSRVTT_full_test/t2v_metrics/R10: 50.40133779264214
 MSRVTT_full_test/t2v_metrics/R50: 81.50501672240803
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.65083612040134
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.967658262469897
 MSRVTT_full_test/v2t_metrics/R1: 15.68561872909699
 MSRVTT_full_test/v2t_metrics/R5: 43.67892976588629
 MSRVTT_full_test/v2t_metrics/R10: 58.12709030100334
 MSRVTT_full_test/v2t_metrics/R50: 87.1571906354515
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.211204013377927
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.14947847505934
 mnt_best       : 28.967658262469897
 not_improved_count: 0
Train Epoch: 24 [1/250 128/32000 (0%)] Loss: 2.88592 (QuantReg: 13.00716) QuantErr: 13.00716 batch_time=31.01232 
Train Epoch: 24 [12/250 1536/32000 (5%)] Loss: 4.14830 (QuantReg: 13.09613) QuantErr: 13.09613 batch_time=0.59713 
Train Epoch: 24 [23/250 2944/32000 (9%)] Loss: 3.00503 (QuantReg: 12.88118) QuantErr: 12.88118 batch_time=0.43962 
Train Epoch: 24 [34/250 4352/32000 (14%)] Loss: 3.34216 (QuantReg: 13.25128) QuantErr: 13.25128 batch_time=0.42335 
Train Epoch: 24 [45/250 5760/32000 (18%)] Loss: 3.35670 (QuantReg: 12.86218) QuantErr: 12.86218 batch_time=0.43413 
Train Epoch: 24 [56/250 7168/32000 (22%)] Loss: 3.22861 (QuantReg: 12.85641) QuantErr: 12.85641 batch_time=0.90277 
Train Epoch: 24 [67/250 8576/32000 (27%)] Loss: 3.85452 (QuantReg: 13.03120) QuantErr: 13.03120 batch_time=0.45186 
Train Epoch: 24 [78/250 9984/32000 (31%)] Loss: 4.06255 (QuantReg: 13.06246) QuantErr: 13.06246 batch_time=0.42046 
Train Epoch: 24 [89/250 11392/32000 (36%)] Loss: 3.77701 (QuantReg: 13.04794) QuantErr: 13.04794 batch_time=0.41771 
Train Epoch: 24 [100/250 12800/32000 (40%)] Loss: 4.43781 (QuantReg: 13.27839) QuantErr: 13.27839 batch_time=0.74317 
Train Epoch: 24 [111/250 14208/32000 (44%)] Loss: 3.80113 (QuantReg: 13.24837) QuantErr: 13.24837 batch_time=0.46972 
Train Epoch: 24 [122/250 15616/32000 (49%)] Loss: 4.43112 (QuantReg: 13.03493) QuantErr: 13.03493 batch_time=0.43648 
Train Epoch: 24 [133/250 17024/32000 (53%)] Loss: 3.64166 (QuantReg: 13.30250) QuantErr: 13.30250 batch_time=0.42043 
Train Epoch: 24 [144/250 18432/32000 (58%)] Loss: 2.96013 (QuantReg: 13.10890) QuantErr: 13.10890 batch_time=1.62911 
Train Epoch: 24 [155/250 19840/32000 (62%)] Loss: 3.39320 (QuantReg: 13.02779) QuantErr: 13.02779 batch_time=0.41737 
Train Epoch: 24 [166/250 21248/32000 (66%)] Loss: 3.07465 (QuantReg: 13.20866) QuantErr: 13.20866 batch_time=0.42756 
Train Epoch: 24 [177/250 22656/32000 (71%)] Loss: 3.75270 (QuantReg: 13.15410) QuantErr: 13.15410 batch_time=0.44141 
Train Epoch: 24 [188/250 24064/32000 (75%)] Loss: 3.96629 (QuantReg: 12.85814) QuantErr: 12.85814 batch_time=0.43908 
Train Epoch: 24 [199/250 25472/32000 (80%)] Loss: 4.55533 (QuantReg: 13.18000) QuantErr: 13.18000 batch_time=0.46435 
Train Epoch: 24 [210/250 26880/32000 (84%)] Loss: 3.10112 (QuantReg: 13.16480) QuantErr: 13.16480 batch_time=0.41604 
Train Epoch: 24 [221/250 28288/32000 (88%)] Loss: 2.76981 (QuantReg: 13.28672) QuantErr: 13.28672 batch_time=0.43638 
Train Epoch: 24 [232/250 29696/32000 (93%)] Loss: 3.74923 (QuantReg: 13.07506) QuantErr: 13.07506 batch_time=0.43543 
Train Epoch: 24 [243/250 31104/32000 (97%)] Loss: 3.66109 (QuantReg: 13.09718) QuantErr: 13.09718 batch_time=0.45588 
Train Epoch: 24 codebook_update_time=1.02120
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch24.pth ...
Done in 3.811s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 3.698353368759155
 quant_reg      : 13.084691982269288
 quant_err      : 13.084691982269288
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.37625754527163
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.993046442981196
 MSRVTT_full_val/v2t_metrics/R1: 34.60764587525151
 MSRVTT_full_val/v2t_metrics/R5: 75.0503018108652
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.430583501006036
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.031276914573255
 MSRVTT_full_test/t2v_metrics/R1: 12.608695652173912
 MSRVTT_full_test/t2v_metrics/R5: 36.45484949832776
 MSRVTT_full_test/t2v_metrics/R10: 50.903010033444815
 MSRVTT_full_test/t2v_metrics/R50: 80.3010033444816
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.81204013377926
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.60155499019409
 MSRVTT_full_test/v2t_metrics/R1: 15.752508361204013
 MSRVTT_full_test/v2t_metrics/R5: 43.47826086956522
 MSRVTT_full_test/v2t_metrics/R10: 58.2943143812709
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.73060200668896
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.17821367152107
 mnt_best       : 28.967658262469897
 not_improved_count: 1
Train Epoch: 25 [1/250 128/32000 (0%)] Loss: 3.24731 (QuantReg: 12.88568) QuantErr: 12.88568 batch_time=41.07221 
Train Epoch: 25 [12/250 1536/32000 (5%)] Loss: 3.57424 (QuantReg: 12.73587) QuantErr: 12.73587 batch_time=0.46751 
Train Epoch: 25 [23/250 2944/32000 (9%)] Loss: 3.41868 (QuantReg: 13.39047) QuantErr: 13.39047 batch_time=0.43562 
Train Epoch: 25 [34/250 4352/32000 (14%)] Loss: 2.35747 (QuantReg: 13.34004) QuantErr: 13.34004 batch_time=0.44615 
Train Epoch: 25 [45/250 5760/32000 (18%)] Loss: 3.43836 (QuantReg: 12.92744) QuantErr: 12.92744 batch_time=0.43736 
Train Epoch: 25 [56/250 7168/32000 (22%)] Loss: 2.73961 (QuantReg: 13.51018) QuantErr: 13.51018 batch_time=0.44436 
Train Epoch: 25 [67/250 8576/32000 (27%)] Loss: 4.19411 (QuantReg: 13.08903) QuantErr: 13.08903 batch_time=0.43397 
Train Epoch: 25 [78/250 9984/32000 (31%)] Loss: 3.40843 (QuantReg: 13.01706) QuantErr: 13.01706 batch_time=0.49891 
Train Epoch: 25 [89/250 11392/32000 (36%)] Loss: 3.35775 (QuantReg: 13.22808) QuantErr: 13.22808 batch_time=0.43584 
Train Epoch: 25 [100/250 12800/32000 (40%)] Loss: 3.16840 (QuantReg: 13.33853) QuantErr: 13.33853 batch_time=0.58167 
Train Epoch: 25 [111/250 14208/32000 (44%)] Loss: 3.26772 (QuantReg: 13.27487) QuantErr: 13.27487 batch_time=0.44666 
Train Epoch: 25 [122/250 15616/32000 (49%)] Loss: 3.54771 (QuantReg: 13.34043) QuantErr: 13.34043 batch_time=0.43877 
Train Epoch: 25 [133/250 17024/32000 (53%)] Loss: 4.20254 (QuantReg: 13.27685) QuantErr: 13.27685 batch_time=0.43686 
Train Epoch: 25 [144/250 18432/32000 (58%)] Loss: 3.80257 (QuantReg: 13.32006) QuantErr: 13.32006 batch_time=0.65378 
Train Epoch: 25 [155/250 19840/32000 (62%)] Loss: 3.30374 (QuantReg: 13.34825) QuantErr: 13.34825 batch_time=0.43495 
Train Epoch: 25 [166/250 21248/32000 (66%)] Loss: 4.15140 (QuantReg: 13.15262) QuantErr: 13.15262 batch_time=0.43858 
Train Epoch: 25 [177/250 22656/32000 (71%)] Loss: 4.91761 (QuantReg: 12.95601) QuantErr: 12.95601 batch_time=0.46108 
Train Epoch: 25 [188/250 24064/32000 (75%)] Loss: 3.62069 (QuantReg: 13.03831) QuantErr: 13.03831 batch_time=0.44488 
Train Epoch: 25 [199/250 25472/32000 (80%)] Loss: 3.06282 (QuantReg: 13.24481) QuantErr: 13.24481 batch_time=0.43304 
Train Epoch: 25 [210/250 26880/32000 (84%)] Loss: 4.49332 (QuantReg: 13.16056) QuantErr: 13.16056 batch_time=0.43093 
Train Epoch: 25 [221/250 28288/32000 (88%)] Loss: 2.98393 (QuantReg: 13.18332) QuantErr: 13.18332 batch_time=0.43723 
Train Epoch: 25 [232/250 29696/32000 (93%)] Loss: 3.65025 (QuantReg: 13.10397) QuantErr: 13.10397 batch_time=0.43770 
Train Epoch: 25 [243/250 31104/32000 (97%)] Loss: 4.25421 (QuantReg: 13.28880) QuantErr: 13.28880 batch_time=0.45332 
Train Epoch: 25 codebook_update_time=1.19461
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch25.pth ...
Done in 3.790s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 3.6742311573028563
 quant_reg      : 13.126783992767335
 quant_err      : 13.126783992767335
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 6250
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.277665995975855
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.57116736884743
 MSRVTT_full_val/v2t_metrics/R1: 34.60764587525151
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.5875251509054324
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.976687192318174
 MSRVTT_full_test/t2v_metrics/R1: 13.076923076923077
 MSRVTT_full_test/t2v_metrics/R5: 36.020066889632105
 MSRVTT_full_test/t2v_metrics/R10: 49.46488294314381
 MSRVTT_full_test/t2v_metrics/R50: 80.5685618729097
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.69799331103679
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.56158842045546
 MSRVTT_full_test/v2t_metrics/R1: 15.518394648829432
 MSRVTT_full_test/v2t_metrics/R5: 43.44481605351171
 MSRVTT_full_test/v2t_metrics/R10: 58.69565217391305
 MSRVTT_full_test/v2t_metrics/R50: 86.98996655518394
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.754180602006688
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.07717326897622
 mnt_best       : 28.967658262469897
 not_improved_count: 2
Train Epoch: 26 [1/250 128/32000 (0%)] Loss: 3.13847 (QuantReg: 13.20154) QuantErr: 13.20154 batch_time=37.18983 
Train Epoch: 26 [12/250 1536/32000 (5%)] Loss: 3.23924 (QuantReg: 13.15203) QuantErr: 13.15203 batch_time=0.42585 
Train Epoch: 26 [23/250 2944/32000 (9%)] Loss: 3.44276 (QuantReg: 13.06140) QuantErr: 13.06140 batch_time=0.43506 
Train Epoch: 26 [34/250 4352/32000 (14%)] Loss: 4.15015 (QuantReg: 12.82959) QuantErr: 12.82959 batch_time=0.45147 
Train Epoch: 26 [45/250 5760/32000 (18%)] Loss: 3.96927 (QuantReg: 12.99984) QuantErr: 12.99984 batch_time=0.41948 
Train Epoch: 26 [56/250 7168/32000 (22%)] Loss: 3.96074 (QuantReg: 13.31386) QuantErr: 13.31386 batch_time=0.45559 
Train Epoch: 26 [67/250 8576/32000 (27%)] Loss: 4.79930 (QuantReg: 13.04955) QuantErr: 13.04955 batch_time=0.47194 
Train Epoch: 26 [78/250 9984/32000 (31%)] Loss: 2.81333 (QuantReg: 13.18282) QuantErr: 13.18282 batch_time=0.43682 
Train Epoch: 26 [89/250 11392/32000 (36%)] Loss: 3.57163 (QuantReg: 13.39912) QuantErr: 13.39912 batch_time=0.43633 
Train Epoch: 26 [100/250 12800/32000 (40%)] Loss: 3.20261 (QuantReg: 12.80532) QuantErr: 12.80532 batch_time=0.42691 
Train Epoch: 26 [111/250 14208/32000 (44%)] Loss: 3.68258 (QuantReg: 12.87373) QuantErr: 12.87373 batch_time=0.42524 
Train Epoch: 26 [122/250 15616/32000 (49%)] Loss: 3.25276 (QuantReg: 13.21936) QuantErr: 13.21936 batch_time=0.42974 
Train Epoch: 26 [133/250 17024/32000 (53%)] Loss: 2.78774 (QuantReg: 13.35522) QuantErr: 13.35522 batch_time=0.84586 
Train Epoch: 26 [144/250 18432/32000 (58%)] Loss: 3.47675 (QuantReg: 12.85672) QuantErr: 12.85672 batch_time=0.42552 
Train Epoch: 26 [155/250 19840/32000 (62%)] Loss: 3.63943 (QuantReg: 12.97844) QuantErr: 12.97844 batch_time=0.44000 
Train Epoch: 26 [166/250 21248/32000 (66%)] Loss: 4.18767 (QuantReg: 13.00805) QuantErr: 13.00805 batch_time=0.55458 
Train Epoch: 26 [177/250 22656/32000 (71%)] Loss: 3.72084 (QuantReg: 13.03616) QuantErr: 13.03616 batch_time=0.43763 
Train Epoch: 26 [188/250 24064/32000 (75%)] Loss: 3.21960 (QuantReg: 13.15213) QuantErr: 13.15213 batch_time=0.45891 
Train Epoch: 26 [199/250 25472/32000 (80%)] Loss: 3.20842 (QuantReg: 12.96640) QuantErr: 12.96640 batch_time=0.42217 
Train Epoch: 26 [210/250 26880/32000 (84%)] Loss: 3.17435 (QuantReg: 12.94406) QuantErr: 12.94406 batch_time=0.44130 
Train Epoch: 26 [221/250 28288/32000 (88%)] Loss: 3.23577 (QuantReg: 13.60852) QuantErr: 13.60852 batch_time=0.44377 
Train Epoch: 26 [232/250 29696/32000 (93%)] Loss: 4.19452 (QuantReg: 13.16799) QuantErr: 13.16799 batch_time=0.42385 
Train Epoch: 26 [243/250 31104/32000 (97%)] Loss: 3.72907 (QuantReg: 13.31294) QuantErr: 13.31294 batch_time=0.41955 
Train Epoch: 26 codebook_update_time=0.92459
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch26.pth ...
Done in 6.923s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 3.5834826221466063
 quant_reg      : 13.136938915252685
 quant_err      : 13.136938915252685
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 31.58953722334004
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.102615694164989
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.79662369785151
 MSRVTT_full_val/v2t_metrics/R1: 36.01609657947686
 MSRVTT_full_val/v2t_metrics/R5: 75.45271629778672
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.269617706237424
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.81581883479172
 MSRVTT_full_test/t2v_metrics/R1: 12.608695652173912
 MSRVTT_full_test/t2v_metrics/R5: 36.45484949832776
 MSRVTT_full_test/t2v_metrics/R10: 49.83277591973244
 MSRVTT_full_test/t2v_metrics/R50: 81.40468227424749
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.72123745819398
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.39968461898722
 MSRVTT_full_test/v2t_metrics/R1: 16.52173913043478
 MSRVTT_full_test/v2t_metrics/R5: 43.61204013377927
 MSRVTT_full_test/v2t_metrics/R10: 57.95986622073578
 MSRVTT_full_test/v2t_metrics/R50: 87.09030100334448
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.18444816053511
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.694703418527276
 mnt_best       : 28.967658262469897
 not_improved_count: 3
Train Epoch: 27 [1/250 128/32000 (0%)] Loss: 3.83643 (QuantReg: 12.97405) QuantErr: 12.97405 batch_time=37.87040 
Train Epoch: 27 [12/250 1536/32000 (5%)] Loss: 3.41008 (QuantReg: 13.07273) QuantErr: 13.07273 batch_time=0.44944 
Train Epoch: 27 [23/250 2944/32000 (9%)] Loss: 4.34152 (QuantReg: 12.85721) QuantErr: 12.85721 batch_time=0.43254 
Train Epoch: 27 [34/250 4352/32000 (14%)] Loss: 3.45301 (QuantReg: 13.19113) QuantErr: 13.19113 batch_time=0.45125 
Train Epoch: 27 [45/250 5760/32000 (18%)] Loss: 3.71374 (QuantReg: 13.13218) QuantErr: 13.13218 batch_time=0.43663 
Train Epoch: 27 [56/250 7168/32000 (22%)] Loss: 4.02120 (QuantReg: 13.35865) QuantErr: 13.35865 batch_time=0.43506 
Train Epoch: 27 [67/250 8576/32000 (27%)] Loss: 4.40533 (QuantReg: 13.07238) QuantErr: 13.07238 batch_time=0.46518 
Train Epoch: 27 [78/250 9984/32000 (31%)] Loss: 4.18766 (QuantReg: 13.03982) QuantErr: 13.03982 batch_time=0.45467 
Train Epoch: 27 [89/250 11392/32000 (36%)] Loss: 3.18254 (QuantReg: 13.26338) QuantErr: 13.26338 batch_time=0.42980 
Train Epoch: 27 [100/250 12800/32000 (40%)] Loss: 3.79086 (QuantReg: 12.78404) QuantErr: 12.78404 batch_time=0.68127 
Train Epoch: 27 [111/250 14208/32000 (44%)] Loss: 3.31401 (QuantReg: 13.16407) QuantErr: 13.16407 batch_time=0.46109 
Train Epoch: 27 [122/250 15616/32000 (49%)] Loss: 3.71667 (QuantReg: 12.85084) QuantErr: 12.85084 batch_time=0.67725 
Train Epoch: 27 [133/250 17024/32000 (53%)] Loss: 4.27903 (QuantReg: 12.98888) QuantErr: 12.98888 batch_time=3.41657 
Train Epoch: 27 [144/250 18432/32000 (58%)] Loss: 3.46339 (QuantReg: 13.60416) QuantErr: 13.60416 batch_time=0.44599 
Train Epoch: 27 [155/250 19840/32000 (62%)] Loss: 4.63728 (QuantReg: 13.04959) QuantErr: 13.04959 batch_time=0.43929 
Train Epoch: 27 [166/250 21248/32000 (66%)] Loss: 4.30268 (QuantReg: 13.09651) QuantErr: 13.09651 batch_time=0.42671 
Train Epoch: 27 [177/250 22656/32000 (71%)] Loss: 3.95935 (QuantReg: 13.07762) QuantErr: 13.07762 batch_time=0.44322 
Train Epoch: 27 [188/250 24064/32000 (75%)] Loss: 3.08513 (QuantReg: 13.08343) QuantErr: 13.08343 batch_time=0.43834 
Train Epoch: 27 [199/250 25472/32000 (80%)] Loss: 3.23103 (QuantReg: 13.26619) QuantErr: 13.26619 batch_time=0.43949 
Train Epoch: 27 [210/250 26880/32000 (84%)] Loss: 4.23324 (QuantReg: 12.96101) QuantErr: 12.96101 batch_time=0.45342 
Train Epoch: 27 [221/250 28288/32000 (88%)] Loss: 2.82755 (QuantReg: 13.17256) QuantErr: 13.17256 batch_time=0.43344 
Train Epoch: 27 [232/250 29696/32000 (93%)] Loss: 3.20734 (QuantReg: 13.39532) QuantErr: 13.39532 batch_time=0.44318 
Train Epoch: 27 [243/250 31104/32000 (97%)] Loss: 3.38690 (QuantReg: 13.11495) QuantErr: 13.11495 batch_time=0.45284 
Train Epoch: 27 codebook_update_time=1.25883
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch27.pth ...
Done in 3.912s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch27.pth ...
Done in 7.769s
removing stale ckpt [epoch 26] [took 0.00s]
 epoch          : 27
 loss           : 3.5654548826217654
 quant_reg      : 13.156252601623535
 quant_err      : 13.156252601623535
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 6750
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.583501006036217
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.68506447639422
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.167002012072435
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.070659385411595
 MSRVTT_full_test/t2v_metrics/R1: 13.277591973244148
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 51.30434782608695
 MSRVTT_full_test/t2v_metrics/R50: 81.67224080267559
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.57224080267559
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.466418491945337
 MSRVTT_full_test/v2t_metrics/R1: 17.123745819397993
 MSRVTT_full_test/v2t_metrics/R5: 44.68227424749164
 MSRVTT_full_test/v2t_metrics/R10: 59.163879598662206
 MSRVTT_full_test/v2t_metrics/R50: 86.95652173913044
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.549498327759196
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.63938728592872
 mnt_best       : 29.466418491945337
 not_improved_count: 0
Train Epoch: 28 [1/250 128/32000 (0%)] Loss: 3.33049 (QuantReg: 12.89003) QuantErr: 12.89003 batch_time=34.84256 
Train Epoch: 28 [12/250 1536/32000 (5%)] Loss: 2.98229 (QuantReg: 13.07419) QuantErr: 13.07419 batch_time=6.03000 
Train Epoch: 28 [23/250 2944/32000 (9%)] Loss: 3.96941 (QuantReg: 12.95397) QuantErr: 12.95397 batch_time=0.42010 
Train Epoch: 28 [34/250 4352/32000 (14%)] Loss: 4.10777 (QuantReg: 13.10684) QuantErr: 13.10684 batch_time=0.42735 
Train Epoch: 28 [45/250 5760/32000 (18%)] Loss: 3.21406 (QuantReg: 13.15856) QuantErr: 13.15856 batch_time=0.46722 
Train Epoch: 28 [56/250 7168/32000 (22%)] Loss: 3.96377 (QuantReg: 13.11289) QuantErr: 13.11289 batch_time=0.42417 
Train Epoch: 28 [67/250 8576/32000 (27%)] Loss: 3.40099 (QuantReg: 13.09502) QuantErr: 13.09502 batch_time=0.42608 
Train Epoch: 28 [78/250 9984/32000 (31%)] Loss: 3.12909 (QuantReg: 13.23745) QuantErr: 13.23745 batch_time=0.44479 
Train Epoch: 28 [89/250 11392/32000 (36%)] Loss: 2.98233 (QuantReg: 13.40970) QuantErr: 13.40970 batch_time=0.44141 
Train Epoch: 28 [100/250 12800/32000 (40%)] Loss: 3.32032 (QuantReg: 12.90027) QuantErr: 12.90027 batch_time=0.46387 
Train Epoch: 28 [111/250 14208/32000 (44%)] Loss: 3.13706 (QuantReg: 13.09905) QuantErr: 13.09905 batch_time=0.47875 
Train Epoch: 28 [122/250 15616/32000 (49%)] Loss: 3.28370 (QuantReg: 13.25992) QuantErr: 13.25992 batch_time=0.41837 
Train Epoch: 28 [133/250 17024/32000 (53%)] Loss: 4.52494 (QuantReg: 12.95534) QuantErr: 12.95534 batch_time=0.42712 
Train Epoch: 28 [144/250 18432/32000 (58%)] Loss: 3.91184 (QuantReg: 13.04179) QuantErr: 13.04179 batch_time=0.44929 
Train Epoch: 28 [155/250 19840/32000 (62%)] Loss: 3.44431 (QuantReg: 12.98801) QuantErr: 12.98801 batch_time=0.41575 
Train Epoch: 28 [166/250 21248/32000 (66%)] Loss: 3.02484 (QuantReg: 13.23058) QuantErr: 13.23058 batch_time=0.45227 
Train Epoch: 28 [177/250 22656/32000 (71%)] Loss: 2.67900 (QuantReg: 13.33075) QuantErr: 13.33075 batch_time=0.43908 
Train Epoch: 28 [188/250 24064/32000 (75%)] Loss: 3.21659 (QuantReg: 12.96410) QuantErr: 12.96410 batch_time=0.53835 
Train Epoch: 28 [199/250 25472/32000 (80%)] Loss: 3.18728 (QuantReg: 13.20344) QuantErr: 13.20344 batch_time=0.42203 
Train Epoch: 28 [210/250 26880/32000 (84%)] Loss: 2.95658 (QuantReg: 13.24316) QuantErr: 13.24316 batch_time=0.43448 
Train Epoch: 28 [221/250 28288/32000 (88%)] Loss: 2.97166 (QuantReg: 13.35493) QuantErr: 13.35493 batch_time=0.43223 
Train Epoch: 28 [232/250 29696/32000 (93%)] Loss: 3.07913 (QuantReg: 13.26578) QuantErr: 13.26578 batch_time=0.42946 
Train Epoch: 28 [243/250 31104/32000 (97%)] Loss: 3.25650 (QuantReg: 13.46849) QuantErr: 13.46849 batch_time=0.43382 
Train Epoch: 28 codebook_update_time=1.08077
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch28.pth ...
Done in 14.530s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 3.548611804008484
 quant_reg      : 13.174574138641358
 quant_err      : 13.174574138641358
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.746478873239437
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.609722883066766
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.03420523138833
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.85796021798829
 MSRVTT_full_test/t2v_metrics/R1: 12.709030100334449
 MSRVTT_full_test/t2v_metrics/R5: 37.625418060200666
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.9
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.0316238524565
 MSRVTT_full_test/v2t_metrics/R1: 16.52173913043478
 MSRVTT_full_test/v2t_metrics/R5: 44.046822742474916
 MSRVTT_full_test/v2t_metrics/R10: 58.42809364548495
 MSRVTT_full_test/v2t_metrics/R50: 86.65551839464882
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.927759197324416
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.90310158738921
 mnt_best       : 29.466418491945337
 not_improved_count: 1
Train Epoch: 29 [1/250 128/32000 (0%)] Loss: 4.32915 (QuantReg: 13.01209) QuantErr: 13.01209 batch_time=33.08631 
Train Epoch: 29 [12/250 1536/32000 (5%)] Loss: 3.63466 (QuantReg: 13.44628) QuantErr: 13.44628 batch_time=0.43349 
Train Epoch: 29 [23/250 2944/32000 (9%)] Loss: 4.16825 (QuantReg: 13.45350) QuantErr: 13.45350 batch_time=0.46552 
Train Epoch: 29 [34/250 4352/32000 (14%)] Loss: 2.96092 (QuantReg: 13.10447) QuantErr: 13.10447 batch_time=0.45367 
Train Epoch: 29 [45/250 5760/32000 (18%)] Loss: 3.38895 (QuantReg: 13.33236) QuantErr: 13.33236 batch_time=0.44315 
Train Epoch: 29 [56/250 7168/32000 (22%)] Loss: 3.64056 (QuantReg: 13.12674) QuantErr: 13.12674 batch_time=0.47083 
Train Epoch: 29 [67/250 8576/32000 (27%)] Loss: 4.93642 (QuantReg: 13.06728) QuantErr: 13.06728 batch_time=0.88386 
Train Epoch: 29 [78/250 9984/32000 (31%)] Loss: 3.45823 (QuantReg: 13.37009) QuantErr: 13.37009 batch_time=0.44821 
Train Epoch: 29 [89/250 11392/32000 (36%)] Loss: 3.67570 (QuantReg: 13.19328) QuantErr: 13.19328 batch_time=0.43010 
Train Epoch: 29 [100/250 12800/32000 (40%)] Loss: 3.44279 (QuantReg: 13.13925) QuantErr: 13.13925 batch_time=0.79657 
Train Epoch: 29 [111/250 14208/32000 (44%)] Loss: 4.41843 (QuantReg: 12.96672) QuantErr: 12.96672 batch_time=0.45989 
Train Epoch: 29 [122/250 15616/32000 (49%)] Loss: 3.56289 (QuantReg: 13.31040) QuantErr: 13.31040 batch_time=0.46720 
Train Epoch: 29 [133/250 17024/32000 (53%)] Loss: 4.13638 (QuantReg: 12.83540) QuantErr: 12.83540 batch_time=1.46678 
Train Epoch: 29 [144/250 18432/32000 (58%)] Loss: 4.01433 (QuantReg: 13.21697) QuantErr: 13.21697 batch_time=0.46903 
Train Epoch: 29 [155/250 19840/32000 (62%)] Loss: 2.96030 (QuantReg: 13.40696) QuantErr: 13.40696 batch_time=0.42451 
Train Epoch: 29 [166/250 21248/32000 (66%)] Loss: 3.78687 (QuantReg: 12.94197) QuantErr: 12.94197 batch_time=1.89889 
Train Epoch: 29 [177/250 22656/32000 (71%)] Loss: 2.90865 (QuantReg: 13.03403) QuantErr: 13.03403 batch_time=0.43579 
Train Epoch: 29 [188/250 24064/32000 (75%)] Loss: 3.25779 (QuantReg: 13.01549) QuantErr: 13.01549 batch_time=0.45955 
Train Epoch: 29 [199/250 25472/32000 (80%)] Loss: 3.48529 (QuantReg: 13.46459) QuantErr: 13.46459 batch_time=0.44668 
Train Epoch: 29 [210/250 26880/32000 (84%)] Loss: 3.39380 (QuantReg: 13.27272) QuantErr: 13.27272 batch_time=0.44080 
Train Epoch: 29 [221/250 28288/32000 (88%)] Loss: 3.16551 (QuantReg: 13.08998) QuantErr: 13.08998 batch_time=0.43508 
Train Epoch: 29 [232/250 29696/32000 (93%)] Loss: 3.30692 (QuantReg: 12.83292) QuantErr: 12.83292 batch_time=0.44725 
Train Epoch: 29 [243/250 31104/32000 (97%)] Loss: 2.89772 (QuantReg: 13.50169) QuantErr: 13.50169 batch_time=0.49736 
Train Epoch: 29 codebook_update_time=1.16771
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch29.pth ...
Done in 4.364s
removing stale ckpt [epoch 28] [took 0.00s]
 epoch          : 29
 loss           : 3.4565337657928468
 quant_reg      : 13.188983600616455
 quant_err      : 13.188983600616455
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 7250
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.913480885311872
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.17235698542007
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.030181086519114
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.20699010129135
 MSRVTT_full_test/t2v_metrics/R1: 12.74247491638796
 MSRVTT_full_test/t2v_metrics/R5: 37.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 80.90301003344482
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.99264214046823
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.94239654935255
 MSRVTT_full_test/v2t_metrics/R1: 17.45819397993311
 MSRVTT_full_test/v2t_metrics/R5: 44.68227424749164
 MSRVTT_full_test/v2t_metrics/R10: 59.163879598662206
 MSRVTT_full_test/v2t_metrics/R50: 87.4247491638796
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.151170568561874
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.8699201333401
 mnt_best       : 29.466418491945337
 not_improved_count: 2
Train Epoch: 30 [1/250 128/32000 (0%)] Loss: 3.23174 (QuantReg: 13.26612) QuantErr: 13.26612 batch_time=35.97662 
Train Epoch: 30 [12/250 1536/32000 (5%)] Loss: 3.97084 (QuantReg: 13.14968) QuantErr: 13.14968 batch_time=0.45798 
Train Epoch: 30 [23/250 2944/32000 (9%)] Loss: 3.19788 (QuantReg: 13.25245) QuantErr: 13.25245 batch_time=0.43802 
Train Epoch: 30 [34/250 4352/32000 (14%)] Loss: 3.49943 (QuantReg: 13.12513) QuantErr: 13.12513 batch_time=0.43663 
Train Epoch: 30 [45/250 5760/32000 (18%)] Loss: 3.33613 (QuantReg: 13.32650) QuantErr: 13.32650 batch_time=0.48642 
Train Epoch: 30 [56/250 7168/32000 (22%)] Loss: 3.79541 (QuantReg: 13.01371) QuantErr: 13.01371 batch_time=0.44484 
Train Epoch: 30 [67/250 8576/32000 (27%)] Loss: 4.35492 (QuantReg: 12.98152) QuantErr: 12.98152 batch_time=0.45914 
Train Epoch: 30 [78/250 9984/32000 (31%)] Loss: 2.98069 (QuantReg: 13.13718) QuantErr: 13.13718 batch_time=0.47946 
Train Epoch: 30 [89/250 11392/32000 (36%)] Loss: 2.65364 (QuantReg: 13.27794) QuantErr: 13.27794 batch_time=0.44196 
Train Epoch: 30 [100/250 12800/32000 (40%)] Loss: 3.97549 (QuantReg: 13.25953) QuantErr: 13.25953 batch_time=0.59246 
Train Epoch: 30 [111/250 14208/32000 (44%)] Loss: 3.94652 (QuantReg: 13.03309) QuantErr: 13.03309 batch_time=0.44973 
Train Epoch: 30 [122/250 15616/32000 (49%)] Loss: 3.25506 (QuantReg: 13.01309) QuantErr: 13.01309 batch_time=0.44111 
Train Epoch: 30 [133/250 17024/32000 (53%)] Loss: 3.85499 (QuantReg: 13.14056) QuantErr: 13.14056 batch_time=0.44449 
Train Epoch: 30 [144/250 18432/32000 (58%)] Loss: 2.87729 (QuantReg: 12.98837) QuantErr: 12.98837 batch_time=0.79927 
Train Epoch: 30 [155/250 19840/32000 (62%)] Loss: 2.77449 (QuantReg: 13.01891) QuantErr: 13.01891 batch_time=0.42582 
Train Epoch: 30 [166/250 21248/32000 (66%)] Loss: 3.46408 (QuantReg: 13.29440) QuantErr: 13.29440 batch_time=0.46354 
Train Epoch: 30 [177/250 22656/32000 (71%)] Loss: 3.49262 (QuantReg: 13.18065) QuantErr: 13.18065 batch_time=0.52176 
Train Epoch: 30 [188/250 24064/32000 (75%)] Loss: 3.33343 (QuantReg: 13.19633) QuantErr: 13.19633 batch_time=0.44251 
Train Epoch: 30 [199/250 25472/32000 (80%)] Loss: 3.37395 (QuantReg: 13.24600) QuantErr: 13.24600 batch_time=0.66463 
Train Epoch: 30 [210/250 26880/32000 (84%)] Loss: 3.57011 (QuantReg: 13.14383) QuantErr: 13.14383 batch_time=0.69499 
Train Epoch: 30 [221/250 28288/32000 (88%)] Loss: 3.54890 (QuantReg: 13.36909) QuantErr: 13.36909 batch_time=0.44383 
Train Epoch: 30 [232/250 29696/32000 (93%)] Loss: 3.64340 (QuantReg: 13.25457) QuantErr: 13.25457 batch_time=1.44039 
Train Epoch: 30 [243/250 31104/32000 (97%)] Loss: 3.25929 (QuantReg: 13.24585) QuantErr: 13.24585 batch_time=0.43616 
Train Epoch: 30 codebook_update_time=1.36923
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch30.pth ...
Done in 9.698s
removing stale ckpt [epoch 29] [took 0.00s]
 epoch          : 30
 loss           : 3.4782048540115356
 quant_reg      : 13.179866291046142
 quant_err      : 13.179866291046142
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.770623742454728
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.0014742897356
 MSRVTT_full_val/v2t_metrics/R1: 38.028169014084504
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.889336016096579
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.34052631256489
 MSRVTT_full_test/t2v_metrics/R1: 12.842809364548495
 MSRVTT_full_test/t2v_metrics/R5: 38.09364548494983
 MSRVTT_full_test/t2v_metrics/R10: 50.936454849498325
 MSRVTT_full_test/t2v_metrics/R50: 81.07023411371237
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.275585284280936
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.208803179248797
 MSRVTT_full_test/v2t_metrics/R1: 17.391304347826086
 MSRVTT_full_test/v2t_metrics/R5: 44.180602006688964
 MSRVTT_full_test/v2t_metrics/R10: 59.03010033444816
 MSRVTT_full_test/v2t_metrics/R50: 86.92307692307692
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.53428093645485
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.66255343026817
 mnt_best       : 29.466418491945337
 not_improved_count: 3
Train Epoch: 31 [1/250 128/32000 (0%)] Loss: 3.19694 (QuantReg: 13.26691) QuantErr: 13.26691 batch_time=35.90457 
Train Epoch: 31 [12/250 1536/32000 (5%)] Loss: 2.86896 (QuantReg: 13.19409) QuantErr: 13.19409 batch_time=0.43633 
Train Epoch: 31 [23/250 2944/32000 (9%)] Loss: 3.49369 (QuantReg: 13.23777) QuantErr: 13.23777 batch_time=0.45034 
Train Epoch: 31 [34/250 4352/32000 (14%)] Loss: 2.69888 (QuantReg: 13.44549) QuantErr: 13.44549 batch_time=0.43757 
Train Epoch: 31 [45/250 5760/32000 (18%)] Loss: 3.25732 (QuantReg: 13.22191) QuantErr: 13.22191 batch_time=0.48514 
Train Epoch: 31 [56/250 7168/32000 (22%)] Loss: 3.25869 (QuantReg: 13.11003) QuantErr: 13.11003 batch_time=0.46899 
Train Epoch: 31 [67/250 8576/32000 (27%)] Loss: 4.41922 (QuantReg: 13.08971) QuantErr: 13.08971 batch_time=0.43821 
Train Epoch: 31 [78/250 9984/32000 (31%)] Loss: 2.93377 (QuantReg: 13.16778) QuantErr: 13.16778 batch_time=0.44111 
Train Epoch: 31 [89/250 11392/32000 (36%)] Loss: 3.85418 (QuantReg: 13.22410) QuantErr: 13.22410 batch_time=0.43916 
Train Epoch: 31 [100/250 12800/32000 (40%)] Loss: 3.27863 (QuantReg: 13.17822) QuantErr: 13.17822 batch_time=0.43251 
Train Epoch: 31 [111/250 14208/32000 (44%)] Loss: 3.92922 (QuantReg: 12.87549) QuantErr: 12.87549 batch_time=0.43917 
Train Epoch: 31 [122/250 15616/32000 (49%)] Loss: 3.11032 (QuantReg: 13.28780) QuantErr: 13.28780 batch_time=0.44170 
Train Epoch: 31 [133/250 17024/32000 (53%)] Loss: 3.42923 (QuantReg: 13.08388) QuantErr: 13.08388 batch_time=0.42520 
Train Epoch: 31 [144/250 18432/32000 (58%)] Loss: 2.99110 (QuantReg: 13.26882) QuantErr: 13.26882 batch_time=0.44472 
Train Epoch: 31 [155/250 19840/32000 (62%)] Loss: 3.92772 (QuantReg: 13.17966) QuantErr: 13.17966 batch_time=0.42699 
Train Epoch: 31 [166/250 21248/32000 (66%)] Loss: 3.89090 (QuantReg: 13.10451) QuantErr: 13.10451 batch_time=0.42037 
Train Epoch: 31 [177/250 22656/32000 (71%)] Loss: 3.26259 (QuantReg: 13.35973) QuantErr: 13.35973 batch_time=0.41981 
Train Epoch: 31 [188/250 24064/32000 (75%)] Loss: 2.12377 (QuantReg: 13.13248) QuantErr: 13.13248 batch_time=0.43607 
Train Epoch: 31 [199/250 25472/32000 (80%)] Loss: 3.28782 (QuantReg: 13.25849) QuantErr: 13.25849 batch_time=0.42172 
Train Epoch: 31 [210/250 26880/32000 (84%)] Loss: 3.27957 (QuantReg: 13.32750) QuantErr: 13.32750 batch_time=0.42091 
Train Epoch: 31 [221/250 28288/32000 (88%)] Loss: 4.43686 (QuantReg: 13.10177) QuantErr: 13.10177 batch_time=0.42620 
Train Epoch: 31 [232/250 29696/32000 (93%)] Loss: 3.07429 (QuantReg: 13.16161) QuantErr: 13.16161 batch_time=0.42735 
Train Epoch: 31 [243/250 31104/32000 (97%)] Loss: 3.34847 (QuantReg: 13.46216) QuantErr: 13.46216 batch_time=0.42162 
Train Epoch: 31 codebook_update_time=1.07742
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch31.pth ...
Done in 3.701s
removing stale ckpt [epoch 30] [took 0.00s]
 epoch          : 31
 loss           : 3.416430277824402
 quant_reg      : 13.190994171142577
 quant_err      : 13.190994171142577
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 7750
 MSRVTT_full_val/t2v_metrics/R1: 31.388329979879277
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 79.27565392354124
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.22334004024145
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.90607811272136
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 74.24547283702213
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.44466800804829
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.20463709769749
 MSRVTT_full_test/t2v_metrics/R1: 12.675585284280936
 MSRVTT_full_test/t2v_metrics/R5: 36.78929765886288
 MSRVTT_full_test/t2v_metrics/R10: 50.33444816053512
 MSRVTT_full_test/t2v_metrics/R50: 80.76923076923077
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.93913043478261
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.631995032069433
 MSRVTT_full_test/v2t_metrics/R1: 16.421404682274247
 MSRVTT_full_test/v2t_metrics/R5: 44.214046822742475
 MSRVTT_full_test/v2t_metrics/R10: 58.862876254180605
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.341638795986626
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.96262376122467
 mnt_best       : 29.466418491945337
 not_improved_count: 4
Train Epoch: 32 [1/250 128/32000 (0%)] Loss: 3.34840 (QuantReg: 12.74860) QuantErr: 12.74860 batch_time=30.61166 
Train Epoch: 32 [12/250 1536/32000 (5%)] Loss: 3.17814 (QuantReg: 13.25613) QuantErr: 13.25613 batch_time=0.42736 
Train Epoch: 32 [23/250 2944/32000 (9%)] Loss: 3.88299 (QuantReg: 13.14670) QuantErr: 13.14670 batch_time=0.44256 
Train Epoch: 32 [34/250 4352/32000 (14%)] Loss: 4.40618 (QuantReg: 13.06418) QuantErr: 13.06418 batch_time=0.43537 
Train Epoch: 32 [45/250 5760/32000 (18%)] Loss: 3.84951 (QuantReg: 12.73422) QuantErr: 12.73422 batch_time=0.42468 
Train Epoch: 32 [56/250 7168/32000 (22%)] Loss: 3.41612 (QuantReg: 13.35934) QuantErr: 13.35934 batch_time=0.42989 
Train Epoch: 32 [67/250 8576/32000 (27%)] Loss: 3.27470 (QuantReg: 13.13877) QuantErr: 13.13877 batch_time=0.44203 
Train Epoch: 32 [78/250 9984/32000 (31%)] Loss: 3.64130 (QuantReg: 13.28496) QuantErr: 13.28496 batch_time=0.47960 
Train Epoch: 32 [89/250 11392/32000 (36%)] Loss: 3.48253 (QuantReg: 13.17968) QuantErr: 13.17968 batch_time=0.45222 
Train Epoch: 32 [100/250 12800/32000 (40%)] Loss: 2.92240 (QuantReg: 13.08403) QuantErr: 13.08403 batch_time=0.45909 
Train Epoch: 32 [111/250 14208/32000 (44%)] Loss: 3.22459 (QuantReg: 13.37249) QuantErr: 13.37249 batch_time=0.44932 
Train Epoch: 32 [122/250 15616/32000 (49%)] Loss: 3.44944 (QuantReg: 13.09960) QuantErr: 13.09960 batch_time=0.45503 
Train Epoch: 32 [133/250 17024/32000 (53%)] Loss: 3.51882 (QuantReg: 13.08179) QuantErr: 13.08179 batch_time=0.44971 
Train Epoch: 32 [144/250 18432/32000 (58%)] Loss: 3.19717 (QuantReg: 13.18006) QuantErr: 13.18006 batch_time=0.46871 
Train Epoch: 32 [155/250 19840/32000 (62%)] Loss: 3.97179 (QuantReg: 12.97983) QuantErr: 12.97983 batch_time=0.43561 
Train Epoch: 32 [166/250 21248/32000 (66%)] Loss: 4.13724 (QuantReg: 13.41199) QuantErr: 13.41199 batch_time=0.45055 
Train Epoch: 32 [177/250 22656/32000 (71%)] Loss: 3.44860 (QuantReg: 13.35905) QuantErr: 13.35905 batch_time=0.43812 
Train Epoch: 32 [188/250 24064/32000 (75%)] Loss: 3.29606 (QuantReg: 13.18299) QuantErr: 13.18299 batch_time=0.44720 
Train Epoch: 32 [199/250 25472/32000 (80%)] Loss: 3.51561 (QuantReg: 13.49708) QuantErr: 13.49708 batch_time=0.46279 
Train Epoch: 32 [210/250 26880/32000 (84%)] Loss: 4.32999 (QuantReg: 13.00007) QuantErr: 13.00007 batch_time=1.55050 
Train Epoch: 32 [221/250 28288/32000 (88%)] Loss: 3.33724 (QuantReg: 13.27671) QuantErr: 13.27671 batch_time=0.42718 
Train Epoch: 32 [232/250 29696/32000 (93%)] Loss: 3.50107 (QuantReg: 12.78245) QuantErr: 12.78245 batch_time=0.43447 
Train Epoch: 32 [243/250 31104/32000 (97%)] Loss: 4.03891 (QuantReg: 12.97368) QuantErr: 12.97368 batch_time=0.46186 
Train Epoch: 32 codebook_update_time=1.10265
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch32.pth ...
Done in 3.729s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 3.3802705116271974
 quant_reg      : 13.220984745025635
 quant_err      : 13.220984745025635
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.732394366197183
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.94320161836788
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 73.8430583501006
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.181086519114688
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.72714589422599
 MSRVTT_full_test/t2v_metrics/R1: 12.976588628762542
 MSRVTT_full_test/t2v_metrics/R5: 37.19063545150502
 MSRVTT_full_test/t2v_metrics/R10: 50.33444816053512
 MSRVTT_full_test/t2v_metrics/R50: 80.93645484949833
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.16053511705686
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.96141760617511
 MSRVTT_full_test/v2t_metrics/R1: 16.321070234113712
 MSRVTT_full_test/v2t_metrics/R5: 44.81605351170568
 MSRVTT_full_test/v2t_metrics/R10: 58.79598662207358
 MSRVTT_full_test/v2t_metrics/R50: 87.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.5752508361204
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.03563355981744
 mnt_best       : 29.466418491945337
 not_improved_count: 5
Train Epoch: 33 [1/250 128/32000 (0%)] Loss: 2.87611 (QuantReg: 13.15407) QuantErr: 13.15407 batch_time=35.54129 
Train Epoch: 33 [12/250 1536/32000 (5%)] Loss: 3.05262 (QuantReg: 13.13367) QuantErr: 13.13367 batch_time=0.44994 
Train Epoch: 33 [23/250 2944/32000 (9%)] Loss: 2.46791 (QuantReg: 13.05673) QuantErr: 13.05673 batch_time=0.46347 
Train Epoch: 33 [34/250 4352/32000 (14%)] Loss: 2.71584 (QuantReg: 13.10826) QuantErr: 13.10826 batch_time=0.42125 
Train Epoch: 33 [45/250 5760/32000 (18%)] Loss: 2.50839 (QuantReg: 13.30772) QuantErr: 13.30772 batch_time=0.42589 
Train Epoch: 33 [56/250 7168/32000 (22%)] Loss: 3.40069 (QuantReg: 13.08852) QuantErr: 13.08852 batch_time=0.42723 
Train Epoch: 33 [67/250 8576/32000 (27%)] Loss: 2.69578 (QuantReg: 13.14337) QuantErr: 13.14337 batch_time=0.44551 
Train Epoch: 33 [78/250 9984/32000 (31%)] Loss: 3.01407 (QuantReg: 13.16865) QuantErr: 13.16865 batch_time=0.45224 
Train Epoch: 33 [89/250 11392/32000 (36%)] Loss: 3.87757 (QuantReg: 13.42414) QuantErr: 13.42414 batch_time=0.62964 
Train Epoch: 33 [100/250 12800/32000 (40%)] Loss: 3.03910 (QuantReg: 13.38264) QuantErr: 13.38264 batch_time=0.43663 
Train Epoch: 33 [111/250 14208/32000 (44%)] Loss: 3.46903 (QuantReg: 13.15070) QuantErr: 13.15070 batch_time=0.44516 
Train Epoch: 33 [122/250 15616/32000 (49%)] Loss: 2.96777 (QuantReg: 13.19836) QuantErr: 13.19836 batch_time=0.43635 
Train Epoch: 33 [133/250 17024/32000 (53%)] Loss: 4.03931 (QuantReg: 13.00497) QuantErr: 13.00497 batch_time=0.43254 
Train Epoch: 33 [144/250 18432/32000 (58%)] Loss: 3.40817 (QuantReg: 13.33131) QuantErr: 13.33131 batch_time=1.14048 
Train Epoch: 33 [155/250 19840/32000 (62%)] Loss: 3.36294 (QuantReg: 13.28495) QuantErr: 13.28495 batch_time=0.44208 
Train Epoch: 33 [166/250 21248/32000 (66%)] Loss: 3.24167 (QuantReg: 13.20292) QuantErr: 13.20292 batch_time=1.03996 
Train Epoch: 33 [177/250 22656/32000 (71%)] Loss: 2.82937 (QuantReg: 13.36686) QuantErr: 13.36686 batch_time=0.43369 
Train Epoch: 33 [188/250 24064/32000 (75%)] Loss: 3.15994 (QuantReg: 12.98478) QuantErr: 12.98478 batch_time=0.45249 
Train Epoch: 33 [199/250 25472/32000 (80%)] Loss: 3.47083 (QuantReg: 13.14076) QuantErr: 13.14076 batch_time=0.45953 
Train Epoch: 33 [210/250 26880/32000 (84%)] Loss: 3.89330 (QuantReg: 13.11071) QuantErr: 13.11071 batch_time=3.49495 
Train Epoch: 33 [221/250 28288/32000 (88%)] Loss: 3.12644 (QuantReg: 13.47002) QuantErr: 13.47002 batch_time=0.43393 
Train Epoch: 33 [232/250 29696/32000 (93%)] Loss: 2.80318 (QuantReg: 13.15378) QuantErr: 13.15378 batch_time=0.86781 
Train Epoch: 33 [243/250 31104/32000 (97%)] Loss: 3.31888 (QuantReg: 13.07500) QuantErr: 13.07500 batch_time=0.44052 
Train Epoch: 33 codebook_update_time=1.23250
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch33.pth ...
Done in 3.964s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch33.pth ...
Done in 7.673s
removing stale ckpt [epoch 32] [took 0.00s]
 epoch          : 33
 loss           : 3.3476801338195803
 quant_reg      : 13.237511390686036
 quant_err      : 13.237511390686036
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 8250
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.032193158953723
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.014213034801
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.225352112676056
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.31504755475587
 MSRVTT_full_test/t2v_metrics/R1: 13.74581939799331
 MSRVTT_full_test/t2v_metrics/R5: 38.32775919732441
 MSRVTT_full_test/t2v_metrics/R10: 51.63879598662207
 MSRVTT_full_test/t2v_metrics/R50: 82.0066889632107
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.167892976588625
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.075998662804793
 MSRVTT_full_test/v2t_metrics/R1: 17.123745819397993
 MSRVTT_full_test/v2t_metrics/R5: 44.013377926421406
 MSRVTT_full_test/v2t_metrics/R10: 58.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.993311036789297
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.407115451992375
 mnt_best       : 30.075998662804793
 not_improved_count: 0
Train Epoch: 34 [1/250 128/32000 (0%)] Loss: 3.93348 (QuantReg: 13.29332) QuantErr: 13.29332 batch_time=34.38484 
Train Epoch: 34 [12/250 1536/32000 (5%)] Loss: 3.50509 (QuantReg: 13.09278) QuantErr: 13.09278 batch_time=0.41870 
Train Epoch: 34 [23/250 2944/32000 (9%)] Loss: 4.03479 (QuantReg: 12.98742) QuantErr: 12.98742 batch_time=0.42436 
Train Epoch: 34 [34/250 4352/32000 (14%)] Loss: 3.07436 (QuantReg: 13.26585) QuantErr: 13.26585 batch_time=0.45234 
Train Epoch: 34 [45/250 5760/32000 (18%)] Loss: 3.69228 (QuantReg: 13.17488) QuantErr: 13.17488 batch_time=0.68124 
Train Epoch: 34 [56/250 7168/32000 (22%)] Loss: 2.60790 (QuantReg: 13.61093) QuantErr: 13.61093 batch_time=0.51465 
Train Epoch: 34 [67/250 8576/32000 (27%)] Loss: 3.46194 (QuantReg: 13.02624) QuantErr: 13.02624 batch_time=0.44377 
Train Epoch: 34 [78/250 9984/32000 (31%)] Loss: 3.65354 (QuantReg: 13.33224) QuantErr: 13.33224 batch_time=0.43826 
Train Epoch: 34 [89/250 11392/32000 (36%)] Loss: 3.13076 (QuantReg: 13.00207) QuantErr: 13.00207 batch_time=0.45862 
Train Epoch: 34 [100/250 12800/32000 (40%)] Loss: 3.08282 (QuantReg: 13.36494) QuantErr: 13.36494 batch_time=0.42978 
Train Epoch: 34 [111/250 14208/32000 (44%)] Loss: 2.80623 (QuantReg: 13.48115) QuantErr: 13.48115 batch_time=0.42860 
Train Epoch: 34 [122/250 15616/32000 (49%)] Loss: 3.87199 (QuantReg: 13.51769) QuantErr: 13.51769 batch_time=0.48202 
Train Epoch: 34 [133/250 17024/32000 (53%)] Loss: 3.77795 (QuantReg: 13.28030) QuantErr: 13.28030 batch_time=0.43917 
Train Epoch: 34 [144/250 18432/32000 (58%)] Loss: 3.57174 (QuantReg: 13.26532) QuantErr: 13.26532 batch_time=0.41994 
Train Epoch: 34 [155/250 19840/32000 (62%)] Loss: 3.49261 (QuantReg: 13.00013) QuantErr: 13.00013 batch_time=0.42689 
Train Epoch: 34 [166/250 21248/32000 (66%)] Loss: 3.36697 (QuantReg: 13.43306) QuantErr: 13.43306 batch_time=0.43491 
Train Epoch: 34 [177/250 22656/32000 (71%)] Loss: 3.31285 (QuantReg: 13.19126) QuantErr: 13.19126 batch_time=0.48066 
Train Epoch: 34 [188/250 24064/32000 (75%)] Loss: 3.24251 (QuantReg: 13.48485) QuantErr: 13.48485 batch_time=0.43482 
Train Epoch: 34 [199/250 25472/32000 (80%)] Loss: 3.27552 (QuantReg: 13.57012) QuantErr: 13.57012 batch_time=0.44860 
Train Epoch: 34 [210/250 26880/32000 (84%)] Loss: 3.31701 (QuantReg: 12.99877) QuantErr: 12.99877 batch_time=0.42989 
Train Epoch: 34 [221/250 28288/32000 (88%)] Loss: 3.04428 (QuantReg: 13.53736) QuantErr: 13.53736 batch_time=0.44209 
Train Epoch: 34 [232/250 29696/32000 (93%)] Loss: 2.91175 (QuantReg: 13.29141) QuantErr: 13.29141 batch_time=0.45562 
Train Epoch: 34 [243/250 31104/32000 (97%)] Loss: 2.84921 (QuantReg: 13.18850) QuantErr: 13.18850 batch_time=0.42005 
Train Epoch: 34 codebook_update_time=1.02298
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch34.pth ...
Done in 6.772s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch34.pth ...
Done in 10.589s
removing stale ckpt [epoch 33] [took 0.00s]
 epoch          : 34
 loss           : 3.3141727676391604
 quant_reg      : 13.251288761138916
 quant_err      : 13.251288761138916
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.5875251509054324
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.94093184559972
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.366197183098592
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.76732963842263
 MSRVTT_full_test/t2v_metrics/R1: 14.013377926421406
 MSRVTT_full_test/t2v_metrics/R5: 38.52842809364549
 MSRVTT_full_test/t2v_metrics/R10: 52.709030100334445
 MSRVTT_full_test/t2v_metrics/R50: 81.40468227424749
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.70802675585284
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.530673399144213
 MSRVTT_full_test/v2t_metrics/R1: 17.558528428093645
 MSRVTT_full_test/v2t_metrics/R5: 45.819397993311036
 MSRVTT_full_test/v2t_metrics/R10: 59.264214046822744
 MSRVTT_full_test/v2t_metrics/R50: 87.05685618729098
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.36321070234114
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.261297592257954
 mnt_best       : 30.530673399144213
 not_improved_count: 0
Train Epoch: 35 [1/250 128/32000 (0%)] Loss: 3.40153 (QuantReg: 13.01442) QuantErr: 13.01442 batch_time=35.52431 
Train Epoch: 35 [12/250 1536/32000 (5%)] Loss: 3.55533 (QuantReg: 12.78529) QuantErr: 12.78529 batch_time=0.44511 
Train Epoch: 35 [23/250 2944/32000 (9%)] Loss: 3.26979 (QuantReg: 13.39061) QuantErr: 13.39061 batch_time=0.46133 
Train Epoch: 35 [34/250 4352/32000 (14%)] Loss: 2.98942 (QuantReg: 13.23688) QuantErr: 13.23688 batch_time=0.43724 
Train Epoch: 35 [45/250 5760/32000 (18%)] Loss: 3.01213 (QuantReg: 13.21062) QuantErr: 13.21062 batch_time=0.43552 
Train Epoch: 35 [56/250 7168/32000 (22%)] Loss: 3.13974 (QuantReg: 13.11152) QuantErr: 13.11152 batch_time=0.42618 
Train Epoch: 35 [67/250 8576/32000 (27%)] Loss: 2.95368 (QuantReg: 13.17395) QuantErr: 13.17395 batch_time=0.66035 
Train Epoch: 35 [78/250 9984/32000 (31%)] Loss: 3.87332 (QuantReg: 13.37761) QuantErr: 13.37761 batch_time=0.42696 
Train Epoch: 35 [89/250 11392/32000 (36%)] Loss: 2.88542 (QuantReg: 13.28407) QuantErr: 13.28407 batch_time=0.44097 
Train Epoch: 35 [100/250 12800/32000 (40%)] Loss: 4.25219 (QuantReg: 13.13689) QuantErr: 13.13689 batch_time=0.43047 
Train Epoch: 35 [111/250 14208/32000 (44%)] Loss: 2.39537 (QuantReg: 13.38553) QuantErr: 13.38553 batch_time=0.44960 
Train Epoch: 35 [122/250 15616/32000 (49%)] Loss: 3.60428 (QuantReg: 13.18263) QuantErr: 13.18263 batch_time=0.41433 
Train Epoch: 35 [133/250 17024/32000 (53%)] Loss: 3.41374 (QuantReg: 13.11786) QuantErr: 13.11786 batch_time=0.44335 
Train Epoch: 35 [144/250 18432/32000 (58%)] Loss: 3.48269 (QuantReg: 13.29932) QuantErr: 13.29932 batch_time=0.46549 
Train Epoch: 35 [155/250 19840/32000 (62%)] Loss: 4.31036 (QuantReg: 13.31467) QuantErr: 13.31467 batch_time=0.46975 
Train Epoch: 35 [166/250 21248/32000 (66%)] Loss: 3.33722 (QuantReg: 13.02870) QuantErr: 13.02870 batch_time=0.47361 
Train Epoch: 35 [177/250 22656/32000 (71%)] Loss: 3.13481 (QuantReg: 13.33026) QuantErr: 13.33026 batch_time=0.43732 
Train Epoch: 35 [188/250 24064/32000 (75%)] Loss: 3.25082 (QuantReg: 13.36212) QuantErr: 13.36212 batch_time=0.46085 
Train Epoch: 35 [199/250 25472/32000 (80%)] Loss: 3.75713 (QuantReg: 12.85759) QuantErr: 12.85759 batch_time=0.46738 
Train Epoch: 35 [210/250 26880/32000 (84%)] Loss: 2.53615 (QuantReg: 13.42341) QuantErr: 13.42341 batch_time=2.93377 
Train Epoch: 35 [221/250 28288/32000 (88%)] Loss: 3.11924 (QuantReg: 13.41741) QuantErr: 13.41741 batch_time=0.41764 
Train Epoch: 35 [232/250 29696/32000 (93%)] Loss: 4.06787 (QuantReg: 13.31617) QuantErr: 13.31617 batch_time=0.43626 
Train Epoch: 35 [243/250 31104/32000 (97%)] Loss: 3.93451 (QuantReg: 13.67980) QuantErr: 13.67980 batch_time=0.44835 
Train Epoch: 35 codebook_update_time=0.95700
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch35.pth ...
Done in 3.857s
removing stale ckpt [epoch 34] [took 0.00s]
 epoch          : 35
 loss           : 3.2982676677703857
 quant_reg      : 13.29597695159912
 quant_err      : 13.29597695159912
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 8750
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.712273641851106
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.95886214130069
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.7283702213279675
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.88906874073019
 MSRVTT_full_test/t2v_metrics/R1: 13.377926421404682
 MSRVTT_full_test/t2v_metrics/R5: 37.92642140468227
 MSRVTT_full_test/t2v_metrics/R10: 51.23745819397993
 MSRVTT_full_test/t2v_metrics/R50: 80.73578595317726
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.63193979933111
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.623707806819006
 MSRVTT_full_test/v2t_metrics/R1: 17.224080267558527
 MSRVTT_full_test/v2t_metrics/R5: 44.88294314381271
 MSRVTT_full_test/v2t_metrics/R10: 58.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 86.42140468227424
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.42876254180602
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.70824549989397
 mnt_best       : 30.530673399144213
 not_improved_count: 1
Train Epoch: 36 [1/250 128/32000 (0%)] Loss: 3.28799 (QuantReg: 13.20829) QuantErr: 13.20829 batch_time=31.50381 
Train Epoch: 36 [12/250 1536/32000 (5%)] Loss: 3.03948 (QuantReg: 13.14301) QuantErr: 13.14301 batch_time=0.43028 
Train Epoch: 36 [23/250 2944/32000 (9%)] Loss: 3.39498 (QuantReg: 13.36439) QuantErr: 13.36439 batch_time=0.44201 
Train Epoch: 36 [34/250 4352/32000 (14%)] Loss: 3.92367 (QuantReg: 13.06036) QuantErr: 13.06036 batch_time=1.02161 
Train Epoch: 36 [45/250 5760/32000 (18%)] Loss: 3.67846 (QuantReg: 13.28245) QuantErr: 13.28245 batch_time=0.76404 
Train Epoch: 36 [56/250 7168/32000 (22%)] Loss: 3.84669 (QuantReg: 13.36744) QuantErr: 13.36744 batch_time=0.41986 
Train Epoch: 36 [67/250 8576/32000 (27%)] Loss: 3.93076 (QuantReg: 13.19626) QuantErr: 13.19626 batch_time=2.53003 
Train Epoch: 36 [78/250 9984/32000 (31%)] Loss: 3.31439 (QuantReg: 13.34398) QuantErr: 13.34398 batch_time=0.43730 
Train Epoch: 36 [89/250 11392/32000 (36%)] Loss: 3.33910 (QuantReg: 13.01029) QuantErr: 13.01029 batch_time=0.42829 
Train Epoch: 36 [100/250 12800/32000 (40%)] Loss: 2.85017 (QuantReg: 13.30398) QuantErr: 13.30398 batch_time=0.44546 
Train Epoch: 36 [111/250 14208/32000 (44%)] Loss: 2.96218 (QuantReg: 13.44214) QuantErr: 13.44214 batch_time=0.44404 
Train Epoch: 36 [122/250 15616/32000 (49%)] Loss: 2.98803 (QuantReg: 13.14621) QuantErr: 13.14621 batch_time=0.42622 
Train Epoch: 36 [133/250 17024/32000 (53%)] Loss: 3.40734 (QuantReg: 13.39761) QuantErr: 13.39761 batch_time=0.43888 
Train Epoch: 36 [144/250 18432/32000 (58%)] Loss: 2.71723 (QuantReg: 13.22668) QuantErr: 13.22668 batch_time=0.44399 
Train Epoch: 36 [155/250 19840/32000 (62%)] Loss: 3.35903 (QuantReg: 13.38419) QuantErr: 13.38419 batch_time=0.47276 
Train Epoch: 36 [166/250 21248/32000 (66%)] Loss: 3.80127 (QuantReg: 13.55009) QuantErr: 13.55009 batch_time=0.48781 
Train Epoch: 36 [177/250 22656/32000 (71%)] Loss: 3.89924 (QuantReg: 13.68303) QuantErr: 13.68303 batch_time=0.42533 
Train Epoch: 36 [188/250 24064/32000 (75%)] Loss: 3.45082 (QuantReg: 13.30441) QuantErr: 13.30441 batch_time=0.67794 
Train Epoch: 36 [199/250 25472/32000 (80%)] Loss: 3.45233 (QuantReg: 13.26914) QuantErr: 13.26914 batch_time=0.44054 
Train Epoch: 36 [210/250 26880/32000 (84%)] Loss: 3.12777 (QuantReg: 13.35423) QuantErr: 13.35423 batch_time=0.42497 
Train Epoch: 36 [221/250 28288/32000 (88%)] Loss: 2.99876 (QuantReg: 13.18563) QuantErr: 13.18563 batch_time=0.78640 
Train Epoch: 36 [232/250 29696/32000 (93%)] Loss: 3.86354 (QuantReg: 13.08587) QuantErr: 13.08587 batch_time=0.42953 
Train Epoch: 36 [243/250 31104/32000 (97%)] Loss: 2.51772 (QuantReg: 13.42891) QuantErr: 13.42891 batch_time=0.43995 
Train Epoch: 36 codebook_update_time=0.97055
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch36.pth ...
Done in 16.663s
removing stale ckpt [epoch 35] [took 0.00s]
 epoch          : 36
 loss           : 3.2767202882766724
 quant_reg      : 13.292099075317383
 quant_err      : 13.292099075317383
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 68.41046277665995
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.016096579476862
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.45276988755613
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.509054325955734
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.85792522522844
 MSRVTT_full_test/t2v_metrics/R1: 13.511705685618729
 MSRVTT_full_test/t2v_metrics/R5: 38.49498327759197
 MSRVTT_full_test/t2v_metrics/R10: 51.23745819397993
 MSRVTT_full_test/t2v_metrics/R50: 81.37123745819397
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.755183946488295
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.86991336826014
 MSRVTT_full_test/v2t_metrics/R1: 17.25752508361204
 MSRVTT_full_test/v2t_metrics/R5: 46.2876254180602
 MSRVTT_full_test/v2t_metrics/R10: 59.86622073578595
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 6.5
 MSRVTT_full_test/v2t_metrics/MeanR: 31.663210702341136
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.2973639351675
 mnt_best       : 30.530673399144213
 not_improved_count: 2
Train Epoch: 37 [1/250 128/32000 (0%)] Loss: 3.40123 (QuantReg: 13.15403) QuantErr: 13.15403 batch_time=37.12147 
Train Epoch: 37 [12/250 1536/32000 (5%)] Loss: 2.68820 (QuantReg: 13.58303) QuantErr: 13.58303 batch_time=0.49531 
Train Epoch: 37 [23/250 2944/32000 (9%)] Loss: 3.68066 (QuantReg: 13.52367) QuantErr: 13.52367 batch_time=0.42170 
Train Epoch: 37 [34/250 4352/32000 (14%)] Loss: 3.56580 (QuantReg: 13.05725) QuantErr: 13.05725 batch_time=0.42018 
Train Epoch: 37 [45/250 5760/32000 (18%)] Loss: 3.22258 (QuantReg: 13.50968) QuantErr: 13.50968 batch_time=0.43030 
Train Epoch: 37 [56/250 7168/32000 (22%)] Loss: 3.49366 (QuantReg: 13.29889) QuantErr: 13.29889 batch_time=0.43917 
Train Epoch: 37 [67/250 8576/32000 (27%)] Loss: 2.40264 (QuantReg: 13.44371) QuantErr: 13.44371 batch_time=0.44465 
Train Epoch: 37 [78/250 9984/32000 (31%)] Loss: 3.18656 (QuantReg: 13.13801) QuantErr: 13.13801 batch_time=0.44458 
Train Epoch: 37 [89/250 11392/32000 (36%)] Loss: 3.98259 (QuantReg: 13.13712) QuantErr: 13.13712 batch_time=0.42744 
Train Epoch: 37 [100/250 12800/32000 (40%)] Loss: 3.11904 (QuantReg: 13.16346) QuantErr: 13.16346 batch_time=0.42564 
Train Epoch: 37 [111/250 14208/32000 (44%)] Loss: 2.26920 (QuantReg: 13.52824) QuantErr: 13.52824 batch_time=0.42714 
Train Epoch: 37 [122/250 15616/32000 (49%)] Loss: 2.88826 (QuantReg: 13.10120) QuantErr: 13.10120 batch_time=0.42297 
Train Epoch: 37 [133/250 17024/32000 (53%)] Loss: 2.99720 (QuantReg: 13.08404) QuantErr: 13.08404 batch_time=0.44161 
Train Epoch: 37 [144/250 18432/32000 (58%)] Loss: 3.75806 (QuantReg: 13.49416) QuantErr: 13.49416 batch_time=0.43090 
Train Epoch: 37 [155/250 19840/32000 (62%)] Loss: 3.45853 (QuantReg: 13.43557) QuantErr: 13.43557 batch_time=0.42466 
Train Epoch: 37 [166/250 21248/32000 (66%)] Loss: 3.55893 (QuantReg: 13.29665) QuantErr: 13.29665 batch_time=0.46754 
Train Epoch: 37 [177/250 22656/32000 (71%)] Loss: 3.60624 (QuantReg: 13.17632) QuantErr: 13.17632 batch_time=0.42312 
Train Epoch: 37 [188/250 24064/32000 (75%)] Loss: 2.97242 (QuantReg: 13.20863) QuantErr: 13.20863 batch_time=0.42790 
Train Epoch: 37 [199/250 25472/32000 (80%)] Loss: 3.38931 (QuantReg: 13.65886) QuantErr: 13.65886 batch_time=0.44427 
Train Epoch: 37 [210/250 26880/32000 (84%)] Loss: 4.04778 (QuantReg: 13.63572) QuantErr: 13.63572 batch_time=5.35462 
Train Epoch: 37 [221/250 28288/32000 (88%)] Loss: 3.13257 (QuantReg: 13.32031) QuantErr: 13.32031 batch_time=0.42745 
Train Epoch: 37 [232/250 29696/32000 (93%)] Loss: 3.42051 (QuantReg: 13.07075) QuantErr: 13.07075 batch_time=0.43201 
Train Epoch: 37 [243/250 31104/32000 (97%)] Loss: 3.70472 (QuantReg: 13.20535) QuantErr: 13.20535 batch_time=0.45345 
Train Epoch: 37 codebook_update_time=1.02157
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch37.pth ...
Done in 15.335s
removing stale ckpt [epoch 36] [took 0.00s]
 epoch          : 37
 loss           : 3.30856431388855
 quant_reg      : 13.26890842819214
 quant_err      : 13.26890842819214
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 9250
 MSRVTT_full_val/t2v_metrics/R1: 33.199195171026155
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.420523138832998
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.575326977912496
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.668008048289739
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.994096135874265
 MSRVTT_full_test/t2v_metrics/R1: 13.377926421404682
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 51.137123745819395
 MSRVTT_full_test/t2v_metrics/R50: 80.46822742474916
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.95016722408027
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.508324860469024
 MSRVTT_full_test/v2t_metrics/R1: 17.123745819397993
 MSRVTT_full_test/v2t_metrics/R5: 44.61538461538461
 MSRVTT_full_test/v2t_metrics/R10: 58.99665551839465
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.30735785953178
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.588001657740435
 mnt_best       : 30.530673399144213
 not_improved_count: 3
Train Epoch: 38 [1/250 128/32000 (0%)] Loss: 3.44658 (QuantReg: 13.34966) QuantErr: 13.34966 batch_time=43.33977 
Train Epoch: 38 [12/250 1536/32000 (5%)] Loss: 4.28802 (QuantReg: 13.24361) QuantErr: 13.24361 batch_time=0.50029 
Train Epoch: 38 [23/250 2944/32000 (9%)] Loss: 3.22249 (QuantReg: 13.37098) QuantErr: 13.37098 batch_time=0.45849 
Train Epoch: 38 [34/250 4352/32000 (14%)] Loss: 3.58224 (QuantReg: 13.15538) QuantErr: 13.15538 batch_time=0.45728 
Train Epoch: 38 [45/250 5760/32000 (18%)] Loss: 2.86906 (QuantReg: 13.42469) QuantErr: 13.42469 batch_time=0.46022 
Train Epoch: 38 [56/250 7168/32000 (22%)] Loss: 3.23773 (QuantReg: 13.04230) QuantErr: 13.04230 batch_time=0.43949 
Train Epoch: 38 [67/250 8576/32000 (27%)] Loss: 3.27517 (QuantReg: 13.26050) QuantErr: 13.26050 batch_time=0.47212 
Train Epoch: 38 [78/250 9984/32000 (31%)] Loss: 3.33423 (QuantReg: 13.31348) QuantErr: 13.31348 batch_time=0.43933 
Train Epoch: 38 [89/250 11392/32000 (36%)] Loss: 2.73734 (QuantReg: 13.23927) QuantErr: 13.23927 batch_time=0.48155 
Train Epoch: 38 [100/250 12800/32000 (40%)] Loss: 3.39671 (QuantReg: 13.01174) QuantErr: 13.01174 batch_time=0.44555 
Train Epoch: 38 [111/250 14208/32000 (44%)] Loss: 2.54849 (QuantReg: 13.28365) QuantErr: 13.28365 batch_time=0.44352 
Train Epoch: 38 [122/250 15616/32000 (49%)] Loss: 4.00322 (QuantReg: 13.32762) QuantErr: 13.32762 batch_time=0.43694 
Train Epoch: 38 [133/250 17024/32000 (53%)] Loss: 3.34040 (QuantReg: 13.16704) QuantErr: 13.16704 batch_time=0.41797 
Train Epoch: 38 [144/250 18432/32000 (58%)] Loss: 3.84426 (QuantReg: 13.18176) QuantErr: 13.18176 batch_time=0.45651 
Train Epoch: 38 [155/250 19840/32000 (62%)] Loss: 3.79217 (QuantReg: 12.93251) QuantErr: 12.93251 batch_time=0.42070 
Train Epoch: 38 [166/250 21248/32000 (66%)] Loss: 2.45803 (QuantReg: 13.17112) QuantErr: 13.17112 batch_time=0.45887 
Train Epoch: 38 [177/250 22656/32000 (71%)] Loss: 2.90994 (QuantReg: 13.74075) QuantErr: 13.74075 batch_time=0.44702 
Train Epoch: 38 [188/250 24064/32000 (75%)] Loss: 4.21914 (QuantReg: 13.18637) QuantErr: 13.18637 batch_time=0.46146 
Train Epoch: 38 [199/250 25472/32000 (80%)] Loss: 2.64779 (QuantReg: 13.45490) QuantErr: 13.45490 batch_time=0.43671 
Train Epoch: 38 [210/250 26880/32000 (84%)] Loss: 4.15189 (QuantReg: 13.23532) QuantErr: 13.23532 batch_time=0.47577 
Train Epoch: 38 [221/250 28288/32000 (88%)] Loss: 2.03662 (QuantReg: 13.37478) QuantErr: 13.37478 batch_time=0.45766 
Train Epoch: 38 [232/250 29696/32000 (93%)] Loss: 3.52693 (QuantReg: 13.22591) QuantErr: 13.22591 batch_time=0.47078 
Train Epoch: 38 [243/250 31104/32000 (97%)] Loss: 2.70162 (QuantReg: 13.36065) QuantErr: 13.36065 batch_time=0.44972 
Train Epoch: 38 codebook_update_time=0.98402
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch38.pth ...
Done in 13.414s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 3.211275559425354
 quant_reg      : 13.292378810882568
 quant_err      : 13.292378810882568
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.13682092555332
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.28411488853313
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.571428571428571
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.76570362862672
 MSRVTT_full_test/t2v_metrics/R1: 13.779264214046822
 MSRVTT_full_test/t2v_metrics/R5: 37.19063545150502
 MSRVTT_full_test/t2v_metrics/R10: 50.30100334448161
 MSRVTT_full_test/t2v_metrics/R50: 80.90301003344482
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.47591973244147
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.54010886662334
 MSRVTT_full_test/v2t_metrics/R1: 17.05685618729097
 MSRVTT_full_test/v2t_metrics/R5: 45.35117056856188
 MSRVTT_full_test/v2t_metrics/R10: 59.56521739130435
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.048494983277592
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.85035055713362
 mnt_best       : 30.530673399144213
 not_improved_count: 4
Train Epoch: 39 [1/250 128/32000 (0%)] Loss: 3.25725 (QuantReg: 13.23538) QuantErr: 13.23538 batch_time=32.50027 
Train Epoch: 39 [12/250 1536/32000 (5%)] Loss: 2.89545 (QuantReg: 13.57432) QuantErr: 13.57432 batch_time=3.96743 
Train Epoch: 39 [23/250 2944/32000 (9%)] Loss: 2.73752 (QuantReg: 13.30720) QuantErr: 13.30720 batch_time=0.45001 
Train Epoch: 39 [34/250 4352/32000 (14%)] Loss: 2.90501 (QuantReg: 13.74870) QuantErr: 13.74870 batch_time=0.41926 
Train Epoch: 39 [45/250 5760/32000 (18%)] Loss: 3.38211 (QuantReg: 13.58448) QuantErr: 13.58448 batch_time=0.44096 
Train Epoch: 39 [56/250 7168/32000 (22%)] Loss: 2.42142 (QuantReg: 13.30840) QuantErr: 13.30840 batch_time=0.44303 
Train Epoch: 39 [67/250 8576/32000 (27%)] Loss: 2.54914 (QuantReg: 13.63741) QuantErr: 13.63741 batch_time=2.27492 
Train Epoch: 39 [78/250 9984/32000 (31%)] Loss: 3.57753 (QuantReg: 13.31406) QuantErr: 13.31406 batch_time=0.43848 
Train Epoch: 39 [89/250 11392/32000 (36%)] Loss: 2.61713 (QuantReg: 13.45027) QuantErr: 13.45027 batch_time=0.41945 
Train Epoch: 39 [100/250 12800/32000 (40%)] Loss: 2.82854 (QuantReg: 13.32194) QuantErr: 13.32194 batch_time=0.45171 
Train Epoch: 39 [111/250 14208/32000 (44%)] Loss: 3.23976 (QuantReg: 13.25010) QuantErr: 13.25010 batch_time=0.42491 
Train Epoch: 39 [122/250 15616/32000 (49%)] Loss: 2.36370 (QuantReg: 13.40814) QuantErr: 13.40814 batch_time=0.43835 
Train Epoch: 39 [133/250 17024/32000 (53%)] Loss: 3.26631 (QuantReg: 13.40106) QuantErr: 13.40106 batch_time=0.44627 
Train Epoch: 39 [144/250 18432/32000 (58%)] Loss: 2.83506 (QuantReg: 13.26355) QuantErr: 13.26355 batch_time=0.48089 
Train Epoch: 39 [155/250 19840/32000 (62%)] Loss: 2.50057 (QuantReg: 13.58127) QuantErr: 13.58127 batch_time=0.43287 
Train Epoch: 39 [166/250 21248/32000 (66%)] Loss: 2.22713 (QuantReg: 13.36163) QuantErr: 13.36163 batch_time=0.41974 
Train Epoch: 39 [177/250 22656/32000 (71%)] Loss: 3.86162 (QuantReg: 13.24079) QuantErr: 13.24079 batch_time=0.43838 
Train Epoch: 39 [188/250 24064/32000 (75%)] Loss: 3.23755 (QuantReg: 13.34444) QuantErr: 13.34444 batch_time=0.41728 
Train Epoch: 39 [199/250 25472/32000 (80%)] Loss: 2.99155 (QuantReg: 13.29005) QuantErr: 13.29005 batch_time=0.43665 
Train Epoch: 39 [210/250 26880/32000 (84%)] Loss: 3.45595 (QuantReg: 13.26330) QuantErr: 13.26330 batch_time=0.46767 
Train Epoch: 39 [221/250 28288/32000 (88%)] Loss: 3.10590 (QuantReg: 13.30101) QuantErr: 13.30101 batch_time=0.46348 
Train Epoch: 39 [232/250 29696/32000 (93%)] Loss: 4.24382 (QuantReg: 13.03603) QuantErr: 13.03603 batch_time=0.48387 
Train Epoch: 39 [243/250 31104/32000 (97%)] Loss: 3.74322 (QuantReg: 13.00867) QuantErr: 13.00867 batch_time=0.44818 
Train Epoch: 39 codebook_update_time=1.13724
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch39.pth ...
Done in 3.811s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 3.1307111778259276
 quant_reg      : 13.318818733215332
 quant_err      : 13.318818733215332
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 9750
 MSRVTT_full_val/t2v_metrics/R1: 34.40643863179074
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.301810865191147
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.714423441437056
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.668008048289739
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.589939954532895
 MSRVTT_full_test/t2v_metrics/R1: 13.377926421404682
 MSRVTT_full_test/t2v_metrics/R5: 37.89297658862876
 MSRVTT_full_test/t2v_metrics/R10: 50.936454849498325
 MSRVTT_full_test/t2v_metrics/R50: 81.30434782608695
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.50602006688963
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.556890762909777
 MSRVTT_full_test/v2t_metrics/R1: 16.387959866220736
 MSRVTT_full_test/v2t_metrics/R5: 45.48494983277592
 MSRVTT_full_test/v2t_metrics/R10: 60.2675585284281
 MSRVTT_full_test/v2t_metrics/R50: 86.32107023411372
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.337792642140467
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.54883751108194
 mnt_best       : 30.530673399144213
 not_improved_count: 5
Train Epoch: 40 [1/250 128/32000 (0%)] Loss: 3.69010 (QuantReg: 13.28472) QuantErr: 13.28472 batch_time=35.31088 
Train Epoch: 40 [12/250 1536/32000 (5%)] Loss: 3.55524 (QuantReg: 13.11677) QuantErr: 13.11677 batch_time=0.44454 
Train Epoch: 40 [23/250 2944/32000 (9%)] Loss: 2.33435 (QuantReg: 13.68938) QuantErr: 13.68938 batch_time=0.44476 
Train Epoch: 40 [34/250 4352/32000 (14%)] Loss: 4.03287 (QuantReg: 13.37711) QuantErr: 13.37711 batch_time=0.45294 
Train Epoch: 40 [45/250 5760/32000 (18%)] Loss: 2.89952 (QuantReg: 13.51282) QuantErr: 13.51282 batch_time=0.43551 
Train Epoch: 40 [56/250 7168/32000 (22%)] Loss: 3.17125 (QuantReg: 13.36419) QuantErr: 13.36419 batch_time=0.44447 
Train Epoch: 40 [67/250 8576/32000 (27%)] Loss: 3.78641 (QuantReg: 13.02333) QuantErr: 13.02333 batch_time=1.42290 
Train Epoch: 40 [78/250 9984/32000 (31%)] Loss: 3.36028 (QuantReg: 13.34401) QuantErr: 13.34401 batch_time=0.47117 
Train Epoch: 40 [89/250 11392/32000 (36%)] Loss: 2.08030 (QuantReg: 13.58901) QuantErr: 13.58901 batch_time=0.44385 
Train Epoch: 40 [100/250 12800/32000 (40%)] Loss: 2.78432 (QuantReg: 13.54464) QuantErr: 13.54464 batch_time=0.49605 
Train Epoch: 40 [111/250 14208/32000 (44%)] Loss: 3.66842 (QuantReg: 13.01634) QuantErr: 13.01634 batch_time=0.44361 
Train Epoch: 40 [122/250 15616/32000 (49%)] Loss: 2.74600 (QuantReg: 13.05464) QuantErr: 13.05464 batch_time=0.42991 
Train Epoch: 40 [133/250 17024/32000 (53%)] Loss: 2.88752 (QuantReg: 13.37865) QuantErr: 13.37865 batch_time=0.44488 
Train Epoch: 40 [144/250 18432/32000 (58%)] Loss: 3.45693 (QuantReg: 13.30942) QuantErr: 13.30942 batch_time=5.02745 
Train Epoch: 40 [155/250 19840/32000 (62%)] Loss: 3.79744 (QuantReg: 13.20117) QuantErr: 13.20117 batch_time=0.43653 
Train Epoch: 40 [166/250 21248/32000 (66%)] Loss: 3.49875 (QuantReg: 13.12753) QuantErr: 13.12753 batch_time=0.48043 
Train Epoch: 40 [177/250 22656/32000 (71%)] Loss: 3.20375 (QuantReg: 13.44967) QuantErr: 13.44967 batch_time=0.44788 
Train Epoch: 40 [188/250 24064/32000 (75%)] Loss: 3.69988 (QuantReg: 13.44283) QuantErr: 13.44283 batch_time=0.50658 
Train Epoch: 40 [199/250 25472/32000 (80%)] Loss: 2.54682 (QuantReg: 13.41813) QuantErr: 13.41813 batch_time=0.44845 
Train Epoch: 40 [210/250 26880/32000 (84%)] Loss: 2.99123 (QuantReg: 13.48887) QuantErr: 13.48887 batch_time=0.46713 
Train Epoch: 40 [221/250 28288/32000 (88%)] Loss: 3.60198 (QuantReg: 13.46242) QuantErr: 13.46242 batch_time=0.48415 
Train Epoch: 40 [232/250 29696/32000 (93%)] Loss: 3.51838 (QuantReg: 13.19285) QuantErr: 13.19285 batch_time=0.46264 
Train Epoch: 40 [243/250 31104/32000 (97%)] Loss: 2.65153 (QuantReg: 13.51618) QuantErr: 13.51618 batch_time=0.46953 
Train Epoch: 40 codebook_update_time=1.09181
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch40.pth ...
Done in 15.707s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 3.15713689994812
 quant_reg      : 13.350786960601807
 quant_err      : 13.350786960601807
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 83.90342052313883
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.374245472837021
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.70896392551408
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 78.67203219315896
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.7645875251509056
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.29207187907
 MSRVTT_full_test/t2v_metrics/R1: 13.979933110367893
 MSRVTT_full_test/t2v_metrics/R5: 38.16053511705686
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 81.33779264214047
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.38327759197325
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.110173916890684
 MSRVTT_full_test/v2t_metrics/R1: 17.45819397993311
 MSRVTT_full_test/v2t_metrics/R5: 46.05351170568562
 MSRVTT_full_test/v2t_metrics/R10: 59.59866220735786
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.761872909698997
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.32170214342555
 mnt_best       : 30.530673399144213
 not_improved_count: 6
Train Epoch: 41 [1/250 128/32000 (0%)] Loss: 3.87901 (QuantReg: 13.18285) QuantErr: 13.18285 batch_time=33.69632 
Train Epoch: 41 [12/250 1536/32000 (5%)] Loss: 4.03059 (QuantReg: 12.97739) QuantErr: 12.97739 batch_time=0.43852 
Train Epoch: 41 [23/250 2944/32000 (9%)] Loss: 3.70609 (QuantReg: 13.21944) QuantErr: 13.21944 batch_time=0.43550 
Train Epoch: 41 [34/250 4352/32000 (14%)] Loss: 3.20334 (QuantReg: 13.45924) QuantErr: 13.45924 batch_time=0.43498 
Train Epoch: 41 [45/250 5760/32000 (18%)] Loss: 3.47950 (QuantReg: 13.13350) QuantErr: 13.13350 batch_time=0.45134 
Train Epoch: 41 [56/250 7168/32000 (22%)] Loss: 4.38354 (QuantReg: 13.20405) QuantErr: 13.20405 batch_time=0.45019 
Train Epoch: 41 [67/250 8576/32000 (27%)] Loss: 3.12472 (QuantReg: 13.37329) QuantErr: 13.37329 batch_time=0.43975 
Train Epoch: 41 [78/250 9984/32000 (31%)] Loss: 3.02064 (QuantReg: 13.18336) QuantErr: 13.18336 batch_time=0.43432 
Train Epoch: 41 [89/250 11392/32000 (36%)] Loss: 2.94699 (QuantReg: 13.51341) QuantErr: 13.51341 batch_time=0.46248 
Train Epoch: 41 [100/250 12800/32000 (40%)] Loss: 3.22288 (QuantReg: 13.65254) QuantErr: 13.65254 batch_time=0.41677 
Train Epoch: 41 [111/250 14208/32000 (44%)] Loss: 3.21120 (QuantReg: 13.32666) QuantErr: 13.32666 batch_time=0.44123 
Train Epoch: 41 [122/250 15616/32000 (49%)] Loss: 2.59003 (QuantReg: 13.47381) QuantErr: 13.47381 batch_time=0.43883 
Train Epoch: 41 [133/250 17024/32000 (53%)] Loss: 3.25785 (QuantReg: 13.15268) QuantErr: 13.15268 batch_time=0.44336 
Train Epoch: 41 [144/250 18432/32000 (58%)] Loss: 3.19372 (QuantReg: 13.25300) QuantErr: 13.25300 batch_time=0.43715 
Train Epoch: 41 [155/250 19840/32000 (62%)] Loss: 3.42619 (QuantReg: 13.35671) QuantErr: 13.35671 batch_time=0.44713 
Train Epoch: 41 [166/250 21248/32000 (66%)] Loss: 3.15788 (QuantReg: 13.38533) QuantErr: 13.38533 batch_time=0.42160 
Train Epoch: 41 [177/250 22656/32000 (71%)] Loss: 2.83738 (QuantReg: 13.51560) QuantErr: 13.51560 batch_time=0.42206 
Train Epoch: 41 [188/250 24064/32000 (75%)] Loss: 3.43627 (QuantReg: 13.11046) QuantErr: 13.11046 batch_time=0.45562 
Train Epoch: 41 [199/250 25472/32000 (80%)] Loss: 2.87765 (QuantReg: 13.47547) QuantErr: 13.47547 batch_time=0.44791 
Train Epoch: 41 [210/250 26880/32000 (84%)] Loss: 2.92989 (QuantReg: 13.40767) QuantErr: 13.40767 batch_time=0.44070 
Train Epoch: 41 [221/250 28288/32000 (88%)] Loss: 2.83623 (QuantReg: 13.23612) QuantErr: 13.23612 batch_time=0.42485 
Train Epoch: 41 [232/250 29696/32000 (93%)] Loss: 3.96872 (QuantReg: 13.14824) QuantErr: 13.14824 batch_time=0.46736 
Train Epoch: 41 [243/250 31104/32000 (97%)] Loss: 3.13209 (QuantReg: 13.26077) QuantErr: 13.26077 batch_time=0.46530 
Train Epoch: 41 codebook_update_time=0.95738
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch41.pth ...
Done in 4.477s
removing stale ckpt [epoch 40] [took 0.00s]
 epoch          : 41
 loss           : 3.1644131937026976
 quant_reg      : 13.346874809265136
 quant_err      : 13.346874809265136
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 10250
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.263581488933601
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.44896584198582
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.565392354124748
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.71552341936211
 MSRVTT_full_test/t2v_metrics/R1: 14.147157190635452
 MSRVTT_full_test/t2v_metrics/R5: 38.06020066889632
 MSRVTT_full_test/t2v_metrics/R10: 51.77257525083612
 MSRVTT_full_test/t2v_metrics/R50: 81.23745819397993
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.30434782608695
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.321220145514086
 MSRVTT_full_test/v2t_metrics/R1: 17.4247491638796
 MSRVTT_full_test/v2t_metrics/R5: 45.752508361204015
 MSRVTT_full_test/v2t_metrics/R10: 60.10033444816054
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.382107023411372
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.32058020852558
 mnt_best       : 30.530673399144213
 not_improved_count: 7
Train Epoch: 42 [1/250 128/32000 (0%)] Loss: 3.37327 (QuantReg: 13.13158) QuantErr: 13.13158 batch_time=30.50735 
Train Epoch: 42 [12/250 1536/32000 (5%)] Loss: 3.06686 (QuantReg: 13.43650) QuantErr: 13.43650 batch_time=0.91465 
Train Epoch: 42 [23/250 2944/32000 (9%)] Loss: 2.30828 (QuantReg: 13.58171) QuantErr: 13.58171 batch_time=0.49707 
Train Epoch: 42 [34/250 4352/32000 (14%)] Loss: 3.19092 (QuantReg: 13.26660) QuantErr: 13.26660 batch_time=0.42302 
Train Epoch: 42 [45/250 5760/32000 (18%)] Loss: 2.88704 (QuantReg: 13.35061) QuantErr: 13.35061 batch_time=0.43162 
Train Epoch: 42 [56/250 7168/32000 (22%)] Loss: 2.63336 (QuantReg: 13.41821) QuantErr: 13.41821 batch_time=0.43461 
Train Epoch: 42 [67/250 8576/32000 (27%)] Loss: 2.33935 (QuantReg: 13.36843) QuantErr: 13.36843 batch_time=0.42253 
Train Epoch: 42 [78/250 9984/32000 (31%)] Loss: 3.67949 (QuantReg: 13.24441) QuantErr: 13.24441 batch_time=0.44872 
Train Epoch: 42 [89/250 11392/32000 (36%)] Loss: 2.35905 (QuantReg: 13.44290) QuantErr: 13.44290 batch_time=0.45377 
Train Epoch: 42 [100/250 12800/32000 (40%)] Loss: 3.09155 (QuantReg: 13.34998) QuantErr: 13.34998 batch_time=0.54284 
Train Epoch: 42 [111/250 14208/32000 (44%)] Loss: 4.01312 (QuantReg: 13.36600) QuantErr: 13.36600 batch_time=0.42013 
Train Epoch: 42 [122/250 15616/32000 (49%)] Loss: 3.32142 (QuantReg: 13.52814) QuantErr: 13.52814 batch_time=0.45004 
Train Epoch: 42 [133/250 17024/32000 (53%)] Loss: 3.23475 (QuantReg: 13.27395) QuantErr: 13.27395 batch_time=0.41998 
Train Epoch: 42 [144/250 18432/32000 (58%)] Loss: 2.14605 (QuantReg: 13.46639) QuantErr: 13.46639 batch_time=0.44169 
Train Epoch: 42 [155/250 19840/32000 (62%)] Loss: 2.78927 (QuantReg: 13.57956) QuantErr: 13.57956 batch_time=0.41817 
Train Epoch: 42 [166/250 21248/32000 (66%)] Loss: 2.89669 (QuantReg: 13.60894) QuantErr: 13.60894 batch_time=0.43005 
Train Epoch: 42 [177/250 22656/32000 (71%)] Loss: 3.14134 (QuantReg: 13.16630) QuantErr: 13.16630 batch_time=0.43074 
Train Epoch: 42 [188/250 24064/32000 (75%)] Loss: 3.63559 (QuantReg: 13.19502) QuantErr: 13.19502 batch_time=0.45253 
Train Epoch: 42 [199/250 25472/32000 (80%)] Loss: 4.10575 (QuantReg: 13.17787) QuantErr: 13.17787 batch_time=0.43897 
Train Epoch: 42 [210/250 26880/32000 (84%)] Loss: 2.65547 (QuantReg: 13.43406) QuantErr: 13.43406 batch_time=0.68938 
Train Epoch: 42 [221/250 28288/32000 (88%)] Loss: 2.88728 (QuantReg: 13.76231) QuantErr: 13.76231 batch_time=0.43508 
Train Epoch: 42 [232/250 29696/32000 (93%)] Loss: 3.07472 (QuantReg: 13.23486) QuantErr: 13.23486 batch_time=0.46151 
Train Epoch: 42 [243/250 31104/32000 (97%)] Loss: 3.75045 (QuantReg: 13.34504) QuantErr: 13.34504 batch_time=0.46984 
Train Epoch: 42 codebook_update_time=1.43268
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch42.pth ...
Done in 3.991s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch42.pth ...
Done in 7.875s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 3.169395301818848
 quant_reg      : 13.357875480651856
 quant_err      : 13.357875480651856
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 33.601609657947684
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.269617706237424
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.55474957432379
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.55533199195171
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.55823837894818
 MSRVTT_full_test/t2v_metrics/R1: 14.013377926421406
 MSRVTT_full_test/t2v_metrics/R5: 38.76254180602007
 MSRVTT_full_test/t2v_metrics/R10: 52.675585284280935
 MSRVTT_full_test/t2v_metrics/R50: 81.40468227424749
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.821739130434786
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.585915476255384
 MSRVTT_full_test/v2t_metrics/R1: 17.558528428093645
 MSRVTT_full_test/v2t_metrics/R5: 45.785953177257525
 MSRVTT_full_test/v2t_metrics/R10: 59.79933110367893
 MSRVTT_full_test/v2t_metrics/R50: 86.5551839464883
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.874247491638798
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.36125801105112
 mnt_best       : 30.585915476255384
 not_improved_count: 0
Train Epoch: 43 [1/250 128/32000 (0%)] Loss: 3.61802 (QuantReg: 13.36508) QuantErr: 13.36508 batch_time=29.57736 
Train Epoch: 43 [12/250 1536/32000 (5%)] Loss: 2.60347 (QuantReg: 13.36619) QuantErr: 13.36619 batch_time=6.15453 
Train Epoch: 43 [23/250 2944/32000 (9%)] Loss: 2.79350 (QuantReg: 13.25466) QuantErr: 13.25466 batch_time=1.73504 
Train Epoch: 43 [34/250 4352/32000 (14%)] Loss: 3.12855 (QuantReg: 13.45099) QuantErr: 13.45099 batch_time=0.43892 
Train Epoch: 43 [45/250 5760/32000 (18%)] Loss: 2.89051 (QuantReg: 13.31120) QuantErr: 13.31120 batch_time=0.48294 
Train Epoch: 43 [56/250 7168/32000 (22%)] Loss: 2.74738 (QuantReg: 13.61733) QuantErr: 13.61733 batch_time=0.45418 
Train Epoch: 43 [67/250 8576/32000 (27%)] Loss: 2.97728 (QuantReg: 13.42944) QuantErr: 13.42944 batch_time=0.45528 
Train Epoch: 43 [78/250 9984/32000 (31%)] Loss: 2.92384 (QuantReg: 13.00465) QuantErr: 13.00465 batch_time=0.43878 
Train Epoch: 43 [89/250 11392/32000 (36%)] Loss: 2.40830 (QuantReg: 13.40832) QuantErr: 13.40832 batch_time=0.42189 
Train Epoch: 43 [100/250 12800/32000 (40%)] Loss: 3.69468 (QuantReg: 13.40569) QuantErr: 13.40569 batch_time=0.43623 
Train Epoch: 43 [111/250 14208/32000 (44%)] Loss: 3.33680 (QuantReg: 13.55561) QuantErr: 13.55561 batch_time=0.49079 
Train Epoch: 43 [122/250 15616/32000 (49%)] Loss: 3.08054 (QuantReg: 13.53524) QuantErr: 13.53524 batch_time=0.43974 
Train Epoch: 43 [133/250 17024/32000 (53%)] Loss: 4.15359 (QuantReg: 13.15977) QuantErr: 13.15977 batch_time=1.35426 
Train Epoch: 43 [144/250 18432/32000 (58%)] Loss: 2.52953 (QuantReg: 13.59216) QuantErr: 13.59216 batch_time=0.44908 
Train Epoch: 43 [155/250 19840/32000 (62%)] Loss: 2.63766 (QuantReg: 13.41594) QuantErr: 13.41594 batch_time=0.42927 
Train Epoch: 43 [166/250 21248/32000 (66%)] Loss: 3.05046 (QuantReg: 13.43579) QuantErr: 13.43579 batch_time=0.45931 
Train Epoch: 43 [177/250 22656/32000 (71%)] Loss: 3.63560 (QuantReg: 13.18806) QuantErr: 13.18806 batch_time=0.44138 
Train Epoch: 43 [188/250 24064/32000 (75%)] Loss: 3.55725 (QuantReg: 13.42085) QuantErr: 13.42085 batch_time=0.44046 
Train Epoch: 43 [199/250 25472/32000 (80%)] Loss: 4.56819 (QuantReg: 13.51656) QuantErr: 13.51656 batch_time=0.45387 
Train Epoch: 43 [210/250 26880/32000 (84%)] Loss: 2.39217 (QuantReg: 13.53857) QuantErr: 13.53857 batch_time=0.47954 
Train Epoch: 43 [221/250 28288/32000 (88%)] Loss: 2.80618 (QuantReg: 13.44012) QuantErr: 13.44012 batch_time=0.44725 
Train Epoch: 43 [232/250 29696/32000 (93%)] Loss: 2.10177 (QuantReg: 13.30542) QuantErr: 13.30542 batch_time=0.43645 
Train Epoch: 43 [243/250 31104/32000 (97%)] Loss: 3.24881 (QuantReg: 13.27520) QuantErr: 13.27520 batch_time=0.47963 
Train Epoch: 43 codebook_update_time=1.01465
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch43.pth ...
Done in 5.286s
removing stale ckpt [epoch 42] [took 0.00s]
 epoch          : 43
 loss           : 3.1419987640380858
 quant_reg      : 13.360335529327392
 quant_err      : 13.360335529327392
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 10750
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.104627766599599
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.774115182862126
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.877263581488934
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.11745728727522
 MSRVTT_full_test/t2v_metrics/R1: 14.11371237458194
 MSRVTT_full_test/t2v_metrics/R5: 38.66220735785953
 MSRVTT_full_test/t2v_metrics/R10: 51.97324414715719
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.529096989966554
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.49551075243516
 MSRVTT_full_test/v2t_metrics/R1: 17.123745819397993
 MSRVTT_full_test/v2t_metrics/R5: 45.45150501672241
 MSRVTT_full_test/v2t_metrics/R10: 59.79933110367893
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.181605351170568
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.97060886468605
 mnt_best       : 30.585915476255384
 not_improved_count: 1
Train Epoch: 44 [1/250 128/32000 (0%)] Loss: 2.84234 (QuantReg: 13.53863) QuantErr: 13.53863 batch_time=32.42545 
Train Epoch: 44 [12/250 1536/32000 (5%)] Loss: 3.77642 (QuantReg: 13.28363) QuantErr: 13.28363 batch_time=0.41680 
Train Epoch: 44 [23/250 2944/32000 (9%)] Loss: 3.08894 (QuantReg: 13.39115) QuantErr: 13.39115 batch_time=0.45421 
Train Epoch: 44 [34/250 4352/32000 (14%)] Loss: 3.14405 (QuantReg: 13.40043) QuantErr: 13.40043 batch_time=0.45350 
Train Epoch: 44 [45/250 5760/32000 (18%)] Loss: 3.40231 (QuantReg: 13.51916) QuantErr: 13.51916 batch_time=0.44141 
Train Epoch: 44 [56/250 7168/32000 (22%)] Loss: 3.79796 (QuantReg: 13.40856) QuantErr: 13.40856 batch_time=0.42601 
Train Epoch: 44 [67/250 8576/32000 (27%)] Loss: 2.49668 (QuantReg: 13.37357) QuantErr: 13.37357 batch_time=6.95494 
Train Epoch: 44 [78/250 9984/32000 (31%)] Loss: 2.94569 (QuantReg: 13.10119) QuantErr: 13.10119 batch_time=0.45492 
Train Epoch: 44 [89/250 11392/32000 (36%)] Loss: 3.41117 (QuantReg: 13.43988) QuantErr: 13.43988 batch_time=0.43602 
Train Epoch: 44 [100/250 12800/32000 (40%)] Loss: 3.43438 (QuantReg: 13.37740) QuantErr: 13.37740 batch_time=0.44421 
Train Epoch: 44 [111/250 14208/32000 (44%)] Loss: 3.27639 (QuantReg: 13.66094) QuantErr: 13.66094 batch_time=0.42431 
Train Epoch: 44 [122/250 15616/32000 (49%)] Loss: 2.62817 (QuantReg: 13.61335) QuantErr: 13.61335 batch_time=0.42241 
Train Epoch: 44 [133/250 17024/32000 (53%)] Loss: 2.66783 (QuantReg: 13.39897) QuantErr: 13.39897 batch_time=0.42035 
Train Epoch: 44 [144/250 18432/32000 (58%)] Loss: 3.31752 (QuantReg: 13.42903) QuantErr: 13.42903 batch_time=0.42863 
Train Epoch: 44 [155/250 19840/32000 (62%)] Loss: 3.18203 (QuantReg: 13.43158) QuantErr: 13.43158 batch_time=0.43679 
Train Epoch: 44 [166/250 21248/32000 (66%)] Loss: 3.14013 (QuantReg: 13.31818) QuantErr: 13.31818 batch_time=0.45164 
Train Epoch: 44 [177/250 22656/32000 (71%)] Loss: 2.78601 (QuantReg: 13.49521) QuantErr: 13.49521 batch_time=0.44805 
Train Epoch: 44 [188/250 24064/32000 (75%)] Loss: 2.41779 (QuantReg: 13.19027) QuantErr: 13.19027 batch_time=0.42869 
Train Epoch: 44 [199/250 25472/32000 (80%)] Loss: 2.69517 (QuantReg: 13.51884) QuantErr: 13.51884 batch_time=0.43802 
Train Epoch: 44 [210/250 26880/32000 (84%)] Loss: 2.34184 (QuantReg: 13.68375) QuantErr: 13.68375 batch_time=0.44304 
Train Epoch: 44 [221/250 28288/32000 (88%)] Loss: 4.18093 (QuantReg: 13.49876) QuantErr: 13.49876 batch_time=0.43447 
Train Epoch: 44 [232/250 29696/32000 (93%)] Loss: 3.53436 (QuantReg: 13.64580) QuantErr: 13.64580 batch_time=0.44455 
Train Epoch: 44 [243/250 31104/32000 (97%)] Loss: 3.16861 (QuantReg: 13.39846) QuantErr: 13.39846 batch_time=0.44749 
Train Epoch: 44 codebook_update_time=0.98214
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch44.pth ...
Done in 20.180s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch44.pth ...
Done in 23.976s
removing stale ckpt [epoch 43] [took 0.00s]
 epoch          : 44
 loss           : 3.1242663078308106
 quant_reg      : 13.387492370605468
 quant_err      : 13.387492370605468
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.8913480885311875
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.36046615874342
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.424547283702213
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.03777118785402
 MSRVTT_full_test/t2v_metrics/R1: 14.347826086956522
 MSRVTT_full_test/t2v_metrics/R5: 38.69565217391305
 MSRVTT_full_test/t2v_metrics/R10: 52.17391304347826
 MSRVTT_full_test/t2v_metrics/R50: 80.90301003344482
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.31605351170568
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.71146696797126
 MSRVTT_full_test/v2t_metrics/R1: 17.65886287625418
 MSRVTT_full_test/v2t_metrics/R5: 45.919732441471574
 MSRVTT_full_test/v2t_metrics/R10: 60.53511705685619
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.380936454849497
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.6147851316675
 mnt_best       : 30.71146696797126
 not_improved_count: 0
Train Epoch: 45 [1/250 128/32000 (0%)] Loss: 3.00337 (QuantReg: 13.53701) QuantErr: 13.53701 batch_time=35.29905 
Train Epoch: 45 [12/250 1536/32000 (5%)] Loss: 3.57074 (QuantReg: 13.23051) QuantErr: 13.23051 batch_time=0.44051 
Train Epoch: 45 [23/250 2944/32000 (9%)] Loss: 3.41786 (QuantReg: 13.30852) QuantErr: 13.30852 batch_time=1.26331 
Train Epoch: 45 [34/250 4352/32000 (14%)] Loss: 3.17394 (QuantReg: 13.38106) QuantErr: 13.38106 batch_time=0.45033 
Train Epoch: 45 [45/250 5760/32000 (18%)] Loss: 3.49142 (QuantReg: 13.51283) QuantErr: 13.51283 batch_time=0.42524 
Train Epoch: 45 [56/250 7168/32000 (22%)] Loss: 2.72372 (QuantReg: 13.32285) QuantErr: 13.32285 batch_time=0.41916 
Train Epoch: 45 [67/250 8576/32000 (27%)] Loss: 2.78314 (QuantReg: 13.59154) QuantErr: 13.59154 batch_time=2.53887 
Train Epoch: 45 [78/250 9984/32000 (31%)] Loss: 2.86745 (QuantReg: 13.48824) QuantErr: 13.48824 batch_time=0.45230 
Train Epoch: 45 [89/250 11392/32000 (36%)] Loss: 3.71010 (QuantReg: 13.28798) QuantErr: 13.28798 batch_time=0.79793 
Train Epoch: 45 [100/250 12800/32000 (40%)] Loss: 2.62012 (QuantReg: 13.44942) QuantErr: 13.44942 batch_time=0.43880 
Train Epoch: 45 [111/250 14208/32000 (44%)] Loss: 3.14787 (QuantReg: 13.36369) QuantErr: 13.36369 batch_time=0.41731 
Train Epoch: 45 [122/250 15616/32000 (49%)] Loss: 2.80521 (QuantReg: 13.43516) QuantErr: 13.43516 batch_time=0.41765 
Train Epoch: 45 [133/250 17024/32000 (53%)] Loss: 2.69509 (QuantReg: 13.53094) QuantErr: 13.53094 batch_time=0.44935 
Train Epoch: 45 [144/250 18432/32000 (58%)] Loss: 3.02799 (QuantReg: 13.40362) QuantErr: 13.40362 batch_time=0.44721 
Train Epoch: 45 [155/250 19840/32000 (62%)] Loss: 3.16832 (QuantReg: 13.47824) QuantErr: 13.47824 batch_time=0.41764 
Train Epoch: 45 [166/250 21248/32000 (66%)] Loss: 3.43155 (QuantReg: 13.45937) QuantErr: 13.45937 batch_time=0.43058 
Train Epoch: 45 [177/250 22656/32000 (71%)] Loss: 3.31869 (QuantReg: 13.46661) QuantErr: 13.46661 batch_time=0.41785 
Train Epoch: 45 [188/250 24064/32000 (75%)] Loss: 3.26615 (QuantReg: 13.32590) QuantErr: 13.32590 batch_time=0.43373 
Train Epoch: 45 [199/250 25472/32000 (80%)] Loss: 3.09745 (QuantReg: 13.38730) QuantErr: 13.38730 batch_time=0.45640 
Train Epoch: 45 [210/250 26880/32000 (84%)] Loss: 3.27023 (QuantReg: 13.71158) QuantErr: 13.71158 batch_time=0.42337 
Train Epoch: 45 [221/250 28288/32000 (88%)] Loss: 2.82656 (QuantReg: 13.58144) QuantErr: 13.58144 batch_time=0.44776 
Train Epoch: 45 [232/250 29696/32000 (93%)] Loss: 3.19087 (QuantReg: 13.46150) QuantErr: 13.46150 batch_time=0.42437 
Train Epoch: 45 [243/250 31104/32000 (97%)] Loss: 2.68637 (QuantReg: 13.51693) QuantErr: 13.51693 batch_time=0.43827 
Train Epoch: 45 codebook_update_time=1.03884
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch45.pth ...
Done in 3.879s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 3.1607469053268433
 quant_reg      : 13.41782564163208
 quant_err      : 13.41782564163208
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 11250
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.158953722334005
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.31555936370288
 MSRVTT_full_val/v2t_metrics/R1: 38.028169014084504
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.597585513078471
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.30417872185514
 MSRVTT_full_test/t2v_metrics/R1: 13.779264214046822
 MSRVTT_full_test/t2v_metrics/R5: 38.46153846153846
 MSRVTT_full_test/t2v_metrics/R10: 51.97324414715719
 MSRVTT_full_test/t2v_metrics/R50: 80.8695652173913
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.9314381270903
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.200270666719934
 MSRVTT_full_test/v2t_metrics/R1: 17.157190635451506
 MSRVTT_full_test/v2t_metrics/R5: 46.220735785953174
 MSRVTT_full_test/v2t_metrics/R10: 59.83277591973244
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.972909698996656
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.20268053212445
 mnt_best       : 30.71146696797126
 not_improved_count: 1
Train Epoch: 46 [1/250 128/32000 (0%)] Loss: 3.80960 (QuantReg: 13.26095) QuantErr: 13.26095 batch_time=30.38165 
Train Epoch: 46 [12/250 1536/32000 (5%)] Loss: 3.08076 (QuantReg: 13.48792) QuantErr: 13.48792 batch_time=0.42992 
Train Epoch: 46 [23/250 2944/32000 (9%)] Loss: 2.98391 (QuantReg: 13.49519) QuantErr: 13.49519 batch_time=0.43581 
Train Epoch: 46 [34/250 4352/32000 (14%)] Loss: 3.06568 (QuantReg: 13.26761) QuantErr: 13.26761 batch_time=0.41822 
Train Epoch: 46 [45/250 5760/32000 (18%)] Loss: 3.39520 (QuantReg: 13.17603) QuantErr: 13.17603 batch_time=0.43733 
Train Epoch: 46 [56/250 7168/32000 (22%)] Loss: 3.52544 (QuantReg: 13.31615) QuantErr: 13.31615 batch_time=0.43939 
Train Epoch: 46 [67/250 8576/32000 (27%)] Loss: 4.01134 (QuantReg: 13.17539) QuantErr: 13.17539 batch_time=0.44814 
Train Epoch: 46 [78/250 9984/32000 (31%)] Loss: 3.30056 (QuantReg: 13.31487) QuantErr: 13.31487 batch_time=0.44077 
Train Epoch: 46 [89/250 11392/32000 (36%)] Loss: 3.10752 (QuantReg: 13.59266) QuantErr: 13.59266 batch_time=0.44719 
Train Epoch: 46 [100/250 12800/32000 (40%)] Loss: 3.31267 (QuantReg: 13.56747) QuantErr: 13.56747 batch_time=0.42412 
Train Epoch: 46 [111/250 14208/32000 (44%)] Loss: 2.79632 (QuantReg: 13.43994) QuantErr: 13.43994 batch_time=0.44201 
Train Epoch: 46 [122/250 15616/32000 (49%)] Loss: 3.13382 (QuantReg: 13.39663) QuantErr: 13.39663 batch_time=0.45135 
Train Epoch: 46 [133/250 17024/32000 (53%)] Loss: 2.60547 (QuantReg: 13.47735) QuantErr: 13.47735 batch_time=0.42121 
Train Epoch: 46 [144/250 18432/32000 (58%)] Loss: 3.64795 (QuantReg: 13.12157) QuantErr: 13.12157 batch_time=1.52089 
Train Epoch: 46 [155/250 19840/32000 (62%)] Loss: 3.05947 (QuantReg: 13.38175) QuantErr: 13.38175 batch_time=0.43664 
Train Epoch: 46 [166/250 21248/32000 (66%)] Loss: 2.85861 (QuantReg: 13.39500) QuantErr: 13.39500 batch_time=0.41708 
Train Epoch: 46 [177/250 22656/32000 (71%)] Loss: 3.52248 (QuantReg: 13.32768) QuantErr: 13.32768 batch_time=0.43100 
Train Epoch: 46 [188/250 24064/32000 (75%)] Loss: 3.10336 (QuantReg: 13.43239) QuantErr: 13.43239 batch_time=0.42441 
Train Epoch: 46 [199/250 25472/32000 (80%)] Loss: 3.89145 (QuantReg: 13.48064) QuantErr: 13.48064 batch_time=0.42072 
Train Epoch: 46 [210/250 26880/32000 (84%)] Loss: 2.62210 (QuantReg: 13.45959) QuantErr: 13.45959 batch_time=1.08100 
Train Epoch: 46 [221/250 28288/32000 (88%)] Loss: 2.75439 (QuantReg: 13.33744) QuantErr: 13.33744 batch_time=0.43208 
Train Epoch: 46 [232/250 29696/32000 (93%)] Loss: 2.81859 (QuantReg: 13.57486) QuantErr: 13.57486 batch_time=0.43827 
Train Epoch: 46 [243/250 31104/32000 (97%)] Loss: 3.51679 (QuantReg: 13.43301) QuantErr: 13.43301 batch_time=0.43895 
Train Epoch: 46 codebook_update_time=0.86951
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch46.pth ...
Done in 7.322s
removing stale ckpt [epoch 45] [took 0.00s]
 epoch          : 46
 loss           : 3.1574840354919433
 quant_reg      : 13.416647205352783
 quant_err      : 13.416647205352783
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.006036217303823
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.31832876855784
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.4607645875251505
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.76035757865448
 MSRVTT_full_test/t2v_metrics/R1: 13.91304347826087
 MSRVTT_full_test/t2v_metrics/R5: 38.42809364548495
 MSRVTT_full_test/t2v_metrics/R10: 51.73913043478261
 MSRVTT_full_test/t2v_metrics/R50: 80.8361204013378
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.38929765886287
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.243359785705433
 MSRVTT_full_test/v2t_metrics/R1: 17.859531772575252
 MSRVTT_full_test/v2t_metrics/R5: 45.785953177257525
 MSRVTT_full_test/v2t_metrics/R10: 59.83277591973244
 MSRVTT_full_test/v2t_metrics/R50: 86.75585284280936
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.291471571906353
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.574676505904826
 mnt_best       : 30.71146696797126
 not_improved_count: 2
Train Epoch: 47 [1/250 128/32000 (0%)] Loss: 2.36856 (QuantReg: 13.37980) QuantErr: 13.37980 batch_time=29.81534 
Train Epoch: 47 [12/250 1536/32000 (5%)] Loss: 2.75673 (QuantReg: 13.44959) QuantErr: 13.44959 batch_time=3.30361 
Train Epoch: 47 [23/250 2944/32000 (9%)] Loss: 2.22289 (QuantReg: 13.43266) QuantErr: 13.43266 batch_time=0.44724 
Train Epoch: 47 [34/250 4352/32000 (14%)] Loss: 3.61670 (QuantReg: 13.27107) QuantErr: 13.27107 batch_time=0.44143 
Train Epoch: 47 [45/250 5760/32000 (18%)] Loss: 3.15610 (QuantReg: 13.50196) QuantErr: 13.50196 batch_time=0.43189 
Train Epoch: 47 [56/250 7168/32000 (22%)] Loss: 2.95335 (QuantReg: 13.48885) QuantErr: 13.48885 batch_time=0.44900 
Train Epoch: 47 [67/250 8576/32000 (27%)] Loss: 2.58035 (QuantReg: 13.50742) QuantErr: 13.50742 batch_time=0.44814 
Train Epoch: 47 [78/250 9984/32000 (31%)] Loss: 3.60054 (QuantReg: 13.35375) QuantErr: 13.35375 batch_time=0.44429 
Train Epoch: 47 [89/250 11392/32000 (36%)] Loss: 3.52005 (QuantReg: 13.26100) QuantErr: 13.26100 batch_time=0.42401 
Train Epoch: 47 [100/250 12800/32000 (40%)] Loss: 3.54377 (QuantReg: 13.39809) QuantErr: 13.39809 batch_time=0.46125 
Train Epoch: 47 [111/250 14208/32000 (44%)] Loss: 2.61659 (QuantReg: 13.57102) QuantErr: 13.57102 batch_time=0.43642 
Train Epoch: 47 [122/250 15616/32000 (49%)] Loss: 2.85459 (QuantReg: 13.31391) QuantErr: 13.31391 batch_time=0.42497 
Train Epoch: 47 [133/250 17024/32000 (53%)] Loss: 3.62986 (QuantReg: 13.40220) QuantErr: 13.40220 batch_time=0.43160 
Train Epoch: 47 [144/250 18432/32000 (58%)] Loss: 2.78088 (QuantReg: 13.46771) QuantErr: 13.46771 batch_time=2.61480 
Train Epoch: 47 [155/250 19840/32000 (62%)] Loss: 3.60467 (QuantReg: 13.39900) QuantErr: 13.39900 batch_time=0.42293 
Train Epoch: 47 [166/250 21248/32000 (66%)] Loss: 3.07866 (QuantReg: 13.34636) QuantErr: 13.34636 batch_time=0.43251 
Train Epoch: 47 [177/250 22656/32000 (71%)] Loss: 3.95318 (QuantReg: 13.54794) QuantErr: 13.54794 batch_time=0.42642 
Train Epoch: 47 [188/250 24064/32000 (75%)] Loss: 3.18276 (QuantReg: 13.28252) QuantErr: 13.28252 batch_time=0.46320 
Train Epoch: 47 [199/250 25472/32000 (80%)] Loss: 3.09867 (QuantReg: 13.57593) QuantErr: 13.57593 batch_time=0.55155 
Train Epoch: 47 [210/250 26880/32000 (84%)] Loss: 3.11672 (QuantReg: 13.37499) QuantErr: 13.37499 batch_time=0.43425 
Train Epoch: 47 [221/250 28288/32000 (88%)] Loss: 2.33805 (QuantReg: 13.43243) QuantErr: 13.43243 batch_time=0.43437 
Train Epoch: 47 [232/250 29696/32000 (93%)] Loss: 3.35186 (QuantReg: 13.43742) QuantErr: 13.43742 batch_time=0.43799 
Train Epoch: 47 [243/250 31104/32000 (97%)] Loss: 3.44853 (QuantReg: 13.30379) QuantErr: 13.30379 batch_time=0.43085 
Train Epoch: 47 codebook_update_time=0.93514
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch47.pth ...
Done in 13.044s
removing stale ckpt [epoch 46] [took 0.41s]
 epoch          : 47
 loss           : 3.130045892715454
 quant_reg      : 13.426768619537354
 quant_err      : 13.426768619537354
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 11750
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.134808853118713
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.49617409560194
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.559356136820925
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.67506088160688
 MSRVTT_full_test/t2v_metrics/R1: 13.879598662207357
 MSRVTT_full_test/t2v_metrics/R5: 37.65886287625418
 MSRVTT_full_test/t2v_metrics/R10: 50.903010033444815
 MSRVTT_full_test/t2v_metrics/R50: 80.23411371237458
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.954515050167224
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.853541481198405
 MSRVTT_full_test/v2t_metrics/R1: 17.4247491638796
 MSRVTT_full_test/v2t_metrics/R5: 46.2876254180602
 MSRVTT_full_test/v2t_metrics/R10: 60.06688963210702
 MSRVTT_full_test/v2t_metrics/R50: 86.18729096989966
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.00903010033445
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.45486773941012
 mnt_best       : 30.71146696797126
 not_improved_count: 3
Train Epoch: 48 [1/250 128/32000 (0%)] Loss: 3.53369 (QuantReg: 13.50624) QuantErr: 13.50624 batch_time=33.74500 
Train Epoch: 48 [12/250 1536/32000 (5%)] Loss: 2.56909 (QuantReg: 13.59067) QuantErr: 13.59067 batch_time=0.45114 
Train Epoch: 48 [23/250 2944/32000 (9%)] Loss: 3.31376 (QuantReg: 13.36602) QuantErr: 13.36602 batch_time=0.44103 
Train Epoch: 48 [34/250 4352/32000 (14%)] Loss: 2.23845 (QuantReg: 13.63322) QuantErr: 13.63322 batch_time=0.42901 
Train Epoch: 48 [45/250 5760/32000 (18%)] Loss: 3.78077 (QuantReg: 13.51669) QuantErr: 13.51669 batch_time=0.44732 
Train Epoch: 48 [56/250 7168/32000 (22%)] Loss: 3.37114 (QuantReg: 13.56282) QuantErr: 13.56282 batch_time=0.42805 
Train Epoch: 48 [67/250 8576/32000 (27%)] Loss: 3.21183 (QuantReg: 13.49680) QuantErr: 13.49680 batch_time=2.91503 
Train Epoch: 48 [78/250 9984/32000 (31%)] Loss: 3.40891 (QuantReg: 13.41746) QuantErr: 13.41746 batch_time=0.43578 
Train Epoch: 48 [89/250 11392/32000 (36%)] Loss: 2.74454 (QuantReg: 13.65929) QuantErr: 13.65929 batch_time=0.46489 
Train Epoch: 48 [100/250 12800/32000 (40%)] Loss: 2.60689 (QuantReg: 13.39685) QuantErr: 13.39685 batch_time=0.65579 
Train Epoch: 48 [111/250 14208/32000 (44%)] Loss: 3.57583 (QuantReg: 13.34104) QuantErr: 13.34104 batch_time=0.42517 
Train Epoch: 48 [122/250 15616/32000 (49%)] Loss: 3.59377 (QuantReg: 13.68401) QuantErr: 13.68401 batch_time=0.45286 
Train Epoch: 48 [133/250 17024/32000 (53%)] Loss: 3.24788 (QuantReg: 13.45614) QuantErr: 13.45614 batch_time=0.43263 
Train Epoch: 48 [144/250 18432/32000 (58%)] Loss: 3.43060 (QuantReg: 13.63515) QuantErr: 13.63515 batch_time=0.42781 
Train Epoch: 48 [155/250 19840/32000 (62%)] Loss: 3.62496 (QuantReg: 13.39973) QuantErr: 13.39973 batch_time=0.46172 
Train Epoch: 48 [166/250 21248/32000 (66%)] Loss: 2.43662 (QuantReg: 13.56750) QuantErr: 13.56750 batch_time=0.43658 
Train Epoch: 48 [177/250 22656/32000 (71%)] Loss: 2.99331 (QuantReg: 13.65905) QuantErr: 13.65905 batch_time=0.45387 
Train Epoch: 48 [188/250 24064/32000 (75%)] Loss: 3.38266 (QuantReg: 13.57721) QuantErr: 13.57721 batch_time=0.43179 
Train Epoch: 48 [199/250 25472/32000 (80%)] Loss: 3.35382 (QuantReg: 13.24739) QuantErr: 13.24739 batch_time=0.44409 
Train Epoch: 48 [210/250 26880/32000 (84%)] Loss: 2.87368 (QuantReg: 13.76866) QuantErr: 13.76866 batch_time=0.43383 
Train Epoch: 48 [221/250 28288/32000 (88%)] Loss: 4.18991 (QuantReg: 13.45317) QuantErr: 13.45317 batch_time=0.44702 
Train Epoch: 48 [232/250 29696/32000 (93%)] Loss: 2.90967 (QuantReg: 13.44134) QuantErr: 13.44134 batch_time=0.43088 
Train Epoch: 48 [243/250 31104/32000 (97%)] Loss: 3.33943 (QuantReg: 13.31206) QuantErr: 13.31206 batch_time=0.47704 
Train Epoch: 48 codebook_update_time=1.06449
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch48.pth ...
Done in 21.819s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch48.pth ...
Done in 25.391s
removing stale ckpt [epoch 47] [took 0.00s]
 epoch          : 48
 loss           : 3.1311408281326294
 quant_reg      : 13.454535305023194
 quant_err      : 13.454535305023194
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.032193158953723
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.51332087645834
 MSRVTT_full_val/v2t_metrics/R1: 40.44265593561368
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.498993963782696
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.00297874966367
 MSRVTT_full_test/t2v_metrics/R1: 14.448160535117056
 MSRVTT_full_test/t2v_metrics/R5: 39.163879598662206
 MSRVTT_full_test/t2v_metrics/R10: 51.83946488294314
 MSRVTT_full_test/t2v_metrics/R50: 80.80267558528428
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.37123745819398
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.840370847882145
 MSRVTT_full_test/v2t_metrics/R1: 17.558528428093645
 MSRVTT_full_test/v2t_metrics/R5: 46.187290969899664
 MSRVTT_full_test/v2t_metrics/R10: 60.36789297658863
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.235785953177256
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.58240114964138
 mnt_best       : 30.840370847882145
 not_improved_count: 0
Train Epoch: 49 [1/250 128/32000 (0%)] Loss: 2.70607 (QuantReg: 13.51589) QuantErr: 13.51589 batch_time=31.33254 
Train Epoch: 49 [12/250 1536/32000 (5%)] Loss: 2.85612 (QuantReg: 13.55124) QuantErr: 13.55124 batch_time=0.44309 
Train Epoch: 49 [23/250 2944/32000 (9%)] Loss: 2.43986 (QuantReg: 13.59008) QuantErr: 13.59008 batch_time=0.48600 
Train Epoch: 49 [34/250 4352/32000 (14%)] Loss: 3.17979 (QuantReg: 13.25961) QuantErr: 13.25961 batch_time=0.43870 
Train Epoch: 49 [45/250 5760/32000 (18%)] Loss: 3.92971 (QuantReg: 13.33994) QuantErr: 13.33994 batch_time=0.44746 
Train Epoch: 49 [56/250 7168/32000 (22%)] Loss: 2.71866 (QuantReg: 13.39073) QuantErr: 13.39073 batch_time=0.42360 
Train Epoch: 49 [67/250 8576/32000 (27%)] Loss: 2.52240 (QuantReg: 13.22405) QuantErr: 13.22405 batch_time=2.93467 
Train Epoch: 49 [78/250 9984/32000 (31%)] Loss: 3.56371 (QuantReg: 13.32859) QuantErr: 13.32859 batch_time=0.43153 
Train Epoch: 49 [89/250 11392/32000 (36%)] Loss: 3.34309 (QuantReg: 13.46325) QuantErr: 13.46325 batch_time=0.43710 
Train Epoch: 49 [100/250 12800/32000 (40%)] Loss: 2.98547 (QuantReg: 13.49219) QuantErr: 13.49219 batch_time=0.42568 
Train Epoch: 49 [111/250 14208/32000 (44%)] Loss: 4.09841 (QuantReg: 13.27662) QuantErr: 13.27662 batch_time=0.48379 
Train Epoch: 49 [122/250 15616/32000 (49%)] Loss: 4.28501 (QuantReg: 13.22796) QuantErr: 13.22796 batch_time=0.43826 
Train Epoch: 49 [133/250 17024/32000 (53%)] Loss: 3.29587 (QuantReg: 13.29282) QuantErr: 13.29282 batch_time=0.47251 
Train Epoch: 49 [144/250 18432/32000 (58%)] Loss: 3.34667 (QuantReg: 13.22388) QuantErr: 13.22388 batch_time=0.43442 
Train Epoch: 49 [155/250 19840/32000 (62%)] Loss: 3.29721 (QuantReg: 13.39001) QuantErr: 13.39001 batch_time=0.42825 
Train Epoch: 49 [166/250 21248/32000 (66%)] Loss: 3.13533 (QuantReg: 13.62024) QuantErr: 13.62024 batch_time=0.42271 
Train Epoch: 49 [177/250 22656/32000 (71%)] Loss: 3.57358 (QuantReg: 13.24675) QuantErr: 13.24675 batch_time=0.44270 
Train Epoch: 49 [188/250 24064/32000 (75%)] Loss: 2.67022 (QuantReg: 13.46694) QuantErr: 13.46694 batch_time=0.45788 
Train Epoch: 49 [199/250 25472/32000 (80%)] Loss: 3.91459 (QuantReg: 13.42757) QuantErr: 13.42757 batch_time=0.44547 
Train Epoch: 49 [210/250 26880/32000 (84%)] Loss: 3.50824 (QuantReg: 13.39278) QuantErr: 13.39278 batch_time=1.03770 
Train Epoch: 49 [221/250 28288/32000 (88%)] Loss: 2.80182 (QuantReg: 13.53281) QuantErr: 13.53281 batch_time=0.43747 
Train Epoch: 49 [232/250 29696/32000 (93%)] Loss: 2.97348 (QuantReg: 13.32715) QuantErr: 13.32715 batch_time=0.44057 
Train Epoch: 49 [243/250 31104/32000 (97%)] Loss: 3.44956 (QuantReg: 13.50918) QuantErr: 13.50918 batch_time=0.47765 
Train Epoch: 49 codebook_update_time=1.13436
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch49.pth ...
Done in 10.929s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 3.108801869392395
 quant_reg      : 13.439816402435303
 quant_err      : 13.439816402435303
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 12250
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.152917505030182
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.09389467481594
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 78.67203219315896
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.438631790744467
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.10269447724659
 MSRVTT_full_test/t2v_metrics/R1: 14.247491638795987
 MSRVTT_full_test/t2v_metrics/R5: 39.063545150501675
 MSRVTT_full_test/t2v_metrics/R10: 51.63879598662207
 MSRVTT_full_test/t2v_metrics/R50: 81.30434782608695
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.69063545150502
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.63106223127012
 MSRVTT_full_test/v2t_metrics/R1: 17.45819397993311
 MSRVTT_full_test/v2t_metrics/R5: 45.986622073578594
 MSRVTT_full_test/v2t_metrics/R10: 60.36789297658863
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.701003344481606
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.459631996600386
 mnt_best       : 30.840370847882145
 not_improved_count: 1
Train Epoch: 50 [1/250 128/32000 (0%)] Loss: 2.62892 (QuantReg: 13.49366) QuantErr: 13.49366 batch_time=31.77719 
Train Epoch: 50 [12/250 1536/32000 (5%)] Loss: 3.88833 (QuantReg: 13.13577) QuantErr: 13.13577 batch_time=0.44380 
Train Epoch: 50 [23/250 2944/32000 (9%)] Loss: 2.70320 (QuantReg: 13.38757) QuantErr: 13.38757 batch_time=0.44554 
Train Epoch: 50 [34/250 4352/32000 (14%)] Loss: 3.12526 (QuantReg: 13.46426) QuantErr: 13.46426 batch_time=0.43347 
Train Epoch: 50 [45/250 5760/32000 (18%)] Loss: 3.03562 (QuantReg: 13.42786) QuantErr: 13.42786 batch_time=0.44386 
Train Epoch: 50 [56/250 7168/32000 (22%)] Loss: 3.05491 (QuantReg: 13.22363) QuantErr: 13.22363 batch_time=0.43240 
Train Epoch: 50 [67/250 8576/32000 (27%)] Loss: 2.57196 (QuantReg: 13.36729) QuantErr: 13.36729 batch_time=2.67430 
Train Epoch: 50 [78/250 9984/32000 (31%)] Loss: 3.71745 (QuantReg: 13.41832) QuantErr: 13.41832 batch_time=0.43842 
Train Epoch: 50 [89/250 11392/32000 (36%)] Loss: 2.86650 (QuantReg: 13.41720) QuantErr: 13.41720 batch_time=0.46896 
Train Epoch: 50 [100/250 12800/32000 (40%)] Loss: 3.30316 (QuantReg: 13.41041) QuantErr: 13.41041 batch_time=0.43621 
Train Epoch: 50 [111/250 14208/32000 (44%)] Loss: 3.55558 (QuantReg: 13.34609) QuantErr: 13.34609 batch_time=0.43642 
Train Epoch: 50 [122/250 15616/32000 (49%)] Loss: 4.05460 (QuantReg: 13.46722) QuantErr: 13.46722 batch_time=0.42832 
Train Epoch: 50 [133/250 17024/32000 (53%)] Loss: 3.59992 (QuantReg: 13.59935) QuantErr: 13.59935 batch_time=0.44964 
Train Epoch: 50 [144/250 18432/32000 (58%)] Loss: 3.71413 (QuantReg: 13.55333) QuantErr: 13.55333 batch_time=0.43028 
Train Epoch: 50 [155/250 19840/32000 (62%)] Loss: 3.12693 (QuantReg: 13.30600) QuantErr: 13.30600 batch_time=0.46460 
Train Epoch: 50 [166/250 21248/32000 (66%)] Loss: 3.38964 (QuantReg: 13.62142) QuantErr: 13.62142 batch_time=0.43902 
Train Epoch: 50 [177/250 22656/32000 (71%)] Loss: 2.60516 (QuantReg: 13.63160) QuantErr: 13.63160 batch_time=0.43133 
Train Epoch: 50 [188/250 24064/32000 (75%)] Loss: 3.22194 (QuantReg: 13.36993) QuantErr: 13.36993 batch_time=0.43723 
Train Epoch: 50 [199/250 25472/32000 (80%)] Loss: 3.56388 (QuantReg: 13.26653) QuantErr: 13.26653 batch_time=0.44096 
Train Epoch: 50 [210/250 26880/32000 (84%)] Loss: 3.57073 (QuantReg: 13.42043) QuantErr: 13.42043 batch_time=3.28686 
Train Epoch: 50 [221/250 28288/32000 (88%)] Loss: 2.81234 (QuantReg: 13.38000) QuantErr: 13.38000 batch_time=0.44376 
Train Epoch: 50 [232/250 29696/32000 (93%)] Loss: 3.00797 (QuantReg: 13.79863) QuantErr: 13.79863 batch_time=0.44064 
Train Epoch: 50 [243/250 31104/32000 (97%)] Loss: 3.71337 (QuantReg: 13.39250) QuantErr: 13.39250 batch_time=0.68431 
Train Epoch: 50 codebook_update_time=1.30419
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/checkpoint-epoch50.pth ...
Done in 3.862s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 3.1739705600738524
 quant_reg      : 13.432859279632568
 quant_err      : 13.432859279632568
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.004024144869216
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.83896313883348
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.360160965794768
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.14645911926428
 MSRVTT_full_test/t2v_metrics/R1: 14.147157190635452
 MSRVTT_full_test/t2v_metrics/R5: 39.063545150501675
 MSRVTT_full_test/t2v_metrics/R10: 51.90635451505017
 MSRVTT_full_test/t2v_metrics/R50: 81.20401337792642
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.85886287625418
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.611676893521373
 MSRVTT_full_test/v2t_metrics/R1: 17.357859531772576
 MSRVTT_full_test/v2t_metrics/R5: 46.020066889632105
 MSRVTT_full_test/v2t_metrics/R10: 60.5685618729097
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.729765886287627
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.43875743148711
 mnt_best       : 30.840370847882145
 not_improved_count: 2
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/trained_model.pth ...
Ckpt loaded at epoch 48.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 14.448160535117056
 t2v_metrics/R5/final_eval: 39.163879598662206
 t2v_metrics/R10/final_eval: 51.83946488294314
 t2v_metrics/R50/final_eval: 80.80267558528428
 t2v_metrics/MedR/final_eval: 10.0
 t2v_metrics/MeanR/final_eval: 45.37123745819398
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 30.840370847882145
 v2t_metrics/R1/final_eval: 17.558528428093645
 v2t_metrics/R5/final_eval: 46.187290969899664
 v2t_metrics/R10/final_eval: 60.36789297658863
 v2t_metrics/R50/final_eval: 86.82274247491638
 v2t_metrics/MedR/final_eval: 6.0
 v2t_metrics/MeanR/final_eval: 31.235785953177256
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 36.58240114964138
Best epoch for the monitored metric: 48
Script took 03h59m06s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L3/trained_model.pth
