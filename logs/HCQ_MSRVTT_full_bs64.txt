Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 649.5171322822571 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 34.05401158332825 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 182.97837901115417 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 163.49362683296204 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch0.pth ...
Done in 15.029s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch0.pth ...
Done in 16.602s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.0
 MSRVTT_full_val/t2v_metrics/R5: 1.2072434607645874
 MSRVTT_full_val/t2v_metrics/R10: 1.6096579476861168
 MSRVTT_full_val/t2v_metrics/R50: 8.450704225352112
 MSRVTT_full_val/t2v_metrics/MedR: 252.0
 MSRVTT_full_val/t2v_metrics/MeanR: 251.21730382293762
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_val/v2t_metrics/R1: 0.0
 MSRVTT_full_val/v2t_metrics/R5: 0.8048289738430584
 MSRVTT_full_val/v2t_metrics/R10: 2.0120724346076457
 MSRVTT_full_val/v2t_metrics/R50: 9.054325955734406
 MSRVTT_full_val/v2t_metrics/MedR: 243.0
 MSRVTT_full_val/v2t_metrics/MeanR: 247.7344064386318
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/t2v_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/t2v_metrics/R5: 0.20066889632107024
 MSRVTT_full_test/t2v_metrics/R10: 0.26755852842809363
 MSRVTT_full_test/t2v_metrics/R50: 1.705685618729097
 MSRVTT_full_test/t2v_metrics/MedR: 1515.0
 MSRVTT_full_test/t2v_metrics/MeanR: 1498.5290969899665
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.12154652794863813
 MSRVTT_full_test/v2t_metrics/R1: 0.06688963210702341
 MSRVTT_full_test/v2t_metrics/R5: 0.16722408026755853
 MSRVTT_full_test/v2t_metrics/R10: 0.3010033444816054
 MSRVTT_full_test/v2t_metrics/R50: 1.806020066889632
 MSRVTT_full_test/v2t_metrics/MedR: 1471.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1495.3264214046824
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.14987975740993859
 mnt_best       : 0.12154652794863813
 not_improved_count: 0
Train Epoch: 1 [1/500 64/32000 (0%)] Loss: 8.43812 (QuantReg: 22.43759) QuantErr: 22.43759 batch_time=27.87996 
Train Epoch: 1 [9/500 576/32000 (2%)] Loss: 7.86671 (QuantReg: 22.45715) QuantErr: 22.45715 batch_time=0.45899 
Train Epoch: 1 [17/500 1088/32000 (3%)] Loss: 7.17673 (QuantReg: 22.54086) QuantErr: 22.54086 batch_time=0.38768 
Train Epoch: 1 [25/500 1600/32000 (5%)] Loss: 6.34603 (QuantReg: 22.56167) QuantErr: 22.56167 batch_time=0.39327 
Train Epoch: 1 [33/500 2112/32000 (7%)] Loss: 6.04188 (QuantReg: 22.62214) QuantErr: 22.62214 batch_time=2.43885 
Train Epoch: 1 [41/500 2624/32000 (8%)] Loss: 5.58680 (QuantReg: 22.61850) QuantErr: 22.61850 batch_time=0.38928 
Train Epoch: 1 [49/500 3136/32000 (10%)] Loss: 5.05479 (QuantReg: 22.61581) QuantErr: 22.61581 batch_time=0.38589 
Train Epoch: 1 [57/500 3648/32000 (11%)] Loss: 5.06972 (QuantReg: 22.63078) QuantErr: 22.63078 batch_time=0.40591 
Train Epoch: 1 [65/500 4160/32000 (13%)] Loss: 4.80396 (QuantReg: 22.68736) QuantErr: 22.68736 batch_time=0.42898 
Train Epoch: 1 [73/500 4672/32000 (15%)] Loss: 5.03449 (QuantReg: 22.61640) QuantErr: 22.61640 batch_time=0.49692 
Train Epoch: 1 [81/500 5184/32000 (16%)] Loss: 4.07466 (QuantReg: 22.64266) QuantErr: 22.64266 batch_time=0.38338 
Train Epoch: 1 [89/500 5696/32000 (18%)] Loss: 4.56333 (QuantReg: 22.64845) QuantErr: 22.64845 batch_time=0.38644 
Train Epoch: 1 [97/500 6208/32000 (19%)] Loss: 4.37364 (QuantReg: 22.65076) QuantErr: 22.65076 batch_time=1.90739 
Train Epoch: 1 [105/500 6720/32000 (21%)] Loss: 4.25968 (QuantReg: 22.68264) QuantErr: 22.68264 batch_time=0.43072 
Train Epoch: 1 [113/500 7232/32000 (23%)] Loss: 4.44467 (QuantReg: 22.69199) QuantErr: 22.69199 batch_time=0.39206 
Train Epoch: 1 [121/500 7744/32000 (24%)] Loss: 4.70315 (QuantReg: 22.66682) QuantErr: 22.66682 batch_time=0.40118 
Train Epoch: 1 [129/500 8256/32000 (26%)] Loss: 3.73010 (QuantReg: 22.64540) QuantErr: 22.64540 batch_time=0.39252 
Train Epoch: 1 [137/500 8768/32000 (27%)] Loss: 4.18199 (QuantReg: 22.67181) QuantErr: 22.67181 batch_time=0.39048 
Train Epoch: 1 [145/500 9280/32000 (29%)] Loss: 4.09839 (QuantReg: 22.64741) QuantErr: 22.64741 batch_time=0.43396 
Train Epoch: 1 [153/500 9792/32000 (31%)] Loss: 3.72685 (QuantReg: 22.61679) QuantErr: 22.61679 batch_time=0.39160 
Train Epoch: 1 [161/500 10304/32000 (32%)] Loss: 4.04095 (QuantReg: 22.66866) QuantErr: 22.66866 batch_time=0.66094 
Train Epoch: 1 [169/500 10816/32000 (34%)] Loss: 3.90190 (QuantReg: 22.62306) QuantErr: 22.62306 batch_time=0.39225 
Train Epoch: 1 [177/500 11328/32000 (35%)] Loss: 3.13213 (QuantReg: 22.63277) QuantErr: 22.63277 batch_time=0.39455 
Train Epoch: 1 [185/500 11840/32000 (37%)] Loss: 4.12965 (QuantReg: 22.66827) QuantErr: 22.66827 batch_time=0.38693 
Train Epoch: 1 [193/500 12352/32000 (39%)] Loss: 3.46408 (QuantReg: 22.69338) QuantErr: 22.69338 batch_time=0.49677 
Train Epoch: 1 [201/500 12864/32000 (40%)] Loss: 3.73195 (QuantReg: 22.67654) QuantErr: 22.67654 batch_time=0.38712 
Train Epoch: 1 [209/500 13376/32000 (42%)] Loss: 4.35894 (QuantReg: 22.64442) QuantErr: 22.64442 batch_time=0.40131 
Train Epoch: 1 [217/500 13888/32000 (43%)] Loss: 3.63338 (QuantReg: 22.69431) QuantErr: 22.69431 batch_time=0.42981 
Train Epoch: 1 [225/500 14400/32000 (45%)] Loss: 3.52637 (QuantReg: 22.68792) QuantErr: 22.68792 batch_time=0.40458 
Train Epoch: 1 [233/500 14912/32000 (47%)] Loss: 3.89610 (QuantReg: 22.65108) QuantErr: 22.65108 batch_time=0.43784 
Train Epoch: 1 [241/500 15424/32000 (48%)] Loss: 3.17873 (QuantReg: 22.68122) QuantErr: 22.68122 batch_time=0.40678 
Train Epoch: 1 [249/500 15936/32000 (50%)] Loss: 3.41487 (QuantReg: 22.65787) QuantErr: 22.65787 batch_time=0.39149 
Train Epoch: 1 [257/500 16448/32000 (51%)] Loss: 3.65602 (QuantReg: 22.71299) QuantErr: 22.71299 batch_time=0.40272 
Train Epoch: 1 [265/500 16960/32000 (53%)] Loss: 3.29337 (QuantReg: 22.69943) QuantErr: 22.69943 batch_time=0.40049 
Train Epoch: 1 [273/500 17472/32000 (55%)] Loss: 2.98783 (QuantReg: 22.60728) QuantErr: 22.60728 batch_time=0.50104 
Train Epoch: 1 [281/500 17984/32000 (56%)] Loss: 3.19987 (QuantReg: 22.72689) QuantErr: 22.72689 batch_time=0.40222 
Train Epoch: 1 [289/500 18496/32000 (58%)] Loss: 2.75551 (QuantReg: 22.61244) QuantErr: 22.61244 batch_time=0.40087 
Train Epoch: 1 [297/500 19008/32000 (59%)] Loss: 3.88758 (QuantReg: 22.68275) QuantErr: 22.68275 batch_time=0.39273 
Train Epoch: 1 [305/500 19520/32000 (61%)] Loss: 2.78415 (QuantReg: 22.66384) QuantErr: 22.66384 batch_time=0.41084 
Train Epoch: 1 [313/500 20032/32000 (63%)] Loss: 3.10222 (QuantReg: 22.70513) QuantErr: 22.70513 batch_time=0.39195 
Train Epoch: 1 [321/500 20544/32000 (64%)] Loss: 3.43994 (QuantReg: 22.67940) QuantErr: 22.67940 batch_time=0.39041 
Train Epoch: 1 [329/500 21056/32000 (66%)] Loss: 3.06995 (QuantReg: 22.73015) QuantErr: 22.73015 batch_time=0.40382 
Train Epoch: 1 [337/500 21568/32000 (67%)] Loss: 4.04827 (QuantReg: 22.66801) QuantErr: 22.66801 batch_time=0.43552 
Train Epoch: 1 [345/500 22080/32000 (69%)] Loss: 3.56386 (QuantReg: 22.63121) QuantErr: 22.63121 batch_time=0.39125 
Train Epoch: 1 [353/500 22592/32000 (71%)] Loss: 3.06678 (QuantReg: 22.68566) QuantErr: 22.68566 batch_time=0.39495 
Train Epoch: 1 [361/500 23104/32000 (72%)] Loss: 2.81924 (QuantReg: 22.70088) QuantErr: 22.70088 batch_time=0.40698 
Train Epoch: 1 [369/500 23616/32000 (74%)] Loss: 3.25984 (QuantReg: 22.64950) QuantErr: 22.64950 batch_time=0.39665 
Train Epoch: 1 [377/500 24128/32000 (75%)] Loss: 3.10946 (QuantReg: 22.67654) QuantErr: 22.67654 batch_time=0.39715 
Train Epoch: 1 [385/500 24640/32000 (77%)] Loss: 3.22354 (QuantReg: 22.67923) QuantErr: 22.67923 batch_time=0.43401 
Train Epoch: 1 [393/500 25152/32000 (79%)] Loss: 3.39545 (QuantReg: 22.71891) QuantErr: 22.71891 batch_time=0.39396 
Train Epoch: 1 [401/500 25664/32000 (80%)] Loss: 3.14739 (QuantReg: 22.70868) QuantErr: 22.70868 batch_time=0.38997 
Train Epoch: 1 [409/500 26176/32000 (82%)] Loss: 2.59390 (QuantReg: 22.63985) QuantErr: 22.63985 batch_time=0.40841 
Train Epoch: 1 [417/500 26688/32000 (83%)] Loss: 3.91234 (QuantReg: 22.68909) QuantErr: 22.68909 batch_time=0.40390 
Train Epoch: 1 [425/500 27200/32000 (85%)] Loss: 2.61363 (QuantReg: 22.64343) QuantErr: 22.64343 batch_time=0.41446 
Train Epoch: 1 [433/500 27712/32000 (87%)] Loss: 2.49760 (QuantReg: 22.68137) QuantErr: 22.68137 batch_time=0.40178 
Train Epoch: 1 [441/500 28224/32000 (88%)] Loss: 2.83490 (QuantReg: 22.62788) QuantErr: 22.62788 batch_time=0.39304 
Train Epoch: 1 [449/500 28736/32000 (90%)] Loss: 2.76408 (QuantReg: 22.65774) QuantErr: 22.65774 batch_time=0.39722 
Train Epoch: 1 [457/500 29248/32000 (91%)] Loss: 2.57579 (QuantReg: 22.61464) QuantErr: 22.61464 batch_time=0.39048 
Train Epoch: 1 [465/500 29760/32000 (93%)] Loss: 3.44080 (QuantReg: 22.59327) QuantErr: 22.59327 batch_time=0.40418 
Train Epoch: 1 [473/500 30272/32000 (95%)] Loss: 2.35722 (QuantReg: 22.71026) QuantErr: 22.71026 batch_time=0.41946 
Train Epoch: 1 [481/500 30784/32000 (96%)] Loss: 2.91950 (QuantReg: 22.67534) QuantErr: 22.67534 batch_time=0.39290 
Train Epoch: 1 [489/500 31296/32000 (98%)] Loss: 2.89775 (QuantReg: 22.61932) QuantErr: 22.61932 batch_time=0.40013 
Train Epoch: 1 [497/500 31808/32000 (99%)] Loss: 2.72798 (QuantReg: 22.67437) QuantErr: 22.67437 batch_time=0.39619 
Train Epoch: 1 codebook_update_time=2.75309
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch1.pth ...
Done in 4.361s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch1.pth ...
Done in 9.485s
 epoch          : 1
 loss           : 3.849457883834839
 quant_reg      : 22.65250672531128
 quant_err      : 22.65250672531128
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 19.3158953722334
 MSRVTT_full_val/t2v_metrics/R5: 54.32595573440644
 MSRVTT_full_val/t2v_metrics/R10: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R50: 94.96981891348088
 MSRVTT_full_val/t2v_metrics/MedR: 5.0
 MSRVTT_full_val/t2v_metrics/MeanR: 13.195171026156942
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 41.64191043098871
 MSRVTT_full_val/v2t_metrics/R1: 20.120724346076457
 MSRVTT_full_val/v2t_metrics/R5: 58.14889336016097
 MSRVTT_full_val/v2t_metrics/R10: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R50: 94.76861167002012
 MSRVTT_full_val/v2t_metrics/MedR: 4.0
 MSRVTT_full_val/v2t_metrics/MeanR: 12.587525150905433
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 44.407590084736555
 MSRVTT_full_test/t2v_metrics/R1: 6.722408026755853
 MSRVTT_full_test/t2v_metrics/R5: 22.34113712374582
 MSRVTT_full_test/t2v_metrics/R10: 33.17725752508361
 MSRVTT_full_test/t2v_metrics/R50: 67.85953177257525
 MSRVTT_full_test/t2v_metrics/MedR: 22.0
 MSRVTT_full_test/t2v_metrics/MeanR: 67.31605351170569
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 17.08009213323801
 MSRVTT_full_test/v2t_metrics/R1: 7.792642140468227
 MSRVTT_full_test/v2t_metrics/R5: 25.016722408026755
 MSRVTT_full_test/v2t_metrics/R10: 37.69230769230769
 MSRVTT_full_test/v2t_metrics/R50: 71.87290969899665
 MSRVTT_full_test/v2t_metrics/MedR: 19.0
 MSRVTT_full_test/v2t_metrics/MeanR: 61.93277591973244
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 19.44118009107646
 mnt_best       : 17.08009213323801
 not_improved_count: 0
Train Epoch: 2 [1/500 64/32000 (0%)] Loss: 2.53605 (QuantReg: 11.63172) QuantErr: 11.63172 batch_time=29.86650 
Train Epoch: 2 [9/500 576/32000 (2%)] Loss: 2.65572 (QuantReg: 11.63410) QuantErr: 11.63410 batch_time=0.39064 
Train Epoch: 2 [17/500 1088/32000 (3%)] Loss: 2.62144 (QuantReg: 12.11064) QuantErr: 12.11064 batch_time=0.40844 
Train Epoch: 2 [25/500 1600/32000 (5%)] Loss: 2.90449 (QuantReg: 11.86863) QuantErr: 11.86863 batch_time=0.39697 
Train Epoch: 2 [33/500 2112/32000 (7%)] Loss: 2.87888 (QuantReg: 11.74395) QuantErr: 11.74395 batch_time=0.40302 
Train Epoch: 2 [41/500 2624/32000 (8%)] Loss: 3.07237 (QuantReg: 12.29843) QuantErr: 12.29843 batch_time=0.39783 
Train Epoch: 2 [49/500 3136/32000 (10%)] Loss: 3.59839 (QuantReg: 12.63230) QuantErr: 12.63230 batch_time=0.39187 
Train Epoch: 2 [57/500 3648/32000 (11%)] Loss: 2.03922 (QuantReg: 12.33534) QuantErr: 12.33534 batch_time=0.38698 
Train Epoch: 2 [65/500 4160/32000 (13%)] Loss: 2.90109 (QuantReg: 12.04460) QuantErr: 12.04460 batch_time=0.40366 
Train Epoch: 2 [73/500 4672/32000 (15%)] Loss: 2.64196 (QuantReg: 12.23916) QuantErr: 12.23916 batch_time=0.42171 
Train Epoch: 2 [81/500 5184/32000 (16%)] Loss: 2.43274 (QuantReg: 11.86896) QuantErr: 11.86896 batch_time=0.39732 
Train Epoch: 2 [89/500 5696/32000 (18%)] Loss: 3.05322 (QuantReg: 12.15937) QuantErr: 12.15937 batch_time=0.39606 
Train Epoch: 2 [97/500 6208/32000 (19%)] Loss: 2.94253 (QuantReg: 12.30458) QuantErr: 12.30458 batch_time=0.39852 
Train Epoch: 2 [105/500 6720/32000 (21%)] Loss: 2.73018 (QuantReg: 12.05891) QuantErr: 12.05891 batch_time=0.39027 
Train Epoch: 2 [113/500 7232/32000 (23%)] Loss: 2.41126 (QuantReg: 12.72122) QuantErr: 12.72122 batch_time=0.43747 
Train Epoch: 2 [121/500 7744/32000 (24%)] Loss: 2.63221 (QuantReg: 12.45748) QuantErr: 12.45748 batch_time=0.39216 
Train Epoch: 2 [129/500 8256/32000 (26%)] Loss: 2.51456 (QuantReg: 12.31284) QuantErr: 12.31284 batch_time=0.39730 
Train Epoch: 2 [137/500 8768/32000 (27%)] Loss: 2.95940 (QuantReg: 12.79674) QuantErr: 12.79674 batch_time=0.41175 
Train Epoch: 2 [145/500 9280/32000 (29%)] Loss: 2.21811 (QuantReg: 12.76750) QuantErr: 12.76750 batch_time=0.44208 
Train Epoch: 2 [153/500 9792/32000 (31%)] Loss: 2.70480 (QuantReg: 12.50456) QuantErr: 12.50456 batch_time=0.38894 
Train Epoch: 2 [161/500 10304/32000 (32%)] Loss: 1.76672 (QuantReg: 12.85682) QuantErr: 12.85682 batch_time=0.39970 
Train Epoch: 2 [169/500 10816/32000 (34%)] Loss: 3.08564 (QuantReg: 13.06790) QuantErr: 13.06790 batch_time=0.39517 
Train Epoch: 2 [177/500 11328/32000 (35%)] Loss: 2.73130 (QuantReg: 13.19134) QuantErr: 13.19134 batch_time=0.39277 
Train Epoch: 2 [185/500 11840/32000 (37%)] Loss: 2.36597 (QuantReg: 13.34442) QuantErr: 13.34442 batch_time=0.39032 
Train Epoch: 2 [193/500 12352/32000 (39%)] Loss: 2.02484 (QuantReg: 13.20122) QuantErr: 13.20122 batch_time=0.38541 
Train Epoch: 2 [201/500 12864/32000 (40%)] Loss: 2.49385 (QuantReg: 14.01521) QuantErr: 14.01521 batch_time=0.39422 
Train Epoch: 2 [209/500 13376/32000 (42%)] Loss: 2.32300 (QuantReg: 13.56448) QuantErr: 13.56448 batch_time=0.38705 
Train Epoch: 2 [217/500 13888/32000 (43%)] Loss: 2.85885 (QuantReg: 13.30222) QuantErr: 13.30222 batch_time=0.39559 
Train Epoch: 2 [225/500 14400/32000 (45%)] Loss: 2.49944 (QuantReg: 13.31543) QuantErr: 13.31543 batch_time=0.42000 
Train Epoch: 2 [233/500 14912/32000 (47%)] Loss: 2.39026 (QuantReg: 13.56131) QuantErr: 13.56131 batch_time=0.63560 
Train Epoch: 2 [241/500 15424/32000 (48%)] Loss: 3.05074 (QuantReg: 13.24188) QuantErr: 13.24188 batch_time=0.38901 
Train Epoch: 2 [249/500 15936/32000 (50%)] Loss: 3.23537 (QuantReg: 12.98922) QuantErr: 12.98922 batch_time=0.39870 
Train Epoch: 2 [257/500 16448/32000 (51%)] Loss: 2.72793 (QuantReg: 13.34555) QuantErr: 13.34555 batch_time=0.40146 
Train Epoch: 2 [265/500 16960/32000 (53%)] Loss: 2.15982 (QuantReg: 13.60440) QuantErr: 13.60440 batch_time=0.40925 
Train Epoch: 2 [273/500 17472/32000 (55%)] Loss: 2.23662 (QuantReg: 13.60143) QuantErr: 13.60143 batch_time=0.39668 
Train Epoch: 2 [281/500 17984/32000 (56%)] Loss: 2.97562 (QuantReg: 13.46586) QuantErr: 13.46586 batch_time=0.39510 
Train Epoch: 2 [289/500 18496/32000 (58%)] Loss: 2.10177 (QuantReg: 13.60669) QuantErr: 13.60669 batch_time=0.40311 
Train Epoch: 2 [297/500 19008/32000 (59%)] Loss: 2.34748 (QuantReg: 13.60603) QuantErr: 13.60603 batch_time=0.39944 
Train Epoch: 2 [305/500 19520/32000 (61%)] Loss: 2.29499 (QuantReg: 13.35366) QuantErr: 13.35366 batch_time=0.42528 
Train Epoch: 2 [313/500 20032/32000 (63%)] Loss: 2.88125 (QuantReg: 13.33046) QuantErr: 13.33046 batch_time=0.42345 
Train Epoch: 2 [321/500 20544/32000 (64%)] Loss: 2.26759 (QuantReg: 13.92188) QuantErr: 13.92188 batch_time=0.40381 
Train Epoch: 2 [329/500 21056/32000 (66%)] Loss: 2.04968 (QuantReg: 13.61777) QuantErr: 13.61777 batch_time=0.40090 
Train Epoch: 2 [337/500 21568/32000 (67%)] Loss: 2.24272 (QuantReg: 14.08984) QuantErr: 14.08984 batch_time=0.43528 
Train Epoch: 2 [345/500 22080/32000 (69%)] Loss: 2.45271 (QuantReg: 13.60779) QuantErr: 13.60779 batch_time=0.39856 
Train Epoch: 2 [353/500 22592/32000 (71%)] Loss: 2.54965 (QuantReg: 14.12436) QuantErr: 14.12436 batch_time=0.40204 
Train Epoch: 2 [361/500 23104/32000 (72%)] Loss: 2.31628 (QuantReg: 14.35352) QuantErr: 14.35352 batch_time=0.39221 
Train Epoch: 2 [369/500 23616/32000 (74%)] Loss: 2.22895 (QuantReg: 13.74874) QuantErr: 13.74874 batch_time=0.38267 
Train Epoch: 2 [377/500 24128/32000 (75%)] Loss: 2.44795 (QuantReg: 14.07456) QuantErr: 14.07456 batch_time=0.39238 
Train Epoch: 2 [385/500 24640/32000 (77%)] Loss: 2.52951 (QuantReg: 13.97346) QuantErr: 13.97346 batch_time=0.40466 
Train Epoch: 2 [393/500 25152/32000 (79%)] Loss: 2.02496 (QuantReg: 13.97087) QuantErr: 13.97087 batch_time=0.40363 
Train Epoch: 2 [401/500 25664/32000 (80%)] Loss: 2.53389 (QuantReg: 13.51935) QuantErr: 13.51935 batch_time=0.47465 
Train Epoch: 2 [409/500 26176/32000 (82%)] Loss: 2.55643 (QuantReg: 14.07141) QuantErr: 14.07141 batch_time=0.43868 
Train Epoch: 2 [417/500 26688/32000 (83%)] Loss: 2.21421 (QuantReg: 14.07287) QuantErr: 14.07287 batch_time=0.41080 
Train Epoch: 2 [425/500 27200/32000 (85%)] Loss: 2.49372 (QuantReg: 13.97935) QuantErr: 13.97935 batch_time=0.40241 
Train Epoch: 2 [433/500 27712/32000 (87%)] Loss: 1.98306 (QuantReg: 14.05542) QuantErr: 14.05542 batch_time=0.39267 
Train Epoch: 2 [441/500 28224/32000 (88%)] Loss: 2.95604 (QuantReg: 13.92814) QuantErr: 13.92814 batch_time=0.40508 
Train Epoch: 2 [449/500 28736/32000 (90%)] Loss: 2.12576 (QuantReg: 14.23887) QuantErr: 14.23887 batch_time=0.40700 
Train Epoch: 2 [457/500 29248/32000 (91%)] Loss: 2.25334 (QuantReg: 14.17091) QuantErr: 14.17091 batch_time=0.43724 
Train Epoch: 2 [465/500 29760/32000 (93%)] Loss: 2.74878 (QuantReg: 14.38042) QuantErr: 14.38042 batch_time=0.39757 
Train Epoch: 2 [473/500 30272/32000 (95%)] Loss: 2.00447 (QuantReg: 14.20713) QuantErr: 14.20713 batch_time=0.41819 
Train Epoch: 2 [481/500 30784/32000 (96%)] Loss: 2.22458 (QuantReg: 14.07179) QuantErr: 14.07179 batch_time=0.39057 
Train Epoch: 2 [489/500 31296/32000 (98%)] Loss: 2.14161 (QuantReg: 14.71571) QuantErr: 14.71571 batch_time=0.44881 
Train Epoch: 2 [497/500 31808/32000 (99%)] Loss: 1.81142 (QuantReg: 14.52993) QuantErr: 14.52993 batch_time=0.40740 
Train Epoch: 2 codebook_update_time=2.41499
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch2.pth ...
Done in 21.615s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch2.pth ...
Done in 25.614s
removing stale ckpt [epoch 1] [took 0.00s]
removing stale ckpt [epoch 0] [took 0.00s]
 epoch          : 2
 loss           : 2.5091844520568847
 quant_reg      : 13.311342796325684
 quant_err      : 13.311342796325684
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 19.718309859154928
 MSRVTT_full_val/t2v_metrics/R5: 57.142857142857146
 MSRVTT_full_val/t2v_metrics/R10: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R50: 96.37826961770624
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 11.849094567404427
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 43.296496852473936
 MSRVTT_full_val/v2t_metrics/R1: 25.35211267605634
 MSRVTT_full_val/v2t_metrics/R5: 62.17303822937626
 MSRVTT_full_val/v2t_metrics/R10: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R50: 95.97585513078471
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 10.509054325955734
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 49.351424112964175
 MSRVTT_full_test/t2v_metrics/R1: 8.361204013377927
 MSRVTT_full_test/t2v_metrics/R5: 25.016722408026755
 MSRVTT_full_test/t2v_metrics/R10: 37.25752508361204
 MSRVTT_full_test/t2v_metrics/R50: 73.17725752508362
 MSRVTT_full_test/t2v_metrics/MedR: 18.0
 MSRVTT_full_test/t2v_metrics/MeanR: 57.824414715719065
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 19.82612062374619
 MSRVTT_full_test/v2t_metrics/R1: 9.297658862876254
 MSRVTT_full_test/v2t_metrics/R5: 28.762541806020067
 MSRVTT_full_test/v2t_metrics/R10: 41.77257525083612
 MSRVTT_full_test/v2t_metrics/R50: 77.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 15.0
 MSRVTT_full_test/v2t_metrics/MeanR: 49.81973244147157
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 22.35445262825209
 mnt_best       : 19.82612062374619
 not_improved_count: 0
Train Epoch: 3 [1/500 64/32000 (0%)] Loss: 2.25649 (QuantReg: 11.82912) QuantErr: 11.82912 batch_time=28.47623 
Train Epoch: 3 [9/500 576/32000 (2%)] Loss: 2.02672 (QuantReg: 11.74582) QuantErr: 11.74582 batch_time=0.39523 
Train Epoch: 3 [17/500 1088/32000 (3%)] Loss: 2.04886 (QuantReg: 11.94289) QuantErr: 11.94289 batch_time=0.39664 
Train Epoch: 3 [25/500 1600/32000 (5%)] Loss: 1.58702 (QuantReg: 12.15829) QuantErr: 12.15829 batch_time=0.40124 
Train Epoch: 3 [33/500 2112/32000 (7%)] Loss: 2.03333 (QuantReg: 12.12302) QuantErr: 12.12302 batch_time=0.43743 
Train Epoch: 3 [41/500 2624/32000 (8%)] Loss: 2.11203 (QuantReg: 12.22991) QuantErr: 12.22991 batch_time=0.39017 
Train Epoch: 3 [49/500 3136/32000 (10%)] Loss: 2.19472 (QuantReg: 12.49193) QuantErr: 12.49193 batch_time=0.40780 
Train Epoch: 3 [57/500 3648/32000 (11%)] Loss: 1.87017 (QuantReg: 11.79900) QuantErr: 11.79900 batch_time=0.38439 
Train Epoch: 3 [65/500 4160/32000 (13%)] Loss: 2.26375 (QuantReg: 12.29614) QuantErr: 12.29614 batch_time=0.73775 
Train Epoch: 3 [73/500 4672/32000 (15%)] Loss: 1.49701 (QuantReg: 11.49531) QuantErr: 11.49531 batch_time=0.43055 
Train Epoch: 3 [81/500 5184/32000 (16%)] Loss: 2.67945 (QuantReg: 12.21346) QuantErr: 12.21346 batch_time=0.40031 
Train Epoch: 3 [89/500 5696/32000 (18%)] Loss: 2.14983 (QuantReg: 12.39651) QuantErr: 12.39651 batch_time=0.38607 
Train Epoch: 3 [97/500 6208/32000 (19%)] Loss: 2.10773 (QuantReg: 12.17273) QuantErr: 12.17273 batch_time=0.42984 
Train Epoch: 3 [105/500 6720/32000 (21%)] Loss: 2.13538 (QuantReg: 12.10429) QuantErr: 12.10429 batch_time=0.43298 
Train Epoch: 3 [113/500 7232/32000 (23%)] Loss: 1.91849 (QuantReg: 12.23803) QuantErr: 12.23803 batch_time=0.39522 
Train Epoch: 3 [121/500 7744/32000 (24%)] Loss: 2.16711 (QuantReg: 12.49025) QuantErr: 12.49025 batch_time=0.41638 
Train Epoch: 3 [129/500 8256/32000 (26%)] Loss: 2.19637 (QuantReg: 12.55766) QuantErr: 12.55766 batch_time=0.75136 
Train Epoch: 3 [137/500 8768/32000 (27%)] Loss: 1.66317 (QuantReg: 12.30215) QuantErr: 12.30215 batch_time=0.39192 
Train Epoch: 3 [145/500 9280/32000 (29%)] Loss: 2.66310 (QuantReg: 12.43555) QuantErr: 12.43555 batch_time=0.38893 
Train Epoch: 3 [153/500 9792/32000 (31%)] Loss: 2.22288 (QuantReg: 12.37793) QuantErr: 12.37793 batch_time=0.39342 
Train Epoch: 3 [161/500 10304/32000 (32%)] Loss: 2.33422 (QuantReg: 12.41948) QuantErr: 12.41948 batch_time=0.40362 
Train Epoch: 3 [169/500 10816/32000 (34%)] Loss: 2.75066 (QuantReg: 12.85815) QuantErr: 12.85815 batch_time=0.40331 
Train Epoch: 3 [177/500 11328/32000 (35%)] Loss: 2.19557 (QuantReg: 12.33459) QuantErr: 12.33459 batch_time=0.41632 
Train Epoch: 3 [185/500 11840/32000 (37%)] Loss: 2.46144 (QuantReg: 12.64014) QuantErr: 12.64014 batch_time=0.39043 
Train Epoch: 3 [193/500 12352/32000 (39%)] Loss: 2.00284 (QuantReg: 12.50689) QuantErr: 12.50689 batch_time=0.39243 
Train Epoch: 3 [201/500 12864/32000 (40%)] Loss: 3.04268 (QuantReg: 12.63590) QuantErr: 12.63590 batch_time=0.40001 
Train Epoch: 3 [209/500 13376/32000 (42%)] Loss: 1.99925 (QuantReg: 12.50186) QuantErr: 12.50186 batch_time=0.39684 
Train Epoch: 3 [217/500 13888/32000 (43%)] Loss: 1.76716 (QuantReg: 12.50002) QuantErr: 12.50002 batch_time=0.42863 
Train Epoch: 3 [225/500 14400/32000 (45%)] Loss: 1.82578 (QuantReg: 12.37822) QuantErr: 12.37822 batch_time=0.43315 
Train Epoch: 3 [233/500 14912/32000 (47%)] Loss: 2.12395 (QuantReg: 12.65936) QuantErr: 12.65936 batch_time=0.40304 
Train Epoch: 3 [241/500 15424/32000 (48%)] Loss: 1.87409 (QuantReg: 12.52458) QuantErr: 12.52458 batch_time=0.38502 
Train Epoch: 3 [249/500 15936/32000 (50%)] Loss: 1.55831 (QuantReg: 12.55218) QuantErr: 12.55218 batch_time=0.38903 
Train Epoch: 3 [257/500 16448/32000 (51%)] Loss: 1.98979 (QuantReg: 12.68942) QuantErr: 12.68942 batch_time=0.40500 
Train Epoch: 3 [265/500 16960/32000 (53%)] Loss: 2.74933 (QuantReg: 12.63388) QuantErr: 12.63388 batch_time=0.40053 
Train Epoch: 3 [273/500 17472/32000 (55%)] Loss: 1.97571 (QuantReg: 12.79188) QuantErr: 12.79188 batch_time=0.39243 
Train Epoch: 3 [281/500 17984/32000 (56%)] Loss: 1.82893 (QuantReg: 12.81462) QuantErr: 12.81462 batch_time=0.39274 
Train Epoch: 3 [289/500 18496/32000 (58%)] Loss: 1.38237 (QuantReg: 13.03939) QuantErr: 13.03939 batch_time=0.39666 
Train Epoch: 3 [297/500 19008/32000 (59%)] Loss: 2.17999 (QuantReg: 13.21073) QuantErr: 13.21073 batch_time=0.39726 
Train Epoch: 3 [305/500 19520/32000 (61%)] Loss: 1.83722 (QuantReg: 12.79434) QuantErr: 12.79434 batch_time=0.39872 
Train Epoch: 3 [313/500 20032/32000 (63%)] Loss: 2.57090 (QuantReg: 12.82205) QuantErr: 12.82205 batch_time=0.39420 
Train Epoch: 3 [321/500 20544/32000 (64%)] Loss: 2.29722 (QuantReg: 12.69314) QuantErr: 12.69314 batch_time=0.39870 
Train Epoch: 3 [329/500 21056/32000 (66%)] Loss: 2.03968 (QuantReg: 12.81554) QuantErr: 12.81554 batch_time=0.42395 
Train Epoch: 3 [337/500 21568/32000 (67%)] Loss: 2.26037 (QuantReg: 12.97324) QuantErr: 12.97324 batch_time=0.39173 
Train Epoch: 3 [345/500 22080/32000 (69%)] Loss: 2.65350 (QuantReg: 13.11128) QuantErr: 13.11128 batch_time=0.39462 
Train Epoch: 3 [353/500 22592/32000 (71%)] Loss: 1.90708 (QuantReg: 12.92290) QuantErr: 12.92290 batch_time=0.40037 
Train Epoch: 3 [361/500 23104/32000 (72%)] Loss: 1.88691 (QuantReg: 13.13088) QuantErr: 13.13088 batch_time=0.39127 
Train Epoch: 3 [369/500 23616/32000 (74%)] Loss: 1.66741 (QuantReg: 13.54965) QuantErr: 13.54965 batch_time=0.39292 
Train Epoch: 3 [377/500 24128/32000 (75%)] Loss: 2.17326 (QuantReg: 12.83577) QuantErr: 12.83577 batch_time=0.40860 
Train Epoch: 3 [385/500 24640/32000 (77%)] Loss: 1.53834 (QuantReg: 13.42226) QuantErr: 13.42226 batch_time=0.39369 
Train Epoch: 3 [393/500 25152/32000 (79%)] Loss: 1.55599 (QuantReg: 13.71889) QuantErr: 13.71889 batch_time=0.39962 
Train Epoch: 3 [401/500 25664/32000 (80%)] Loss: 2.16720 (QuantReg: 12.94922) QuantErr: 12.94922 batch_time=0.41815 
Train Epoch: 3 [409/500 26176/32000 (82%)] Loss: 1.84963 (QuantReg: 12.96148) QuantErr: 12.96148 batch_time=0.46212 
Train Epoch: 3 [417/500 26688/32000 (83%)] Loss: 2.41941 (QuantReg: 13.45395) QuantErr: 13.45395 batch_time=0.39260 
Train Epoch: 3 [425/500 27200/32000 (85%)] Loss: 1.93016 (QuantReg: 13.23715) QuantErr: 13.23715 batch_time=0.39962 
Train Epoch: 3 [433/500 27712/32000 (87%)] Loss: 1.72406 (QuantReg: 13.14350) QuantErr: 13.14350 batch_time=0.41512 
Train Epoch: 3 [441/500 28224/32000 (88%)] Loss: 2.34867 (QuantReg: 13.04842) QuantErr: 13.04842 batch_time=0.40287 
Train Epoch: 3 [449/500 28736/32000 (90%)] Loss: 1.73906 (QuantReg: 13.45788) QuantErr: 13.45788 batch_time=0.39435 
Train Epoch: 3 [457/500 29248/32000 (91%)] Loss: 1.62633 (QuantReg: 13.25621) QuantErr: 13.25621 batch_time=0.38605 
Train Epoch: 3 [465/500 29760/32000 (93%)] Loss: 1.73384 (QuantReg: 13.39483) QuantErr: 13.39483 batch_time=0.39267 
Train Epoch: 3 [473/500 30272/32000 (95%)] Loss: 1.84466 (QuantReg: 13.41760) QuantErr: 13.41760 batch_time=0.41552 
Train Epoch: 3 [481/500 30784/32000 (96%)] Loss: 1.52981 (QuantReg: 13.11084) QuantErr: 13.11084 batch_time=0.42812 
Train Epoch: 3 [489/500 31296/32000 (98%)] Loss: 1.38983 (QuantReg: 13.54920) QuantErr: 13.54920 batch_time=0.39776 
Train Epoch: 3 [497/500 31808/32000 (99%)] Loss: 1.69949 (QuantReg: 13.82477) QuantErr: 13.82477 batch_time=0.39960 
Train Epoch: 3 codebook_update_time=2.38272
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch3.pth ...
Done in 5.490s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch3.pth ...
Done in 10.518s
removing stale ckpt [epoch 2] [took 0.01s]
 epoch          : 3
 loss           : 2.053936599731445
 quant_reg      : 12.738394086837769
 quant_err      : 12.738394086837769
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 24.14486921529175
 MSRVTT_full_val/t2v_metrics/R5: 61.3682092555332
 MSRVTT_full_val/t2v_metrics/R10: 74.64788732394366
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.619718309859154
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 48.00228851771536
 MSRVTT_full_val/v2t_metrics/R1: 31.187122736418512
 MSRVTT_full_val/v2t_metrics/R5: 66.39839034205231
 MSRVTT_full_val/v2t_metrics/R10: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.837022132796781
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 54.985703916158485
 MSRVTT_full_test/t2v_metrics/R1: 9.397993311036789
 MSRVTT_full_test/t2v_metrics/R5: 28.896321070234112
 MSRVTT_full_test/t2v_metrics/R10: 40.60200668896321
 MSRVTT_full_test/t2v_metrics/R50: 75.18394648829431
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 54.65183946488294
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.257432316308563
 MSRVTT_full_test/v2t_metrics/R1: 10.501672240802675
 MSRVTT_full_test/v2t_metrics/R5: 32.675585284280935
 MSRVTT_full_test/v2t_metrics/R10: 46.35451505016722
 MSRVTT_full_test/v2t_metrics/R50: 80.80267558528428
 MSRVTT_full_test/v2t_metrics/MedR: 12.0
 MSRVTT_full_test/v2t_metrics/MeanR: 45.80434782608695
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.149226120197923
 mnt_best       : 22.257432316308563
 not_improved_count: 0
Train Epoch: 4 [1/500 64/32000 (0%)] Loss: 1.75184 (QuantReg: 12.32118) QuantErr: 12.32118 batch_time=31.22708 
Train Epoch: 4 [9/500 576/32000 (2%)] Loss: 2.78752 (QuantReg: 12.10580) QuantErr: 12.10580 batch_time=0.40614 
Train Epoch: 4 [17/500 1088/32000 (3%)] Loss: 2.30530 (QuantReg: 12.06200) QuantErr: 12.06200 batch_time=0.40101 
Train Epoch: 4 [25/500 1600/32000 (5%)] Loss: 1.87462 (QuantReg: 12.04039) QuantErr: 12.04039 batch_time=0.44210 
Train Epoch: 4 [33/500 2112/32000 (7%)] Loss: 1.93882 (QuantReg: 12.28127) QuantErr: 12.28127 batch_time=0.38623 
Train Epoch: 4 [41/500 2624/32000 (8%)] Loss: 2.08572 (QuantReg: 12.16413) QuantErr: 12.16413 batch_time=0.85170 
Train Epoch: 4 [49/500 3136/32000 (10%)] Loss: 1.40285 (QuantReg: 12.51955) QuantErr: 12.51955 batch_time=0.39086 
Train Epoch: 4 [57/500 3648/32000 (11%)] Loss: 2.75910 (QuantReg: 11.76770) QuantErr: 11.76770 batch_time=0.40046 
Train Epoch: 4 [65/500 4160/32000 (13%)] Loss: 1.58656 (QuantReg: 12.27555) QuantErr: 12.27555 batch_time=1.00272 
Train Epoch: 4 [73/500 4672/32000 (15%)] Loss: 1.84999 (QuantReg: 12.26431) QuantErr: 12.26431 batch_time=0.39449 
Train Epoch: 4 [81/500 5184/32000 (16%)] Loss: 1.85780 (QuantReg: 12.29288) QuantErr: 12.29288 batch_time=0.40724 
Train Epoch: 4 [89/500 5696/32000 (18%)] Loss: 1.65569 (QuantReg: 12.29228) QuantErr: 12.29228 batch_time=0.39394 
Train Epoch: 4 [97/500 6208/32000 (19%)] Loss: 1.77152 (QuantReg: 11.76648) QuantErr: 11.76648 batch_time=0.38227 
Train Epoch: 4 [105/500 6720/32000 (21%)] Loss: 1.22797 (QuantReg: 12.19668) QuantErr: 12.19668 batch_time=1.02913 
Train Epoch: 4 [113/500 7232/32000 (23%)] Loss: 1.69009 (QuantReg: 12.70263) QuantErr: 12.70263 batch_time=0.38684 
Train Epoch: 4 [121/500 7744/32000 (24%)] Loss: 1.68382 (QuantReg: 12.12011) QuantErr: 12.12011 batch_time=0.42795 
Train Epoch: 4 [129/500 8256/32000 (26%)] Loss: 1.57485 (QuantReg: 12.67229) QuantErr: 12.67229 batch_time=1.04039 
Train Epoch: 4 [137/500 8768/32000 (27%)] Loss: 1.92329 (QuantReg: 12.43384) QuantErr: 12.43384 batch_time=0.40283 
Train Epoch: 4 [145/500 9280/32000 (29%)] Loss: 1.53394 (QuantReg: 12.70564) QuantErr: 12.70564 batch_time=0.39843 
Train Epoch: 4 [153/500 9792/32000 (31%)] Loss: 1.79072 (QuantReg: 12.96934) QuantErr: 12.96934 batch_time=0.40073 
Train Epoch: 4 [161/500 10304/32000 (32%)] Loss: 1.66194 (QuantReg: 12.50966) QuantErr: 12.50966 batch_time=0.40184 
Train Epoch: 4 [169/500 10816/32000 (34%)] Loss: 1.62762 (QuantReg: 13.23319) QuantErr: 13.23319 batch_time=1.04397 
Train Epoch: 4 [177/500 11328/32000 (35%)] Loss: 1.80753 (QuantReg: 12.92026) QuantErr: 12.92026 batch_time=0.38684 
Train Epoch: 4 [185/500 11840/32000 (37%)] Loss: 1.83017 (QuantReg: 12.58231) QuantErr: 12.58231 batch_time=0.38970 
Train Epoch: 4 [193/500 12352/32000 (39%)] Loss: 1.21169 (QuantReg: 12.59854) QuantErr: 12.59854 batch_time=1.00929 
Train Epoch: 4 [201/500 12864/32000 (40%)] Loss: 1.25136 (QuantReg: 12.52450) QuantErr: 12.52450 batch_time=0.39078 
Train Epoch: 4 [209/500 13376/32000 (42%)] Loss: 2.02713 (QuantReg: 12.98659) QuantErr: 12.98659 batch_time=0.39078 
Train Epoch: 4 [217/500 13888/32000 (43%)] Loss: 2.43001 (QuantReg: 12.93306) QuantErr: 12.93306 batch_time=0.39495 
Train Epoch: 4 [225/500 14400/32000 (45%)] Loss: 1.70389 (QuantReg: 12.92437) QuantErr: 12.92437 batch_time=0.39738 
Train Epoch: 4 [233/500 14912/32000 (47%)] Loss: 1.30379 (QuantReg: 12.66633) QuantErr: 12.66633 batch_time=0.38119 
Train Epoch: 4 [241/500 15424/32000 (48%)] Loss: 1.44864 (QuantReg: 12.48967) QuantErr: 12.48967 batch_time=0.38705 
Train Epoch: 4 [249/500 15936/32000 (50%)] Loss: 1.86175 (QuantReg: 13.20412) QuantErr: 13.20412 batch_time=0.41614 
Train Epoch: 4 [257/500 16448/32000 (51%)] Loss: 1.43100 (QuantReg: 12.19050) QuantErr: 12.19050 batch_time=0.39876 
Train Epoch: 4 [265/500 16960/32000 (53%)] Loss: 1.77790 (QuantReg: 13.02192) QuantErr: 13.02192 batch_time=0.39474 
Train Epoch: 4 [273/500 17472/32000 (55%)] Loss: 1.83683 (QuantReg: 12.84354) QuantErr: 12.84354 batch_time=0.38687 
Train Epoch: 4 [281/500 17984/32000 (56%)] Loss: 1.24931 (QuantReg: 12.39553) QuantErr: 12.39553 batch_time=0.40043 
Train Epoch: 4 [289/500 18496/32000 (58%)] Loss: 1.21358 (QuantReg: 12.81881) QuantErr: 12.81881 batch_time=0.39482 
Train Epoch: 4 [297/500 19008/32000 (59%)] Loss: 1.81615 (QuantReg: 12.09757) QuantErr: 12.09757 batch_time=0.39930 
Train Epoch: 4 [305/500 19520/32000 (61%)] Loss: 2.09199 (QuantReg: 12.79320) QuantErr: 12.79320 batch_time=0.45359 
Train Epoch: 4 [313/500 20032/32000 (63%)] Loss: 1.40940 (QuantReg: 12.69559) QuantErr: 12.69559 batch_time=0.41887 
Train Epoch: 4 [321/500 20544/32000 (64%)] Loss: 2.15685 (QuantReg: 12.63464) QuantErr: 12.63464 batch_time=0.39324 
Train Epoch: 4 [329/500 21056/32000 (66%)] Loss: 1.64204 (QuantReg: 12.83083) QuantErr: 12.83083 batch_time=0.40159 
Train Epoch: 4 [337/500 21568/32000 (67%)] Loss: 1.94875 (QuantReg: 12.84053) QuantErr: 12.84053 batch_time=0.39665 
Train Epoch: 4 [345/500 22080/32000 (69%)] Loss: 1.81361 (QuantReg: 12.86080) QuantErr: 12.86080 batch_time=0.38974 
Train Epoch: 4 [353/500 22592/32000 (71%)] Loss: 1.54206 (QuantReg: 13.29385) QuantErr: 13.29385 batch_time=0.41419 
Train Epoch: 4 [361/500 23104/32000 (72%)] Loss: 2.28765 (QuantReg: 12.66079) QuantErr: 12.66079 batch_time=0.38732 
Train Epoch: 4 [369/500 23616/32000 (74%)] Loss: 1.83458 (QuantReg: 12.92764) QuantErr: 12.92764 batch_time=0.38579 
Train Epoch: 4 [377/500 24128/32000 (75%)] Loss: 1.43909 (QuantReg: 12.98123) QuantErr: 12.98123 batch_time=0.40155 
Train Epoch: 4 [385/500 24640/32000 (77%)] Loss: 2.12607 (QuantReg: 12.89286) QuantErr: 12.89286 batch_time=0.40138 
Train Epoch: 4 [393/500 25152/32000 (79%)] Loss: 1.60292 (QuantReg: 13.03639) QuantErr: 13.03639 batch_time=0.39648 
Train Epoch: 4 [401/500 25664/32000 (80%)] Loss: 1.96240 (QuantReg: 12.74891) QuantErr: 12.74891 batch_time=0.39606 
Train Epoch: 4 [409/500 26176/32000 (82%)] Loss: 2.30991 (QuantReg: 12.74133) QuantErr: 12.74133 batch_time=0.40137 
Train Epoch: 4 [417/500 26688/32000 (83%)] Loss: 2.03576 (QuantReg: 12.70645) QuantErr: 12.70645 batch_time=0.41194 
Train Epoch: 4 [425/500 27200/32000 (85%)] Loss: 1.91951 (QuantReg: 13.22574) QuantErr: 13.22574 batch_time=0.39774 
Train Epoch: 4 [433/500 27712/32000 (87%)] Loss: 1.59066 (QuantReg: 13.48866) QuantErr: 13.48866 batch_time=0.39251 
Train Epoch: 4 [441/500 28224/32000 (88%)] Loss: 1.76940 (QuantReg: 13.07471) QuantErr: 13.07471 batch_time=0.39513 
Train Epoch: 4 [449/500 28736/32000 (90%)] Loss: 1.86777 (QuantReg: 12.90453) QuantErr: 12.90453 batch_time=0.40047 
Train Epoch: 4 [457/500 29248/32000 (91%)] Loss: 1.60647 (QuantReg: 13.74910) QuantErr: 13.74910 batch_time=0.39574 
Train Epoch: 4 [465/500 29760/32000 (93%)] Loss: 2.24671 (QuantReg: 13.35341) QuantErr: 13.35341 batch_time=0.44267 
Train Epoch: 4 [473/500 30272/32000 (95%)] Loss: 2.25806 (QuantReg: 13.01092) QuantErr: 13.01092 batch_time=0.44701 
Train Epoch: 4 [481/500 30784/32000 (96%)] Loss: 1.60337 (QuantReg: 12.96256) QuantErr: 12.96256 batch_time=0.38697 
Train Epoch: 4 [489/500 31296/32000 (98%)] Loss: 1.04834 (QuantReg: 13.27271) QuantErr: 13.27271 batch_time=0.41083 
Train Epoch: 4 [497/500 31808/32000 (99%)] Loss: 1.59139 (QuantReg: 13.00679) QuantErr: 13.00679 batch_time=0.39177 
Train Epoch: 4 codebook_update_time=2.12345
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch4.pth ...
Done in 5.467s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch4.pth ...
Done in 10.261s
removing stale ckpt [epoch 3] [took 0.08s]
 epoch          : 4
 loss           : 1.7582367053031922
 quant_reg      : 12.69219441986084
 quant_err      : 12.69219441986084
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 26.760563380281692
 MSRVTT_full_val/t2v_metrics/R5: 63.17907444668008
 MSRVTT_full_val/t2v_metrics/R10: 75.0503018108652
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.637826961770624
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 50.25049199397202
 MSRVTT_full_val/v2t_metrics/R1: 29.979879275653925
 MSRVTT_full_val/v2t_metrics/R5: 66.59959758551308
 MSRVTT_full_val/v2t_metrics/R10: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.927565392354125
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 54.32161383741219
 MSRVTT_full_test/t2v_metrics/R1: 9.59866220735786
 MSRVTT_full_test/t2v_metrics/R5: 29.19732441471572
 MSRVTT_full_test/t2v_metrics/R10: 42.207357859531776
 MSRVTT_full_test/t2v_metrics/R50: 76.5886287625418
 MSRVTT_full_test/t2v_metrics/MedR: 15.0
 MSRVTT_full_test/t2v_metrics/MeanR: 49.66321070234114
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.784909614840664
 MSRVTT_full_test/v2t_metrics/R1: 11.036789297658864
 MSRVTT_full_test/v2t_metrics/R5: 33.31103678929766
 MSRVTT_full_test/v2t_metrics/R10: 47.324414715719065
 MSRVTT_full_test/v2t_metrics/R50: 81.73913043478261
 MSRVTT_full_test/v2t_metrics/MedR: 12.0
 MSRVTT_full_test/v2t_metrics/MeanR: 40.854682274247494
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.912265472610954
 mnt_best       : 22.784909614840664
 not_improved_count: 0
Train Epoch: 5 [1/500 64/32000 (0%)] Loss: 1.54472 (QuantReg: 12.56585) QuantErr: 12.56585 batch_time=31.63661 
Train Epoch: 5 [9/500 576/32000 (2%)] Loss: 2.01757 (QuantReg: 12.06950) QuantErr: 12.06950 batch_time=0.40030 
Train Epoch: 5 [17/500 1088/32000 (3%)] Loss: 1.79857 (QuantReg: 12.33059) QuantErr: 12.33059 batch_time=0.41243 
Train Epoch: 5 [25/500 1600/32000 (5%)] Loss: 1.94354 (QuantReg: 12.34549) QuantErr: 12.34549 batch_time=0.39584 
Train Epoch: 5 [33/500 2112/32000 (7%)] Loss: 1.58160 (QuantReg: 12.06917) QuantErr: 12.06917 batch_time=0.51270 
Train Epoch: 5 [41/500 2624/32000 (8%)] Loss: 1.71365 (QuantReg: 11.97016) QuantErr: 11.97016 batch_time=0.39403 
Train Epoch: 5 [49/500 3136/32000 (10%)] Loss: 1.63804 (QuantReg: 12.71265) QuantErr: 12.71265 batch_time=0.39636 
Train Epoch: 5 [57/500 3648/32000 (11%)] Loss: 1.73117 (QuantReg: 12.19431) QuantErr: 12.19431 batch_time=0.43102 
Train Epoch: 5 [65/500 4160/32000 (13%)] Loss: 1.53462 (QuantReg: 12.41392) QuantErr: 12.41392 batch_time=0.40349 
Train Epoch: 5 [73/500 4672/32000 (15%)] Loss: 2.27222 (QuantReg: 12.20629) QuantErr: 12.20629 batch_time=0.40093 
Train Epoch: 5 [81/500 5184/32000 (16%)] Loss: 1.59031 (QuantReg: 12.32838) QuantErr: 12.32838 batch_time=0.39347 
Train Epoch: 5 [89/500 5696/32000 (18%)] Loss: 1.53942 (QuantReg: 12.32615) QuantErr: 12.32615 batch_time=0.40769 
Train Epoch: 5 [97/500 6208/32000 (19%)] Loss: 2.34045 (QuantReg: 12.11192) QuantErr: 12.11192 batch_time=0.50168 
Train Epoch: 5 [105/500 6720/32000 (21%)] Loss: 1.66288 (QuantReg: 12.07535) QuantErr: 12.07535 batch_time=0.39078 
Train Epoch: 5 [113/500 7232/32000 (23%)] Loss: 1.70220 (QuantReg: 12.36147) QuantErr: 12.36147 batch_time=0.38958 
Train Epoch: 5 [121/500 7744/32000 (24%)] Loss: 1.41827 (QuantReg: 12.35462) QuantErr: 12.35462 batch_time=0.38860 
Train Epoch: 5 [129/500 8256/32000 (26%)] Loss: 1.92247 (QuantReg: 13.01104) QuantErr: 13.01104 batch_time=0.37775 
Train Epoch: 5 [137/500 8768/32000 (27%)] Loss: 1.93224 (QuantReg: 12.75348) QuantErr: 12.75348 batch_time=0.39471 
Train Epoch: 5 [145/500 9280/32000 (29%)] Loss: 1.41281 (QuantReg: 12.34961) QuantErr: 12.34961 batch_time=0.39790 
Train Epoch: 5 [153/500 9792/32000 (31%)] Loss: 1.45909 (QuantReg: 12.87001) QuantErr: 12.87001 batch_time=0.41847 
Train Epoch: 5 [161/500 10304/32000 (32%)] Loss: 1.74232 (QuantReg: 12.79114) QuantErr: 12.79114 batch_time=0.51224 
Train Epoch: 5 [169/500 10816/32000 (34%)] Loss: 1.30749 (QuantReg: 12.94249) QuantErr: 12.94249 batch_time=0.39317 
Train Epoch: 5 [177/500 11328/32000 (35%)] Loss: 1.58138 (QuantReg: 12.72949) QuantErr: 12.72949 batch_time=0.40861 
Train Epoch: 5 [185/500 11840/32000 (37%)] Loss: 1.71015 (QuantReg: 13.22083) QuantErr: 13.22083 batch_time=0.38978 
Train Epoch: 5 [193/500 12352/32000 (39%)] Loss: 1.57528 (QuantReg: 12.46153) QuantErr: 12.46153 batch_time=0.39401 
Train Epoch: 5 [201/500 12864/32000 (40%)] Loss: 1.61467 (QuantReg: 12.15421) QuantErr: 12.15421 batch_time=0.41229 
Train Epoch: 5 [209/500 13376/32000 (42%)] Loss: 1.27286 (QuantReg: 12.25346) QuantErr: 12.25346 batch_time=0.39676 
Train Epoch: 5 [217/500 13888/32000 (43%)] Loss: 1.47115 (QuantReg: 12.58697) QuantErr: 12.58697 batch_time=0.39760 
Train Epoch: 5 [225/500 14400/32000 (45%)] Loss: 1.88333 (QuantReg: 12.86080) QuantErr: 12.86080 batch_time=0.54761 
Train Epoch: 5 [233/500 14912/32000 (47%)] Loss: 1.65079 (QuantReg: 12.87507) QuantErr: 12.87507 batch_time=0.39215 
Train Epoch: 5 [241/500 15424/32000 (48%)] Loss: 2.21671 (QuantReg: 12.35644) QuantErr: 12.35644 batch_time=0.38905 
Train Epoch: 5 [249/500 15936/32000 (50%)] Loss: 1.58451 (QuantReg: 12.32329) QuantErr: 12.32329 batch_time=0.39310 
Train Epoch: 5 [257/500 16448/32000 (51%)] Loss: 1.25012 (QuantReg: 12.71306) QuantErr: 12.71306 batch_time=0.38682 
Train Epoch: 5 [265/500 16960/32000 (53%)] Loss: 1.31599 (QuantReg: 12.48547) QuantErr: 12.48547 batch_time=0.40943 
Train Epoch: 5 [273/500 17472/32000 (55%)] Loss: 1.44974 (QuantReg: 13.04136) QuantErr: 13.04136 batch_time=0.39887 
Train Epoch: 5 [281/500 17984/32000 (56%)] Loss: 1.63951 (QuantReg: 12.57378) QuantErr: 12.57378 batch_time=0.39446 
Train Epoch: 5 [289/500 18496/32000 (58%)] Loss: 1.76328 (QuantReg: 12.54737) QuantErr: 12.54737 batch_time=0.56687 
Train Epoch: 5 [297/500 19008/32000 (59%)] Loss: 1.72582 (QuantReg: 12.81276) QuantErr: 12.81276 batch_time=0.39603 
Train Epoch: 5 [305/500 19520/32000 (61%)] Loss: 1.64066 (QuantReg: 13.04384) QuantErr: 13.04384 batch_time=0.39534 
Train Epoch: 5 [313/500 20032/32000 (63%)] Loss: 1.19077 (QuantReg: 13.08715) QuantErr: 13.08715 batch_time=0.39617 
Train Epoch: 5 [321/500 20544/32000 (64%)] Loss: 1.22293 (QuantReg: 13.20170) QuantErr: 13.20170 batch_time=0.40959 
Train Epoch: 5 [329/500 21056/32000 (66%)] Loss: 1.58775 (QuantReg: 12.85840) QuantErr: 12.85840 batch_time=0.39562 
Train Epoch: 5 [337/500 21568/32000 (67%)] Loss: 1.26907 (QuantReg: 12.69888) QuantErr: 12.69888 batch_time=0.41482 
Train Epoch: 5 [345/500 22080/32000 (69%)] Loss: 1.69866 (QuantReg: 13.07562) QuantErr: 13.07562 batch_time=0.39221 
Train Epoch: 5 [353/500 22592/32000 (71%)] Loss: 1.24814 (QuantReg: 13.03347) QuantErr: 13.03347 batch_time=0.41402 
Train Epoch: 5 [361/500 23104/32000 (72%)] Loss: 1.47351 (QuantReg: 12.87604) QuantErr: 12.87604 batch_time=0.39685 
Train Epoch: 5 [369/500 23616/32000 (74%)] Loss: 1.66804 (QuantReg: 12.98231) QuantErr: 12.98231 batch_time=0.38507 
Train Epoch: 5 [377/500 24128/32000 (75%)] Loss: 1.44861 (QuantReg: 12.82968) QuantErr: 12.82968 batch_time=0.38729 
Train Epoch: 5 [385/500 24640/32000 (77%)] Loss: 1.39330 (QuantReg: 12.54931) QuantErr: 12.54931 batch_time=0.39913 
Train Epoch: 5 [393/500 25152/32000 (79%)] Loss: 1.47478 (QuantReg: 12.92687) QuantErr: 12.92687 batch_time=0.39962 
Train Epoch: 5 [401/500 25664/32000 (80%)] Loss: 1.97498 (QuantReg: 12.55503) QuantErr: 12.55503 batch_time=0.42971 
Train Epoch: 5 [409/500 26176/32000 (82%)] Loss: 1.80582 (QuantReg: 12.86993) QuantErr: 12.86993 batch_time=0.39031 
Train Epoch: 5 [417/500 26688/32000 (83%)] Loss: 1.68756 (QuantReg: 12.61598) QuantErr: 12.61598 batch_time=0.39408 
Train Epoch: 5 [425/500 27200/32000 (85%)] Loss: 1.23612 (QuantReg: 13.11189) QuantErr: 13.11189 batch_time=0.39341 
Train Epoch: 5 [433/500 27712/32000 (87%)] Loss: 1.29950 (QuantReg: 13.15410) QuantErr: 13.15410 batch_time=0.39605 
Train Epoch: 5 [441/500 28224/32000 (88%)] Loss: 1.58980 (QuantReg: 12.90549) QuantErr: 12.90549 batch_time=0.39955 
Train Epoch: 5 [449/500 28736/32000 (90%)] Loss: 1.98252 (QuantReg: 13.01122) QuantErr: 13.01122 batch_time=0.41687 
Train Epoch: 5 [457/500 29248/32000 (91%)] Loss: 1.44212 (QuantReg: 12.96486) QuantErr: 12.96486 batch_time=0.39180 
Train Epoch: 5 [465/500 29760/32000 (93%)] Loss: 1.68168 (QuantReg: 12.79189) QuantErr: 12.79189 batch_time=0.39877 
Train Epoch: 5 [473/500 30272/32000 (95%)] Loss: 1.77197 (QuantReg: 12.63530) QuantErr: 12.63530 batch_time=0.39598 
Train Epoch: 5 [481/500 30784/32000 (96%)] Loss: 2.02312 (QuantReg: 12.64193) QuantErr: 12.64193 batch_time=0.39276 
Train Epoch: 5 [489/500 31296/32000 (98%)] Loss: 1.97414 (QuantReg: 12.47764) QuantErr: 12.47764 batch_time=0.39013 
Train Epoch: 5 [497/500 31808/32000 (99%)] Loss: 1.97256 (QuantReg: 12.83946) QuantErr: 12.83946 batch_time=0.39449 
Train Epoch: 5 codebook_update_time=2.21408
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch5.pth ...
Done in 4.267s
removing stale ckpt [epoch 4] [took 2.23s]
 epoch          : 5
 loss           : 1.5685114523172379
 quant_reg      : 12.716559984207153
 quant_err      : 12.716559984207153
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 26.961770623742456
 MSRVTT_full_val/t2v_metrics/R5: 61.77062374245473
 MSRVTT_full_val/t2v_metrics/R10: 75.25150905432595
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.231388329979879
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 50.043599136847476
 MSRVTT_full_val/v2t_metrics/R1: 29.77867203219316
 MSRVTT_full_val/v2t_metrics/R5: 68.00804828973843
 MSRVTT_full_val/v2t_metrics/R10: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.132796780684105
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 54.57922715214068
 MSRVTT_full_test/t2v_metrics/R1: 8.66220735785953
 MSRVTT_full_test/t2v_metrics/R5: 26.889632107023413
 MSRVTT_full_test/t2v_metrics/R10: 40.23411371237458
 MSRVTT_full_test/t2v_metrics/R50: 74.94983277591973
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 57.159866220735786
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 21.083172319440084
 MSRVTT_full_test/v2t_metrics/R1: 11.33779264214047
 MSRVTT_full_test/v2t_metrics/R5: 32.608695652173914
 MSRVTT_full_test/v2t_metrics/R10: 46.68896321070234
 MSRVTT_full_test/v2t_metrics/R50: 80.06688963210702
 MSRVTT_full_test/v2t_metrics/MedR: 12.5
 MSRVTT_full_test/v2t_metrics/MeanR: 47.37692307692308
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.843939899184004
 mnt_best       : 22.784909614840664
 not_improved_count: 1
Train Epoch: 6 [1/500 64/32000 (0%)] Loss: 1.96780 (QuantReg: 12.45331) QuantErr: 12.45331 batch_time=30.23567 
Train Epoch: 6 [9/500 576/32000 (2%)] Loss: 1.42974 (QuantReg: 12.84266) QuantErr: 12.84266 batch_time=0.39367 
Train Epoch: 6 [17/500 1088/32000 (3%)] Loss: 1.11814 (QuantReg: 12.55186) QuantErr: 12.55186 batch_time=0.43467 
Train Epoch: 6 [25/500 1600/32000 (5%)] Loss: 1.05518 (QuantReg: 12.45961) QuantErr: 12.45961 batch_time=0.40822 
Train Epoch: 6 [33/500 2112/32000 (7%)] Loss: 1.97150 (QuantReg: 12.56135) QuantErr: 12.56135 batch_time=0.39436 
Train Epoch: 6 [41/500 2624/32000 (8%)] Loss: 1.36753 (QuantReg: 12.32276) QuantErr: 12.32276 batch_time=0.39861 
Train Epoch: 6 [49/500 3136/32000 (10%)] Loss: 1.56254 (QuantReg: 12.79762) QuantErr: 12.79762 batch_time=0.38634 
Train Epoch: 6 [57/500 3648/32000 (11%)] Loss: 1.58998 (QuantReg: 12.52922) QuantErr: 12.52922 batch_time=0.39916 
Train Epoch: 6 [65/500 4160/32000 (13%)] Loss: 1.62367 (QuantReg: 12.69595) QuantErr: 12.69595 batch_time=0.40552 
Train Epoch: 6 [73/500 4672/32000 (15%)] Loss: 1.09168 (QuantReg: 12.47095) QuantErr: 12.47095 batch_time=0.41953 
Train Epoch: 6 [81/500 5184/32000 (16%)] Loss: 1.11758 (QuantReg: 13.32632) QuantErr: 13.32632 batch_time=0.38772 
Train Epoch: 6 [89/500 5696/32000 (18%)] Loss: 1.35721 (QuantReg: 12.38876) QuantErr: 12.38876 batch_time=0.39849 
Train Epoch: 6 [97/500 6208/32000 (19%)] Loss: 1.51466 (QuantReg: 12.10286) QuantErr: 12.10286 batch_time=0.40087 
Train Epoch: 6 [105/500 6720/32000 (21%)] Loss: 1.62664 (QuantReg: 12.45674) QuantErr: 12.45674 batch_time=0.39853 
Train Epoch: 6 [113/500 7232/32000 (23%)] Loss: 1.07988 (QuantReg: 12.03989) QuantErr: 12.03989 batch_time=0.43750 
Train Epoch: 6 [121/500 7744/32000 (24%)] Loss: 0.95002 (QuantReg: 13.19120) QuantErr: 13.19120 batch_time=0.43408 
Train Epoch: 6 [129/500 8256/32000 (26%)] Loss: 2.16467 (QuantReg: 12.64594) QuantErr: 12.64594 batch_time=0.39942 
Train Epoch: 6 [137/500 8768/32000 (27%)] Loss: 1.08272 (QuantReg: 12.70597) QuantErr: 12.70597 batch_time=0.39444 
Train Epoch: 6 [145/500 9280/32000 (29%)] Loss: 1.49941 (QuantReg: 12.45223) QuantErr: 12.45223 batch_time=0.41354 
Train Epoch: 6 [153/500 9792/32000 (31%)] Loss: 0.97053 (QuantReg: 12.77758) QuantErr: 12.77758 batch_time=0.38569 
Train Epoch: 6 [161/500 10304/32000 (32%)] Loss: 1.08872 (QuantReg: 12.55771) QuantErr: 12.55771 batch_time=0.39600 
Train Epoch: 6 [169/500 10816/32000 (34%)] Loss: 1.44907 (QuantReg: 12.97076) QuantErr: 12.97076 batch_time=0.41320 
Train Epoch: 6 [177/500 11328/32000 (35%)] Loss: 1.12895 (QuantReg: 12.83212) QuantErr: 12.83212 batch_time=0.39629 
Train Epoch: 6 [185/500 11840/32000 (37%)] Loss: 1.69368 (QuantReg: 12.15770) QuantErr: 12.15770 batch_time=0.39453 
Train Epoch: 6 [193/500 12352/32000 (39%)] Loss: 1.32147 (QuantReg: 13.08154) QuantErr: 13.08154 batch_time=0.41142 
Train Epoch: 6 [201/500 12864/32000 (40%)] Loss: 1.54563 (QuantReg: 12.35089) QuantErr: 12.35089 batch_time=0.40083 
Train Epoch: 6 [209/500 13376/32000 (42%)] Loss: 1.51472 (QuantReg: 12.57879) QuantErr: 12.57879 batch_time=0.39329 
Train Epoch: 6 [217/500 13888/32000 (43%)] Loss: 1.93960 (QuantReg: 12.65104) QuantErr: 12.65104 batch_time=0.44187 
Train Epoch: 6 [225/500 14400/32000 (45%)] Loss: 1.62859 (QuantReg: 12.87815) QuantErr: 12.87815 batch_time=0.39267 
Train Epoch: 6 [233/500 14912/32000 (47%)] Loss: 1.80977 (QuantReg: 12.54914) QuantErr: 12.54914 batch_time=0.38425 
Train Epoch: 6 [241/500 15424/32000 (48%)] Loss: 1.96786 (QuantReg: 12.33850) QuantErr: 12.33850 batch_time=0.44606 
Train Epoch: 6 [249/500 15936/32000 (50%)] Loss: 1.75273 (QuantReg: 13.05940) QuantErr: 13.05940 batch_time=0.39930 
Train Epoch: 6 [257/500 16448/32000 (51%)] Loss: 1.82761 (QuantReg: 12.53507) QuantErr: 12.53507 batch_time=0.40037 
Train Epoch: 6 [265/500 16960/32000 (53%)] Loss: 0.75841 (QuantReg: 12.98775) QuantErr: 12.98775 batch_time=0.39057 
Train Epoch: 6 [273/500 17472/32000 (55%)] Loss: 1.82650 (QuantReg: 12.98372) QuantErr: 12.98372 batch_time=0.38874 
Train Epoch: 6 [281/500 17984/32000 (56%)] Loss: 1.25147 (QuantReg: 12.95396) QuantErr: 12.95396 batch_time=0.39258 
Train Epoch: 6 [289/500 18496/32000 (58%)] Loss: 2.10690 (QuantReg: 12.65615) QuantErr: 12.65615 batch_time=0.38898 
Train Epoch: 6 [297/500 19008/32000 (59%)] Loss: 1.27318 (QuantReg: 13.07700) QuantErr: 13.07700 batch_time=0.40113 
Train Epoch: 6 [305/500 19520/32000 (61%)] Loss: 1.39506 (QuantReg: 12.75171) QuantErr: 12.75171 batch_time=0.45175 
Train Epoch: 6 [313/500 20032/32000 (63%)] Loss: 1.58306 (QuantReg: 12.72298) QuantErr: 12.72298 batch_time=0.40408 
Train Epoch: 6 [321/500 20544/32000 (64%)] Loss: 1.41836 (QuantReg: 13.16352) QuantErr: 13.16352 batch_time=0.39070 
Train Epoch: 6 [329/500 21056/32000 (66%)] Loss: 1.46001 (QuantReg: 12.53345) QuantErr: 12.53345 batch_time=0.39749 
Train Epoch: 6 [337/500 21568/32000 (67%)] Loss: 1.49733 (QuantReg: 12.97483) QuantErr: 12.97483 batch_time=0.43273 
Train Epoch: 6 [345/500 22080/32000 (69%)] Loss: 1.41370 (QuantReg: 13.47442) QuantErr: 13.47442 batch_time=0.40838 
Train Epoch: 6 [353/500 22592/32000 (71%)] Loss: 0.94807 (QuantReg: 13.03864) QuantErr: 13.03864 batch_time=0.39236 
Train Epoch: 6 [361/500 23104/32000 (72%)] Loss: 1.37744 (QuantReg: 13.00916) QuantErr: 13.00916 batch_time=0.39504 
Train Epoch: 6 [369/500 23616/32000 (74%)] Loss: 0.94484 (QuantReg: 12.49626) QuantErr: 12.49626 batch_time=0.64860 
Train Epoch: 6 [377/500 24128/32000 (75%)] Loss: 1.19804 (QuantReg: 12.78401) QuantErr: 12.78401 batch_time=0.39823 
Train Epoch: 6 [385/500 24640/32000 (77%)] Loss: 1.29649 (QuantReg: 12.84787) QuantErr: 12.84787 batch_time=0.40245 
Train Epoch: 6 [393/500 25152/32000 (79%)] Loss: 1.30465 (QuantReg: 12.87922) QuantErr: 12.87922 batch_time=0.40091 
Train Epoch: 6 [401/500 25664/32000 (80%)] Loss: 1.00381 (QuantReg: 13.07053) QuantErr: 13.07053 batch_time=0.39036 
Train Epoch: 6 [409/500 26176/32000 (82%)] Loss: 1.25852 (QuantReg: 12.79083) QuantErr: 12.79083 batch_time=0.39168 
Train Epoch: 6 [417/500 26688/32000 (83%)] Loss: 1.09798 (QuantReg: 12.40524) QuantErr: 12.40524 batch_time=0.38707 
Train Epoch: 6 [425/500 27200/32000 (85%)] Loss: 1.64692 (QuantReg: 12.80969) QuantErr: 12.80969 batch_time=0.39027 
Train Epoch: 6 [433/500 27712/32000 (87%)] Loss: 1.52631 (QuantReg: 12.80992) QuantErr: 12.80992 batch_time=0.43780 
Train Epoch: 6 [441/500 28224/32000 (88%)] Loss: 1.33233 (QuantReg: 12.57703) QuantErr: 12.57703 batch_time=0.39733 
Train Epoch: 6 [449/500 28736/32000 (90%)] Loss: 1.14661 (QuantReg: 12.96878) QuantErr: 12.96878 batch_time=0.39379 
Train Epoch: 6 [457/500 29248/32000 (91%)] Loss: 1.71887 (QuantReg: 13.41202) QuantErr: 13.41202 batch_time=0.40201 
Train Epoch: 6 [465/500 29760/32000 (93%)] Loss: 1.55513 (QuantReg: 12.43541) QuantErr: 12.43541 batch_time=0.39562 
Train Epoch: 6 [473/500 30272/32000 (95%)] Loss: 1.35291 (QuantReg: 12.81878) QuantErr: 12.81878 batch_time=0.39511 
Train Epoch: 6 [481/500 30784/32000 (96%)] Loss: 1.28457 (QuantReg: 12.51670) QuantErr: 12.51670 batch_time=0.39988 
Train Epoch: 6 [489/500 31296/32000 (98%)] Loss: 0.89367 (QuantReg: 12.75255) QuantErr: 12.75255 batch_time=0.41184 
Train Epoch: 6 [497/500 31808/32000 (99%)] Loss: 1.27891 (QuantReg: 12.90516) QuantErr: 12.90516 batch_time=0.39437 
Train Epoch: 6 codebook_update_time=1.88140
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch6.pth ...
Done in 5.291s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch6.pth ...
Done in 9.908s
removing stale ckpt [epoch 5] [took 0.00s]
 epoch          : 6
 loss           : 1.4261233661174775
 quant_reg      : 12.712779527664184
 quant_err      : 12.712779527664184
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 28.571428571428573
 MSRVTT_full_val/t2v_metrics/R5: 65.19114688128772
 MSRVTT_full_val/t2v_metrics/R10: 80.0804828973843
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.203219315895373
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.03335310284704
 MSRVTT_full_val/v2t_metrics/R1: 35.010060362173036
 MSRVTT_full_val/v2t_metrics/R5: 72.83702213279678
 MSRVTT_full_val/v2t_metrics/R10: 84.50704225352112
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.150905432595573
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.95323853794192
 MSRVTT_full_test/t2v_metrics/R1: 10.301003344481606
 MSRVTT_full_test/t2v_metrics/R5: 29.297658862876254
 MSRVTT_full_test/t2v_metrics/R10: 43.31103678929766
 MSRVTT_full_test/t2v_metrics/R50: 77.22408026755853
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 51.96387959866221
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.55611551581911
 MSRVTT_full_test/v2t_metrics/R1: 12.842809364548495
 MSRVTT_full_test/v2t_metrics/R5: 35.18394648829432
 MSRVTT_full_test/v2t_metrics/R10: 49.66555183946488
 MSRVTT_full_test/v2t_metrics/R50: 82.50836120401338
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 41.04531772575251
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.206765259113084
 mnt_best       : 23.55611551581911
 not_improved_count: 0
Train Epoch: 7 [1/500 64/32000 (0%)] Loss: 1.32218 (QuantReg: 11.57924) QuantErr: 11.57924 batch_time=28.55974 
Train Epoch: 7 [9/500 576/32000 (2%)] Loss: 0.85175 (QuantReg: 12.45084) QuantErr: 12.45084 batch_time=0.43725 
Train Epoch: 7 [17/500 1088/32000 (3%)] Loss: 1.65104 (QuantReg: 12.51750) QuantErr: 12.51750 batch_time=0.40875 
Train Epoch: 7 [25/500 1600/32000 (5%)] Loss: 1.16210 (QuantReg: 12.23711) QuantErr: 12.23711 batch_time=0.43958 
Train Epoch: 7 [33/500 2112/32000 (7%)] Loss: 1.64769 (QuantReg: 12.43781) QuantErr: 12.43781 batch_time=0.39793 
Train Epoch: 7 [41/500 2624/32000 (8%)] Loss: 0.93835 (QuantReg: 12.79955) QuantErr: 12.79955 batch_time=0.39143 
Train Epoch: 7 [49/500 3136/32000 (10%)] Loss: 1.84058 (QuantReg: 12.39545) QuantErr: 12.39545 batch_time=0.39000 
Train Epoch: 7 [57/500 3648/32000 (11%)] Loss: 1.97366 (QuantReg: 12.03178) QuantErr: 12.03178 batch_time=0.39515 
Train Epoch: 7 [65/500 4160/32000 (13%)] Loss: 1.58062 (QuantReg: 12.52463) QuantErr: 12.52463 batch_time=0.39815 
Train Epoch: 7 [73/500 4672/32000 (15%)] Loss: 1.19947 (QuantReg: 12.90213) QuantErr: 12.90213 batch_time=0.41211 
Train Epoch: 7 [81/500 5184/32000 (16%)] Loss: 1.31105 (QuantReg: 12.14385) QuantErr: 12.14385 batch_time=0.42213 
Train Epoch: 7 [89/500 5696/32000 (18%)] Loss: 1.77674 (QuantReg: 12.23552) QuantErr: 12.23552 batch_time=0.39364 
Train Epoch: 7 [97/500 6208/32000 (19%)] Loss: 1.58792 (QuantReg: 12.30590) QuantErr: 12.30590 batch_time=0.39805 
Train Epoch: 7 [105/500 6720/32000 (21%)] Loss: 0.86738 (QuantReg: 12.65633) QuantErr: 12.65633 batch_time=0.39442 
Train Epoch: 7 [113/500 7232/32000 (23%)] Loss: 1.74139 (QuantReg: 12.64655) QuantErr: 12.64655 batch_time=0.39876 
Train Epoch: 7 [121/500 7744/32000 (24%)] Loss: 0.92286 (QuantReg: 12.50237) QuantErr: 12.50237 batch_time=0.40107 
Train Epoch: 7 [129/500 8256/32000 (26%)] Loss: 1.05001 (QuantReg: 12.70234) QuantErr: 12.70234 batch_time=0.39614 
Train Epoch: 7 [137/500 8768/32000 (27%)] Loss: 1.21653 (QuantReg: 12.50078) QuantErr: 12.50078 batch_time=0.38880 
Train Epoch: 7 [145/500 9280/32000 (29%)] Loss: 1.32987 (QuantReg: 12.28858) QuantErr: 12.28858 batch_time=0.38866 
Train Epoch: 7 [153/500 9792/32000 (31%)] Loss: 1.59632 (QuantReg: 12.41816) QuantErr: 12.41816 batch_time=0.40268 
Train Epoch: 7 [161/500 10304/32000 (32%)] Loss: 1.82180 (QuantReg: 12.24576) QuantErr: 12.24576 batch_time=0.40016 
Train Epoch: 7 [169/500 10816/32000 (34%)] Loss: 1.34921 (QuantReg: 12.72164) QuantErr: 12.72164 batch_time=0.38867 
Train Epoch: 7 [177/500 11328/32000 (35%)] Loss: 1.11867 (QuantReg: 12.80189) QuantErr: 12.80189 batch_time=0.42935 
Train Epoch: 7 [185/500 11840/32000 (37%)] Loss: 1.36131 (QuantReg: 12.87861) QuantErr: 12.87861 batch_time=0.38918 
Train Epoch: 7 [193/500 12352/32000 (39%)] Loss: 1.38960 (QuantReg: 12.81411) QuantErr: 12.81411 batch_time=0.41190 
Train Epoch: 7 [201/500 12864/32000 (40%)] Loss: 1.25236 (QuantReg: 12.93190) QuantErr: 12.93190 batch_time=0.43096 
Train Epoch: 7 [209/500 13376/32000 (42%)] Loss: 1.50345 (QuantReg: 12.83652) QuantErr: 12.83652 batch_time=0.42609 
Train Epoch: 7 [217/500 13888/32000 (43%)] Loss: 1.17874 (QuantReg: 12.70034) QuantErr: 12.70034 batch_time=0.40723 
Train Epoch: 7 [225/500 14400/32000 (45%)] Loss: 1.01842 (QuantReg: 12.78678) QuantErr: 12.78678 batch_time=0.42804 
Train Epoch: 7 [233/500 14912/32000 (47%)] Loss: 1.12577 (QuantReg: 12.90904) QuantErr: 12.90904 batch_time=0.44162 
Train Epoch: 7 [241/500 15424/32000 (48%)] Loss: 1.01290 (QuantReg: 13.00919) QuantErr: 13.00919 batch_time=0.46316 
Train Epoch: 7 [249/500 15936/32000 (50%)] Loss: 1.16460 (QuantReg: 13.09290) QuantErr: 13.09290 batch_time=0.40416 
Train Epoch: 7 [257/500 16448/32000 (51%)] Loss: 1.07263 (QuantReg: 13.21177) QuantErr: 13.21177 batch_time=0.39225 
Train Epoch: 7 [265/500 16960/32000 (53%)] Loss: 1.21364 (QuantReg: 12.69909) QuantErr: 12.69909 batch_time=0.39724 
Train Epoch: 7 [273/500 17472/32000 (55%)] Loss: 1.69522 (QuantReg: 12.57870) QuantErr: 12.57870 batch_time=0.39758 
Train Epoch: 7 [281/500 17984/32000 (56%)] Loss: 1.91684 (QuantReg: 13.18966) QuantErr: 13.18966 batch_time=0.40430 
Train Epoch: 7 [289/500 18496/32000 (58%)] Loss: 1.13431 (QuantReg: 12.17914) QuantErr: 12.17914 batch_time=0.39274 
Train Epoch: 7 [297/500 19008/32000 (59%)] Loss: 1.02320 (QuantReg: 12.71900) QuantErr: 12.71900 batch_time=0.38671 
Train Epoch: 7 [305/500 19520/32000 (61%)] Loss: 1.39782 (QuantReg: 12.26230) QuantErr: 12.26230 batch_time=0.39128 
Train Epoch: 7 [313/500 20032/32000 (63%)] Loss: 1.31017 (QuantReg: 12.85627) QuantErr: 12.85627 batch_time=0.39624 
Train Epoch: 7 [321/500 20544/32000 (64%)] Loss: 1.26962 (QuantReg: 13.16357) QuantErr: 13.16357 batch_time=0.42325 
Train Epoch: 7 [329/500 21056/32000 (66%)] Loss: 1.56009 (QuantReg: 12.89327) QuantErr: 12.89327 batch_time=0.58206 
Train Epoch: 7 [337/500 21568/32000 (67%)] Loss: 1.25106 (QuantReg: 12.79889) QuantErr: 12.79889 batch_time=0.40533 
Train Epoch: 7 [345/500 22080/32000 (69%)] Loss: 1.51934 (QuantReg: 13.12570) QuantErr: 13.12570 batch_time=0.38816 
Train Epoch: 7 [353/500 22592/32000 (71%)] Loss: 1.95656 (QuantReg: 12.56301) QuantErr: 12.56301 batch_time=0.41448 
Train Epoch: 7 [361/500 23104/32000 (72%)] Loss: 1.30864 (QuantReg: 12.20008) QuantErr: 12.20008 batch_time=0.39667 
Train Epoch: 7 [369/500 23616/32000 (74%)] Loss: 1.43813 (QuantReg: 13.42429) QuantErr: 13.42429 batch_time=0.40320 
Train Epoch: 7 [377/500 24128/32000 (75%)] Loss: 1.65338 (QuantReg: 13.02841) QuantErr: 13.02841 batch_time=0.41679 
Train Epoch: 7 [385/500 24640/32000 (77%)] Loss: 1.58865 (QuantReg: 12.82321) QuantErr: 12.82321 batch_time=0.40685 
Train Epoch: 7 [393/500 25152/32000 (79%)] Loss: 1.68278 (QuantReg: 12.45836) QuantErr: 12.45836 batch_time=0.39724 
Train Epoch: 7 [401/500 25664/32000 (80%)] Loss: 1.30147 (QuantReg: 12.70099) QuantErr: 12.70099 batch_time=0.39541 
Train Epoch: 7 [409/500 26176/32000 (82%)] Loss: 1.13165 (QuantReg: 12.86405) QuantErr: 12.86405 batch_time=0.40589 
Train Epoch: 7 [417/500 26688/32000 (83%)] Loss: 1.03532 (QuantReg: 12.76072) QuantErr: 12.76072 batch_time=0.39405 
Train Epoch: 7 [425/500 27200/32000 (85%)] Loss: 1.16949 (QuantReg: 12.89848) QuantErr: 12.89848 batch_time=0.39089 
Train Epoch: 7 [433/500 27712/32000 (87%)] Loss: 1.32808 (QuantReg: 13.01906) QuantErr: 13.01906 batch_time=0.39200 
Train Epoch: 7 [441/500 28224/32000 (88%)] Loss: 1.88165 (QuantReg: 13.01212) QuantErr: 13.01212 batch_time=0.39291 
Train Epoch: 7 [449/500 28736/32000 (90%)] Loss: 0.94399 (QuantReg: 13.20956) QuantErr: 13.20956 batch_time=0.40240 
Train Epoch: 7 [457/500 29248/32000 (91%)] Loss: 1.04493 (QuantReg: 13.15670) QuantErr: 13.15670 batch_time=0.41762 
Train Epoch: 7 [465/500 29760/32000 (93%)] Loss: 1.50957 (QuantReg: 12.89462) QuantErr: 12.89462 batch_time=0.40047 
Train Epoch: 7 [473/500 30272/32000 (95%)] Loss: 1.37466 (QuantReg: 13.00454) QuantErr: 13.00454 batch_time=0.39745 
Train Epoch: 7 [481/500 30784/32000 (96%)] Loss: 1.34802 (QuantReg: 13.24660) QuantErr: 13.24660 batch_time=0.40798 
Train Epoch: 7 [489/500 31296/32000 (98%)] Loss: 1.49278 (QuantReg: 13.03930) QuantErr: 13.03930 batch_time=0.43794 
Train Epoch: 7 [497/500 31808/32000 (99%)] Loss: 1.68291 (QuantReg: 12.97049) QuantErr: 12.97049 batch_time=0.40276 
Train Epoch: 7 codebook_update_time=2.53568
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch7.pth ...
Done in 5.651s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch7.pth ...
Done in 11.956s
removing stale ckpt [epoch 6] [took 0.66s]
 epoch          : 7
 loss           : 1.3080506743192672
 quant_reg      : 12.73624073600769
 quant_err      : 12.73624073600769
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 65.3923541247485
 MSRVTT_full_val/t2v_metrics/R10: 79.07444668008048
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.048289738430583
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.35640171430685
 MSRVTT_full_val/v2t_metrics/R1: 33.199195171026155
 MSRVTT_full_val/v2t_metrics/R5: 71.0261569416499
 MSRVTT_full_val/v2t_metrics/R10: 82.29376257545272
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.659959758551308
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 57.89453860490258
 MSRVTT_full_test/t2v_metrics/R1: 10.568561872909699
 MSRVTT_full_test/t2v_metrics/R5: 32.14046822742475
 MSRVTT_full_test/t2v_metrics/R10: 46.32107023411371
 MSRVTT_full_test/t2v_metrics/R50: 79.03010033444816
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.61204013377927
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.058143553672554
 MSRVTT_full_test/v2t_metrics/R1: 13.010033444816054
 MSRVTT_full_test/v2t_metrics/R5: 36.58862876254181
 MSRVTT_full_test/v2t_metrics/R10: 51.00334448160535
 MSRVTT_full_test/v2t_metrics/R50: 84.38127090301003
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 37.629096989966555
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.956166643796887
 mnt_best       : 25.058143553672554
 not_improved_count: 0
Train Epoch: 8 [1/500 64/32000 (0%)] Loss: 1.55842 (QuantReg: 12.68894) QuantErr: 12.68894 batch_time=29.33590 
Train Epoch: 8 [9/500 576/32000 (2%)] Loss: 1.34858 (QuantReg: 12.80345) QuantErr: 12.80345 batch_time=1.00101 
Train Epoch: 8 [17/500 1088/32000 (3%)] Loss: 1.20706 (QuantReg: 12.65138) QuantErr: 12.65138 batch_time=0.39412 
Train Epoch: 8 [25/500 1600/32000 (5%)] Loss: 1.13191 (QuantReg: 12.86974) QuantErr: 12.86974 batch_time=0.42482 
Train Epoch: 8 [33/500 2112/32000 (7%)] Loss: 1.37290 (QuantReg: 12.29689) QuantErr: 12.29689 batch_time=0.41068 
Train Epoch: 8 [41/500 2624/32000 (8%)] Loss: 1.35279 (QuantReg: 12.63088) QuantErr: 12.63088 batch_time=0.43044 
Train Epoch: 8 [49/500 3136/32000 (10%)] Loss: 1.06518 (QuantReg: 12.48697) QuantErr: 12.48697 batch_time=0.39392 
Train Epoch: 8 [57/500 3648/32000 (11%)] Loss: 1.21842 (QuantReg: 12.86059) QuantErr: 12.86059 batch_time=0.39280 
Train Epoch: 8 [65/500 4160/32000 (13%)] Loss: 1.42282 (QuantReg: 12.52911) QuantErr: 12.52911 batch_time=0.57132 
Train Epoch: 8 [73/500 4672/32000 (15%)] Loss: 1.34887 (QuantReg: 12.93160) QuantErr: 12.93160 batch_time=0.83991 
Train Epoch: 8 [81/500 5184/32000 (16%)] Loss: 0.90887 (QuantReg: 12.80818) QuantErr: 12.80818 batch_time=0.39997 
Train Epoch: 8 [89/500 5696/32000 (18%)] Loss: 1.67516 (QuantReg: 12.90873) QuantErr: 12.90873 batch_time=0.41426 
Train Epoch: 8 [97/500 6208/32000 (19%)] Loss: 0.86731 (QuantReg: 12.91504) QuantErr: 12.91504 batch_time=0.39803 
Train Epoch: 8 [105/500 6720/32000 (21%)] Loss: 1.10022 (QuantReg: 13.13116) QuantErr: 13.13116 batch_time=0.38661 
Train Epoch: 8 [113/500 7232/32000 (23%)] Loss: 0.70313 (QuantReg: 12.86649) QuantErr: 12.86649 batch_time=0.45754 
Train Epoch: 8 [121/500 7744/32000 (24%)] Loss: 1.37167 (QuantReg: 13.13373) QuantErr: 13.13373 batch_time=0.39805 
Train Epoch: 8 [129/500 8256/32000 (26%)] Loss: 1.28220 (QuantReg: 12.43993) QuantErr: 12.43993 batch_time=0.57999 
Train Epoch: 8 [137/500 8768/32000 (27%)] Loss: 0.43274 (QuantReg: 12.69907) QuantErr: 12.69907 batch_time=0.79236 
Train Epoch: 8 [145/500 9280/32000 (29%)] Loss: 1.00589 (QuantReg: 13.26317) QuantErr: 13.26317 batch_time=0.40822 
Train Epoch: 8 [153/500 9792/32000 (31%)] Loss: 1.26234 (QuantReg: 12.63164) QuantErr: 12.63164 batch_time=0.40864 
Train Epoch: 8 [161/500 10304/32000 (32%)] Loss: 1.71040 (QuantReg: 13.32092) QuantErr: 13.32092 batch_time=0.40529 
Train Epoch: 8 [169/500 10816/32000 (34%)] Loss: 1.54048 (QuantReg: 12.82443) QuantErr: 12.82443 batch_time=0.45898 
Train Epoch: 8 [177/500 11328/32000 (35%)] Loss: 1.01596 (QuantReg: 12.96170) QuantErr: 12.96170 batch_time=1.64431 
Train Epoch: 8 [185/500 11840/32000 (37%)] Loss: 0.74586 (QuantReg: 12.91616) QuantErr: 12.91616 batch_time=0.40086 
Train Epoch: 8 [193/500 12352/32000 (39%)] Loss: 1.52682 (QuantReg: 12.42056) QuantErr: 12.42056 batch_time=0.39807 
Train Epoch: 8 [201/500 12864/32000 (40%)] Loss: 1.55333 (QuantReg: 12.09552) QuantErr: 12.09552 batch_time=0.41097 
Train Epoch: 8 [209/500 13376/32000 (42%)] Loss: 1.50344 (QuantReg: 12.76809) QuantErr: 12.76809 batch_time=0.38900 
Train Epoch: 8 [217/500 13888/32000 (43%)] Loss: 1.45227 (QuantReg: 12.79904) QuantErr: 12.79904 batch_time=0.39408 
Train Epoch: 8 [225/500 14400/32000 (45%)] Loss: 1.09667 (QuantReg: 12.63324) QuantErr: 12.63324 batch_time=0.39909 
Train Epoch: 8 [233/500 14912/32000 (47%)] Loss: 1.30118 (QuantReg: 12.84026) QuantErr: 12.84026 batch_time=0.39940 
Train Epoch: 8 [241/500 15424/32000 (48%)] Loss: 0.82106 (QuantReg: 12.69001) QuantErr: 12.69001 batch_time=1.66664 
Train Epoch: 8 [249/500 15936/32000 (50%)] Loss: 1.84404 (QuantReg: 12.16315) QuantErr: 12.16315 batch_time=0.39369 
Train Epoch: 8 [257/500 16448/32000 (51%)] Loss: 1.11804 (QuantReg: 12.36310) QuantErr: 12.36310 batch_time=0.42204 
Train Epoch: 8 [265/500 16960/32000 (53%)] Loss: 0.90816 (QuantReg: 12.98158) QuantErr: 12.98158 batch_time=0.36726 
Train Epoch: 8 [273/500 17472/32000 (55%)] Loss: 0.76186 (QuantReg: 12.46163) QuantErr: 12.46163 batch_time=0.43083 
Train Epoch: 8 [281/500 17984/32000 (56%)] Loss: 1.20964 (QuantReg: 12.93160) QuantErr: 12.93160 batch_time=0.40366 
Train Epoch: 8 [289/500 18496/32000 (58%)] Loss: 1.02551 (QuantReg: 13.15794) QuantErr: 13.15794 batch_time=0.39408 
Train Epoch: 8 [297/500 19008/32000 (59%)] Loss: 1.04051 (QuantReg: 13.08180) QuantErr: 13.08180 batch_time=0.38340 
Train Epoch: 8 [305/500 19520/32000 (61%)] Loss: 1.06953 (QuantReg: 12.88256) QuantErr: 12.88256 batch_time=0.42475 
Train Epoch: 8 [313/500 20032/32000 (63%)] Loss: 1.51688 (QuantReg: 13.00453) QuantErr: 13.00453 batch_time=0.39177 
Train Epoch: 8 [321/500 20544/32000 (64%)] Loss: 1.21984 (QuantReg: 12.52417) QuantErr: 12.52417 batch_time=0.38465 
Train Epoch: 8 [329/500 21056/32000 (66%)] Loss: 1.34763 (QuantReg: 12.49238) QuantErr: 12.49238 batch_time=0.38998 
Train Epoch: 8 [337/500 21568/32000 (67%)] Loss: 0.92828 (QuantReg: 13.10499) QuantErr: 13.10499 batch_time=0.40208 
Train Epoch: 8 [345/500 22080/32000 (69%)] Loss: 1.25823 (QuantReg: 12.68890) QuantErr: 12.68890 batch_time=0.39353 
Train Epoch: 8 [353/500 22592/32000 (71%)] Loss: 1.46366 (QuantReg: 12.76981) QuantErr: 12.76981 batch_time=0.39974 
Train Epoch: 8 [361/500 23104/32000 (72%)] Loss: 1.27909 (QuantReg: 12.76572) QuantErr: 12.76572 batch_time=0.39207 
Train Epoch: 8 [369/500 23616/32000 (74%)] Loss: 1.28306 (QuantReg: 12.83507) QuantErr: 12.83507 batch_time=0.39214 
Train Epoch: 8 [377/500 24128/32000 (75%)] Loss: 1.28720 (QuantReg: 12.92552) QuantErr: 12.92552 batch_time=0.40043 
Train Epoch: 8 [385/500 24640/32000 (77%)] Loss: 1.69558 (QuantReg: 12.56389) QuantErr: 12.56389 batch_time=0.40177 
Train Epoch: 8 [393/500 25152/32000 (79%)] Loss: 1.09241 (QuantReg: 12.98970) QuantErr: 12.98970 batch_time=0.40594 
Train Epoch: 8 [401/500 25664/32000 (80%)] Loss: 1.23037 (QuantReg: 12.27779) QuantErr: 12.27779 batch_time=0.38960 
Train Epoch: 8 [409/500 26176/32000 (82%)] Loss: 1.51282 (QuantReg: 13.18117) QuantErr: 13.18117 batch_time=0.40228 
Train Epoch: 8 [417/500 26688/32000 (83%)] Loss: 1.09120 (QuantReg: 12.95436) QuantErr: 12.95436 batch_time=0.40716 
Train Epoch: 8 [425/500 27200/32000 (85%)] Loss: 1.25359 (QuantReg: 12.59213) QuantErr: 12.59213 batch_time=0.40077 
Train Epoch: 8 [433/500 27712/32000 (87%)] Loss: 1.02360 (QuantReg: 13.30936) QuantErr: 13.30936 batch_time=0.38618 
Train Epoch: 8 [441/500 28224/32000 (88%)] Loss: 0.68282 (QuantReg: 13.80806) QuantErr: 13.80806 batch_time=0.39277 
Train Epoch: 8 [449/500 28736/32000 (90%)] Loss: 1.14396 (QuantReg: 13.21862) QuantErr: 13.21862 batch_time=0.40159 
Train Epoch: 8 [457/500 29248/32000 (91%)] Loss: 1.53264 (QuantReg: 12.77875) QuantErr: 12.77875 batch_time=0.44635 
Train Epoch: 8 [465/500 29760/32000 (93%)] Loss: 0.99200 (QuantReg: 13.28905) QuantErr: 13.28905 batch_time=0.38697 
Train Epoch: 8 [473/500 30272/32000 (95%)] Loss: 1.25843 (QuantReg: 13.40023) QuantErr: 13.40023 batch_time=0.39268 
Train Epoch: 8 [481/500 30784/32000 (96%)] Loss: 1.09755 (QuantReg: 12.88539) QuantErr: 12.88539 batch_time=0.38009 
Train Epoch: 8 [489/500 31296/32000 (98%)] Loss: 1.01113 (QuantReg: 12.82397) QuantErr: 12.82397 batch_time=0.39490 
Train Epoch: 8 [497/500 31808/32000 (99%)] Loss: 1.13089 (QuantReg: 12.48085) QuantErr: 12.48085 batch_time=0.39037 
Train Epoch: 8 codebook_update_time=1.89601
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch8.pth ...
Done in 23.278s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch8.pth ...
Done in 29.089s
removing stale ckpt [epoch 7] [took 0.08s]
 epoch          : 8
 loss           : 1.2115695939064026
 quant_reg      : 12.862498723983764
 quant_err      : 12.862498723983764
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 27.56539235412475
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 78.87323943661971
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.104627766599597
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.51158823659063
 MSRVTT_full_val/v2t_metrics/R1: 31.388329979879277
 MSRVTT_full_val/v2t_metrics/R5: 71.22736418511066
 MSRVTT_full_val/v2t_metrics/R10: 84.50704225352112
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.350100603621731
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 57.38116061166349
 MSRVTT_full_test/t2v_metrics/R1: 11.57190635451505
 MSRVTT_full_test/t2v_metrics/R5: 32.14046822742475
 MSRVTT_full_test/t2v_metrics/R10: 45.752508361204015
 MSRVTT_full_test/t2v_metrics/R50: 79.1304347826087
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.33311036789298
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.72116722505311
 MSRVTT_full_test/v2t_metrics/R1: 12.909698996655518
 MSRVTT_full_test/v2t_metrics/R5: 36.55518394648829
 MSRVTT_full_test/v2t_metrics/R10: 52.14046822742475
 MSRVTT_full_test/v2t_metrics/R50: 84.74916387959867
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.83595317725752
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.085732499640837
 mnt_best       : 25.72116722505311
 not_improved_count: 0
Train Epoch: 9 [1/500 64/32000 (0%)] Loss: 0.99301 (QuantReg: 12.41275) QuantErr: 12.41275 batch_time=37.20070 
Train Epoch: 9 [9/500 576/32000 (2%)] Loss: 1.56419 (QuantReg: 12.91445) QuantErr: 12.91445 batch_time=1.08790 
Train Epoch: 9 [17/500 1088/32000 (3%)] Loss: 1.00348 (QuantReg: 12.37836) QuantErr: 12.37836 batch_time=0.38656 
Train Epoch: 9 [25/500 1600/32000 (5%)] Loss: 1.40750 (QuantReg: 12.57606) QuantErr: 12.57606 batch_time=0.38764 
Train Epoch: 9 [33/500 2112/32000 (7%)] Loss: 1.45614 (QuantReg: 12.85848) QuantErr: 12.85848 batch_time=0.39711 
Train Epoch: 9 [41/500 2624/32000 (8%)] Loss: 1.33001 (QuantReg: 12.96681) QuantErr: 12.96681 batch_time=0.39312 
Train Epoch: 9 [49/500 3136/32000 (10%)] Loss: 1.28344 (QuantReg: 13.11897) QuantErr: 13.11897 batch_time=0.40734 
Train Epoch: 9 [57/500 3648/32000 (11%)] Loss: 1.30304 (QuantReg: 12.39273) QuantErr: 12.39273 batch_time=0.40085 
Train Epoch: 9 [65/500 4160/32000 (13%)] Loss: 1.19913 (QuantReg: 12.94129) QuantErr: 12.94129 batch_time=3.37830 
Train Epoch: 9 [73/500 4672/32000 (15%)] Loss: 0.97088 (QuantReg: 12.76013) QuantErr: 12.76013 batch_time=0.93141 
Train Epoch: 9 [81/500 5184/32000 (16%)] Loss: 0.97116 (QuantReg: 13.14869) QuantErr: 13.14869 batch_time=0.43454 
Train Epoch: 9 [89/500 5696/32000 (18%)] Loss: 0.87657 (QuantReg: 12.40771) QuantErr: 12.40771 batch_time=0.40593 
Train Epoch: 9 [97/500 6208/32000 (19%)] Loss: 1.50191 (QuantReg: 12.92896) QuantErr: 12.92896 batch_time=0.45312 
Train Epoch: 9 [105/500 6720/32000 (21%)] Loss: 0.76036 (QuantReg: 12.61481) QuantErr: 12.61481 batch_time=0.39033 
Train Epoch: 9 [113/500 7232/32000 (23%)] Loss: 0.99558 (QuantReg: 12.89333) QuantErr: 12.89333 batch_time=0.39719 
Train Epoch: 9 [121/500 7744/32000 (24%)] Loss: 0.94982 (QuantReg: 13.26719) QuantErr: 13.26719 batch_time=0.39742 
Train Epoch: 9 [129/500 8256/32000 (26%)] Loss: 1.31320 (QuantReg: 13.23901) QuantErr: 13.23901 batch_time=3.27232 
Train Epoch: 9 [137/500 8768/32000 (27%)] Loss: 1.22486 (QuantReg: 12.89528) QuantErr: 12.89528 batch_time=0.86163 
Train Epoch: 9 [145/500 9280/32000 (29%)] Loss: 1.03611 (QuantReg: 12.97437) QuantErr: 12.97437 batch_time=0.39675 
Train Epoch: 9 [153/500 9792/32000 (31%)] Loss: 1.65499 (QuantReg: 13.00704) QuantErr: 13.00704 batch_time=0.43313 
Train Epoch: 9 [161/500 10304/32000 (32%)] Loss: 1.44207 (QuantReg: 12.89951) QuantErr: 12.89951 batch_time=0.43679 
Train Epoch: 9 [169/500 10816/32000 (34%)] Loss: 1.16481 (QuantReg: 13.39339) QuantErr: 13.39339 batch_time=0.39322 
Train Epoch: 9 [177/500 11328/32000 (35%)] Loss: 1.19234 (QuantReg: 12.54849) QuantErr: 12.54849 batch_time=0.40173 
Train Epoch: 9 [185/500 11840/32000 (37%)] Loss: 0.88749 (QuantReg: 13.16688) QuantErr: 13.16688 batch_time=0.40905 
Train Epoch: 9 [193/500 12352/32000 (39%)] Loss: 1.14075 (QuantReg: 12.94091) QuantErr: 12.94091 batch_time=3.16872 
Train Epoch: 9 [201/500 12864/32000 (40%)] Loss: 1.19735 (QuantReg: 13.06623) QuantErr: 13.06623 batch_time=0.95419 
Train Epoch: 9 [209/500 13376/32000 (42%)] Loss: 0.92110 (QuantReg: 12.64684) QuantErr: 12.64684 batch_time=0.39426 
Train Epoch: 9 [217/500 13888/32000 (43%)] Loss: 0.70848 (QuantReg: 12.83695) QuantErr: 12.83695 batch_time=0.41585 
Train Epoch: 9 [225/500 14400/32000 (45%)] Loss: 0.90654 (QuantReg: 13.13364) QuantErr: 13.13364 batch_time=0.40400 
Train Epoch: 9 [233/500 14912/32000 (47%)] Loss: 1.19296 (QuantReg: 13.23134) QuantErr: 13.23134 batch_time=0.40369 
Train Epoch: 9 [241/500 15424/32000 (48%)] Loss: 1.07528 (QuantReg: 12.74262) QuantErr: 12.74262 batch_time=0.40238 
Train Epoch: 9 [249/500 15936/32000 (50%)] Loss: 1.07001 (QuantReg: 13.17001) QuantErr: 13.17001 batch_time=0.39806 
Train Epoch: 9 [257/500 16448/32000 (51%)] Loss: 1.41199 (QuantReg: 12.61368) QuantErr: 12.61368 batch_time=3.51889 
Train Epoch: 9 [265/500 16960/32000 (53%)] Loss: 1.20044 (QuantReg: 13.14703) QuantErr: 13.14703 batch_time=0.93228 
Train Epoch: 9 [273/500 17472/32000 (55%)] Loss: 0.96192 (QuantReg: 12.68074) QuantErr: 12.68074 batch_time=0.38831 
Train Epoch: 9 [281/500 17984/32000 (56%)] Loss: 1.15824 (QuantReg: 12.72560) QuantErr: 12.72560 batch_time=0.38991 
Train Epoch: 9 [289/500 18496/32000 (58%)] Loss: 1.20939 (QuantReg: 12.76869) QuantErr: 12.76869 batch_time=0.38947 
Train Epoch: 9 [297/500 19008/32000 (59%)] Loss: 1.12990 (QuantReg: 12.62537) QuantErr: 12.62537 batch_time=0.39538 
Train Epoch: 9 [305/500 19520/32000 (61%)] Loss: 2.00929 (QuantReg: 12.47133) QuantErr: 12.47133 batch_time=0.41085 
Train Epoch: 9 [313/500 20032/32000 (63%)] Loss: 1.44918 (QuantReg: 12.88950) QuantErr: 12.88950 batch_time=0.39336 
Train Epoch: 9 [321/500 20544/32000 (64%)] Loss: 1.17321 (QuantReg: 12.72644) QuantErr: 12.72644 batch_time=3.23659 
Train Epoch: 9 [329/500 21056/32000 (66%)] Loss: 0.97131 (QuantReg: 13.35077) QuantErr: 13.35077 batch_time=0.92712 
Train Epoch: 9 [337/500 21568/32000 (67%)] Loss: 1.47357 (QuantReg: 13.27653) QuantErr: 13.27653 batch_time=0.39488 
Train Epoch: 9 [345/500 22080/32000 (69%)] Loss: 0.67121 (QuantReg: 13.09030) QuantErr: 13.09030 batch_time=0.39994 
Train Epoch: 9 [353/500 22592/32000 (71%)] Loss: 1.32708 (QuantReg: 12.87153) QuantErr: 12.87153 batch_time=0.40322 
Train Epoch: 9 [361/500 23104/32000 (72%)] Loss: 0.99112 (QuantReg: 12.82763) QuantErr: 12.82763 batch_time=0.39581 
Train Epoch: 9 [369/500 23616/32000 (74%)] Loss: 1.38739 (QuantReg: 13.50712) QuantErr: 13.50712 batch_time=0.40183 
Train Epoch: 9 [377/500 24128/32000 (75%)] Loss: 0.94479 (QuantReg: 13.12572) QuantErr: 13.12572 batch_time=0.40268 
Train Epoch: 9 [385/500 24640/32000 (77%)] Loss: 1.28195 (QuantReg: 13.18961) QuantErr: 13.18961 batch_time=2.48783 
Train Epoch: 9 [393/500 25152/32000 (79%)] Loss: 1.08318 (QuantReg: 12.52872) QuantErr: 12.52872 batch_time=0.88514 
Train Epoch: 9 [401/500 25664/32000 (80%)] Loss: 1.31621 (QuantReg: 12.94578) QuantErr: 12.94578 batch_time=0.38674 
Train Epoch: 9 [409/500 26176/32000 (82%)] Loss: 1.10541 (QuantReg: 13.23524) QuantErr: 13.23524 batch_time=0.39530 
Train Epoch: 9 [417/500 26688/32000 (83%)] Loss: 0.82774 (QuantReg: 13.16464) QuantErr: 13.16464 batch_time=0.38231 
Train Epoch: 9 [425/500 27200/32000 (85%)] Loss: 1.21399 (QuantReg: 13.04692) QuantErr: 13.04692 batch_time=0.39340 
Train Epoch: 9 [433/500 27712/32000 (87%)] Loss: 1.30288 (QuantReg: 12.89965) QuantErr: 12.89965 batch_time=0.42860 
Train Epoch: 9 [441/500 28224/32000 (88%)] Loss: 1.10373 (QuantReg: 13.35847) QuantErr: 13.35847 batch_time=0.40495 
Train Epoch: 9 [449/500 28736/32000 (90%)] Loss: 0.94747 (QuantReg: 13.32613) QuantErr: 13.32613 batch_time=2.92556 
Train Epoch: 9 [457/500 29248/32000 (91%)] Loss: 0.97375 (QuantReg: 13.12235) QuantErr: 13.12235 batch_time=0.95021 
Train Epoch: 9 [465/500 29760/32000 (93%)] Loss: 1.11510 (QuantReg: 13.00614) QuantErr: 13.00614 batch_time=0.40545 
Train Epoch: 9 [473/500 30272/32000 (95%)] Loss: 1.51550 (QuantReg: 12.67106) QuantErr: 12.67106 batch_time=0.40581 
Train Epoch: 9 [481/500 30784/32000 (96%)] Loss: 0.73549 (QuantReg: 13.38323) QuantErr: 13.38323 batch_time=0.43336 
Train Epoch: 9 [489/500 31296/32000 (98%)] Loss: 0.84881 (QuantReg: 13.31977) QuantErr: 13.31977 batch_time=0.40123 
Train Epoch: 9 [497/500 31808/32000 (99%)] Loss: 1.43438 (QuantReg: 13.37441) QuantErr: 13.37441 batch_time=0.39454 
Train Epoch: 9 codebook_update_time=1.94753
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch9.pth ...
Done in 6.260s
removing stale ckpt [epoch 8] [took 0.00s]
 epoch          : 9
 loss           : 1.0975127683877945
 quant_reg      : 12.951545705795288
 quant_err      : 12.951545705795288
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 30.18108651911469
 MSRVTT_full_val/t2v_metrics/R5: 67.6056338028169
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.808853118712275
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.078900202825814
 MSRVTT_full_val/v2t_metrics/R1: 30.18108651911469
 MSRVTT_full_val/v2t_metrics/R5: 71.0261569416499
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.5
 MSRVTT_full_val/v2t_metrics/MeanR: 7.279678068410463
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.98379428060564
 MSRVTT_full_test/t2v_metrics/R1: 11.33779264214047
 MSRVTT_full_test/t2v_metrics/R5: 32.10702341137124
 MSRVTT_full_test/t2v_metrics/R10: 46.08695652173913
 MSRVTT_full_test/t2v_metrics/R50: 78.62876254180603
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.1886287625418
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.599738435635683
 MSRVTT_full_test/v2t_metrics/R1: 13.076923076923077
 MSRVTT_full_test/v2t_metrics/R5: 37.95986622073578
 MSRVTT_full_test/v2t_metrics/R10: 51.67224080267559
 MSRVTT_full_test/v2t_metrics/R50: 85.08361204013377
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.66020066889632
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.491430983504625
 mnt_best       : 25.72116722505311
 not_improved_count: 1
Train Epoch: 10 [1/500 64/32000 (0%)] Loss: 1.21743 (QuantReg: 12.55114) QuantErr: 12.55114 batch_time=31.86667 
Train Epoch: 10 [9/500 576/32000 (2%)] Loss: 1.30446 (QuantReg: 12.50844) QuantErr: 12.50844 batch_time=0.52900 
Train Epoch: 10 [17/500 1088/32000 (3%)] Loss: 1.14100 (QuantReg: 13.05088) QuantErr: 13.05088 batch_time=0.42061 
Train Epoch: 10 [25/500 1600/32000 (5%)] Loss: 1.30704 (QuantReg: 12.87575) QuantErr: 12.87575 batch_time=0.39828 
Train Epoch: 10 [33/500 2112/32000 (7%)] Loss: 0.99231 (QuantReg: 13.36550) QuantErr: 13.36550 batch_time=0.40137 
Train Epoch: 10 [41/500 2624/32000 (8%)] Loss: 1.22062 (QuantReg: 12.97822) QuantErr: 12.97822 batch_time=0.39015 
Train Epoch: 10 [49/500 3136/32000 (10%)] Loss: 0.84051 (QuantReg: 12.66910) QuantErr: 12.66910 batch_time=0.40720 
Train Epoch: 10 [57/500 3648/32000 (11%)] Loss: 1.07763 (QuantReg: 12.53628) QuantErr: 12.53628 batch_time=0.39548 
Train Epoch: 10 [65/500 4160/32000 (13%)] Loss: 0.97293 (QuantReg: 13.10969) QuantErr: 13.10969 batch_time=0.98427 
Train Epoch: 10 [73/500 4672/32000 (15%)] Loss: 0.88025 (QuantReg: 12.94204) QuantErr: 12.94204 batch_time=0.49070 
Train Epoch: 10 [81/500 5184/32000 (16%)] Loss: 1.49725 (QuantReg: 12.41544) QuantErr: 12.41544 batch_time=0.39627 
Train Epoch: 10 [89/500 5696/32000 (18%)] Loss: 1.09080 (QuantReg: 13.49733) QuantErr: 13.49733 batch_time=0.38231 
Train Epoch: 10 [97/500 6208/32000 (19%)] Loss: 1.20534 (QuantReg: 13.23562) QuantErr: 13.23562 batch_time=0.39253 
Train Epoch: 10 [105/500 6720/32000 (21%)] Loss: 1.11355 (QuantReg: 12.88113) QuantErr: 12.88113 batch_time=0.38985 
Train Epoch: 10 [113/500 7232/32000 (23%)] Loss: 1.14780 (QuantReg: 12.81526) QuantErr: 12.81526 batch_time=0.38494 
Train Epoch: 10 [121/500 7744/32000 (24%)] Loss: 1.14201 (QuantReg: 12.77704) QuantErr: 12.77704 batch_time=0.37883 
Train Epoch: 10 [129/500 8256/32000 (26%)] Loss: 0.94397 (QuantReg: 13.22020) QuantErr: 13.22020 batch_time=0.98779 
Train Epoch: 10 [137/500 8768/32000 (27%)] Loss: 0.94164 (QuantReg: 13.09801) QuantErr: 13.09801 batch_time=0.49877 
Train Epoch: 10 [145/500 9280/32000 (29%)] Loss: 0.90915 (QuantReg: 13.11936) QuantErr: 13.11936 batch_time=0.38357 
Train Epoch: 10 [153/500 9792/32000 (31%)] Loss: 0.97945 (QuantReg: 13.32184) QuantErr: 13.32184 batch_time=0.39142 
Train Epoch: 10 [161/500 10304/32000 (32%)] Loss: 1.26774 (QuantReg: 12.53972) QuantErr: 12.53972 batch_time=0.39472 
Train Epoch: 10 [169/500 10816/32000 (34%)] Loss: 0.98119 (QuantReg: 13.27003) QuantErr: 13.27003 batch_time=0.39564 
Train Epoch: 10 [177/500 11328/32000 (35%)] Loss: 0.91809 (QuantReg: 12.63776) QuantErr: 12.63776 batch_time=0.39255 
Train Epoch: 10 [185/500 11840/32000 (37%)] Loss: 1.00212 (QuantReg: 12.96832) QuantErr: 12.96832 batch_time=0.38715 
Train Epoch: 10 [193/500 12352/32000 (39%)] Loss: 0.73963 (QuantReg: 13.09420) QuantErr: 13.09420 batch_time=0.99647 
Train Epoch: 10 [201/500 12864/32000 (40%)] Loss: 0.70908 (QuantReg: 13.02488) QuantErr: 13.02488 batch_time=0.49566 
Train Epoch: 10 [209/500 13376/32000 (42%)] Loss: 0.98189 (QuantReg: 13.45501) QuantErr: 13.45501 batch_time=0.39509 
Train Epoch: 10 [217/500 13888/32000 (43%)] Loss: 0.91087 (QuantReg: 12.96184) QuantErr: 12.96184 batch_time=0.38259 
Train Epoch: 10 [225/500 14400/32000 (45%)] Loss: 0.81167 (QuantReg: 12.97553) QuantErr: 12.97553 batch_time=0.39303 
Train Epoch: 10 [233/500 14912/32000 (47%)] Loss: 1.13949 (QuantReg: 13.31650) QuantErr: 13.31650 batch_time=0.38942 
Train Epoch: 10 [241/500 15424/32000 (48%)] Loss: 0.79389 (QuantReg: 13.21083) QuantErr: 13.21083 batch_time=0.39457 
Train Epoch: 10 [249/500 15936/32000 (50%)] Loss: 1.13609 (QuantReg: 12.70692) QuantErr: 12.70692 batch_time=0.40740 
Train Epoch: 10 [257/500 16448/32000 (51%)] Loss: 0.86583 (QuantReg: 12.61931) QuantErr: 12.61931 batch_time=1.02216 
Train Epoch: 10 [265/500 16960/32000 (53%)] Loss: 1.06241 (QuantReg: 12.69277) QuantErr: 12.69277 batch_time=0.51326 
Train Epoch: 10 [273/500 17472/32000 (55%)] Loss: 0.67079 (QuantReg: 13.30502) QuantErr: 13.30502 batch_time=0.38300 
Train Epoch: 10 [281/500 17984/32000 (56%)] Loss: 0.83757 (QuantReg: 12.84900) QuantErr: 12.84900 batch_time=0.38854 
Train Epoch: 10 [289/500 18496/32000 (58%)] Loss: 1.65232 (QuantReg: 12.99820) QuantErr: 12.99820 batch_time=0.40134 
Train Epoch: 10 [297/500 19008/32000 (59%)] Loss: 0.97845 (QuantReg: 12.86096) QuantErr: 12.86096 batch_time=0.40837 
Train Epoch: 10 [305/500 19520/32000 (61%)] Loss: 0.96412 (QuantReg: 13.26554) QuantErr: 13.26554 batch_time=0.38802 
Train Epoch: 10 [313/500 20032/32000 (63%)] Loss: 1.13493 (QuantReg: 12.94842) QuantErr: 12.94842 batch_time=0.38910 
Train Epoch: 10 [321/500 20544/32000 (64%)] Loss: 1.03143 (QuantReg: 13.01347) QuantErr: 13.01347 batch_time=1.01354 
Train Epoch: 10 [329/500 21056/32000 (66%)] Loss: 0.85884 (QuantReg: 12.68737) QuantErr: 12.68737 batch_time=0.48803 
Train Epoch: 10 [337/500 21568/32000 (67%)] Loss: 1.36951 (QuantReg: 13.28449) QuantErr: 13.28449 batch_time=0.40363 
Train Epoch: 10 [345/500 22080/32000 (69%)] Loss: 1.37459 (QuantReg: 13.14789) QuantErr: 13.14789 batch_time=0.39751 
Train Epoch: 10 [353/500 22592/32000 (71%)] Loss: 1.19098 (QuantReg: 13.33967) QuantErr: 13.33967 batch_time=0.39974 
Train Epoch: 10 [361/500 23104/32000 (72%)] Loss: 1.07674 (QuantReg: 13.27983) QuantErr: 13.27983 batch_time=0.40115 
Train Epoch: 10 [369/500 23616/32000 (74%)] Loss: 0.50868 (QuantReg: 13.38255) QuantErr: 13.38255 batch_time=0.39948 
Train Epoch: 10 [377/500 24128/32000 (75%)] Loss: 0.73452 (QuantReg: 13.16714) QuantErr: 13.16714 batch_time=0.39003 
Train Epoch: 10 [385/500 24640/32000 (77%)] Loss: 0.93910 (QuantReg: 13.00899) QuantErr: 13.00899 batch_time=0.99731 
Train Epoch: 10 [393/500 25152/32000 (79%)] Loss: 1.04168 (QuantReg: 12.96482) QuantErr: 12.96482 batch_time=0.50083 
Train Epoch: 10 [401/500 25664/32000 (80%)] Loss: 1.06017 (QuantReg: 13.54192) QuantErr: 13.54192 batch_time=0.42302 
Train Epoch: 10 [409/500 26176/32000 (82%)] Loss: 0.73752 (QuantReg: 13.08843) QuantErr: 13.08843 batch_time=0.38634 
Train Epoch: 10 [417/500 26688/32000 (83%)] Loss: 0.78495 (QuantReg: 12.98664) QuantErr: 12.98664 batch_time=0.39731 
Train Epoch: 10 [425/500 27200/32000 (85%)] Loss: 0.87971 (QuantReg: 12.75692) QuantErr: 12.75692 batch_time=0.39363 
Train Epoch: 10 [433/500 27712/32000 (87%)] Loss: 1.03236 (QuantReg: 13.45924) QuantErr: 13.45924 batch_time=0.40472 
Train Epoch: 10 [441/500 28224/32000 (88%)] Loss: 1.13670 (QuantReg: 12.88276) QuantErr: 12.88276 batch_time=0.39165 
Train Epoch: 10 [449/500 28736/32000 (90%)] Loss: 1.04769 (QuantReg: 13.50130) QuantErr: 13.50130 batch_time=0.98880 
Train Epoch: 10 [457/500 29248/32000 (91%)] Loss: 1.22753 (QuantReg: 13.07645) QuantErr: 13.07645 batch_time=0.49587 
Train Epoch: 10 [465/500 29760/32000 (93%)] Loss: 0.98998 (QuantReg: 12.98025) QuantErr: 12.98025 batch_time=0.37686 
Train Epoch: 10 [473/500 30272/32000 (95%)] Loss: 1.43515 (QuantReg: 12.83137) QuantErr: 12.83137 batch_time=0.39500 
Train Epoch: 10 [481/500 30784/32000 (96%)] Loss: 0.81006 (QuantReg: 13.17755) QuantErr: 13.17755 batch_time=0.38827 
Train Epoch: 10 [489/500 31296/32000 (98%)] Loss: 1.61056 (QuantReg: 12.57844) QuantErr: 12.57844 batch_time=0.39022 
Train Epoch: 10 [497/500 31808/32000 (99%)] Loss: 0.84315 (QuantReg: 12.98971) QuantErr: 12.98971 batch_time=0.40763 
Train Epoch: 10 codebook_update_time=1.91865
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch10.pth ...
Done in 4.243s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch10.pth ...
Done in 8.556s
removing stale ckpt [epoch 9] [took 0.27s]
 epoch          : 10
 loss           : 1.056686240553856
 quant_reg      : 12.992779052734376
 quant_err      : 12.992779052734376
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.841046277665995
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.991406066838486
 MSRVTT_full_val/v2t_metrics/R1: 33.199195171026155
 MSRVTT_full_val/v2t_metrics/R5: 72.23340040241449
 MSRVTT_full_val/v2t_metrics/R10: 84.70824949698189
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.313883299798793
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.784627985918895
 MSRVTT_full_test/t2v_metrics/R1: 12.006688963210703
 MSRVTT_full_test/t2v_metrics/R5: 33.979933110367895
 MSRVTT_full_test/t2v_metrics/R10: 47.458193979933114
 MSRVTT_full_test/t2v_metrics/R50: 80.60200668896321
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.112876254180605
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.852557939940137
 MSRVTT_full_test/v2t_metrics/R1: 13.812709030100335
 MSRVTT_full_test/v2t_metrics/R5: 39.23076923076923
 MSRVTT_full_test/v2t_metrics/R10: 54.180602006688964
 MSRVTT_full_test/v2t_metrics/R50: 85.95317725752508
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.125083612040136
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.849621345277853
 mnt_best       : 26.852557939940137
 not_improved_count: 0
Train Epoch: 11 [1/500 64/32000 (0%)] Loss: 0.78247 (QuantReg: 12.73108) QuantErr: 12.73108 batch_time=29.44735 
Train Epoch: 11 [9/500 576/32000 (2%)] Loss: 1.19039 (QuantReg: 12.79721) QuantErr: 12.79721 batch_time=0.39549 
Train Epoch: 11 [17/500 1088/32000 (3%)] Loss: 0.86065 (QuantReg: 12.69186) QuantErr: 12.69186 batch_time=0.39088 
Train Epoch: 11 [25/500 1600/32000 (5%)] Loss: 0.73120 (QuantReg: 12.79214) QuantErr: 12.79214 batch_time=0.49443 
Train Epoch: 11 [33/500 2112/32000 (7%)] Loss: 1.06692 (QuantReg: 12.89256) QuantErr: 12.89256 batch_time=0.38902 
Train Epoch: 11 [41/500 2624/32000 (8%)] Loss: 0.69828 (QuantReg: 12.65946) QuantErr: 12.65946 batch_time=0.39325 
Train Epoch: 11 [49/500 3136/32000 (10%)] Loss: 0.81577 (QuantReg: 12.78143) QuantErr: 12.78143 batch_time=0.38952 
Train Epoch: 11 [57/500 3648/32000 (11%)] Loss: 1.51633 (QuantReg: 12.75477) QuantErr: 12.75477 batch_time=0.40979 
Train Epoch: 11 [65/500 4160/32000 (13%)] Loss: 0.71092 (QuantReg: 13.23252) QuantErr: 13.23252 batch_time=0.52068 
Train Epoch: 11 [73/500 4672/32000 (15%)] Loss: 0.82008 (QuantReg: 12.46499) QuantErr: 12.46499 batch_time=0.39576 
Train Epoch: 11 [81/500 5184/32000 (16%)] Loss: 1.37533 (QuantReg: 13.00084) QuantErr: 13.00084 batch_time=0.39615 
Train Epoch: 11 [89/500 5696/32000 (18%)] Loss: 1.20309 (QuantReg: 13.38768) QuantErr: 13.38768 batch_time=0.57564 
Train Epoch: 11 [97/500 6208/32000 (19%)] Loss: 0.97659 (QuantReg: 12.97411) QuantErr: 12.97411 batch_time=0.37720 
Train Epoch: 11 [105/500 6720/32000 (21%)] Loss: 0.79932 (QuantReg: 12.88292) QuantErr: 12.88292 batch_time=0.38769 
Train Epoch: 11 [113/500 7232/32000 (23%)] Loss: 1.37787 (QuantReg: 13.01181) QuantErr: 13.01181 batch_time=0.38573 
Train Epoch: 11 [121/500 7744/32000 (24%)] Loss: 0.79244 (QuantReg: 12.55779) QuantErr: 12.55779 batch_time=0.41941 
Train Epoch: 11 [129/500 8256/32000 (26%)] Loss: 1.01865 (QuantReg: 13.16488) QuantErr: 13.16488 batch_time=0.50724 
Train Epoch: 11 [137/500 8768/32000 (27%)] Loss: 0.99001 (QuantReg: 12.99687) QuantErr: 12.99687 batch_time=0.38725 
Train Epoch: 11 [145/500 9280/32000 (29%)] Loss: 1.16661 (QuantReg: 12.84306) QuantErr: 12.84306 batch_time=0.40447 
Train Epoch: 11 [153/500 9792/32000 (31%)] Loss: 0.81905 (QuantReg: 13.24728) QuantErr: 13.24728 batch_time=0.53423 
Train Epoch: 11 [161/500 10304/32000 (32%)] Loss: 1.19133 (QuantReg: 13.38439) QuantErr: 13.38439 batch_time=0.40879 
Train Epoch: 11 [169/500 10816/32000 (34%)] Loss: 0.91505 (QuantReg: 12.99349) QuantErr: 12.99349 batch_time=0.41340 
Train Epoch: 11 [177/500 11328/32000 (35%)] Loss: 1.44580 (QuantReg: 12.82535) QuantErr: 12.82535 batch_time=0.39257 
Train Epoch: 11 [185/500 11840/32000 (37%)] Loss: 0.78185 (QuantReg: 12.96786) QuantErr: 12.96786 batch_time=0.39419 
Train Epoch: 11 [193/500 12352/32000 (39%)] Loss: 1.09938 (QuantReg: 13.15600) QuantErr: 13.15600 batch_time=0.51034 
Train Epoch: 11 [201/500 12864/32000 (40%)] Loss: 0.79199 (QuantReg: 13.15815) QuantErr: 13.15815 batch_time=0.40724 
Train Epoch: 11 [209/500 13376/32000 (42%)] Loss: 1.25406 (QuantReg: 12.84771) QuantErr: 12.84771 batch_time=0.39447 
Train Epoch: 11 [217/500 13888/32000 (43%)] Loss: 0.89938 (QuantReg: 12.64537) QuantErr: 12.64537 batch_time=0.48738 
Train Epoch: 11 [225/500 14400/32000 (45%)] Loss: 0.82811 (QuantReg: 12.95800) QuantErr: 12.95800 batch_time=0.38978 
Train Epoch: 11 [233/500 14912/32000 (47%)] Loss: 1.16255 (QuantReg: 13.03458) QuantErr: 13.03458 batch_time=0.38912 
Train Epoch: 11 [241/500 15424/32000 (48%)] Loss: 1.35754 (QuantReg: 12.80601) QuantErr: 12.80601 batch_time=0.39115 
Train Epoch: 11 [249/500 15936/32000 (50%)] Loss: 0.83021 (QuantReg: 12.54846) QuantErr: 12.54846 batch_time=0.43136 
Train Epoch: 11 [257/500 16448/32000 (51%)] Loss: 0.90099 (QuantReg: 12.95085) QuantErr: 12.95085 batch_time=0.50631 
Train Epoch: 11 [265/500 16960/32000 (53%)] Loss: 0.87360 (QuantReg: 12.56878) QuantErr: 12.56878 batch_time=0.39332 
Train Epoch: 11 [273/500 17472/32000 (55%)] Loss: 0.77531 (QuantReg: 13.45700) QuantErr: 13.45700 batch_time=0.40057 
Train Epoch: 11 [281/500 17984/32000 (56%)] Loss: 0.79934 (QuantReg: 13.41617) QuantErr: 13.41617 batch_time=0.51043 
Train Epoch: 11 [289/500 18496/32000 (58%)] Loss: 1.10466 (QuantReg: 12.75807) QuantErr: 12.75807 batch_time=0.39309 
Train Epoch: 11 [297/500 19008/32000 (59%)] Loss: 0.95527 (QuantReg: 13.05312) QuantErr: 13.05312 batch_time=0.42759 
Train Epoch: 11 [305/500 19520/32000 (61%)] Loss: 0.94701 (QuantReg: 12.96653) QuantErr: 12.96653 batch_time=0.40611 
Train Epoch: 11 [313/500 20032/32000 (63%)] Loss: 1.31145 (QuantReg: 12.89198) QuantErr: 12.89198 batch_time=0.39616 
Train Epoch: 11 [321/500 20544/32000 (64%)] Loss: 1.27353 (QuantReg: 13.00519) QuantErr: 13.00519 batch_time=0.49404 
Train Epoch: 11 [329/500 21056/32000 (66%)] Loss: 0.76278 (QuantReg: 12.99180) QuantErr: 12.99180 batch_time=0.46919 
Train Epoch: 11 [337/500 21568/32000 (67%)] Loss: 0.86500 (QuantReg: 13.46255) QuantErr: 13.46255 batch_time=0.38896 
Train Epoch: 11 [345/500 22080/32000 (69%)] Loss: 1.11939 (QuantReg: 12.72671) QuantErr: 12.72671 batch_time=0.51397 
Train Epoch: 11 [353/500 22592/32000 (71%)] Loss: 0.76460 (QuantReg: 13.05371) QuantErr: 13.05371 batch_time=0.39263 
Train Epoch: 11 [361/500 23104/32000 (72%)] Loss: 0.98304 (QuantReg: 12.87584) QuantErr: 12.87584 batch_time=0.39214 
Train Epoch: 11 [369/500 23616/32000 (74%)] Loss: 1.37887 (QuantReg: 13.09581) QuantErr: 13.09581 batch_time=0.39272 
Train Epoch: 11 [377/500 24128/32000 (75%)] Loss: 0.93625 (QuantReg: 13.30362) QuantErr: 13.30362 batch_time=0.40110 
Train Epoch: 11 [385/500 24640/32000 (77%)] Loss: 1.04313 (QuantReg: 12.61802) QuantErr: 12.61802 batch_time=0.51718 
Train Epoch: 11 [393/500 25152/32000 (79%)] Loss: 1.13802 (QuantReg: 13.02868) QuantErr: 13.02868 batch_time=0.39607 
Train Epoch: 11 [401/500 25664/32000 (80%)] Loss: 1.02689 (QuantReg: 13.28751) QuantErr: 13.28751 batch_time=0.39708 
Train Epoch: 11 [409/500 26176/32000 (82%)] Loss: 1.30383 (QuantReg: 12.94076) QuantErr: 12.94076 batch_time=0.52101 
Train Epoch: 11 [417/500 26688/32000 (83%)] Loss: 1.39560 (QuantReg: 12.93338) QuantErr: 12.93338 batch_time=0.39498 
Train Epoch: 11 [425/500 27200/32000 (85%)] Loss: 1.09411 (QuantReg: 13.08638) QuantErr: 13.08638 batch_time=0.39822 
Train Epoch: 11 [433/500 27712/32000 (87%)] Loss: 1.07201 (QuantReg: 13.39861) QuantErr: 13.39861 batch_time=0.39631 
Train Epoch: 11 [441/500 28224/32000 (88%)] Loss: 0.89816 (QuantReg: 13.19790) QuantErr: 13.19790 batch_time=0.39342 
Train Epoch: 11 [449/500 28736/32000 (90%)] Loss: 1.06970 (QuantReg: 13.38757) QuantErr: 13.38757 batch_time=0.51122 
Train Epoch: 11 [457/500 29248/32000 (91%)] Loss: 0.76596 (QuantReg: 13.35050) QuantErr: 13.35050 batch_time=0.39203 
Train Epoch: 11 [465/500 29760/32000 (93%)] Loss: 0.55798 (QuantReg: 13.24350) QuantErr: 13.24350 batch_time=0.39726 
Train Epoch: 11 [473/500 30272/32000 (95%)] Loss: 0.95003 (QuantReg: 13.05554) QuantErr: 13.05554 batch_time=0.50084 
Train Epoch: 11 [481/500 30784/32000 (96%)] Loss: 1.01533 (QuantReg: 12.91861) QuantErr: 12.91861 batch_time=0.38586 
Train Epoch: 11 [489/500 31296/32000 (98%)] Loss: 1.15623 (QuantReg: 13.16160) QuantErr: 13.16160 batch_time=0.40725 
Train Epoch: 11 [497/500 31808/32000 (99%)] Loss: 0.88767 (QuantReg: 13.02172) QuantErr: 13.02172 batch_time=0.39060 
Train Epoch: 11 codebook_update_time=1.87547
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch11.pth ...
Done in 22.516s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 0.9679991629123688
 quant_reg      : 13.040896072387696
 quant_err      : 13.040896072387696
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 79.67806841046277
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.613682092555333
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.70373913099374
 MSRVTT_full_val/v2t_metrics/R1: 34.00402414486921
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.617706237424548
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.27851889134569
 MSRVTT_full_test/t2v_metrics/R1: 12.006688963210703
 MSRVTT_full_test/t2v_metrics/R5: 33.812709030100336
 MSRVTT_full_test/t2v_metrics/R10: 46.98996655518395
 MSRVTT_full_test/t2v_metrics/R50: 79.96655518394648
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.91036789297659
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.719979533212296
 MSRVTT_full_test/v2t_metrics/R1: 14.080267558528428
 MSRVTT_full_test/v2t_metrics/R5: 39.46488294314381
 MSRVTT_full_test/v2t_metrics/R10: 54.54849498327759
 MSRVTT_full_test/v2t_metrics/R50: 85.58528428093645
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.31923076923077
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.179429636588864
 mnt_best       : 26.852557939940137
 not_improved_count: 1
Train Epoch: 12 [1/500 64/32000 (0%)] Loss: 0.67585 (QuantReg: 12.61432) QuantErr: 12.61432 batch_time=31.28252 
Train Epoch: 12 [9/500 576/32000 (2%)] Loss: 0.71572 (QuantReg: 12.46259) QuantErr: 12.46259 batch_time=0.39899 
Train Epoch: 12 [17/500 1088/32000 (3%)] Loss: 0.98648 (QuantReg: 12.75526) QuantErr: 12.75526 batch_time=0.40720 
Train Epoch: 12 [25/500 1600/32000 (5%)] Loss: 1.11536 (QuantReg: 13.10786) QuantErr: 13.10786 batch_time=0.38706 
Train Epoch: 12 [33/500 2112/32000 (7%)] Loss: 0.95279 (QuantReg: 13.40975) QuantErr: 13.40975 batch_time=0.38322 
Train Epoch: 12 [41/500 2624/32000 (8%)] Loss: 0.73043 (QuantReg: 13.01803) QuantErr: 13.01803 batch_time=0.39796 
Train Epoch: 12 [49/500 3136/32000 (10%)] Loss: 0.75500 (QuantReg: 12.91518) QuantErr: 12.91518 batch_time=0.39353 
Train Epoch: 12 [57/500 3648/32000 (11%)] Loss: 1.19326 (QuantReg: 12.58331) QuantErr: 12.58331 batch_time=0.38711 
Train Epoch: 12 [65/500 4160/32000 (13%)] Loss: 0.86625 (QuantReg: 12.80226) QuantErr: 12.80226 batch_time=1.44362 
Train Epoch: 12 [73/500 4672/32000 (15%)] Loss: 0.89818 (QuantReg: 12.63300) QuantErr: 12.63300 batch_time=0.39216 
Train Epoch: 12 [81/500 5184/32000 (16%)] Loss: 0.77402 (QuantReg: 12.82711) QuantErr: 12.82711 batch_time=0.44478 
Train Epoch: 12 [89/500 5696/32000 (18%)] Loss: 0.55803 (QuantReg: 13.13320) QuantErr: 13.13320 batch_time=0.44516 
Train Epoch: 12 [97/500 6208/32000 (19%)] Loss: 0.90529 (QuantReg: 13.26583) QuantErr: 13.26583 batch_time=0.39844 
Train Epoch: 12 [105/500 6720/32000 (21%)] Loss: 0.93990 (QuantReg: 12.90464) QuantErr: 12.90464 batch_time=0.39033 
Train Epoch: 12 [113/500 7232/32000 (23%)] Loss: 0.68669 (QuantReg: 13.19184) QuantErr: 13.19184 batch_time=0.40835 
Train Epoch: 12 [121/500 7744/32000 (24%)] Loss: 1.49718 (QuantReg: 13.30094) QuantErr: 13.30094 batch_time=0.39164 
Train Epoch: 12 [129/500 8256/32000 (26%)] Loss: 1.18772 (QuantReg: 12.73186) QuantErr: 12.73186 batch_time=1.43861 
Train Epoch: 12 [137/500 8768/32000 (27%)] Loss: 0.99899 (QuantReg: 12.88860) QuantErr: 12.88860 batch_time=0.39099 
Train Epoch: 12 [145/500 9280/32000 (29%)] Loss: 0.95573 (QuantReg: 12.73690) QuantErr: 12.73690 batch_time=0.39745 
Train Epoch: 12 [153/500 9792/32000 (31%)] Loss: 0.86956 (QuantReg: 13.05674) QuantErr: 13.05674 batch_time=0.39769 
Train Epoch: 12 [161/500 10304/32000 (32%)] Loss: 0.88138 (QuantReg: 12.95086) QuantErr: 12.95086 batch_time=0.39350 
Train Epoch: 12 [169/500 10816/32000 (34%)] Loss: 0.69886 (QuantReg: 13.14902) QuantErr: 13.14902 batch_time=0.39846 
Train Epoch: 12 [177/500 11328/32000 (35%)] Loss: 0.71774 (QuantReg: 13.33210) QuantErr: 13.33210 batch_time=0.38980 
Train Epoch: 12 [185/500 11840/32000 (37%)] Loss: 0.91646 (QuantReg: 12.89617) QuantErr: 12.89617 batch_time=0.38549 
Train Epoch: 12 [193/500 12352/32000 (39%)] Loss: 0.93669 (QuantReg: 12.86454) QuantErr: 12.86454 batch_time=1.41945 
Train Epoch: 12 [201/500 12864/32000 (40%)] Loss: 1.03281 (QuantReg: 13.20544) QuantErr: 13.20544 batch_time=0.39879 
Train Epoch: 12 [209/500 13376/32000 (42%)] Loss: 0.93589 (QuantReg: 12.51750) QuantErr: 12.51750 batch_time=0.39364 
Train Epoch: 12 [217/500 13888/32000 (43%)] Loss: 0.82114 (QuantReg: 13.13351) QuantErr: 13.13351 batch_time=0.38593 
Train Epoch: 12 [225/500 14400/32000 (45%)] Loss: 0.85476 (QuantReg: 13.11498) QuantErr: 13.11498 batch_time=0.38938 
Train Epoch: 12 [233/500 14912/32000 (47%)] Loss: 0.89463 (QuantReg: 13.25564) QuantErr: 13.25564 batch_time=0.39312 
Train Epoch: 12 [241/500 15424/32000 (48%)] Loss: 1.29640 (QuantReg: 12.85095) QuantErr: 12.85095 batch_time=0.39254 
Train Epoch: 12 [249/500 15936/32000 (50%)] Loss: 0.92288 (QuantReg: 12.83758) QuantErr: 12.83758 batch_time=0.39497 
Train Epoch: 12 [257/500 16448/32000 (51%)] Loss: 0.94646 (QuantReg: 13.16188) QuantErr: 13.16188 batch_time=1.43315 
Train Epoch: 12 [265/500 16960/32000 (53%)] Loss: 0.93916 (QuantReg: 12.90796) QuantErr: 12.90796 batch_time=0.39714 
Train Epoch: 12 [273/500 17472/32000 (55%)] Loss: 1.20615 (QuantReg: 12.68086) QuantErr: 12.68086 batch_time=0.40139 
Train Epoch: 12 [281/500 17984/32000 (56%)] Loss: 0.58151 (QuantReg: 12.91295) QuantErr: 12.91295 batch_time=0.39597 
Train Epoch: 12 [289/500 18496/32000 (58%)] Loss: 0.61342 (QuantReg: 12.80713) QuantErr: 12.80713 batch_time=0.39086 
Train Epoch: 12 [297/500 19008/32000 (59%)] Loss: 1.39313 (QuantReg: 12.78723) QuantErr: 12.78723 batch_time=0.38936 
Train Epoch: 12 [305/500 19520/32000 (61%)] Loss: 0.96490 (QuantReg: 13.01420) QuantErr: 13.01420 batch_time=0.42137 
Train Epoch: 12 [313/500 20032/32000 (63%)] Loss: 1.38661 (QuantReg: 12.61507) QuantErr: 12.61507 batch_time=0.42194 
Train Epoch: 12 [321/500 20544/32000 (64%)] Loss: 1.05350 (QuantReg: 12.74299) QuantErr: 12.74299 batch_time=1.51123 
Train Epoch: 12 [329/500 21056/32000 (66%)] Loss: 0.86422 (QuantReg: 13.18497) QuantErr: 13.18497 batch_time=0.39905 
Train Epoch: 12 [337/500 21568/32000 (67%)] Loss: 1.02930 (QuantReg: 13.23590) QuantErr: 13.23590 batch_time=0.38290 
Train Epoch: 12 [345/500 22080/32000 (69%)] Loss: 0.79038 (QuantReg: 13.23344) QuantErr: 13.23344 batch_time=0.42146 
Train Epoch: 12 [353/500 22592/32000 (71%)] Loss: 0.78387 (QuantReg: 13.08247) QuantErr: 13.08247 batch_time=0.98692 
Train Epoch: 12 [361/500 23104/32000 (72%)] Loss: 0.86787 (QuantReg: 12.59048) QuantErr: 12.59048 batch_time=0.37935 
Train Epoch: 12 [369/500 23616/32000 (74%)] Loss: 0.95928 (QuantReg: 12.60698) QuantErr: 12.60698 batch_time=0.38819 
Train Epoch: 12 [377/500 24128/32000 (75%)] Loss: 0.82198 (QuantReg: 12.64993) QuantErr: 12.64993 batch_time=0.44085 
Train Epoch: 12 [385/500 24640/32000 (77%)] Loss: 0.65023 (QuantReg: 13.20405) QuantErr: 13.20405 batch_time=1.14279 
Train Epoch: 12 [393/500 25152/32000 (79%)] Loss: 1.00853 (QuantReg: 13.38568) QuantErr: 13.38568 batch_time=0.39990 
Train Epoch: 12 [401/500 25664/32000 (80%)] Loss: 0.99072 (QuantReg: 13.02624) QuantErr: 13.02624 batch_time=0.39852 
Train Epoch: 12 [409/500 26176/32000 (82%)] Loss: 0.98821 (QuantReg: 12.71164) QuantErr: 12.71164 batch_time=0.39677 
Train Epoch: 12 [417/500 26688/32000 (83%)] Loss: 0.78227 (QuantReg: 13.22186) QuantErr: 13.22186 batch_time=0.87589 
Train Epoch: 12 [425/500 27200/32000 (85%)] Loss: 0.81565 (QuantReg: 13.39031) QuantErr: 13.39031 batch_time=0.39224 
Train Epoch: 12 [433/500 27712/32000 (87%)] Loss: 0.63106 (QuantReg: 13.19759) QuantErr: 13.19759 batch_time=0.38965 
Train Epoch: 12 [441/500 28224/32000 (88%)] Loss: 1.02568 (QuantReg: 12.74565) QuantErr: 12.74565 batch_time=0.40488 
Train Epoch: 12 [449/500 28736/32000 (90%)] Loss: 0.96322 (QuantReg: 13.35048) QuantErr: 13.35048 batch_time=1.30220 
Train Epoch: 12 [457/500 29248/32000 (91%)] Loss: 0.84206 (QuantReg: 13.31512) QuantErr: 13.31512 batch_time=0.39567 
Train Epoch: 12 [465/500 29760/32000 (93%)] Loss: 0.87735 (QuantReg: 13.20938) QuantErr: 13.20938 batch_time=0.41187 
Train Epoch: 12 [473/500 30272/32000 (95%)] Loss: 0.84865 (QuantReg: 13.94886) QuantErr: 13.94886 batch_time=0.40201 
Train Epoch: 12 [481/500 30784/32000 (96%)] Loss: 0.76811 (QuantReg: 12.78584) QuantErr: 12.78584 batch_time=0.90343 
Train Epoch: 12 [489/500 31296/32000 (98%)] Loss: 0.61194 (QuantReg: 13.13358) QuantErr: 13.13358 batch_time=0.38700 
Train Epoch: 12 [497/500 31808/32000 (99%)] Loss: 1.42981 (QuantReg: 13.38268) QuantErr: 13.38268 batch_time=0.38680 
Train Epoch: 12 codebook_update_time=2.03951
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch12.pth ...
Done in 4.951s
removing stale ckpt [epoch 11] [took 0.00s]
 epoch          : 12
 loss           : 0.9532677925229073
 quant_reg      : 13.014844808578491
 quant_err      : 13.014844808578491
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 29.577464788732396
 MSRVTT_full_val/t2v_metrics/R5: 65.59356136820925
 MSRVTT_full_val/t2v_metrics/R10: 77.06237424547284
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.309859154929578
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.074777337264024
 MSRVTT_full_val/v2t_metrics/R1: 32.19315895372233
 MSRVTT_full_val/v2t_metrics/R5: 73.44064386317908
 MSRVTT_full_val/v2t_metrics/R10: 85.31187122736418
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.360160965794768
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.64574565250149
 MSRVTT_full_test/t2v_metrics/R1: 11.939799331103679
 MSRVTT_full_test/t2v_metrics/R5: 32.240802675585286
 MSRVTT_full_test/t2v_metrics/R10: 46.35451505016722
 MSRVTT_full_test/t2v_metrics/R50: 80.06688963210702
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.333779264214044
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.131538025293384
 MSRVTT_full_test/v2t_metrics/R1: 13.879598662207357
 MSRVTT_full_test/v2t_metrics/R5: 39.39799331103679
 MSRVTT_full_test/v2t_metrics/R10: 54.64882943143812
 MSRVTT_full_test/v2t_metrics/R50: 85.75250836120401
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.98227424749164
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.032061321974364
 mnt_best       : 26.852557939940137
 not_improved_count: 2
Train Epoch: 13 [1/500 64/32000 (0%)] Loss: 0.85791 (QuantReg: 13.27753) QuantErr: 13.27753 batch_time=31.20087 
Train Epoch: 13 [9/500 576/32000 (2%)] Loss: 0.70457 (QuantReg: 13.18230) QuantErr: 13.18230 batch_time=0.38290 
Train Epoch: 13 [17/500 1088/32000 (3%)] Loss: 0.98103 (QuantReg: 13.00382) QuantErr: 13.00382 batch_time=0.41980 
Train Epoch: 13 [25/500 1600/32000 (5%)] Loss: 0.81911 (QuantReg: 12.87141) QuantErr: 12.87141 batch_time=0.39235 
Train Epoch: 13 [33/500 2112/32000 (7%)] Loss: 0.97076 (QuantReg: 13.35954) QuantErr: 13.35954 batch_time=0.38752 
Train Epoch: 13 [41/500 2624/32000 (8%)] Loss: 0.78654 (QuantReg: 12.90545) QuantErr: 12.90545 batch_time=0.38588 
Train Epoch: 13 [49/500 3136/32000 (10%)] Loss: 0.96796 (QuantReg: 13.15622) QuantErr: 13.15622 batch_time=0.70361 
Train Epoch: 13 [57/500 3648/32000 (11%)] Loss: 1.14548 (QuantReg: 12.85512) QuantErr: 12.85512 batch_time=0.44914 
Train Epoch: 13 [65/500 4160/32000 (13%)] Loss: 0.97276 (QuantReg: 12.92737) QuantErr: 12.92737 batch_time=0.38171 
Train Epoch: 13 [73/500 4672/32000 (15%)] Loss: 0.78152 (QuantReg: 13.20137) QuantErr: 13.20137 batch_time=0.39261 
Train Epoch: 13 [81/500 5184/32000 (16%)] Loss: 0.63527 (QuantReg: 13.20023) QuantErr: 13.20023 batch_time=0.38778 
Train Epoch: 13 [89/500 5696/32000 (18%)] Loss: 0.87864 (QuantReg: 13.06881) QuantErr: 13.06881 batch_time=0.38778 
Train Epoch: 13 [97/500 6208/32000 (19%)] Loss: 0.58479 (QuantReg: 13.12919) QuantErr: 13.12919 batch_time=0.37960 
Train Epoch: 13 [105/500 6720/32000 (21%)] Loss: 0.74482 (QuantReg: 13.18209) QuantErr: 13.18209 batch_time=0.40037 
Train Epoch: 13 [113/500 7232/32000 (23%)] Loss: 0.59734 (QuantReg: 13.73921) QuantErr: 13.73921 batch_time=0.67464 
Train Epoch: 13 [121/500 7744/32000 (24%)] Loss: 0.98128 (QuantReg: 13.10185) QuantErr: 13.10185 batch_time=0.43335 
Train Epoch: 13 [129/500 8256/32000 (26%)] Loss: 0.69381 (QuantReg: 13.56948) QuantErr: 13.56948 batch_time=0.38099 
Train Epoch: 13 [137/500 8768/32000 (27%)] Loss: 0.81223 (QuantReg: 13.49520) QuantErr: 13.49520 batch_time=0.40557 
Train Epoch: 13 [145/500 9280/32000 (29%)] Loss: 1.02485 (QuantReg: 13.06313) QuantErr: 13.06313 batch_time=0.38531 
Train Epoch: 13 [153/500 9792/32000 (31%)] Loss: 0.93684 (QuantReg: 13.06101) QuantErr: 13.06101 batch_time=0.39129 
Train Epoch: 13 [161/500 10304/32000 (32%)] Loss: 0.84159 (QuantReg: 12.67068) QuantErr: 12.67068 batch_time=0.38679 
Train Epoch: 13 [169/500 10816/32000 (34%)] Loss: 0.91203 (QuantReg: 13.64193) QuantErr: 13.64193 batch_time=0.38771 
Train Epoch: 13 [177/500 11328/32000 (35%)] Loss: 1.09293 (QuantReg: 12.27620) QuantErr: 12.27620 batch_time=0.70728 
Train Epoch: 13 [185/500 11840/32000 (37%)] Loss: 1.24006 (QuantReg: 12.80745) QuantErr: 12.80745 batch_time=0.39437 
Train Epoch: 13 [193/500 12352/32000 (39%)] Loss: 1.16244 (QuantReg: 13.52515) QuantErr: 13.52515 batch_time=0.40066 
Train Epoch: 13 [201/500 12864/32000 (40%)] Loss: 1.00590 (QuantReg: 12.82006) QuantErr: 12.82006 batch_time=0.38552 
Train Epoch: 13 [209/500 13376/32000 (42%)] Loss: 0.73617 (QuantReg: 13.60151) QuantErr: 13.60151 batch_time=0.39142 
Train Epoch: 13 [217/500 13888/32000 (43%)] Loss: 0.87926 (QuantReg: 13.06112) QuantErr: 13.06112 batch_time=0.39232 
Train Epoch: 13 [225/500 14400/32000 (45%)] Loss: 1.07270 (QuantReg: 12.91817) QuantErr: 12.91817 batch_time=0.39106 
Train Epoch: 13 [233/500 14912/32000 (47%)] Loss: 0.84665 (QuantReg: 13.46261) QuantErr: 13.46261 batch_time=0.43000 
Train Epoch: 13 [241/500 15424/32000 (48%)] Loss: 0.83899 (QuantReg: 13.40194) QuantErr: 13.40194 batch_time=0.74856 
Train Epoch: 13 [249/500 15936/32000 (50%)] Loss: 0.79288 (QuantReg: 12.58849) QuantErr: 12.58849 batch_time=0.39233 
Train Epoch: 13 [257/500 16448/32000 (51%)] Loss: 1.05164 (QuantReg: 12.76425) QuantErr: 12.76425 batch_time=0.38534 
Train Epoch: 13 [265/500 16960/32000 (53%)] Loss: 0.99671 (QuantReg: 13.02055) QuantErr: 13.02055 batch_time=0.38282 
Train Epoch: 13 [273/500 17472/32000 (55%)] Loss: 0.95984 (QuantReg: 13.51922) QuantErr: 13.51922 batch_time=0.38551 
Train Epoch: 13 [281/500 17984/32000 (56%)] Loss: 0.88538 (QuantReg: 12.89801) QuantErr: 12.89801 batch_time=0.39484 
Train Epoch: 13 [289/500 18496/32000 (58%)] Loss: 0.78537 (QuantReg: 13.33977) QuantErr: 13.33977 batch_time=0.38742 
Train Epoch: 13 [297/500 19008/32000 (59%)] Loss: 0.98569 (QuantReg: 13.36013) QuantErr: 13.36013 batch_time=0.39244 
Train Epoch: 13 [305/500 19520/32000 (61%)] Loss: 0.60700 (QuantReg: 13.36569) QuantErr: 13.36569 batch_time=0.67344 
Train Epoch: 13 [313/500 20032/32000 (63%)] Loss: 0.78119 (QuantReg: 12.79265) QuantErr: 12.79265 batch_time=0.39551 
Train Epoch: 13 [321/500 20544/32000 (64%)] Loss: 0.68324 (QuantReg: 12.82749) QuantErr: 12.82749 batch_time=0.40268 
Train Epoch: 13 [329/500 21056/32000 (66%)] Loss: 0.82266 (QuantReg: 13.75120) QuantErr: 13.75120 batch_time=0.39351 
Train Epoch: 13 [337/500 21568/32000 (67%)] Loss: 1.14070 (QuantReg: 12.91413) QuantErr: 12.91413 batch_time=0.38781 
Train Epoch: 13 [345/500 22080/32000 (69%)] Loss: 0.97089 (QuantReg: 13.29807) QuantErr: 13.29807 batch_time=0.39250 
Train Epoch: 13 [353/500 22592/32000 (71%)] Loss: 0.67722 (QuantReg: 13.54336) QuantErr: 13.54336 batch_time=0.40447 
Train Epoch: 13 [361/500 23104/32000 (72%)] Loss: 0.84171 (QuantReg: 13.15698) QuantErr: 13.15698 batch_time=0.39627 
Train Epoch: 13 [369/500 23616/32000 (74%)] Loss: 0.72841 (QuantReg: 13.14076) QuantErr: 13.14076 batch_time=0.69855 
Train Epoch: 13 [377/500 24128/32000 (75%)] Loss: 0.54631 (QuantReg: 12.83473) QuantErr: 12.83473 batch_time=0.43852 
Train Epoch: 13 [385/500 24640/32000 (77%)] Loss: 0.97297 (QuantReg: 13.36672) QuantErr: 13.36672 batch_time=0.38961 
Train Epoch: 13 [393/500 25152/32000 (79%)] Loss: 0.61842 (QuantReg: 13.39655) QuantErr: 13.39655 batch_time=0.39808 
Train Epoch: 13 [401/500 25664/32000 (80%)] Loss: 0.97195 (QuantReg: 12.83512) QuantErr: 12.83512 batch_time=0.39498 
Train Epoch: 13 [409/500 26176/32000 (82%)] Loss: 0.75927 (QuantReg: 13.17640) QuantErr: 13.17640 batch_time=0.38083 
Train Epoch: 13 [417/500 26688/32000 (83%)] Loss: 0.84770 (QuantReg: 13.32933) QuantErr: 13.32933 batch_time=0.39673 
Train Epoch: 13 [425/500 27200/32000 (85%)] Loss: 1.20726 (QuantReg: 12.92659) QuantErr: 12.92659 batch_time=0.38912 
Train Epoch: 13 [433/500 27712/32000 (87%)] Loss: 0.36472 (QuantReg: 13.34005) QuantErr: 13.34005 batch_time=0.68864 
Train Epoch: 13 [441/500 28224/32000 (88%)] Loss: 0.89657 (QuantReg: 13.14773) QuantErr: 13.14773 batch_time=0.45776 
Train Epoch: 13 [449/500 28736/32000 (90%)] Loss: 1.08622 (QuantReg: 13.19931) QuantErr: 13.19931 batch_time=0.39953 
Train Epoch: 13 [457/500 29248/32000 (91%)] Loss: 1.29300 (QuantReg: 13.12858) QuantErr: 13.12858 batch_time=0.39128 
Train Epoch: 13 [465/500 29760/32000 (93%)] Loss: 1.19859 (QuantReg: 12.41858) QuantErr: 12.41858 batch_time=0.41498 
Train Epoch: 13 [473/500 30272/32000 (95%)] Loss: 0.73809 (QuantReg: 13.21245) QuantErr: 13.21245 batch_time=0.41247 
Train Epoch: 13 [481/500 30784/32000 (96%)] Loss: 0.69845 (QuantReg: 12.70779) QuantErr: 12.70779 batch_time=0.38702 
Train Epoch: 13 [489/500 31296/32000 (98%)] Loss: 1.04353 (QuantReg: 13.03920) QuantErr: 13.03920 batch_time=0.39555 
Train Epoch: 13 [497/500 31808/32000 (99%)] Loss: 0.88188 (QuantReg: 12.72005) QuantErr: 12.72005 batch_time=0.66792 
Train Epoch: 13 codebook_update_time=2.20130
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch13.pth ...
Done in 3.993s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch13.pth ...
Done in 7.931s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 0.9017894002795219
 quant_reg      : 13.135131755828857
 quant_err      : 13.135131755828857
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 66.80080482897384
 MSRVTT_full_val/t2v_metrics/R10: 79.67806841046277
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.422535211267606
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.873143791874426
 MSRVTT_full_val/v2t_metrics/R1: 32.99798792756539
 MSRVTT_full_val/v2t_metrics/R5: 73.2394366197183
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.4325955734406435
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.261587088613545
 MSRVTT_full_test/t2v_metrics/R1: 12.040133779264215
 MSRVTT_full_test/t2v_metrics/R5: 34.381270903010034
 MSRVTT_full_test/t2v_metrics/R10: 48.46153846153846
 MSRVTT_full_test/t2v_metrics/R50: 80.5685618729097
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.55016722408027
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.171700064519396
 MSRVTT_full_test/v2t_metrics/R1: 15.183946488294314
 MSRVTT_full_test/v2t_metrics/R5: 40.13377926421405
 MSRVTT_full_test/v2t_metrics/R10: 55.38461538461539
 MSRVTT_full_test/v2t_metrics/R50: 85.68561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 8.25
 MSRVTT_full_test/v2t_metrics/MeanR: 33.77458193979933
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.316770602739155
 mnt_best       : 27.171700064519396
 not_improved_count: 0
Train Epoch: 14 [1/500 64/32000 (0%)] Loss: 0.49457 (QuantReg: 12.68460) QuantErr: 12.68460 batch_time=33.07257 
Train Epoch: 14 [9/500 576/32000 (2%)] Loss: 0.35962 (QuantReg: 13.13426) QuantErr: 13.13426 batch_time=0.38905 
Train Epoch: 14 [17/500 1088/32000 (3%)] Loss: 0.59648 (QuantReg: 13.06423) QuantErr: 13.06423 batch_time=0.39690 
Train Epoch: 14 [25/500 1600/32000 (5%)] Loss: 1.08858 (QuantReg: 12.94130) QuantErr: 12.94130 batch_time=0.38724 
Train Epoch: 14 [33/500 2112/32000 (7%)] Loss: 0.85013 (QuantReg: 12.68795) QuantErr: 12.68795 batch_time=0.38615 
Train Epoch: 14 [41/500 2624/32000 (8%)] Loss: 0.64289 (QuantReg: 13.42656) QuantErr: 13.42656 batch_time=0.38862 
Train Epoch: 14 [49/500 3136/32000 (10%)] Loss: 0.64242 (QuantReg: 12.81178) QuantErr: 12.81178 batch_time=0.39921 
Train Epoch: 14 [57/500 3648/32000 (11%)] Loss: 0.79721 (QuantReg: 13.18203) QuantErr: 13.18203 batch_time=0.39733 
Train Epoch: 14 [65/500 4160/32000 (13%)] Loss: 0.91182 (QuantReg: 12.71934) QuantErr: 12.71934 batch_time=2.31169 
Train Epoch: 14 [73/500 4672/32000 (15%)] Loss: 0.65988 (QuantReg: 13.12202) QuantErr: 13.12202 batch_time=0.39773 
Train Epoch: 14 [81/500 5184/32000 (16%)] Loss: 0.68752 (QuantReg: 13.49778) QuantErr: 13.49778 batch_time=0.38527 
Train Epoch: 14 [89/500 5696/32000 (18%)] Loss: 0.83941 (QuantReg: 12.89109) QuantErr: 12.89109 batch_time=0.42163 
Train Epoch: 14 [97/500 6208/32000 (19%)] Loss: 0.67725 (QuantReg: 12.96505) QuantErr: 12.96505 batch_time=0.40326 
Train Epoch: 14 [105/500 6720/32000 (21%)] Loss: 0.93116 (QuantReg: 13.02299) QuantErr: 13.02299 batch_time=0.38907 
Train Epoch: 14 [113/500 7232/32000 (23%)] Loss: 0.70175 (QuantReg: 12.92866) QuantErr: 12.92866 batch_time=0.39526 
Train Epoch: 14 [121/500 7744/32000 (24%)] Loss: 0.75844 (QuantReg: 12.87036) QuantErr: 12.87036 batch_time=0.39618 
Train Epoch: 14 [129/500 8256/32000 (26%)] Loss: 1.09398 (QuantReg: 13.71189) QuantErr: 13.71189 batch_time=2.33377 
Train Epoch: 14 [137/500 8768/32000 (27%)] Loss: 0.65606 (QuantReg: 13.34928) QuantErr: 13.34928 batch_time=0.43842 
Train Epoch: 14 [145/500 9280/32000 (29%)] Loss: 0.79099 (QuantReg: 13.12914) QuantErr: 13.12914 batch_time=0.43423 
Train Epoch: 14 [153/500 9792/32000 (31%)] Loss: 0.82811 (QuantReg: 13.27257) QuantErr: 13.27257 batch_time=0.39157 
Train Epoch: 14 [161/500 10304/32000 (32%)] Loss: 1.13625 (QuantReg: 13.01562) QuantErr: 13.01562 batch_time=0.39766 
Train Epoch: 14 [169/500 10816/32000 (34%)] Loss: 0.80284 (QuantReg: 13.51101) QuantErr: 13.51101 batch_time=0.38675 
Train Epoch: 14 [177/500 11328/32000 (35%)] Loss: 0.78473 (QuantReg: 12.80278) QuantErr: 12.80278 batch_time=0.38819 
Train Epoch: 14 [185/500 11840/32000 (37%)] Loss: 1.01551 (QuantReg: 12.92738) QuantErr: 12.92738 batch_time=0.41204 
Train Epoch: 14 [193/500 12352/32000 (39%)] Loss: 0.67666 (QuantReg: 12.81534) QuantErr: 12.81534 batch_time=2.28612 
Train Epoch: 14 [201/500 12864/32000 (40%)] Loss: 0.65619 (QuantReg: 13.04141) QuantErr: 13.04141 batch_time=0.38944 
Train Epoch: 14 [209/500 13376/32000 (42%)] Loss: 0.65986 (QuantReg: 12.87431) QuantErr: 12.87431 batch_time=0.41575 
Train Epoch: 14 [217/500 13888/32000 (43%)] Loss: 1.16371 (QuantReg: 12.89738) QuantErr: 12.89738 batch_time=0.40673 
Train Epoch: 14 [225/500 14400/32000 (45%)] Loss: 1.21752 (QuantReg: 13.28839) QuantErr: 13.28839 batch_time=0.41458 
Train Epoch: 14 [233/500 14912/32000 (47%)] Loss: 0.78679 (QuantReg: 12.96512) QuantErr: 12.96512 batch_time=0.39534 
Train Epoch: 14 [241/500 15424/32000 (48%)] Loss: 1.24199 (QuantReg: 12.70023) QuantErr: 12.70023 batch_time=0.39296 
Train Epoch: 14 [249/500 15936/32000 (50%)] Loss: 0.84492 (QuantReg: 13.01134) QuantErr: 13.01134 batch_time=0.39291 
Train Epoch: 14 [257/500 16448/32000 (51%)] Loss: 1.09034 (QuantReg: 13.32244) QuantErr: 13.32244 batch_time=2.64233 
Train Epoch: 14 [265/500 16960/32000 (53%)] Loss: 0.56647 (QuantReg: 13.36089) QuantErr: 13.36089 batch_time=0.39876 
Train Epoch: 14 [273/500 17472/32000 (55%)] Loss: 0.73128 (QuantReg: 13.43378) QuantErr: 13.43378 batch_time=0.39844 
Train Epoch: 14 [281/500 17984/32000 (56%)] Loss: 0.53839 (QuantReg: 13.36117) QuantErr: 13.36117 batch_time=0.39468 
Train Epoch: 14 [289/500 18496/32000 (58%)] Loss: 0.61039 (QuantReg: 13.21391) QuantErr: 13.21391 batch_time=0.39943 
Train Epoch: 14 [297/500 19008/32000 (59%)] Loss: 1.03098 (QuantReg: 12.91786) QuantErr: 12.91786 batch_time=0.38823 
Train Epoch: 14 [305/500 19520/32000 (61%)] Loss: 0.82327 (QuantReg: 13.56017) QuantErr: 13.56017 batch_time=0.39556 
Train Epoch: 14 [313/500 20032/32000 (63%)] Loss: 0.55318 (QuantReg: 13.20852) QuantErr: 13.20852 batch_time=0.41898 
Train Epoch: 14 [321/500 20544/32000 (64%)] Loss: 0.68205 (QuantReg: 13.30840) QuantErr: 13.30840 batch_time=2.27533 
Train Epoch: 14 [329/500 21056/32000 (66%)] Loss: 0.65487 (QuantReg: 13.22167) QuantErr: 13.22167 batch_time=0.39241 
Train Epoch: 14 [337/500 21568/32000 (67%)] Loss: 0.66074 (QuantReg: 13.27145) QuantErr: 13.27145 batch_time=0.39287 
Train Epoch: 14 [345/500 22080/32000 (69%)] Loss: 0.85856 (QuantReg: 13.55184) QuantErr: 13.55184 batch_time=0.40358 
Train Epoch: 14 [353/500 22592/32000 (71%)] Loss: 0.93193 (QuantReg: 13.00703) QuantErr: 13.00703 batch_time=0.39374 
Train Epoch: 14 [361/500 23104/32000 (72%)] Loss: 0.80317 (QuantReg: 13.31447) QuantErr: 13.31447 batch_time=0.40260 
Train Epoch: 14 [369/500 23616/32000 (74%)] Loss: 0.94961 (QuantReg: 12.98034) QuantErr: 12.98034 batch_time=0.39301 
Train Epoch: 14 [377/500 24128/32000 (75%)] Loss: 0.65441 (QuantReg: 13.21062) QuantErr: 13.21062 batch_time=0.40932 
Train Epoch: 14 [385/500 24640/32000 (77%)] Loss: 0.85256 (QuantReg: 13.45312) QuantErr: 13.45312 batch_time=2.28212 
Train Epoch: 14 [393/500 25152/32000 (79%)] Loss: 1.29501 (QuantReg: 12.89684) QuantErr: 12.89684 batch_time=0.38744 
Train Epoch: 14 [401/500 25664/32000 (80%)] Loss: 1.00084 (QuantReg: 13.44942) QuantErr: 13.44942 batch_time=0.38754 
Train Epoch: 14 [409/500 26176/32000 (82%)] Loss: 1.13146 (QuantReg: 13.50252) QuantErr: 13.50252 batch_time=0.39509 
Train Epoch: 14 [417/500 26688/32000 (83%)] Loss: 0.62792 (QuantReg: 13.30690) QuantErr: 13.30690 batch_time=0.38913 
Train Epoch: 14 [425/500 27200/32000 (85%)] Loss: 0.71557 (QuantReg: 13.46921) QuantErr: 13.46921 batch_time=0.39095 
Train Epoch: 14 [433/500 27712/32000 (87%)] Loss: 0.74229 (QuantReg: 13.73244) QuantErr: 13.73244 batch_time=0.38885 
Train Epoch: 14 [441/500 28224/32000 (88%)] Loss: 0.74784 (QuantReg: 13.32129) QuantErr: 13.32129 batch_time=0.42061 
Train Epoch: 14 [449/500 28736/32000 (90%)] Loss: 0.76175 (QuantReg: 13.39077) QuantErr: 13.39077 batch_time=2.29669 
Train Epoch: 14 [457/500 29248/32000 (91%)] Loss: 0.61603 (QuantReg: 13.27711) QuantErr: 13.27711 batch_time=0.42846 
Train Epoch: 14 [465/500 29760/32000 (93%)] Loss: 0.62521 (QuantReg: 13.16596) QuantErr: 13.16596 batch_time=0.39607 
Train Epoch: 14 [473/500 30272/32000 (95%)] Loss: 0.74891 (QuantReg: 13.31566) QuantErr: 13.31566 batch_time=0.43163 
Train Epoch: 14 [481/500 30784/32000 (96%)] Loss: 0.97452 (QuantReg: 13.14428) QuantErr: 13.14428 batch_time=0.39303 
Train Epoch: 14 [489/500 31296/32000 (98%)] Loss: 0.98616 (QuantReg: 13.68500) QuantErr: 13.68500 batch_time=0.39844 
Train Epoch: 14 [497/500 31808/32000 (99%)] Loss: 0.59368 (QuantReg: 13.42204) QuantErr: 13.42204 batch_time=0.41498 
Train Epoch: 14 codebook_update_time=2.25095
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch14.pth ...
Done in 3.683s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 0.8626548196077347
 quant_reg      : 13.15952691268921
 quant_err      : 13.15952691268921
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 29.175050301810867
 MSRVTT_full_val/t2v_metrics/R5: 66.19718309859155
 MSRVTT_full_val/t2v_metrics/R10: 78.26961770623743
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.295774647887324
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.269846470613224
 MSRVTT_full_val/v2t_metrics/R1: 34.60764587525151
 MSRVTT_full_val/v2t_metrics/R5: 71.62977867203219
 MSRVTT_full_val/v2t_metrics/R10: 83.90342052313883
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.162977867203219
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.249102746379634
 MSRVTT_full_test/t2v_metrics/R1: 10.702341137123746
 MSRVTT_full_test/t2v_metrics/R5: 32.675585284280935
 MSRVTT_full_test/t2v_metrics/R10: 46.68896321070234
 MSRVTT_full_test/t2v_metrics/R50: 79.1638795986622
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.0628762541806
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.369123643457876
 MSRVTT_full_test/v2t_metrics/R1: 13.645484949832776
 MSRVTT_full_test/v2t_metrics/R5: 39.03010033444816
 MSRVTT_full_test/v2t_metrics/R10: 54.64882943143812
 MSRVTT_full_test/v2t_metrics/R50: 86.32107023411372
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.305852842809365
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.760248203527635
 mnt_best       : 27.171700064519396
 not_improved_count: 1
Train Epoch: 15 [1/500 64/32000 (0%)] Loss: 0.97736 (QuantReg: 12.55021) QuantErr: 12.55021 batch_time=31.24681 
Train Epoch: 15 [9/500 576/32000 (2%)] Loss: 1.05360 (QuantReg: 13.33422) QuantErr: 13.33422 batch_time=0.38269 
Train Epoch: 15 [17/500 1088/32000 (3%)] Loss: 1.11766 (QuantReg: 13.07783) QuantErr: 13.07783 batch_time=1.42199 
Train Epoch: 15 [25/500 1600/32000 (5%)] Loss: 0.92734 (QuantReg: 12.83706) QuantErr: 12.83706 batch_time=0.39409 
Train Epoch: 15 [33/500 2112/32000 (7%)] Loss: 0.71412 (QuantReg: 13.21071) QuantErr: 13.21071 batch_time=0.39459 
Train Epoch: 15 [41/500 2624/32000 (8%)] Loss: 0.64742 (QuantReg: 12.91759) QuantErr: 12.91759 batch_time=0.38965 
Train Epoch: 15 [49/500 3136/32000 (10%)] Loss: 0.46488 (QuantReg: 12.96135) QuantErr: 12.96135 batch_time=0.39415 
Train Epoch: 15 [57/500 3648/32000 (11%)] Loss: 0.71948 (QuantReg: 12.87949) QuantErr: 12.87949 batch_time=0.39121 
Train Epoch: 15 [65/500 4160/32000 (13%)] Loss: 0.44365 (QuantReg: 13.19751) QuantErr: 13.19751 batch_time=0.54731 
Train Epoch: 15 [73/500 4672/32000 (15%)] Loss: 0.33719 (QuantReg: 13.24250) QuantErr: 13.24250 batch_time=0.38460 
Train Epoch: 15 [81/500 5184/32000 (16%)] Loss: 1.02848 (QuantReg: 12.58370) QuantErr: 12.58370 batch_time=1.07374 
Train Epoch: 15 [89/500 5696/32000 (18%)] Loss: 0.81370 (QuantReg: 13.28230) QuantErr: 13.28230 batch_time=0.38481 
Train Epoch: 15 [97/500 6208/32000 (19%)] Loss: 1.04480 (QuantReg: 13.52521) QuantErr: 13.52521 batch_time=0.39490 
Train Epoch: 15 [105/500 6720/32000 (21%)] Loss: 0.65438 (QuantReg: 13.22576) QuantErr: 13.22576 batch_time=0.39469 
Train Epoch: 15 [113/500 7232/32000 (23%)] Loss: 0.38028 (QuantReg: 12.92974) QuantErr: 12.92974 batch_time=0.38724 
Train Epoch: 15 [121/500 7744/32000 (24%)] Loss: 1.00170 (QuantReg: 12.86484) QuantErr: 12.86484 batch_time=0.39766 
Train Epoch: 15 [129/500 8256/32000 (26%)] Loss: 0.87649 (QuantReg: 13.08117) QuantErr: 13.08117 batch_time=0.60407 
Train Epoch: 15 [137/500 8768/32000 (27%)] Loss: 0.72543 (QuantReg: 13.27090) QuantErr: 13.27090 batch_time=0.38591 
Train Epoch: 15 [145/500 9280/32000 (29%)] Loss: 1.16163 (QuantReg: 13.13534) QuantErr: 13.13534 batch_time=1.11715 
Train Epoch: 15 [153/500 9792/32000 (31%)] Loss: 1.04072 (QuantReg: 13.40706) QuantErr: 13.40706 batch_time=0.39285 
Train Epoch: 15 [161/500 10304/32000 (32%)] Loss: 1.04809 (QuantReg: 13.05816) QuantErr: 13.05816 batch_time=0.39867 
Train Epoch: 15 [169/500 10816/32000 (34%)] Loss: 0.59585 (QuantReg: 13.79064) QuantErr: 13.79064 batch_time=0.39576 
Train Epoch: 15 [177/500 11328/32000 (35%)] Loss: 1.26612 (QuantReg: 13.31158) QuantErr: 13.31158 batch_time=0.39551 
Train Epoch: 15 [185/500 11840/32000 (37%)] Loss: 0.66029 (QuantReg: 13.10260) QuantErr: 13.10260 batch_time=0.38725 
Train Epoch: 15 [193/500 12352/32000 (39%)] Loss: 0.48430 (QuantReg: 13.30025) QuantErr: 13.30025 batch_time=0.55129 
Train Epoch: 15 [201/500 12864/32000 (40%)] Loss: 0.61699 (QuantReg: 13.20063) QuantErr: 13.20063 batch_time=0.38425 
Train Epoch: 15 [209/500 13376/32000 (42%)] Loss: 0.95161 (QuantReg: 13.58009) QuantErr: 13.58009 batch_time=1.11509 
Train Epoch: 15 [217/500 13888/32000 (43%)] Loss: 0.88195 (QuantReg: 12.87168) QuantErr: 12.87168 batch_time=0.44708 
Train Epoch: 15 [225/500 14400/32000 (45%)] Loss: 0.66899 (QuantReg: 12.38760) QuantErr: 12.38760 batch_time=0.39305 
Train Epoch: 15 [233/500 14912/32000 (47%)] Loss: 0.63138 (QuantReg: 13.29172) QuantErr: 13.29172 batch_time=0.39337 
Train Epoch: 15 [241/500 15424/32000 (48%)] Loss: 0.96466 (QuantReg: 13.13449) QuantErr: 13.13449 batch_time=0.43777 
Train Epoch: 15 [249/500 15936/32000 (50%)] Loss: 1.16094 (QuantReg: 13.06475) QuantErr: 13.06475 batch_time=0.38597 
Train Epoch: 15 [257/500 16448/32000 (51%)] Loss: 0.79980 (QuantReg: 12.89748) QuantErr: 12.89748 batch_time=0.56755 
Train Epoch: 15 [265/500 16960/32000 (53%)] Loss: 0.97055 (QuantReg: 13.03934) QuantErr: 13.03934 batch_time=0.38824 
Train Epoch: 15 [273/500 17472/32000 (55%)] Loss: 0.68350 (QuantReg: 13.26201) QuantErr: 13.26201 batch_time=1.10134 
Train Epoch: 15 [281/500 17984/32000 (56%)] Loss: 0.53323 (QuantReg: 13.00019) QuantErr: 13.00019 batch_time=0.39741 
Train Epoch: 15 [289/500 18496/32000 (58%)] Loss: 0.57645 (QuantReg: 13.64731) QuantErr: 13.64731 batch_time=0.39989 
Train Epoch: 15 [297/500 19008/32000 (59%)] Loss: 0.57670 (QuantReg: 13.64327) QuantErr: 13.64327 batch_time=0.45528 
Train Epoch: 15 [305/500 19520/32000 (61%)] Loss: 0.98314 (QuantReg: 13.16149) QuantErr: 13.16149 batch_time=0.41042 
Train Epoch: 15 [313/500 20032/32000 (63%)] Loss: 0.48729 (QuantReg: 13.56814) QuantErr: 13.56814 batch_time=0.39143 
Train Epoch: 15 [321/500 20544/32000 (64%)] Loss: 1.05907 (QuantReg: 13.42498) QuantErr: 13.42498 batch_time=0.55865 
Train Epoch: 15 [329/500 21056/32000 (66%)] Loss: 0.55750 (QuantReg: 13.16028) QuantErr: 13.16028 batch_time=0.39118 
Train Epoch: 15 [337/500 21568/32000 (67%)] Loss: 0.77931 (QuantReg: 12.96942) QuantErr: 12.96942 batch_time=1.12069 
Train Epoch: 15 [345/500 22080/32000 (69%)] Loss: 0.89394 (QuantReg: 13.16220) QuantErr: 13.16220 batch_time=0.38847 
Train Epoch: 15 [353/500 22592/32000 (71%)] Loss: 1.02576 (QuantReg: 13.29598) QuantErr: 13.29598 batch_time=0.39284 
Train Epoch: 15 [361/500 23104/32000 (72%)] Loss: 0.75436 (QuantReg: 13.07100) QuantErr: 13.07100 batch_time=0.41864 
Train Epoch: 15 [369/500 23616/32000 (74%)] Loss: 0.97497 (QuantReg: 13.12185) QuantErr: 13.12185 batch_time=0.38885 
Train Epoch: 15 [377/500 24128/32000 (75%)] Loss: 0.73087 (QuantReg: 13.37500) QuantErr: 13.37500 batch_time=0.38455 
Train Epoch: 15 [385/500 24640/32000 (77%)] Loss: 0.75867 (QuantReg: 13.32875) QuantErr: 13.32875 batch_time=0.57570 
Train Epoch: 15 [393/500 25152/32000 (79%)] Loss: 1.36102 (QuantReg: 13.15810) QuantErr: 13.15810 batch_time=0.38662 
Train Epoch: 15 [401/500 25664/32000 (80%)] Loss: 1.04419 (QuantReg: 13.09833) QuantErr: 13.09833 batch_time=1.10173 
Train Epoch: 15 [409/500 26176/32000 (82%)] Loss: 1.14523 (QuantReg: 13.32795) QuantErr: 13.32795 batch_time=0.44972 
Train Epoch: 15 [417/500 26688/32000 (83%)] Loss: 0.63664 (QuantReg: 13.17191) QuantErr: 13.17191 batch_time=0.43632 
Train Epoch: 15 [425/500 27200/32000 (85%)] Loss: 0.82952 (QuantReg: 13.22719) QuantErr: 13.22719 batch_time=0.43741 
Train Epoch: 15 [433/500 27712/32000 (87%)] Loss: 0.72041 (QuantReg: 13.40401) QuantErr: 13.40401 batch_time=0.39395 
Train Epoch: 15 [441/500 28224/32000 (88%)] Loss: 0.86785 (QuantReg: 13.25681) QuantErr: 13.25681 batch_time=0.38530 
Train Epoch: 15 [449/500 28736/32000 (90%)] Loss: 0.64414 (QuantReg: 13.11984) QuantErr: 13.11984 batch_time=0.53815 
Train Epoch: 15 [457/500 29248/32000 (91%)] Loss: 0.63123 (QuantReg: 13.52928) QuantErr: 13.52928 batch_time=0.38980 
Train Epoch: 15 [465/500 29760/32000 (93%)] Loss: 0.74883 (QuantReg: 13.45474) QuantErr: 13.45474 batch_time=1.14460 
Train Epoch: 15 [473/500 30272/32000 (95%)] Loss: 0.97191 (QuantReg: 13.53140) QuantErr: 13.53140 batch_time=0.42091 
Train Epoch: 15 [481/500 30784/32000 (96%)] Loss: 0.83987 (QuantReg: 13.31249) QuantErr: 13.31249 batch_time=0.40284 
Train Epoch: 15 [489/500 31296/32000 (98%)] Loss: 0.85000 (QuantReg: 13.19102) QuantErr: 13.19102 batch_time=0.43502 
Train Epoch: 15 [497/500 31808/32000 (99%)] Loss: 0.76181 (QuantReg: 13.40585) QuantErr: 13.40585 batch_time=0.39551 
Train Epoch: 15 codebook_update_time=2.18433
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch15.pth ...
Done in 3.925s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch15.pth ...
Done in 7.836s
removing stale ckpt [epoch 14] [took 0.00s]
 epoch          : 15
 loss           : 0.8027210309505463
 quant_reg      : 13.170148992538453
 quant_err      : 13.170148992538453
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 67.6056338028169
 MSRVTT_full_val/t2v_metrics/R10: 80.28169014084507
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.496981891348089
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.836953343505726
 MSRVTT_full_val/v2t_metrics/R1: 35.61368209255533
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.253521126760563
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.27755720630878
 MSRVTT_full_test/t2v_metrics/R1: 12.173913043478262
 MSRVTT_full_test/t2v_metrics/R5: 35.01672240802676
 MSRVTT_full_test/t2v_metrics/R10: 48.49498327759197
 MSRVTT_full_test/t2v_metrics/R50: 80.73578595317726
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.93411371237458
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.44526957275943
 MSRVTT_full_test/v2t_metrics/R1: 14.548494983277592
 MSRVTT_full_test/v2t_metrics/R5: 41.137123745819395
 MSRVTT_full_test/v2t_metrics/R10: 56.72240802675585
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.211371237458195
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.379406478621476
 mnt_best       : 27.44526957275943
 not_improved_count: 0
Train Epoch: 16 [1/500 64/32000 (0%)] Loss: 0.68405 (QuantReg: 12.42880) QuantErr: 12.42880 batch_time=32.46058 
Train Epoch: 16 [9/500 576/32000 (2%)] Loss: 0.74780 (QuantReg: 12.79175) QuantErr: 12.79175 batch_time=0.38791 
Train Epoch: 16 [17/500 1088/32000 (3%)] Loss: 0.81275 (QuantReg: 12.88507) QuantErr: 12.88507 batch_time=0.38652 
Train Epoch: 16 [25/500 1600/32000 (5%)] Loss: 0.59134 (QuantReg: 13.10754) QuantErr: 13.10754 batch_time=0.40302 
Train Epoch: 16 [33/500 2112/32000 (7%)] Loss: 0.98137 (QuantReg: 12.89466) QuantErr: 12.89466 batch_time=0.51990 
Train Epoch: 16 [41/500 2624/32000 (8%)] Loss: 0.72277 (QuantReg: 13.21365) QuantErr: 13.21365 batch_time=0.62102 
Train Epoch: 16 [49/500 3136/32000 (10%)] Loss: 0.68531 (QuantReg: 13.33718) QuantErr: 13.33718 batch_time=0.39116 
Train Epoch: 16 [57/500 3648/32000 (11%)] Loss: 0.63696 (QuantReg: 12.94311) QuantErr: 12.94311 batch_time=0.40574 
Train Epoch: 16 [65/500 4160/32000 (13%)] Loss: 1.12008 (QuantReg: 13.16719) QuantErr: 13.16719 batch_time=1.03037 
Train Epoch: 16 [73/500 4672/32000 (15%)] Loss: 0.69198 (QuantReg: 13.05041) QuantErr: 13.05041 batch_time=0.41794 
Train Epoch: 16 [81/500 5184/32000 (16%)] Loss: 0.63149 (QuantReg: 13.01095) QuantErr: 13.01095 batch_time=0.39354 
Train Epoch: 16 [89/500 5696/32000 (18%)] Loss: 0.55295 (QuantReg: 13.24903) QuantErr: 13.24903 batch_time=0.39993 
Train Epoch: 16 [97/500 6208/32000 (19%)] Loss: 0.85693 (QuantReg: 13.10658) QuantErr: 13.10658 batch_time=0.50456 
Train Epoch: 16 [105/500 6720/32000 (21%)] Loss: 0.58536 (QuantReg: 13.34057) QuantErr: 13.34057 batch_time=0.63080 
Train Epoch: 16 [113/500 7232/32000 (23%)] Loss: 0.78112 (QuantReg: 13.08544) QuantErr: 13.08544 batch_time=0.38251 
Train Epoch: 16 [121/500 7744/32000 (24%)] Loss: 1.19556 (QuantReg: 12.75500) QuantErr: 12.75500 batch_time=0.39760 
Train Epoch: 16 [129/500 8256/32000 (26%)] Loss: 0.66870 (QuantReg: 13.80682) QuantErr: 13.80682 batch_time=0.98488 
Train Epoch: 16 [137/500 8768/32000 (27%)] Loss: 0.71433 (QuantReg: 13.67472) QuantErr: 13.67472 batch_time=0.41058 
Train Epoch: 16 [145/500 9280/32000 (29%)] Loss: 0.48064 (QuantReg: 13.02007) QuantErr: 13.02007 batch_time=0.39970 
Train Epoch: 16 [153/500 9792/32000 (31%)] Loss: 0.47629 (QuantReg: 13.23810) QuantErr: 13.23810 batch_time=0.38474 
Train Epoch: 16 [161/500 10304/32000 (32%)] Loss: 0.80611 (QuantReg: 13.68784) QuantErr: 13.68784 batch_time=0.39240 
Train Epoch: 16 [169/500 10816/32000 (34%)] Loss: 0.76555 (QuantReg: 13.59612) QuantErr: 13.59612 batch_time=0.38615 
Train Epoch: 16 [177/500 11328/32000 (35%)] Loss: 0.54767 (QuantReg: 13.80348) QuantErr: 13.80348 batch_time=0.39556 
Train Epoch: 16 [185/500 11840/32000 (37%)] Loss: 0.63729 (QuantReg: 13.26429) QuantErr: 13.26429 batch_time=0.38476 
Train Epoch: 16 [193/500 12352/32000 (39%)] Loss: 0.84116 (QuantReg: 13.47711) QuantErr: 13.47711 batch_time=0.38426 
Train Epoch: 16 [201/500 12864/32000 (40%)] Loss: 0.96906 (QuantReg: 13.45204) QuantErr: 13.45204 batch_time=0.38446 
Train Epoch: 16 [209/500 13376/32000 (42%)] Loss: 1.15040 (QuantReg: 13.25232) QuantErr: 13.25232 batch_time=0.38563 
Train Epoch: 16 [217/500 13888/32000 (43%)] Loss: 0.94831 (QuantReg: 13.48975) QuantErr: 13.48975 batch_time=0.39342 
Train Epoch: 16 [225/500 14400/32000 (45%)] Loss: 0.57047 (QuantReg: 13.14610) QuantErr: 13.14610 batch_time=0.40912 
Train Epoch: 16 [233/500 14912/32000 (47%)] Loss: 1.13340 (QuantReg: 13.44289) QuantErr: 13.44289 batch_time=0.39743 
Train Epoch: 16 [241/500 15424/32000 (48%)] Loss: 0.50229 (QuantReg: 13.06267) QuantErr: 13.06267 batch_time=0.38910 
Train Epoch: 16 [249/500 15936/32000 (50%)] Loss: 0.69640 (QuantReg: 12.96644) QuantErr: 12.96644 batch_time=0.39303 
Train Epoch: 16 [257/500 16448/32000 (51%)] Loss: 0.96366 (QuantReg: 13.55267) QuantErr: 13.55267 batch_time=0.40253 
Train Epoch: 16 [265/500 16960/32000 (53%)] Loss: 0.77492 (QuantReg: 13.24906) QuantErr: 13.24906 batch_time=0.38934 
Train Epoch: 16 [273/500 17472/32000 (55%)] Loss: 0.71625 (QuantReg: 12.97200) QuantErr: 12.97200 batch_time=0.40160 
Train Epoch: 16 [281/500 17984/32000 (56%)] Loss: 0.94045 (QuantReg: 12.79354) QuantErr: 12.79354 batch_time=0.39670 
Train Epoch: 16 [289/500 18496/32000 (58%)] Loss: 0.86554 (QuantReg: 13.04714) QuantErr: 13.04714 batch_time=0.40707 
Train Epoch: 16 [297/500 19008/32000 (59%)] Loss: 1.00458 (QuantReg: 13.09517) QuantErr: 13.09517 batch_time=0.38864 
Train Epoch: 16 [305/500 19520/32000 (61%)] Loss: 1.08740 (QuantReg: 12.93271) QuantErr: 12.93271 batch_time=0.40511 
Train Epoch: 16 [313/500 20032/32000 (63%)] Loss: 0.94399 (QuantReg: 13.49842) QuantErr: 13.49842 batch_time=0.42711 
Train Epoch: 16 [321/500 20544/32000 (64%)] Loss: 1.15052 (QuantReg: 12.82727) QuantErr: 12.82727 batch_time=0.39803 
Train Epoch: 16 [329/500 21056/32000 (66%)] Loss: 0.60926 (QuantReg: 13.47858) QuantErr: 13.47858 batch_time=0.40056 
Train Epoch: 16 [337/500 21568/32000 (67%)] Loss: 0.67176 (QuantReg: 13.77700) QuantErr: 13.77700 batch_time=0.39138 
Train Epoch: 16 [345/500 22080/32000 (69%)] Loss: 0.57796 (QuantReg: 13.10838) QuantErr: 13.10838 batch_time=0.38927 
Train Epoch: 16 [353/500 22592/32000 (71%)] Loss: 0.92444 (QuantReg: 12.90355) QuantErr: 12.90355 batch_time=0.38666 
Train Epoch: 16 [361/500 23104/32000 (72%)] Loss: 0.88272 (QuantReg: 13.13625) QuantErr: 13.13625 batch_time=0.39137 
Train Epoch: 16 [369/500 23616/32000 (74%)] Loss: 0.51738 (QuantReg: 13.13831) QuantErr: 13.13831 batch_time=0.40331 
Train Epoch: 16 [377/500 24128/32000 (75%)] Loss: 0.50368 (QuantReg: 13.57471) QuantErr: 13.57471 batch_time=0.41081 
Train Epoch: 16 [385/500 24640/32000 (77%)] Loss: 0.46995 (QuantReg: 14.03750) QuantErr: 14.03750 batch_time=0.40168 
Train Epoch: 16 [393/500 25152/32000 (79%)] Loss: 0.73498 (QuantReg: 13.61351) QuantErr: 13.61351 batch_time=0.41192 
Train Epoch: 16 [401/500 25664/32000 (80%)] Loss: 0.59726 (QuantReg: 13.22221) QuantErr: 13.22221 batch_time=0.38460 
Train Epoch: 16 [409/500 26176/32000 (82%)] Loss: 0.75443 (QuantReg: 13.59359) QuantErr: 13.59359 batch_time=0.39436 
Train Epoch: 16 [417/500 26688/32000 (83%)] Loss: 0.79311 (QuantReg: 13.25123) QuantErr: 13.25123 batch_time=0.39749 
Train Epoch: 16 [425/500 27200/32000 (85%)] Loss: 0.71900 (QuantReg: 13.26016) QuantErr: 13.26016 batch_time=0.42243 
Train Epoch: 16 [433/500 27712/32000 (87%)] Loss: 0.98439 (QuantReg: 13.43686) QuantErr: 13.43686 batch_time=0.40679 
Train Epoch: 16 [441/500 28224/32000 (88%)] Loss: 0.78276 (QuantReg: 13.31839) QuantErr: 13.31839 batch_time=0.39440 
Train Epoch: 16 [449/500 28736/32000 (90%)] Loss: 1.19654 (QuantReg: 13.12375) QuantErr: 13.12375 batch_time=0.39073 
Train Epoch: 16 [457/500 29248/32000 (91%)] Loss: 0.74042 (QuantReg: 13.29918) QuantErr: 13.29918 batch_time=0.38659 
Train Epoch: 16 [465/500 29760/32000 (93%)] Loss: 0.61241 (QuantReg: 13.39960) QuantErr: 13.39960 batch_time=0.38245 
Train Epoch: 16 [473/500 30272/32000 (95%)] Loss: 0.79438 (QuantReg: 13.46493) QuantErr: 13.46493 batch_time=0.38139 
Train Epoch: 16 [481/500 30784/32000 (96%)] Loss: 1.11474 (QuantReg: 13.47059) QuantErr: 13.47059 batch_time=0.38200 
Train Epoch: 16 [489/500 31296/32000 (98%)] Loss: 0.75939 (QuantReg: 13.57645) QuantErr: 13.57645 batch_time=0.40612 
Train Epoch: 16 [497/500 31808/32000 (99%)] Loss: 0.68748 (QuantReg: 13.68176) QuantErr: 13.68176 batch_time=0.39404 
Train Epoch: 16 codebook_update_time=2.27683
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch16.pth ...
Done in 3.924s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch16.pth ...
Done in 7.819s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 0.7782385644912719
 quant_reg      : 13.274510189056397
 quant_err      : 13.274510189056397
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.33400402414487
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.16744698252962
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.086519114688128
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.764093015342944
 MSRVTT_full_test/t2v_metrics/R1: 12.37458193979933
 MSRVTT_full_test/t2v_metrics/R5: 35.852842809364546
 MSRVTT_full_test/t2v_metrics/R10: 50.40133779264214
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.594314381270905
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.172933204092104
 MSRVTT_full_test/v2t_metrics/R1: 15.785953177257525
 MSRVTT_full_test/v2t_metrics/R5: 41.137123745819395
 MSRVTT_full_test/v2t_metrics/R10: 56.75585284280937
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.30802675585284
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.279117094834874
 mnt_best       : 28.172933204092104
 not_improved_count: 0
Train Epoch: 17 [1/500 64/32000 (0%)] Loss: 0.73962 (QuantReg: 12.87517) QuantErr: 12.87517 batch_time=37.29820 
Train Epoch: 17 [9/500 576/32000 (2%)] Loss: 0.82535 (QuantReg: 13.29943) QuantErr: 13.29943 batch_time=0.38417 
Train Epoch: 17 [17/500 1088/32000 (3%)] Loss: 0.94658 (QuantReg: 13.62889) QuantErr: 13.62889 batch_time=0.42279 
Train Epoch: 17 [25/500 1600/32000 (5%)] Loss: 0.80516 (QuantReg: 13.03580) QuantErr: 13.03580 batch_time=0.38981 
Train Epoch: 17 [33/500 2112/32000 (7%)] Loss: 0.64010 (QuantReg: 13.28015) QuantErr: 13.28015 batch_time=0.39533 
Train Epoch: 17 [41/500 2624/32000 (8%)] Loss: 0.49530 (QuantReg: 13.00101) QuantErr: 13.00101 batch_time=0.39264 
Train Epoch: 17 [49/500 3136/32000 (10%)] Loss: 0.79803 (QuantReg: 12.95945) QuantErr: 12.95945 batch_time=0.39252 
Train Epoch: 17 [57/500 3648/32000 (11%)] Loss: 0.74272 (QuantReg: 13.73752) QuantErr: 13.73752 batch_time=0.38139 
Train Epoch: 17 [65/500 4160/32000 (13%)] Loss: 0.97413 (QuantReg: 13.25433) QuantErr: 13.25433 batch_time=3.41027 
Train Epoch: 17 [73/500 4672/32000 (15%)] Loss: 0.57046 (QuantReg: 13.19749) QuantErr: 13.19749 batch_time=0.39556 
Train Epoch: 17 [81/500 5184/32000 (16%)] Loss: 1.07286 (QuantReg: 13.66773) QuantErr: 13.66773 batch_time=0.44421 
Train Epoch: 17 [89/500 5696/32000 (18%)] Loss: 0.77443 (QuantReg: 13.43519) QuantErr: 13.43519 batch_time=0.39420 
Train Epoch: 17 [97/500 6208/32000 (19%)] Loss: 0.57932 (QuantReg: 13.72286) QuantErr: 13.72286 batch_time=0.40515 
Train Epoch: 17 [105/500 6720/32000 (21%)] Loss: 0.94867 (QuantReg: 13.14831) QuantErr: 13.14831 batch_time=0.38587 
Train Epoch: 17 [113/500 7232/32000 (23%)] Loss: 0.97063 (QuantReg: 13.12328) QuantErr: 13.12328 batch_time=0.39789 
Train Epoch: 17 [121/500 7744/32000 (24%)] Loss: 0.78105 (QuantReg: 13.53520) QuantErr: 13.53520 batch_time=0.41057 
Train Epoch: 17 [129/500 8256/32000 (26%)] Loss: 1.39679 (QuantReg: 13.11897) QuantErr: 13.11897 batch_time=3.50825 
Train Epoch: 17 [137/500 8768/32000 (27%)] Loss: 1.24370 (QuantReg: 12.92594) QuantErr: 12.92594 batch_time=0.41777 
Train Epoch: 17 [145/500 9280/32000 (29%)] Loss: 0.61039 (QuantReg: 13.56743) QuantErr: 13.56743 batch_time=0.40968 
Train Epoch: 17 [153/500 9792/32000 (31%)] Loss: 0.70269 (QuantReg: 12.79343) QuantErr: 12.79343 batch_time=0.40244 
Train Epoch: 17 [161/500 10304/32000 (32%)] Loss: 0.84966 (QuantReg: 13.19101) QuantErr: 13.19101 batch_time=0.37637 
Train Epoch: 17 [169/500 10816/32000 (34%)] Loss: 0.75937 (QuantReg: 12.82853) QuantErr: 12.82853 batch_time=0.38523 
Train Epoch: 17 [177/500 11328/32000 (35%)] Loss: 1.27249 (QuantReg: 13.44922) QuantErr: 13.44922 batch_time=0.39444 
Train Epoch: 17 [185/500 11840/32000 (37%)] Loss: 0.67002 (QuantReg: 13.25249) QuantErr: 13.25249 batch_time=0.39235 
Train Epoch: 17 [193/500 12352/32000 (39%)] Loss: 0.84843 (QuantReg: 13.31896) QuantErr: 13.31896 batch_time=3.34964 
Train Epoch: 17 [201/500 12864/32000 (40%)] Loss: 0.94417 (QuantReg: 13.16836) QuantErr: 13.16836 batch_time=0.39925 
Train Epoch: 17 [209/500 13376/32000 (42%)] Loss: 1.01575 (QuantReg: 13.01898) QuantErr: 13.01898 batch_time=0.39561 
Train Epoch: 17 [217/500 13888/32000 (43%)] Loss: 0.67532 (QuantReg: 13.09795) QuantErr: 13.09795 batch_time=0.39044 
Train Epoch: 17 [225/500 14400/32000 (45%)] Loss: 0.67726 (QuantReg: 12.86925) QuantErr: 12.86925 batch_time=0.39600 
Train Epoch: 17 [233/500 14912/32000 (47%)] Loss: 1.00843 (QuantReg: 12.63184) QuantErr: 12.63184 batch_time=0.40864 
Train Epoch: 17 [241/500 15424/32000 (48%)] Loss: 0.76622 (QuantReg: 13.91990) QuantErr: 13.91990 batch_time=0.38031 
Train Epoch: 17 [249/500 15936/32000 (50%)] Loss: 1.09801 (QuantReg: 12.91877) QuantErr: 12.91877 batch_time=0.39307 
Train Epoch: 17 [257/500 16448/32000 (51%)] Loss: 0.49465 (QuantReg: 13.75198) QuantErr: 13.75198 batch_time=3.50339 
Train Epoch: 17 [265/500 16960/32000 (53%)] Loss: 0.90685 (QuantReg: 13.44614) QuantErr: 13.44614 batch_time=0.39760 
Train Epoch: 17 [273/500 17472/32000 (55%)] Loss: 0.62926 (QuantReg: 13.42615) QuantErr: 13.42615 batch_time=0.39381 
Train Epoch: 17 [281/500 17984/32000 (56%)] Loss: 1.00268 (QuantReg: 13.41104) QuantErr: 13.41104 batch_time=0.39650 
Train Epoch: 17 [289/500 18496/32000 (58%)] Loss: 0.45136 (QuantReg: 13.35946) QuantErr: 13.35946 batch_time=0.40159 
Train Epoch: 17 [297/500 19008/32000 (59%)] Loss: 0.59568 (QuantReg: 13.29410) QuantErr: 13.29410 batch_time=0.40618 
Train Epoch: 17 [305/500 19520/32000 (61%)] Loss: 0.58755 (QuantReg: 13.42191) QuantErr: 13.42191 batch_time=0.39440 
Train Epoch: 17 [313/500 20032/32000 (63%)] Loss: 0.65865 (QuantReg: 13.25774) QuantErr: 13.25774 batch_time=0.39972 
Train Epoch: 17 [321/500 20544/32000 (64%)] Loss: 0.87467 (QuantReg: 13.53869) QuantErr: 13.53869 batch_time=3.37741 
Train Epoch: 17 [329/500 21056/32000 (66%)] Loss: 0.79388 (QuantReg: 13.38423) QuantErr: 13.38423 batch_time=0.42381 
Train Epoch: 17 [337/500 21568/32000 (67%)] Loss: 1.03203 (QuantReg: 13.66148) QuantErr: 13.66148 batch_time=0.40365 
Train Epoch: 17 [345/500 22080/32000 (69%)] Loss: 0.58015 (QuantReg: 13.59772) QuantErr: 13.59772 batch_time=0.39500 
Train Epoch: 17 [353/500 22592/32000 (71%)] Loss: 0.68238 (QuantReg: 13.21864) QuantErr: 13.21864 batch_time=0.42052 
Train Epoch: 17 [361/500 23104/32000 (72%)] Loss: 0.81943 (QuantReg: 13.37226) QuantErr: 13.37226 batch_time=0.39513 
Train Epoch: 17 [369/500 23616/32000 (74%)] Loss: 0.59988 (QuantReg: 13.70874) QuantErr: 13.70874 batch_time=0.38965 
Train Epoch: 17 [377/500 24128/32000 (75%)] Loss: 0.86452 (QuantReg: 12.66832) QuantErr: 12.66832 batch_time=0.40121 
Train Epoch: 17 [385/500 24640/32000 (77%)] Loss: 0.58598 (QuantReg: 13.04976) QuantErr: 13.04976 batch_time=3.26248 
Train Epoch: 17 [393/500 25152/32000 (79%)] Loss: 0.73866 (QuantReg: 13.21571) QuantErr: 13.21571 batch_time=0.38786 
Train Epoch: 17 [401/500 25664/32000 (80%)] Loss: 0.72025 (QuantReg: 13.48135) QuantErr: 13.48135 batch_time=0.40585 
Train Epoch: 17 [409/500 26176/32000 (82%)] Loss: 0.80400 (QuantReg: 13.85638) QuantErr: 13.85638 batch_time=0.40437 
Train Epoch: 17 [417/500 26688/32000 (83%)] Loss: 0.73493 (QuantReg: 13.48048) QuantErr: 13.48048 batch_time=0.40935 
Train Epoch: 17 [425/500 27200/32000 (85%)] Loss: 1.15291 (QuantReg: 13.43960) QuantErr: 13.43960 batch_time=0.40132 
Train Epoch: 17 [433/500 27712/32000 (87%)] Loss: 1.28890 (QuantReg: 13.31785) QuantErr: 13.31785 batch_time=0.39386 
Train Epoch: 17 [441/500 28224/32000 (88%)] Loss: 0.80374 (QuantReg: 13.11296) QuantErr: 13.11296 batch_time=0.39080 
Train Epoch: 17 [449/500 28736/32000 (90%)] Loss: 0.75721 (QuantReg: 13.28057) QuantErr: 13.28057 batch_time=3.44124 
Train Epoch: 17 [457/500 29248/32000 (91%)] Loss: 0.74403 (QuantReg: 13.47340) QuantErr: 13.47340 batch_time=0.41042 
Train Epoch: 17 [465/500 29760/32000 (93%)] Loss: 0.84425 (QuantReg: 13.27735) QuantErr: 13.27735 batch_time=0.39934 
Train Epoch: 17 [473/500 30272/32000 (95%)] Loss: 0.46636 (QuantReg: 13.41299) QuantErr: 13.41299 batch_time=0.39777 
Train Epoch: 17 [481/500 30784/32000 (96%)] Loss: 0.55209 (QuantReg: 13.12167) QuantErr: 13.12167 batch_time=0.39947 
Train Epoch: 17 [489/500 31296/32000 (98%)] Loss: 0.89178 (QuantReg: 13.39213) QuantErr: 13.39213 batch_time=0.40013 
Train Epoch: 17 [497/500 31808/32000 (99%)] Loss: 1.06712 (QuantReg: 13.50851) QuantErr: 13.50851 batch_time=0.39509 
Train Epoch: 17 codebook_update_time=1.95505
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch17.pth ...
Done in 3.881s
removing stale ckpt [epoch 16] [took 0.00s]
 epoch          : 17
 loss           : 0.757416946709156
 quant_reg      : 13.31043208694458
 quant_err      : 13.31043208694458
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 67.40442655935614
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.259557344064387
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.96495516998862
 MSRVTT_full_val/v2t_metrics/R1: 36.61971830985915
 MSRVTT_full_val/v2t_metrics/R5: 73.64185110663983
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.583501006036217
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.467048342479245
 MSRVTT_full_test/t2v_metrics/R1: 12.274247491638796
 MSRVTT_full_test/t2v_metrics/R5: 34.98327759197324
 MSRVTT_full_test/t2v_metrics/R10: 49.264214046822744
 MSRVTT_full_test/t2v_metrics/R50: 81.37123745819397
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.685953177257524
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.656399725143533
 MSRVTT_full_test/v2t_metrics/R1: 15.016722408026755
 MSRVTT_full_test/v2t_metrics/R5: 41.73913043478261
 MSRVTT_full_test/v2t_metrics/R10: 56.78929765886288
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.10033444816054
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.89488323106165
 mnt_best       : 28.172933204092104
 not_improved_count: 1
Train Epoch: 18 [1/500 64/32000 (0%)] Loss: 1.67231 (QuantReg: 12.93590) QuantErr: 12.93590 batch_time=33.35778 
Train Epoch: 18 [9/500 576/32000 (2%)] Loss: 0.51668 (QuantReg: 13.49482) QuantErr: 13.49482 batch_time=0.40295 
Train Epoch: 18 [17/500 1088/32000 (3%)] Loss: 0.75641 (QuantReg: 12.87952) QuantErr: 12.87952 batch_time=0.39479 
Train Epoch: 18 [25/500 1600/32000 (5%)] Loss: 0.66918 (QuantReg: 13.01510) QuantErr: 13.01510 batch_time=0.38966 
Train Epoch: 18 [33/500 2112/32000 (7%)] Loss: 0.61042 (QuantReg: 13.62234) QuantErr: 13.62234 batch_time=0.44865 
Train Epoch: 18 [41/500 2624/32000 (8%)] Loss: 0.67858 (QuantReg: 12.90693) QuantErr: 12.90693 batch_time=0.39370 
Train Epoch: 18 [49/500 3136/32000 (10%)] Loss: 0.61861 (QuantReg: 13.20332) QuantErr: 13.20332 batch_time=0.39552 
Train Epoch: 18 [57/500 3648/32000 (11%)] Loss: 0.63455 (QuantReg: 13.05474) QuantErr: 13.05474 batch_time=0.39074 
Train Epoch: 18 [65/500 4160/32000 (13%)] Loss: 0.87551 (QuantReg: 12.63166) QuantErr: 12.63166 batch_time=0.38182 
Train Epoch: 18 [73/500 4672/32000 (15%)] Loss: 0.71895 (QuantReg: 12.91223) QuantErr: 12.91223 batch_time=0.38154 
Train Epoch: 18 [81/500 5184/32000 (16%)] Loss: 1.24976 (QuantReg: 13.51600) QuantErr: 13.51600 batch_time=0.38460 
Train Epoch: 18 [89/500 5696/32000 (18%)] Loss: 0.84798 (QuantReg: 13.05184) QuantErr: 13.05184 batch_time=0.38404 
Train Epoch: 18 [97/500 6208/32000 (19%)] Loss: 0.66156 (QuantReg: 13.24951) QuantErr: 13.24951 batch_time=0.44800 
Train Epoch: 18 [105/500 6720/32000 (21%)] Loss: 0.76988 (QuantReg: 12.96683) QuantErr: 12.96683 batch_time=0.39631 
Train Epoch: 18 [113/500 7232/32000 (23%)] Loss: 0.61282 (QuantReg: 13.25207) QuantErr: 13.25207 batch_time=0.41502 
Train Epoch: 18 [121/500 7744/32000 (24%)] Loss: 0.85871 (QuantReg: 13.28980) QuantErr: 13.28980 batch_time=0.42095 
Train Epoch: 18 [129/500 8256/32000 (26%)] Loss: 0.72310 (QuantReg: 13.23824) QuantErr: 13.23824 batch_time=0.38160 
Train Epoch: 18 [137/500 8768/32000 (27%)] Loss: 0.61946 (QuantReg: 13.52528) QuantErr: 13.52528 batch_time=0.38299 
Train Epoch: 18 [145/500 9280/32000 (29%)] Loss: 0.65383 (QuantReg: 13.68801) QuantErr: 13.68801 batch_time=0.39222 
Train Epoch: 18 [153/500 9792/32000 (31%)] Loss: 0.95480 (QuantReg: 12.97292) QuantErr: 12.97292 batch_time=0.45111 
Train Epoch: 18 [161/500 10304/32000 (32%)] Loss: 0.64247 (QuantReg: 13.72867) QuantErr: 13.72867 batch_time=0.50921 
Train Epoch: 18 [169/500 10816/32000 (34%)] Loss: 0.85726 (QuantReg: 13.43365) QuantErr: 13.43365 batch_time=0.40077 
Train Epoch: 18 [177/500 11328/32000 (35%)] Loss: 0.64696 (QuantReg: 13.68409) QuantErr: 13.68409 batch_time=0.39047 
Train Epoch: 18 [185/500 11840/32000 (37%)] Loss: 0.68522 (QuantReg: 13.78461) QuantErr: 13.78461 batch_time=0.39585 
Train Epoch: 18 [193/500 12352/32000 (39%)] Loss: 0.73732 (QuantReg: 13.64165) QuantErr: 13.64165 batch_time=0.38846 
Train Epoch: 18 [201/500 12864/32000 (40%)] Loss: 0.65416 (QuantReg: 13.06761) QuantErr: 13.06761 batch_time=0.66900 
Train Epoch: 18 [209/500 13376/32000 (42%)] Loss: 0.57890 (QuantReg: 13.60895) QuantErr: 13.60895 batch_time=0.38456 
Train Epoch: 18 [217/500 13888/32000 (43%)] Loss: 0.71075 (QuantReg: 13.44998) QuantErr: 13.44998 batch_time=0.42780 
Train Epoch: 18 [225/500 14400/32000 (45%)] Loss: 0.72766 (QuantReg: 13.09505) QuantErr: 13.09505 batch_time=0.50712 
Train Epoch: 18 [233/500 14912/32000 (47%)] Loss: 0.74203 (QuantReg: 13.31221) QuantErr: 13.31221 batch_time=0.38305 
Train Epoch: 18 [241/500 15424/32000 (48%)] Loss: 0.77137 (QuantReg: 13.29582) QuantErr: 13.29582 batch_time=0.39261 
Train Epoch: 18 [249/500 15936/32000 (50%)] Loss: 0.55659 (QuantReg: 13.33391) QuantErr: 13.33391 batch_time=0.40525 
Train Epoch: 18 [257/500 16448/32000 (51%)] Loss: 0.64586 (QuantReg: 13.30268) QuantErr: 13.30268 batch_time=0.41903 
Train Epoch: 18 [265/500 16960/32000 (53%)] Loss: 0.66590 (QuantReg: 13.46029) QuantErr: 13.46029 batch_time=0.37984 
Train Epoch: 18 [273/500 17472/32000 (55%)] Loss: 1.15235 (QuantReg: 13.17845) QuantErr: 13.17845 batch_time=0.38847 
Train Epoch: 18 [281/500 17984/32000 (56%)] Loss: 0.42474 (QuantReg: 13.48782) QuantErr: 13.48782 batch_time=0.40298 
Train Epoch: 18 [289/500 18496/32000 (58%)] Loss: 0.63646 (QuantReg: 12.98069) QuantErr: 12.98069 batch_time=0.44813 
Train Epoch: 18 [297/500 19008/32000 (59%)] Loss: 0.80016 (QuantReg: 13.11814) QuantErr: 13.11814 batch_time=0.40325 
Train Epoch: 18 [305/500 19520/32000 (61%)] Loss: 1.04360 (QuantReg: 13.28865) QuantErr: 13.28865 batch_time=0.39063 
Train Epoch: 18 [313/500 20032/32000 (63%)] Loss: 0.92476 (QuantReg: 13.21315) QuantErr: 13.21315 batch_time=0.39541 
Train Epoch: 18 [321/500 20544/32000 (64%)] Loss: 0.57968 (QuantReg: 13.52020) QuantErr: 13.52020 batch_time=0.38635 
Train Epoch: 18 [329/500 21056/32000 (66%)] Loss: 1.01598 (QuantReg: 12.92469) QuantErr: 12.92469 batch_time=0.40304 
Train Epoch: 18 [337/500 21568/32000 (67%)] Loss: 0.92737 (QuantReg: 13.17572) QuantErr: 13.17572 batch_time=0.40828 
Train Epoch: 18 [345/500 22080/32000 (69%)] Loss: 0.67775 (QuantReg: 13.52084) QuantErr: 13.52084 batch_time=0.39109 
Train Epoch: 18 [353/500 22592/32000 (71%)] Loss: 0.94628 (QuantReg: 13.25109) QuantErr: 13.25109 batch_time=0.44494 
Train Epoch: 18 [361/500 23104/32000 (72%)] Loss: 0.63871 (QuantReg: 13.26126) QuantErr: 13.26126 batch_time=0.40421 
Train Epoch: 18 [369/500 23616/32000 (74%)] Loss: 1.05555 (QuantReg: 12.84180) QuantErr: 12.84180 batch_time=0.40098 
Train Epoch: 18 [377/500 24128/32000 (75%)] Loss: 0.75306 (QuantReg: 13.55881) QuantErr: 13.55881 batch_time=0.39015 
Train Epoch: 18 [385/500 24640/32000 (77%)] Loss: 0.78585 (QuantReg: 13.11177) QuantErr: 13.11177 batch_time=0.38331 
Train Epoch: 18 [393/500 25152/32000 (79%)] Loss: 0.82762 (QuantReg: 13.24825) QuantErr: 13.24825 batch_time=0.38792 
Train Epoch: 18 [401/500 25664/32000 (80%)] Loss: 0.95236 (QuantReg: 13.21441) QuantErr: 13.21441 batch_time=0.39168 
Train Epoch: 18 [409/500 26176/32000 (82%)] Loss: 0.55062 (QuantReg: 13.45401) QuantErr: 13.45401 batch_time=0.38523 
Train Epoch: 18 [417/500 26688/32000 (83%)] Loss: 0.52347 (QuantReg: 13.29882) QuantErr: 13.29882 batch_time=0.46541 
Train Epoch: 18 [425/500 27200/32000 (85%)] Loss: 0.49299 (QuantReg: 13.50137) QuantErr: 13.50137 batch_time=0.39393 
Train Epoch: 18 [433/500 27712/32000 (87%)] Loss: 0.69723 (QuantReg: 13.51516) QuantErr: 13.51516 batch_time=0.39656 
Train Epoch: 18 [441/500 28224/32000 (88%)] Loss: 0.97450 (QuantReg: 13.20295) QuantErr: 13.20295 batch_time=0.39570 
Train Epoch: 18 [449/500 28736/32000 (90%)] Loss: 0.79358 (QuantReg: 13.02543) QuantErr: 13.02543 batch_time=0.38685 
Train Epoch: 18 [457/500 29248/32000 (91%)] Loss: 0.52564 (QuantReg: 14.08538) QuantErr: 14.08538 batch_time=0.39576 
Train Epoch: 18 [465/500 29760/32000 (93%)] Loss: 0.98972 (QuantReg: 13.36402) QuantErr: 13.36402 batch_time=0.38815 
Train Epoch: 18 [473/500 30272/32000 (95%)] Loss: 0.85091 (QuantReg: 13.65532) QuantErr: 13.65532 batch_time=0.39527 
Train Epoch: 18 [481/500 30784/32000 (96%)] Loss: 0.69566 (QuantReg: 13.11278) QuantErr: 13.11278 batch_time=0.45246 
Train Epoch: 18 [489/500 31296/32000 (98%)] Loss: 0.75294 (QuantReg: 13.62475) QuantErr: 13.62475 batch_time=0.38485 
Train Epoch: 18 [497/500 31808/32000 (99%)] Loss: 0.59421 (QuantReg: 13.35698) QuantErr: 13.35698 batch_time=0.38633 
Train Epoch: 18 codebook_update_time=2.03856
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch18.pth ...
Done in 17.546s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch18.pth ...
Done in 21.476s
removing stale ckpt [epoch 17] [took 0.00s]
 epoch          : 18
 loss           : 0.7507967338562012
 quant_reg      : 13.302279209136962
 quant_err      : 13.302279209136962
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 33.199195171026155
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 80.0804828973843
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.66599597585513
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.98903673231796
 MSRVTT_full_val/v2t_metrics/R1: 37.02213279678068
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.9678068410462775
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.45534869425315
 MSRVTT_full_test/t2v_metrics/R1: 12.94314381270903
 MSRVTT_full_test/t2v_metrics/R5: 35.919732441471574
 MSRVTT_full_test/t2v_metrics/R10: 50.20066889632107
 MSRVTT_full_test/t2v_metrics/R50: 81.40468227424749
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.06772575250836
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.577712177186918
 MSRVTT_full_test/v2t_metrics/R1: 14.949832775919733
 MSRVTT_full_test/v2t_metrics/R5: 42.675585284280935
 MSRVTT_full_test/v2t_metrics/R10: 57.725752508361204
 MSRVTT_full_test/v2t_metrics/R50: 87.25752508361204
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.89648829431438
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.27069001454114
 mnt_best       : 28.577712177186918
 not_improved_count: 0
Train Epoch: 19 [1/500 64/32000 (0%)] Loss: 0.58171 (QuantReg: 13.41374) QuantErr: 13.41374 batch_time=31.85697 
Train Epoch: 19 [9/500 576/32000 (2%)] Loss: 0.52572 (QuantReg: 13.45886) QuantErr: 13.45886 batch_time=0.40819 
Train Epoch: 19 [17/500 1088/32000 (3%)] Loss: 0.96337 (QuantReg: 12.52900) QuantErr: 12.52900 batch_time=0.40611 
Train Epoch: 19 [25/500 1600/32000 (5%)] Loss: 1.25723 (QuantReg: 13.55814) QuantErr: 13.55814 batch_time=0.39243 
Train Epoch: 19 [33/500 2112/32000 (7%)] Loss: 0.66166 (QuantReg: 13.64715) QuantErr: 13.64715 batch_time=0.39548 
Train Epoch: 19 [41/500 2624/32000 (8%)] Loss: 0.59401 (QuantReg: 13.02843) QuantErr: 13.02843 batch_time=0.40211 
Train Epoch: 19 [49/500 3136/32000 (10%)] Loss: 0.80604 (QuantReg: 12.97075) QuantErr: 12.97075 batch_time=0.40333 
Train Epoch: 19 [57/500 3648/32000 (11%)] Loss: 0.89425 (QuantReg: 13.38270) QuantErr: 13.38270 batch_time=0.40206 
Train Epoch: 19 [65/500 4160/32000 (13%)] Loss: 0.72130 (QuantReg: 13.28930) QuantErr: 13.28930 batch_time=0.39561 
Train Epoch: 19 [73/500 4672/32000 (15%)] Loss: 0.52128 (QuantReg: 13.39392) QuantErr: 13.39392 batch_time=0.40075 
Train Epoch: 19 [81/500 5184/32000 (16%)] Loss: 0.70556 (QuantReg: 13.52858) QuantErr: 13.52858 batch_time=0.44483 
Train Epoch: 19 [89/500 5696/32000 (18%)] Loss: 0.68624 (QuantReg: 13.11384) QuantErr: 13.11384 batch_time=0.40123 
Train Epoch: 19 [97/500 6208/32000 (19%)] Loss: 1.18369 (QuantReg: 13.50021) QuantErr: 13.50021 batch_time=0.40560 
Train Epoch: 19 [105/500 6720/32000 (21%)] Loss: 0.77742 (QuantReg: 13.12902) QuantErr: 13.12902 batch_time=0.40035 
Train Epoch: 19 [113/500 7232/32000 (23%)] Loss: 0.74031 (QuantReg: 13.37571) QuantErr: 13.37571 batch_time=0.39214 
Train Epoch: 19 [121/500 7744/32000 (24%)] Loss: 0.62712 (QuantReg: 13.02908) QuantErr: 13.02908 batch_time=0.38492 
Train Epoch: 19 [129/500 8256/32000 (26%)] Loss: 0.67016 (QuantReg: 13.60999) QuantErr: 13.60999 batch_time=0.39732 
Train Epoch: 19 [137/500 8768/32000 (27%)] Loss: 0.48648 (QuantReg: 13.65047) QuantErr: 13.65047 batch_time=0.40417 
Train Epoch: 19 [145/500 9280/32000 (29%)] Loss: 0.57086 (QuantReg: 13.36054) QuantErr: 13.36054 batch_time=0.42344 
Train Epoch: 19 [153/500 9792/32000 (31%)] Loss: 0.63144 (QuantReg: 13.74062) QuantErr: 13.74062 batch_time=0.38413 
Train Epoch: 19 [161/500 10304/32000 (32%)] Loss: 0.62887 (QuantReg: 13.52451) QuantErr: 13.52451 batch_time=0.42694 
Train Epoch: 19 [169/500 10816/32000 (34%)] Loss: 0.45701 (QuantReg: 13.49539) QuantErr: 13.49539 batch_time=0.41638 
Train Epoch: 19 [177/500 11328/32000 (35%)] Loss: 0.71766 (QuantReg: 13.17623) QuantErr: 13.17623 batch_time=0.40152 
Train Epoch: 19 [185/500 11840/32000 (37%)] Loss: 0.57951 (QuantReg: 13.25450) QuantErr: 13.25450 batch_time=0.39004 
Train Epoch: 19 [193/500 12352/32000 (39%)] Loss: 0.47379 (QuantReg: 13.41422) QuantErr: 13.41422 batch_time=0.39591 
Train Epoch: 19 [201/500 12864/32000 (40%)] Loss: 0.68823 (QuantReg: 13.34291) QuantErr: 13.34291 batch_time=0.38824 
Train Epoch: 19 [209/500 13376/32000 (42%)] Loss: 0.30017 (QuantReg: 13.57993) QuantErr: 13.57993 batch_time=0.39962 
Train Epoch: 19 [217/500 13888/32000 (43%)] Loss: 0.47117 (QuantReg: 13.18079) QuantErr: 13.18079 batch_time=0.39737 
Train Epoch: 19 [225/500 14400/32000 (45%)] Loss: 0.40520 (QuantReg: 13.04273) QuantErr: 13.04273 batch_time=0.39214 
Train Epoch: 19 [233/500 14912/32000 (47%)] Loss: 0.69377 (QuantReg: 12.90993) QuantErr: 12.90993 batch_time=0.38418 
Train Epoch: 19 [241/500 15424/32000 (48%)] Loss: 0.78541 (QuantReg: 13.30191) QuantErr: 13.30191 batch_time=0.39543 
Train Epoch: 19 [249/500 15936/32000 (50%)] Loss: 0.65818 (QuantReg: 13.38223) QuantErr: 13.38223 batch_time=0.38826 
Train Epoch: 19 [257/500 16448/32000 (51%)] Loss: 0.65223 (QuantReg: 12.76233) QuantErr: 12.76233 batch_time=0.39973 
Train Epoch: 19 [265/500 16960/32000 (53%)] Loss: 0.67707 (QuantReg: 13.39374) QuantErr: 13.39374 batch_time=0.38788 
Train Epoch: 19 [273/500 17472/32000 (55%)] Loss: 0.75063 (QuantReg: 13.18245) QuantErr: 13.18245 batch_time=0.38322 
Train Epoch: 19 [281/500 17984/32000 (56%)] Loss: 0.79132 (QuantReg: 13.18446) QuantErr: 13.18446 batch_time=0.39479 
Train Epoch: 19 [289/500 18496/32000 (58%)] Loss: 0.48717 (QuantReg: 13.08898) QuantErr: 13.08898 batch_time=0.39067 
Train Epoch: 19 [297/500 19008/32000 (59%)] Loss: 0.62595 (QuantReg: 13.42500) QuantErr: 13.42500 batch_time=0.39349 
Train Epoch: 19 [305/500 19520/32000 (61%)] Loss: 0.73710 (QuantReg: 13.59352) QuantErr: 13.59352 batch_time=0.39281 
Train Epoch: 19 [313/500 20032/32000 (63%)] Loss: 0.65472 (QuantReg: 13.80374) QuantErr: 13.80374 batch_time=0.40908 
Train Epoch: 19 [321/500 20544/32000 (64%)] Loss: 0.67846 (QuantReg: 13.81370) QuantErr: 13.81370 batch_time=0.39263 
Train Epoch: 19 [329/500 21056/32000 (66%)] Loss: 0.76013 (QuantReg: 13.89005) QuantErr: 13.89005 batch_time=0.38726 
Train Epoch: 19 [337/500 21568/32000 (67%)] Loss: 0.67768 (QuantReg: 13.55185) QuantErr: 13.55185 batch_time=0.39266 
Train Epoch: 19 [345/500 22080/32000 (69%)] Loss: 1.01274 (QuantReg: 13.27235) QuantErr: 13.27235 batch_time=0.39999 
Train Epoch: 19 [353/500 22592/32000 (71%)] Loss: 0.48572 (QuantReg: 13.26237) QuantErr: 13.26237 batch_time=0.39516 
Train Epoch: 19 [361/500 23104/32000 (72%)] Loss: 0.73382 (QuantReg: 13.34497) QuantErr: 13.34497 batch_time=0.40613 
Train Epoch: 19 [369/500 23616/32000 (74%)] Loss: 0.85152 (QuantReg: 13.33790) QuantErr: 13.33790 batch_time=0.39922 
Train Epoch: 19 [377/500 24128/32000 (75%)] Loss: 0.45685 (QuantReg: 13.80842) QuantErr: 13.80842 batch_time=0.39042 
Train Epoch: 19 [385/500 24640/32000 (77%)] Loss: 0.46571 (QuantReg: 13.49121) QuantErr: 13.49121 batch_time=0.39594 
Train Epoch: 19 [393/500 25152/32000 (79%)] Loss: 0.51456 (QuantReg: 13.57299) QuantErr: 13.57299 batch_time=0.39565 
Train Epoch: 19 [401/500 25664/32000 (80%)] Loss: 0.79524 (QuantReg: 13.33875) QuantErr: 13.33875 batch_time=0.39249 
Train Epoch: 19 [409/500 26176/32000 (82%)] Loss: 0.61437 (QuantReg: 13.62070) QuantErr: 13.62070 batch_time=0.40316 
Train Epoch: 19 [417/500 26688/32000 (83%)] Loss: 0.48120 (QuantReg: 13.39817) QuantErr: 13.39817 batch_time=0.43301 
Train Epoch: 19 [425/500 27200/32000 (85%)] Loss: 0.72208 (QuantReg: 13.40437) QuantErr: 13.40437 batch_time=0.42397 
Train Epoch: 19 [433/500 27712/32000 (87%)] Loss: 0.61098 (QuantReg: 13.56877) QuantErr: 13.56877 batch_time=0.39388 
Train Epoch: 19 [441/500 28224/32000 (88%)] Loss: 0.54053 (QuantReg: 13.61618) QuantErr: 13.61618 batch_time=0.40745 
Train Epoch: 19 [449/500 28736/32000 (90%)] Loss: 0.52675 (QuantReg: 13.34881) QuantErr: 13.34881 batch_time=0.45896 
Train Epoch: 19 [457/500 29248/32000 (91%)] Loss: 0.49424 (QuantReg: 13.71598) QuantErr: 13.71598 batch_time=0.38835 
Train Epoch: 19 [465/500 29760/32000 (93%)] Loss: 0.38676 (QuantReg: 13.28498) QuantErr: 13.28498 batch_time=0.41131 
Train Epoch: 19 [473/500 30272/32000 (95%)] Loss: 0.74760 (QuantReg: 13.40761) QuantErr: 13.40761 batch_time=0.40057 
Train Epoch: 19 [481/500 30784/32000 (96%)] Loss: 0.71031 (QuantReg: 13.41188) QuantErr: 13.41188 batch_time=0.39341 
Train Epoch: 19 [489/500 31296/32000 (98%)] Loss: 0.61220 (QuantReg: 13.37785) QuantErr: 13.37785 batch_time=0.39312 
Train Epoch: 19 [497/500 31808/32000 (99%)] Loss: 0.62966 (QuantReg: 13.68412) QuantErr: 13.68412 batch_time=0.38958 
Train Epoch: 19 codebook_update_time=1.84304
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch19.pth ...
Done in 3.949s
removing stale ckpt [epoch 18] [took 0.00s]
 epoch          : 19
 loss           : 0.7012488372325897
 quant_reg      : 13.35901477622986
 quant_err      : 13.35901477622986
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 67.6056338028169
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.541247484909457
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.928424661234615
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 74.64788732394366
 MSRVTT_full_val/v2t_metrics/R10: 85.51307847082495
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.227364185110664
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.488054130054124
 MSRVTT_full_test/t2v_metrics/R1: 12.307692307692308
 MSRVTT_full_test/t2v_metrics/R5: 35.719063545150505
 MSRVTT_full_test/t2v_metrics/R10: 50.30100334448161
 MSRVTT_full_test/t2v_metrics/R50: 80.66889632107024
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.313545150501675
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.068408007261333
 MSRVTT_full_test/v2t_metrics/R1: 15.050167224080267
 MSRVTT_full_test/v2t_metrics/R5: 41.7056856187291
 MSRVTT_full_test/v2t_metrics/R10: 57.525083612040135
 MSRVTT_full_test/v2t_metrics/R50: 87.19063545150502
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.740635451505018
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.05201565062329
 mnt_best       : 28.577712177186918
 not_improved_count: 1
Train Epoch: 20 [1/500 64/32000 (0%)] Loss: 0.76326 (QuantReg: 13.10579) QuantErr: 13.10579 batch_time=32.17420 
Train Epoch: 20 [9/500 576/32000 (2%)] Loss: 0.67936 (QuantReg: 13.21358) QuantErr: 13.21358 batch_time=0.39394 
Train Epoch: 20 [17/500 1088/32000 (3%)] Loss: 0.57394 (QuantReg: 13.47550) QuantErr: 13.47550 batch_time=0.38802 
Train Epoch: 20 [25/500 1600/32000 (5%)] Loss: 0.91812 (QuantReg: 12.75498) QuantErr: 12.75498 batch_time=0.40889 
Train Epoch: 20 [33/500 2112/32000 (7%)] Loss: 0.46532 (QuantReg: 13.08243) QuantErr: 13.08243 batch_time=0.39014 
Train Epoch: 20 [41/500 2624/32000 (8%)] Loss: 0.82447 (QuantReg: 13.12918) QuantErr: 13.12918 batch_time=0.39952 
Train Epoch: 20 [49/500 3136/32000 (10%)] Loss: 0.69848 (QuantReg: 13.06213) QuantErr: 13.06213 batch_time=0.38887 
Train Epoch: 20 [57/500 3648/32000 (11%)] Loss: 0.53663 (QuantReg: 13.31717) QuantErr: 13.31717 batch_time=0.39633 
Train Epoch: 20 [65/500 4160/32000 (13%)] Loss: 0.54163 (QuantReg: 13.15467) QuantErr: 13.15467 batch_time=0.51593 
Train Epoch: 20 [73/500 4672/32000 (15%)] Loss: 0.48586 (QuantReg: 13.60213) QuantErr: 13.60213 batch_time=0.39511 
Train Epoch: 20 [81/500 5184/32000 (16%)] Loss: 0.68673 (QuantReg: 13.58514) QuantErr: 13.58514 batch_time=0.39268 
Train Epoch: 20 [89/500 5696/32000 (18%)] Loss: 1.02110 (QuantReg: 13.11161) QuantErr: 13.11161 batch_time=0.44300 
Train Epoch: 20 [97/500 6208/32000 (19%)] Loss: 1.00911 (QuantReg: 12.88593) QuantErr: 12.88593 batch_time=0.39179 
Train Epoch: 20 [105/500 6720/32000 (21%)] Loss: 0.53940 (QuantReg: 13.20213) QuantErr: 13.20213 batch_time=0.39587 
Train Epoch: 20 [113/500 7232/32000 (23%)] Loss: 0.77899 (QuantReg: 13.47776) QuantErr: 13.47776 batch_time=0.40349 
Train Epoch: 20 [121/500 7744/32000 (24%)] Loss: 0.74600 (QuantReg: 13.31000) QuantErr: 13.31000 batch_time=0.40880 
Train Epoch: 20 [129/500 8256/32000 (26%)] Loss: 0.77869 (QuantReg: 13.24159) QuantErr: 13.24159 batch_time=0.53996 
Train Epoch: 20 [137/500 8768/32000 (27%)] Loss: 0.54223 (QuantReg: 12.71733) QuantErr: 12.71733 batch_time=0.38537 
Train Epoch: 20 [145/500 9280/32000 (29%)] Loss: 0.53230 (QuantReg: 13.08822) QuantErr: 13.08822 batch_time=0.38286 
Train Epoch: 20 [153/500 9792/32000 (31%)] Loss: 0.48649 (QuantReg: 13.55497) QuantErr: 13.55497 batch_time=0.39031 
Train Epoch: 20 [161/500 10304/32000 (32%)] Loss: 0.63119 (QuantReg: 13.53557) QuantErr: 13.53557 batch_time=0.39796 
Train Epoch: 20 [169/500 10816/32000 (34%)] Loss: 0.71162 (QuantReg: 13.37190) QuantErr: 13.37190 batch_time=0.41555 
Train Epoch: 20 [177/500 11328/32000 (35%)] Loss: 1.18071 (QuantReg: 13.12116) QuantErr: 13.12116 batch_time=0.38697 
Train Epoch: 20 [185/500 11840/32000 (37%)] Loss: 0.58327 (QuantReg: 13.64912) QuantErr: 13.64912 batch_time=0.39465 
Train Epoch: 20 [193/500 12352/32000 (39%)] Loss: 0.52243 (QuantReg: 13.51661) QuantErr: 13.51661 batch_time=0.51510 
Train Epoch: 20 [201/500 12864/32000 (40%)] Loss: 0.78997 (QuantReg: 13.15567) QuantErr: 13.15567 batch_time=0.39381 
Train Epoch: 20 [209/500 13376/32000 (42%)] Loss: 0.68720 (QuantReg: 13.54151) QuantErr: 13.54151 batch_time=0.38893 
Train Epoch: 20 [217/500 13888/32000 (43%)] Loss: 0.87939 (QuantReg: 13.45048) QuantErr: 13.45048 batch_time=0.38745 
Train Epoch: 20 [225/500 14400/32000 (45%)] Loss: 0.47715 (QuantReg: 13.44564) QuantErr: 13.44564 batch_time=0.38634 
Train Epoch: 20 [233/500 14912/32000 (47%)] Loss: 0.51800 (QuantReg: 13.18915) QuantErr: 13.18915 batch_time=0.39678 
Train Epoch: 20 [241/500 15424/32000 (48%)] Loss: 1.07310 (QuantReg: 12.85107) QuantErr: 12.85107 batch_time=0.39774 
Train Epoch: 20 [249/500 15936/32000 (50%)] Loss: 0.58992 (QuantReg: 13.42433) QuantErr: 13.42433 batch_time=0.40022 
Train Epoch: 20 [257/500 16448/32000 (51%)] Loss: 0.63532 (QuantReg: 13.46020) QuantErr: 13.46020 batch_time=0.51423 
Train Epoch: 20 [265/500 16960/32000 (53%)] Loss: 0.54052 (QuantReg: 13.22703) QuantErr: 13.22703 batch_time=0.40451 
Train Epoch: 20 [273/500 17472/32000 (55%)] Loss: 0.68179 (QuantReg: 13.07794) QuantErr: 13.07794 batch_time=0.39334 
Train Epoch: 20 [281/500 17984/32000 (56%)] Loss: 0.52682 (QuantReg: 13.46608) QuantErr: 13.46608 batch_time=0.38789 
Train Epoch: 20 [289/500 18496/32000 (58%)] Loss: 0.91797 (QuantReg: 13.35597) QuantErr: 13.35597 batch_time=0.39008 
Train Epoch: 20 [297/500 19008/32000 (59%)] Loss: 0.50048 (QuantReg: 13.39713) QuantErr: 13.39713 batch_time=0.40135 
Train Epoch: 20 [305/500 19520/32000 (61%)] Loss: 0.77139 (QuantReg: 12.98083) QuantErr: 12.98083 batch_time=0.39453 
Train Epoch: 20 [313/500 20032/32000 (63%)] Loss: 0.98449 (QuantReg: 13.19965) QuantErr: 13.19965 batch_time=0.41666 
Train Epoch: 20 [321/500 20544/32000 (64%)] Loss: 0.78677 (QuantReg: 12.93872) QuantErr: 12.93872 batch_time=0.50926 
Train Epoch: 20 [329/500 21056/32000 (66%)] Loss: 0.49052 (QuantReg: 13.46290) QuantErr: 13.46290 batch_time=0.39066 
Train Epoch: 20 [337/500 21568/32000 (67%)] Loss: 0.64326 (QuantReg: 13.36175) QuantErr: 13.36175 batch_time=0.40242 
Train Epoch: 20 [345/500 22080/32000 (69%)] Loss: 0.56669 (QuantReg: 13.79068) QuantErr: 13.79068 batch_time=0.39814 
Train Epoch: 20 [353/500 22592/32000 (71%)] Loss: 0.50340 (QuantReg: 13.71315) QuantErr: 13.71315 batch_time=0.39862 
Train Epoch: 20 [361/500 23104/32000 (72%)] Loss: 0.61351 (QuantReg: 13.41121) QuantErr: 13.41121 batch_time=0.38646 
Train Epoch: 20 [369/500 23616/32000 (74%)] Loss: 0.93496 (QuantReg: 13.24067) QuantErr: 13.24067 batch_time=0.38535 
Train Epoch: 20 [377/500 24128/32000 (75%)] Loss: 0.46395 (QuantReg: 13.31969) QuantErr: 13.31969 batch_time=0.38882 
Train Epoch: 20 [385/500 24640/32000 (77%)] Loss: 0.60562 (QuantReg: 13.07533) QuantErr: 13.07533 batch_time=0.50979 
Train Epoch: 20 [393/500 25152/32000 (79%)] Loss: 0.61541 (QuantReg: 13.93228) QuantErr: 13.93228 batch_time=0.39540 
Train Epoch: 20 [401/500 25664/32000 (80%)] Loss: 0.67366 (QuantReg: 13.79390) QuantErr: 13.79390 batch_time=0.39397 
Train Epoch: 20 [409/500 26176/32000 (82%)] Loss: 0.40040 (QuantReg: 13.19697) QuantErr: 13.19697 batch_time=0.39528 
Train Epoch: 20 [417/500 26688/32000 (83%)] Loss: 0.54649 (QuantReg: 13.85474) QuantErr: 13.85474 batch_time=0.38736 
Train Epoch: 20 [425/500 27200/32000 (85%)] Loss: 0.38346 (QuantReg: 13.38354) QuantErr: 13.38354 batch_time=0.44886 
Train Epoch: 20 [433/500 27712/32000 (87%)] Loss: 0.89569 (QuantReg: 13.56275) QuantErr: 13.56275 batch_time=0.39631 
Train Epoch: 20 [441/500 28224/32000 (88%)] Loss: 0.68763 (QuantReg: 12.99002) QuantErr: 12.99002 batch_time=0.39391 
Train Epoch: 20 [449/500 28736/32000 (90%)] Loss: 0.92859 (QuantReg: 13.71157) QuantErr: 13.71157 batch_time=0.50628 
Train Epoch: 20 [457/500 29248/32000 (91%)] Loss: 0.71754 (QuantReg: 13.39470) QuantErr: 13.39470 batch_time=0.39216 
Train Epoch: 20 [465/500 29760/32000 (93%)] Loss: 0.36297 (QuantReg: 13.45212) QuantErr: 13.45212 batch_time=0.39065 
Train Epoch: 20 [473/500 30272/32000 (95%)] Loss: 0.35800 (QuantReg: 13.72687) QuantErr: 13.72687 batch_time=0.39525 
Train Epoch: 20 [481/500 30784/32000 (96%)] Loss: 0.85016 (QuantReg: 13.06257) QuantErr: 13.06257 batch_time=0.39163 
Train Epoch: 20 [489/500 31296/32000 (98%)] Loss: 0.88109 (QuantReg: 13.18965) QuantErr: 13.18965 batch_time=0.40220 
Train Epoch: 20 [497/500 31808/32000 (99%)] Loss: 0.81033 (QuantReg: 13.21658) QuantErr: 13.21658 batch_time=0.43694 
Train Epoch: 20 codebook_update_time=1.91276
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch20.pth ...
Done in 3.797s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 0.6714522058367729
 quant_reg      : 13.33327098274231
 quant_err      : 13.33327098274231
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 31.388329979879277
 MSRVTT_full_val/t2v_metrics/R5: 68.2092555331992
 MSRVTT_full_val/t2v_metrics/R10: 79.47686116700201
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.627766599597585
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.41373310793449
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 85.51307847082495
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.344064386317908
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.65991541900338
 MSRVTT_full_test/t2v_metrics/R1: 12.14046822742475
 MSRVTT_full_test/t2v_metrics/R5: 35.785953177257525
 MSRVTT_full_test/t2v_metrics/R10: 50.03344481605351
 MSRVTT_full_test/t2v_metrics/R50: 80.40133779264214
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.86755852842809
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.908477424698475
 MSRVTT_full_test/v2t_metrics/R1: 14.782608695652174
 MSRVTT_full_test/v2t_metrics/R5: 41.30434782608695
 MSRVTT_full_test/v2t_metrics/R10: 57.69230769230769
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.04531772575251
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.78095390606907
 mnt_best       : 28.577712177186918
 not_improved_count: 2
Train Epoch: 21 [1/500 64/32000 (0%)] Loss: 0.50549 (QuantReg: 13.01595) QuantErr: 13.01595 batch_time=32.55736 
Train Epoch: 21 [9/500 576/32000 (2%)] Loss: 0.65881 (QuantReg: 13.38504) QuantErr: 13.38504 batch_time=0.41550 
Train Epoch: 21 [17/500 1088/32000 (3%)] Loss: 0.79152 (QuantReg: 13.70982) QuantErr: 13.70982 batch_time=0.40338 
Train Epoch: 21 [25/500 1600/32000 (5%)] Loss: 0.78228 (QuantReg: 13.40314) QuantErr: 13.40314 batch_time=0.41502 
Train Epoch: 21 [33/500 2112/32000 (7%)] Loss: 0.62650 (QuantReg: 13.39047) QuantErr: 13.39047 batch_time=0.40858 
Train Epoch: 21 [41/500 2624/32000 (8%)] Loss: 1.08201 (QuantReg: 12.51100) QuantErr: 12.51100 batch_time=0.40361 
Train Epoch: 21 [49/500 3136/32000 (10%)] Loss: 1.00428 (QuantReg: 13.27358) QuantErr: 13.27358 batch_time=0.39236 
Train Epoch: 21 [57/500 3648/32000 (11%)] Loss: 0.50965 (QuantReg: 13.01849) QuantErr: 13.01849 batch_time=0.46185 
Train Epoch: 21 [65/500 4160/32000 (13%)] Loss: 0.67654 (QuantReg: 13.36491) QuantErr: 13.36491 batch_time=0.40553 
Train Epoch: 21 [73/500 4672/32000 (15%)] Loss: 0.55030 (QuantReg: 13.32177) QuantErr: 13.32177 batch_time=0.40524 
Train Epoch: 21 [81/500 5184/32000 (16%)] Loss: 0.66105 (QuantReg: 13.65483) QuantErr: 13.65483 batch_time=0.40579 
Train Epoch: 21 [89/500 5696/32000 (18%)] Loss: 0.39241 (QuantReg: 13.35660) QuantErr: 13.35660 batch_time=0.39884 
Train Epoch: 21 [97/500 6208/32000 (19%)] Loss: 0.90338 (QuantReg: 13.31595) QuantErr: 13.31595 batch_time=0.38657 
Train Epoch: 21 [105/500 6720/32000 (21%)] Loss: 0.57463 (QuantReg: 13.34964) QuantErr: 13.34964 batch_time=0.41476 
Train Epoch: 21 [113/500 7232/32000 (23%)] Loss: 0.75215 (QuantReg: 13.36971) QuantErr: 13.36971 batch_time=0.39589 
Train Epoch: 21 [121/500 7744/32000 (24%)] Loss: 0.68378 (QuantReg: 13.38058) QuantErr: 13.38058 batch_time=0.41773 
Train Epoch: 21 [129/500 8256/32000 (26%)] Loss: 0.62407 (QuantReg: 13.54637) QuantErr: 13.54637 batch_time=0.41279 
Train Epoch: 21 [137/500 8768/32000 (27%)] Loss: 0.84484 (QuantReg: 13.19165) QuantErr: 13.19165 batch_time=0.41255 
Train Epoch: 21 [145/500 9280/32000 (29%)] Loss: 1.00779 (QuantReg: 13.17582) QuantErr: 13.17582 batch_time=0.39804 
Train Epoch: 21 [153/500 9792/32000 (31%)] Loss: 0.44982 (QuantReg: 13.13498) QuantErr: 13.13498 batch_time=0.41781 
Train Epoch: 21 [161/500 10304/32000 (32%)] Loss: 0.97203 (QuantReg: 13.77506) QuantErr: 13.77506 batch_time=0.40116 
Train Epoch: 21 [169/500 10816/32000 (34%)] Loss: 0.86264 (QuantReg: 13.03799) QuantErr: 13.03799 batch_time=0.44991 
Train Epoch: 21 [177/500 11328/32000 (35%)] Loss: 0.79718 (QuantReg: 13.30783) QuantErr: 13.30783 batch_time=0.39801 
Train Epoch: 21 [185/500 11840/32000 (37%)] Loss: 0.45454 (QuantReg: 13.10698) QuantErr: 13.10698 batch_time=0.43193 
Train Epoch: 21 [193/500 12352/32000 (39%)] Loss: 0.54686 (QuantReg: 13.40756) QuantErr: 13.40756 batch_time=0.44468 
Train Epoch: 21 [201/500 12864/32000 (40%)] Loss: 0.55174 (QuantReg: 13.68555) QuantErr: 13.68555 batch_time=0.41469 
Train Epoch: 21 [209/500 13376/32000 (42%)] Loss: 0.43724 (QuantReg: 13.57176) QuantErr: 13.57176 batch_time=0.41198 
Train Epoch: 21 [217/500 13888/32000 (43%)] Loss: 0.50529 (QuantReg: 13.64422) QuantErr: 13.64422 batch_time=0.41004 
Train Epoch: 21 [225/500 14400/32000 (45%)] Loss: 0.82750 (QuantReg: 13.52053) QuantErr: 13.52053 batch_time=0.40597 
Train Epoch: 21 [233/500 14912/32000 (47%)] Loss: 0.54567 (QuantReg: 13.51620) QuantErr: 13.51620 batch_time=0.41153 
Train Epoch: 21 [241/500 15424/32000 (48%)] Loss: 0.70571 (QuantReg: 13.30339) QuantErr: 13.30339 batch_time=0.41036 
Train Epoch: 21 [249/500 15936/32000 (50%)] Loss: 0.85679 (QuantReg: 13.52966) QuantErr: 13.52966 batch_time=0.39709 
Train Epoch: 21 [257/500 16448/32000 (51%)] Loss: 0.67431 (QuantReg: 13.12826) QuantErr: 13.12826 batch_time=0.39124 
Train Epoch: 21 [265/500 16960/32000 (53%)] Loss: 0.70883 (QuantReg: 13.05128) QuantErr: 13.05128 batch_time=0.42343 
Train Epoch: 21 [273/500 17472/32000 (55%)] Loss: 0.74707 (QuantReg: 12.87386) QuantErr: 12.87386 batch_time=0.41602 
Train Epoch: 21 [281/500 17984/32000 (56%)] Loss: 0.48756 (QuantReg: 13.03617) QuantErr: 13.03617 batch_time=0.40060 
Train Epoch: 21 [289/500 18496/32000 (58%)] Loss: 0.43004 (QuantReg: 13.47375) QuantErr: 13.47375 batch_time=0.40410 
Train Epoch: 21 [297/500 19008/32000 (59%)] Loss: 0.61631 (QuantReg: 13.76805) QuantErr: 13.76805 batch_time=0.39112 
Train Epoch: 21 [305/500 19520/32000 (61%)] Loss: 0.75324 (QuantReg: 13.76273) QuantErr: 13.76273 batch_time=0.40649 
Train Epoch: 21 [313/500 20032/32000 (63%)] Loss: 0.32801 (QuantReg: 13.41722) QuantErr: 13.41722 batch_time=0.41831 
Train Epoch: 21 [321/500 20544/32000 (64%)] Loss: 0.86818 (QuantReg: 13.39019) QuantErr: 13.39019 batch_time=0.40453 
Train Epoch: 21 [329/500 21056/32000 (66%)] Loss: 0.84726 (QuantReg: 13.30438) QuantErr: 13.30438 batch_time=0.40378 
Train Epoch: 21 [337/500 21568/32000 (67%)] Loss: 0.86532 (QuantReg: 12.97393) QuantErr: 12.97393 batch_time=0.41758 
Train Epoch: 21 [345/500 22080/32000 (69%)] Loss: 0.64228 (QuantReg: 13.18769) QuantErr: 13.18769 batch_time=0.41377 
Train Epoch: 21 [353/500 22592/32000 (71%)] Loss: 0.92915 (QuantReg: 13.58218) QuantErr: 13.58218 batch_time=0.47229 
Train Epoch: 21 [361/500 23104/32000 (72%)] Loss: 0.71177 (QuantReg: 13.34892) QuantErr: 13.34892 batch_time=0.39096 
Train Epoch: 21 [369/500 23616/32000 (74%)] Loss: 0.87759 (QuantReg: 12.65295) QuantErr: 12.65295 batch_time=0.40165 
Train Epoch: 21 [377/500 24128/32000 (75%)] Loss: 0.59848 (QuantReg: 13.74758) QuantErr: 13.74758 batch_time=0.40117 
Train Epoch: 21 [385/500 24640/32000 (77%)] Loss: 0.66277 (QuantReg: 13.45270) QuantErr: 13.45270 batch_time=0.39375 
Train Epoch: 21 [393/500 25152/32000 (79%)] Loss: 0.60768 (QuantReg: 13.16415) QuantErr: 13.16415 batch_time=0.39958 
Train Epoch: 21 [401/500 25664/32000 (80%)] Loss: 0.66294 (QuantReg: 13.43547) QuantErr: 13.43547 batch_time=0.39905 
Train Epoch: 21 [409/500 26176/32000 (82%)] Loss: 0.73681 (QuantReg: 13.55216) QuantErr: 13.55216 batch_time=0.39267 
Train Epoch: 21 [417/500 26688/32000 (83%)] Loss: 0.67681 (QuantReg: 13.84012) QuantErr: 13.84012 batch_time=0.40344 
Train Epoch: 21 [425/500 27200/32000 (85%)] Loss: 0.78988 (QuantReg: 13.43858) QuantErr: 13.43858 batch_time=0.40034 
Train Epoch: 21 [433/500 27712/32000 (87%)] Loss: 0.82425 (QuantReg: 13.48943) QuantErr: 13.48943 batch_time=0.42538 
Train Epoch: 21 [441/500 28224/32000 (88%)] Loss: 0.78486 (QuantReg: 13.14443) QuantErr: 13.14443 batch_time=0.40636 
Train Epoch: 21 [449/500 28736/32000 (90%)] Loss: 0.73293 (QuantReg: 13.90446) QuantErr: 13.90446 batch_time=0.41466 
Train Epoch: 21 [457/500 29248/32000 (91%)] Loss: 0.54535 (QuantReg: 13.41709) QuantErr: 13.41709 batch_time=0.41197 
Train Epoch: 21 [465/500 29760/32000 (93%)] Loss: 0.44903 (QuantReg: 13.74468) QuantErr: 13.74468 batch_time=0.39450 
Train Epoch: 21 [473/500 30272/32000 (95%)] Loss: 0.93021 (QuantReg: 13.25469) QuantErr: 13.25469 batch_time=0.40863 
Train Epoch: 21 [481/500 30784/32000 (96%)] Loss: 0.41856 (QuantReg: 13.73002) QuantErr: 13.73002 batch_time=0.39388 
Train Epoch: 21 [489/500 31296/32000 (98%)] Loss: 0.62398 (QuantReg: 12.90127) QuantErr: 12.90127 batch_time=0.40816 
Train Epoch: 21 [497/500 31808/32000 (99%)] Loss: 0.48965 (QuantReg: 13.57439) QuantErr: 13.57439 batch_time=0.40770 
Train Epoch: 21 codebook_update_time=2.30619
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch21.pth ...
Done in 19.099s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch21.pth ...
Done in 23.113s
removing stale ckpt [epoch 20] [took 0.00s]
 epoch          : 21
 loss           : 0.6626971121132373
 quant_reg      : 13.38909090232849
 quant_err      : 13.38909090232849
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.9476861167002015
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.692531870556955
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 75.45271629778672
 MSRVTT_full_val/v2t_metrics/R10: 85.51307847082495
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.959758551307847
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.25990678646827
 MSRVTT_full_test/t2v_metrics/R1: 13.244147157190636
 MSRVTT_full_test/t2v_metrics/R5: 36.65551839464883
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 82.14046822742475
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.562207357859535
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.089111665602175
 MSRVTT_full_test/v2t_metrics/R1: 15.986622073578594
 MSRVTT_full_test/v2t_metrics/R5: 43.779264214046826
 MSRVTT_full_test/v2t_metrics/R10: 59.130434782608695
 MSRVTT_full_test/v2t_metrics/R50: 87.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.00819397993311
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.58958989833854
 mnt_best       : 29.089111665602175
 not_improved_count: 0
Train Epoch: 22 [1/500 64/32000 (0%)] Loss: 0.67992 (QuantReg: 13.34214) QuantErr: 13.34214 batch_time=33.40787 
Train Epoch: 22 [9/500 576/32000 (2%)] Loss: 0.61352 (QuantReg: 13.22962) QuantErr: 13.22962 batch_time=0.38288 
Train Epoch: 22 [17/500 1088/32000 (3%)] Loss: 0.58875 (QuantReg: 13.58175) QuantErr: 13.58175 batch_time=1.79139 
Train Epoch: 22 [25/500 1600/32000 (5%)] Loss: 0.91802 (QuantReg: 13.07000) QuantErr: 13.07000 batch_time=0.43353 
Train Epoch: 22 [33/500 2112/32000 (7%)] Loss: 0.54389 (QuantReg: 13.53356) QuantErr: 13.53356 batch_time=0.39383 
Train Epoch: 22 [41/500 2624/32000 (8%)] Loss: 0.42177 (QuantReg: 13.48141) QuantErr: 13.48141 batch_time=0.39681 
Train Epoch: 22 [49/500 3136/32000 (10%)] Loss: 0.58627 (QuantReg: 13.73623) QuantErr: 13.73623 batch_time=0.39691 
Train Epoch: 22 [57/500 3648/32000 (11%)] Loss: 0.58184 (QuantReg: 13.14607) QuantErr: 13.14607 batch_time=0.38601 
Train Epoch: 22 [65/500 4160/32000 (13%)] Loss: 0.59278 (QuantReg: 13.81972) QuantErr: 13.81972 batch_time=0.56647 
Train Epoch: 22 [73/500 4672/32000 (15%)] Loss: 0.46118 (QuantReg: 13.49185) QuantErr: 13.49185 batch_time=0.41799 
Train Epoch: 22 [81/500 5184/32000 (16%)] Loss: 0.84552 (QuantReg: 13.05571) QuantErr: 13.05571 batch_time=1.63464 
Train Epoch: 22 [89/500 5696/32000 (18%)] Loss: 0.68263 (QuantReg: 13.31337) QuantErr: 13.31337 batch_time=0.40849 
Train Epoch: 22 [97/500 6208/32000 (19%)] Loss: 0.73211 (QuantReg: 12.90421) QuantErr: 12.90421 batch_time=0.44004 
Train Epoch: 22 [105/500 6720/32000 (21%)] Loss: 0.64072 (QuantReg: 12.55528) QuantErr: 12.55528 batch_time=0.42021 
Train Epoch: 22 [113/500 7232/32000 (23%)] Loss: 0.49358 (QuantReg: 13.47200) QuantErr: 13.47200 batch_time=0.41281 
Train Epoch: 22 [121/500 7744/32000 (24%)] Loss: 0.65747 (QuantReg: 13.73534) QuantErr: 13.73534 batch_time=0.39978 
Train Epoch: 22 [129/500 8256/32000 (26%)] Loss: 0.70991 (QuantReg: 13.38284) QuantErr: 13.38284 batch_time=0.55984 
Train Epoch: 22 [137/500 8768/32000 (27%)] Loss: 0.62512 (QuantReg: 13.61867) QuantErr: 13.61867 batch_time=0.38831 
Train Epoch: 22 [145/500 9280/32000 (29%)] Loss: 0.48935 (QuantReg: 13.99422) QuantErr: 13.99422 batch_time=1.30845 
Train Epoch: 22 [153/500 9792/32000 (31%)] Loss: 0.72139 (QuantReg: 13.25249) QuantErr: 13.25249 batch_time=0.41642 
Train Epoch: 22 [161/500 10304/32000 (32%)] Loss: 0.53851 (QuantReg: 13.65145) QuantErr: 13.65145 batch_time=0.39669 
Train Epoch: 22 [169/500 10816/32000 (34%)] Loss: 0.39669 (QuantReg: 13.46182) QuantErr: 13.46182 batch_time=0.39773 
Train Epoch: 22 [177/500 11328/32000 (35%)] Loss: 0.75433 (QuantReg: 12.88934) QuantErr: 12.88934 batch_time=0.40325 
Train Epoch: 22 [185/500 11840/32000 (37%)] Loss: 0.47980 (QuantReg: 13.24893) QuantErr: 13.24893 batch_time=0.39671 
Train Epoch: 22 [193/500 12352/32000 (39%)] Loss: 0.87116 (QuantReg: 13.13522) QuantErr: 13.13522 batch_time=0.57372 
Train Epoch: 22 [201/500 12864/32000 (40%)] Loss: 0.63482 (QuantReg: 13.69971) QuantErr: 13.69971 batch_time=0.38902 
Train Epoch: 22 [209/500 13376/32000 (42%)] Loss: 0.82159 (QuantReg: 12.61812) QuantErr: 12.61812 batch_time=1.41319 
Train Epoch: 22 [217/500 13888/32000 (43%)] Loss: 0.61073 (QuantReg: 13.19658) QuantErr: 13.19658 batch_time=0.45013 
Train Epoch: 22 [225/500 14400/32000 (45%)] Loss: 0.91248 (QuantReg: 13.56437) QuantErr: 13.56437 batch_time=0.44514 
Train Epoch: 22 [233/500 14912/32000 (47%)] Loss: 0.38993 (QuantReg: 13.35257) QuantErr: 13.35257 batch_time=0.41544 
Train Epoch: 22 [241/500 15424/32000 (48%)] Loss: 0.65021 (QuantReg: 13.39679) QuantErr: 13.39679 batch_time=0.39826 
Train Epoch: 22 [249/500 15936/32000 (50%)] Loss: 0.96419 (QuantReg: 13.16290) QuantErr: 13.16290 batch_time=0.41474 
Train Epoch: 22 [257/500 16448/32000 (51%)] Loss: 0.65240 (QuantReg: 13.34554) QuantErr: 13.34554 batch_time=0.56609 
Train Epoch: 22 [265/500 16960/32000 (53%)] Loss: 0.66852 (QuantReg: 13.52722) QuantErr: 13.52722 batch_time=0.39382 
Train Epoch: 22 [273/500 17472/32000 (55%)] Loss: 0.39371 (QuantReg: 13.65813) QuantErr: 13.65813 batch_time=1.38796 
Train Epoch: 22 [281/500 17984/32000 (56%)] Loss: 0.67818 (QuantReg: 13.68152) QuantErr: 13.68152 batch_time=0.39707 
Train Epoch: 22 [289/500 18496/32000 (58%)] Loss: 0.53553 (QuantReg: 13.73231) QuantErr: 13.73231 batch_time=0.39853 
Train Epoch: 22 [297/500 19008/32000 (59%)] Loss: 0.43505 (QuantReg: 14.00461) QuantErr: 14.00461 batch_time=0.40253 
Train Epoch: 22 [305/500 19520/32000 (61%)] Loss: 0.64376 (QuantReg: 13.60393) QuantErr: 13.60393 batch_time=0.40133 
Train Epoch: 22 [313/500 20032/32000 (63%)] Loss: 0.70978 (QuantReg: 13.79880) QuantErr: 13.79880 batch_time=0.39238 
Train Epoch: 22 [321/500 20544/32000 (64%)] Loss: 0.77779 (QuantReg: 13.17449) QuantErr: 13.17449 batch_time=0.56023 
Train Epoch: 22 [329/500 21056/32000 (66%)] Loss: 0.55232 (QuantReg: 13.52219) QuantErr: 13.52219 batch_time=0.39694 
Train Epoch: 22 [337/500 21568/32000 (67%)] Loss: 0.59548 (QuantReg: 13.69971) QuantErr: 13.69971 batch_time=1.34680 
Train Epoch: 22 [345/500 22080/32000 (69%)] Loss: 0.73144 (QuantReg: 13.42222) QuantErr: 13.42222 batch_time=0.41242 
Train Epoch: 22 [353/500 22592/32000 (71%)] Loss: 0.58869 (QuantReg: 13.21295) QuantErr: 13.21295 batch_time=0.40774 
Train Epoch: 22 [361/500 23104/32000 (72%)] Loss: 0.63443 (QuantReg: 13.20120) QuantErr: 13.20120 batch_time=0.40600 
Train Epoch: 22 [369/500 23616/32000 (74%)] Loss: 0.40820 (QuantReg: 13.67628) QuantErr: 13.67628 batch_time=0.40196 
Train Epoch: 22 [377/500 24128/32000 (75%)] Loss: 1.20429 (QuantReg: 13.82455) QuantErr: 13.82455 batch_time=0.41355 
Train Epoch: 22 [385/500 24640/32000 (77%)] Loss: 1.01608 (QuantReg: 12.96244) QuantErr: 12.96244 batch_time=0.57849 
Train Epoch: 22 [393/500 25152/32000 (79%)] Loss: 0.68458 (QuantReg: 13.80956) QuantErr: 13.80956 batch_time=0.39923 
Train Epoch: 22 [401/500 25664/32000 (80%)] Loss: 0.42035 (QuantReg: 13.29825) QuantErr: 13.29825 batch_time=1.30444 
Train Epoch: 22 [409/500 26176/32000 (82%)] Loss: 0.58318 (QuantReg: 13.17165) QuantErr: 13.17165 batch_time=0.39336 
Train Epoch: 22 [417/500 26688/32000 (83%)] Loss: 0.68527 (QuantReg: 13.00894) QuantErr: 13.00894 batch_time=0.41549 
Train Epoch: 22 [425/500 27200/32000 (85%)] Loss: 0.67779 (QuantReg: 13.63827) QuantErr: 13.63827 batch_time=0.40249 
Train Epoch: 22 [433/500 27712/32000 (87%)] Loss: 0.55188 (QuantReg: 13.51009) QuantErr: 13.51009 batch_time=0.40800 
Train Epoch: 22 [441/500 28224/32000 (88%)] Loss: 0.62446 (QuantReg: 13.12647) QuantErr: 13.12647 batch_time=0.41186 
Train Epoch: 22 [449/500 28736/32000 (90%)] Loss: 0.64195 (QuantReg: 13.34239) QuantErr: 13.34239 batch_time=0.57509 
Train Epoch: 22 [457/500 29248/32000 (91%)] Loss: 0.77674 (QuantReg: 12.94036) QuantErr: 12.94036 batch_time=0.39531 
Train Epoch: 22 [465/500 29760/32000 (93%)] Loss: 0.86713 (QuantReg: 13.22199) QuantErr: 13.22199 batch_time=1.30491 
Train Epoch: 22 [473/500 30272/32000 (95%)] Loss: 0.74790 (QuantReg: 13.39343) QuantErr: 13.39343 batch_time=0.39756 
Train Epoch: 22 [481/500 30784/32000 (96%)] Loss: 0.41369 (QuantReg: 13.33388) QuantErr: 13.33388 batch_time=0.39441 
Train Epoch: 22 [489/500 31296/32000 (98%)] Loss: 0.48680 (QuantReg: 13.77130) QuantErr: 13.77130 batch_time=0.39277 
Train Epoch: 22 [497/500 31808/32000 (99%)] Loss: 0.42980 (QuantReg: 13.56386) QuantErr: 13.56386 batch_time=0.39740 
Train Epoch: 22 codebook_update_time=1.99607
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch22.pth ...
Done in 4.221s
removing stale ckpt [epoch 21] [took 0.00s]
 epoch          : 22
 loss           : 0.6394575614929199
 quant_reg      : 13.409777954101562
 quant_err      : 13.409777954101562
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.442655935613683
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.73625242653521
 MSRVTT_full_val/v2t_metrics/R1: 38.028169014084504
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.2917505030181085
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.91155600088078
 MSRVTT_full_test/t2v_metrics/R1: 12.74247491638796
 MSRVTT_full_test/t2v_metrics/R5: 36.020066889632105
 MSRVTT_full_test/t2v_metrics/R10: 50.0
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 10.5
 MSRVTT_full_test/t2v_metrics/MeanR: 44.27190635451505
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.417733395607744
 MSRVTT_full_test/v2t_metrics/R1: 15.016722408026755
 MSRVTT_full_test/v2t_metrics/R5: 42.14046822742475
 MSRVTT_full_test/v2t_metrics/R10: 58.42809364548495
 MSRVTT_full_test/v2t_metrics/R50: 87.25752508361204
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.777926421404683
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.31440609421815
 mnt_best       : 29.089111665602175
 not_improved_count: 1
Train Epoch: 23 [1/500 64/32000 (0%)] Loss: 0.81778 (QuantReg: 13.46352) QuantErr: 13.46352 batch_time=32.31904 
Train Epoch: 23 [9/500 576/32000 (2%)] Loss: 0.78724 (QuantReg: 13.35641) QuantErr: 13.35641 batch_time=0.45510 
Train Epoch: 23 [17/500 1088/32000 (3%)] Loss: 0.59102 (QuantReg: 12.67303) QuantErr: 12.67303 batch_time=0.45861 
Train Epoch: 23 [25/500 1600/32000 (5%)] Loss: 0.51686 (QuantReg: 12.81978) QuantErr: 12.81978 batch_time=0.39797 
Train Epoch: 23 [33/500 2112/32000 (7%)] Loss: 0.61015 (QuantReg: 13.11139) QuantErr: 13.11139 batch_time=0.39322 
Train Epoch: 23 [41/500 2624/32000 (8%)] Loss: 0.62809 (QuantReg: 13.33080) QuantErr: 13.33080 batch_time=0.39143 
Train Epoch: 23 [49/500 3136/32000 (10%)] Loss: 0.62019 (QuantReg: 13.33438) QuantErr: 13.33438 batch_time=0.40774 
Train Epoch: 23 [57/500 3648/32000 (11%)] Loss: 0.48512 (QuantReg: 13.45812) QuantErr: 13.45812 batch_time=0.39817 
Train Epoch: 23 [65/500 4160/32000 (13%)] Loss: 0.51220 (QuantReg: 13.58491) QuantErr: 13.58491 batch_time=0.39642 
Train Epoch: 23 [73/500 4672/32000 (15%)] Loss: 0.38141 (QuantReg: 12.88577) QuantErr: 12.88577 batch_time=0.46079 
Train Epoch: 23 [81/500 5184/32000 (16%)] Loss: 0.52481 (QuantReg: 13.62846) QuantErr: 13.62846 batch_time=0.45412 
Train Epoch: 23 [89/500 5696/32000 (18%)] Loss: 0.58471 (QuantReg: 13.34153) QuantErr: 13.34153 batch_time=0.42550 
Train Epoch: 23 [97/500 6208/32000 (19%)] Loss: 0.64921 (QuantReg: 13.22664) QuantErr: 13.22664 batch_time=0.40063 
Train Epoch: 23 [105/500 6720/32000 (21%)] Loss: 0.61432 (QuantReg: 13.02990) QuantErr: 13.02990 batch_time=0.40335 
Train Epoch: 23 [113/500 7232/32000 (23%)] Loss: 0.58215 (QuantReg: 13.48563) QuantErr: 13.48563 batch_time=0.42736 
Train Epoch: 23 [121/500 7744/32000 (24%)] Loss: 0.79834 (QuantReg: 13.62600) QuantErr: 13.62600 batch_time=0.39478 
Train Epoch: 23 [129/500 8256/32000 (26%)] Loss: 0.48101 (QuantReg: 13.34261) QuantErr: 13.34261 batch_time=0.41493 
Train Epoch: 23 [137/500 8768/32000 (27%)] Loss: 0.89331 (QuantReg: 13.37030) QuantErr: 13.37030 batch_time=0.45402 
Train Epoch: 23 [145/500 9280/32000 (29%)] Loss: 0.58109 (QuantReg: 13.49776) QuantErr: 13.49776 batch_time=0.46141 
Train Epoch: 23 [153/500 9792/32000 (31%)] Loss: 0.36585 (QuantReg: 13.57849) QuantErr: 13.57849 batch_time=0.39289 
Train Epoch: 23 [161/500 10304/32000 (32%)] Loss: 0.67516 (QuantReg: 13.62624) QuantErr: 13.62624 batch_time=0.40958 
Train Epoch: 23 [169/500 10816/32000 (34%)] Loss: 0.53367 (QuantReg: 13.70409) QuantErr: 13.70409 batch_time=0.38721 
Train Epoch: 23 [177/500 11328/32000 (35%)] Loss: 0.46764 (QuantReg: 12.99419) QuantErr: 12.99419 batch_time=0.40538 
Train Epoch: 23 [185/500 11840/32000 (37%)] Loss: 0.49660 (QuantReg: 12.78130) QuantErr: 12.78130 batch_time=0.40495 
Train Epoch: 23 [193/500 12352/32000 (39%)] Loss: 0.71269 (QuantReg: 13.70592) QuantErr: 13.70592 batch_time=0.40570 
Train Epoch: 23 [201/500 12864/32000 (40%)] Loss: 0.78615 (QuantReg: 13.58245) QuantErr: 13.58245 batch_time=0.45820 
Train Epoch: 23 [209/500 13376/32000 (42%)] Loss: 0.58704 (QuantReg: 13.46320) QuantErr: 13.46320 batch_time=0.45238 
Train Epoch: 23 [217/500 13888/32000 (43%)] Loss: 1.01107 (QuantReg: 13.57748) QuantErr: 13.57748 batch_time=0.38910 
Train Epoch: 23 [225/500 14400/32000 (45%)] Loss: 0.63163 (QuantReg: 13.02119) QuantErr: 13.02119 batch_time=0.40127 
Train Epoch: 23 [233/500 14912/32000 (47%)] Loss: 0.72008 (QuantReg: 13.59308) QuantErr: 13.59308 batch_time=0.39259 
Train Epoch: 23 [241/500 15424/32000 (48%)] Loss: 0.57858 (QuantReg: 13.15790) QuantErr: 13.15790 batch_time=0.40749 
Train Epoch: 23 [249/500 15936/32000 (50%)] Loss: 0.78596 (QuantReg: 12.87434) QuantErr: 12.87434 batch_time=0.41405 
Train Epoch: 23 [257/500 16448/32000 (51%)] Loss: 0.57704 (QuantReg: 13.55341) QuantErr: 13.55341 batch_time=0.39874 
Train Epoch: 23 [265/500 16960/32000 (53%)] Loss: 0.84696 (QuantReg: 13.64628) QuantErr: 13.64628 batch_time=0.39163 
Train Epoch: 23 [273/500 17472/32000 (55%)] Loss: 0.53050 (QuantReg: 13.85358) QuantErr: 13.85358 batch_time=0.39273 
Train Epoch: 23 [281/500 17984/32000 (56%)] Loss: 0.80042 (QuantReg: 13.47486) QuantErr: 13.47486 batch_time=0.43776 
Train Epoch: 23 [289/500 18496/32000 (58%)] Loss: 0.47349 (QuantReg: 13.79590) QuantErr: 13.79590 batch_time=0.39380 
Train Epoch: 23 [297/500 19008/32000 (59%)] Loss: 0.82825 (QuantReg: 13.18763) QuantErr: 13.18763 batch_time=0.38710 
Train Epoch: 23 [305/500 19520/32000 (61%)] Loss: 0.77642 (QuantReg: 13.33996) QuantErr: 13.33996 batch_time=0.40409 
Train Epoch: 23 [313/500 20032/32000 (63%)] Loss: 0.38412 (QuantReg: 13.33271) QuantErr: 13.33271 batch_time=0.39100 
Train Epoch: 23 [321/500 20544/32000 (64%)] Loss: 0.52696 (QuantReg: 13.81198) QuantErr: 13.81198 batch_time=0.38898 
Train Epoch: 23 [329/500 21056/32000 (66%)] Loss: 0.45111 (QuantReg: 13.71443) QuantErr: 13.71443 batch_time=0.41707 
Train Epoch: 23 [337/500 21568/32000 (67%)] Loss: 0.51694 (QuantReg: 13.54116) QuantErr: 13.54116 batch_time=0.42892 
Train Epoch: 23 [345/500 22080/32000 (69%)] Loss: 0.61504 (QuantReg: 13.58284) QuantErr: 13.58284 batch_time=0.41840 
Train Epoch: 23 [353/500 22592/32000 (71%)] Loss: 0.38226 (QuantReg: 13.68663) QuantErr: 13.68663 batch_time=0.41502 
Train Epoch: 23 [361/500 23104/32000 (72%)] Loss: 0.85976 (QuantReg: 13.34707) QuantErr: 13.34707 batch_time=0.44026 
Train Epoch: 23 [369/500 23616/32000 (74%)] Loss: 0.66594 (QuantReg: 13.25298) QuantErr: 13.25298 batch_time=0.39955 
Train Epoch: 23 [377/500 24128/32000 (75%)] Loss: 0.80810 (QuantReg: 13.38190) QuantErr: 13.38190 batch_time=0.39699 
Train Epoch: 23 [385/500 24640/32000 (77%)] Loss: 0.49309 (QuantReg: 14.11631) QuantErr: 14.11631 batch_time=0.39264 
Train Epoch: 23 [393/500 25152/32000 (79%)] Loss: 0.51144 (QuantReg: 13.39831) QuantErr: 13.39831 batch_time=0.43310 
Train Epoch: 23 [401/500 25664/32000 (80%)] Loss: 1.13533 (QuantReg: 13.23553) QuantErr: 13.23553 batch_time=0.39871 
Train Epoch: 23 [409/500 26176/32000 (82%)] Loss: 0.56590 (QuantReg: 13.60055) QuantErr: 13.60055 batch_time=0.39221 
Train Epoch: 23 [417/500 26688/32000 (83%)] Loss: 0.76141 (QuantReg: 13.12472) QuantErr: 13.12472 batch_time=0.38634 
Train Epoch: 23 [425/500 27200/32000 (85%)] Loss: 0.68097 (QuantReg: 13.02314) QuantErr: 13.02314 batch_time=2.12182 
Train Epoch: 23 [433/500 27712/32000 (87%)] Loss: 0.45822 (QuantReg: 13.89117) QuantErr: 13.89117 batch_time=0.40934 
Train Epoch: 23 [441/500 28224/32000 (88%)] Loss: 0.58910 (QuantReg: 13.84561) QuantErr: 13.84561 batch_time=0.39179 
Train Epoch: 23 [449/500 28736/32000 (90%)] Loss: 0.77086 (QuantReg: 13.42927) QuantErr: 13.42927 batch_time=0.43419 
Train Epoch: 23 [457/500 29248/32000 (91%)] Loss: 0.49578 (QuantReg: 13.33949) QuantErr: 13.33949 batch_time=0.44326 
Train Epoch: 23 [465/500 29760/32000 (93%)] Loss: 1.05019 (QuantReg: 13.52610) QuantErr: 13.52610 batch_time=0.40029 
Train Epoch: 23 [473/500 30272/32000 (95%)] Loss: 0.58838 (QuantReg: 13.29494) QuantErr: 13.29494 batch_time=0.42962 
Train Epoch: 23 [481/500 30784/32000 (96%)] Loss: 0.62984 (QuantReg: 13.70484) QuantErr: 13.70484 batch_time=0.39282 
Train Epoch: 23 [489/500 31296/32000 (98%)] Loss: 0.90998 (QuantReg: 13.35021) QuantErr: 13.35021 batch_time=1.98680 
Train Epoch: 23 [497/500 31808/32000 (99%)] Loss: 0.88678 (QuantReg: 13.32163) QuantErr: 13.32163 batch_time=0.41477 
Train Epoch: 23 codebook_update_time=1.91352
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch23.pth ...
Done in 19.018s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 0.6444025752544403
 quant_reg      : 13.41685160446167
 quant_err      : 13.41685160446167
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 31.388329979879277
 MSRVTT_full_val/t2v_metrics/R5: 71.62977867203219
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.064386317907445
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.749529481128306
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.06841046277666
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.10725184988696
 MSRVTT_full_test/t2v_metrics/R1: 12.94314381270903
 MSRVTT_full_test/t2v_metrics/R5: 36.2876254180602
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 81.50501672240803
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.761872909698994
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.858440372358587
 MSRVTT_full_test/v2t_metrics/R1: 15.953177257525084
 MSRVTT_full_test/v2t_metrics/R5: 43.44481605351171
 MSRVTT_full_test/v2t_metrics/R10: 58.39464882943144
 MSRVTT_full_test/v2t_metrics/R50: 87.45819397993311
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.90735785953177
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.33360461447737
 mnt_best       : 29.089111665602175
 not_improved_count: 2
Train Epoch: 24 [1/500 64/32000 (0%)] Loss: 0.64384 (QuantReg: 13.09954) QuantErr: 13.09954 batch_time=32.46896 
Train Epoch: 24 [9/500 576/32000 (2%)] Loss: 0.76496 (QuantReg: 13.24704) QuantErr: 13.24704 batch_time=0.39802 
Train Epoch: 24 [17/500 1088/32000 (3%)] Loss: 0.79901 (QuantReg: 13.40549) QuantErr: 13.40549 batch_time=2.44245 
Train Epoch: 24 [25/500 1600/32000 (5%)] Loss: 0.45023 (QuantReg: 13.49002) QuantErr: 13.49002 batch_time=0.40101 
Train Epoch: 24 [33/500 2112/32000 (7%)] Loss: 0.52594 (QuantReg: 13.22178) QuantErr: 13.22178 batch_time=0.39440 
Train Epoch: 24 [41/500 2624/32000 (8%)] Loss: 0.34536 (QuantReg: 13.36794) QuantErr: 13.36794 batch_time=0.39472 
Train Epoch: 24 [49/500 3136/32000 (10%)] Loss: 0.60245 (QuantReg: 13.30454) QuantErr: 13.30454 batch_time=0.40349 
Train Epoch: 24 [57/500 3648/32000 (11%)] Loss: 0.71347 (QuantReg: 13.52972) QuantErr: 13.52972 batch_time=0.44266 
Train Epoch: 24 [65/500 4160/32000 (13%)] Loss: 0.74110 (QuantReg: 13.47692) QuantErr: 13.47692 batch_time=0.50679 
Train Epoch: 24 [73/500 4672/32000 (15%)] Loss: 0.87574 (QuantReg: 13.11454) QuantErr: 13.11454 batch_time=0.40340 
Train Epoch: 24 [81/500 5184/32000 (16%)] Loss: 0.27349 (QuantReg: 13.67860) QuantErr: 13.67860 batch_time=1.95688 
Train Epoch: 24 [89/500 5696/32000 (18%)] Loss: 0.89362 (QuantReg: 13.52516) QuantErr: 13.52516 batch_time=0.40872 
Train Epoch: 24 [97/500 6208/32000 (19%)] Loss: 0.39859 (QuantReg: 13.62079) QuantErr: 13.62079 batch_time=0.39340 
Train Epoch: 24 [105/500 6720/32000 (21%)] Loss: 0.48989 (QuantReg: 13.15018) QuantErr: 13.15018 batch_time=0.44559 
Train Epoch: 24 [113/500 7232/32000 (23%)] Loss: 0.41002 (QuantReg: 13.49066) QuantErr: 13.49066 batch_time=0.39437 
Train Epoch: 24 [121/500 7744/32000 (24%)] Loss: 0.49159 (QuantReg: 13.71986) QuantErr: 13.71986 batch_time=0.41182 
Train Epoch: 24 [129/500 8256/32000 (26%)] Loss: 0.42275 (QuantReg: 13.35502) QuantErr: 13.35502 batch_time=0.51629 
Train Epoch: 24 [137/500 8768/32000 (27%)] Loss: 0.50810 (QuantReg: 13.52938) QuantErr: 13.52938 batch_time=0.40039 
Train Epoch: 24 [145/500 9280/32000 (29%)] Loss: 0.55890 (QuantReg: 13.84140) QuantErr: 13.84140 batch_time=1.90336 
Train Epoch: 24 [153/500 9792/32000 (31%)] Loss: 0.42997 (QuantReg: 13.61098) QuantErr: 13.61098 batch_time=0.45598 
Train Epoch: 24 [161/500 10304/32000 (32%)] Loss: 0.84501 (QuantReg: 13.69991) QuantErr: 13.69991 batch_time=0.39327 
Train Epoch: 24 [169/500 10816/32000 (34%)] Loss: 0.49112 (QuantReg: 13.74280) QuantErr: 13.74280 batch_time=0.39534 
Train Epoch: 24 [177/500 11328/32000 (35%)] Loss: 0.74811 (QuantReg: 13.42659) QuantErr: 13.42659 batch_time=0.39515 
Train Epoch: 24 [185/500 11840/32000 (37%)] Loss: 0.41542 (QuantReg: 13.63489) QuantErr: 13.63489 batch_time=0.40523 
Train Epoch: 24 [193/500 12352/32000 (39%)] Loss: 0.41816 (QuantReg: 13.96620) QuantErr: 13.96620 batch_time=0.54886 
Train Epoch: 24 [201/500 12864/32000 (40%)] Loss: 0.50085 (QuantReg: 14.01726) QuantErr: 14.01726 batch_time=0.39546 
Train Epoch: 24 [209/500 13376/32000 (42%)] Loss: 0.31828 (QuantReg: 13.65479) QuantErr: 13.65479 batch_time=2.00540 
Train Epoch: 24 [217/500 13888/32000 (43%)] Loss: 0.45468 (QuantReg: 13.73293) QuantErr: 13.73293 batch_time=0.40479 
Train Epoch: 24 [225/500 14400/32000 (45%)] Loss: 0.42144 (QuantReg: 13.50035) QuantErr: 13.50035 batch_time=0.40355 
Train Epoch: 24 [233/500 14912/32000 (47%)] Loss: 0.43134 (QuantReg: 13.39085) QuantErr: 13.39085 batch_time=0.39768 
Train Epoch: 24 [241/500 15424/32000 (48%)] Loss: 0.48106 (QuantReg: 13.87463) QuantErr: 13.87463 batch_time=0.39340 
Train Epoch: 24 [249/500 15936/32000 (50%)] Loss: 0.34491 (QuantReg: 13.64545) QuantErr: 13.64545 batch_time=0.41636 
Train Epoch: 24 [257/500 16448/32000 (51%)] Loss: 0.65319 (QuantReg: 13.44700) QuantErr: 13.44700 batch_time=0.39007 
Train Epoch: 24 [265/500 16960/32000 (53%)] Loss: 0.42829 (QuantReg: 13.13248) QuantErr: 13.13248 batch_time=0.39190 
Train Epoch: 24 [273/500 17472/32000 (55%)] Loss: 0.44675 (QuantReg: 13.55956) QuantErr: 13.55956 batch_time=2.02480 
Train Epoch: 24 [281/500 17984/32000 (56%)] Loss: 0.57267 (QuantReg: 13.27655) QuantErr: 13.27655 batch_time=0.46291 
Train Epoch: 24 [289/500 18496/32000 (58%)] Loss: 0.74494 (QuantReg: 13.15619) QuantErr: 13.15619 batch_time=0.40720 
Train Epoch: 24 [297/500 19008/32000 (59%)] Loss: 0.46359 (QuantReg: 13.91108) QuantErr: 13.91108 batch_time=0.44226 
Train Epoch: 24 [305/500 19520/32000 (61%)] Loss: 0.61830 (QuantReg: 13.43165) QuantErr: 13.43165 batch_time=0.41027 
Train Epoch: 24 [313/500 20032/32000 (63%)] Loss: 0.59007 (QuantReg: 13.47672) QuantErr: 13.47672 batch_time=0.39657 
Train Epoch: 24 [321/500 20544/32000 (64%)] Loss: 0.64573 (QuantReg: 13.63789) QuantErr: 13.63789 batch_time=0.40718 
Train Epoch: 24 [329/500 21056/32000 (66%)] Loss: 0.69929 (QuantReg: 13.48727) QuantErr: 13.48727 batch_time=0.43622 
Train Epoch: 24 [337/500 21568/32000 (67%)] Loss: 0.49104 (QuantReg: 13.73727) QuantErr: 13.73727 batch_time=2.06956 
Train Epoch: 24 [345/500 22080/32000 (69%)] Loss: 0.49903 (QuantReg: 13.15748) QuantErr: 13.15748 batch_time=0.40146 
Train Epoch: 24 [353/500 22592/32000 (71%)] Loss: 0.58154 (QuantReg: 13.47937) QuantErr: 13.47937 batch_time=0.40138 
Train Epoch: 24 [361/500 23104/32000 (72%)] Loss: 0.73440 (QuantReg: 13.78051) QuantErr: 13.78051 batch_time=0.40733 
Train Epoch: 24 [369/500 23616/32000 (74%)] Loss: 0.51184 (QuantReg: 13.57756) QuantErr: 13.57756 batch_time=0.40234 
Train Epoch: 24 [377/500 24128/32000 (75%)] Loss: 0.60170 (QuantReg: 13.72639) QuantErr: 13.72639 batch_time=0.41339 
Train Epoch: 24 [385/500 24640/32000 (77%)] Loss: 0.50655 (QuantReg: 13.38324) QuantErr: 13.38324 batch_time=0.44515 
Train Epoch: 24 [393/500 25152/32000 (79%)] Loss: 0.46219 (QuantReg: 13.23213) QuantErr: 13.23213 batch_time=0.39348 
Train Epoch: 24 [401/500 25664/32000 (80%)] Loss: 0.47333 (QuantReg: 13.48100) QuantErr: 13.48100 batch_time=2.01786 
Train Epoch: 24 [409/500 26176/32000 (82%)] Loss: 0.65402 (QuantReg: 13.51706) QuantErr: 13.51706 batch_time=0.41492 
Train Epoch: 24 [417/500 26688/32000 (83%)] Loss: 0.52604 (QuantReg: 13.83964) QuantErr: 13.83964 batch_time=0.44317 
Train Epoch: 24 [425/500 27200/32000 (85%)] Loss: 0.33086 (QuantReg: 13.61832) QuantErr: 13.61832 batch_time=0.41219 
Train Epoch: 24 [433/500 27712/32000 (87%)] Loss: 0.67696 (QuantReg: 13.49601) QuantErr: 13.49601 batch_time=0.41002 
Train Epoch: 24 [441/500 28224/32000 (88%)] Loss: 0.83066 (QuantReg: 13.42114) QuantErr: 13.42114 batch_time=0.45694 
Train Epoch: 24 [449/500 28736/32000 (90%)] Loss: 0.45339 (QuantReg: 13.95773) QuantErr: 13.95773 batch_time=0.40333 
Train Epoch: 24 [457/500 29248/32000 (91%)] Loss: 0.80084 (QuantReg: 12.89832) QuantErr: 12.89832 batch_time=0.40056 
Train Epoch: 24 [465/500 29760/32000 (93%)] Loss: 0.67908 (QuantReg: 13.21111) QuantErr: 13.21111 batch_time=2.12031 
Train Epoch: 24 [473/500 30272/32000 (95%)] Loss: 0.42739 (QuantReg: 13.75573) QuantErr: 13.75573 batch_time=0.44232 
Train Epoch: 24 [481/500 30784/32000 (96%)] Loss: 0.59856 (QuantReg: 12.99743) QuantErr: 12.99743 batch_time=0.40726 
Train Epoch: 24 [489/500 31296/32000 (98%)] Loss: 0.71358 (QuantReg: 13.16360) QuantErr: 13.16360 batch_time=0.40087 
Train Epoch: 24 [497/500 31808/32000 (99%)] Loss: 0.59447 (QuantReg: 13.51109) QuantErr: 13.51109 batch_time=0.39003 
Train Epoch: 24 codebook_update_time=1.96169
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch24.pth ...
Done in 4.403s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch24.pth ...
Done in 8.828s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 0.6094836340546608
 quant_reg      : 13.461417890548706
 quant_err      : 13.461417890548706
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 30.985915492957748
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.907444668008048
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.26396322678999
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.798792756539235
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.59221081705856
 MSRVTT_full_test/t2v_metrics/R1: 13.110367892976589
 MSRVTT_full_test/t2v_metrics/R5: 36.75585284280937
 MSRVTT_full_test/t2v_metrics/R10: 51.37123745819398
 MSRVTT_full_test/t2v_metrics/R50: 82.07357859531773
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.96053511705686
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.144311721937104
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 43.67892976588629
 MSRVTT_full_test/v2t_metrics/R10: 57.92642140468227
 MSRVTT_full_test/v2t_metrics/R50: 87.05685618729098
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.80083612040134
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.279000533310096
 mnt_best       : 29.144311721937104
 not_improved_count: 0
Train Epoch: 25 [1/500 64/32000 (0%)] Loss: 1.09710 (QuantReg: 13.25853) QuantErr: 13.25853 batch_time=35.22148 
Train Epoch: 25 [9/500 576/32000 (2%)] Loss: 0.34756 (QuantReg: 13.22063) QuantErr: 13.22063 batch_time=0.39782 
Train Epoch: 25 [17/500 1088/32000 (3%)] Loss: 0.67857 (QuantReg: 13.26584) QuantErr: 13.26584 batch_time=2.20973 
Train Epoch: 25 [25/500 1600/32000 (5%)] Loss: 0.81286 (QuantReg: 13.43503) QuantErr: 13.43503 batch_time=0.40468 
Train Epoch: 25 [33/500 2112/32000 (7%)] Loss: 0.92965 (QuantReg: 13.17098) QuantErr: 13.17098 batch_time=0.42951 
Train Epoch: 25 [41/500 2624/32000 (8%)] Loss: 0.54599 (QuantReg: 13.39449) QuantErr: 13.39449 batch_time=0.39892 
Train Epoch: 25 [49/500 3136/32000 (10%)] Loss: 0.59659 (QuantReg: 13.08098) QuantErr: 13.08098 batch_time=0.38760 
Train Epoch: 25 [57/500 3648/32000 (11%)] Loss: 0.45565 (QuantReg: 13.48284) QuantErr: 13.48284 batch_time=0.51250 
Train Epoch: 25 [65/500 4160/32000 (13%)] Loss: 0.78278 (QuantReg: 13.67780) QuantErr: 13.67780 batch_time=2.15996 
Train Epoch: 25 [73/500 4672/32000 (15%)] Loss: 0.60655 (QuantReg: 12.92951) QuantErr: 12.92951 batch_time=0.40216 
Train Epoch: 25 [81/500 5184/32000 (16%)] Loss: 0.54766 (QuantReg: 13.75046) QuantErr: 13.75046 batch_time=1.82931 
Train Epoch: 25 [89/500 5696/32000 (18%)] Loss: 0.85633 (QuantReg: 12.84521) QuantErr: 12.84521 batch_time=0.39625 
Train Epoch: 25 [97/500 6208/32000 (19%)] Loss: 0.40793 (QuantReg: 13.79620) QuantErr: 13.79620 batch_time=0.39601 
Train Epoch: 25 [105/500 6720/32000 (21%)] Loss: 0.56283 (QuantReg: 13.72799) QuantErr: 13.72799 batch_time=0.39105 
Train Epoch: 25 [113/500 7232/32000 (23%)] Loss: 0.46859 (QuantReg: 13.23697) QuantErr: 13.23697 batch_time=0.40251 
Train Epoch: 25 [121/500 7744/32000 (24%)] Loss: 0.75739 (QuantReg: 13.76371) QuantErr: 13.76371 batch_time=0.51590 
Train Epoch: 25 [129/500 8256/32000 (26%)] Loss: 0.35114 (QuantReg: 13.76366) QuantErr: 13.76366 batch_time=2.11009 
Train Epoch: 25 [137/500 8768/32000 (27%)] Loss: 0.67668 (QuantReg: 13.28867) QuantErr: 13.28867 batch_time=0.39314 
Train Epoch: 25 [145/500 9280/32000 (29%)] Loss: 0.44325 (QuantReg: 13.18938) QuantErr: 13.18938 batch_time=0.38861 
Train Epoch: 25 [153/500 9792/32000 (31%)] Loss: 0.60768 (QuantReg: 13.45913) QuantErr: 13.45913 batch_time=0.40855 
Train Epoch: 25 [161/500 10304/32000 (32%)] Loss: 0.46758 (QuantReg: 13.78131) QuantErr: 13.78131 batch_time=0.41776 
Train Epoch: 25 [169/500 10816/32000 (34%)] Loss: 0.61934 (QuantReg: 13.29168) QuantErr: 13.29168 batch_time=0.39571 
Train Epoch: 25 [177/500 11328/32000 (35%)] Loss: 0.56753 (QuantReg: 13.50856) QuantErr: 13.50856 batch_time=0.39094 
Train Epoch: 25 [185/500 11840/32000 (37%)] Loss: 0.58317 (QuantReg: 13.29720) QuantErr: 13.29720 batch_time=0.44079 
Train Epoch: 25 [193/500 12352/32000 (39%)] Loss: 0.59661 (QuantReg: 13.59599) QuantErr: 13.59599 batch_time=1.62258 
Train Epoch: 25 [201/500 12864/32000 (40%)] Loss: 0.45626 (QuantReg: 13.90741) QuantErr: 13.90741 batch_time=0.39532 
Train Epoch: 25 [209/500 13376/32000 (42%)] Loss: 0.66435 (QuantReg: 13.68805) QuantErr: 13.68805 batch_time=0.39536 
Train Epoch: 25 [217/500 13888/32000 (43%)] Loss: 0.69580 (QuantReg: 13.44979) QuantErr: 13.44979 batch_time=0.40427 
Train Epoch: 25 [225/500 14400/32000 (45%)] Loss: 0.76198 (QuantReg: 13.33687) QuantErr: 13.33687 batch_time=0.39284 
Train Epoch: 25 [233/500 14912/32000 (47%)] Loss: 0.74299 (QuantReg: 13.41805) QuantErr: 13.41805 batch_time=0.40040 
Train Epoch: 25 [241/500 15424/32000 (48%)] Loss: 0.81791 (QuantReg: 13.07575) QuantErr: 13.07575 batch_time=0.39679 
Train Epoch: 25 [249/500 15936/32000 (50%)] Loss: 0.71844 (QuantReg: 13.54731) QuantErr: 13.54731 batch_time=0.39042 
Train Epoch: 25 [257/500 16448/32000 (51%)] Loss: 0.44498 (QuantReg: 13.78054) QuantErr: 13.78054 batch_time=2.22216 
Train Epoch: 25 [265/500 16960/32000 (53%)] Loss: 0.43142 (QuantReg: 13.55977) QuantErr: 13.55977 batch_time=0.38656 
Train Epoch: 25 [273/500 17472/32000 (55%)] Loss: 0.74020 (QuantReg: 13.20131) QuantErr: 13.20131 batch_time=0.42955 
Train Epoch: 25 [281/500 17984/32000 (56%)] Loss: 0.43621 (QuantReg: 13.77361) QuantErr: 13.77361 batch_time=0.40799 
Train Epoch: 25 [289/500 18496/32000 (58%)] Loss: 0.60473 (QuantReg: 13.38160) QuantErr: 13.38160 batch_time=0.39537 
Train Epoch: 25 [297/500 19008/32000 (59%)] Loss: 0.47354 (QuantReg: 13.55807) QuantErr: 13.55807 batch_time=0.40686 
Train Epoch: 25 [305/500 19520/32000 (61%)] Loss: 0.45311 (QuantReg: 13.41283) QuantErr: 13.41283 batch_time=0.40828 
Train Epoch: 25 [313/500 20032/32000 (63%)] Loss: 0.74183 (QuantReg: 13.42770) QuantErr: 13.42770 batch_time=0.39727 
Train Epoch: 25 [321/500 20544/32000 (64%)] Loss: 0.74288 (QuantReg: 13.58989) QuantErr: 13.58989 batch_time=2.19473 
Train Epoch: 25 [329/500 21056/32000 (66%)] Loss: 0.54871 (QuantReg: 13.41195) QuantErr: 13.41195 batch_time=0.39056 
Train Epoch: 25 [337/500 21568/32000 (67%)] Loss: 0.46537 (QuantReg: 14.26396) QuantErr: 14.26396 batch_time=0.39880 
Train Epoch: 25 [345/500 22080/32000 (69%)] Loss: 0.64211 (QuantReg: 13.19830) QuantErr: 13.19830 batch_time=0.39713 
Train Epoch: 25 [353/500 22592/32000 (71%)] Loss: 0.77540 (QuantReg: 13.55135) QuantErr: 13.55135 batch_time=0.39642 
Train Epoch: 25 [361/500 23104/32000 (72%)] Loss: 0.72762 (QuantReg: 13.33323) QuantErr: 13.33323 batch_time=0.40479 
Train Epoch: 25 [369/500 23616/32000 (74%)] Loss: 1.02954 (QuantReg: 13.46014) QuantErr: 13.46014 batch_time=0.40843 
Train Epoch: 25 [377/500 24128/32000 (75%)] Loss: 0.59065 (QuantReg: 13.14000) QuantErr: 13.14000 batch_time=0.39647 
Train Epoch: 25 [385/500 24640/32000 (77%)] Loss: 0.94578 (QuantReg: 13.46183) QuantErr: 13.46183 batch_time=0.92418 
Train Epoch: 25 [393/500 25152/32000 (79%)] Loss: 0.57031 (QuantReg: 13.60266) QuantErr: 13.60266 batch_time=0.39251 
Train Epoch: 25 [401/500 25664/32000 (80%)] Loss: 0.55973 (QuantReg: 13.47121) QuantErr: 13.47121 batch_time=0.39357 
Train Epoch: 25 [409/500 26176/32000 (82%)] Loss: 0.39578 (QuantReg: 13.67693) QuantErr: 13.67693 batch_time=0.40473 
Train Epoch: 25 [417/500 26688/32000 (83%)] Loss: 0.64981 (QuantReg: 13.53279) QuantErr: 13.53279 batch_time=0.39626 
Train Epoch: 25 [425/500 27200/32000 (85%)] Loss: 0.31004 (QuantReg: 13.45758) QuantErr: 13.45758 batch_time=0.39599 
Train Epoch: 25 [433/500 27712/32000 (87%)] Loss: 0.68007 (QuantReg: 13.04906) QuantErr: 13.04906 batch_time=0.39601 
Train Epoch: 25 [441/500 28224/32000 (88%)] Loss: 0.51204 (QuantReg: 13.57783) QuantErr: 13.57783 batch_time=0.40340 
Train Epoch: 25 [449/500 28736/32000 (90%)] Loss: 0.47312 (QuantReg: 13.48511) QuantErr: 13.48511 batch_time=1.92805 
Train Epoch: 25 [457/500 29248/32000 (91%)] Loss: 0.81689 (QuantReg: 13.64614) QuantErr: 13.64614 batch_time=0.39478 
Train Epoch: 25 [465/500 29760/32000 (93%)] Loss: 0.46647 (QuantReg: 13.34040) QuantErr: 13.34040 batch_time=0.45647 
Train Epoch: 25 [473/500 30272/32000 (95%)] Loss: 0.79590 (QuantReg: 13.44200) QuantErr: 13.44200 batch_time=0.39013 
Train Epoch: 25 [481/500 30784/32000 (96%)] Loss: 0.43486 (QuantReg: 13.41899) QuantErr: 13.41899 batch_time=0.41207 
Train Epoch: 25 [489/500 31296/32000 (98%)] Loss: 0.66929 (QuantReg: 14.02099) QuantErr: 14.02099 batch_time=0.39419 
Train Epoch: 25 [497/500 31808/32000 (99%)] Loss: 0.74334 (QuantReg: 13.13546) QuantErr: 13.13546 batch_time=0.41726 
Train Epoch: 25 codebook_update_time=2.35611
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch25.pth ...
Done in 4.272s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 0.592264132142067
 quant_reg      : 13.50721438407898
 quant_err      : 13.50721438407898
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 31.187122736418512
 MSRVTT_full_val/t2v_metrics/R5: 68.2092555331992
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.51106639839034
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.71188655521651
 MSRVTT_full_val/v2t_metrics/R1: 36.01609657947686
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.116700201207244
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.170932964007065
 MSRVTT_full_test/t2v_metrics/R1: 12.073578595317725
 MSRVTT_full_test/t2v_metrics/R5: 34.94983277591973
 MSRVTT_full_test/t2v_metrics/R10: 49.96655518394649
 MSRVTT_full_test/t2v_metrics/R50: 81.60535117056857
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.96488294314381
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.626137876197085
 MSRVTT_full_test/v2t_metrics/R1: 15.719063545150501
 MSRVTT_full_test/v2t_metrics/R5: 43.67892976588629
 MSRVTT_full_test/v2t_metrics/R10: 59.39799331103679
 MSRVTT_full_test/v2t_metrics/R50: 87.09030100334448
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.013377926421406
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.420999508810844
 mnt_best       : 29.144311721937104
 not_improved_count: 1
Train Epoch: 26 [1/500 64/32000 (0%)] Loss: 0.67008 (QuantReg: 13.44585) QuantErr: 13.44585 batch_time=30.50761 
Train Epoch: 26 [9/500 576/32000 (2%)] Loss: 0.56181 (QuantReg: 13.39425) QuantErr: 13.39425 batch_time=0.50553 
Train Epoch: 26 [17/500 1088/32000 (3%)] Loss: 0.61342 (QuantReg: 13.33986) QuantErr: 13.33986 batch_time=0.41758 
Train Epoch: 26 [25/500 1600/32000 (5%)] Loss: 0.70369 (QuantReg: 13.32507) QuantErr: 13.32507 batch_time=0.40516 
Train Epoch: 26 [33/500 2112/32000 (7%)] Loss: 0.49400 (QuantReg: 13.06892) QuantErr: 13.06892 batch_time=0.39853 
Train Epoch: 26 [41/500 2624/32000 (8%)] Loss: 0.66310 (QuantReg: 13.59289) QuantErr: 13.59289 batch_time=0.79917 
Train Epoch: 26 [49/500 3136/32000 (10%)] Loss: 0.59729 (QuantReg: 13.71097) QuantErr: 13.71097 batch_time=0.41009 
Train Epoch: 26 [57/500 3648/32000 (11%)] Loss: 0.38959 (QuantReg: 13.52710) QuantErr: 13.52710 batch_time=0.39852 
Train Epoch: 26 [65/500 4160/32000 (13%)] Loss: 0.41983 (QuantReg: 13.29728) QuantErr: 13.29728 batch_time=0.46590 
Train Epoch: 26 [73/500 4672/32000 (15%)] Loss: 0.61515 (QuantReg: 13.36445) QuantErr: 13.36445 batch_time=0.46181 
Train Epoch: 26 [81/500 5184/32000 (16%)] Loss: 0.79441 (QuantReg: 12.86465) QuantErr: 12.86465 batch_time=0.39274 
Train Epoch: 26 [89/500 5696/32000 (18%)] Loss: 0.40626 (QuantReg: 13.39155) QuantErr: 13.39155 batch_time=0.42021 
Train Epoch: 26 [97/500 6208/32000 (19%)] Loss: 0.52525 (QuantReg: 13.35893) QuantErr: 13.35893 batch_time=0.44300 
Train Epoch: 26 [105/500 6720/32000 (21%)] Loss: 0.42378 (QuantReg: 13.60837) QuantErr: 13.60837 batch_time=0.83615 
Train Epoch: 26 [113/500 7232/32000 (23%)] Loss: 0.66095 (QuantReg: 13.33315) QuantErr: 13.33315 batch_time=0.41659 
Train Epoch: 26 [121/500 7744/32000 (24%)] Loss: 0.57799 (QuantReg: 13.32517) QuantErr: 13.32517 batch_time=0.40073 
Train Epoch: 26 [129/500 8256/32000 (26%)] Loss: 0.62052 (QuantReg: 13.59813) QuantErr: 13.59813 batch_time=0.44895 
Train Epoch: 26 [137/500 8768/32000 (27%)] Loss: 0.60282 (QuantReg: 13.72866) QuantErr: 13.72866 batch_time=0.45952 
Train Epoch: 26 [145/500 9280/32000 (29%)] Loss: 0.57032 (QuantReg: 12.67920) QuantErr: 12.67920 batch_time=0.39467 
Train Epoch: 26 [153/500 9792/32000 (31%)] Loss: 0.61229 (QuantReg: 13.58185) QuantErr: 13.58185 batch_time=0.40857 
Train Epoch: 26 [161/500 10304/32000 (32%)] Loss: 0.44418 (QuantReg: 13.48885) QuantErr: 13.48885 batch_time=0.39428 
Train Epoch: 26 [169/500 10816/32000 (34%)] Loss: 0.66810 (QuantReg: 13.27755) QuantErr: 13.27755 batch_time=0.80342 
Train Epoch: 26 [177/500 11328/32000 (35%)] Loss: 0.47561 (QuantReg: 13.44961) QuantErr: 13.44961 batch_time=0.39320 
Train Epoch: 26 [185/500 11840/32000 (37%)] Loss: 0.85608 (QuantReg: 13.66485) QuantErr: 13.66485 batch_time=0.39282 
Train Epoch: 26 [193/500 12352/32000 (39%)] Loss: 0.66375 (QuantReg: 13.82014) QuantErr: 13.82014 batch_time=0.45175 
Train Epoch: 26 [201/500 12864/32000 (40%)] Loss: 0.70624 (QuantReg: 13.51390) QuantErr: 13.51390 batch_time=0.46173 
Train Epoch: 26 [209/500 13376/32000 (42%)] Loss: 0.44405 (QuantReg: 14.02360) QuantErr: 14.02360 batch_time=0.40115 
Train Epoch: 26 [217/500 13888/32000 (43%)] Loss: 0.70704 (QuantReg: 13.51351) QuantErr: 13.51351 batch_time=0.39905 
Train Epoch: 26 [225/500 14400/32000 (45%)] Loss: 1.13024 (QuantReg: 13.85133) QuantErr: 13.85133 batch_time=0.45089 
Train Epoch: 26 [233/500 14912/32000 (47%)] Loss: 0.62298 (QuantReg: 13.71369) QuantErr: 13.71369 batch_time=0.82474 
Train Epoch: 26 [241/500 15424/32000 (48%)] Loss: 0.85812 (QuantReg: 13.78533) QuantErr: 13.78533 batch_time=0.39425 
Train Epoch: 26 [249/500 15936/32000 (50%)] Loss: 0.64944 (QuantReg: 13.18332) QuantErr: 13.18332 batch_time=0.39693 
Train Epoch: 26 [257/500 16448/32000 (51%)] Loss: 0.31820 (QuantReg: 14.01660) QuantErr: 14.01660 batch_time=0.46076 
Train Epoch: 26 [265/500 16960/32000 (53%)] Loss: 0.57407 (QuantReg: 13.34074) QuantErr: 13.34074 batch_time=0.45484 
Train Epoch: 26 [273/500 17472/32000 (55%)] Loss: 0.50086 (QuantReg: 13.15266) QuantErr: 13.15266 batch_time=0.39021 
Train Epoch: 26 [281/500 17984/32000 (56%)] Loss: 0.73346 (QuantReg: 13.53989) QuantErr: 13.53989 batch_time=0.38715 
Train Epoch: 26 [289/500 18496/32000 (58%)] Loss: 0.54704 (QuantReg: 13.60594) QuantErr: 13.60594 batch_time=0.39192 
Train Epoch: 26 [297/500 19008/32000 (59%)] Loss: 0.64765 (QuantReg: 13.68043) QuantErr: 13.68043 batch_time=0.80326 
Train Epoch: 26 [305/500 19520/32000 (61%)] Loss: 0.67566 (QuantReg: 13.56174) QuantErr: 13.56174 batch_time=0.40927 
Train Epoch: 26 [313/500 20032/32000 (63%)] Loss: 0.63817 (QuantReg: 13.59329) QuantErr: 13.59329 batch_time=0.39761 
Train Epoch: 26 [321/500 20544/32000 (64%)] Loss: 0.58566 (QuantReg: 13.19657) QuantErr: 13.19657 batch_time=0.46069 
Train Epoch: 26 [329/500 21056/32000 (66%)] Loss: 0.43956 (QuantReg: 13.40896) QuantErr: 13.40896 batch_time=0.45273 
Train Epoch: 26 [337/500 21568/32000 (67%)] Loss: 0.59639 (QuantReg: 13.48580) QuantErr: 13.48580 batch_time=0.41026 
Train Epoch: 26 [345/500 22080/32000 (69%)] Loss: 0.51145 (QuantReg: 13.41510) QuantErr: 13.41510 batch_time=0.43278 
Train Epoch: 26 [353/500 22592/32000 (71%)] Loss: 0.53686 (QuantReg: 13.49331) QuantErr: 13.49331 batch_time=0.40458 
Train Epoch: 26 [361/500 23104/32000 (72%)] Loss: 0.41703 (QuantReg: 13.77143) QuantErr: 13.77143 batch_time=0.79208 
Train Epoch: 26 [369/500 23616/32000 (74%)] Loss: 0.70644 (QuantReg: 13.60466) QuantErr: 13.60466 batch_time=0.40388 
Train Epoch: 26 [377/500 24128/32000 (75%)] Loss: 0.67035 (QuantReg: 14.20507) QuantErr: 14.20507 batch_time=0.39898 
Train Epoch: 26 [385/500 24640/32000 (77%)] Loss: 0.57457 (QuantReg: 13.95606) QuantErr: 13.95606 batch_time=0.44568 
Train Epoch: 26 [393/500 25152/32000 (79%)] Loss: 0.34097 (QuantReg: 13.70461) QuantErr: 13.70461 batch_time=0.44973 
Train Epoch: 26 [401/500 25664/32000 (80%)] Loss: 0.58588 (QuantReg: 13.40441) QuantErr: 13.40441 batch_time=0.40242 
Train Epoch: 26 [409/500 26176/32000 (82%)] Loss: 0.40638 (QuantReg: 13.83822) QuantErr: 13.83822 batch_time=0.44884 
Train Epoch: 26 [417/500 26688/32000 (83%)] Loss: 0.72215 (QuantReg: 13.51895) QuantErr: 13.51895 batch_time=0.39352 
Train Epoch: 26 [425/500 27200/32000 (85%)] Loss: 0.47504 (QuantReg: 13.50823) QuantErr: 13.50823 batch_time=0.74141 
Train Epoch: 26 [433/500 27712/32000 (87%)] Loss: 0.77836 (QuantReg: 13.88377) QuantErr: 13.88377 batch_time=0.39434 
Train Epoch: 26 [441/500 28224/32000 (88%)] Loss: 0.78579 (QuantReg: 13.56300) QuantErr: 13.56300 batch_time=0.40062 
Train Epoch: 26 [449/500 28736/32000 (90%)] Loss: 0.56323 (QuantReg: 13.83941) QuantErr: 13.83941 batch_time=0.45131 
Train Epoch: 26 [457/500 29248/32000 (91%)] Loss: 0.58743 (QuantReg: 13.57660) QuantErr: 13.57660 batch_time=0.45045 
Train Epoch: 26 [465/500 29760/32000 (93%)] Loss: 0.47734 (QuantReg: 13.31687) QuantErr: 13.31687 batch_time=0.39428 
Train Epoch: 26 [473/500 30272/32000 (95%)] Loss: 0.46672 (QuantReg: 13.70934) QuantErr: 13.70934 batch_time=0.40209 
Train Epoch: 26 [481/500 30784/32000 (96%)] Loss: 0.44092 (QuantReg: 13.67201) QuantErr: 13.67201 batch_time=0.43284 
Train Epoch: 26 [489/500 31296/32000 (98%)] Loss: 0.44360 (QuantReg: 13.51708) QuantErr: 13.51708 batch_time=0.80942 
Train Epoch: 26 [497/500 31808/32000 (99%)] Loss: 0.51611 (QuantReg: 13.69813) QuantErr: 13.69813 batch_time=0.39474 
Train Epoch: 26 codebook_update_time=2.19195
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch26.pth ...
Done in 4.349s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 0.5900081705152989
 quant_reg      : 13.520457260131836
 quant_err      : 13.520457260131836
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 13000
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.122736418511067
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.37603411440546
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.758551307847083
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.79926415819955
 MSRVTT_full_test/t2v_metrics/R1: 13.110367892976589
 MSRVTT_full_test/t2v_metrics/R5: 36.92307692307692
 MSRVTT_full_test/t2v_metrics/R10: 50.30100334448161
 MSRVTT_full_test/t2v_metrics/R50: 81.63879598662207
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.73311036789298
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.98432142631407
 MSRVTT_full_test/v2t_metrics/R1: 16.02006688963211
 MSRVTT_full_test/v2t_metrics/R5: 43.84615384615385
 MSRVTT_full_test/v2t_metrics/R10: 59.063545150501675
 MSRVTT_full_test/v2t_metrics/R50: 87.79264214046823
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.393478260869564
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.61825025599563
 mnt_best       : 29.144311721937104
 not_improved_count: 2
Train Epoch: 27 [1/500 64/32000 (0%)] Loss: 0.34510 (QuantReg: 13.76754) QuantErr: 13.76754 batch_time=30.64934 
Train Epoch: 27 [9/500 576/32000 (2%)] Loss: 0.57829 (QuantReg: 13.64671) QuantErr: 13.64671 batch_time=1.79695 
Train Epoch: 27 [17/500 1088/32000 (3%)] Loss: 0.64723 (QuantReg: 13.47619) QuantErr: 13.47619 batch_time=0.40417 
Train Epoch: 27 [25/500 1600/32000 (5%)] Loss: 1.05805 (QuantReg: 12.83040) QuantErr: 12.83040 batch_time=0.41738 
Train Epoch: 27 [33/500 2112/32000 (7%)] Loss: 0.49055 (QuantReg: 13.52280) QuantErr: 13.52280 batch_time=0.42096 
Train Epoch: 27 [41/500 2624/32000 (8%)] Loss: 0.51148 (QuantReg: 13.28631) QuantErr: 13.28631 batch_time=0.42326 
Train Epoch: 27 [49/500 3136/32000 (10%)] Loss: 0.69906 (QuantReg: 13.45077) QuantErr: 13.45077 batch_time=0.41836 
Train Epoch: 27 [57/500 3648/32000 (11%)] Loss: 0.34614 (QuantReg: 13.08193) QuantErr: 13.08193 batch_time=0.40869 
Train Epoch: 27 [65/500 4160/32000 (13%)] Loss: 0.61814 (QuantReg: 13.47105) QuantErr: 13.47105 batch_time=0.95669 
Train Epoch: 27 [73/500 4672/32000 (15%)] Loss: 0.42396 (QuantReg: 13.57175) QuantErr: 13.57175 batch_time=1.22690 
Train Epoch: 27 [81/500 5184/32000 (16%)] Loss: 0.59030 (QuantReg: 13.60324) QuantErr: 13.60324 batch_time=0.40208 
Train Epoch: 27 [89/500 5696/32000 (18%)] Loss: 1.10511 (QuantReg: 13.13817) QuantErr: 13.13817 batch_time=0.45531 
Train Epoch: 27 [97/500 6208/32000 (19%)] Loss: 0.35056 (QuantReg: 13.45765) QuantErr: 13.45765 batch_time=0.42136 
Train Epoch: 27 [105/500 6720/32000 (21%)] Loss: 0.46841 (QuantReg: 13.96671) QuantErr: 13.96671 batch_time=0.39718 
Train Epoch: 27 [113/500 7232/32000 (23%)] Loss: 0.54341 (QuantReg: 13.39183) QuantErr: 13.39183 batch_time=0.44691 
Train Epoch: 27 [121/500 7744/32000 (24%)] Loss: 0.41793 (QuantReg: 13.40052) QuantErr: 13.40052 batch_time=0.40887 
Train Epoch: 27 [129/500 8256/32000 (26%)] Loss: 0.78469 (QuantReg: 13.30968) QuantErr: 13.30968 batch_time=0.94259 
Train Epoch: 27 [137/500 8768/32000 (27%)] Loss: 0.84618 (QuantReg: 13.12401) QuantErr: 13.12401 batch_time=1.23300 
Train Epoch: 27 [145/500 9280/32000 (29%)] Loss: 0.62147 (QuantReg: 13.32435) QuantErr: 13.32435 batch_time=0.41916 
Train Epoch: 27 [153/500 9792/32000 (31%)] Loss: 0.42014 (QuantReg: 13.88235) QuantErr: 13.88235 batch_time=0.47240 
Train Epoch: 27 [161/500 10304/32000 (32%)] Loss: 0.52696 (QuantReg: 13.69419) QuantErr: 13.69419 batch_time=0.39247 
Train Epoch: 27 [169/500 10816/32000 (34%)] Loss: 1.01180 (QuantReg: 13.51369) QuantErr: 13.51369 batch_time=0.40201 
Train Epoch: 27 [177/500 11328/32000 (35%)] Loss: 0.47301 (QuantReg: 13.65349) QuantErr: 13.65349 batch_time=0.40651 
Train Epoch: 27 [185/500 11840/32000 (37%)] Loss: 0.35922 (QuantReg: 13.56945) QuantErr: 13.56945 batch_time=0.39574 
Train Epoch: 27 [193/500 12352/32000 (39%)] Loss: 0.38433 (QuantReg: 13.72476) QuantErr: 13.72476 batch_time=1.01370 
Train Epoch: 27 [201/500 12864/32000 (40%)] Loss: 0.64268 (QuantReg: 13.66576) QuantErr: 13.66576 batch_time=1.22115 
Train Epoch: 27 [209/500 13376/32000 (42%)] Loss: 0.58841 (QuantReg: 13.21192) QuantErr: 13.21192 batch_time=0.43793 
Train Epoch: 27 [217/500 13888/32000 (43%)] Loss: 0.43174 (QuantReg: 13.65175) QuantErr: 13.65175 batch_time=0.47357 
Train Epoch: 27 [225/500 14400/32000 (45%)] Loss: 0.68626 (QuantReg: 13.39378) QuantErr: 13.39378 batch_time=0.41610 
Train Epoch: 27 [233/500 14912/32000 (47%)] Loss: 0.70821 (QuantReg: 13.13156) QuantErr: 13.13156 batch_time=0.49866 
Train Epoch: 27 [241/500 15424/32000 (48%)] Loss: 0.54770 (QuantReg: 13.44627) QuantErr: 13.44627 batch_time=0.40779 
Train Epoch: 27 [249/500 15936/32000 (50%)] Loss: 0.71633 (QuantReg: 13.10241) QuantErr: 13.10241 batch_time=0.40366 
Train Epoch: 27 [257/500 16448/32000 (51%)] Loss: 0.56078 (QuantReg: 13.47336) QuantErr: 13.47336 batch_time=0.96394 
Train Epoch: 27 [265/500 16960/32000 (53%)] Loss: 0.59801 (QuantReg: 13.37507) QuantErr: 13.37507 batch_time=1.20735 
Train Epoch: 27 [273/500 17472/32000 (55%)] Loss: 0.64138 (QuantReg: 13.28427) QuantErr: 13.28427 batch_time=0.43979 
Train Epoch: 27 [281/500 17984/32000 (56%)] Loss: 0.38648 (QuantReg: 13.66739) QuantErr: 13.66739 batch_time=0.40679 
Train Epoch: 27 [289/500 18496/32000 (58%)] Loss: 0.54358 (QuantReg: 13.50734) QuantErr: 13.50734 batch_time=0.42853 
Train Epoch: 27 [297/500 19008/32000 (59%)] Loss: 0.46862 (QuantReg: 14.02963) QuantErr: 14.02963 batch_time=0.41191 
Train Epoch: 27 [305/500 19520/32000 (61%)] Loss: 0.65408 (QuantReg: 13.52182) QuantErr: 13.52182 batch_time=0.41208 
Train Epoch: 27 [313/500 20032/32000 (63%)] Loss: 0.83400 (QuantReg: 13.12565) QuantErr: 13.12565 batch_time=0.39612 
Train Epoch: 27 [321/500 20544/32000 (64%)] Loss: 0.61251 (QuantReg: 13.46067) QuantErr: 13.46067 batch_time=0.89613 
Train Epoch: 27 [329/500 21056/32000 (66%)] Loss: 0.45488 (QuantReg: 13.46856) QuantErr: 13.46856 batch_time=1.49108 
Train Epoch: 27 [337/500 21568/32000 (67%)] Loss: 0.51314 (QuantReg: 13.43850) QuantErr: 13.43850 batch_time=0.41662 
Train Epoch: 27 [345/500 22080/32000 (69%)] Loss: 0.38259 (QuantReg: 14.36171) QuantErr: 14.36171 batch_time=0.39663 
Train Epoch: 27 [353/500 22592/32000 (71%)] Loss: 0.75504 (QuantReg: 13.79538) QuantErr: 13.79538 batch_time=0.39011 
Train Epoch: 27 [361/500 23104/32000 (72%)] Loss: 0.94469 (QuantReg: 13.35866) QuantErr: 13.35866 batch_time=0.41872 
Train Epoch: 27 [369/500 23616/32000 (74%)] Loss: 0.56774 (QuantReg: 13.60051) QuantErr: 13.60051 batch_time=0.39644 
Train Epoch: 27 [377/500 24128/32000 (75%)] Loss: 0.46331 (QuantReg: 13.26838) QuantErr: 13.26838 batch_time=0.39195 
Train Epoch: 27 [385/500 24640/32000 (77%)] Loss: 0.75261 (QuantReg: 13.42378) QuantErr: 13.42378 batch_time=0.95205 
Train Epoch: 27 [393/500 25152/32000 (79%)] Loss: 0.67191 (QuantReg: 13.67858) QuantErr: 13.67858 batch_time=1.21136 
Train Epoch: 27 [401/500 25664/32000 (80%)] Loss: 0.31461 (QuantReg: 13.57903) QuantErr: 13.57903 batch_time=0.42182 
Train Epoch: 27 [409/500 26176/32000 (82%)] Loss: 0.53006 (QuantReg: 13.45194) QuantErr: 13.45194 batch_time=0.39463 
Train Epoch: 27 [417/500 26688/32000 (83%)] Loss: 0.87734 (QuantReg: 13.87600) QuantErr: 13.87600 batch_time=0.39375 
Train Epoch: 27 [425/500 27200/32000 (85%)] Loss: 0.39284 (QuantReg: 13.49260) QuantErr: 13.49260 batch_time=0.40582 
Train Epoch: 27 [433/500 27712/32000 (87%)] Loss: 0.54435 (QuantReg: 13.65654) QuantErr: 13.65654 batch_time=0.38545 
Train Epoch: 27 [441/500 28224/32000 (88%)] Loss: 0.42971 (QuantReg: 14.00601) QuantErr: 14.00601 batch_time=0.40134 
Train Epoch: 27 [449/500 28736/32000 (90%)] Loss: 0.50891 (QuantReg: 13.23323) QuantErr: 13.23323 batch_time=0.90311 
Train Epoch: 27 [457/500 29248/32000 (91%)] Loss: 0.47169 (QuantReg: 13.45009) QuantErr: 13.45009 batch_time=1.18076 
Train Epoch: 27 [465/500 29760/32000 (93%)] Loss: 0.60583 (QuantReg: 13.40589) QuantErr: 13.40589 batch_time=0.39615 
Train Epoch: 27 [473/500 30272/32000 (95%)] Loss: 0.63719 (QuantReg: 13.71218) QuantErr: 13.71218 batch_time=0.40635 
Train Epoch: 27 [481/500 30784/32000 (96%)] Loss: 0.58660 (QuantReg: 13.45549) QuantErr: 13.45549 batch_time=0.40812 
Train Epoch: 27 [489/500 31296/32000 (98%)] Loss: 0.60868 (QuantReg: 14.11821) QuantErr: 14.11821 batch_time=0.39944 
Train Epoch: 27 [497/500 31808/32000 (99%)] Loss: 0.54896 (QuantReg: 13.55568) QuantErr: 13.55568 batch_time=0.39501 
Train Epoch: 27 codebook_update_time=1.89005
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch27.pth ...
Done in 21.287s
removing stale ckpt [epoch 26] [took 0.07s]
 epoch          : 27
 loss           : 0.5813090217411518
 quant_reg      : 13.523434440612792
 quant_err      : 13.523434440612792
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 13500
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.659959758551308
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.76083841217485
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.279678068410463
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.7848412156001
 MSRVTT_full_test/t2v_metrics/R1: 12.94314381270903
 MSRVTT_full_test/t2v_metrics/R5: 36.12040133779264
 MSRVTT_full_test/t2v_metrics/R10: 50.36789297658863
 MSRVTT_full_test/t2v_metrics/R50: 81.40468227424749
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.96421404682274
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.66258632934333
 MSRVTT_full_test/v2t_metrics/R1: 16.48829431438127
 MSRVTT_full_test/v2t_metrics/R5: 43.47826086956522
 MSRVTT_full_test/v2t_metrics/R10: 58.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 87.82608695652173
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.23979933110368
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.82132993790643
 mnt_best       : 29.144311721937104
 not_improved_count: 3
Train Epoch: 28 [1/500 64/32000 (0%)] Loss: 0.38246 (QuantReg: 13.61747) QuantErr: 13.61747 batch_time=28.62138 
Train Epoch: 28 [9/500 576/32000 (2%)] Loss: 0.76416 (QuantReg: 13.27750) QuantErr: 13.27750 batch_time=0.39885 
Train Epoch: 28 [17/500 1088/32000 (3%)] Loss: 0.45365 (QuantReg: 13.66511) QuantErr: 13.66511 batch_time=0.43463 
Train Epoch: 28 [25/500 1600/32000 (5%)] Loss: 0.46729 (QuantReg: 13.61221) QuantErr: 13.61221 batch_time=0.42926 
Train Epoch: 28 [33/500 2112/32000 (7%)] Loss: 0.89736 (QuantReg: 13.16613) QuantErr: 13.16613 batch_time=0.41555 
Train Epoch: 28 [41/500 2624/32000 (8%)] Loss: 0.51650 (QuantReg: 13.92020) QuantErr: 13.92020 batch_time=0.41095 
Train Epoch: 28 [49/500 3136/32000 (10%)] Loss: 0.40633 (QuantReg: 13.69952) QuantErr: 13.69952 batch_time=0.41795 
Train Epoch: 28 [57/500 3648/32000 (11%)] Loss: 0.46607 (QuantReg: 13.37944) QuantErr: 13.37944 batch_time=0.40755 
Train Epoch: 28 [65/500 4160/32000 (13%)] Loss: 0.67561 (QuantReg: 12.99936) QuantErr: 12.99936 batch_time=0.57730 
Train Epoch: 28 [73/500 4672/32000 (15%)] Loss: 0.41119 (QuantReg: 13.21378) QuantErr: 13.21378 batch_time=0.41045 
Train Epoch: 28 [81/500 5184/32000 (16%)] Loss: 0.77576 (QuantReg: 14.04408) QuantErr: 14.04408 batch_time=0.42643 
Train Epoch: 28 [89/500 5696/32000 (18%)] Loss: 0.49123 (QuantReg: 13.47941) QuantErr: 13.47941 batch_time=0.41818 
Train Epoch: 28 [97/500 6208/32000 (19%)] Loss: 0.64609 (QuantReg: 13.47418) QuantErr: 13.47418 batch_time=0.41862 
Train Epoch: 28 [105/500 6720/32000 (21%)] Loss: 0.48133 (QuantReg: 13.51064) QuantErr: 13.51064 batch_time=0.41244 
Train Epoch: 28 [113/500 7232/32000 (23%)] Loss: 0.61682 (QuantReg: 13.29377) QuantErr: 13.29377 batch_time=0.41029 
Train Epoch: 28 [121/500 7744/32000 (24%)] Loss: 0.51329 (QuantReg: 13.90189) QuantErr: 13.90189 batch_time=0.41137 
Train Epoch: 28 [129/500 8256/32000 (26%)] Loss: 0.42424 (QuantReg: 13.90225) QuantErr: 13.90225 batch_time=0.60457 
Train Epoch: 28 [137/500 8768/32000 (27%)] Loss: 0.51058 (QuantReg: 13.37247) QuantErr: 13.37247 batch_time=0.40621 
Train Epoch: 28 [145/500 9280/32000 (29%)] Loss: 0.34328 (QuantReg: 13.18201) QuantErr: 13.18201 batch_time=0.40454 
Train Epoch: 28 [153/500 9792/32000 (31%)] Loss: 0.55258 (QuantReg: 13.86650) QuantErr: 13.86650 batch_time=0.40068 
Train Epoch: 28 [161/500 10304/32000 (32%)] Loss: 0.49130 (QuantReg: 13.35806) QuantErr: 13.35806 batch_time=0.41262 
Train Epoch: 28 [169/500 10816/32000 (34%)] Loss: 0.58512 (QuantReg: 13.54248) QuantErr: 13.54248 batch_time=0.40549 
Train Epoch: 28 [177/500 11328/32000 (35%)] Loss: 0.98199 (QuantReg: 13.54522) QuantErr: 13.54522 batch_time=0.40736 
Train Epoch: 28 [185/500 11840/32000 (37%)] Loss: 0.35508 (QuantReg: 14.00751) QuantErr: 14.00751 batch_time=0.39137 
Train Epoch: 28 [193/500 12352/32000 (39%)] Loss: 0.86566 (QuantReg: 13.25237) QuantErr: 13.25237 batch_time=0.61027 
Train Epoch: 28 [201/500 12864/32000 (40%)] Loss: 0.79461 (QuantReg: 13.54251) QuantErr: 13.54251 batch_time=0.39557 
Train Epoch: 28 [209/500 13376/32000 (42%)] Loss: 0.55782 (QuantReg: 13.37022) QuantErr: 13.37022 batch_time=0.42019 
Train Epoch: 28 [217/500 13888/32000 (43%)] Loss: 0.63856 (QuantReg: 13.67956) QuantErr: 13.67956 batch_time=0.39790 
Train Epoch: 28 [225/500 14400/32000 (45%)] Loss: 0.54448 (QuantReg: 13.28337) QuantErr: 13.28337 batch_time=0.41590 
Train Epoch: 28 [233/500 14912/32000 (47%)] Loss: 0.29927 (QuantReg: 13.80222) QuantErr: 13.80222 batch_time=0.41215 
Train Epoch: 28 [241/500 15424/32000 (48%)] Loss: 0.65000 (QuantReg: 13.53197) QuantErr: 13.53197 batch_time=0.39277 
Train Epoch: 28 [249/500 15936/32000 (50%)] Loss: 0.48922 (QuantReg: 14.19441) QuantErr: 14.19441 batch_time=0.40342 
Train Epoch: 28 [257/500 16448/32000 (51%)] Loss: 0.42980 (QuantReg: 13.35548) QuantErr: 13.35548 batch_time=0.56667 
Train Epoch: 28 [265/500 16960/32000 (53%)] Loss: 0.43767 (QuantReg: 13.81862) QuantErr: 13.81862 batch_time=0.45761 
Train Epoch: 28 [273/500 17472/32000 (55%)] Loss: 0.36167 (QuantReg: 13.72451) QuantErr: 13.72451 batch_time=0.40900 
Train Epoch: 28 [281/500 17984/32000 (56%)] Loss: 0.65749 (QuantReg: 13.79167) QuantErr: 13.79167 batch_time=0.41278 
Train Epoch: 28 [289/500 18496/32000 (58%)] Loss: 0.91358 (QuantReg: 13.46401) QuantErr: 13.46401 batch_time=0.40798 
Train Epoch: 28 [297/500 19008/32000 (59%)] Loss: 0.60556 (QuantReg: 13.40732) QuantErr: 13.40732 batch_time=0.40914 
Train Epoch: 28 [305/500 19520/32000 (61%)] Loss: 0.62518 (QuantReg: 13.51654) QuantErr: 13.51654 batch_time=0.40779 
Train Epoch: 28 [313/500 20032/32000 (63%)] Loss: 0.70230 (QuantReg: 13.35527) QuantErr: 13.35527 batch_time=0.39786 
Train Epoch: 28 [321/500 20544/32000 (64%)] Loss: 0.71626 (QuantReg: 13.39849) QuantErr: 13.39849 batch_time=0.41730 
Train Epoch: 28 [329/500 21056/32000 (66%)] Loss: 0.44709 (QuantReg: 13.41773) QuantErr: 13.41773 batch_time=0.41088 
Train Epoch: 28 [337/500 21568/32000 (67%)] Loss: 0.58556 (QuantReg: 13.72672) QuantErr: 13.72672 batch_time=0.40816 
Train Epoch: 28 [345/500 22080/32000 (69%)] Loss: 0.62968 (QuantReg: 13.25779) QuantErr: 13.25779 batch_time=0.40424 
Train Epoch: 28 [353/500 22592/32000 (71%)] Loss: 0.66264 (QuantReg: 13.41720) QuantErr: 13.41720 batch_time=0.43942 
Train Epoch: 28 [361/500 23104/32000 (72%)] Loss: 0.47383 (QuantReg: 13.74340) QuantErr: 13.74340 batch_time=0.39622 
Train Epoch: 28 [369/500 23616/32000 (74%)] Loss: 0.79351 (QuantReg: 13.32989) QuantErr: 13.32989 batch_time=0.40905 
Train Epoch: 28 [377/500 24128/32000 (75%)] Loss: 0.62942 (QuantReg: 13.27658) QuantErr: 13.27658 batch_time=0.39407 
Train Epoch: 28 [385/500 24640/32000 (77%)] Loss: 0.41914 (QuantReg: 13.90187) QuantErr: 13.90187 batch_time=0.40696 
Train Epoch: 28 [393/500 25152/32000 (79%)] Loss: 0.51106 (QuantReg: 13.29641) QuantErr: 13.29641 batch_time=0.40356 
Train Epoch: 28 [401/500 25664/32000 (80%)] Loss: 0.68645 (QuantReg: 13.33242) QuantErr: 13.33242 batch_time=0.40323 
Train Epoch: 28 [409/500 26176/32000 (82%)] Loss: 0.28551 (QuantReg: 13.68695) QuantErr: 13.68695 batch_time=0.42406 
Train Epoch: 28 [417/500 26688/32000 (83%)] Loss: 0.38868 (QuantReg: 13.92377) QuantErr: 13.92377 batch_time=0.39354 
Train Epoch: 28 [425/500 27200/32000 (85%)] Loss: 0.50146 (QuantReg: 13.89377) QuantErr: 13.89377 batch_time=0.39265 
Train Epoch: 28 [433/500 27712/32000 (87%)] Loss: 0.55306 (QuantReg: 13.67392) QuantErr: 13.67392 batch_time=0.39386 
Train Epoch: 28 [441/500 28224/32000 (88%)] Loss: 0.56497 (QuantReg: 13.21804) QuantErr: 13.21804 batch_time=0.39382 
Train Epoch: 28 [449/500 28736/32000 (90%)] Loss: 0.48365 (QuantReg: 13.90884) QuantErr: 13.90884 batch_time=0.39358 
Train Epoch: 28 [457/500 29248/32000 (91%)] Loss: 0.55846 (QuantReg: 13.76156) QuantErr: 13.76156 batch_time=0.39763 
Train Epoch: 28 [465/500 29760/32000 (93%)] Loss: 0.78242 (QuantReg: 13.63584) QuantErr: 13.63584 batch_time=0.38790 
Train Epoch: 28 [473/500 30272/32000 (95%)] Loss: 0.37463 (QuantReg: 13.83507) QuantErr: 13.83507 batch_time=0.38817 
Train Epoch: 28 [481/500 30784/32000 (96%)] Loss: 0.58406 (QuantReg: 13.44896) QuantErr: 13.44896 batch_time=0.39559 
Train Epoch: 28 [489/500 31296/32000 (98%)] Loss: 0.70767 (QuantReg: 13.85416) QuantErr: 13.85416 batch_time=0.39942 
Train Epoch: 28 [497/500 31808/32000 (99%)] Loss: 0.65255 (QuantReg: 13.38187) QuantErr: 13.38187 batch_time=0.39688 
Train Epoch: 28 codebook_update_time=2.10752
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch28.pth ...
Done in 16.233s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 0.5600005874633789
 quant_reg      : 13.542110164642335
 quant_err      : 13.542110164642335
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 14000
 MSRVTT_full_val/t2v_metrics/R1: 30.58350100603622
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.83702213279678
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.37515652308433
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.941649899396379
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.892996604904134
 MSRVTT_full_test/t2v_metrics/R1: 12.341137123745819
 MSRVTT_full_test/t2v_metrics/R5: 35.819397993311036
 MSRVTT_full_test/t2v_metrics/R10: 50.0
 MSRVTT_full_test/t2v_metrics/R50: 80.96989966555184
 MSRVTT_full_test/t2v_metrics/MedR: 10.5
 MSRVTT_full_test/t2v_metrics/MeanR: 45.134448160535115
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.0638869074887
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 43.41137123745819
 MSRVTT_full_test/v2t_metrics/R10: 59.4314381270903
 MSRVTT_full_test/v2t_metrics/R50: 87.19063545150502
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.96036789297659
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.5026010110471
 mnt_best       : 29.144311721937104
 not_improved_count: 4
Train Epoch: 29 [1/500 64/32000 (0%)] Loss: 0.77934 (QuantReg: 13.37256) QuantErr: 13.37256 batch_time=31.19091 
Train Epoch: 29 [9/500 576/32000 (2%)] Loss: 0.48266 (QuantReg: 13.45625) QuantErr: 13.45625 batch_time=0.39980 
Train Epoch: 29 [17/500 1088/32000 (3%)] Loss: 0.60472 (QuantReg: 13.48982) QuantErr: 13.48982 batch_time=0.38845 
Train Epoch: 29 [25/500 1600/32000 (5%)] Loss: 0.58667 (QuantReg: 13.22647) QuantErr: 13.22647 batch_time=0.39544 
Train Epoch: 29 [33/500 2112/32000 (7%)] Loss: 0.58191 (QuantReg: 13.77232) QuantErr: 13.77232 batch_time=0.40782 
Train Epoch: 29 [41/500 2624/32000 (8%)] Loss: 0.59809 (QuantReg: 13.55671) QuantErr: 13.55671 batch_time=0.41408 
Train Epoch: 29 [49/500 3136/32000 (10%)] Loss: 0.56739 (QuantReg: 13.63733) QuantErr: 13.63733 batch_time=0.39579 
Train Epoch: 29 [57/500 3648/32000 (11%)] Loss: 0.44063 (QuantReg: 13.59200) QuantErr: 13.59200 batch_time=0.50879 
Train Epoch: 29 [65/500 4160/32000 (13%)] Loss: 0.64210 (QuantReg: 13.46359) QuantErr: 13.46359 batch_time=0.40133 
Train Epoch: 29 [73/500 4672/32000 (15%)] Loss: 0.46241 (QuantReg: 13.51019) QuantErr: 13.51019 batch_time=0.40473 
Train Epoch: 29 [81/500 5184/32000 (16%)] Loss: 0.51438 (QuantReg: 13.74525) QuantErr: 13.74525 batch_time=0.39125 
Train Epoch: 29 [89/500 5696/32000 (18%)] Loss: 0.67288 (QuantReg: 13.49724) QuantErr: 13.49724 batch_time=0.40923 
Train Epoch: 29 [97/500 6208/32000 (19%)] Loss: 0.41591 (QuantReg: 13.56244) QuantErr: 13.56244 batch_time=0.42096 
Train Epoch: 29 [105/500 6720/32000 (21%)] Loss: 0.61661 (QuantReg: 13.65649) QuantErr: 13.65649 batch_time=0.40139 
Train Epoch: 29 [113/500 7232/32000 (23%)] Loss: 0.63996 (QuantReg: 13.24601) QuantErr: 13.24601 batch_time=0.39093 
Train Epoch: 29 [121/500 7744/32000 (24%)] Loss: 0.57089 (QuantReg: 13.71188) QuantErr: 13.71188 batch_time=0.51226 
Train Epoch: 29 [129/500 8256/32000 (26%)] Loss: 0.42728 (QuantReg: 13.46344) QuantErr: 13.46344 batch_time=0.42793 
Train Epoch: 29 [137/500 8768/32000 (27%)] Loss: 0.51310 (QuantReg: 13.67414) QuantErr: 13.67414 batch_time=0.41337 
Train Epoch: 29 [145/500 9280/32000 (29%)] Loss: 0.67414 (QuantReg: 13.68906) QuantErr: 13.68906 batch_time=0.39544 
Train Epoch: 29 [153/500 9792/32000 (31%)] Loss: 0.61504 (QuantReg: 13.80749) QuantErr: 13.80749 batch_time=0.39071 
Train Epoch: 29 [161/500 10304/32000 (32%)] Loss: 0.59791 (QuantReg: 13.40869) QuantErr: 13.40869 batch_time=0.38924 
Train Epoch: 29 [169/500 10816/32000 (34%)] Loss: 0.67817 (QuantReg: 13.69277) QuantErr: 13.69277 batch_time=0.39153 
Train Epoch: 29 [177/500 11328/32000 (35%)] Loss: 0.58512 (QuantReg: 13.64253) QuantErr: 13.64253 batch_time=0.46780 
Train Epoch: 29 [185/500 11840/32000 (37%)] Loss: 0.30819 (QuantReg: 13.76960) QuantErr: 13.76960 batch_time=0.50220 
Train Epoch: 29 [193/500 12352/32000 (39%)] Loss: 0.53901 (QuantReg: 13.71567) QuantErr: 13.71567 batch_time=0.38979 
Train Epoch: 29 [201/500 12864/32000 (40%)] Loss: 0.51709 (QuantReg: 13.75588) QuantErr: 13.75588 batch_time=0.41647 
Train Epoch: 29 [209/500 13376/32000 (42%)] Loss: 0.49192 (QuantReg: 14.01925) QuantErr: 14.01925 batch_time=0.40092 
Train Epoch: 29 [217/500 13888/32000 (43%)] Loss: 0.44443 (QuantReg: 13.60164) QuantErr: 13.60164 batch_time=0.39601 
Train Epoch: 29 [225/500 14400/32000 (45%)] Loss: 0.71694 (QuantReg: 13.29411) QuantErr: 13.29411 batch_time=0.39759 
Train Epoch: 29 [233/500 14912/32000 (47%)] Loss: 0.46812 (QuantReg: 13.70220) QuantErr: 13.70220 batch_time=0.40386 
Train Epoch: 29 [241/500 15424/32000 (48%)] Loss: 0.48495 (QuantReg: 13.33528) QuantErr: 13.33528 batch_time=0.40955 
Train Epoch: 29 [249/500 15936/32000 (50%)] Loss: 1.03640 (QuantReg: 13.66880) QuantErr: 13.66880 batch_time=0.42962 
Train Epoch: 29 [257/500 16448/32000 (51%)] Loss: 0.58375 (QuantReg: 13.84970) QuantErr: 13.84970 batch_time=0.40812 
Train Epoch: 29 [265/500 16960/32000 (53%)] Loss: 1.06320 (QuantReg: 13.36336) QuantErr: 13.36336 batch_time=0.39256 
Train Epoch: 29 [273/500 17472/32000 (55%)] Loss: 0.67541 (QuantReg: 13.70304) QuantErr: 13.70304 batch_time=0.40338 
Train Epoch: 29 [281/500 17984/32000 (56%)] Loss: 0.49434 (QuantReg: 13.79748) QuantErr: 13.79748 batch_time=0.40817 
Train Epoch: 29 [289/500 18496/32000 (58%)] Loss: 0.42245 (QuantReg: 13.67626) QuantErr: 13.67626 batch_time=0.39357 
Train Epoch: 29 [297/500 19008/32000 (59%)] Loss: 0.58113 (QuantReg: 13.70656) QuantErr: 13.70656 batch_time=0.39394 
Train Epoch: 29 [305/500 19520/32000 (61%)] Loss: 0.53801 (QuantReg: 13.83116) QuantErr: 13.83116 batch_time=0.40488 
Train Epoch: 29 [313/500 20032/32000 (63%)] Loss: 0.40250 (QuantReg: 13.84209) QuantErr: 13.84209 batch_time=0.39979 
Train Epoch: 29 [321/500 20544/32000 (64%)] Loss: 0.73791 (QuantReg: 13.73164) QuantErr: 13.73164 batch_time=0.38850 
Train Epoch: 29 [329/500 21056/32000 (66%)] Loss: 0.60376 (QuantReg: 13.26995) QuantErr: 13.26995 batch_time=0.42058 
Train Epoch: 29 [337/500 21568/32000 (67%)] Loss: 0.59931 (QuantReg: 13.34429) QuantErr: 13.34429 batch_time=0.41189 
Train Epoch: 29 [345/500 22080/32000 (69%)] Loss: 0.43529 (QuantReg: 13.81708) QuantErr: 13.81708 batch_time=0.39682 
Train Epoch: 29 [353/500 22592/32000 (71%)] Loss: 0.53095 (QuantReg: 13.73362) QuantErr: 13.73362 batch_time=0.40206 
Train Epoch: 29 [361/500 23104/32000 (72%)] Loss: 0.52850 (QuantReg: 13.33156) QuantErr: 13.33156 batch_time=0.41715 
Train Epoch: 29 [369/500 23616/32000 (74%)] Loss: 0.40600 (QuantReg: 13.83186) QuantErr: 13.83186 batch_time=0.40507 
Train Epoch: 29 [377/500 24128/32000 (75%)] Loss: 0.96485 (QuantReg: 13.37405) QuantErr: 13.37405 batch_time=0.40276 
Train Epoch: 29 [385/500 24640/32000 (77%)] Loss: 0.72829 (QuantReg: 13.36106) QuantErr: 13.36106 batch_time=0.41657 
Train Epoch: 29 [393/500 25152/32000 (79%)] Loss: 0.47468 (QuantReg: 13.58190) QuantErr: 13.58190 batch_time=2.45740 
Train Epoch: 29 [401/500 25664/32000 (80%)] Loss: 0.36905 (QuantReg: 13.58322) QuantErr: 13.58322 batch_time=0.39674 
Train Epoch: 29 [409/500 26176/32000 (82%)] Loss: 0.37694 (QuantReg: 13.62145) QuantErr: 13.62145 batch_time=0.40493 
Train Epoch: 29 [417/500 26688/32000 (83%)] Loss: 0.37468 (QuantReg: 13.37347) QuantErr: 13.37347 batch_time=0.40940 
Train Epoch: 29 [425/500 27200/32000 (85%)] Loss: 0.63989 (QuantReg: 13.67858) QuantErr: 13.67858 batch_time=0.43569 
Train Epoch: 29 [433/500 27712/32000 (87%)] Loss: 0.42874 (QuantReg: 13.85453) QuantErr: 13.85453 batch_time=0.40381 
Train Epoch: 29 [441/500 28224/32000 (88%)] Loss: 0.46761 (QuantReg: 13.51260) QuantErr: 13.51260 batch_time=0.42663 
Train Epoch: 29 [449/500 28736/32000 (90%)] Loss: 0.50981 (QuantReg: 13.64606) QuantErr: 13.64606 batch_time=0.39850 
Train Epoch: 29 [457/500 29248/32000 (91%)] Loss: 0.46867 (QuantReg: 13.73260) QuantErr: 13.73260 batch_time=0.92861 
Train Epoch: 29 [465/500 29760/32000 (93%)] Loss: 0.66119 (QuantReg: 13.67449) QuantErr: 13.67449 batch_time=0.44387 
Train Epoch: 29 [473/500 30272/32000 (95%)] Loss: 0.48377 (QuantReg: 14.18911) QuantErr: 14.18911 batch_time=0.43133 
Train Epoch: 29 [481/500 30784/32000 (96%)] Loss: 0.70724 (QuantReg: 13.57066) QuantErr: 13.57066 batch_time=0.42748 
Train Epoch: 29 [489/500 31296/32000 (98%)] Loss: 0.54372 (QuantReg: 13.76924) QuantErr: 13.76924 batch_time=0.41207 
Train Epoch: 29 [497/500 31808/32000 (99%)] Loss: 0.73402 (QuantReg: 13.65504) QuantErr: 13.65504 batch_time=0.39898 
Train Epoch: 29 codebook_update_time=2.10849
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch29.pth ...
Done in 4.032s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch29.pth ...
Done in 8.138s
removing stale ckpt [epoch 28] [took 0.00s]
 epoch          : 29
 loss           : 0.5536331787109375
 quant_reg      : 13.569979789733887
 quant_err      : 13.569979789733887
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 14500
 MSRVTT_full_val/t2v_metrics/R1: 30.784708249496983
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.329979879275655
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.44044132631134
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 78.47082494969818
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.979879275653923
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.69000177444099
 MSRVTT_full_test/t2v_metrics/R1: 13.578595317725753
 MSRVTT_full_test/t2v_metrics/R5: 37.92642140468227
 MSRVTT_full_test/t2v_metrics/R10: 51.30434782608695
 MSRVTT_full_test/t2v_metrics/R50: 82.37458193979933
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.611371237458194
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.784041448589548
 MSRVTT_full_test/v2t_metrics/R1: 16.48829431438127
 MSRVTT_full_test/v2t_metrics/R5: 44.31438127090301
 MSRVTT_full_test/v2t_metrics/R10: 58.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 87.65886287625418
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.142976588628763
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.04312782826972
 mnt_best       : 29.784041448589548
 not_improved_count: 0
Train Epoch: 30 [1/500 64/32000 (0%)] Loss: 0.69834 (QuantReg: 13.67854) QuantErr: 13.67854 batch_time=30.09966 
Train Epoch: 30 [9/500 576/32000 (2%)] Loss: 0.43265 (QuantReg: 13.04861) QuantErr: 13.04861 batch_time=0.39087 
Train Epoch: 30 [17/500 1088/32000 (3%)] Loss: 0.28435 (QuantReg: 13.52501) QuantErr: 13.52501 batch_time=0.39157 
Train Epoch: 30 [25/500 1600/32000 (5%)] Loss: 0.99233 (QuantReg: 13.32878) QuantErr: 13.32878 batch_time=0.39598 
Train Epoch: 30 [33/500 2112/32000 (7%)] Loss: 0.56369 (QuantReg: 13.70305) QuantErr: 13.70305 batch_time=0.39637 
Train Epoch: 30 [41/500 2624/32000 (8%)] Loss: 0.58205 (QuantReg: 13.71090) QuantErr: 13.71090 batch_time=0.40500 
Train Epoch: 30 [49/500 3136/32000 (10%)] Loss: 0.46147 (QuantReg: 13.49543) QuantErr: 13.49543 batch_time=0.39361 
Train Epoch: 30 [57/500 3648/32000 (11%)] Loss: 0.54798 (QuantReg: 13.03210) QuantErr: 13.03210 batch_time=0.39233 
Train Epoch: 30 [65/500 4160/32000 (13%)] Loss: 0.67335 (QuantReg: 13.64199) QuantErr: 13.64199 batch_time=0.67515 
Train Epoch: 30 [73/500 4672/32000 (15%)] Loss: 0.62754 (QuantReg: 13.56025) QuantErr: 13.56025 batch_time=0.40230 
Train Epoch: 30 [81/500 5184/32000 (16%)] Loss: 0.54410 (QuantReg: 13.26144) QuantErr: 13.26144 batch_time=0.41410 
Train Epoch: 30 [89/500 5696/32000 (18%)] Loss: 0.51133 (QuantReg: 13.50927) QuantErr: 13.50927 batch_time=0.39961 
Train Epoch: 30 [97/500 6208/32000 (19%)] Loss: 0.69120 (QuantReg: 13.70173) QuantErr: 13.70173 batch_time=0.40137 
Train Epoch: 30 [105/500 6720/32000 (21%)] Loss: 0.90126 (QuantReg: 13.47339) QuantErr: 13.47339 batch_time=0.41242 
Train Epoch: 30 [113/500 7232/32000 (23%)] Loss: 0.52222 (QuantReg: 13.50546) QuantErr: 13.50546 batch_time=0.40297 
Train Epoch: 30 [121/500 7744/32000 (24%)] Loss: 0.62319 (QuantReg: 13.65286) QuantErr: 13.65286 batch_time=0.45188 
Train Epoch: 30 [129/500 8256/32000 (26%)] Loss: 0.39752 (QuantReg: 13.94125) QuantErr: 13.94125 batch_time=0.39208 
Train Epoch: 30 [137/500 8768/32000 (27%)] Loss: 0.43965 (QuantReg: 13.88654) QuantErr: 13.88654 batch_time=0.39607 
Train Epoch: 30 [145/500 9280/32000 (29%)] Loss: 0.75778 (QuantReg: 13.58637) QuantErr: 13.58637 batch_time=0.39557 
Train Epoch: 30 [153/500 9792/32000 (31%)] Loss: 0.35351 (QuantReg: 13.62269) QuantErr: 13.62269 batch_time=0.40350 
Train Epoch: 30 [161/500 10304/32000 (32%)] Loss: 0.55431 (QuantReg: 13.24508) QuantErr: 13.24508 batch_time=0.41208 
Train Epoch: 30 [169/500 10816/32000 (34%)] Loss: 0.50728 (QuantReg: 13.48202) QuantErr: 13.48202 batch_time=0.40108 
Train Epoch: 30 [177/500 11328/32000 (35%)] Loss: 0.69582 (QuantReg: 12.96197) QuantErr: 12.96197 batch_time=0.40675 
Train Epoch: 30 [185/500 11840/32000 (37%)] Loss: 0.67209 (QuantReg: 13.75504) QuantErr: 13.75504 batch_time=0.50259 
Train Epoch: 30 [193/500 12352/32000 (39%)] Loss: 0.61452 (QuantReg: 13.47234) QuantErr: 13.47234 batch_time=0.41258 
Train Epoch: 30 [201/500 12864/32000 (40%)] Loss: 0.40641 (QuantReg: 13.51388) QuantErr: 13.51388 batch_time=0.38828 
Train Epoch: 30 [209/500 13376/32000 (42%)] Loss: 0.51464 (QuantReg: 13.83549) QuantErr: 13.83549 batch_time=0.39313 
Train Epoch: 30 [217/500 13888/32000 (43%)] Loss: 0.45832 (QuantReg: 13.75729) QuantErr: 13.75729 batch_time=0.39525 
Train Epoch: 30 [225/500 14400/32000 (45%)] Loss: 0.91238 (QuantReg: 13.37404) QuantErr: 13.37404 batch_time=0.42141 
Train Epoch: 30 [233/500 14912/32000 (47%)] Loss: 0.53203 (QuantReg: 13.77536) QuantErr: 13.77536 batch_time=0.40485 
Train Epoch: 30 [241/500 15424/32000 (48%)] Loss: 0.56848 (QuantReg: 13.96812) QuantErr: 13.96812 batch_time=0.40907 
Train Epoch: 30 [249/500 15936/32000 (50%)] Loss: 0.68534 (QuantReg: 13.90302) QuantErr: 13.90302 batch_time=0.40817 
Train Epoch: 30 [257/500 16448/32000 (51%)] Loss: 0.44257 (QuantReg: 13.67505) QuantErr: 13.67505 batch_time=0.41468 
Train Epoch: 30 [265/500 16960/32000 (53%)] Loss: 0.36228 (QuantReg: 13.65902) QuantErr: 13.65902 batch_time=0.40078 
Train Epoch: 30 [273/500 17472/32000 (55%)] Loss: 0.59779 (QuantReg: 13.54448) QuantErr: 13.54448 batch_time=0.41430 
Train Epoch: 30 [281/500 17984/32000 (56%)] Loss: 0.58210 (QuantReg: 13.31038) QuantErr: 13.31038 batch_time=0.40752 
Train Epoch: 30 [289/500 18496/32000 (58%)] Loss: 0.45399 (QuantReg: 13.79029) QuantErr: 13.79029 batch_time=0.40867 
Train Epoch: 30 [297/500 19008/32000 (59%)] Loss: 0.38685 (QuantReg: 13.36089) QuantErr: 13.36089 batch_time=0.46576 
Train Epoch: 30 [305/500 19520/32000 (61%)] Loss: 0.39842 (QuantReg: 13.42773) QuantErr: 13.42773 batch_time=0.40615 
Train Epoch: 30 [313/500 20032/32000 (63%)] Loss: 0.58582 (QuantReg: 13.69774) QuantErr: 13.69774 batch_time=0.44914 
Train Epoch: 30 [321/500 20544/32000 (64%)] Loss: 0.72062 (QuantReg: 13.77944) QuantErr: 13.77944 batch_time=0.39267 
Train Epoch: 30 [329/500 21056/32000 (66%)] Loss: 0.75520 (QuantReg: 13.28560) QuantErr: 13.28560 batch_time=0.39721 
Train Epoch: 30 [337/500 21568/32000 (67%)] Loss: 0.38231 (QuantReg: 13.54783) QuantErr: 13.54783 batch_time=0.39585 
Train Epoch: 30 [345/500 22080/32000 (69%)] Loss: 0.69185 (QuantReg: 13.27676) QuantErr: 13.27676 batch_time=0.40825 
Train Epoch: 30 [353/500 22592/32000 (71%)] Loss: 0.86452 (QuantReg: 13.05812) QuantErr: 13.05812 batch_time=0.39594 
Train Epoch: 30 [361/500 23104/32000 (72%)] Loss: 0.40570 (QuantReg: 13.88390) QuantErr: 13.88390 batch_time=0.45336 
Train Epoch: 30 [369/500 23616/32000 (74%)] Loss: 0.31967 (QuantReg: 13.91460) QuantErr: 13.91460 batch_time=0.39801 
Train Epoch: 30 [377/500 24128/32000 (75%)] Loss: 0.41662 (QuantReg: 13.84078) QuantErr: 13.84078 batch_time=0.43971 
Train Epoch: 30 [385/500 24640/32000 (77%)] Loss: 0.24252 (QuantReg: 13.56990) QuantErr: 13.56990 batch_time=0.38819 
Train Epoch: 30 [393/500 25152/32000 (79%)] Loss: 0.60335 (QuantReg: 13.56156) QuantErr: 13.56156 batch_time=0.38923 
Train Epoch: 30 [401/500 25664/32000 (80%)] Loss: 0.26995 (QuantReg: 13.71009) QuantErr: 13.71009 batch_time=0.44375 
Train Epoch: 30 [409/500 26176/32000 (82%)] Loss: 0.73712 (QuantReg: 13.82370) QuantErr: 13.82370 batch_time=0.39143 
Train Epoch: 30 [417/500 26688/32000 (83%)] Loss: 0.50794 (QuantReg: 14.12996) QuantErr: 14.12996 batch_time=0.39525 
Train Epoch: 30 [425/500 27200/32000 (85%)] Loss: 0.51391 (QuantReg: 13.98481) QuantErr: 13.98481 batch_time=0.41455 
Train Epoch: 30 [433/500 27712/32000 (87%)] Loss: 0.43054 (QuantReg: 13.66370) QuantErr: 13.66370 batch_time=0.40286 
Train Epoch: 30 [441/500 28224/32000 (88%)] Loss: 0.61596 (QuantReg: 13.80764) QuantErr: 13.80764 batch_time=0.39818 
Train Epoch: 30 [449/500 28736/32000 (90%)] Loss: 0.51434 (QuantReg: 13.67827) QuantErr: 13.67827 batch_time=0.40031 
Train Epoch: 30 [457/500 29248/32000 (91%)] Loss: 0.46935 (QuantReg: 13.38754) QuantErr: 13.38754 batch_time=0.43569 
Train Epoch: 30 [465/500 29760/32000 (93%)] Loss: 0.99587 (QuantReg: 13.47072) QuantErr: 13.47072 batch_time=0.39063 
Train Epoch: 30 [473/500 30272/32000 (95%)] Loss: 0.49486 (QuantReg: 13.08776) QuantErr: 13.08776 batch_time=0.41827 
Train Epoch: 30 [481/500 30784/32000 (96%)] Loss: 0.50764 (QuantReg: 13.79441) QuantErr: 13.79441 batch_time=0.40245 
Train Epoch: 30 [489/500 31296/32000 (98%)] Loss: 0.61199 (QuantReg: 13.68930) QuantErr: 13.68930 batch_time=0.40009 
Train Epoch: 30 [497/500 31808/32000 (99%)] Loss: 0.70404 (QuantReg: 13.29750) QuantErr: 13.29750 batch_time=0.40231 
Train Epoch: 30 codebook_update_time=2.11951
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch30.pth ...
Done in 4.026s
removing stale ckpt [epoch 29] [took 0.00s]
 epoch          : 30
 loss           : 0.5400293967425823
 quant_reg      : 13.611248781204223
 quant_err      : 13.611248781204223
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 15000
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 67.40442655935614
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.561368209255534
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.22075552205763
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.122736418511066
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.57200639513219
 MSRVTT_full_test/t2v_metrics/R1: 13.444816053511706
 MSRVTT_full_test/t2v_metrics/R5: 36.62207357859532
 MSRVTT_full_test/t2v_metrics/R10: 50.903010033444815
 MSRVTT_full_test/t2v_metrics/R50: 80.46822742474916
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.39799331103679
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.264902839110494
 MSRVTT_full_test/v2t_metrics/R1: 15.618729096989966
 MSRVTT_full_test/v2t_metrics/R5: 42.97658862876254
 MSRVTT_full_test/v2t_metrics/R10: 58.66220735785953
 MSRVTT_full_test/v2t_metrics/R50: 87.09030100334448
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.672240802675585
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.020864411976426
 mnt_best       : 29.784041448589548
 not_improved_count: 1
Train Epoch: 31 [1/500 64/32000 (0%)] Loss: 0.62516 (QuantReg: 13.55466) QuantErr: 13.55466 batch_time=31.32546 
Train Epoch: 31 [9/500 576/32000 (2%)] Loss: 0.50060 (QuantReg: 13.64926) QuantErr: 13.64926 batch_time=0.39225 
Train Epoch: 31 [17/500 1088/32000 (3%)] Loss: 0.70802 (QuantReg: 13.24404) QuantErr: 13.24404 batch_time=0.39997 
Train Epoch: 31 [25/500 1600/32000 (5%)] Loss: 0.61802 (QuantReg: 13.27252) QuantErr: 13.27252 batch_time=0.39947 
Train Epoch: 31 [33/500 2112/32000 (7%)] Loss: 0.38856 (QuantReg: 13.76027) QuantErr: 13.76027 batch_time=0.39970 
Train Epoch: 31 [41/500 2624/32000 (8%)] Loss: 0.46714 (QuantReg: 13.84191) QuantErr: 13.84191 batch_time=0.40304 
Train Epoch: 31 [49/500 3136/32000 (10%)] Loss: 0.51871 (QuantReg: 13.49711) QuantErr: 13.49711 batch_time=0.39863 
Train Epoch: 31 [57/500 3648/32000 (11%)] Loss: 0.52679 (QuantReg: 13.84698) QuantErr: 13.84698 batch_time=0.39204 
Train Epoch: 31 [65/500 4160/32000 (13%)] Loss: 0.34075 (QuantReg: 13.41460) QuantErr: 13.41460 batch_time=0.97825 
Train Epoch: 31 [73/500 4672/32000 (15%)] Loss: 0.49664 (QuantReg: 13.62458) QuantErr: 13.62458 batch_time=0.39398 
Train Epoch: 31 [81/500 5184/32000 (16%)] Loss: 0.39320 (QuantReg: 13.93988) QuantErr: 13.93988 batch_time=0.41546 
Train Epoch: 31 [89/500 5696/32000 (18%)] Loss: 0.52858 (QuantReg: 13.33036) QuantErr: 13.33036 batch_time=0.41182 
Train Epoch: 31 [97/500 6208/32000 (19%)] Loss: 0.43470 (QuantReg: 13.72996) QuantErr: 13.72996 batch_time=0.39349 
Train Epoch: 31 [105/500 6720/32000 (21%)] Loss: 0.75007 (QuantReg: 13.01639) QuantErr: 13.01639 batch_time=0.39738 
Train Epoch: 31 [113/500 7232/32000 (23%)] Loss: 0.60999 (QuantReg: 13.53805) QuantErr: 13.53805 batch_time=0.39040 
Train Epoch: 31 [121/500 7744/32000 (24%)] Loss: 0.41880 (QuantReg: 13.66081) QuantErr: 13.66081 batch_time=0.42188 
Train Epoch: 31 [129/500 8256/32000 (26%)] Loss: 0.35523 (QuantReg: 13.84479) QuantErr: 13.84479 batch_time=0.90481 
Train Epoch: 31 [137/500 8768/32000 (27%)] Loss: 0.58487 (QuantReg: 13.72737) QuantErr: 13.72737 batch_time=0.39788 
Train Epoch: 31 [145/500 9280/32000 (29%)] Loss: 0.60442 (QuantReg: 13.43342) QuantErr: 13.43342 batch_time=0.39558 
Train Epoch: 31 [153/500 9792/32000 (31%)] Loss: 0.53825 (QuantReg: 13.36525) QuantErr: 13.36525 batch_time=0.38956 
Train Epoch: 31 [161/500 10304/32000 (32%)] Loss: 0.41691 (QuantReg: 13.95165) QuantErr: 13.95165 batch_time=0.39866 
Train Epoch: 31 [169/500 10816/32000 (34%)] Loss: 0.54069 (QuantReg: 13.79810) QuantErr: 13.79810 batch_time=0.41223 
Train Epoch: 31 [177/500 11328/32000 (35%)] Loss: 0.62634 (QuantReg: 13.30077) QuantErr: 13.30077 batch_time=0.39599 
Train Epoch: 31 [185/500 11840/32000 (37%)] Loss: 0.50728 (QuantReg: 13.48850) QuantErr: 13.48850 batch_time=0.39409 
Train Epoch: 31 [193/500 12352/32000 (39%)] Loss: 0.50527 (QuantReg: 13.62168) QuantErr: 13.62168 batch_time=0.92504 
Train Epoch: 31 [201/500 12864/32000 (40%)] Loss: 0.37523 (QuantReg: 13.50941) QuantErr: 13.50941 batch_time=0.40287 
Train Epoch: 31 [209/500 13376/32000 (42%)] Loss: 0.59507 (QuantReg: 13.51167) QuantErr: 13.51167 batch_time=0.39527 
Train Epoch: 31 [217/500 13888/32000 (43%)] Loss: 0.45535 (QuantReg: 13.51310) QuantErr: 13.51310 batch_time=0.39803 
Train Epoch: 31 [225/500 14400/32000 (45%)] Loss: 0.43339 (QuantReg: 13.62383) QuantErr: 13.62383 batch_time=0.40007 
Train Epoch: 31 [233/500 14912/32000 (47%)] Loss: 0.70187 (QuantReg: 13.38303) QuantErr: 13.38303 batch_time=0.39322 
Train Epoch: 31 [241/500 15424/32000 (48%)] Loss: 0.41186 (QuantReg: 13.56446) QuantErr: 13.56446 batch_time=0.41081 
Train Epoch: 31 [249/500 15936/32000 (50%)] Loss: 0.51130 (QuantReg: 13.72069) QuantErr: 13.72069 batch_time=0.42418 
Train Epoch: 31 [257/500 16448/32000 (51%)] Loss: 0.24854 (QuantReg: 13.44007) QuantErr: 13.44007 batch_time=0.91474 
Train Epoch: 31 [265/500 16960/32000 (53%)] Loss: 0.41958 (QuantReg: 14.04626) QuantErr: 14.04626 batch_time=0.39319 
Train Epoch: 31 [273/500 17472/32000 (55%)] Loss: 0.64334 (QuantReg: 13.17511) QuantErr: 13.17511 batch_time=0.43836 
Train Epoch: 31 [281/500 17984/32000 (56%)] Loss: 0.65650 (QuantReg: 13.23259) QuantErr: 13.23259 batch_time=0.40411 
Train Epoch: 31 [289/500 18496/32000 (58%)] Loss: 0.65402 (QuantReg: 13.80790) QuantErr: 13.80790 batch_time=0.39177 
Train Epoch: 31 [297/500 19008/32000 (59%)] Loss: 0.42315 (QuantReg: 13.79680) QuantErr: 13.79680 batch_time=0.40077 
Train Epoch: 31 [305/500 19520/32000 (61%)] Loss: 0.53538 (QuantReg: 13.60172) QuantErr: 13.60172 batch_time=0.43249 
Train Epoch: 31 [313/500 20032/32000 (63%)] Loss: 0.49834 (QuantReg: 13.57240) QuantErr: 13.57240 batch_time=0.41259 
Train Epoch: 31 [321/500 20544/32000 (64%)] Loss: 0.37482 (QuantReg: 13.87232) QuantErr: 13.87232 batch_time=0.91334 
Train Epoch: 31 [329/500 21056/32000 (66%)] Loss: 0.54947 (QuantReg: 13.42527) QuantErr: 13.42527 batch_time=0.39752 
Train Epoch: 31 [337/500 21568/32000 (67%)] Loss: 0.29010 (QuantReg: 13.51372) QuantErr: 13.51372 batch_time=0.41493 
Train Epoch: 31 [345/500 22080/32000 (69%)] Loss: 0.54029 (QuantReg: 13.43956) QuantErr: 13.43956 batch_time=0.40204 
Train Epoch: 31 [353/500 22592/32000 (71%)] Loss: 0.47662 (QuantReg: 13.59454) QuantErr: 13.59454 batch_time=0.41153 
Train Epoch: 31 [361/500 23104/32000 (72%)] Loss: 0.41183 (QuantReg: 13.53281) QuantErr: 13.53281 batch_time=0.39592 
Train Epoch: 31 [369/500 23616/32000 (74%)] Loss: 0.73041 (QuantReg: 13.52524) QuantErr: 13.52524 batch_time=0.39572 
Train Epoch: 31 [377/500 24128/32000 (75%)] Loss: 0.69381 (QuantReg: 13.66594) QuantErr: 13.66594 batch_time=0.42732 
Train Epoch: 31 [385/500 24640/32000 (77%)] Loss: 0.39647 (QuantReg: 13.65576) QuantErr: 13.65576 batch_time=0.94575 
Train Epoch: 31 [393/500 25152/32000 (79%)] Loss: 0.86721 (QuantReg: 13.54777) QuantErr: 13.54777 batch_time=0.40527 
Train Epoch: 31 [401/500 25664/32000 (80%)] Loss: 0.50771 (QuantReg: 13.93755) QuantErr: 13.93755 batch_time=0.41952 
Train Epoch: 31 [409/500 26176/32000 (82%)] Loss: 0.92194 (QuantReg: 14.03008) QuantErr: 14.03008 batch_time=0.40588 
Train Epoch: 31 [417/500 26688/32000 (83%)] Loss: 0.66725 (QuantReg: 13.73541) QuantErr: 13.73541 batch_time=0.42428 
Train Epoch: 31 [425/500 27200/32000 (85%)] Loss: 0.48033 (QuantReg: 13.64719) QuantErr: 13.64719 batch_time=0.41292 
Train Epoch: 31 [433/500 27712/32000 (87%)] Loss: 0.42634 (QuantReg: 13.45680) QuantErr: 13.45680 batch_time=0.41085 
Train Epoch: 31 [441/500 28224/32000 (88%)] Loss: 1.01031 (QuantReg: 13.76126) QuantErr: 13.76126 batch_time=0.41049 
Train Epoch: 31 [449/500 28736/32000 (90%)] Loss: 0.77875 (QuantReg: 13.89980) QuantErr: 13.89980 batch_time=0.94183 
Train Epoch: 31 [457/500 29248/32000 (91%)] Loss: 0.75631 (QuantReg: 13.66078) QuantErr: 13.66078 batch_time=0.40487 
Train Epoch: 31 [465/500 29760/32000 (93%)] Loss: 0.73885 (QuantReg: 13.89958) QuantErr: 13.89958 batch_time=0.40026 
Train Epoch: 31 [473/500 30272/32000 (95%)] Loss: 0.66631 (QuantReg: 13.59268) QuantErr: 13.59268 batch_time=0.41125 
Train Epoch: 31 [481/500 30784/32000 (96%)] Loss: 0.76981 (QuantReg: 13.90690) QuantErr: 13.90690 batch_time=0.40281 
Train Epoch: 31 [489/500 31296/32000 (98%)] Loss: 0.67657 (QuantReg: 13.38195) QuantErr: 13.38195 batch_time=0.39509 
Train Epoch: 31 [497/500 31808/32000 (99%)] Loss: 0.65510 (QuantReg: 13.57611) QuantErr: 13.57611 batch_time=0.40569 
Train Epoch: 31 codebook_update_time=2.11884
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch31.pth ...
Done in 4.545s
removing stale ckpt [epoch 30] [took 0.00s]
 epoch          : 31
 loss           : 0.5398596844673157
 quant_reg      : 13.598395374298097
 quant_err      : 13.598395374298097
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 15500
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.577464788732394
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.82357269117776
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.110663983903421
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.65538212173379
 MSRVTT_full_test/t2v_metrics/R1: 13.110367892976589
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 51.53846153846154
 MSRVTT_full_test/t2v_metrics/R50: 80.70234113712375
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.679264214046825
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.38675500752368
 MSRVTT_full_test/v2t_metrics/R1: 16.220735785953178
 MSRVTT_full_test/v2t_metrics/R5: 43.779264214046826
 MSRVTT_full_test/v2t_metrics/R10: 58.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 87.55852842809365
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.27190635451505
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.71168734655388
 mnt_best       : 29.784041448589548
 not_improved_count: 2
Train Epoch: 32 [1/500 64/32000 (0%)] Loss: 0.29148 (QuantReg: 13.92421) QuantErr: 13.92421 batch_time=31.71895 
Train Epoch: 32 [9/500 576/32000 (2%)] Loss: 0.81581 (QuantReg: 13.69096) QuantErr: 13.69096 batch_time=0.38971 
Train Epoch: 32 [17/500 1088/32000 (3%)] Loss: 0.78637 (QuantReg: 13.76354) QuantErr: 13.76354 batch_time=0.40902 
Train Epoch: 32 [25/500 1600/32000 (5%)] Loss: 0.40054 (QuantReg: 14.06995) QuantErr: 14.06995 batch_time=0.41006 
Train Epoch: 32 [33/500 2112/32000 (7%)] Loss: 0.45593 (QuantReg: 13.80185) QuantErr: 13.80185 batch_time=1.66355 
Train Epoch: 32 [41/500 2624/32000 (8%)] Loss: 0.63533 (QuantReg: 13.93987) QuantErr: 13.93987 batch_time=0.45498 
Train Epoch: 32 [49/500 3136/32000 (10%)] Loss: 0.72726 (QuantReg: 13.47888) QuantErr: 13.47888 batch_time=0.39430 
Train Epoch: 32 [57/500 3648/32000 (11%)] Loss: 1.00991 (QuantReg: 13.99201) QuantErr: 13.99201 batch_time=0.39845 
Train Epoch: 32 [65/500 4160/32000 (13%)] Loss: 0.42129 (QuantReg: 13.35832) QuantErr: 13.35832 batch_time=0.39614 
Train Epoch: 32 [73/500 4672/32000 (15%)] Loss: 0.52848 (QuantReg: 13.53862) QuantErr: 13.53862 batch_time=0.39463 
Train Epoch: 32 [81/500 5184/32000 (16%)] Loss: 0.50823 (QuantReg: 13.77430) QuantErr: 13.77430 batch_time=0.40167 
Train Epoch: 32 [89/500 5696/32000 (18%)] Loss: 0.53280 (QuantReg: 13.96206) QuantErr: 13.96206 batch_time=0.40417 
Train Epoch: 32 [97/500 6208/32000 (19%)] Loss: 0.57559 (QuantReg: 13.52284) QuantErr: 13.52284 batch_time=1.35396 
Train Epoch: 32 [105/500 6720/32000 (21%)] Loss: 0.64676 (QuantReg: 13.80605) QuantErr: 13.80605 batch_time=0.39818 
Train Epoch: 32 [113/500 7232/32000 (23%)] Loss: 0.34279 (QuantReg: 14.05658) QuantErr: 14.05658 batch_time=0.40570 
Train Epoch: 32 [121/500 7744/32000 (24%)] Loss: 0.41082 (QuantReg: 13.47708) QuantErr: 13.47708 batch_time=0.39255 
Train Epoch: 32 [129/500 8256/32000 (26%)] Loss: 0.46004 (QuantReg: 13.78584) QuantErr: 13.78584 batch_time=0.38600 
Train Epoch: 32 [137/500 8768/32000 (27%)] Loss: 0.46175 (QuantReg: 13.58018) QuantErr: 13.58018 batch_time=0.38832 
Train Epoch: 32 [145/500 9280/32000 (29%)] Loss: 0.74349 (QuantReg: 13.74961) QuantErr: 13.74961 batch_time=0.41642 
Train Epoch: 32 [153/500 9792/32000 (31%)] Loss: 0.37785 (QuantReg: 13.78439) QuantErr: 13.78439 batch_time=0.39963 
Train Epoch: 32 [161/500 10304/32000 (32%)] Loss: 0.54775 (QuantReg: 13.73215) QuantErr: 13.73215 batch_time=1.31582 
Train Epoch: 32 [169/500 10816/32000 (34%)] Loss: 0.55427 (QuantReg: 14.00705) QuantErr: 14.00705 batch_time=0.39330 
Train Epoch: 32 [177/500 11328/32000 (35%)] Loss: 0.53685 (QuantReg: 13.65765) QuantErr: 13.65765 batch_time=0.39434 
Train Epoch: 32 [185/500 11840/32000 (37%)] Loss: 0.30436 (QuantReg: 13.91052) QuantErr: 13.91052 batch_time=0.45058 
Train Epoch: 32 [193/500 12352/32000 (39%)] Loss: 0.65452 (QuantReg: 13.29628) QuantErr: 13.29628 batch_time=0.40248 
Train Epoch: 32 [201/500 12864/32000 (40%)] Loss: 0.53059 (QuantReg: 13.50297) QuantErr: 13.50297 batch_time=0.41911 
Train Epoch: 32 [209/500 13376/32000 (42%)] Loss: 0.96420 (QuantReg: 13.81923) QuantErr: 13.81923 batch_time=0.40083 
Train Epoch: 32 [217/500 13888/32000 (43%)] Loss: 0.46250 (QuantReg: 13.28589) QuantErr: 13.28589 batch_time=0.43023 
Train Epoch: 32 [225/500 14400/32000 (45%)] Loss: 0.53619 (QuantReg: 13.35699) QuantErr: 13.35699 batch_time=1.37145 
Train Epoch: 32 [233/500 14912/32000 (47%)] Loss: 0.49175 (QuantReg: 13.97325) QuantErr: 13.97325 batch_time=0.40418 
Train Epoch: 32 [241/500 15424/32000 (48%)] Loss: 0.40676 (QuantReg: 13.72568) QuantErr: 13.72568 batch_time=0.39225 
Train Epoch: 32 [249/500 15936/32000 (50%)] Loss: 0.70347 (QuantReg: 13.37548) QuantErr: 13.37548 batch_time=0.39661 
Train Epoch: 32 [257/500 16448/32000 (51%)] Loss: 0.48978 (QuantReg: 13.88610) QuantErr: 13.88610 batch_time=0.39207 
Train Epoch: 32 [265/500 16960/32000 (53%)] Loss: 0.50615 (QuantReg: 13.43323) QuantErr: 13.43323 batch_time=0.39203 
Train Epoch: 32 [273/500 17472/32000 (55%)] Loss: 0.60153 (QuantReg: 13.66573) QuantErr: 13.66573 batch_time=0.39531 
Train Epoch: 32 [281/500 17984/32000 (56%)] Loss: 0.65663 (QuantReg: 13.55648) QuantErr: 13.55648 batch_time=0.40618 
Train Epoch: 32 [289/500 18496/32000 (58%)] Loss: 0.59293 (QuantReg: 13.67926) QuantErr: 13.67926 batch_time=1.35101 
Train Epoch: 32 [297/500 19008/32000 (59%)] Loss: 0.50322 (QuantReg: 13.84983) QuantErr: 13.84983 batch_time=0.39475 
Train Epoch: 32 [305/500 19520/32000 (61%)] Loss: 0.41769 (QuantReg: 13.50708) QuantErr: 13.50708 batch_time=0.41246 
Train Epoch: 32 [313/500 20032/32000 (63%)] Loss: 0.53717 (QuantReg: 13.21717) QuantErr: 13.21717 batch_time=0.43836 
Train Epoch: 32 [321/500 20544/32000 (64%)] Loss: 0.48037 (QuantReg: 13.41448) QuantErr: 13.41448 batch_time=0.40104 
Train Epoch: 32 [329/500 21056/32000 (66%)] Loss: 0.42053 (QuantReg: 13.97781) QuantErr: 13.97781 batch_time=0.40336 
Train Epoch: 32 [337/500 21568/32000 (67%)] Loss: 0.55707 (QuantReg: 13.73794) QuantErr: 13.73794 batch_time=0.43286 
Train Epoch: 32 [345/500 22080/32000 (69%)] Loss: 0.26838 (QuantReg: 13.40277) QuantErr: 13.40277 batch_time=0.39692 
Train Epoch: 32 [353/500 22592/32000 (71%)] Loss: 0.40650 (QuantReg: 13.96464) QuantErr: 13.96464 batch_time=1.31120 
Train Epoch: 32 [361/500 23104/32000 (72%)] Loss: 0.59439 (QuantReg: 13.66587) QuantErr: 13.66587 batch_time=0.42222 
Train Epoch: 32 [369/500 23616/32000 (74%)] Loss: 0.33534 (QuantReg: 14.25533) QuantErr: 14.25533 batch_time=0.40283 
Train Epoch: 32 [377/500 24128/32000 (75%)] Loss: 0.49093 (QuantReg: 13.53133) QuantErr: 13.53133 batch_time=0.40485 
Train Epoch: 32 [385/500 24640/32000 (77%)] Loss: 0.55228 (QuantReg: 13.84661) QuantErr: 13.84661 batch_time=0.40887 
Train Epoch: 32 [393/500 25152/32000 (79%)] Loss: 0.56959 (QuantReg: 13.81870) QuantErr: 13.81870 batch_time=0.45293 
Train Epoch: 32 [401/500 25664/32000 (80%)] Loss: 0.38581 (QuantReg: 13.71096) QuantErr: 13.71096 batch_time=0.44501 
Train Epoch: 32 [409/500 26176/32000 (82%)] Loss: 0.47734 (QuantReg: 13.73330) QuantErr: 13.73330 batch_time=0.40091 
Train Epoch: 32 [417/500 26688/32000 (83%)] Loss: 0.48483 (QuantReg: 13.47266) QuantErr: 13.47266 batch_time=1.32659 
Train Epoch: 32 [425/500 27200/32000 (85%)] Loss: 0.68515 (QuantReg: 14.03849) QuantErr: 14.03849 batch_time=0.40473 
Train Epoch: 32 [433/500 27712/32000 (87%)] Loss: 0.65204 (QuantReg: 13.89461) QuantErr: 13.89461 batch_time=0.40066 
Train Epoch: 32 [441/500 28224/32000 (88%)] Loss: 0.55713 (QuantReg: 13.73143) QuantErr: 13.73143 batch_time=0.41990 
Train Epoch: 32 [449/500 28736/32000 (90%)] Loss: 0.63164 (QuantReg: 13.72171) QuantErr: 13.72171 batch_time=0.44029 
Train Epoch: 32 [457/500 29248/32000 (91%)] Loss: 0.64387 (QuantReg: 13.23438) QuantErr: 13.23438 batch_time=0.40449 
Train Epoch: 32 [465/500 29760/32000 (93%)] Loss: 0.71628 (QuantReg: 12.96072) QuantErr: 12.96072 batch_time=0.44633 
Train Epoch: 32 [473/500 30272/32000 (95%)] Loss: 0.62927 (QuantReg: 13.61166) QuantErr: 13.61166 batch_time=0.40519 
Train Epoch: 32 [481/500 30784/32000 (96%)] Loss: 0.38132 (QuantReg: 13.81163) QuantErr: 13.81163 batch_time=1.33629 
Train Epoch: 32 [489/500 31296/32000 (98%)] Loss: 0.67275 (QuantReg: 13.55950) QuantErr: 13.55950 batch_time=0.40326 
Train Epoch: 32 [497/500 31808/32000 (99%)] Loss: 0.53079 (QuantReg: 13.27275) QuantErr: 13.27275 batch_time=0.39446 
Train Epoch: 32 codebook_update_time=2.09032
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch32.pth ...
Done in 10.673s
removing stale ckpt [epoch 31] [took 0.08s]
 epoch          : 32
 loss           : 0.5322939383685589
 quant_reg      : 13.681003347396851
 quant_err      : 13.681003347396851
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 16000
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.539235412474849
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.64741873098531
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.002012072434607
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.619466639325864
 MSRVTT_full_test/t2v_metrics/R1: 12.775919732441471
 MSRVTT_full_test/t2v_metrics/R5: 36.55518394648829
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 80.23411371237458
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.13779264214047
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.804065969106823
 MSRVTT_full_test/v2t_metrics/R1: 15.585284280936454
 MSRVTT_full_test/v2t_metrics/R5: 43.34448160535117
 MSRVTT_full_test/v2t_metrics/R10: 59.163879598662206
 MSRVTT_full_test/v2t_metrics/R50: 87.02341137123746
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.12809364548495
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.19020688493248
 mnt_best       : 29.784041448589548
 not_improved_count: 3
Train Epoch: 33 [1/500 64/32000 (0%)] Loss: 0.34751 (QuantReg: 13.90504) QuantErr: 13.90504 batch_time=30.40809 
Train Epoch: 33 [9/500 576/32000 (2%)] Loss: 0.57492 (QuantReg: 13.75908) QuantErr: 13.75908 batch_time=0.56384 
Train Epoch: 33 [17/500 1088/32000 (3%)] Loss: 0.51334 (QuantReg: 13.51435) QuantErr: 13.51435 batch_time=0.51155 
Train Epoch: 33 [25/500 1600/32000 (5%)] Loss: 0.52134 (QuantReg: 13.44943) QuantErr: 13.44943 batch_time=0.39192 
Train Epoch: 33 [33/500 2112/32000 (7%)] Loss: 0.59294 (QuantReg: 13.60075) QuantErr: 13.60075 batch_time=0.43472 
Train Epoch: 33 [41/500 2624/32000 (8%)] Loss: 0.67550 (QuantReg: 13.51529) QuantErr: 13.51529 batch_time=0.41544 
Train Epoch: 33 [49/500 3136/32000 (10%)] Loss: 0.51057 (QuantReg: 13.68138) QuantErr: 13.68138 batch_time=0.40058 
Train Epoch: 33 [57/500 3648/32000 (11%)] Loss: 0.77126 (QuantReg: 13.17596) QuantErr: 13.17596 batch_time=0.38995 
Train Epoch: 33 [65/500 4160/32000 (13%)] Loss: 0.37614 (QuantReg: 14.13592) QuantErr: 14.13592 batch_time=0.39505 
Train Epoch: 33 [73/500 4672/32000 (15%)] Loss: 0.74127 (QuantReg: 13.88145) QuantErr: 13.88145 batch_time=0.50283 
Train Epoch: 33 [81/500 5184/32000 (16%)] Loss: 0.41781 (QuantReg: 13.76767) QuantErr: 13.76767 batch_time=0.50700 
Train Epoch: 33 [89/500 5696/32000 (18%)] Loss: 0.45337 (QuantReg: 13.90867) QuantErr: 13.90867 batch_time=0.39674 
Train Epoch: 33 [97/500 6208/32000 (19%)] Loss: 0.48982 (QuantReg: 13.48485) QuantErr: 13.48485 batch_time=0.39067 
Train Epoch: 33 [105/500 6720/32000 (21%)] Loss: 0.48239 (QuantReg: 13.64934) QuantErr: 13.64934 batch_time=0.40761 
Train Epoch: 33 [113/500 7232/32000 (23%)] Loss: 0.34035 (QuantReg: 13.62518) QuantErr: 13.62518 batch_time=0.43256 
Train Epoch: 33 [121/500 7744/32000 (24%)] Loss: 0.48626 (QuantReg: 13.64553) QuantErr: 13.64553 batch_time=0.41155 
Train Epoch: 33 [129/500 8256/32000 (26%)] Loss: 0.58305 (QuantReg: 13.79151) QuantErr: 13.79151 batch_time=0.43921 
Train Epoch: 33 [137/500 8768/32000 (27%)] Loss: 0.47671 (QuantReg: 13.66545) QuantErr: 13.66545 batch_time=0.52661 
Train Epoch: 33 [145/500 9280/32000 (29%)] Loss: 0.51512 (QuantReg: 13.43591) QuantErr: 13.43591 batch_time=0.53548 
Train Epoch: 33 [153/500 9792/32000 (31%)] Loss: 0.53798 (QuantReg: 13.62387) QuantErr: 13.62387 batch_time=0.40510 
Train Epoch: 33 [161/500 10304/32000 (32%)] Loss: 0.72660 (QuantReg: 13.28142) QuantErr: 13.28142 batch_time=0.40521 
Train Epoch: 33 [169/500 10816/32000 (34%)] Loss: 0.53220 (QuantReg: 13.32024) QuantErr: 13.32024 batch_time=0.38564 
Train Epoch: 33 [177/500 11328/32000 (35%)] Loss: 0.35096 (QuantReg: 13.54856) QuantErr: 13.54856 batch_time=0.38510 
Train Epoch: 33 [185/500 11840/32000 (37%)] Loss: 0.57996 (QuantReg: 14.14793) QuantErr: 14.14793 batch_time=0.39238 
Train Epoch: 33 [193/500 12352/32000 (39%)] Loss: 0.70765 (QuantReg: 13.31240) QuantErr: 13.31240 batch_time=0.39869 
Train Epoch: 33 [201/500 12864/32000 (40%)] Loss: 0.36795 (QuantReg: 13.57272) QuantErr: 13.57272 batch_time=0.51396 
Train Epoch: 33 [209/500 13376/32000 (42%)] Loss: 0.55496 (QuantReg: 14.05207) QuantErr: 14.05207 batch_time=0.50410 
Train Epoch: 33 [217/500 13888/32000 (43%)] Loss: 0.41782 (QuantReg: 13.62162) QuantErr: 13.62162 batch_time=0.39051 
Train Epoch: 33 [225/500 14400/32000 (45%)] Loss: 0.63163 (QuantReg: 13.30268) QuantErr: 13.30268 batch_time=0.38590 
Train Epoch: 33 [233/500 14912/32000 (47%)] Loss: 0.72515 (QuantReg: 13.24946) QuantErr: 13.24946 batch_time=0.38885 
Train Epoch: 33 [241/500 15424/32000 (48%)] Loss: 0.37574 (QuantReg: 13.73314) QuantErr: 13.73314 batch_time=0.40604 
Train Epoch: 33 [249/500 15936/32000 (50%)] Loss: 0.41465 (QuantReg: 13.57297) QuantErr: 13.57297 batch_time=0.39468 
Train Epoch: 33 [257/500 16448/32000 (51%)] Loss: 1.07292 (QuantReg: 12.96206) QuantErr: 12.96206 batch_time=0.38630 
Train Epoch: 33 [265/500 16960/32000 (53%)] Loss: 0.65994 (QuantReg: 13.89656) QuantErr: 13.89656 batch_time=0.49524 
Train Epoch: 33 [273/500 17472/32000 (55%)] Loss: 0.28727 (QuantReg: 14.03859) QuantErr: 14.03859 batch_time=0.50167 
Train Epoch: 33 [281/500 17984/32000 (56%)] Loss: 0.74322 (QuantReg: 13.32121) QuantErr: 13.32121 batch_time=0.39013 
Train Epoch: 33 [289/500 18496/32000 (58%)] Loss: 0.71083 (QuantReg: 13.44289) QuantErr: 13.44289 batch_time=0.39964 
Train Epoch: 33 [297/500 19008/32000 (59%)] Loss: 0.46547 (QuantReg: 13.45681) QuantErr: 13.45681 batch_time=0.41798 
Train Epoch: 33 [305/500 19520/32000 (61%)] Loss: 0.92381 (QuantReg: 13.58978) QuantErr: 13.58978 batch_time=0.40372 
Train Epoch: 33 [313/500 20032/32000 (63%)] Loss: 0.56498 (QuantReg: 13.59225) QuantErr: 13.59225 batch_time=0.42350 
Train Epoch: 33 [321/500 20544/32000 (64%)] Loss: 0.23613 (QuantReg: 13.49257) QuantErr: 13.49257 batch_time=0.40673 
Train Epoch: 33 [329/500 21056/32000 (66%)] Loss: 0.36332 (QuantReg: 14.34014) QuantErr: 14.34014 batch_time=0.52618 
Train Epoch: 33 [337/500 21568/32000 (67%)] Loss: 0.26725 (QuantReg: 13.71003) QuantErr: 13.71003 batch_time=0.53304 
Train Epoch: 33 [345/500 22080/32000 (69%)] Loss: 0.50430 (QuantReg: 13.81762) QuantErr: 13.81762 batch_time=0.39316 
Train Epoch: 33 [353/500 22592/32000 (71%)] Loss: 0.36167 (QuantReg: 13.57128) QuantErr: 13.57128 batch_time=0.39756 
Train Epoch: 33 [361/500 23104/32000 (72%)] Loss: 0.44077 (QuantReg: 13.72997) QuantErr: 13.72997 batch_time=0.41504 
Train Epoch: 33 [369/500 23616/32000 (74%)] Loss: 0.43395 (QuantReg: 13.60704) QuantErr: 13.60704 batch_time=0.46589 
Train Epoch: 33 [377/500 24128/32000 (75%)] Loss: 0.48204 (QuantReg: 13.96270) QuantErr: 13.96270 batch_time=0.44313 
Train Epoch: 33 [385/500 24640/32000 (77%)] Loss: 0.40869 (QuantReg: 13.91122) QuantErr: 13.91122 batch_time=0.39280 
Train Epoch: 33 [393/500 25152/32000 (79%)] Loss: 0.69866 (QuantReg: 13.82649) QuantErr: 13.82649 batch_time=0.50995 
Train Epoch: 33 [401/500 25664/32000 (80%)] Loss: 0.28618 (QuantReg: 14.02134) QuantErr: 14.02134 batch_time=0.56198 
Train Epoch: 33 [409/500 26176/32000 (82%)] Loss: 0.66447 (QuantReg: 13.06403) QuantErr: 13.06403 batch_time=0.39495 
Train Epoch: 33 [417/500 26688/32000 (83%)] Loss: 0.53466 (QuantReg: 13.69158) QuantErr: 13.69158 batch_time=0.38031 
Train Epoch: 33 [425/500 27200/32000 (85%)] Loss: 0.31690 (QuantReg: 13.95129) QuantErr: 13.95129 batch_time=0.39008 
Train Epoch: 33 [433/500 27712/32000 (87%)] Loss: 0.88201 (QuantReg: 13.96674) QuantErr: 13.96674 batch_time=0.39921 
Train Epoch: 33 [441/500 28224/32000 (88%)] Loss: 0.50716 (QuantReg: 13.36501) QuantErr: 13.36501 batch_time=0.39453 
Train Epoch: 33 [449/500 28736/32000 (90%)] Loss: 0.57081 (QuantReg: 13.30927) QuantErr: 13.30927 batch_time=0.41704 
Train Epoch: 33 [457/500 29248/32000 (91%)] Loss: 0.59849 (QuantReg: 13.66633) QuantErr: 13.66633 batch_time=0.43228 
Train Epoch: 33 [465/500 29760/32000 (93%)] Loss: 0.68439 (QuantReg: 13.71187) QuantErr: 13.71187 batch_time=0.41245 
Train Epoch: 33 [473/500 30272/32000 (95%)] Loss: 0.53830 (QuantReg: 13.94127) QuantErr: 13.94127 batch_time=0.39625 
Train Epoch: 33 [481/500 30784/32000 (96%)] Loss: 0.72919 (QuantReg: 13.82935) QuantErr: 13.82935 batch_time=0.41126 
Train Epoch: 33 [489/500 31296/32000 (98%)] Loss: 0.43383 (QuantReg: 13.95000) QuantErr: 13.95000 batch_time=0.38874 
Train Epoch: 33 [497/500 31808/32000 (99%)] Loss: 0.66169 (QuantReg: 13.80073) QuantErr: 13.80073 batch_time=0.44187 
Train Epoch: 33 codebook_update_time=1.80597
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch33.pth ...
Done in 4.139s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch33.pth ...
Done in 8.035s
removing stale ckpt [epoch 32] [took 0.00s]
 epoch          : 33
 loss           : 0.5089046366512775
 quant_reg      : 13.659986112594604
 quant_err      : 13.659986112594604
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 16500
 MSRVTT_full_val/t2v_metrics/R1: 31.58953722334004
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.329979879275655
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.0434610932603
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.847082494969819
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.46413530990209
 MSRVTT_full_test/t2v_metrics/R1: 13.645484949832776
 MSRVTT_full_test/t2v_metrics/R5: 38.12709030100334
 MSRVTT_full_test/t2v_metrics/R10: 51.87290969899666
 MSRVTT_full_test/t2v_metrics/R50: 81.77257525083613
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.6685618729097
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.995383283199537
 MSRVTT_full_test/v2t_metrics/R1: 16.287625418060202
 MSRVTT_full_test/v2t_metrics/R5: 44.046822742474916
 MSRVTT_full_test/v2t_metrics/R10: 59.76588628762542
 MSRVTT_full_test/v2t_metrics/R50: 87.82608695652173
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.806020066889634
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.00058000528902
 mnt_best       : 29.995383283199537
 not_improved_count: 0
Train Epoch: 34 [1/500 64/32000 (0%)] Loss: 0.45877 (QuantReg: 14.16117) QuantErr: 14.16117 batch_time=31.47000 
Train Epoch: 34 [9/500 576/32000 (2%)] Loss: 0.51281 (QuantReg: 13.54869) QuantErr: 13.54869 batch_time=0.39247 
Train Epoch: 34 [17/500 1088/32000 (3%)] Loss: 0.57521 (QuantReg: 13.46155) QuantErr: 13.46155 batch_time=0.38462 
Train Epoch: 34 [25/500 1600/32000 (5%)] Loss: 0.47796 (QuantReg: 13.55456) QuantErr: 13.55456 batch_time=0.72280 
Train Epoch: 34 [33/500 2112/32000 (7%)] Loss: 0.39126 (QuantReg: 13.37370) QuantErr: 13.37370 batch_time=0.40128 
Train Epoch: 34 [41/500 2624/32000 (8%)] Loss: 0.69320 (QuantReg: 13.74287) QuantErr: 13.74287 batch_time=0.40622 
Train Epoch: 34 [49/500 3136/32000 (10%)] Loss: 0.33617 (QuantReg: 13.74063) QuantErr: 13.74063 batch_time=0.40441 
Train Epoch: 34 [57/500 3648/32000 (11%)] Loss: 0.51547 (QuantReg: 13.21835) QuantErr: 13.21835 batch_time=0.39516 
Train Epoch: 34 [65/500 4160/32000 (13%)] Loss: 0.60401 (QuantReg: 13.63342) QuantErr: 13.63342 batch_time=0.45729 
Train Epoch: 34 [73/500 4672/32000 (15%)] Loss: 0.25381 (QuantReg: 13.75658) QuantErr: 13.75658 batch_time=0.39701 
Train Epoch: 34 [81/500 5184/32000 (16%)] Loss: 0.37464 (QuantReg: 13.98503) QuantErr: 13.98503 batch_time=0.39257 
Train Epoch: 34 [89/500 5696/32000 (18%)] Loss: 0.60329 (QuantReg: 13.64465) QuantErr: 13.64465 batch_time=0.64273 
Train Epoch: 34 [97/500 6208/32000 (19%)] Loss: 0.50653 (QuantReg: 13.19865) QuantErr: 13.19865 batch_time=0.40489 
Train Epoch: 34 [105/500 6720/32000 (21%)] Loss: 0.46615 (QuantReg: 13.46301) QuantErr: 13.46301 batch_time=0.41856 
Train Epoch: 34 [113/500 7232/32000 (23%)] Loss: 0.98708 (QuantReg: 13.11226) QuantErr: 13.11226 batch_time=0.39116 
Train Epoch: 34 [121/500 7744/32000 (24%)] Loss: 0.26464 (QuantReg: 13.82547) QuantErr: 13.82547 batch_time=0.39866 
Train Epoch: 34 [129/500 8256/32000 (26%)] Loss: 0.69779 (QuantReg: 13.86193) QuantErr: 13.86193 batch_time=0.45149 
Train Epoch: 34 [137/500 8768/32000 (27%)] Loss: 0.59660 (QuantReg: 14.21861) QuantErr: 14.21861 batch_time=0.39071 
Train Epoch: 34 [145/500 9280/32000 (29%)] Loss: 0.58136 (QuantReg: 13.82077) QuantErr: 13.82077 batch_time=0.39311 
Train Epoch: 34 [153/500 9792/32000 (31%)] Loss: 0.32773 (QuantReg: 13.41708) QuantErr: 13.41708 batch_time=0.69290 
Train Epoch: 34 [161/500 10304/32000 (32%)] Loss: 0.32969 (QuantReg: 14.06914) QuantErr: 14.06914 batch_time=0.39220 
Train Epoch: 34 [169/500 10816/32000 (34%)] Loss: 0.76128 (QuantReg: 13.56937) QuantErr: 13.56937 batch_time=0.40883 
Train Epoch: 34 [177/500 11328/32000 (35%)] Loss: 0.47581 (QuantReg: 13.62697) QuantErr: 13.62697 batch_time=0.39848 
Train Epoch: 34 [185/500 11840/32000 (37%)] Loss: 0.57452 (QuantReg: 14.00477) QuantErr: 14.00477 batch_time=0.40044 
Train Epoch: 34 [193/500 12352/32000 (39%)] Loss: 0.49976 (QuantReg: 13.90109) QuantErr: 13.90109 batch_time=0.45820 
Train Epoch: 34 [201/500 12864/32000 (40%)] Loss: 0.54525 (QuantReg: 13.56305) QuantErr: 13.56305 batch_time=0.41430 
Train Epoch: 34 [209/500 13376/32000 (42%)] Loss: 0.33764 (QuantReg: 13.55394) QuantErr: 13.55394 batch_time=0.39975 
Train Epoch: 34 [217/500 13888/32000 (43%)] Loss: 0.72852 (QuantReg: 13.76849) QuantErr: 13.76849 batch_time=0.71343 
Train Epoch: 34 [225/500 14400/32000 (45%)] Loss: 0.21047 (QuantReg: 13.52565) QuantErr: 13.52565 batch_time=0.39187 
Train Epoch: 34 [233/500 14912/32000 (47%)] Loss: 0.44914 (QuantReg: 13.92476) QuantErr: 13.92476 batch_time=0.43772 
Train Epoch: 34 [241/500 15424/32000 (48%)] Loss: 0.43293 (QuantReg: 13.64448) QuantErr: 13.64448 batch_time=0.43734 
Train Epoch: 34 [249/500 15936/32000 (50%)] Loss: 0.27408 (QuantReg: 13.92191) QuantErr: 13.92191 batch_time=0.40261 
Train Epoch: 34 [257/500 16448/32000 (51%)] Loss: 0.74340 (QuantReg: 13.25272) QuantErr: 13.25272 batch_time=0.46985 
Train Epoch: 34 [265/500 16960/32000 (53%)] Loss: 0.81010 (QuantReg: 13.91480) QuantErr: 13.91480 batch_time=0.39635 
Train Epoch: 34 [273/500 17472/32000 (55%)] Loss: 0.47699 (QuantReg: 13.65273) QuantErr: 13.65273 batch_time=0.39838 
Train Epoch: 34 [281/500 17984/32000 (56%)] Loss: 0.49670 (QuantReg: 13.64940) QuantErr: 13.64940 batch_time=0.64658 
Train Epoch: 34 [289/500 18496/32000 (58%)] Loss: 0.38086 (QuantReg: 13.75509) QuantErr: 13.75509 batch_time=0.39544 
Train Epoch: 34 [297/500 19008/32000 (59%)] Loss: 0.31666 (QuantReg: 13.88463) QuantErr: 13.88463 batch_time=0.38823 
Train Epoch: 34 [305/500 19520/32000 (61%)] Loss: 0.25167 (QuantReg: 14.01777) QuantErr: 14.01777 batch_time=0.42840 
Train Epoch: 34 [313/500 20032/32000 (63%)] Loss: 0.45004 (QuantReg: 14.04540) QuantErr: 14.04540 batch_time=0.39820 
Train Epoch: 34 [321/500 20544/32000 (64%)] Loss: 0.43389 (QuantReg: 13.41215) QuantErr: 13.41215 batch_time=0.45052 
Train Epoch: 34 [329/500 21056/32000 (66%)] Loss: 0.35208 (QuantReg: 13.57316) QuantErr: 13.57316 batch_time=0.39259 
Train Epoch: 34 [337/500 21568/32000 (67%)] Loss: 0.33712 (QuantReg: 13.79308) QuantErr: 13.79308 batch_time=0.43722 
Train Epoch: 34 [345/500 22080/32000 (69%)] Loss: 0.39861 (QuantReg: 13.83755) QuantErr: 13.83755 batch_time=0.39499 
Train Epoch: 34 [353/500 22592/32000 (71%)] Loss: 0.48048 (QuantReg: 13.74596) QuantErr: 13.74596 batch_time=0.39723 
Train Epoch: 34 [361/500 23104/32000 (72%)] Loss: 0.50836 (QuantReg: 13.69261) QuantErr: 13.69261 batch_time=0.39629 
Train Epoch: 34 [369/500 23616/32000 (74%)] Loss: 0.46576 (QuantReg: 13.61979) QuantErr: 13.61979 batch_time=0.40107 
Train Epoch: 34 [377/500 24128/32000 (75%)] Loss: 0.52766 (QuantReg: 13.93525) QuantErr: 13.93525 batch_time=0.39437 
Train Epoch: 34 [385/500 24640/32000 (77%)] Loss: 0.39070 (QuantReg: 13.94446) QuantErr: 13.94446 batch_time=0.47178 
Train Epoch: 34 [393/500 25152/32000 (79%)] Loss: 0.58252 (QuantReg: 13.64778) QuantErr: 13.64778 batch_time=0.37794 
Train Epoch: 34 [401/500 25664/32000 (80%)] Loss: 0.56339 (QuantReg: 13.80869) QuantErr: 13.80869 batch_time=0.39133 
Train Epoch: 34 [409/500 26176/32000 (82%)] Loss: 0.70734 (QuantReg: 13.49511) QuantErr: 13.49511 batch_time=0.39891 
Train Epoch: 34 [417/500 26688/32000 (83%)] Loss: 0.76078 (QuantReg: 13.66642) QuantErr: 13.66642 batch_time=0.41171 
Train Epoch: 34 [425/500 27200/32000 (85%)] Loss: 0.43298 (QuantReg: 13.08949) QuantErr: 13.08949 batch_time=0.38860 
Train Epoch: 34 [433/500 27712/32000 (87%)] Loss: 0.54094 (QuantReg: 13.34178) QuantErr: 13.34178 batch_time=0.40214 
Train Epoch: 34 [441/500 28224/32000 (88%)] Loss: 0.56479 (QuantReg: 13.74573) QuantErr: 13.74573 batch_time=0.39662 
Train Epoch: 34 [449/500 28736/32000 (90%)] Loss: 0.40198 (QuantReg: 13.03465) QuantErr: 13.03465 batch_time=0.46086 
Train Epoch: 34 [457/500 29248/32000 (91%)] Loss: 0.44980 (QuantReg: 13.75137) QuantErr: 13.75137 batch_time=0.38953 
Train Epoch: 34 [465/500 29760/32000 (93%)] Loss: 0.57803 (QuantReg: 13.62534) QuantErr: 13.62534 batch_time=0.42004 
Train Epoch: 34 [473/500 30272/32000 (95%)] Loss: 0.36908 (QuantReg: 14.00554) QuantErr: 14.00554 batch_time=0.39333 
Train Epoch: 34 [481/500 30784/32000 (96%)] Loss: 0.46084 (QuantReg: 13.88108) QuantErr: 13.88108 batch_time=0.40325 
Train Epoch: 34 [489/500 31296/32000 (98%)] Loss: 0.31786 (QuantReg: 14.00481) QuantErr: 14.00481 batch_time=0.45296 
Train Epoch: 34 [497/500 31808/32000 (99%)] Loss: 0.35400 (QuantReg: 14.07209) QuantErr: 14.07209 batch_time=0.46032 
Train Epoch: 34 codebook_update_time=2.19834
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch34.pth ...
Done in 4.436s
removing stale ckpt [epoch 33] [took 0.01s]
 epoch          : 34
 loss           : 0.5155437929034233
 quant_reg      : 13.689099439620971
 quant_err      : 13.689099439620971
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 17000
 MSRVTT_full_val/t2v_metrics/R1: 33.601609657947684
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.22334004024145
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.456982824778784
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.941649899396379
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.25935693686343
 MSRVTT_full_test/t2v_metrics/R1: 13.411371237458194
 MSRVTT_full_test/t2v_metrics/R5: 37.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 52.675585284280935
 MSRVTT_full_test/t2v_metrics/R50: 82.77591973244147
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.02876254180602
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.817283476507086
 MSRVTT_full_test/v2t_metrics/R1: 16.321070234113712
 MSRVTT_full_test/v2t_metrics/R5: 44.94983277591973
 MSRVTT_full_test/v2t_metrics/R10: 59.531772575250834
 MSRVTT_full_test/v2t_metrics/R50: 87.45819397993311
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.572240802675584
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.21614737551357
 mnt_best       : 29.995383283199537
 not_improved_count: 1
Train Epoch: 35 [1/500 64/32000 (0%)] Loss: 0.39888 (QuantReg: 13.65723) QuantErr: 13.65723 batch_time=31.74959 
Train Epoch: 35 [9/500 576/32000 (2%)] Loss: 0.48037 (QuantReg: 13.53763) QuantErr: 13.53763 batch_time=0.39246 
Train Epoch: 35 [17/500 1088/32000 (3%)] Loss: 0.45343 (QuantReg: 13.41126) QuantErr: 13.41126 batch_time=0.45508 
Train Epoch: 35 [25/500 1600/32000 (5%)] Loss: 0.43679 (QuantReg: 13.63947) QuantErr: 13.63947 batch_time=0.38075 
Train Epoch: 35 [33/500 2112/32000 (7%)] Loss: 0.63886 (QuantReg: 14.25197) QuantErr: 14.25197 batch_time=0.39630 
Train Epoch: 35 [41/500 2624/32000 (8%)] Loss: 0.55189 (QuantReg: 13.39725) QuantErr: 13.39725 batch_time=0.38759 
Train Epoch: 35 [49/500 3136/32000 (10%)] Loss: 0.55424 (QuantReg: 13.57004) QuantErr: 13.57004 batch_time=0.40078 
Train Epoch: 35 [57/500 3648/32000 (11%)] Loss: 0.57781 (QuantReg: 13.33490) QuantErr: 13.33490 batch_time=0.39347 
Train Epoch: 35 [65/500 4160/32000 (13%)] Loss: 0.32572 (QuantReg: 13.99976) QuantErr: 13.99976 batch_time=0.45079 
Train Epoch: 35 [73/500 4672/32000 (15%)] Loss: 0.58153 (QuantReg: 14.20301) QuantErr: 14.20301 batch_time=0.40900 
Train Epoch: 35 [81/500 5184/32000 (16%)] Loss: 0.74645 (QuantReg: 13.93949) QuantErr: 13.93949 batch_time=0.39132 
Train Epoch: 35 [89/500 5696/32000 (18%)] Loss: 0.66912 (QuantReg: 13.39048) QuantErr: 13.39048 batch_time=0.39547 
Train Epoch: 35 [97/500 6208/32000 (19%)] Loss: 0.43596 (QuantReg: 13.85317) QuantErr: 13.85317 batch_time=0.38711 
Train Epoch: 35 [105/500 6720/32000 (21%)] Loss: 0.52847 (QuantReg: 13.80114) QuantErr: 13.80114 batch_time=0.39161 
Train Epoch: 35 [113/500 7232/32000 (23%)] Loss: 0.67696 (QuantReg: 13.63149) QuantErr: 13.63149 batch_time=0.41125 
Train Epoch: 35 [121/500 7744/32000 (24%)] Loss: 0.34171 (QuantReg: 13.60944) QuantErr: 13.60944 batch_time=0.38796 
Train Epoch: 35 [129/500 8256/32000 (26%)] Loss: 0.70763 (QuantReg: 13.56780) QuantErr: 13.56780 batch_time=0.46174 
Train Epoch: 35 [137/500 8768/32000 (27%)] Loss: 0.67219 (QuantReg: 13.18765) QuantErr: 13.18765 batch_time=0.40949 
Train Epoch: 35 [145/500 9280/32000 (29%)] Loss: 0.50996 (QuantReg: 13.55048) QuantErr: 13.55048 batch_time=0.39056 
Train Epoch: 35 [153/500 9792/32000 (31%)] Loss: 0.53262 (QuantReg: 13.75352) QuantErr: 13.75352 batch_time=0.43564 
Train Epoch: 35 [161/500 10304/32000 (32%)] Loss: 0.49140 (QuantReg: 13.68455) QuantErr: 13.68455 batch_time=0.38738 
Train Epoch: 35 [169/500 10816/32000 (34%)] Loss: 0.84091 (QuantReg: 13.45345) QuantErr: 13.45345 batch_time=0.38113 
Train Epoch: 35 [177/500 11328/32000 (35%)] Loss: 0.30914 (QuantReg: 13.77270) QuantErr: 13.77270 batch_time=0.39290 
Train Epoch: 35 [185/500 11840/32000 (37%)] Loss: 0.62828 (QuantReg: 14.09762) QuantErr: 14.09762 batch_time=0.39579 
Train Epoch: 35 [193/500 12352/32000 (39%)] Loss: 0.57625 (QuantReg: 13.64757) QuantErr: 13.64757 batch_time=0.44183 
Train Epoch: 35 [201/500 12864/32000 (40%)] Loss: 0.39621 (QuantReg: 13.57952) QuantErr: 13.57952 batch_time=0.38256 
Train Epoch: 35 [209/500 13376/32000 (42%)] Loss: 0.69049 (QuantReg: 13.48820) QuantErr: 13.48820 batch_time=0.40287 
Train Epoch: 35 [217/500 13888/32000 (43%)] Loss: 0.65217 (QuantReg: 13.77316) QuantErr: 13.77316 batch_time=0.40169 
Train Epoch: 35 [225/500 14400/32000 (45%)] Loss: 0.46104 (QuantReg: 14.21622) QuantErr: 14.21622 batch_time=0.39038 
Train Epoch: 35 [233/500 14912/32000 (47%)] Loss: 0.39545 (QuantReg: 13.61052) QuantErr: 13.61052 batch_time=0.38730 
Train Epoch: 35 [241/500 15424/32000 (48%)] Loss: 0.34215 (QuantReg: 13.58498) QuantErr: 13.58498 batch_time=0.43768 
Train Epoch: 35 [249/500 15936/32000 (50%)] Loss: 0.45119 (QuantReg: 13.65525) QuantErr: 13.65525 batch_time=0.39863 
Train Epoch: 35 [257/500 16448/32000 (51%)] Loss: 0.47759 (QuantReg: 13.65853) QuantErr: 13.65853 batch_time=0.44846 
Train Epoch: 35 [265/500 16960/32000 (53%)] Loss: 0.75520 (QuantReg: 13.33951) QuantErr: 13.33951 batch_time=0.38919 
Train Epoch: 35 [273/500 17472/32000 (55%)] Loss: 0.48490 (QuantReg: 13.52055) QuantErr: 13.52055 batch_time=0.39071 
Train Epoch: 35 [281/500 17984/32000 (56%)] Loss: 0.41185 (QuantReg: 13.53557) QuantErr: 13.53557 batch_time=0.39567 
Train Epoch: 35 [289/500 18496/32000 (58%)] Loss: 0.37638 (QuantReg: 13.77512) QuantErr: 13.77512 batch_time=0.40924 
Train Epoch: 35 [297/500 19008/32000 (59%)] Loss: 0.58587 (QuantReg: 13.75770) QuantErr: 13.75770 batch_time=0.39089 
Train Epoch: 35 [305/500 19520/32000 (61%)] Loss: 0.36947 (QuantReg: 13.86970) QuantErr: 13.86970 batch_time=0.38271 
Train Epoch: 35 [313/500 20032/32000 (63%)] Loss: 0.86295 (QuantReg: 13.65068) QuantErr: 13.65068 batch_time=0.39171 
Train Epoch: 35 [321/500 20544/32000 (64%)] Loss: 0.41064 (QuantReg: 13.83216) QuantErr: 13.83216 batch_time=0.45989 
Train Epoch: 35 [329/500 21056/32000 (66%)] Loss: 0.84190 (QuantReg: 13.62768) QuantErr: 13.62768 batch_time=0.40264 
Train Epoch: 35 [337/500 21568/32000 (67%)] Loss: 0.43941 (QuantReg: 13.41575) QuantErr: 13.41575 batch_time=0.39392 
Train Epoch: 35 [345/500 22080/32000 (69%)] Loss: 0.31367 (QuantReg: 13.72604) QuantErr: 13.72604 batch_time=0.39592 
Train Epoch: 35 [353/500 22592/32000 (71%)] Loss: 0.25750 (QuantReg: 14.14108) QuantErr: 14.14108 batch_time=0.38998 
Train Epoch: 35 [361/500 23104/32000 (72%)] Loss: 0.68943 (QuantReg: 13.93152) QuantErr: 13.93152 batch_time=0.40257 
Train Epoch: 35 [369/500 23616/32000 (74%)] Loss: 0.49987 (QuantReg: 13.93859) QuantErr: 13.93859 batch_time=0.40785 
Train Epoch: 35 [377/500 24128/32000 (75%)] Loss: 0.59335 (QuantReg: 13.61283) QuantErr: 13.61283 batch_time=0.39551 
Train Epoch: 35 [385/500 24640/32000 (77%)] Loss: 0.61634 (QuantReg: 13.57008) QuantErr: 13.57008 batch_time=0.45422 
Train Epoch: 35 [393/500 25152/32000 (79%)] Loss: 0.43232 (QuantReg: 13.68079) QuantErr: 13.68079 batch_time=0.39084 
Train Epoch: 35 [401/500 25664/32000 (80%)] Loss: 0.49737 (QuantReg: 13.30685) QuantErr: 13.30685 batch_time=0.39885 
Train Epoch: 35 [409/500 26176/32000 (82%)] Loss: 0.31639 (QuantReg: 13.92470) QuantErr: 13.92470 batch_time=0.39751 
Train Epoch: 35 [417/500 26688/32000 (83%)] Loss: 0.43344 (QuantReg: 13.67546) QuantErr: 13.67546 batch_time=0.39021 
Train Epoch: 35 [425/500 27200/32000 (85%)] Loss: 0.71435 (QuantReg: 13.77609) QuantErr: 13.77609 batch_time=0.38863 
Train Epoch: 35 [433/500 27712/32000 (87%)] Loss: 0.41957 (QuantReg: 13.66655) QuantErr: 13.66655 batch_time=0.39577 
Train Epoch: 35 [441/500 28224/32000 (88%)] Loss: 0.47297 (QuantReg: 13.70415) QuantErr: 13.70415 batch_time=0.39113 
Train Epoch: 35 [449/500 28736/32000 (90%)] Loss: 0.37305 (QuantReg: 14.10342) QuantErr: 14.10342 batch_time=0.48217 
Train Epoch: 35 [457/500 29248/32000 (91%)] Loss: 0.72600 (QuantReg: 13.41018) QuantErr: 13.41018 batch_time=0.39675 
Train Epoch: 35 [465/500 29760/32000 (93%)] Loss: 0.67942 (QuantReg: 13.94224) QuantErr: 13.94224 batch_time=0.39824 
Train Epoch: 35 [473/500 30272/32000 (95%)] Loss: 0.46357 (QuantReg: 13.91368) QuantErr: 13.91368 batch_time=0.39588 
Train Epoch: 35 [481/500 30784/32000 (96%)] Loss: 0.41644 (QuantReg: 13.86135) QuantErr: 13.86135 batch_time=0.39502 
Train Epoch: 35 [489/500 31296/32000 (98%)] Loss: 0.31951 (QuantReg: 13.52915) QuantErr: 13.52915 batch_time=0.39322 
Train Epoch: 35 [497/500 31808/32000 (99%)] Loss: 0.49370 (QuantReg: 13.74551) QuantErr: 13.74551 batch_time=0.40429 
Train Epoch: 35 codebook_update_time=1.84800
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch35.pth ...
Done in 4.508s
removing stale ckpt [epoch 34] [took 0.00s]
 epoch          : 35
 loss           : 0.5186196285486221
 quant_reg      : 13.708504522323608
 quant_err      : 13.708504522323608
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 17500
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.110663983903422
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.876641379194794
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.913480885311872
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.00474730230021
 MSRVTT_full_test/t2v_metrics/R1: 13.110367892976589
 MSRVTT_full_test/t2v_metrics/R5: 38.32775919732441
 MSRVTT_full_test/t2v_metrics/R10: 52.207357859531776
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 9.5
 MSRVTT_full_test/t2v_metrics/MeanR: 43.24715719063545
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.713467834406188
 MSRVTT_full_test/v2t_metrics/R1: 16.923076923076923
 MSRVTT_full_test/v2t_metrics/R5: 44.34782608695652
 MSRVTT_full_test/v2t_metrics/R10: 60.50167224080268
 MSRVTT_full_test/v2t_metrics/R50: 87.85953177257525
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.543478260869566
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.67574197814893
 mnt_best       : 29.995383283199537
 not_improved_count: 2
Train Epoch: 36 [1/500 64/32000 (0%)] Loss: 0.68231 (QuantReg: 13.54968) QuantErr: 13.54968 batch_time=29.82360 
Train Epoch: 36 [9/500 576/32000 (2%)] Loss: 0.44064 (QuantReg: 13.83749) QuantErr: 13.83749 batch_time=0.38059 
Train Epoch: 36 [17/500 1088/32000 (3%)] Loss: 0.49530 (QuantReg: 13.50575) QuantErr: 13.50575 batch_time=0.38298 
Train Epoch: 36 [25/500 1600/32000 (5%)] Loss: 0.50401 (QuantReg: 13.36932) QuantErr: 13.36932 batch_time=0.40232 
Train Epoch: 36 [33/500 2112/32000 (7%)] Loss: 0.45126 (QuantReg: 13.81390) QuantErr: 13.81390 batch_time=0.38489 
Train Epoch: 36 [41/500 2624/32000 (8%)] Loss: 0.40183 (QuantReg: 13.70450) QuantErr: 13.70450 batch_time=0.39338 
Train Epoch: 36 [49/500 3136/32000 (10%)] Loss: 0.60342 (QuantReg: 13.59480) QuantErr: 13.59480 batch_time=0.38222 
Train Epoch: 36 [57/500 3648/32000 (11%)] Loss: 0.27028 (QuantReg: 13.87087) QuantErr: 13.87087 batch_time=0.39203 
Train Epoch: 36 [65/500 4160/32000 (13%)] Loss: 0.47814 (QuantReg: 13.43559) QuantErr: 13.43559 batch_time=0.43916 
Train Epoch: 36 [73/500 4672/32000 (15%)] Loss: 0.41735 (QuantReg: 13.60969) QuantErr: 13.60969 batch_time=0.38884 
Train Epoch: 36 [81/500 5184/32000 (16%)] Loss: 0.38410 (QuantReg: 13.56494) QuantErr: 13.56494 batch_time=0.38178 
Train Epoch: 36 [89/500 5696/32000 (18%)] Loss: 0.76648 (QuantReg: 13.18681) QuantErr: 13.18681 batch_time=0.38331 
Train Epoch: 36 [97/500 6208/32000 (19%)] Loss: 0.60782 (QuantReg: 13.88577) QuantErr: 13.88577 batch_time=0.39966 
Train Epoch: 36 [105/500 6720/32000 (21%)] Loss: 0.50079 (QuantReg: 13.55134) QuantErr: 13.55134 batch_time=0.39746 
Train Epoch: 36 [113/500 7232/32000 (23%)] Loss: 0.59773 (QuantReg: 13.78160) QuantErr: 13.78160 batch_time=0.39498 
Train Epoch: 36 [121/500 7744/32000 (24%)] Loss: 0.62020 (QuantReg: 13.19264) QuantErr: 13.19264 batch_time=0.38750 
Train Epoch: 36 [129/500 8256/32000 (26%)] Loss: 0.60903 (QuantReg: 13.66882) QuantErr: 13.66882 batch_time=0.44260 
Train Epoch: 36 [137/500 8768/32000 (27%)] Loss: 0.83372 (QuantReg: 13.40254) QuantErr: 13.40254 batch_time=0.38350 
Train Epoch: 36 [145/500 9280/32000 (29%)] Loss: 0.45689 (QuantReg: 13.98325) QuantErr: 13.98325 batch_time=0.37958 
Train Epoch: 36 [153/500 9792/32000 (31%)] Loss: 0.54367 (QuantReg: 13.66259) QuantErr: 13.66259 batch_time=0.38102 
Train Epoch: 36 [161/500 10304/32000 (32%)] Loss: 0.49713 (QuantReg: 14.07870) QuantErr: 14.07870 batch_time=0.38240 
Train Epoch: 36 [169/500 10816/32000 (34%)] Loss: 0.43644 (QuantReg: 13.66452) QuantErr: 13.66452 batch_time=0.39265 
Train Epoch: 36 [177/500 11328/32000 (35%)] Loss: 0.62096 (QuantReg: 13.82336) QuantErr: 13.82336 batch_time=0.43592 
Train Epoch: 36 [185/500 11840/32000 (37%)] Loss: 0.33700 (QuantReg: 14.17797) QuantErr: 14.17797 batch_time=0.39243 
Train Epoch: 36 [193/500 12352/32000 (39%)] Loss: 0.83306 (QuantReg: 13.67760) QuantErr: 13.67760 batch_time=0.44871 
Train Epoch: 36 [201/500 12864/32000 (40%)] Loss: 0.75113 (QuantReg: 13.84283) QuantErr: 13.84283 batch_time=0.38958 
Train Epoch: 36 [209/500 13376/32000 (42%)] Loss: 0.57764 (QuantReg: 13.74276) QuantErr: 13.74276 batch_time=0.38819 
Train Epoch: 36 [217/500 13888/32000 (43%)] Loss: 0.42699 (QuantReg: 13.77516) QuantErr: 13.77516 batch_time=0.38929 
Train Epoch: 36 [225/500 14400/32000 (45%)] Loss: 0.36484 (QuantReg: 13.75885) QuantErr: 13.75885 batch_time=0.38322 
Train Epoch: 36 [233/500 14912/32000 (47%)] Loss: 0.78223 (QuantReg: 14.07260) QuantErr: 14.07260 batch_time=0.39360 
Train Epoch: 36 [241/500 15424/32000 (48%)] Loss: 0.45876 (QuantReg: 14.12600) QuantErr: 14.12600 batch_time=0.38572 
Train Epoch: 36 [249/500 15936/32000 (50%)] Loss: 0.76347 (QuantReg: 13.34821) QuantErr: 13.34821 batch_time=0.40612 
Train Epoch: 36 [257/500 16448/32000 (51%)] Loss: 0.72477 (QuantReg: 13.52537) QuantErr: 13.52537 batch_time=0.45944 
Train Epoch: 36 [265/500 16960/32000 (53%)] Loss: 0.71064 (QuantReg: 13.15314) QuantErr: 13.15314 batch_time=0.38546 
Train Epoch: 36 [273/500 17472/32000 (55%)] Loss: 0.32522 (QuantReg: 13.95032) QuantErr: 13.95032 batch_time=0.39040 
Train Epoch: 36 [281/500 17984/32000 (56%)] Loss: 0.71370 (QuantReg: 14.10332) QuantErr: 14.10332 batch_time=0.38249 
Train Epoch: 36 [289/500 18496/32000 (58%)] Loss: 0.47214 (QuantReg: 13.98253) QuantErr: 13.98253 batch_time=0.40186 
Train Epoch: 36 [297/500 19008/32000 (59%)] Loss: 0.35202 (QuantReg: 13.97706) QuantErr: 13.97706 batch_time=0.40517 
Train Epoch: 36 [305/500 19520/32000 (61%)] Loss: 0.65338 (QuantReg: 13.77604) QuantErr: 13.77604 batch_time=0.39823 
Train Epoch: 36 [313/500 20032/32000 (63%)] Loss: 0.45883 (QuantReg: 13.86185) QuantErr: 13.86185 batch_time=0.39535 
Train Epoch: 36 [321/500 20544/32000 (64%)] Loss: 0.37352 (QuantReg: 13.87715) QuantErr: 13.87715 batch_time=0.46290 
Train Epoch: 36 [329/500 21056/32000 (66%)] Loss: 0.44653 (QuantReg: 13.84215) QuantErr: 13.84215 batch_time=0.41394 
Train Epoch: 36 [337/500 21568/32000 (67%)] Loss: 0.57150 (QuantReg: 14.00601) QuantErr: 14.00601 batch_time=0.38815 
Train Epoch: 36 [345/500 22080/32000 (69%)] Loss: 0.52745 (QuantReg: 13.99841) QuantErr: 13.99841 batch_time=0.39104 
Train Epoch: 36 [353/500 22592/32000 (71%)] Loss: 0.70862 (QuantReg: 13.55134) QuantErr: 13.55134 batch_time=0.39553 
Train Epoch: 36 [361/500 23104/32000 (72%)] Loss: 0.37301 (QuantReg: 14.07347) QuantErr: 14.07347 batch_time=0.39261 
Train Epoch: 36 [369/500 23616/32000 (74%)] Loss: 0.34137 (QuantReg: 13.74573) QuantErr: 13.74573 batch_time=0.40079 
Train Epoch: 36 [377/500 24128/32000 (75%)] Loss: 0.39314 (QuantReg: 13.43920) QuantErr: 13.43920 batch_time=0.38648 
Train Epoch: 36 [385/500 24640/32000 (77%)] Loss: 0.55484 (QuantReg: 13.86061) QuantErr: 13.86061 batch_time=0.44216 
Train Epoch: 36 [393/500 25152/32000 (79%)] Loss: 0.54724 (QuantReg: 13.66009) QuantErr: 13.66009 batch_time=0.39787 
Train Epoch: 36 [401/500 25664/32000 (80%)] Loss: 0.37027 (QuantReg: 13.80745) QuantErr: 13.80745 batch_time=0.42851 
Train Epoch: 36 [409/500 26176/32000 (82%)] Loss: 0.54127 (QuantReg: 13.67547) QuantErr: 13.67547 batch_time=0.40210 
Train Epoch: 36 [417/500 26688/32000 (83%)] Loss: 0.49348 (QuantReg: 13.54113) QuantErr: 13.54113 batch_time=0.41370 
Train Epoch: 36 [425/500 27200/32000 (85%)] Loss: 0.48379 (QuantReg: 13.67977) QuantErr: 13.67977 batch_time=0.41468 
Train Epoch: 36 [433/500 27712/32000 (87%)] Loss: 0.59356 (QuantReg: 13.79686) QuantErr: 13.79686 batch_time=0.39513 
Train Epoch: 36 [441/500 28224/32000 (88%)] Loss: 0.59692 (QuantReg: 13.52378) QuantErr: 13.52378 batch_time=0.40666 
Train Epoch: 36 [449/500 28736/32000 (90%)] Loss: 0.86075 (QuantReg: 13.46326) QuantErr: 13.46326 batch_time=0.46616 
Train Epoch: 36 [457/500 29248/32000 (91%)] Loss: 0.40658 (QuantReg: 13.56078) QuantErr: 13.56078 batch_time=0.41288 
Train Epoch: 36 [465/500 29760/32000 (93%)] Loss: 0.65537 (QuantReg: 13.46499) QuantErr: 13.46499 batch_time=0.39929 
Train Epoch: 36 [473/500 30272/32000 (95%)] Loss: 0.77251 (QuantReg: 13.48547) QuantErr: 13.48547 batch_time=0.38529 
Train Epoch: 36 [481/500 30784/32000 (96%)] Loss: 0.49580 (QuantReg: 13.54431) QuantErr: 13.54431 batch_time=0.38365 
Train Epoch: 36 [489/500 31296/32000 (98%)] Loss: 0.56789 (QuantReg: 13.67185) QuantErr: 13.67185 batch_time=0.37349 
Train Epoch: 36 [497/500 31808/32000 (99%)] Loss: 0.54148 (QuantReg: 13.93404) QuantErr: 13.93404 batch_time=0.38937 
Train Epoch: 36 codebook_update_time=1.88829
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch36.pth ...
Done in 3.917s
removing stale ckpt [epoch 35] [took 0.00s]
 epoch          : 36
 loss           : 0.5029458011686802
 quant_reg      : 13.734644834518432
 quant_err      : 13.734644834518432
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 18000
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 71.62977867203219
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.233400402414487
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.27766159000736
 MSRVTT_full_val/v2t_metrics/R1: 40.44265593561368
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.054325955734407
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.8732985885953
 MSRVTT_full_test/t2v_metrics/R1: 13.110367892976589
 MSRVTT_full_test/t2v_metrics/R5: 38.929765886287626
 MSRVTT_full_test/t2v_metrics/R10: 52.642140468227424
 MSRVTT_full_test/t2v_metrics/R50: 82.24080267558529
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.926086956521736
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.950913311071098
 MSRVTT_full_test/v2t_metrics/R1: 15.852842809364548
 MSRVTT_full_test/v2t_metrics/R5: 45.01672240802676
 MSRVTT_full_test/v2t_metrics/R10: 60.40133779264214
 MSRVTT_full_test/v2t_metrics/R50: 88.06020066889631
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.60535117056856
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.06247165593071
 mnt_best       : 29.995383283199537
 not_improved_count: 3
Train Epoch: 37 [1/500 64/32000 (0%)] Loss: 0.33605 (QuantReg: 13.55755) QuantErr: 13.55755 batch_time=31.51437 
Train Epoch: 37 [9/500 576/32000 (2%)] Loss: 0.59622 (QuantReg: 13.86960) QuantErr: 13.86960 batch_time=0.38510 
Train Epoch: 37 [17/500 1088/32000 (3%)] Loss: 0.44467 (QuantReg: 13.71500) QuantErr: 13.71500 batch_time=0.38737 
Train Epoch: 37 [25/500 1600/32000 (5%)] Loss: 0.51754 (QuantReg: 13.58115) QuantErr: 13.58115 batch_time=0.42553 
Train Epoch: 37 [33/500 2112/32000 (7%)] Loss: 0.33646 (QuantReg: 13.42110) QuantErr: 13.42110 batch_time=0.39404 
Train Epoch: 37 [41/500 2624/32000 (8%)] Loss: 0.56498 (QuantReg: 13.78782) QuantErr: 13.78782 batch_time=0.74724 
Train Epoch: 37 [49/500 3136/32000 (10%)] Loss: 0.45849 (QuantReg: 14.11204) QuantErr: 14.11204 batch_time=0.39923 
Train Epoch: 37 [57/500 3648/32000 (11%)] Loss: 0.53045 (QuantReg: 13.59585) QuantErr: 13.59585 batch_time=0.39234 
Train Epoch: 37 [65/500 4160/32000 (13%)] Loss: 0.37125 (QuantReg: 13.62884) QuantErr: 13.62884 batch_time=0.82890 
Train Epoch: 37 [73/500 4672/32000 (15%)] Loss: 0.54259 (QuantReg: 13.67472) QuantErr: 13.67472 batch_time=0.39726 
Train Epoch: 37 [81/500 5184/32000 (16%)] Loss: 0.72744 (QuantReg: 13.48012) QuantErr: 13.48012 batch_time=0.39094 
Train Epoch: 37 [89/500 5696/32000 (18%)] Loss: 0.45339 (QuantReg: 13.91487) QuantErr: 13.91487 batch_time=0.38870 
Train Epoch: 37 [97/500 6208/32000 (19%)] Loss: 0.57611 (QuantReg: 13.52235) QuantErr: 13.52235 batch_time=0.38854 
Train Epoch: 37 [105/500 6720/32000 (21%)] Loss: 0.54050 (QuantReg: 13.51331) QuantErr: 13.51331 batch_time=0.72818 
Train Epoch: 37 [113/500 7232/32000 (23%)] Loss: 0.47186 (QuantReg: 13.73609) QuantErr: 13.73609 batch_time=0.39017 
Train Epoch: 37 [121/500 7744/32000 (24%)] Loss: 0.46638 (QuantReg: 13.89646) QuantErr: 13.89646 batch_time=0.38494 
Train Epoch: 37 [129/500 8256/32000 (26%)] Loss: 0.37621 (QuantReg: 13.71669) QuantErr: 13.71669 batch_time=0.79915 
Train Epoch: 37 [137/500 8768/32000 (27%)] Loss: 0.66468 (QuantReg: 13.48755) QuantErr: 13.48755 batch_time=0.39107 
Train Epoch: 37 [145/500 9280/32000 (29%)] Loss: 0.39505 (QuantReg: 14.01844) QuantErr: 14.01844 batch_time=0.41858 
Train Epoch: 37 [153/500 9792/32000 (31%)] Loss: 0.24533 (QuantReg: 13.62807) QuantErr: 13.62807 batch_time=0.43422 
Train Epoch: 37 [161/500 10304/32000 (32%)] Loss: 0.45568 (QuantReg: 13.70064) QuantErr: 13.70064 batch_time=0.39076 
Train Epoch: 37 [169/500 10816/32000 (34%)] Loss: 0.59809 (QuantReg: 13.81001) QuantErr: 13.81001 batch_time=0.70766 
Train Epoch: 37 [177/500 11328/32000 (35%)] Loss: 0.33288 (QuantReg: 13.80679) QuantErr: 13.80679 batch_time=0.38960 
Train Epoch: 37 [185/500 11840/32000 (37%)] Loss: 0.58050 (QuantReg: 13.90391) QuantErr: 13.90391 batch_time=0.40933 
Train Epoch: 37 [193/500 12352/32000 (39%)] Loss: 0.45869 (QuantReg: 13.45071) QuantErr: 13.45071 batch_time=0.78536 
Train Epoch: 37 [201/500 12864/32000 (40%)] Loss: 0.58073 (QuantReg: 13.69104) QuantErr: 13.69104 batch_time=0.39593 
Train Epoch: 37 [209/500 13376/32000 (42%)] Loss: 0.57079 (QuantReg: 13.09307) QuantErr: 13.09307 batch_time=0.39916 
Train Epoch: 37 [217/500 13888/32000 (43%)] Loss: 0.55382 (QuantReg: 13.47309) QuantErr: 13.47309 batch_time=0.39609 
Train Epoch: 37 [225/500 14400/32000 (45%)] Loss: 0.52814 (QuantReg: 13.90799) QuantErr: 13.90799 batch_time=0.41744 
Train Epoch: 37 [233/500 14912/32000 (47%)] Loss: 0.52965 (QuantReg: 13.83300) QuantErr: 13.83300 batch_time=0.69294 
Train Epoch: 37 [241/500 15424/32000 (48%)] Loss: 0.44748 (QuantReg: 13.70353) QuantErr: 13.70353 batch_time=0.39656 
Train Epoch: 37 [249/500 15936/32000 (50%)] Loss: 0.40055 (QuantReg: 13.61283) QuantErr: 13.61283 batch_time=0.41120 
Train Epoch: 37 [257/500 16448/32000 (51%)] Loss: 0.42244 (QuantReg: 13.79040) QuantErr: 13.79040 batch_time=0.78395 
Train Epoch: 37 [265/500 16960/32000 (53%)] Loss: 0.38382 (QuantReg: 13.33564) QuantErr: 13.33564 batch_time=0.40389 
Train Epoch: 37 [273/500 17472/32000 (55%)] Loss: 0.55473 (QuantReg: 13.67932) QuantErr: 13.67932 batch_time=0.38801 
Train Epoch: 37 [281/500 17984/32000 (56%)] Loss: 0.31717 (QuantReg: 14.04742) QuantErr: 14.04742 batch_time=0.39868 
Train Epoch: 37 [289/500 18496/32000 (58%)] Loss: 0.24245 (QuantReg: 14.00776) QuantErr: 14.00776 batch_time=0.39834 
Train Epoch: 37 [297/500 19008/32000 (59%)] Loss: 0.55072 (QuantReg: 13.82952) QuantErr: 13.82952 batch_time=0.67671 
Train Epoch: 37 [305/500 19520/32000 (61%)] Loss: 0.51504 (QuantReg: 13.16018) QuantErr: 13.16018 batch_time=0.39194 
Train Epoch: 37 [313/500 20032/32000 (63%)] Loss: 0.48185 (QuantReg: 13.79270) QuantErr: 13.79270 batch_time=0.40991 
Train Epoch: 37 [321/500 20544/32000 (64%)] Loss: 0.70337 (QuantReg: 13.62035) QuantErr: 13.62035 batch_time=0.77656 
Train Epoch: 37 [329/500 21056/32000 (66%)] Loss: 0.56371 (QuantReg: 13.31091) QuantErr: 13.31091 batch_time=0.39200 
Train Epoch: 37 [337/500 21568/32000 (67%)] Loss: 0.50523 (QuantReg: 13.74412) QuantErr: 13.74412 batch_time=0.39933 
Train Epoch: 37 [345/500 22080/32000 (69%)] Loss: 0.36142 (QuantReg: 13.82779) QuantErr: 13.82779 batch_time=0.39931 
Train Epoch: 37 [353/500 22592/32000 (71%)] Loss: 0.30664 (QuantReg: 13.74083) QuantErr: 13.74083 batch_time=0.39082 
Train Epoch: 37 [361/500 23104/32000 (72%)] Loss: 0.35871 (QuantReg: 13.79805) QuantErr: 13.79805 batch_time=0.67217 
Train Epoch: 37 [369/500 23616/32000 (74%)] Loss: 0.43543 (QuantReg: 13.76872) QuantErr: 13.76872 batch_time=0.40445 
Train Epoch: 37 [377/500 24128/32000 (75%)] Loss: 0.48077 (QuantReg: 13.71881) QuantErr: 13.71881 batch_time=0.41948 
Train Epoch: 37 [385/500 24640/32000 (77%)] Loss: 0.46427 (QuantReg: 13.95984) QuantErr: 13.95984 batch_time=0.76828 
Train Epoch: 37 [393/500 25152/32000 (79%)] Loss: 0.21690 (QuantReg: 14.06289) QuantErr: 14.06289 batch_time=0.39386 
Train Epoch: 37 [401/500 25664/32000 (80%)] Loss: 0.38511 (QuantReg: 14.05625) QuantErr: 14.05625 batch_time=0.38599 
Train Epoch: 37 [409/500 26176/32000 (82%)] Loss: 0.64110 (QuantReg: 13.65807) QuantErr: 13.65807 batch_time=0.39233 
Train Epoch: 37 [417/500 26688/32000 (83%)] Loss: 0.50295 (QuantReg: 13.72303) QuantErr: 13.72303 batch_time=0.39415 
Train Epoch: 37 [425/500 27200/32000 (85%)] Loss: 0.76059 (QuantReg: 13.69444) QuantErr: 13.69444 batch_time=0.68677 
Train Epoch: 37 [433/500 27712/32000 (87%)] Loss: 0.55514 (QuantReg: 13.74757) QuantErr: 13.74757 batch_time=0.39292 
Train Epoch: 37 [441/500 28224/32000 (88%)] Loss: 0.39963 (QuantReg: 14.01123) QuantErr: 14.01123 batch_time=0.39976 
Train Epoch: 37 [449/500 28736/32000 (90%)] Loss: 0.57044 (QuantReg: 13.85823) QuantErr: 13.85823 batch_time=0.39253 
Train Epoch: 37 [457/500 29248/32000 (91%)] Loss: 0.37157 (QuantReg: 14.07223) QuantErr: 14.07223 batch_time=0.40058 
Train Epoch: 37 [465/500 29760/32000 (93%)] Loss: 0.42864 (QuantReg: 13.73763) QuantErr: 13.73763 batch_time=0.39032 
Train Epoch: 37 [473/500 30272/32000 (95%)] Loss: 0.85975 (QuantReg: 13.67284) QuantErr: 13.67284 batch_time=0.39663 
Train Epoch: 37 [481/500 30784/32000 (96%)] Loss: 0.47128 (QuantReg: 13.70249) QuantErr: 13.70249 batch_time=0.43753 
Train Epoch: 37 [489/500 31296/32000 (98%)] Loss: 0.75588 (QuantReg: 13.51248) QuantErr: 13.51248 batch_time=0.49719 
Train Epoch: 37 [497/500 31808/32000 (99%)] Loss: 0.36666 (QuantReg: 13.93645) QuantErr: 13.93645 batch_time=0.39527 
Train Epoch: 37 codebook_update_time=2.57211
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch37.pth ...
Done in 3.996s
removing stale ckpt [epoch 36] [took 0.06s]
 epoch          : 37
 loss           : 0.5101410670280456
 quant_reg      : 13.735421529769898
 quant_err      : 13.735421529769898
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 18500
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.87122736418511
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.00309078449213
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.406438631790745
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.89539156765272
 MSRVTT_full_test/t2v_metrics/R1: 13.244147157190636
 MSRVTT_full_test/t2v_metrics/R5: 37.725752508361204
 MSRVTT_full_test/t2v_metrics/R10: 51.40468227424749
 MSRVTT_full_test/t2v_metrics/R50: 81.57190635451505
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.040468227424746
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.504495706165244
 MSRVTT_full_test/v2t_metrics/R1: 15.384615384615385
 MSRVTT_full_test/v2t_metrics/R5: 43.64548494983278
 MSRVTT_full_test/v2t_metrics/R10: 60.06688963210702
 MSRVTT_full_test/v2t_metrics/R50: 87.1571906354515
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.17408026755853
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.294175833129735
 mnt_best       : 29.995383283199537
 not_improved_count: 4
Train Epoch: 38 [1/500 64/32000 (0%)] Loss: 0.56853 (QuantReg: 13.67226) QuantErr: 13.67226 batch_time=32.07968 
Train Epoch: 38 [9/500 576/32000 (2%)] Loss: 0.37947 (QuantReg: 13.58250) QuantErr: 13.58250 batch_time=0.50548 
Train Epoch: 38 [17/500 1088/32000 (3%)] Loss: 0.62166 (QuantReg: 13.66601) QuantErr: 13.66601 batch_time=0.65067 
Train Epoch: 38 [25/500 1600/32000 (5%)] Loss: 0.66401 (QuantReg: 13.38894) QuantErr: 13.38894 batch_time=0.38921 
Train Epoch: 38 [33/500 2112/32000 (7%)] Loss: 0.50485 (QuantReg: 14.04919) QuantErr: 14.04919 batch_time=0.39063 
Train Epoch: 38 [41/500 2624/32000 (8%)] Loss: 0.44692 (QuantReg: 13.60786) QuantErr: 13.60786 batch_time=0.39183 
Train Epoch: 38 [49/500 3136/32000 (10%)] Loss: 0.59993 (QuantReg: 13.99591) QuantErr: 13.99591 batch_time=0.41959 
Train Epoch: 38 [57/500 3648/32000 (11%)] Loss: 0.52068 (QuantReg: 13.76634) QuantErr: 13.76634 batch_time=0.39189 
Train Epoch: 38 [65/500 4160/32000 (13%)] Loss: 0.35957 (QuantReg: 13.89317) QuantErr: 13.89317 batch_time=0.74668 
Train Epoch: 38 [73/500 4672/32000 (15%)] Loss: 0.62462 (QuantReg: 13.40372) QuantErr: 13.40372 batch_time=0.53102 
Train Epoch: 38 [81/500 5184/32000 (16%)] Loss: 0.39759 (QuantReg: 13.73588) QuantErr: 13.73588 batch_time=0.55882 
Train Epoch: 38 [89/500 5696/32000 (18%)] Loss: 0.74138 (QuantReg: 13.82548) QuantErr: 13.82548 batch_time=0.40304 
Train Epoch: 38 [97/500 6208/32000 (19%)] Loss: 0.32292 (QuantReg: 13.40818) QuantErr: 13.40818 batch_time=0.39506 
Train Epoch: 38 [105/500 6720/32000 (21%)] Loss: 0.63391 (QuantReg: 13.76114) QuantErr: 13.76114 batch_time=0.39596 
Train Epoch: 38 [113/500 7232/32000 (23%)] Loss: 0.40429 (QuantReg: 13.57609) QuantErr: 13.57609 batch_time=0.39254 
Train Epoch: 38 [121/500 7744/32000 (24%)] Loss: 0.19962 (QuantReg: 13.68347) QuantErr: 13.68347 batch_time=0.39497 
Train Epoch: 38 [129/500 8256/32000 (26%)] Loss: 0.61180 (QuantReg: 13.46327) QuantErr: 13.46327 batch_time=0.39424 
Train Epoch: 38 [137/500 8768/32000 (27%)] Loss: 0.37771 (QuantReg: 14.11079) QuantErr: 14.11079 batch_time=0.39982 
Train Epoch: 38 [145/500 9280/32000 (29%)] Loss: 0.39948 (QuantReg: 13.91781) QuantErr: 13.91781 batch_time=0.57134 
Train Epoch: 38 [153/500 9792/32000 (31%)] Loss: 0.34377 (QuantReg: 13.49506) QuantErr: 13.49506 batch_time=0.40141 
Train Epoch: 38 [161/500 10304/32000 (32%)] Loss: 0.59837 (QuantReg: 13.51134) QuantErr: 13.51134 batch_time=0.38105 
Train Epoch: 38 [169/500 10816/32000 (34%)] Loss: 0.29683 (QuantReg: 14.14000) QuantErr: 14.14000 batch_time=0.38821 
Train Epoch: 38 [177/500 11328/32000 (35%)] Loss: 0.45009 (QuantReg: 13.47448) QuantErr: 13.47448 batch_time=0.40009 
Train Epoch: 38 [185/500 11840/32000 (37%)] Loss: 0.63682 (QuantReg: 13.90480) QuantErr: 13.90480 batch_time=0.38708 
Train Epoch: 38 [193/500 12352/32000 (39%)] Loss: 0.43578 (QuantReg: 14.04923) QuantErr: 14.04923 batch_time=0.38920 
Train Epoch: 38 [201/500 12864/32000 (40%)] Loss: 0.38055 (QuantReg: 13.95767) QuantErr: 13.95767 batch_time=0.40401 
Train Epoch: 38 [209/500 13376/32000 (42%)] Loss: 0.43326 (QuantReg: 13.88021) QuantErr: 13.88021 batch_time=0.59321 
Train Epoch: 38 [217/500 13888/32000 (43%)] Loss: 0.49553 (QuantReg: 13.92683) QuantErr: 13.92683 batch_time=0.38847 
Train Epoch: 38 [225/500 14400/32000 (45%)] Loss: 0.69395 (QuantReg: 13.38219) QuantErr: 13.38219 batch_time=0.41796 
Train Epoch: 38 [233/500 14912/32000 (47%)] Loss: 0.80642 (QuantReg: 13.72334) QuantErr: 13.72334 batch_time=0.39394 
Train Epoch: 38 [241/500 15424/32000 (48%)] Loss: 0.43901 (QuantReg: 13.82133) QuantErr: 13.82133 batch_time=0.39509 
Train Epoch: 38 [249/500 15936/32000 (50%)] Loss: 0.34856 (QuantReg: 13.71824) QuantErr: 13.71824 batch_time=0.39620 
Train Epoch: 38 [257/500 16448/32000 (51%)] Loss: 0.54734 (QuantReg: 13.63603) QuantErr: 13.63603 batch_time=0.40156 
Train Epoch: 38 [265/500 16960/32000 (53%)] Loss: 0.59243 (QuantReg: 13.67390) QuantErr: 13.67390 batch_time=0.40565 
Train Epoch: 38 [273/500 17472/32000 (55%)] Loss: 0.25604 (QuantReg: 13.95249) QuantErr: 13.95249 batch_time=0.56936 
Train Epoch: 38 [281/500 17984/32000 (56%)] Loss: 0.43334 (QuantReg: 13.95082) QuantErr: 13.95082 batch_time=0.39444 
Train Epoch: 38 [289/500 18496/32000 (58%)] Loss: 0.43677 (QuantReg: 13.93316) QuantErr: 13.93316 batch_time=0.39509 
Train Epoch: 38 [297/500 19008/32000 (59%)] Loss: 0.43713 (QuantReg: 13.62076) QuantErr: 13.62076 batch_time=0.39121 
Train Epoch: 38 [305/500 19520/32000 (61%)] Loss: 0.42962 (QuantReg: 13.94810) QuantErr: 13.94810 batch_time=0.40571 
Train Epoch: 38 [313/500 20032/32000 (63%)] Loss: 0.30186 (QuantReg: 13.69558) QuantErr: 13.69558 batch_time=0.41019 
Train Epoch: 38 [321/500 20544/32000 (64%)] Loss: 0.47288 (QuantReg: 13.66559) QuantErr: 13.66559 batch_time=0.39601 
Train Epoch: 38 [329/500 21056/32000 (66%)] Loss: 0.74255 (QuantReg: 13.50107) QuantErr: 13.50107 batch_time=0.42568 
Train Epoch: 38 [337/500 21568/32000 (67%)] Loss: 0.53438 (QuantReg: 13.58676) QuantErr: 13.58676 batch_time=0.61244 
Train Epoch: 38 [345/500 22080/32000 (69%)] Loss: 0.67599 (QuantReg: 13.99887) QuantErr: 13.99887 batch_time=0.39841 
Train Epoch: 38 [353/500 22592/32000 (71%)] Loss: 0.41385 (QuantReg: 13.79941) QuantErr: 13.79941 batch_time=0.40238 
Train Epoch: 38 [361/500 23104/32000 (72%)] Loss: 0.48208 (QuantReg: 13.82459) QuantErr: 13.82459 batch_time=0.43934 
Train Epoch: 38 [369/500 23616/32000 (74%)] Loss: 0.53081 (QuantReg: 13.79717) QuantErr: 13.79717 batch_time=0.40973 
Train Epoch: 38 [377/500 24128/32000 (75%)] Loss: 0.52472 (QuantReg: 13.74555) QuantErr: 13.74555 batch_time=0.42400 
Train Epoch: 38 [385/500 24640/32000 (77%)] Loss: 0.54607 (QuantReg: 14.13984) QuantErr: 14.13984 batch_time=0.39776 
Train Epoch: 38 [393/500 25152/32000 (79%)] Loss: 0.44642 (QuantReg: 13.57641) QuantErr: 13.57641 batch_time=0.40214 
Train Epoch: 38 [401/500 25664/32000 (80%)] Loss: 0.64518 (QuantReg: 13.62134) QuantErr: 13.62134 batch_time=0.57905 
Train Epoch: 38 [409/500 26176/32000 (82%)] Loss: 0.67532 (QuantReg: 13.48720) QuantErr: 13.48720 batch_time=0.39562 
Train Epoch: 38 [417/500 26688/32000 (83%)] Loss: 0.45397 (QuantReg: 13.79426) QuantErr: 13.79426 batch_time=0.39261 
Train Epoch: 38 [425/500 27200/32000 (85%)] Loss: 0.29612 (QuantReg: 14.04183) QuantErr: 14.04183 batch_time=0.38931 
Train Epoch: 38 [433/500 27712/32000 (87%)] Loss: 0.39335 (QuantReg: 13.77726) QuantErr: 13.77726 batch_time=0.38670 
Train Epoch: 38 [441/500 28224/32000 (88%)] Loss: 0.42326 (QuantReg: 13.84891) QuantErr: 13.84891 batch_time=0.44499 
Train Epoch: 38 [449/500 28736/32000 (90%)] Loss: 0.39948 (QuantReg: 14.12785) QuantErr: 14.12785 batch_time=0.38092 
Train Epoch: 38 [457/500 29248/32000 (91%)] Loss: 0.64225 (QuantReg: 13.71729) QuantErr: 13.71729 batch_time=0.38837 
Train Epoch: 38 [465/500 29760/32000 (93%)] Loss: 0.29327 (QuantReg: 13.88700) QuantErr: 13.88700 batch_time=0.57289 
Train Epoch: 38 [473/500 30272/32000 (95%)] Loss: 0.27204 (QuantReg: 13.97142) QuantErr: 13.97142 batch_time=0.38947 
Train Epoch: 38 [481/500 30784/32000 (96%)] Loss: 0.59414 (QuantReg: 13.44173) QuantErr: 13.44173 batch_time=0.39703 
Train Epoch: 38 [489/500 31296/32000 (98%)] Loss: 0.39874 (QuantReg: 14.04621) QuantErr: 14.04621 batch_time=0.43963 
Train Epoch: 38 [497/500 31808/32000 (99%)] Loss: 0.20288 (QuantReg: 14.11656) QuantErr: 14.11656 batch_time=0.44190 
Train Epoch: 38 codebook_update_time=2.06307
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch38.pth ...
Done in 18.438s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch38.pth ...
Done in 22.828s
removing stale ckpt [epoch 37] [took 0.03s]
 epoch          : 38
 loss           : 0.4908608485162258
 quant_reg      : 13.758956750869752
 quant_err      : 13.758956750869752
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 19000
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.416498993963783
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.98271807908538
 MSRVTT_full_val/v2t_metrics/R1: 40.44265593561368
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.231388329979879
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.76717636029969
 MSRVTT_full_test/t2v_metrics/R1: 13.946488294314381
 MSRVTT_full_test/t2v_metrics/R5: 37.725752508361204
 MSRVTT_full_test/t2v_metrics/R10: 51.73913043478261
 MSRVTT_full_test/t2v_metrics/R50: 81.77257525083613
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.437458193979936
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.08204115762779
 MSRVTT_full_test/v2t_metrics/R1: 16.622073578595316
 MSRVTT_full_test/v2t_metrics/R5: 44.48160535117057
 MSRVTT_full_test/v2t_metrics/R10: 60.20066889632107
 MSRVTT_full_test/v2t_metrics/R50: 87.75919732441471
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.88361204013378
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.43961456606078
 mnt_best       : 30.08204115762779
 not_improved_count: 0
Train Epoch: 39 [1/500 64/32000 (0%)] Loss: 0.66725 (QuantReg: 13.70594) QuantErr: 13.70594 batch_time=30.90966 
Train Epoch: 39 [9/500 576/32000 (2%)] Loss: 0.51611 (QuantReg: 13.91562) QuantErr: 13.91562 batch_time=0.38745 
Train Epoch: 39 [17/500 1088/32000 (3%)] Loss: 0.46662 (QuantReg: 13.61441) QuantErr: 13.61441 batch_time=0.39831 
Train Epoch: 39 [25/500 1600/32000 (5%)] Loss: 0.35595 (QuantReg: 13.64315) QuantErr: 13.64315 batch_time=0.39702 
Train Epoch: 39 [33/500 2112/32000 (7%)] Loss: 0.53326 (QuantReg: 13.82130) QuantErr: 13.82130 batch_time=0.38767 
Train Epoch: 39 [41/500 2624/32000 (8%)] Loss: 0.38550 (QuantReg: 14.03338) QuantErr: 14.03338 batch_time=0.39111 
Train Epoch: 39 [49/500 3136/32000 (10%)] Loss: 0.43608 (QuantReg: 13.84781) QuantErr: 13.84781 batch_time=0.38329 
Train Epoch: 39 [57/500 3648/32000 (11%)] Loss: 0.26565 (QuantReg: 14.06882) QuantErr: 14.06882 batch_time=0.39981 
Train Epoch: 39 [65/500 4160/32000 (13%)] Loss: 0.53430 (QuantReg: 13.53063) QuantErr: 13.53063 batch_time=0.62709 
Train Epoch: 39 [73/500 4672/32000 (15%)] Loss: 0.59585 (QuantReg: 13.72190) QuantErr: 13.72190 batch_time=0.39950 
Train Epoch: 39 [81/500 5184/32000 (16%)] Loss: 0.60476 (QuantReg: 13.73755) QuantErr: 13.73755 batch_time=0.40008 
Train Epoch: 39 [89/500 5696/32000 (18%)] Loss: 0.52506 (QuantReg: 13.63767) QuantErr: 13.63767 batch_time=0.39035 
Train Epoch: 39 [97/500 6208/32000 (19%)] Loss: 0.38999 (QuantReg: 13.84270) QuantErr: 13.84270 batch_time=0.39772 
Train Epoch: 39 [105/500 6720/32000 (21%)] Loss: 0.55434 (QuantReg: 13.56274) QuantErr: 13.56274 batch_time=0.41048 
Train Epoch: 39 [113/500 7232/32000 (23%)] Loss: 0.27506 (QuantReg: 13.96391) QuantErr: 13.96391 batch_time=0.38331 
Train Epoch: 39 [121/500 7744/32000 (24%)] Loss: 0.46052 (QuantReg: 14.01737) QuantErr: 14.01737 batch_time=0.39989 
Train Epoch: 39 [129/500 8256/32000 (26%)] Loss: 0.63715 (QuantReg: 13.78179) QuantErr: 13.78179 batch_time=0.59233 
Train Epoch: 39 [137/500 8768/32000 (27%)] Loss: 0.38592 (QuantReg: 14.09070) QuantErr: 14.09070 batch_time=0.40197 
Train Epoch: 39 [145/500 9280/32000 (29%)] Loss: 0.43940 (QuantReg: 13.89601) QuantErr: 13.89601 batch_time=0.39205 
Train Epoch: 39 [153/500 9792/32000 (31%)] Loss: 0.47972 (QuantReg: 13.67633) QuantErr: 13.67633 batch_time=0.38608 
Train Epoch: 39 [161/500 10304/32000 (32%)] Loss: 0.33769 (QuantReg: 13.55052) QuantErr: 13.55052 batch_time=0.38791 
Train Epoch: 39 [169/500 10816/32000 (34%)] Loss: 0.49627 (QuantReg: 13.99773) QuantErr: 13.99773 batch_time=0.40007 
Train Epoch: 39 [177/500 11328/32000 (35%)] Loss: 0.42244 (QuantReg: 13.80302) QuantErr: 13.80302 batch_time=0.39974 
Train Epoch: 39 [185/500 11840/32000 (37%)] Loss: 0.50774 (QuantReg: 13.86223) QuantErr: 13.86223 batch_time=0.41678 
Train Epoch: 39 [193/500 12352/32000 (39%)] Loss: 0.58070 (QuantReg: 14.10810) QuantErr: 14.10810 batch_time=0.62487 
Train Epoch: 39 [201/500 12864/32000 (40%)] Loss: 0.76833 (QuantReg: 13.78454) QuantErr: 13.78454 batch_time=0.38738 
Train Epoch: 39 [209/500 13376/32000 (42%)] Loss: 0.56031 (QuantReg: 14.11553) QuantErr: 14.11553 batch_time=0.46393 
Train Epoch: 39 [217/500 13888/32000 (43%)] Loss: 0.39113 (QuantReg: 13.88378) QuantErr: 13.88378 batch_time=0.38460 
Train Epoch: 39 [225/500 14400/32000 (45%)] Loss: 0.36058 (QuantReg: 14.07146) QuantErr: 14.07146 batch_time=0.38855 
Train Epoch: 39 [233/500 14912/32000 (47%)] Loss: 0.58659 (QuantReg: 13.20638) QuantErr: 13.20638 batch_time=0.38636 
Train Epoch: 39 [241/500 15424/32000 (48%)] Loss: 0.73981 (QuantReg: 13.29309) QuantErr: 13.29309 batch_time=0.39848 
Train Epoch: 39 [249/500 15936/32000 (50%)] Loss: 0.42403 (QuantReg: 14.03682) QuantErr: 14.03682 batch_time=0.39318 
Train Epoch: 39 [257/500 16448/32000 (51%)] Loss: 0.59709 (QuantReg: 13.74883) QuantErr: 13.74883 batch_time=0.62846 
Train Epoch: 39 [265/500 16960/32000 (53%)] Loss: 0.58687 (QuantReg: 13.70145) QuantErr: 13.70145 batch_time=0.39773 
Train Epoch: 39 [273/500 17472/32000 (55%)] Loss: 0.38255 (QuantReg: 13.84517) QuantErr: 13.84517 batch_time=0.39774 
Train Epoch: 39 [281/500 17984/32000 (56%)] Loss: 0.41382 (QuantReg: 14.04229) QuantErr: 14.04229 batch_time=0.38035 
Train Epoch: 39 [289/500 18496/32000 (58%)] Loss: 0.61319 (QuantReg: 13.61079) QuantErr: 13.61079 batch_time=0.39006 
Train Epoch: 39 [297/500 19008/32000 (59%)] Loss: 0.40549 (QuantReg: 13.77039) QuantErr: 13.77039 batch_time=0.38701 
Train Epoch: 39 [305/500 19520/32000 (61%)] Loss: 0.51205 (QuantReg: 14.01410) QuantErr: 14.01410 batch_time=0.39275 
Train Epoch: 39 [313/500 20032/32000 (63%)] Loss: 0.73387 (QuantReg: 13.55022) QuantErr: 13.55022 batch_time=0.40114 
Train Epoch: 39 [321/500 20544/32000 (64%)] Loss: 0.41454 (QuantReg: 13.89576) QuantErr: 13.89576 batch_time=0.61111 
Train Epoch: 39 [329/500 21056/32000 (66%)] Loss: 0.57017 (QuantReg: 13.79553) QuantErr: 13.79553 batch_time=0.40095 
Train Epoch: 39 [337/500 21568/32000 (67%)] Loss: 0.40451 (QuantReg: 13.55134) QuantErr: 13.55134 batch_time=0.42328 
Train Epoch: 39 [345/500 22080/32000 (69%)] Loss: 0.44795 (QuantReg: 13.70997) QuantErr: 13.70997 batch_time=0.38890 
Train Epoch: 39 [353/500 22592/32000 (71%)] Loss: 0.73385 (QuantReg: 13.81053) QuantErr: 13.81053 batch_time=0.38994 
Train Epoch: 39 [361/500 23104/32000 (72%)] Loss: 0.38492 (QuantReg: 13.68437) QuantErr: 13.68437 batch_time=0.37833 
Train Epoch: 39 [369/500 23616/32000 (74%)] Loss: 0.44787 (QuantReg: 14.15907) QuantErr: 14.15907 batch_time=0.40705 
Train Epoch: 39 [377/500 24128/32000 (75%)] Loss: 0.66918 (QuantReg: 13.81959) QuantErr: 13.81959 batch_time=0.39390 
Train Epoch: 39 [385/500 24640/32000 (77%)] Loss: 0.45868 (QuantReg: 13.98335) QuantErr: 13.98335 batch_time=0.65095 
Train Epoch: 39 [393/500 25152/32000 (79%)] Loss: 0.43764 (QuantReg: 14.12929) QuantErr: 14.12929 batch_time=0.40952 
Train Epoch: 39 [401/500 25664/32000 (80%)] Loss: 0.39320 (QuantReg: 14.05122) QuantErr: 14.05122 batch_time=0.40371 
Train Epoch: 39 [409/500 26176/32000 (82%)] Loss: 0.77489 (QuantReg: 14.00108) QuantErr: 14.00108 batch_time=0.38533 
Train Epoch: 39 [417/500 26688/32000 (83%)] Loss: 0.41043 (QuantReg: 14.08941) QuantErr: 14.08941 batch_time=0.38196 
Train Epoch: 39 [425/500 27200/32000 (85%)] Loss: 0.32657 (QuantReg: 13.92947) QuantErr: 13.92947 batch_time=0.38431 
Train Epoch: 39 [433/500 27712/32000 (87%)] Loss: 0.45217 (QuantReg: 14.03749) QuantErr: 14.03749 batch_time=0.38207 
Train Epoch: 39 [441/500 28224/32000 (88%)] Loss: 0.37251 (QuantReg: 14.11394) QuantErr: 14.11394 batch_time=0.40511 
Train Epoch: 39 [449/500 28736/32000 (90%)] Loss: 0.25316 (QuantReg: 14.08517) QuantErr: 14.08517 batch_time=0.62080 
Train Epoch: 39 [457/500 29248/32000 (91%)] Loss: 0.25053 (QuantReg: 14.19232) QuantErr: 14.19232 batch_time=0.43154 
Train Epoch: 39 [465/500 29760/32000 (93%)] Loss: 0.61845 (QuantReg: 13.68690) QuantErr: 13.68690 batch_time=0.39331 
Train Epoch: 39 [473/500 30272/32000 (95%)] Loss: 0.43065 (QuantReg: 13.65799) QuantErr: 13.65799 batch_time=0.39618 
Train Epoch: 39 [481/500 30784/32000 (96%)] Loss: 0.31757 (QuantReg: 14.23694) QuantErr: 14.23694 batch_time=0.41368 
Train Epoch: 39 [489/500 31296/32000 (98%)] Loss: 0.75741 (QuantReg: 13.86556) QuantErr: 13.86556 batch_time=0.40044 
Train Epoch: 39 [497/500 31808/32000 (99%)] Loss: 0.26590 (QuantReg: 13.57774) QuantErr: 13.57774 batch_time=0.38886 
Train Epoch: 39 codebook_update_time=1.88877
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch39.pth ...
Done in 3.865s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch39.pth ...
Done in 7.659s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 0.4970268810093403
 quant_reg      : 13.809000085830688
 quant_err      : 13.809000085830688
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 19500
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.460764587525151
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.07369043244874
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.979879275653923
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.6222728167475
 MSRVTT_full_test/t2v_metrics/R1: 13.979933110367893
 MSRVTT_full_test/t2v_metrics/R5: 39.197324414715716
 MSRVTT_full_test/t2v_metrics/R10: 51.80602006688963
 MSRVTT_full_test/t2v_metrics/R50: 81.53846153846153
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.34280936454849
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.50567099614474
 MSRVTT_full_test/v2t_metrics/R1: 17.4247491638796
 MSRVTT_full_test/v2t_metrics/R5: 45.11705685618729
 MSRVTT_full_test/v2t_metrics/R10: 60.836120401337794
 MSRVTT_full_test/v2t_metrics/R50: 87.45819397993311
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.1190635451505
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.29857720675479
 mnt_best       : 30.50567099614474
 not_improved_count: 0
Train Epoch: 40 [1/500 64/32000 (0%)] Loss: 0.37026 (QuantReg: 13.90830) QuantErr: 13.90830 batch_time=29.33939 
Train Epoch: 40 [9/500 576/32000 (2%)] Loss: 0.47929 (QuantReg: 13.56191) QuantErr: 13.56191 batch_time=0.44657 
Train Epoch: 40 [17/500 1088/32000 (3%)] Loss: 0.33777 (QuantReg: 13.91088) QuantErr: 13.91088 batch_time=0.38576 
Train Epoch: 40 [25/500 1600/32000 (5%)] Loss: 0.77320 (QuantReg: 14.01371) QuantErr: 14.01371 batch_time=0.40044 
Train Epoch: 40 [33/500 2112/32000 (7%)] Loss: 0.42899 (QuantReg: 13.78154) QuantErr: 13.78154 batch_time=0.39735 
Train Epoch: 40 [41/500 2624/32000 (8%)] Loss: 0.83597 (QuantReg: 13.93132) QuantErr: 13.93132 batch_time=0.39076 
Train Epoch: 40 [49/500 3136/32000 (10%)] Loss: 0.68734 (QuantReg: 13.66670) QuantErr: 13.66670 batch_time=0.52115 
Train Epoch: 40 [57/500 3648/32000 (11%)] Loss: 0.26983 (QuantReg: 14.01317) QuantErr: 14.01317 batch_time=0.38496 
Train Epoch: 40 [65/500 4160/32000 (13%)] Loss: 0.48308 (QuantReg: 13.82232) QuantErr: 13.82232 batch_time=0.50112 
Train Epoch: 40 [73/500 4672/32000 (15%)] Loss: 0.33962 (QuantReg: 13.84484) QuantErr: 13.84484 batch_time=0.44675 
Train Epoch: 40 [81/500 5184/32000 (16%)] Loss: 0.64671 (QuantReg: 12.68901) QuantErr: 12.68901 batch_time=0.40231 
Train Epoch: 40 [89/500 5696/32000 (18%)] Loss: 0.73189 (QuantReg: 13.54576) QuantErr: 13.54576 batch_time=0.39855 
Train Epoch: 40 [97/500 6208/32000 (19%)] Loss: 0.62318 (QuantReg: 13.30208) QuantErr: 13.30208 batch_time=0.39503 
Train Epoch: 40 [105/500 6720/32000 (21%)] Loss: 0.61725 (QuantReg: 13.79346) QuantErr: 13.79346 batch_time=0.40828 
Train Epoch: 40 [113/500 7232/32000 (23%)] Loss: 0.24363 (QuantReg: 13.68523) QuantErr: 13.68523 batch_time=0.50038 
Train Epoch: 40 [121/500 7744/32000 (24%)] Loss: 0.46956 (QuantReg: 13.86169) QuantErr: 13.86169 batch_time=0.38762 
Train Epoch: 40 [129/500 8256/32000 (26%)] Loss: 0.52681 (QuantReg: 13.95705) QuantErr: 13.95705 batch_time=0.50579 
Train Epoch: 40 [137/500 8768/32000 (27%)] Loss: 0.44997 (QuantReg: 13.67716) QuantErr: 13.67716 batch_time=0.50778 
Train Epoch: 40 [145/500 9280/32000 (29%)] Loss: 0.48069 (QuantReg: 13.68030) QuantErr: 13.68030 batch_time=0.41146 
Train Epoch: 40 [153/500 9792/32000 (31%)] Loss: 0.34529 (QuantReg: 14.03217) QuantErr: 14.03217 batch_time=0.40243 
Train Epoch: 40 [161/500 10304/32000 (32%)] Loss: 0.51196 (QuantReg: 14.01030) QuantErr: 14.01030 batch_time=0.41388 
Train Epoch: 40 [169/500 10816/32000 (34%)] Loss: 0.73766 (QuantReg: 13.43851) QuantErr: 13.43851 batch_time=0.40443 
Train Epoch: 40 [177/500 11328/32000 (35%)] Loss: 0.56191 (QuantReg: 13.71054) QuantErr: 13.71054 batch_time=0.51643 
Train Epoch: 40 [185/500 11840/32000 (37%)] Loss: 0.49082 (QuantReg: 14.07516) QuantErr: 14.07516 batch_time=0.40163 
Train Epoch: 40 [193/500 12352/32000 (39%)] Loss: 0.53828 (QuantReg: 13.95185) QuantErr: 13.95185 batch_time=0.50583 
Train Epoch: 40 [201/500 12864/32000 (40%)] Loss: 0.55127 (QuantReg: 13.83689) QuantErr: 13.83689 batch_time=0.44762 
Train Epoch: 40 [209/500 13376/32000 (42%)] Loss: 0.40005 (QuantReg: 13.96528) QuantErr: 13.96528 batch_time=0.39119 
Train Epoch: 40 [217/500 13888/32000 (43%)] Loss: 0.43276 (QuantReg: 13.65472) QuantErr: 13.65472 batch_time=0.39285 
Train Epoch: 40 [225/500 14400/32000 (45%)] Loss: 0.46548 (QuantReg: 13.80866) QuantErr: 13.80866 batch_time=0.45048 
Train Epoch: 40 [233/500 14912/32000 (47%)] Loss: 0.27292 (QuantReg: 13.90745) QuantErr: 13.90745 batch_time=0.43203 
Train Epoch: 40 [241/500 15424/32000 (48%)] Loss: 0.46420 (QuantReg: 14.01069) QuantErr: 14.01069 batch_time=0.56241 
Train Epoch: 40 [249/500 15936/32000 (50%)] Loss: 0.35975 (QuantReg: 14.09340) QuantErr: 14.09340 batch_time=0.40286 
Train Epoch: 40 [257/500 16448/32000 (51%)] Loss: 0.57335 (QuantReg: 13.92266) QuantErr: 13.92266 batch_time=0.49772 
Train Epoch: 40 [265/500 16960/32000 (53%)] Loss: 0.25493 (QuantReg: 14.14391) QuantErr: 14.14391 batch_time=0.44964 
Train Epoch: 40 [273/500 17472/32000 (55%)] Loss: 0.60925 (QuantReg: 13.78493) QuantErr: 13.78493 batch_time=0.42574 
Train Epoch: 40 [281/500 17984/32000 (56%)] Loss: 0.36337 (QuantReg: 13.81225) QuantErr: 13.81225 batch_time=0.40005 
Train Epoch: 40 [289/500 18496/32000 (58%)] Loss: 0.41881 (QuantReg: 13.34865) QuantErr: 13.34865 batch_time=0.40082 
Train Epoch: 40 [297/500 19008/32000 (59%)] Loss: 0.43617 (QuantReg: 13.90386) QuantErr: 13.90386 batch_time=0.38541 
Train Epoch: 40 [305/500 19520/32000 (61%)] Loss: 0.56841 (QuantReg: 14.00315) QuantErr: 14.00315 batch_time=0.51213 
Train Epoch: 40 [313/500 20032/32000 (63%)] Loss: 0.64479 (QuantReg: 13.67955) QuantErr: 13.67955 batch_time=0.39612 
Train Epoch: 40 [321/500 20544/32000 (64%)] Loss: 0.63810 (QuantReg: 13.66994) QuantErr: 13.66994 batch_time=0.49637 
Train Epoch: 40 [329/500 21056/32000 (66%)] Loss: 0.45664 (QuantReg: 13.37134) QuantErr: 13.37134 batch_time=0.44362 
Train Epoch: 40 [337/500 21568/32000 (67%)] Loss: 0.80950 (QuantReg: 13.84314) QuantErr: 13.84314 batch_time=0.38152 
Train Epoch: 40 [345/500 22080/32000 (69%)] Loss: 0.49812 (QuantReg: 14.20081) QuantErr: 14.20081 batch_time=0.65073 
Train Epoch: 40 [353/500 22592/32000 (71%)] Loss: 0.51788 (QuantReg: 13.79704) QuantErr: 13.79704 batch_time=0.39985 
Train Epoch: 40 [361/500 23104/32000 (72%)] Loss: 0.37485 (QuantReg: 13.92047) QuantErr: 13.92047 batch_time=0.39516 
Train Epoch: 40 [369/500 23616/32000 (74%)] Loss: 0.52266 (QuantReg: 13.66968) QuantErr: 13.66968 batch_time=0.38910 
Train Epoch: 40 [377/500 24128/32000 (75%)] Loss: 0.53178 (QuantReg: 13.87284) QuantErr: 13.87284 batch_time=0.39583 
Train Epoch: 40 [385/500 24640/32000 (77%)] Loss: 0.45048 (QuantReg: 13.94877) QuantErr: 13.94877 batch_time=0.42370 
Train Epoch: 40 [393/500 25152/32000 (79%)] Loss: 0.85182 (QuantReg: 13.46162) QuantErr: 13.46162 batch_time=0.41698 
Train Epoch: 40 [401/500 25664/32000 (80%)] Loss: 0.74335 (QuantReg: 13.73004) QuantErr: 13.73004 batch_time=0.39569 
Train Epoch: 40 [409/500 26176/32000 (82%)] Loss: 0.51890 (QuantReg: 13.67924) QuantErr: 13.67924 batch_time=0.39802 
Train Epoch: 40 [417/500 26688/32000 (83%)] Loss: 0.75857 (QuantReg: 13.69920) QuantErr: 13.69920 batch_time=0.38564 
Train Epoch: 40 [425/500 27200/32000 (85%)] Loss: 0.41487 (QuantReg: 13.55551) QuantErr: 13.55551 batch_time=0.39967 
Train Epoch: 40 [433/500 27712/32000 (87%)] Loss: 0.74675 (QuantReg: 13.88948) QuantErr: 13.88948 batch_time=0.40138 
Train Epoch: 40 [441/500 28224/32000 (88%)] Loss: 0.62900 (QuantReg: 13.77616) QuantErr: 13.77616 batch_time=0.40160 
Train Epoch: 40 [449/500 28736/32000 (90%)] Loss: 0.45003 (QuantReg: 13.92879) QuantErr: 13.92879 batch_time=0.39429 
Train Epoch: 40 [457/500 29248/32000 (91%)] Loss: 0.75237 (QuantReg: 13.82402) QuantErr: 13.82402 batch_time=0.39353 
Train Epoch: 40 [465/500 29760/32000 (93%)] Loss: 0.66608 (QuantReg: 13.77985) QuantErr: 13.77985 batch_time=0.39592 
Train Epoch: 40 [473/500 30272/32000 (95%)] Loss: 0.48816 (QuantReg: 13.79510) QuantErr: 13.79510 batch_time=0.39249 
Train Epoch: 40 [481/500 30784/32000 (96%)] Loss: 0.39567 (QuantReg: 13.90466) QuantErr: 13.90466 batch_time=0.39290 
Train Epoch: 40 [489/500 31296/32000 (98%)] Loss: 0.61851 (QuantReg: 13.65199) QuantErr: 13.65199 batch_time=0.39969 
Train Epoch: 40 [497/500 31808/32000 (99%)] Loss: 0.56863 (QuantReg: 13.84179) QuantErr: 13.84179 batch_time=0.38550 
Train Epoch: 40 codebook_update_time=2.25415
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch40.pth ...
Done in 4.121s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch40.pth ...
Done in 7.989s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 0.5014707060456276
 quant_reg      : 13.800566455841064
 quant_err      : 13.800566455841064
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 20000
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.780684104627767
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.33124222142852
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.869215291750503
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.43685185925735
 MSRVTT_full_test/t2v_metrics/R1: 14.548494983277592
 MSRVTT_full_test/t2v_metrics/R5: 38.46153846153846
 MSRVTT_full_test/t2v_metrics/R10: 51.90635451505017
 MSRVTT_full_test/t2v_metrics/R50: 81.10367892976589
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.55418060200669
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.7389066762136
 MSRVTT_full_test/v2t_metrics/R1: 16.421404682274247
 MSRVTT_full_test/v2t_metrics/R5: 44.34782608695652
 MSRVTT_full_test/v2t_metrics/R10: 59.86622073578595
 MSRVTT_full_test/v2t_metrics/R50: 87.29096989966555
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.06321070234114
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.1955827754243
 mnt_best       : 30.7389066762136
 not_improved_count: 0
Train Epoch: 41 [1/500 64/32000 (0%)] Loss: 0.58437 (QuantReg: 13.50257) QuantErr: 13.50257 batch_time=32.18500 
Train Epoch: 41 [9/500 576/32000 (2%)] Loss: 0.51482 (QuantReg: 13.87696) QuantErr: 13.87696 batch_time=0.39594 
Train Epoch: 41 [17/500 1088/32000 (3%)] Loss: 0.56670 (QuantReg: 13.79694) QuantErr: 13.79694 batch_time=0.40648 
Train Epoch: 41 [25/500 1600/32000 (5%)] Loss: 0.30313 (QuantReg: 13.59910) QuantErr: 13.59910 batch_time=0.42348 
Train Epoch: 41 [33/500 2112/32000 (7%)] Loss: 0.39736 (QuantReg: 13.44371) QuantErr: 13.44371 batch_time=0.41698 
Train Epoch: 41 [41/500 2624/32000 (8%)] Loss: 0.31903 (QuantReg: 13.92941) QuantErr: 13.92941 batch_time=0.42153 
Train Epoch: 41 [49/500 3136/32000 (10%)] Loss: 0.54406 (QuantReg: 13.99485) QuantErr: 13.99485 batch_time=0.39385 
Train Epoch: 41 [57/500 3648/32000 (11%)] Loss: 0.34461 (QuantReg: 13.96944) QuantErr: 13.96944 batch_time=0.39052 
Train Epoch: 41 [65/500 4160/32000 (13%)] Loss: 0.32651 (QuantReg: 13.75695) QuantErr: 13.75695 batch_time=0.92087 
Train Epoch: 41 [73/500 4672/32000 (15%)] Loss: 0.56199 (QuantReg: 13.90090) QuantErr: 13.90090 batch_time=0.40611 
Train Epoch: 41 [81/500 5184/32000 (16%)] Loss: 0.37853 (QuantReg: 13.68307) QuantErr: 13.68307 batch_time=0.39540 
Train Epoch: 41 [89/500 5696/32000 (18%)] Loss: 0.45795 (QuantReg: 13.62342) QuantErr: 13.62342 batch_time=0.38737 
Train Epoch: 41 [97/500 6208/32000 (19%)] Loss: 0.57379 (QuantReg: 13.60102) QuantErr: 13.60102 batch_time=0.39948 
Train Epoch: 41 [105/500 6720/32000 (21%)] Loss: 0.67429 (QuantReg: 13.54484) QuantErr: 13.54484 batch_time=0.45552 
Train Epoch: 41 [113/500 7232/32000 (23%)] Loss: 0.73068 (QuantReg: 14.03624) QuantErr: 14.03624 batch_time=0.39732 
Train Epoch: 41 [121/500 7744/32000 (24%)] Loss: 0.54991 (QuantReg: 13.70346) QuantErr: 13.70346 batch_time=0.39385 
Train Epoch: 41 [129/500 8256/32000 (26%)] Loss: 0.31522 (QuantReg: 13.44713) QuantErr: 13.44713 batch_time=0.94274 
Train Epoch: 41 [137/500 8768/32000 (27%)] Loss: 0.50100 (QuantReg: 13.69139) QuantErr: 13.69139 batch_time=0.40313 
Train Epoch: 41 [145/500 9280/32000 (29%)] Loss: 0.43041 (QuantReg: 13.65421) QuantErr: 13.65421 batch_time=0.41504 
Train Epoch: 41 [153/500 9792/32000 (31%)] Loss: 0.61973 (QuantReg: 13.82028) QuantErr: 13.82028 batch_time=0.39021 
Train Epoch: 41 [161/500 10304/32000 (32%)] Loss: 0.52888 (QuantReg: 13.83824) QuantErr: 13.83824 batch_time=0.39759 
Train Epoch: 41 [169/500 10816/32000 (34%)] Loss: 0.50504 (QuantReg: 13.89050) QuantErr: 13.89050 batch_time=0.39255 
Train Epoch: 41 [177/500 11328/32000 (35%)] Loss: 0.30883 (QuantReg: 13.86111) QuantErr: 13.86111 batch_time=0.42501 
Train Epoch: 41 [185/500 11840/32000 (37%)] Loss: 0.47265 (QuantReg: 14.09634) QuantErr: 14.09634 batch_time=0.42044 
Train Epoch: 41 [193/500 12352/32000 (39%)] Loss: 0.65983 (QuantReg: 13.93542) QuantErr: 13.93542 batch_time=0.95553 
Train Epoch: 41 [201/500 12864/32000 (40%)] Loss: 0.52562 (QuantReg: 13.45970) QuantErr: 13.45970 batch_time=0.40870 
Train Epoch: 41 [209/500 13376/32000 (42%)] Loss: 0.41457 (QuantReg: 14.16148) QuantErr: 14.16148 batch_time=0.39786 
Train Epoch: 41 [217/500 13888/32000 (43%)] Loss: 0.57973 (QuantReg: 13.86712) QuantErr: 13.86712 batch_time=0.39815 
Train Epoch: 41 [225/500 14400/32000 (45%)] Loss: 0.30486 (QuantReg: 13.98250) QuantErr: 13.98250 batch_time=0.40526 
Train Epoch: 41 [233/500 14912/32000 (47%)] Loss: 0.46212 (QuantReg: 14.05045) QuantErr: 14.05045 batch_time=0.40532 
Train Epoch: 41 [241/500 15424/32000 (48%)] Loss: 0.63535 (QuantReg: 13.99229) QuantErr: 13.99229 batch_time=0.39831 
Train Epoch: 41 [249/500 15936/32000 (50%)] Loss: 0.34708 (QuantReg: 13.76046) QuantErr: 13.76046 batch_time=0.40221 
Train Epoch: 41 [257/500 16448/32000 (51%)] Loss: 0.74203 (QuantReg: 13.30158) QuantErr: 13.30158 batch_time=1.03056 
Train Epoch: 41 [265/500 16960/32000 (53%)] Loss: 0.26447 (QuantReg: 13.86049) QuantErr: 13.86049 batch_time=0.39074 
Train Epoch: 41 [273/500 17472/32000 (55%)] Loss: 0.87048 (QuantReg: 13.60153) QuantErr: 13.60153 batch_time=0.39145 
Train Epoch: 41 [281/500 17984/32000 (56%)] Loss: 0.47288 (QuantReg: 13.80940) QuantErr: 13.80940 batch_time=0.39493 
Train Epoch: 41 [289/500 18496/32000 (58%)] Loss: 0.50106 (QuantReg: 13.95111) QuantErr: 13.95111 batch_time=0.39818 
Train Epoch: 41 [297/500 19008/32000 (59%)] Loss: 0.39582 (QuantReg: 14.04896) QuantErr: 14.04896 batch_time=0.39532 
Train Epoch: 41 [305/500 19520/32000 (61%)] Loss: 0.28187 (QuantReg: 13.45133) QuantErr: 13.45133 batch_time=0.39923 
Train Epoch: 41 [313/500 20032/32000 (63%)] Loss: 0.63603 (QuantReg: 13.75252) QuantErr: 13.75252 batch_time=0.40562 
Train Epoch: 41 [321/500 20544/32000 (64%)] Loss: 0.64296 (QuantReg: 13.49690) QuantErr: 13.49690 batch_time=0.85783 
Train Epoch: 41 [329/500 21056/32000 (66%)] Loss: 0.84841 (QuantReg: 13.32477) QuantErr: 13.32477 batch_time=0.39852 
Train Epoch: 41 [337/500 21568/32000 (67%)] Loss: 0.33441 (QuantReg: 13.97722) QuantErr: 13.97722 batch_time=0.38961 
Train Epoch: 41 [345/500 22080/32000 (69%)] Loss: 0.52099 (QuantReg: 14.20099) QuantErr: 14.20099 batch_time=0.39218 
Train Epoch: 41 [353/500 22592/32000 (71%)] Loss: 0.65094 (QuantReg: 14.01529) QuantErr: 14.01529 batch_time=0.38798 
Train Epoch: 41 [361/500 23104/32000 (72%)] Loss: 0.56815 (QuantReg: 13.80300) QuantErr: 13.80300 batch_time=0.42108 
Train Epoch: 41 [369/500 23616/32000 (74%)] Loss: 0.52107 (QuantReg: 13.85199) QuantErr: 13.85199 batch_time=0.38950 
Train Epoch: 41 [377/500 24128/32000 (75%)] Loss: 0.64781 (QuantReg: 13.89980) QuantErr: 13.89980 batch_time=0.39196 
Train Epoch: 41 [385/500 24640/32000 (77%)] Loss: 0.19451 (QuantReg: 13.94777) QuantErr: 13.94777 batch_time=0.94697 
Train Epoch: 41 [393/500 25152/32000 (79%)] Loss: 0.57227 (QuantReg: 13.73543) QuantErr: 13.73543 batch_time=0.41761 
Train Epoch: 41 [401/500 25664/32000 (80%)] Loss: 0.55078 (QuantReg: 13.64764) QuantErr: 13.64764 batch_time=0.41202 
Train Epoch: 41 [409/500 26176/32000 (82%)] Loss: 0.45301 (QuantReg: 13.98724) QuantErr: 13.98724 batch_time=0.40643 
Train Epoch: 41 [417/500 26688/32000 (83%)] Loss: 0.38345 (QuantReg: 14.12844) QuantErr: 14.12844 batch_time=0.40114 
Train Epoch: 41 [425/500 27200/32000 (85%)] Loss: 0.61726 (QuantReg: 13.90071) QuantErr: 13.90071 batch_time=0.40596 
Train Epoch: 41 [433/500 27712/32000 (87%)] Loss: 0.45249 (QuantReg: 13.87016) QuantErr: 13.87016 batch_time=0.43841 
Train Epoch: 41 [441/500 28224/32000 (88%)] Loss: 0.33845 (QuantReg: 13.64061) QuantErr: 13.64061 batch_time=0.39047 
Train Epoch: 41 [449/500 28736/32000 (90%)] Loss: 0.50414 (QuantReg: 13.65666) QuantErr: 13.65666 batch_time=0.40043 
Train Epoch: 41 [457/500 29248/32000 (91%)] Loss: 0.26696 (QuantReg: 13.83225) QuantErr: 13.83225 batch_time=0.40419 
Train Epoch: 41 [465/500 29760/32000 (93%)] Loss: 0.42890 (QuantReg: 13.52234) QuantErr: 13.52234 batch_time=0.43704 
Train Epoch: 41 [473/500 30272/32000 (95%)] Loss: 0.40810 (QuantReg: 13.88543) QuantErr: 13.88543 batch_time=0.43327 
Train Epoch: 41 [481/500 30784/32000 (96%)] Loss: 0.51961 (QuantReg: 13.67475) QuantErr: 13.67475 batch_time=0.43625 
Train Epoch: 41 [489/500 31296/32000 (98%)] Loss: 0.59304 (QuantReg: 13.64083) QuantErr: 13.64083 batch_time=0.39124 
Train Epoch: 41 [497/500 31808/32000 (99%)] Loss: 0.22712 (QuantReg: 13.87298) QuantErr: 13.87298 batch_time=0.40343 
Train Epoch: 41 codebook_update_time=3.22744
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch41.pth ...
Done in 4.082s
removing stale ckpt [epoch 40] [took 0.00s]
 epoch          : 41
 loss           : 0.4889271188080311
 quant_reg      : 13.819688814163207
 quant_err      : 13.819688814163207
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 20500
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 73.03822937625755
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.160965794768611
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.79264014999615
 MSRVTT_full_val/v2t_metrics/R1: 41.04627766599597
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.861167002012072
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.50780868914502
 MSRVTT_full_test/t2v_metrics/R1: 14.11371237458194
 MSRVTT_full_test/t2v_metrics/R5: 38.79598662207358
 MSRVTT_full_test/t2v_metrics/R10: 52.441471571906355
 MSRVTT_full_test/t2v_metrics/R50: 82.54180602006689
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.59130434782609
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.622053519220014
 MSRVTT_full_test/v2t_metrics/R1: 17.29096989966555
 MSRVTT_full_test/v2t_metrics/R5: 45.25083612040134
 MSRVTT_full_test/v2t_metrics/R10: 61.40468227424749
 MSRVTT_full_test/v2t_metrics/R50: 87.29096989966555
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.21571906354515
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.35374449404345
 mnt_best       : 30.7389066762136
 not_improved_count: 1
Train Epoch: 42 [1/500 64/32000 (0%)] Loss: 0.55292 (QuantReg: 13.60364) QuantErr: 13.60364 batch_time=31.91586 
Train Epoch: 42 [9/500 576/32000 (2%)] Loss: 0.29749 (QuantReg: 14.04818) QuantErr: 14.04818 batch_time=0.38761 
Train Epoch: 42 [17/500 1088/32000 (3%)] Loss: 0.55996 (QuantReg: 13.64531) QuantErr: 13.64531 batch_time=0.40943 
Train Epoch: 42 [25/500 1600/32000 (5%)] Loss: 0.75951 (QuantReg: 13.55030) QuantErr: 13.55030 batch_time=0.39194 
Train Epoch: 42 [33/500 2112/32000 (7%)] Loss: 0.43355 (QuantReg: 13.65945) QuantErr: 13.65945 batch_time=0.77442 
Train Epoch: 42 [41/500 2624/32000 (8%)] Loss: 0.76184 (QuantReg: 13.59489) QuantErr: 13.59489 batch_time=0.39380 
Train Epoch: 42 [49/500 3136/32000 (10%)] Loss: 0.50694 (QuantReg: 13.96839) QuantErr: 13.96839 batch_time=0.45135 
Train Epoch: 42 [57/500 3648/32000 (11%)] Loss: 0.46038 (QuantReg: 14.02366) QuantErr: 14.02366 batch_time=0.39949 
Train Epoch: 42 [65/500 4160/32000 (13%)] Loss: 0.33972 (QuantReg: 13.82242) QuantErr: 13.82242 batch_time=0.95154 
Train Epoch: 42 [73/500 4672/32000 (15%)] Loss: 0.37936 (QuantReg: 13.72198) QuantErr: 13.72198 batch_time=0.40588 
Train Epoch: 42 [81/500 5184/32000 (16%)] Loss: 0.61689 (QuantReg: 13.28949) QuantErr: 13.28949 batch_time=0.41046 
Train Epoch: 42 [89/500 5696/32000 (18%)] Loss: 0.28750 (QuantReg: 13.90230) QuantErr: 13.90230 batch_time=0.39414 
Train Epoch: 42 [97/500 6208/32000 (19%)] Loss: 0.39314 (QuantReg: 13.97098) QuantErr: 13.97098 batch_time=0.75686 
Train Epoch: 42 [105/500 6720/32000 (21%)] Loss: 0.51332 (QuantReg: 13.78378) QuantErr: 13.78378 batch_time=0.45428 
Train Epoch: 42 [113/500 7232/32000 (23%)] Loss: 0.78089 (QuantReg: 13.43082) QuantErr: 13.43082 batch_time=0.45920 
Train Epoch: 42 [121/500 7744/32000 (24%)] Loss: 0.45328 (QuantReg: 14.14629) QuantErr: 14.14629 batch_time=0.41703 
Train Epoch: 42 [129/500 8256/32000 (26%)] Loss: 0.45060 (QuantReg: 13.74247) QuantErr: 13.74247 batch_time=0.42075 
Train Epoch: 42 [137/500 8768/32000 (27%)] Loss: 0.48623 (QuantReg: 13.64135) QuantErr: 13.64135 batch_time=0.39422 
Train Epoch: 42 [145/500 9280/32000 (29%)] Loss: 0.60385 (QuantReg: 13.76668) QuantErr: 13.76668 batch_time=0.39817 
Train Epoch: 42 [153/500 9792/32000 (31%)] Loss: 0.37092 (QuantReg: 14.11471) QuantErr: 14.11471 batch_time=0.40079 
Train Epoch: 42 [161/500 10304/32000 (32%)] Loss: 0.38185 (QuantReg: 13.77530) QuantErr: 13.77530 batch_time=0.72549 
Train Epoch: 42 [169/500 10816/32000 (34%)] Loss: 0.42508 (QuantReg: 13.71727) QuantErr: 13.71727 batch_time=0.40576 
Train Epoch: 42 [177/500 11328/32000 (35%)] Loss: 0.51645 (QuantReg: 13.75239) QuantErr: 13.75239 batch_time=0.44897 
Train Epoch: 42 [185/500 11840/32000 (37%)] Loss: 0.44293 (QuantReg: 14.08035) QuantErr: 14.08035 batch_time=0.39118 
Train Epoch: 42 [193/500 12352/32000 (39%)] Loss: 0.55340 (QuantReg: 13.76843) QuantErr: 13.76843 batch_time=0.38434 
Train Epoch: 42 [201/500 12864/32000 (40%)] Loss: 0.43617 (QuantReg: 13.62713) QuantErr: 13.62713 batch_time=0.40674 
Train Epoch: 42 [209/500 13376/32000 (42%)] Loss: 0.30635 (QuantReg: 14.04127) QuantErr: 14.04127 batch_time=0.39461 
Train Epoch: 42 [217/500 13888/32000 (43%)] Loss: 0.42704 (QuantReg: 13.94523) QuantErr: 13.94523 batch_time=0.38967 
Train Epoch: 42 [225/500 14400/32000 (45%)] Loss: 0.64790 (QuantReg: 13.82848) QuantErr: 13.82848 batch_time=0.74924 
Train Epoch: 42 [233/500 14912/32000 (47%)] Loss: 0.92277 (QuantReg: 13.73273) QuantErr: 13.73273 batch_time=0.38935 
Train Epoch: 42 [241/500 15424/32000 (48%)] Loss: 0.22714 (QuantReg: 13.86848) QuantErr: 13.86848 batch_time=0.46576 
Train Epoch: 42 [249/500 15936/32000 (50%)] Loss: 0.45515 (QuantReg: 13.87768) QuantErr: 13.87768 batch_time=0.40110 
Train Epoch: 42 [257/500 16448/32000 (51%)] Loss: 0.44473 (QuantReg: 13.92441) QuantErr: 13.92441 batch_time=0.40733 
Train Epoch: 42 [265/500 16960/32000 (53%)] Loss: 0.63884 (QuantReg: 13.85207) QuantErr: 13.85207 batch_time=0.39683 
Train Epoch: 42 [273/500 17472/32000 (55%)] Loss: 0.44967 (QuantReg: 13.77644) QuantErr: 13.77644 batch_time=0.39699 
Train Epoch: 42 [281/500 17984/32000 (56%)] Loss: 0.20591 (QuantReg: 14.01675) QuantErr: 14.01675 batch_time=0.40533 
Train Epoch: 42 [289/500 18496/32000 (58%)] Loss: 0.32780 (QuantReg: 13.94497) QuantErr: 13.94497 batch_time=0.75016 
Train Epoch: 42 [297/500 19008/32000 (59%)] Loss: 0.52593 (QuantReg: 14.18058) QuantErr: 14.18058 batch_time=0.46622 
Train Epoch: 42 [305/500 19520/32000 (61%)] Loss: 0.31007 (QuantReg: 13.88227) QuantErr: 13.88227 batch_time=0.48076 
Train Epoch: 42 [313/500 20032/32000 (63%)] Loss: 0.74658 (QuantReg: 13.74197) QuantErr: 13.74197 batch_time=0.40948 
Train Epoch: 42 [321/500 20544/32000 (64%)] Loss: 0.59370 (QuantReg: 13.94163) QuantErr: 13.94163 batch_time=0.40949 
Train Epoch: 42 [329/500 21056/32000 (66%)] Loss: 0.65544 (QuantReg: 13.54626) QuantErr: 13.54626 batch_time=0.40217 
Train Epoch: 42 [337/500 21568/32000 (67%)] Loss: 0.49906 (QuantReg: 13.80774) QuantErr: 13.80774 batch_time=0.39880 
Train Epoch: 42 [345/500 22080/32000 (69%)] Loss: 0.49151 (QuantReg: 13.57194) QuantErr: 13.57194 batch_time=0.40847 
Train Epoch: 42 [353/500 22592/32000 (71%)] Loss: 0.29838 (QuantReg: 14.22304) QuantErr: 14.22304 batch_time=0.73538 
Train Epoch: 42 [361/500 23104/32000 (72%)] Loss: 0.31110 (QuantReg: 14.26842) QuantErr: 14.26842 batch_time=0.38904 
Train Epoch: 42 [369/500 23616/32000 (74%)] Loss: 0.68787 (QuantReg: 13.76373) QuantErr: 13.76373 batch_time=0.44544 
Train Epoch: 42 [377/500 24128/32000 (75%)] Loss: 0.24575 (QuantReg: 14.11293) QuantErr: 14.11293 batch_time=0.40605 
Train Epoch: 42 [385/500 24640/32000 (77%)] Loss: 0.30329 (QuantReg: 14.00388) QuantErr: 14.00388 batch_time=0.39373 
Train Epoch: 42 [393/500 25152/32000 (79%)] Loss: 0.50296 (QuantReg: 13.65399) QuantErr: 13.65399 batch_time=0.39373 
Train Epoch: 42 [401/500 25664/32000 (80%)] Loss: 0.35748 (QuantReg: 14.19161) QuantErr: 14.19161 batch_time=0.40421 
Train Epoch: 42 [409/500 26176/32000 (82%)] Loss: 0.55429 (QuantReg: 13.85156) QuantErr: 13.85156 batch_time=0.42063 
Train Epoch: 42 [417/500 26688/32000 (83%)] Loss: 0.49205 (QuantReg: 14.01166) QuantErr: 14.01166 batch_time=0.42655 
Train Epoch: 42 [425/500 27200/32000 (85%)] Loss: 0.73475 (QuantReg: 13.41636) QuantErr: 13.41636 batch_time=0.40622 
Train Epoch: 42 [433/500 27712/32000 (87%)] Loss: 0.36171 (QuantReg: 13.78009) QuantErr: 13.78009 batch_time=0.40085 
Train Epoch: 42 [441/500 28224/32000 (88%)] Loss: 0.46372 (QuantReg: 13.88897) QuantErr: 13.88897 batch_time=0.39023 
Train Epoch: 42 [449/500 28736/32000 (90%)] Loss: 0.57312 (QuantReg: 13.88343) QuantErr: 13.88343 batch_time=0.39606 
Train Epoch: 42 [457/500 29248/32000 (91%)] Loss: 0.35201 (QuantReg: 13.96265) QuantErr: 13.96265 batch_time=0.38699 
Train Epoch: 42 [465/500 29760/32000 (93%)] Loss: 0.63677 (QuantReg: 14.12239) QuantErr: 14.12239 batch_time=0.39662 
Train Epoch: 42 [473/500 30272/32000 (95%)] Loss: 0.64325 (QuantReg: 13.89097) QuantErr: 13.89097 batch_time=0.42266 
Train Epoch: 42 [481/500 30784/32000 (96%)] Loss: 0.31143 (QuantReg: 13.82656) QuantErr: 13.82656 batch_time=0.39338 
Train Epoch: 42 [489/500 31296/32000 (98%)] Loss: 0.50284 (QuantReg: 13.45037) QuantErr: 13.45037 batch_time=0.39491 
Train Epoch: 42 [497/500 31808/32000 (99%)] Loss: 0.40871 (QuantReg: 13.67088) QuantErr: 13.67088 batch_time=0.40742 
Train Epoch: 42 codebook_update_time=1.92598
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch42.pth ...
Done in 3.882s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 0.48996261587738993
 quant_reg      : 13.813665956497193
 quant_err      : 13.813665956497193
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 21000
 MSRVTT_full_val/t2v_metrics/R1: 33.601609657947684
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.18712273641851
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.08010477407153
 MSRVTT_full_val/v2t_metrics/R1: 40.84507042253521
 MSRVTT_full_val/v2t_metrics/R5: 78.47082494969818
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.82897384305835
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.46264947531712
 MSRVTT_full_test/t2v_metrics/R1: 14.046822742474916
 MSRVTT_full_test/t2v_metrics/R5: 39.063545150501675
 MSRVTT_full_test/t2v_metrics/R10: 51.90635451505017
 MSRVTT_full_test/t2v_metrics/R50: 82.24080267558529
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.04882943143813
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.539137102936884
 MSRVTT_full_test/v2t_metrics/R1: 17.05685618729097
 MSRVTT_full_test/v2t_metrics/R5: 45.25083612040134
 MSRVTT_full_test/v2t_metrics/R10: 60.468227424749166
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.19364548494983
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.004015883370236
 mnt_best       : 30.7389066762136
 not_improved_count: 2
Train Epoch: 43 [1/500 64/32000 (0%)] Loss: 0.56294 (QuantReg: 13.99164) QuantErr: 13.99164 batch_time=30.83494 
Train Epoch: 43 [9/500 576/32000 (2%)] Loss: 0.47693 (QuantReg: 13.99934) QuantErr: 13.99934 batch_time=0.66347 
Train Epoch: 43 [17/500 1088/32000 (3%)] Loss: 0.46478 (QuantReg: 13.88198) QuantErr: 13.88198 batch_time=0.38648 
Train Epoch: 43 [25/500 1600/32000 (5%)] Loss: 0.40915 (QuantReg: 14.04560) QuantErr: 14.04560 batch_time=0.40173 
Train Epoch: 43 [33/500 2112/32000 (7%)] Loss: 0.40409 (QuantReg: 13.87974) QuantErr: 13.87974 batch_time=0.40219 
Train Epoch: 43 [41/500 2624/32000 (8%)] Loss: 0.59868 (QuantReg: 13.44675) QuantErr: 13.44675 batch_time=0.42096 
Train Epoch: 43 [49/500 3136/32000 (10%)] Loss: 0.43071 (QuantReg: 13.92542) QuantErr: 13.92542 batch_time=0.38857 
Train Epoch: 43 [57/500 3648/32000 (11%)] Loss: 0.43676 (QuantReg: 13.89760) QuantErr: 13.89760 batch_time=0.73913 
Train Epoch: 43 [65/500 4160/32000 (13%)] Loss: 0.54880 (QuantReg: 13.84002) QuantErr: 13.84002 batch_time=0.71907 
Train Epoch: 43 [73/500 4672/32000 (15%)] Loss: 0.36459 (QuantReg: 13.98380) QuantErr: 13.98380 batch_time=0.40304 
Train Epoch: 43 [81/500 5184/32000 (16%)] Loss: 0.66014 (QuantReg: 13.84465) QuantErr: 13.84465 batch_time=0.39068 
Train Epoch: 43 [89/500 5696/32000 (18%)] Loss: 0.42860 (QuantReg: 14.05982) QuantErr: 14.05982 batch_time=0.40077 
Train Epoch: 43 [97/500 6208/32000 (19%)] Loss: 0.40549 (QuantReg: 13.94547) QuantErr: 13.94547 batch_time=0.39226 
Train Epoch: 43 [105/500 6720/32000 (21%)] Loss: 0.51040 (QuantReg: 13.74773) QuantErr: 13.74773 batch_time=0.39939 
Train Epoch: 43 [113/500 7232/32000 (23%)] Loss: 0.42490 (QuantReg: 14.01701) QuantErr: 14.01701 batch_time=0.39549 
Train Epoch: 43 [121/500 7744/32000 (24%)] Loss: 0.32824 (QuantReg: 14.08101) QuantErr: 14.08101 batch_time=0.39270 
Train Epoch: 43 [129/500 8256/32000 (26%)] Loss: 0.39730 (QuantReg: 13.92719) QuantErr: 13.92719 batch_time=0.39692 
Train Epoch: 43 [137/500 8768/32000 (27%)] Loss: 0.35244 (QuantReg: 14.06205) QuantErr: 14.06205 batch_time=0.39205 
Train Epoch: 43 [145/500 9280/32000 (29%)] Loss: 0.35123 (QuantReg: 13.77829) QuantErr: 13.77829 batch_time=0.39507 
Train Epoch: 43 [153/500 9792/32000 (31%)] Loss: 0.32896 (QuantReg: 13.66688) QuantErr: 13.66688 batch_time=0.39171 
Train Epoch: 43 [161/500 10304/32000 (32%)] Loss: 0.71936 (QuantReg: 13.87407) QuantErr: 13.87407 batch_time=0.43824 
Train Epoch: 43 [169/500 10816/32000 (34%)] Loss: 0.30904 (QuantReg: 13.78013) QuantErr: 13.78013 batch_time=0.39093 
Train Epoch: 43 [177/500 11328/32000 (35%)] Loss: 0.44379 (QuantReg: 14.06018) QuantErr: 14.06018 batch_time=0.45435 
Train Epoch: 43 [185/500 11840/32000 (37%)] Loss: 0.41879 (QuantReg: 14.33498) QuantErr: 14.33498 batch_time=0.39221 
Train Epoch: 43 [193/500 12352/32000 (39%)] Loss: 0.42252 (QuantReg: 13.81918) QuantErr: 13.81918 batch_time=0.40464 
Train Epoch: 43 [201/500 12864/32000 (40%)] Loss: 0.52385 (QuantReg: 13.61666) QuantErr: 13.61666 batch_time=0.41084 
Train Epoch: 43 [209/500 13376/32000 (42%)] Loss: 0.72316 (QuantReg: 13.62362) QuantErr: 13.62362 batch_time=0.40299 
Train Epoch: 43 [217/500 13888/32000 (43%)] Loss: 0.64862 (QuantReg: 13.79576) QuantErr: 13.79576 batch_time=0.40358 
Train Epoch: 43 [225/500 14400/32000 (45%)] Loss: 0.38020 (QuantReg: 13.77432) QuantErr: 13.77432 batch_time=0.39367 
Train Epoch: 43 [233/500 14912/32000 (47%)] Loss: 0.41855 (QuantReg: 14.05996) QuantErr: 14.05996 batch_time=0.39882 
Train Epoch: 43 [241/500 15424/32000 (48%)] Loss: 0.40435 (QuantReg: 13.71243) QuantErr: 13.71243 batch_time=0.44399 
Train Epoch: 43 [249/500 15936/32000 (50%)] Loss: 0.54911 (QuantReg: 13.68188) QuantErr: 13.68188 batch_time=0.40805 
Train Epoch: 43 [257/500 16448/32000 (51%)] Loss: 0.36105 (QuantReg: 14.13647) QuantErr: 14.13647 batch_time=0.39392 
Train Epoch: 43 [265/500 16960/32000 (53%)] Loss: 0.58201 (QuantReg: 13.98270) QuantErr: 13.98270 batch_time=0.44782 
Train Epoch: 43 [273/500 17472/32000 (55%)] Loss: 0.41339 (QuantReg: 14.22035) QuantErr: 14.22035 batch_time=0.38467 
Train Epoch: 43 [281/500 17984/32000 (56%)] Loss: 0.56137 (QuantReg: 13.84123) QuantErr: 13.84123 batch_time=0.39267 
Train Epoch: 43 [289/500 18496/32000 (58%)] Loss: 0.79015 (QuantReg: 13.73139) QuantErr: 13.73139 batch_time=0.39182 
Train Epoch: 43 [297/500 19008/32000 (59%)] Loss: 0.59804 (QuantReg: 13.58195) QuantErr: 13.58195 batch_time=0.40617 
Train Epoch: 43 [305/500 19520/32000 (61%)] Loss: 0.33369 (QuantReg: 14.02682) QuantErr: 14.02682 batch_time=0.40604 
Train Epoch: 43 [313/500 20032/32000 (63%)] Loss: 0.47905 (QuantReg: 14.08486) QuantErr: 14.08486 batch_time=0.41090 
Train Epoch: 43 [321/500 20544/32000 (64%)] Loss: 0.65889 (QuantReg: 13.68123) QuantErr: 13.68123 batch_time=0.40730 
Train Epoch: 43 [329/500 21056/32000 (66%)] Loss: 0.57544 (QuantReg: 13.89191) QuantErr: 13.89191 batch_time=0.40506 
Train Epoch: 43 [337/500 21568/32000 (67%)] Loss: 0.46943 (QuantReg: 13.60726) QuantErr: 13.60726 batch_time=0.40169 
Train Epoch: 43 [345/500 22080/32000 (69%)] Loss: 0.68300 (QuantReg: 13.47378) QuantErr: 13.47378 batch_time=0.39044 
Train Epoch: 43 [353/500 22592/32000 (71%)] Loss: 0.35168 (QuantReg: 13.95331) QuantErr: 13.95331 batch_time=0.42196 
Train Epoch: 43 [361/500 23104/32000 (72%)] Loss: 0.45805 (QuantReg: 13.71301) QuantErr: 13.71301 batch_time=0.39386 
Train Epoch: 43 [369/500 23616/32000 (74%)] Loss: 0.39429 (QuantReg: 13.76710) QuantErr: 13.76710 batch_time=0.39400 
Train Epoch: 43 [377/500 24128/32000 (75%)] Loss: 0.36632 (QuantReg: 13.97509) QuantErr: 13.97509 batch_time=0.43688 
Train Epoch: 43 [385/500 24640/32000 (77%)] Loss: 0.48120 (QuantReg: 13.68785) QuantErr: 13.68785 batch_time=1.09227 
Train Epoch: 43 [393/500 25152/32000 (79%)] Loss: 0.32563 (QuantReg: 14.11674) QuantErr: 14.11674 batch_time=0.39948 
Train Epoch: 43 [401/500 25664/32000 (80%)] Loss: 0.48494 (QuantReg: 13.75597) QuantErr: 13.75597 batch_time=0.38850 
Train Epoch: 43 [409/500 26176/32000 (82%)] Loss: 0.53085 (QuantReg: 13.87367) QuantErr: 13.87367 batch_time=0.39570 
Train Epoch: 43 [417/500 26688/32000 (83%)] Loss: 0.50789 (QuantReg: 13.73150) QuantErr: 13.73150 batch_time=0.39317 
Train Epoch: 43 [425/500 27200/32000 (85%)] Loss: 0.34902 (QuantReg: 13.95885) QuantErr: 13.95885 batch_time=0.40794 
Train Epoch: 43 [433/500 27712/32000 (87%)] Loss: 0.53313 (QuantReg: 13.73627) QuantErr: 13.73627 batch_time=0.39606 
Train Epoch: 43 [441/500 28224/32000 (88%)] Loss: 0.50374 (QuantReg: 13.94277) QuantErr: 13.94277 batch_time=0.42988 
Train Epoch: 43 [449/500 28736/32000 (90%)] Loss: 0.48729 (QuantReg: 13.92658) QuantErr: 13.92658 batch_time=2.58579 
Train Epoch: 43 [457/500 29248/32000 (91%)] Loss: 0.41738 (QuantReg: 13.49467) QuantErr: 13.49467 batch_time=0.39778 
Train Epoch: 43 [465/500 29760/32000 (93%)] Loss: 0.49431 (QuantReg: 13.90393) QuantErr: 13.90393 batch_time=0.41381 
Train Epoch: 43 [473/500 30272/32000 (95%)] Loss: 0.57575 (QuantReg: 13.72420) QuantErr: 13.72420 batch_time=0.40879 
Train Epoch: 43 [481/500 30784/32000 (96%)] Loss: 0.62112 (QuantReg: 14.07359) QuantErr: 14.07359 batch_time=0.39353 
Train Epoch: 43 [489/500 31296/32000 (98%)] Loss: 0.27017 (QuantReg: 13.58229) QuantErr: 13.58229 batch_time=0.39828 
Train Epoch: 43 [497/500 31808/32000 (99%)] Loss: 0.34001 (QuantReg: 14.09128) QuantErr: 14.09128 batch_time=0.40833 
Train Epoch: 43 codebook_update_time=2.19199
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch43.pth ...
Done in 3.776s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch43.pth ...
Done in 8.517s
removing stale ckpt [epoch 42] [took 0.02s]
 epoch          : 43
 loss           : 0.47904490780830383
 quant_reg      : 13.837467487335205
 quant_err      : 13.837467487335205
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 21500
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 73.44064386317908
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.3420523138833
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.1150713436289
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.989939637826962
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.12264291731961
 MSRVTT_full_test/t2v_metrics/R1: 14.180602006688963
 MSRVTT_full_test/t2v_metrics/R5: 38.862876254180605
 MSRVTT_full_test/t2v_metrics/R10: 52.80936454849498
 MSRVTT_full_test/t2v_metrics/R50: 82.10702341137124
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.50401337792642
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.759564562442723
 MSRVTT_full_test/v2t_metrics/R1: 16.923076923076923
 MSRVTT_full_test/v2t_metrics/R5: 45.585284280936456
 MSRVTT_full_test/v2t_metrics/R10: 61.23745819397993
 MSRVTT_full_test/v2t_metrics/R50: 87.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.743478260869566
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.14989587193387
 mnt_best       : 30.759564562442723
 not_improved_count: 0
Train Epoch: 44 [1/500 64/32000 (0%)] Loss: 0.39903 (QuantReg: 14.20925) QuantErr: 14.20925 batch_time=33.47241 
Train Epoch: 44 [9/500 576/32000 (2%)] Loss: 0.40559 (QuantReg: 14.17376) QuantErr: 14.17376 batch_time=0.40006 
Train Epoch: 44 [17/500 1088/32000 (3%)] Loss: 0.56822 (QuantReg: 13.69436) QuantErr: 13.69436 batch_time=0.41535 
Train Epoch: 44 [25/500 1600/32000 (5%)] Loss: 0.54644 (QuantReg: 13.90829) QuantErr: 13.90829 batch_time=0.39979 
Train Epoch: 44 [33/500 2112/32000 (7%)] Loss: 0.88026 (QuantReg: 13.39403) QuantErr: 13.39403 batch_time=0.39272 
Train Epoch: 44 [41/500 2624/32000 (8%)] Loss: 0.43391 (QuantReg: 13.76077) QuantErr: 13.76077 batch_time=0.40771 
Train Epoch: 44 [49/500 3136/32000 (10%)] Loss: 0.27746 (QuantReg: 13.86711) QuantErr: 13.86711 batch_time=0.40853 
Train Epoch: 44 [57/500 3648/32000 (11%)] Loss: 0.41120 (QuantReg: 13.72836) QuantErr: 13.72836 batch_time=0.41254 
Train Epoch: 44 [65/500 4160/32000 (13%)] Loss: 0.85919 (QuantReg: 13.91580) QuantErr: 13.91580 batch_time=0.38935 
Train Epoch: 44 [73/500 4672/32000 (15%)] Loss: 0.41193 (QuantReg: 14.15920) QuantErr: 14.15920 batch_time=0.42604 
Train Epoch: 44 [81/500 5184/32000 (16%)] Loss: 0.52298 (QuantReg: 13.65584) QuantErr: 13.65584 batch_time=0.42833 
Train Epoch: 44 [89/500 5696/32000 (18%)] Loss: 0.59092 (QuantReg: 13.60939) QuantErr: 13.60939 batch_time=0.39394 
Train Epoch: 44 [97/500 6208/32000 (19%)] Loss: 0.57834 (QuantReg: 13.83786) QuantErr: 13.83786 batch_time=0.40366 
Train Epoch: 44 [105/500 6720/32000 (21%)] Loss: 0.47550 (QuantReg: 13.82246) QuantErr: 13.82246 batch_time=0.42163 
Train Epoch: 44 [113/500 7232/32000 (23%)] Loss: 0.52936 (QuantReg: 13.64334) QuantErr: 13.64334 batch_time=0.39394 
Train Epoch: 44 [121/500 7744/32000 (24%)] Loss: 0.59111 (QuantReg: 14.03607) QuantErr: 14.03607 batch_time=0.39686 
Train Epoch: 44 [129/500 8256/32000 (26%)] Loss: 0.49670 (QuantReg: 13.77932) QuantErr: 13.77932 batch_time=0.40348 
Train Epoch: 44 [137/500 8768/32000 (27%)] Loss: 0.41767 (QuantReg: 13.82372) QuantErr: 13.82372 batch_time=0.39299 
Train Epoch: 44 [145/500 9280/32000 (29%)] Loss: 0.75617 (QuantReg: 13.32401) QuantErr: 13.32401 batch_time=0.41985 
Train Epoch: 44 [153/500 9792/32000 (31%)] Loss: 0.30650 (QuantReg: 13.96389) QuantErr: 13.96389 batch_time=0.39546 
Train Epoch: 44 [161/500 10304/32000 (32%)] Loss: 0.58292 (QuantReg: 13.95948) QuantErr: 13.95948 batch_time=0.41305 
Train Epoch: 44 [169/500 10816/32000 (34%)] Loss: 0.49161 (QuantReg: 13.73689) QuantErr: 13.73689 batch_time=0.39366 
Train Epoch: 44 [177/500 11328/32000 (35%)] Loss: 0.53717 (QuantReg: 13.95438) QuantErr: 13.95438 batch_time=0.44075 
Train Epoch: 44 [185/500 11840/32000 (37%)] Loss: 0.59795 (QuantReg: 14.13666) QuantErr: 14.13666 batch_time=0.39960 
Train Epoch: 44 [193/500 12352/32000 (39%)] Loss: 0.38881 (QuantReg: 13.66590) QuantErr: 13.66590 batch_time=0.43019 
Train Epoch: 44 [201/500 12864/32000 (40%)] Loss: 0.29183 (QuantReg: 13.74465) QuantErr: 13.74465 batch_time=0.40400 
Train Epoch: 44 [209/500 13376/32000 (42%)] Loss: 0.55997 (QuantReg: 14.02924) QuantErr: 14.02924 batch_time=0.43461 
Train Epoch: 44 [217/500 13888/32000 (43%)] Loss: 0.45627 (QuantReg: 13.55613) QuantErr: 13.55613 batch_time=0.39742 
Train Epoch: 44 [225/500 14400/32000 (45%)] Loss: 0.46403 (QuantReg: 13.73146) QuantErr: 13.73146 batch_time=0.40660 
Train Epoch: 44 [233/500 14912/32000 (47%)] Loss: 0.53363 (QuantReg: 13.81867) QuantErr: 13.81867 batch_time=0.41307 
Train Epoch: 44 [241/500 15424/32000 (48%)] Loss: 0.73794 (QuantReg: 13.55748) QuantErr: 13.55748 batch_time=0.39379 
Train Epoch: 44 [249/500 15936/32000 (50%)] Loss: 0.44888 (QuantReg: 13.77518) QuantErr: 13.77518 batch_time=0.39224 
Train Epoch: 44 [257/500 16448/32000 (51%)] Loss: 0.38785 (QuantReg: 14.11602) QuantErr: 14.11602 batch_time=0.38861 
Train Epoch: 44 [265/500 16960/32000 (53%)] Loss: 0.53989 (QuantReg: 14.02246) QuantErr: 14.02246 batch_time=0.39753 
Train Epoch: 44 [273/500 17472/32000 (55%)] Loss: 0.52105 (QuantReg: 14.08257) QuantErr: 14.08257 batch_time=0.41104 
Train Epoch: 44 [281/500 17984/32000 (56%)] Loss: 0.40177 (QuantReg: 14.02187) QuantErr: 14.02187 batch_time=0.38878 
Train Epoch: 44 [289/500 18496/32000 (58%)] Loss: 0.58579 (QuantReg: 14.00311) QuantErr: 14.00311 batch_time=0.39326 
Train Epoch: 44 [297/500 19008/32000 (59%)] Loss: 0.61822 (QuantReg: 13.82032) QuantErr: 13.82032 batch_time=0.40486 
Train Epoch: 44 [305/500 19520/32000 (61%)] Loss: 0.40141 (QuantReg: 13.97916) QuantErr: 13.97916 batch_time=0.39684 
Train Epoch: 44 [313/500 20032/32000 (63%)] Loss: 0.60224 (QuantReg: 13.99325) QuantErr: 13.99325 batch_time=0.38446 
Train Epoch: 44 [321/500 20544/32000 (64%)] Loss: 0.47319 (QuantReg: 13.76512) QuantErr: 13.76512 batch_time=0.42544 
Train Epoch: 44 [329/500 21056/32000 (66%)] Loss: 0.70916 (QuantReg: 13.82086) QuantErr: 13.82086 batch_time=0.43217 
Train Epoch: 44 [337/500 21568/32000 (67%)] Loss: 0.41656 (QuantReg: 13.61923) QuantErr: 13.61923 batch_time=0.41608 
Train Epoch: 44 [345/500 22080/32000 (69%)] Loss: 0.60784 (QuantReg: 13.88788) QuantErr: 13.88788 batch_time=0.40193 
Train Epoch: 44 [353/500 22592/32000 (71%)] Loss: 0.39272 (QuantReg: 13.55171) QuantErr: 13.55171 batch_time=0.40341 
Train Epoch: 44 [361/500 23104/32000 (72%)] Loss: 0.48066 (QuantReg: 13.68060) QuantErr: 13.68060 batch_time=0.40842 
Train Epoch: 44 [369/500 23616/32000 (74%)] Loss: 0.51398 (QuantReg: 13.81510) QuantErr: 13.81510 batch_time=0.40011 
Train Epoch: 44 [377/500 24128/32000 (75%)] Loss: 0.52914 (QuantReg: 13.82286) QuantErr: 13.82286 batch_time=0.41680 
Train Epoch: 44 [385/500 24640/32000 (77%)] Loss: 0.41739 (QuantReg: 13.88571) QuantErr: 13.88571 batch_time=0.39600 
Train Epoch: 44 [393/500 25152/32000 (79%)] Loss: 0.74419 (QuantReg: 13.99418) QuantErr: 13.99418 batch_time=0.39275 
Train Epoch: 44 [401/500 25664/32000 (80%)] Loss: 0.38039 (QuantReg: 14.11537) QuantErr: 14.11537 batch_time=0.39284 
Train Epoch: 44 [409/500 26176/32000 (82%)] Loss: 0.58435 (QuantReg: 13.79299) QuantErr: 13.79299 batch_time=0.38718 
Train Epoch: 44 [417/500 26688/32000 (83%)] Loss: 0.61550 (QuantReg: 13.53519) QuantErr: 13.53519 batch_time=0.39130 
Train Epoch: 44 [425/500 27200/32000 (85%)] Loss: 0.44082 (QuantReg: 13.76492) QuantErr: 13.76492 batch_time=0.45253 
Train Epoch: 44 [433/500 27712/32000 (87%)] Loss: 0.59648 (QuantReg: 14.34567) QuantErr: 14.34567 batch_time=0.39489 
Train Epoch: 44 [441/500 28224/32000 (88%)] Loss: 0.47547 (QuantReg: 14.10174) QuantErr: 14.10174 batch_time=0.39643 
Train Epoch: 44 [449/500 28736/32000 (90%)] Loss: 0.77306 (QuantReg: 14.00129) QuantErr: 14.00129 batch_time=0.40020 
Train Epoch: 44 [457/500 29248/32000 (91%)] Loss: 0.46647 (QuantReg: 14.04696) QuantErr: 14.04696 batch_time=0.40975 
Train Epoch: 44 [465/500 29760/32000 (93%)] Loss: 0.26109 (QuantReg: 14.33029) QuantErr: 14.33029 batch_time=0.39213 
Train Epoch: 44 [473/500 30272/32000 (95%)] Loss: 0.46928 (QuantReg: 14.27365) QuantErr: 14.27365 batch_time=0.39168 
Train Epoch: 44 [481/500 30784/32000 (96%)] Loss: 0.48449 (QuantReg: 13.06425) QuantErr: 13.06425 batch_time=0.39398 
Train Epoch: 44 [489/500 31296/32000 (98%)] Loss: 0.40485 (QuantReg: 13.81336) QuantErr: 13.81336 batch_time=0.39561 
Train Epoch: 44 [497/500 31808/32000 (99%)] Loss: 0.30880 (QuantReg: 14.02028) QuantErr: 14.02028 batch_time=0.41629 
Train Epoch: 44 codebook_update_time=2.61660
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch44.pth ...
Done in 7.464s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch44.pth ...
Done in 11.618s
removing stale ckpt [epoch 43] [took 0.00s]
 epoch          : 44
 loss           : 0.4861055218577385
 quant_reg      : 13.857056310653686
 quant_err      : 13.857056310653686
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 22000
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 72.23340040241449
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.225352112676056
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.66902897978012
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 79.07444668008048
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.086519114688128
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.92716597169026
 MSRVTT_full_test/t2v_metrics/R1: 14.648829431438127
 MSRVTT_full_test/t2v_metrics/R5: 39.197324414715716
 MSRVTT_full_test/t2v_metrics/R10: 52.97658862876254
 MSRVTT_full_test/t2v_metrics/R50: 82.27424749163879
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.13010033444816
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.21627740799768
 MSRVTT_full_test/v2t_metrics/R1: 17.692307692307693
 MSRVTT_full_test/v2t_metrics/R5: 46.58862876254181
 MSRVTT_full_test/v2t_metrics/R10: 61.103678929765884
 MSRVTT_full_test/v2t_metrics/R50: 87.82608695652173
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.56421404682274
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.929825619817166
 mnt_best       : 31.21627740799768
 not_improved_count: 0
Train Epoch: 45 [1/500 64/32000 (0%)] Loss: 0.59020 (QuantReg: 13.61814) QuantErr: 13.61814 batch_time=33.25052 
Train Epoch: 45 [9/500 576/32000 (2%)] Loss: 0.42396 (QuantReg: 14.05032) QuantErr: 14.05032 batch_time=0.39717 
Train Epoch: 45 [17/500 1088/32000 (3%)] Loss: 0.25530 (QuantReg: 13.87805) QuantErr: 13.87805 batch_time=0.39177 
Train Epoch: 45 [25/500 1600/32000 (5%)] Loss: 0.35612 (QuantReg: 13.91549) QuantErr: 13.91549 batch_time=0.39138 
Train Epoch: 45 [33/500 2112/32000 (7%)] Loss: 0.28157 (QuantReg: 14.02873) QuantErr: 14.02873 batch_time=0.39669 
Train Epoch: 45 [41/500 2624/32000 (8%)] Loss: 0.70629 (QuantReg: 13.43460) QuantErr: 13.43460 batch_time=5.40640 
Train Epoch: 45 [49/500 3136/32000 (10%)] Loss: 0.45266 (QuantReg: 13.73692) QuantErr: 13.73692 batch_time=0.39680 
Train Epoch: 45 [57/500 3648/32000 (11%)] Loss: 0.30971 (QuantReg: 14.00254) QuantErr: 14.00254 batch_time=0.41472 
Train Epoch: 45 [65/500 4160/32000 (13%)] Loss: 0.41740 (QuantReg: 13.60783) QuantErr: 13.60783 batch_time=0.42812 
Train Epoch: 45 [73/500 4672/32000 (15%)] Loss: 0.36502 (QuantReg: 13.56446) QuantErr: 13.56446 batch_time=0.44364 
Train Epoch: 45 [81/500 5184/32000 (16%)] Loss: 0.62772 (QuantReg: 13.39036) QuantErr: 13.39036 batch_time=0.39873 
Train Epoch: 45 [89/500 5696/32000 (18%)] Loss: 0.43614 (QuantReg: 14.10148) QuantErr: 14.10148 batch_time=0.38860 
Train Epoch: 45 [97/500 6208/32000 (19%)] Loss: 0.39313 (QuantReg: 14.19484) QuantErr: 14.19484 batch_time=0.42524 
Train Epoch: 45 [105/500 6720/32000 (21%)] Loss: 0.32595 (QuantReg: 13.81947) QuantErr: 13.81947 batch_time=3.48992 
Train Epoch: 45 [113/500 7232/32000 (23%)] Loss: 0.33507 (QuantReg: 14.14296) QuantErr: 14.14296 batch_time=0.39243 
Train Epoch: 45 [121/500 7744/32000 (24%)] Loss: 0.58022 (QuantReg: 13.68015) QuantErr: 13.68015 batch_time=0.38842 
Train Epoch: 45 [129/500 8256/32000 (26%)] Loss: 0.33051 (QuantReg: 13.74360) QuantErr: 13.74360 batch_time=0.39139 
Train Epoch: 45 [137/500 8768/32000 (27%)] Loss: 0.38475 (QuantReg: 13.78853) QuantErr: 13.78853 batch_time=0.38559 
Train Epoch: 45 [145/500 9280/32000 (29%)] Loss: 0.53118 (QuantReg: 13.76417) QuantErr: 13.76417 batch_time=0.39789 
Train Epoch: 45 [153/500 9792/32000 (31%)] Loss: 0.69157 (QuantReg: 13.80534) QuantErr: 13.80534 batch_time=0.40628 
Train Epoch: 45 [161/500 10304/32000 (32%)] Loss: 0.31065 (QuantReg: 14.11235) QuantErr: 14.11235 batch_time=0.39480 
Train Epoch: 45 [169/500 10816/32000 (34%)] Loss: 0.68244 (QuantReg: 14.09493) QuantErr: 14.09493 batch_time=3.41169 
Train Epoch: 45 [177/500 11328/32000 (35%)] Loss: 0.74718 (QuantReg: 13.58386) QuantErr: 13.58386 batch_time=0.38352 
Train Epoch: 45 [185/500 11840/32000 (37%)] Loss: 0.50983 (QuantReg: 14.20146) QuantErr: 14.20146 batch_time=0.40091 
Train Epoch: 45 [193/500 12352/32000 (39%)] Loss: 0.32705 (QuantReg: 14.08550) QuantErr: 14.08550 batch_time=0.38405 
Train Epoch: 45 [201/500 12864/32000 (40%)] Loss: 0.55231 (QuantReg: 13.93785) QuantErr: 13.93785 batch_time=0.39537 
Train Epoch: 45 [209/500 13376/32000 (42%)] Loss: 0.48109 (QuantReg: 13.93889) QuantErr: 13.93889 batch_time=0.39619 
Train Epoch: 45 [217/500 13888/32000 (43%)] Loss: 0.50811 (QuantReg: 13.62674) QuantErr: 13.62674 batch_time=0.39189 
Train Epoch: 45 [225/500 14400/32000 (45%)] Loss: 0.68866 (QuantReg: 14.31145) QuantErr: 14.31145 batch_time=0.39564 
Train Epoch: 45 [233/500 14912/32000 (47%)] Loss: 0.47168 (QuantReg: 13.98365) QuantErr: 13.98365 batch_time=3.30590 
Train Epoch: 45 [241/500 15424/32000 (48%)] Loss: 0.40877 (QuantReg: 14.02911) QuantErr: 14.02911 batch_time=0.39588 
Train Epoch: 45 [249/500 15936/32000 (50%)] Loss: 0.62908 (QuantReg: 14.09033) QuantErr: 14.09033 batch_time=0.40030 
Train Epoch: 45 [257/500 16448/32000 (51%)] Loss: 0.38389 (QuantReg: 13.78385) QuantErr: 13.78385 batch_time=0.39576 
Train Epoch: 45 [265/500 16960/32000 (53%)] Loss: 0.41026 (QuantReg: 13.75694) QuantErr: 13.75694 batch_time=0.38840 
Train Epoch: 45 [273/500 17472/32000 (55%)] Loss: 0.77848 (QuantReg: 13.88671) QuantErr: 13.88671 batch_time=0.39130 
Train Epoch: 45 [281/500 17984/32000 (56%)] Loss: 0.46093 (QuantReg: 13.46628) QuantErr: 13.46628 batch_time=0.39642 
Train Epoch: 45 [289/500 18496/32000 (58%)] Loss: 0.42093 (QuantReg: 14.07894) QuantErr: 14.07894 batch_time=0.39128 
Train Epoch: 45 [297/500 19008/32000 (59%)] Loss: 0.66148 (QuantReg: 14.25843) QuantErr: 14.25843 batch_time=3.42492 
Train Epoch: 45 [305/500 19520/32000 (61%)] Loss: 0.90920 (QuantReg: 13.83657) QuantErr: 13.83657 batch_time=0.40758 
Train Epoch: 45 [313/500 20032/32000 (63%)] Loss: 0.42568 (QuantReg: 13.80912) QuantErr: 13.80912 batch_time=0.39470 
Train Epoch: 45 [321/500 20544/32000 (64%)] Loss: 0.32386 (QuantReg: 13.60992) QuantErr: 13.60992 batch_time=0.39010 
Train Epoch: 45 [329/500 21056/32000 (66%)] Loss: 0.59798 (QuantReg: 14.38556) QuantErr: 14.38556 batch_time=0.41507 
Train Epoch: 45 [337/500 21568/32000 (67%)] Loss: 0.36436 (QuantReg: 14.13316) QuantErr: 14.13316 batch_time=0.40092 
Train Epoch: 45 [345/500 22080/32000 (69%)] Loss: 0.41889 (QuantReg: 13.96832) QuantErr: 13.96832 batch_time=0.41226 
Train Epoch: 45 [353/500 22592/32000 (71%)] Loss: 0.40205 (QuantReg: 13.79757) QuantErr: 13.79757 batch_time=0.40434 
Train Epoch: 45 [361/500 23104/32000 (72%)] Loss: 0.49667 (QuantReg: 13.76582) QuantErr: 13.76582 batch_time=3.40791 
Train Epoch: 45 [369/500 23616/32000 (74%)] Loss: 0.35261 (QuantReg: 13.71174) QuantErr: 13.71174 batch_time=0.39104 
Train Epoch: 45 [377/500 24128/32000 (75%)] Loss: 0.52674 (QuantReg: 13.55600) QuantErr: 13.55600 batch_time=0.39968 
Train Epoch: 45 [385/500 24640/32000 (77%)] Loss: 0.55940 (QuantReg: 13.89036) QuantErr: 13.89036 batch_time=0.40058 
Train Epoch: 45 [393/500 25152/32000 (79%)] Loss: 0.31975 (QuantReg: 13.81348) QuantErr: 13.81348 batch_time=0.39087 
Train Epoch: 45 [401/500 25664/32000 (80%)] Loss: 0.48424 (QuantReg: 14.10640) QuantErr: 14.10640 batch_time=0.39054 
Train Epoch: 45 [409/500 26176/32000 (82%)] Loss: 0.77109 (QuantReg: 13.49836) QuantErr: 13.49836 batch_time=0.38914 
Train Epoch: 45 [417/500 26688/32000 (83%)] Loss: 0.46925 (QuantReg: 14.09336) QuantErr: 14.09336 batch_time=0.39601 
Train Epoch: 45 [425/500 27200/32000 (85%)] Loss: 0.57459 (QuantReg: 13.71430) QuantErr: 13.71430 batch_time=0.72103 
Train Epoch: 45 [433/500 27712/32000 (87%)] Loss: 0.50766 (QuantReg: 14.03322) QuantErr: 14.03322 batch_time=0.39319 
Train Epoch: 45 [441/500 28224/32000 (88%)] Loss: 0.49996 (QuantReg: 13.93749) QuantErr: 13.93749 batch_time=0.38816 
Train Epoch: 45 [449/500 28736/32000 (90%)] Loss: 0.37585 (QuantReg: 14.02239) QuantErr: 14.02239 batch_time=0.39036 
Train Epoch: 45 [457/500 29248/32000 (91%)] Loss: 0.74158 (QuantReg: 14.01073) QuantErr: 14.01073 batch_time=0.41738 
Train Epoch: 45 [465/500 29760/32000 (93%)] Loss: 0.30426 (QuantReg: 14.26685) QuantErr: 14.26685 batch_time=0.40231 
Train Epoch: 45 [473/500 30272/32000 (95%)] Loss: 0.75368 (QuantReg: 14.03863) QuantErr: 14.03863 batch_time=0.40148 
Train Epoch: 45 [481/500 30784/32000 (96%)] Loss: 0.40163 (QuantReg: 14.00303) QuantErr: 14.00303 batch_time=0.40330 
Train Epoch: 45 [489/500 31296/32000 (98%)] Loss: 0.52692 (QuantReg: 14.15736) QuantErr: 14.15736 batch_time=0.80945 
Train Epoch: 45 [497/500 31808/32000 (99%)] Loss: 0.61645 (QuantReg: 13.70109) QuantErr: 13.70109 batch_time=0.39050 
Train Epoch: 45 codebook_update_time=1.88515
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch45.pth ...
Done in 18.826s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 0.4822189036011696
 quant_reg      : 13.89718373298645
 quant_err      : 13.89718373298645
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 22500
 MSRVTT_full_val/t2v_metrics/R1: 33.199195171026155
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.985915492957746
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.26126036926441
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.895372233400402
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.3863598255931
 MSRVTT_full_test/t2v_metrics/R1: 14.180602006688963
 MSRVTT_full_test/t2v_metrics/R5: 39.163879598662206
 MSRVTT_full_test/t2v_metrics/R10: 52.374581939799334
 MSRVTT_full_test/t2v_metrics/R50: 82.24080267558529
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.75284280936455
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.753908280534798
 MSRVTT_full_test/v2t_metrics/R1: 17.190635451505017
 MSRVTT_full_test/v2t_metrics/R5: 45.05016722408027
 MSRVTT_full_test/v2t_metrics/R10: 61.30434782608695
 MSRVTT_full_test/v2t_metrics/R50: 87.35785953177258
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.90802675585284
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.20983436597357
 mnt_best       : 31.21627740799768
 not_improved_count: 1
Train Epoch: 46 [1/500 64/32000 (0%)] Loss: 0.54680 (QuantReg: 13.40452) QuantErr: 13.40452 batch_time=32.32565 
Train Epoch: 46 [9/500 576/32000 (2%)] Loss: 0.63801 (QuantReg: 14.04373) QuantErr: 14.04373 batch_time=0.38932 
Train Epoch: 46 [17/500 1088/32000 (3%)] Loss: 0.48437 (QuantReg: 13.75326) QuantErr: 13.75326 batch_time=1.67410 
Train Epoch: 46 [25/500 1600/32000 (5%)] Loss: 0.43229 (QuantReg: 13.73482) QuantErr: 13.73482 batch_time=0.38505 
Train Epoch: 46 [33/500 2112/32000 (7%)] Loss: 0.86613 (QuantReg: 13.81983) QuantErr: 13.81983 batch_time=0.38849 
Train Epoch: 46 [41/500 2624/32000 (8%)] Loss: 0.54888 (QuantReg: 13.59203) QuantErr: 13.59203 batch_time=0.40783 
Train Epoch: 46 [49/500 3136/32000 (10%)] Loss: 0.59351 (QuantReg: 13.72223) QuantErr: 13.72223 batch_time=0.38773 
Train Epoch: 46 [57/500 3648/32000 (11%)] Loss: 0.63006 (QuantReg: 13.83348) QuantErr: 13.83348 batch_time=0.38306 
Train Epoch: 46 [65/500 4160/32000 (13%)] Loss: 0.53265 (QuantReg: 13.49900) QuantErr: 13.49900 batch_time=0.51026 
Train Epoch: 46 [73/500 4672/32000 (15%)] Loss: 0.45444 (QuantReg: 14.22867) QuantErr: 14.22867 batch_time=0.39197 
Train Epoch: 46 [81/500 5184/32000 (16%)] Loss: 0.86793 (QuantReg: 13.46504) QuantErr: 13.46504 batch_time=1.50351 
Train Epoch: 46 [89/500 5696/32000 (18%)] Loss: 0.33241 (QuantReg: 14.05293) QuantErr: 14.05293 batch_time=0.38571 
Train Epoch: 46 [97/500 6208/32000 (19%)] Loss: 0.51338 (QuantReg: 14.07447) QuantErr: 14.07447 batch_time=0.38247 
Train Epoch: 46 [105/500 6720/32000 (21%)] Loss: 0.36958 (QuantReg: 14.00952) QuantErr: 14.00952 batch_time=0.38057 
Train Epoch: 46 [113/500 7232/32000 (23%)] Loss: 0.43887 (QuantReg: 13.67895) QuantErr: 13.67895 batch_time=0.37867 
Train Epoch: 46 [121/500 7744/32000 (24%)] Loss: 0.30588 (QuantReg: 14.19134) QuantErr: 14.19134 batch_time=0.38869 
Train Epoch: 46 [129/500 8256/32000 (26%)] Loss: 0.68779 (QuantReg: 14.29068) QuantErr: 14.29068 batch_time=0.49910 
Train Epoch: 46 [137/500 8768/32000 (27%)] Loss: 0.61707 (QuantReg: 13.52760) QuantErr: 13.52760 batch_time=0.38033 
Train Epoch: 46 [145/500 9280/32000 (29%)] Loss: 0.57155 (QuantReg: 13.63612) QuantErr: 13.63612 batch_time=1.48843 
Train Epoch: 46 [153/500 9792/32000 (31%)] Loss: 0.51705 (QuantReg: 13.91316) QuantErr: 13.91316 batch_time=0.38015 
Train Epoch: 46 [161/500 10304/32000 (32%)] Loss: 0.44292 (QuantReg: 13.87963) QuantErr: 13.87963 batch_time=0.38312 
Train Epoch: 46 [169/500 10816/32000 (34%)] Loss: 0.44847 (QuantReg: 13.87883) QuantErr: 13.87883 batch_time=0.38711 
Train Epoch: 46 [177/500 11328/32000 (35%)] Loss: 0.33357 (QuantReg: 13.88133) QuantErr: 13.88133 batch_time=0.43876 
Train Epoch: 46 [185/500 11840/32000 (37%)] Loss: 0.37135 (QuantReg: 14.00797) QuantErr: 14.00797 batch_time=0.38572 
Train Epoch: 46 [193/500 12352/32000 (39%)] Loss: 0.46829 (QuantReg: 14.11800) QuantErr: 14.11800 batch_time=0.51257 
Train Epoch: 46 [201/500 12864/32000 (40%)] Loss: 0.47195 (QuantReg: 13.43930) QuantErr: 13.43930 batch_time=0.38769 
Train Epoch: 46 [209/500 13376/32000 (42%)] Loss: 0.74377 (QuantReg: 14.21268) QuantErr: 14.21268 batch_time=0.40846 
Train Epoch: 46 [217/500 13888/32000 (43%)] Loss: 0.39666 (QuantReg: 13.79031) QuantErr: 13.79031 batch_time=0.39054 
Train Epoch: 46 [225/500 14400/32000 (45%)] Loss: 0.62541 (QuantReg: 14.19515) QuantErr: 14.19515 batch_time=0.38858 
Train Epoch: 46 [233/500 14912/32000 (47%)] Loss: 0.52021 (QuantReg: 14.01617) QuantErr: 14.01617 batch_time=0.39946 
Train Epoch: 46 [241/500 15424/32000 (48%)] Loss: 0.39062 (QuantReg: 13.83963) QuantErr: 13.83963 batch_time=0.39716 
Train Epoch: 46 [249/500 15936/32000 (50%)] Loss: 0.42121 (QuantReg: 14.05960) QuantErr: 14.05960 batch_time=0.37842 
Train Epoch: 46 [257/500 16448/32000 (51%)] Loss: 0.34407 (QuantReg: 13.93046) QuantErr: 13.93046 batch_time=0.43685 
Train Epoch: 46 [265/500 16960/32000 (53%)] Loss: 0.40908 (QuantReg: 13.94543) QuantErr: 13.94543 batch_time=0.38416 
Train Epoch: 46 [273/500 17472/32000 (55%)] Loss: 0.43263 (QuantReg: 13.68986) QuantErr: 13.68986 batch_time=0.38524 
Train Epoch: 46 [281/500 17984/32000 (56%)] Loss: 0.52162 (QuantReg: 14.04818) QuantErr: 14.04818 batch_time=0.39011 
Train Epoch: 46 [289/500 18496/32000 (58%)] Loss: 0.52473 (QuantReg: 13.69554) QuantErr: 13.69554 batch_time=0.38628 
Train Epoch: 46 [297/500 19008/32000 (59%)] Loss: 0.40139 (QuantReg: 14.23315) QuantErr: 14.23315 batch_time=0.38695 
Train Epoch: 46 [305/500 19520/32000 (61%)] Loss: 0.49416 (QuantReg: 13.70510) QuantErr: 13.70510 batch_time=0.40948 
Train Epoch: 46 [313/500 20032/32000 (63%)] Loss: 0.26837 (QuantReg: 13.94635) QuantErr: 13.94635 batch_time=0.40275 
Train Epoch: 46 [321/500 20544/32000 (64%)] Loss: 0.30789 (QuantReg: 14.15329) QuantErr: 14.15329 batch_time=0.60623 
Train Epoch: 46 [329/500 21056/32000 (66%)] Loss: 0.32835 (QuantReg: 14.11173) QuantErr: 14.11173 batch_time=0.40657 
Train Epoch: 46 [337/500 21568/32000 (67%)] Loss: 0.48694 (QuantReg: 14.31015) QuantErr: 14.31015 batch_time=0.39701 
Train Epoch: 46 [345/500 22080/32000 (69%)] Loss: 0.33072 (QuantReg: 13.99876) QuantErr: 13.99876 batch_time=0.39138 
Train Epoch: 46 [353/500 22592/32000 (71%)] Loss: 0.41620 (QuantReg: 14.13390) QuantErr: 14.13390 batch_time=0.39342 
Train Epoch: 46 [361/500 23104/32000 (72%)] Loss: 0.21091 (QuantReg: 14.10631) QuantErr: 14.10631 batch_time=0.40862 
Train Epoch: 46 [369/500 23616/32000 (74%)] Loss: 0.46880 (QuantReg: 13.96995) QuantErr: 13.96995 batch_time=0.38114 
Train Epoch: 46 [377/500 24128/32000 (75%)] Loss: 0.30020 (QuantReg: 13.98837) QuantErr: 13.98837 batch_time=0.38727 
Train Epoch: 46 [385/500 24640/32000 (77%)] Loss: 0.27099 (QuantReg: 13.70972) QuantErr: 13.70972 batch_time=0.63257 
Train Epoch: 46 [393/500 25152/32000 (79%)] Loss: 0.65021 (QuantReg: 13.54873) QuantErr: 13.54873 batch_time=0.38275 
Train Epoch: 46 [401/500 25664/32000 (80%)] Loss: 0.63560 (QuantReg: 14.04202) QuantErr: 14.04202 batch_time=0.39812 
Train Epoch: 46 [409/500 26176/32000 (82%)] Loss: 0.41799 (QuantReg: 14.20073) QuantErr: 14.20073 batch_time=0.40379 
Train Epoch: 46 [417/500 26688/32000 (83%)] Loss: 0.40796 (QuantReg: 14.04003) QuantErr: 14.04003 batch_time=0.39331 
Train Epoch: 46 [425/500 27200/32000 (85%)] Loss: 0.62836 (QuantReg: 14.11289) QuantErr: 14.11289 batch_time=0.39614 
Train Epoch: 46 [433/500 27712/32000 (87%)] Loss: 0.35681 (QuantReg: 13.93633) QuantErr: 13.93633 batch_time=0.38413 
Train Epoch: 46 [441/500 28224/32000 (88%)] Loss: 0.56518 (QuantReg: 13.79439) QuantErr: 13.79439 batch_time=0.38488 
Train Epoch: 46 [449/500 28736/32000 (90%)] Loss: 0.38206 (QuantReg: 13.92954) QuantErr: 13.92954 batch_time=0.63539 
Train Epoch: 46 [457/500 29248/32000 (91%)] Loss: 0.58713 (QuantReg: 13.51642) QuantErr: 13.51642 batch_time=0.38676 
Train Epoch: 46 [465/500 29760/32000 (93%)] Loss: 0.46580 (QuantReg: 13.65217) QuantErr: 13.65217 batch_time=0.39093 
Train Epoch: 46 [473/500 30272/32000 (95%)] Loss: 0.61570 (QuantReg: 13.33788) QuantErr: 13.33788 batch_time=0.40356 
Train Epoch: 46 [481/500 30784/32000 (96%)] Loss: 0.88840 (QuantReg: 13.76091) QuantErr: 13.76091 batch_time=0.39810 
Train Epoch: 46 [489/500 31296/32000 (98%)] Loss: 0.38856 (QuantReg: 14.09031) QuantErr: 14.09031 batch_time=0.39620 
Train Epoch: 46 [497/500 31808/32000 (99%)] Loss: 0.34039 (QuantReg: 14.04419) QuantErr: 14.04419 batch_time=0.40564 
Train Epoch: 46 codebook_update_time=2.05271
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch46.pth ...
Done in 12.818s
removing stale ckpt [epoch 45] [took 0.03s]
 epoch          : 46
 loss           : 0.4675982222557068
 quant_reg      : 13.885388706207275
 quant_err      : 13.885388706207275
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 23000
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 73.2394366197183
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.406438631790746
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.70305579925145
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.895372233400402
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.7542557753327
 MSRVTT_full_test/t2v_metrics/R1: 13.846153846153847
 MSRVTT_full_test/t2v_metrics/R5: 39.364548494983275
 MSRVTT_full_test/t2v_metrics/R10: 52.876254180602004
 MSRVTT_full_test/t2v_metrics/R50: 81.67224080267559
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.8113712374582
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.6594977603453
 MSRVTT_full_test/v2t_metrics/R1: 17.45819397993311
 MSRVTT_full_test/v2t_metrics/R5: 46.05351170568562
 MSRVTT_full_test/v2t_metrics/R10: 61.00334448160535
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.400668896321065
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.60484487760988
 mnt_best       : 31.21627740799768
 not_improved_count: 2
Train Epoch: 47 [1/500 64/32000 (0%)] Loss: 0.49024 (QuantReg: 14.13171) QuantErr: 14.13171 batch_time=32.13174 
Train Epoch: 47 [9/500 576/32000 (2%)] Loss: 0.44857 (QuantReg: 13.83581) QuantErr: 13.83581 batch_time=0.45492 
Train Epoch: 47 [17/500 1088/32000 (3%)] Loss: 0.31767 (QuantReg: 13.83364) QuantErr: 13.83364 batch_time=0.40887 
Train Epoch: 47 [25/500 1600/32000 (5%)] Loss: 0.86815 (QuantReg: 13.37489) QuantErr: 13.37489 batch_time=0.40012 
Train Epoch: 47 [33/500 2112/32000 (7%)] Loss: 0.59155 (QuantReg: 14.05483) QuantErr: 14.05483 batch_time=0.39777 
Train Epoch: 47 [41/500 2624/32000 (8%)] Loss: 0.25895 (QuantReg: 13.58206) QuantErr: 13.58206 batch_time=0.39736 
Train Epoch: 47 [49/500 3136/32000 (10%)] Loss: 0.47392 (QuantReg: 13.80861) QuantErr: 13.80861 batch_time=0.39841 
Train Epoch: 47 [57/500 3648/32000 (11%)] Loss: 0.47401 (QuantReg: 14.01740) QuantErr: 14.01740 batch_time=0.39404 
Train Epoch: 47 [65/500 4160/32000 (13%)] Loss: 0.42832 (QuantReg: 13.65430) QuantErr: 13.65430 batch_time=0.42649 
Train Epoch: 47 [73/500 4672/32000 (15%)] Loss: 0.57255 (QuantReg: 13.71068) QuantErr: 13.71068 batch_time=0.49469 
Train Epoch: 47 [81/500 5184/32000 (16%)] Loss: 0.59588 (QuantReg: 13.89823) QuantErr: 13.89823 batch_time=0.39496 
Train Epoch: 47 [89/500 5696/32000 (18%)] Loss: 0.38489 (QuantReg: 14.01339) QuantErr: 14.01339 batch_time=0.39175 
Train Epoch: 47 [97/500 6208/32000 (19%)] Loss: 0.36128 (QuantReg: 13.93463) QuantErr: 13.93463 batch_time=0.39253 
Train Epoch: 47 [105/500 6720/32000 (21%)] Loss: 0.61529 (QuantReg: 13.98765) QuantErr: 13.98765 batch_time=0.39300 
Train Epoch: 47 [113/500 7232/32000 (23%)] Loss: 0.49687 (QuantReg: 13.66361) QuantErr: 13.66361 batch_time=0.39883 
Train Epoch: 47 [121/500 7744/32000 (24%)] Loss: 0.51137 (QuantReg: 13.97906) QuantErr: 13.97906 batch_time=0.39585 
Train Epoch: 47 [129/500 8256/32000 (26%)] Loss: 0.57307 (QuantReg: 13.62782) QuantErr: 13.62782 batch_time=0.39252 
Train Epoch: 47 [137/500 8768/32000 (27%)] Loss: 0.59471 (QuantReg: 13.70318) QuantErr: 13.70318 batch_time=0.44999 
Train Epoch: 47 [145/500 9280/32000 (29%)] Loss: 0.32392 (QuantReg: 14.06433) QuantErr: 14.06433 batch_time=0.41007 
Train Epoch: 47 [153/500 9792/32000 (31%)] Loss: 0.72929 (QuantReg: 13.63357) QuantErr: 13.63357 batch_time=0.39699 
Train Epoch: 47 [161/500 10304/32000 (32%)] Loss: 0.60686 (QuantReg: 13.62568) QuantErr: 13.62568 batch_time=0.39616 
Train Epoch: 47 [169/500 10816/32000 (34%)] Loss: 0.72821 (QuantReg: 13.69710) QuantErr: 13.69710 batch_time=0.39523 
Train Epoch: 47 [177/500 11328/32000 (35%)] Loss: 0.46649 (QuantReg: 13.79538) QuantErr: 13.79538 batch_time=0.41736 
Train Epoch: 47 [185/500 11840/32000 (37%)] Loss: 0.55803 (QuantReg: 13.80605) QuantErr: 13.80605 batch_time=0.40259 
Train Epoch: 47 [193/500 12352/32000 (39%)] Loss: 0.39430 (QuantReg: 13.52681) QuantErr: 13.52681 batch_time=0.40006 
Train Epoch: 47 [201/500 12864/32000 (40%)] Loss: 0.46987 (QuantReg: 13.82554) QuantErr: 13.82554 batch_time=0.38947 
Train Epoch: 47 [209/500 13376/32000 (42%)] Loss: 0.46696 (QuantReg: 13.96004) QuantErr: 13.96004 batch_time=0.39535 
Train Epoch: 47 [217/500 13888/32000 (43%)] Loss: 0.53363 (QuantReg: 14.08350) QuantErr: 14.08350 batch_time=0.40208 
Train Epoch: 47 [225/500 14400/32000 (45%)] Loss: 0.36677 (QuantReg: 13.77604) QuantErr: 13.77604 batch_time=0.43395 
Train Epoch: 47 [233/500 14912/32000 (47%)] Loss: 0.39102 (QuantReg: 14.02826) QuantErr: 14.02826 batch_time=0.44907 
Train Epoch: 47 [241/500 15424/32000 (48%)] Loss: 0.47954 (QuantReg: 13.96309) QuantErr: 13.96309 batch_time=0.45005 
Train Epoch: 47 [249/500 15936/32000 (50%)] Loss: 0.40748 (QuantReg: 13.77166) QuantErr: 13.77166 batch_time=0.39234 
Train Epoch: 47 [257/500 16448/32000 (51%)] Loss: 0.79094 (QuantReg: 13.37027) QuantErr: 13.37027 batch_time=0.45060 
Train Epoch: 47 [265/500 16960/32000 (53%)] Loss: 0.46877 (QuantReg: 13.95474) QuantErr: 13.95474 batch_time=0.39176 
Train Epoch: 47 [273/500 17472/32000 (55%)] Loss: 0.43117 (QuantReg: 14.08889) QuantErr: 14.08889 batch_time=0.39352 
Train Epoch: 47 [281/500 17984/32000 (56%)] Loss: 0.89179 (QuantReg: 13.90138) QuantErr: 13.90138 batch_time=0.41280 
Train Epoch: 47 [289/500 18496/32000 (58%)] Loss: 0.65249 (QuantReg: 13.64949) QuantErr: 13.64949 batch_time=0.39071 
Train Epoch: 47 [297/500 19008/32000 (59%)] Loss: 0.57890 (QuantReg: 13.88076) QuantErr: 13.88076 batch_time=0.39103 
Train Epoch: 47 [305/500 19520/32000 (61%)] Loss: 0.30337 (QuantReg: 13.56905) QuantErr: 13.56905 batch_time=0.39746 
Train Epoch: 47 [313/500 20032/32000 (63%)] Loss: 0.45093 (QuantReg: 13.97380) QuantErr: 13.97380 batch_time=0.40422 
Train Epoch: 47 [321/500 20544/32000 (64%)] Loss: 0.54992 (QuantReg: 13.97083) QuantErr: 13.97083 batch_time=0.39658 
Train Epoch: 47 [329/500 21056/32000 (66%)] Loss: 0.60060 (QuantReg: 13.92720) QuantErr: 13.92720 batch_time=0.39315 
Train Epoch: 47 [337/500 21568/32000 (67%)] Loss: 0.47534 (QuantReg: 14.01493) QuantErr: 14.01493 batch_time=0.44158 
Train Epoch: 47 [345/500 22080/32000 (69%)] Loss: 0.36382 (QuantReg: 14.17655) QuantErr: 14.17655 batch_time=0.41114 
Train Epoch: 47 [353/500 22592/32000 (71%)] Loss: 0.39225 (QuantReg: 14.15591) QuantErr: 14.15591 batch_time=0.41244 
Train Epoch: 47 [361/500 23104/32000 (72%)] Loss: 0.39559 (QuantReg: 14.05048) QuantErr: 14.05048 batch_time=0.41652 
Train Epoch: 47 [369/500 23616/32000 (74%)] Loss: 0.45829 (QuantReg: 14.09437) QuantErr: 14.09437 batch_time=0.39944 
Train Epoch: 47 [377/500 24128/32000 (75%)] Loss: 0.45326 (QuantReg: 14.03553) QuantErr: 14.03553 batch_time=0.40996 
Train Epoch: 47 [385/500 24640/32000 (77%)] Loss: 0.47778 (QuantReg: 13.84767) QuantErr: 13.84767 batch_time=0.39991 
Train Epoch: 47 [393/500 25152/32000 (79%)] Loss: 0.30568 (QuantReg: 13.89297) QuantErr: 13.89297 batch_time=0.38706 
Train Epoch: 47 [401/500 25664/32000 (80%)] Loss: 0.39147 (QuantReg: 13.97183) QuantErr: 13.97183 batch_time=0.39321 
Train Epoch: 47 [409/500 26176/32000 (82%)] Loss: 0.59651 (QuantReg: 13.97636) QuantErr: 13.97636 batch_time=0.39770 
Train Epoch: 47 [417/500 26688/32000 (83%)] Loss: 0.33480 (QuantReg: 13.95704) QuantErr: 13.95704 batch_time=0.39045 
Train Epoch: 47 [425/500 27200/32000 (85%)] Loss: 0.52786 (QuantReg: 14.02367) QuantErr: 14.02367 batch_time=0.39523 
Train Epoch: 47 [433/500 27712/32000 (87%)] Loss: 0.17423 (QuantReg: 14.26279) QuantErr: 14.26279 batch_time=0.39852 
Train Epoch: 47 [441/500 28224/32000 (88%)] Loss: 0.39386 (QuantReg: 14.07830) QuantErr: 14.07830 batch_time=0.38922 
Train Epoch: 47 [449/500 28736/32000 (90%)] Loss: 0.31310 (QuantReg: 13.76000) QuantErr: 13.76000 batch_time=0.45523 
Train Epoch: 47 [457/500 29248/32000 (91%)] Loss: 0.43258 (QuantReg: 14.04998) QuantErr: 14.04998 batch_time=0.39006 
Train Epoch: 47 [465/500 29760/32000 (93%)] Loss: 0.31053 (QuantReg: 14.25386) QuantErr: 14.25386 batch_time=0.42651 
Train Epoch: 47 [473/500 30272/32000 (95%)] Loss: 0.51050 (QuantReg: 14.15290) QuantErr: 14.15290 batch_time=0.39663 
Train Epoch: 47 [481/500 30784/32000 (96%)] Loss: 0.77355 (QuantReg: 13.95846) QuantErr: 13.95846 batch_time=0.39451 
Train Epoch: 47 [489/500 31296/32000 (98%)] Loss: 0.43622 (QuantReg: 13.58695) QuantErr: 13.58695 batch_time=0.39425 
Train Epoch: 47 [497/500 31808/32000 (99%)] Loss: 0.49312 (QuantReg: 13.89486) QuantErr: 13.89486 batch_time=0.41401 
Train Epoch: 47 codebook_update_time=1.89607
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch47.pth ...
Done in 23.525s
removing stale ckpt [epoch 46] [took 0.00s]
 epoch          : 47
 loss           : 0.478330875903368
 quant_reg      : 13.887016004562378
 quant_err      : 13.887016004562378
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 23500
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.309859154929576
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.201709641658766
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.901408450704225
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.65639989913458
 MSRVTT_full_test/t2v_metrics/R1: 14.347826086956522
 MSRVTT_full_test/t2v_metrics/R5: 39.163879598662206
 MSRVTT_full_test/t2v_metrics/R10: 53.07692307692308
 MSRVTT_full_test/t2v_metrics/R50: 82.14046822742475
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.356521739130436
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.011719681649605
 MSRVTT_full_test/v2t_metrics/R1: 17.123745819397993
 MSRVTT_full_test/v2t_metrics/R5: 45.986622073578594
 MSRVTT_full_test/v2t_metrics/R10: 61.23745819397993
 MSRVTT_full_test/v2t_metrics/R50: 87.25752508361204
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.720234113712376
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.39841559946991
 mnt_best       : 31.21627740799768
 not_improved_count: 3
Train Epoch: 48 [1/500 64/32000 (0%)] Loss: 0.82781 (QuantReg: 13.42533) QuantErr: 13.42533 batch_time=33.59090 
Train Epoch: 48 [9/500 576/32000 (2%)] Loss: 0.46001 (QuantReg: 13.94231) QuantErr: 13.94231 batch_time=0.39709 
Train Epoch: 48 [17/500 1088/32000 (3%)] Loss: 0.67388 (QuantReg: 13.93309) QuantErr: 13.93309 batch_time=0.40589 
Train Epoch: 48 [25/500 1600/32000 (5%)] Loss: 0.49051 (QuantReg: 14.13012) QuantErr: 14.13012 batch_time=0.54492 
Train Epoch: 48 [33/500 2112/32000 (7%)] Loss: 0.24445 (QuantReg: 13.90308) QuantErr: 13.90308 batch_time=0.39616 
Train Epoch: 48 [41/500 2624/32000 (8%)] Loss: 0.39871 (QuantReg: 13.89870) QuantErr: 13.89870 batch_time=0.38701 
Train Epoch: 48 [49/500 3136/32000 (10%)] Loss: 0.45438 (QuantReg: 14.05844) QuantErr: 14.05844 batch_time=0.38934 
Train Epoch: 48 [57/500 3648/32000 (11%)] Loss: 0.44057 (QuantReg: 13.57269) QuantErr: 13.57269 batch_time=0.45456 
Train Epoch: 48 [65/500 4160/32000 (13%)] Loss: 0.51699 (QuantReg: 13.82948) QuantErr: 13.82948 batch_time=1.05253 
Train Epoch: 48 [73/500 4672/32000 (15%)] Loss: 0.49264 (QuantReg: 13.86061) QuantErr: 13.86061 batch_time=0.39316 
Train Epoch: 48 [81/500 5184/32000 (16%)] Loss: 0.45669 (QuantReg: 13.86765) QuantErr: 13.86765 batch_time=0.38855 
Train Epoch: 48 [89/500 5696/32000 (18%)] Loss: 0.48756 (QuantReg: 13.73148) QuantErr: 13.73148 batch_time=0.49187 
Train Epoch: 48 [97/500 6208/32000 (19%)] Loss: 0.43404 (QuantReg: 13.94408) QuantErr: 13.94408 batch_time=0.39573 
Train Epoch: 48 [105/500 6720/32000 (21%)] Loss: 0.62130 (QuantReg: 14.21661) QuantErr: 14.21661 batch_time=0.39961 
Train Epoch: 48 [113/500 7232/32000 (23%)] Loss: 0.46289 (QuantReg: 13.98832) QuantErr: 13.98832 batch_time=0.39105 
Train Epoch: 48 [121/500 7744/32000 (24%)] Loss: 0.28511 (QuantReg: 13.92432) QuantErr: 13.92432 batch_time=0.44751 
Train Epoch: 48 [129/500 8256/32000 (26%)] Loss: 0.20766 (QuantReg: 13.92447) QuantErr: 13.92447 batch_time=1.04879 
Train Epoch: 48 [137/500 8768/32000 (27%)] Loss: 0.47373 (QuantReg: 13.42923) QuantErr: 13.42923 batch_time=0.39787 
Train Epoch: 48 [145/500 9280/32000 (29%)] Loss: 0.56283 (QuantReg: 14.29421) QuantErr: 14.29421 batch_time=0.43396 
Train Epoch: 48 [153/500 9792/32000 (31%)] Loss: 0.51151 (QuantReg: 14.09227) QuantErr: 14.09227 batch_time=0.52853 
Train Epoch: 48 [161/500 10304/32000 (32%)] Loss: 0.43061 (QuantReg: 13.87079) QuantErr: 13.87079 batch_time=0.39721 
Train Epoch: 48 [169/500 10816/32000 (34%)] Loss: 0.34027 (QuantReg: 13.92069) QuantErr: 13.92069 batch_time=0.40355 
Train Epoch: 48 [177/500 11328/32000 (35%)] Loss: 0.45119 (QuantReg: 13.78581) QuantErr: 13.78581 batch_time=0.39636 
Train Epoch: 48 [185/500 11840/32000 (37%)] Loss: 0.44558 (QuantReg: 13.76458) QuantErr: 13.76458 batch_time=0.46129 
Train Epoch: 48 [193/500 12352/32000 (39%)] Loss: 0.48110 (QuantReg: 13.79242) QuantErr: 13.79242 batch_time=1.09989 
Train Epoch: 48 [201/500 12864/32000 (40%)] Loss: 0.44525 (QuantReg: 13.70147) QuantErr: 13.70147 batch_time=0.39444 
Train Epoch: 48 [209/500 13376/32000 (42%)] Loss: 0.43116 (QuantReg: 14.17392) QuantErr: 14.17392 batch_time=0.42066 
Train Epoch: 48 [217/500 13888/32000 (43%)] Loss: 0.52257 (QuantReg: 13.69851) QuantErr: 13.69851 batch_time=0.52008 
Train Epoch: 48 [225/500 14400/32000 (45%)] Loss: 0.50952 (QuantReg: 14.18809) QuantErr: 14.18809 batch_time=0.43831 
Train Epoch: 48 [233/500 14912/32000 (47%)] Loss: 0.46656 (QuantReg: 13.82643) QuantErr: 13.82643 batch_time=0.39677 
Train Epoch: 48 [241/500 15424/32000 (48%)] Loss: 0.37820 (QuantReg: 14.07523) QuantErr: 14.07523 batch_time=0.38779 
Train Epoch: 48 [249/500 15936/32000 (50%)] Loss: 0.41269 (QuantReg: 14.01425) QuantErr: 14.01425 batch_time=0.45279 
Train Epoch: 48 [257/500 16448/32000 (51%)] Loss: 0.47197 (QuantReg: 13.71122) QuantErr: 13.71122 batch_time=1.04201 
Train Epoch: 48 [265/500 16960/32000 (53%)] Loss: 0.40821 (QuantReg: 14.01142) QuantErr: 14.01142 batch_time=0.39041 
Train Epoch: 48 [273/500 17472/32000 (55%)] Loss: 0.45931 (QuantReg: 14.15411) QuantErr: 14.15411 batch_time=0.39770 
Train Epoch: 48 [281/500 17984/32000 (56%)] Loss: 0.50056 (QuantReg: 13.94207) QuantErr: 13.94207 batch_time=0.52655 
Train Epoch: 48 [289/500 18496/32000 (58%)] Loss: 0.54703 (QuantReg: 13.99055) QuantErr: 13.99055 batch_time=0.41117 
Train Epoch: 48 [297/500 19008/32000 (59%)] Loss: 0.58998 (QuantReg: 13.65799) QuantErr: 13.65799 batch_time=0.39972 
Train Epoch: 48 [305/500 19520/32000 (61%)] Loss: 0.74440 (QuantReg: 13.90357) QuantErr: 13.90357 batch_time=0.39652 
Train Epoch: 48 [313/500 20032/32000 (63%)] Loss: 0.40177 (QuantReg: 13.57744) QuantErr: 13.57744 batch_time=0.50012 
Train Epoch: 48 [321/500 20544/32000 (64%)] Loss: 0.24309 (QuantReg: 14.00929) QuantErr: 14.00929 batch_time=0.99343 
Train Epoch: 48 [329/500 21056/32000 (66%)] Loss: 0.45370 (QuantReg: 14.09654) QuantErr: 14.09654 batch_time=0.40349 
Train Epoch: 48 [337/500 21568/32000 (67%)] Loss: 0.23014 (QuantReg: 14.21511) QuantErr: 14.21511 batch_time=0.39996 
Train Epoch: 48 [345/500 22080/32000 (69%)] Loss: 0.46373 (QuantReg: 13.96649) QuantErr: 13.96649 batch_time=0.53939 
Train Epoch: 48 [353/500 22592/32000 (71%)] Loss: 0.42253 (QuantReg: 14.06125) QuantErr: 14.06125 batch_time=0.40292 
Train Epoch: 48 [361/500 23104/32000 (72%)] Loss: 0.40767 (QuantReg: 14.21059) QuantErr: 14.21059 batch_time=0.39988 
Train Epoch: 48 [369/500 23616/32000 (74%)] Loss: 0.47653 (QuantReg: 13.93228) QuantErr: 13.93228 batch_time=0.40643 
Train Epoch: 48 [377/500 24128/32000 (75%)] Loss: 0.44611 (QuantReg: 13.81381) QuantErr: 13.81381 batch_time=0.46277 
Train Epoch: 48 [385/500 24640/32000 (77%)] Loss: 0.45083 (QuantReg: 14.08795) QuantErr: 14.08795 batch_time=1.03956 
Train Epoch: 48 [393/500 25152/32000 (79%)] Loss: 0.67673 (QuantReg: 13.80386) QuantErr: 13.80386 batch_time=0.40456 
Train Epoch: 48 [401/500 25664/32000 (80%)] Loss: 0.52911 (QuantReg: 13.59069) QuantErr: 13.59069 batch_time=0.42501 
Train Epoch: 48 [409/500 26176/32000 (82%)] Loss: 0.19461 (QuantReg: 13.87989) QuantErr: 13.87989 batch_time=0.55549 
Train Epoch: 48 [417/500 26688/32000 (83%)] Loss: 0.38246 (QuantReg: 13.72328) QuantErr: 13.72328 batch_time=0.40406 
Train Epoch: 48 [425/500 27200/32000 (85%)] Loss: 0.58292 (QuantReg: 13.85916) QuantErr: 13.85916 batch_time=0.39334 
Train Epoch: 48 [433/500 27712/32000 (87%)] Loss: 0.54660 (QuantReg: 13.86658) QuantErr: 13.86658 batch_time=0.40374 
Train Epoch: 48 [441/500 28224/32000 (88%)] Loss: 0.53069 (QuantReg: 13.95189) QuantErr: 13.95189 batch_time=0.46533 
Train Epoch: 48 [449/500 28736/32000 (90%)] Loss: 0.43664 (QuantReg: 13.83439) QuantErr: 13.83439 batch_time=1.07950 
Train Epoch: 48 [457/500 29248/32000 (91%)] Loss: 0.60057 (QuantReg: 13.91389) QuantErr: 13.91389 batch_time=0.44333 
Train Epoch: 48 [465/500 29760/32000 (93%)] Loss: 0.36661 (QuantReg: 13.71533) QuantErr: 13.71533 batch_time=0.39474 
Train Epoch: 48 [473/500 30272/32000 (95%)] Loss: 0.47259 (QuantReg: 13.95369) QuantErr: 13.95369 batch_time=0.50612 
Train Epoch: 48 [481/500 30784/32000 (96%)] Loss: 0.32696 (QuantReg: 13.95285) QuantErr: 13.95285 batch_time=0.39468 
Train Epoch: 48 [489/500 31296/32000 (98%)] Loss: 0.46886 (QuantReg: 13.71446) QuantErr: 13.71446 batch_time=0.39474 
Train Epoch: 48 [497/500 31808/32000 (99%)] Loss: 0.37753 (QuantReg: 13.76503) QuantErr: 13.76503 batch_time=0.39580 
Train Epoch: 48 codebook_update_time=2.12408
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch48.pth ...
Done in 4.389s
removing stale ckpt [epoch 47] [took 0.00s]
 epoch          : 48
 loss           : 0.46834749656915664
 quant_reg      : 13.924839065551758
 quant_err      : 13.924839065551758
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 24000
 MSRVTT_full_val/t2v_metrics/R1: 33.601609657947684
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.319919517102615
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.97020838138953
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.040241448692153
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.19729943215721
 MSRVTT_full_test/t2v_metrics/R1: 14.381270903010034
 MSRVTT_full_test/t2v_metrics/R5: 38.39464882943144
 MSRVTT_full_test/t2v_metrics/R10: 52.508361204013376
 MSRVTT_full_test/t2v_metrics/R50: 81.83946488294315
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.7304347826087
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.720773312835963
 MSRVTT_full_test/v2t_metrics/R1: 17.59197324414716
 MSRVTT_full_test/v2t_metrics/R5: 45.819397993311036
 MSRVTT_full_test/v2t_metrics/R10: 61.57190635451505
 MSRVTT_full_test/v2t_metrics/R50: 87.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.287290969899665
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.7492808662108
 mnt_best       : 31.21627740799768
 not_improved_count: 4
Train Epoch: 49 [1/500 64/32000 (0%)] Loss: 0.29898 (QuantReg: 13.78616) QuantErr: 13.78616 batch_time=33.89891 
Train Epoch: 49 [9/500 576/32000 (2%)] Loss: 0.62761 (QuantReg: 13.51007) QuantErr: 13.51007 batch_time=0.38063 
Train Epoch: 49 [17/500 1088/32000 (3%)] Loss: 0.63555 (QuantReg: 14.21180) QuantErr: 14.21180 batch_time=0.38476 
Train Epoch: 49 [25/500 1600/32000 (5%)] Loss: 0.46117 (QuantReg: 13.91110) QuantErr: 13.91110 batch_time=0.41304 
Train Epoch: 49 [33/500 2112/32000 (7%)] Loss: 0.41503 (QuantReg: 13.92996) QuantErr: 13.92996 batch_time=0.37969 
Train Epoch: 49 [41/500 2624/32000 (8%)] Loss: 0.46086 (QuantReg: 13.72283) QuantErr: 13.72283 batch_time=0.38896 
Train Epoch: 49 [49/500 3136/32000 (10%)] Loss: 0.43053 (QuantReg: 14.08460) QuantErr: 14.08460 batch_time=0.38123 
Train Epoch: 49 [57/500 3648/32000 (11%)] Loss: 0.50522 (QuantReg: 14.11258) QuantErr: 14.11258 batch_time=0.55775 
Train Epoch: 49 [65/500 4160/32000 (13%)] Loss: 0.66298 (QuantReg: 13.57912) QuantErr: 13.57912 batch_time=0.39447 
Train Epoch: 49 [73/500 4672/32000 (15%)] Loss: 0.67314 (QuantReg: 13.51320) QuantErr: 13.51320 batch_time=0.38048 
Train Epoch: 49 [81/500 5184/32000 (16%)] Loss: 0.41572 (QuantReg: 13.90769) QuantErr: 13.90769 batch_time=0.38714 
Train Epoch: 49 [89/500 5696/32000 (18%)] Loss: 0.44986 (QuantReg: 13.50857) QuantErr: 13.50857 batch_time=0.38655 
Train Epoch: 49 [97/500 6208/32000 (19%)] Loss: 0.40898 (QuantReg: 13.93110) QuantErr: 13.93110 batch_time=0.38562 
Train Epoch: 49 [105/500 6720/32000 (21%)] Loss: 0.29106 (QuantReg: 13.89920) QuantErr: 13.89920 batch_time=0.39432 
Train Epoch: 49 [113/500 7232/32000 (23%)] Loss: 0.36520 (QuantReg: 13.87049) QuantErr: 13.87049 batch_time=0.40067 
Train Epoch: 49 [121/500 7744/32000 (24%)] Loss: 0.38832 (QuantReg: 13.51025) QuantErr: 13.51025 batch_time=0.55039 
Train Epoch: 49 [129/500 8256/32000 (26%)] Loss: 0.40388 (QuantReg: 14.10173) QuantErr: 14.10173 batch_time=0.37610 
Train Epoch: 49 [137/500 8768/32000 (27%)] Loss: 0.42035 (QuantReg: 13.93644) QuantErr: 13.93644 batch_time=0.37919 
Train Epoch: 49 [145/500 9280/32000 (29%)] Loss: 0.62199 (QuantReg: 13.71715) QuantErr: 13.71715 batch_time=0.38187 
Train Epoch: 49 [153/500 9792/32000 (31%)] Loss: 0.37419 (QuantReg: 14.38856) QuantErr: 14.38856 batch_time=0.43193 
Train Epoch: 49 [161/500 10304/32000 (32%)] Loss: 0.42640 (QuantReg: 13.62054) QuantErr: 13.62054 batch_time=0.38412 
Train Epoch: 49 [169/500 10816/32000 (34%)] Loss: 0.31640 (QuantReg: 14.11908) QuantErr: 14.11908 batch_time=0.38871 
Train Epoch: 49 [177/500 11328/32000 (35%)] Loss: 0.48739 (QuantReg: 13.96283) QuantErr: 13.96283 batch_time=0.38730 
Train Epoch: 49 [185/500 11840/32000 (37%)] Loss: 0.66660 (QuantReg: 14.03685) QuantErr: 14.03685 batch_time=0.56621 
Train Epoch: 49 [193/500 12352/32000 (39%)] Loss: 0.50320 (QuantReg: 14.00081) QuantErr: 14.00081 batch_time=0.42154 
Train Epoch: 49 [201/500 12864/32000 (40%)] Loss: 0.37797 (QuantReg: 14.05606) QuantErr: 14.05606 batch_time=0.38398 
Train Epoch: 49 [209/500 13376/32000 (42%)] Loss: 0.28102 (QuantReg: 13.99520) QuantErr: 13.99520 batch_time=0.40836 
Train Epoch: 49 [217/500 13888/32000 (43%)] Loss: 0.45014 (QuantReg: 14.02794) QuantErr: 14.02794 batch_time=0.38327 
Train Epoch: 49 [225/500 14400/32000 (45%)] Loss: 0.42201 (QuantReg: 13.89298) QuantErr: 13.89298 batch_time=0.38831 
Train Epoch: 49 [233/500 14912/32000 (47%)] Loss: 0.42728 (QuantReg: 13.88409) QuantErr: 13.88409 batch_time=0.38689 
Train Epoch: 49 [241/500 15424/32000 (48%)] Loss: 0.33001 (QuantReg: 13.95648) QuantErr: 13.95648 batch_time=0.40857 
Train Epoch: 49 [249/500 15936/32000 (50%)] Loss: 0.30974 (QuantReg: 13.95738) QuantErr: 13.95738 batch_time=0.57009 
Train Epoch: 49 [257/500 16448/32000 (51%)] Loss: 0.47215 (QuantReg: 14.03865) QuantErr: 14.03865 batch_time=0.38397 
Train Epoch: 49 [265/500 16960/32000 (53%)] Loss: 0.45361 (QuantReg: 13.82689) QuantErr: 13.82689 batch_time=0.39687 
Train Epoch: 49 [273/500 17472/32000 (55%)] Loss: 0.70025 (QuantReg: 13.74725) QuantErr: 13.74725 batch_time=0.39040 
Train Epoch: 49 [281/500 17984/32000 (56%)] Loss: 0.53873 (QuantReg: 14.07667) QuantErr: 14.07667 batch_time=0.43424 
Train Epoch: 49 [289/500 18496/32000 (58%)] Loss: 0.31158 (QuantReg: 14.13585) QuantErr: 14.13585 batch_time=0.39866 
Train Epoch: 49 [297/500 19008/32000 (59%)] Loss: 0.46978 (QuantReg: 14.03003) QuantErr: 14.03003 batch_time=0.41360 
Train Epoch: 49 [305/500 19520/32000 (61%)] Loss: 0.46608 (QuantReg: 13.72674) QuantErr: 13.72674 batch_time=0.40942 
Train Epoch: 49 [313/500 20032/32000 (63%)] Loss: 0.41697 (QuantReg: 14.22750) QuantErr: 14.22750 batch_time=0.39604 
Train Epoch: 49 [321/500 20544/32000 (64%)] Loss: 0.38767 (QuantReg: 13.98396) QuantErr: 13.98396 batch_time=0.39343 
Train Epoch: 49 [329/500 21056/32000 (66%)] Loss: 0.54628 (QuantReg: 14.13835) QuantErr: 14.13835 batch_time=0.38843 
Train Epoch: 49 [337/500 21568/32000 (67%)] Loss: 0.28962 (QuantReg: 13.92372) QuantErr: 13.92372 batch_time=0.39691 
Train Epoch: 49 [345/500 22080/32000 (69%)] Loss: 0.46060 (QuantReg: 13.87054) QuantErr: 13.87054 batch_time=0.38137 
Train Epoch: 49 [353/500 22592/32000 (71%)] Loss: 0.46752 (QuantReg: 14.21564) QuantErr: 14.21564 batch_time=0.39391 
Train Epoch: 49 [361/500 23104/32000 (72%)] Loss: 0.52341 (QuantReg: 13.82840) QuantErr: 13.82840 batch_time=0.43421 
Train Epoch: 49 [369/500 23616/32000 (74%)] Loss: 0.37301 (QuantReg: 13.90312) QuantErr: 13.90312 batch_time=0.38499 
Train Epoch: 49 [377/500 24128/32000 (75%)] Loss: 0.51457 (QuantReg: 13.77643) QuantErr: 13.77643 batch_time=0.39887 
Train Epoch: 49 [385/500 24640/32000 (77%)] Loss: 0.44656 (QuantReg: 14.12751) QuantErr: 14.12751 batch_time=0.44387 
Train Epoch: 49 [393/500 25152/32000 (79%)] Loss: 0.50838 (QuantReg: 13.88984) QuantErr: 13.88984 batch_time=0.37756 
Train Epoch: 49 [401/500 25664/32000 (80%)] Loss: 0.41858 (QuantReg: 13.60511) QuantErr: 13.60511 batch_time=0.37822 
Train Epoch: 49 [409/500 26176/32000 (82%)] Loss: 0.46760 (QuantReg: 13.91582) QuantErr: 13.91582 batch_time=0.38651 
Train Epoch: 49 [417/500 26688/32000 (83%)] Loss: 0.53499 (QuantReg: 13.88677) QuantErr: 13.88677 batch_time=0.39985 
Train Epoch: 49 [425/500 27200/32000 (85%)] Loss: 0.42394 (QuantReg: 14.00465) QuantErr: 14.00465 batch_time=0.40956 
Train Epoch: 49 [433/500 27712/32000 (87%)] Loss: 0.32968 (QuantReg: 14.38202) QuantErr: 14.38202 batch_time=0.38664 
Train Epoch: 49 [441/500 28224/32000 (88%)] Loss: 0.57812 (QuantReg: 13.91459) QuantErr: 13.91459 batch_time=0.38410 
Train Epoch: 49 [449/500 28736/32000 (90%)] Loss: 0.69995 (QuantReg: 13.90486) QuantErr: 13.90486 batch_time=0.41976 
Train Epoch: 49 [457/500 29248/32000 (91%)] Loss: 0.34662 (QuantReg: 14.27658) QuantErr: 14.27658 batch_time=0.40153 
Train Epoch: 49 [465/500 29760/32000 (93%)] Loss: 0.48954 (QuantReg: 13.74777) QuantErr: 13.74777 batch_time=0.38373 
Train Epoch: 49 [473/500 30272/32000 (95%)] Loss: 0.53360 (QuantReg: 13.79112) QuantErr: 13.79112 batch_time=0.38748 
Train Epoch: 49 [481/500 30784/32000 (96%)] Loss: 0.28209 (QuantReg: 13.82726) QuantErr: 13.82726 batch_time=0.39492 
Train Epoch: 49 [489/500 31296/32000 (98%)] Loss: 0.54595 (QuantReg: 14.10202) QuantErr: 14.10202 batch_time=0.38565 
Train Epoch: 49 [497/500 31808/32000 (99%)] Loss: 0.35990 (QuantReg: 13.84398) QuantErr: 13.84398 batch_time=0.40226 
Train Epoch: 49 codebook_update_time=2.25681
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch49.pth ...
Done in 4.049s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 0.4713225647211075
 quant_reg      : 13.931646322250366
 quant_err      : 13.931646322250366
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 24500
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.317907444668009
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.377336597000124
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.100603621730382
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.4956747380723
 MSRVTT_full_test/t2v_metrics/R1: 14.481605351170568
 MSRVTT_full_test/t2v_metrics/R5: 39.86622073578595
 MSRVTT_full_test/t2v_metrics/R10: 52.508361204013376
 MSRVTT_full_test/t2v_metrics/R50: 82.17391304347827
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.77324414715719
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.180524263797977
 MSRVTT_full_test/v2t_metrics/R1: 17.792642140468228
 MSRVTT_full_test/v2t_metrics/R5: 45.785953177257525
 MSRVTT_full_test/v2t_metrics/R10: 60.96989966555184
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.571070234113712
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.75891872854555
 mnt_best       : 31.21627740799768
 not_improved_count: 5
Train Epoch: 50 [1/500 64/32000 (0%)] Loss: 0.45241 (QuantReg: 13.71906) QuantErr: 13.71906 batch_time=34.01811 
Train Epoch: 50 [9/500 576/32000 (2%)] Loss: 0.46321 (QuantReg: 14.17272) QuantErr: 14.17272 batch_time=0.40586 
Train Epoch: 50 [17/500 1088/32000 (3%)] Loss: 0.68352 (QuantReg: 13.69168) QuantErr: 13.69168 batch_time=0.40357 
Train Epoch: 50 [25/500 1600/32000 (5%)] Loss: 0.74195 (QuantReg: 13.93369) QuantErr: 13.93369 batch_time=0.39706 
Train Epoch: 50 [33/500 2112/32000 (7%)] Loss: 0.52349 (QuantReg: 14.12412) QuantErr: 14.12412 batch_time=0.38687 
Train Epoch: 50 [41/500 2624/32000 (8%)] Loss: 0.55175 (QuantReg: 13.96423) QuantErr: 13.96423 batch_time=0.38595 
Train Epoch: 50 [49/500 3136/32000 (10%)] Loss: 0.33824 (QuantReg: 14.27839) QuantErr: 14.27839 batch_time=0.39875 
Train Epoch: 50 [57/500 3648/32000 (11%)] Loss: 0.57408 (QuantReg: 13.98473) QuantErr: 13.98473 batch_time=0.39061 
Train Epoch: 50 [65/500 4160/32000 (13%)] Loss: 0.42525 (QuantReg: 13.95823) QuantErr: 13.95823 batch_time=1.44120 
Train Epoch: 50 [73/500 4672/32000 (15%)] Loss: 0.39901 (QuantReg: 13.95948) QuantErr: 13.95948 batch_time=0.39660 
Train Epoch: 50 [81/500 5184/32000 (16%)] Loss: 0.36639 (QuantReg: 13.69932) QuantErr: 13.69932 batch_time=0.40285 
Train Epoch: 50 [89/500 5696/32000 (18%)] Loss: 0.51616 (QuantReg: 13.74429) QuantErr: 13.74429 batch_time=0.43505 
Train Epoch: 50 [97/500 6208/32000 (19%)] Loss: 0.36319 (QuantReg: 13.89071) QuantErr: 13.89071 batch_time=0.43173 
Train Epoch: 50 [105/500 6720/32000 (21%)] Loss: 0.24968 (QuantReg: 14.21439) QuantErr: 14.21439 batch_time=0.39295 
Train Epoch: 50 [113/500 7232/32000 (23%)] Loss: 0.41661 (QuantReg: 14.00061) QuantErr: 14.00061 batch_time=0.40629 
Train Epoch: 50 [121/500 7744/32000 (24%)] Loss: 0.38221 (QuantReg: 13.97265) QuantErr: 13.97265 batch_time=0.39471 
Train Epoch: 50 [129/500 8256/32000 (26%)] Loss: 0.52547 (QuantReg: 13.84059) QuantErr: 13.84059 batch_time=1.34145 
Train Epoch: 50 [137/500 8768/32000 (27%)] Loss: 0.50650 (QuantReg: 14.06635) QuantErr: 14.06635 batch_time=0.43809 
Train Epoch: 50 [145/500 9280/32000 (29%)] Loss: 0.47183 (QuantReg: 14.23314) QuantErr: 14.23314 batch_time=0.45315 
Train Epoch: 50 [153/500 9792/32000 (31%)] Loss: 0.42421 (QuantReg: 13.91094) QuantErr: 13.91094 batch_time=0.40004 
Train Epoch: 50 [161/500 10304/32000 (32%)] Loss: 0.55441 (QuantReg: 14.19016) QuantErr: 14.19016 batch_time=0.38757 
Train Epoch: 50 [169/500 10816/32000 (34%)] Loss: 0.46266 (QuantReg: 14.33508) QuantErr: 14.33508 batch_time=0.40932 
Train Epoch: 50 [177/500 11328/32000 (35%)] Loss: 0.40524 (QuantReg: 14.01755) QuantErr: 14.01755 batch_time=0.46606 
Train Epoch: 50 [185/500 11840/32000 (37%)] Loss: 0.37202 (QuantReg: 14.07623) QuantErr: 14.07623 batch_time=0.41152 
Train Epoch: 50 [193/500 12352/32000 (39%)] Loss: 0.40673 (QuantReg: 14.06642) QuantErr: 14.06642 batch_time=1.29296 
Train Epoch: 50 [201/500 12864/32000 (40%)] Loss: 0.47612 (QuantReg: 14.05233) QuantErr: 14.05233 batch_time=0.39743 
Train Epoch: 50 [209/500 13376/32000 (42%)] Loss: 0.50860 (QuantReg: 13.90047) QuantErr: 13.90047 batch_time=0.40247 
Train Epoch: 50 [217/500 13888/32000 (43%)] Loss: 0.19448 (QuantReg: 13.96614) QuantErr: 13.96614 batch_time=0.42106 
Train Epoch: 50 [225/500 14400/32000 (45%)] Loss: 0.63418 (QuantReg: 13.88754) QuantErr: 13.88754 batch_time=0.41040 
Train Epoch: 50 [233/500 14912/32000 (47%)] Loss: 0.25218 (QuantReg: 13.71910) QuantErr: 13.71910 batch_time=0.39395 
Train Epoch: 50 [241/500 15424/32000 (48%)] Loss: 0.41212 (QuantReg: 13.73518) QuantErr: 13.73518 batch_time=0.43477 
Train Epoch: 50 [249/500 15936/32000 (50%)] Loss: 0.40676 (QuantReg: 13.86446) QuantErr: 13.86446 batch_time=0.39301 
Train Epoch: 50 [257/500 16448/32000 (51%)] Loss: 0.45314 (QuantReg: 13.55212) QuantErr: 13.55212 batch_time=1.33019 
Train Epoch: 50 [265/500 16960/32000 (53%)] Loss: 0.29103 (QuantReg: 14.11849) QuantErr: 14.11849 batch_time=0.41714 
Train Epoch: 50 [273/500 17472/32000 (55%)] Loss: 0.32944 (QuantReg: 13.93331) QuantErr: 13.93331 batch_time=0.39139 
Train Epoch: 50 [281/500 17984/32000 (56%)] Loss: 0.33283 (QuantReg: 14.46769) QuantErr: 14.46769 batch_time=0.38661 
Train Epoch: 50 [289/500 18496/32000 (58%)] Loss: 0.45168 (QuantReg: 14.05545) QuantErr: 14.05545 batch_time=0.45393 
Train Epoch: 50 [297/500 19008/32000 (59%)] Loss: 0.35164 (QuantReg: 13.80088) QuantErr: 13.80088 batch_time=0.39303 
Train Epoch: 50 [305/500 19520/32000 (61%)] Loss: 0.64776 (QuantReg: 13.86428) QuantErr: 13.86428 batch_time=0.39872 
Train Epoch: 50 [313/500 20032/32000 (63%)] Loss: 0.55183 (QuantReg: 14.06787) QuantErr: 14.06787 batch_time=0.39862 
Train Epoch: 50 [321/500 20544/32000 (64%)] Loss: 0.50480 (QuantReg: 14.12522) QuantErr: 14.12522 batch_time=1.29059 
Train Epoch: 50 [329/500 21056/32000 (66%)] Loss: 0.43069 (QuantReg: 13.87408) QuantErr: 13.87408 batch_time=0.40458 
Train Epoch: 50 [337/500 21568/32000 (67%)] Loss: 0.51987 (QuantReg: 13.60750) QuantErr: 13.60750 batch_time=0.40083 
Train Epoch: 50 [345/500 22080/32000 (69%)] Loss: 0.72741 (QuantReg: 13.62861) QuantErr: 13.62861 batch_time=0.40439 
Train Epoch: 50 [353/500 22592/32000 (71%)] Loss: 0.30167 (QuantReg: 13.99366) QuantErr: 13.99366 batch_time=0.39658 
Train Epoch: 50 [361/500 23104/32000 (72%)] Loss: 0.40033 (QuantReg: 14.12690) QuantErr: 14.12690 batch_time=0.40635 
Train Epoch: 50 [369/500 23616/32000 (74%)] Loss: 0.39787 (QuantReg: 14.32101) QuantErr: 14.32101 batch_time=0.40170 
Train Epoch: 50 [377/500 24128/32000 (75%)] Loss: 0.42698 (QuantReg: 14.01557) QuantErr: 14.01557 batch_time=0.40067 
Train Epoch: 50 [385/500 24640/32000 (77%)] Loss: 0.44985 (QuantReg: 13.86877) QuantErr: 13.86877 batch_time=1.36586 
Train Epoch: 50 [393/500 25152/32000 (79%)] Loss: 0.35257 (QuantReg: 14.19398) QuantErr: 14.19398 batch_time=0.40748 
Train Epoch: 50 [401/500 25664/32000 (80%)] Loss: 0.68696 (QuantReg: 13.97071) QuantErr: 13.97071 batch_time=0.38636 
Train Epoch: 50 [409/500 26176/32000 (82%)] Loss: 0.31031 (QuantReg: 13.91402) QuantErr: 13.91402 batch_time=0.38830 
Train Epoch: 50 [417/500 26688/32000 (83%)] Loss: 0.52709 (QuantReg: 14.11403) QuantErr: 14.11403 batch_time=0.38952 
Train Epoch: 50 [425/500 27200/32000 (85%)] Loss: 0.34533 (QuantReg: 14.26905) QuantErr: 14.26905 batch_time=0.39540 
Train Epoch: 50 [433/500 27712/32000 (87%)] Loss: 0.58895 (QuantReg: 13.69699) QuantErr: 13.69699 batch_time=0.45111 
Train Epoch: 50 [441/500 28224/32000 (88%)] Loss: 0.64852 (QuantReg: 14.15324) QuantErr: 14.15324 batch_time=0.41230 
Train Epoch: 50 [449/500 28736/32000 (90%)] Loss: 0.49214 (QuantReg: 13.99663) QuantErr: 13.99663 batch_time=1.29266 
Train Epoch: 50 [457/500 29248/32000 (91%)] Loss: 0.69673 (QuantReg: 14.16841) QuantErr: 14.16841 batch_time=0.38994 
Train Epoch: 50 [465/500 29760/32000 (93%)] Loss: 0.65946 (QuantReg: 13.85404) QuantErr: 13.85404 batch_time=0.41791 
Train Epoch: 50 [473/500 30272/32000 (95%)] Loss: 0.38699 (QuantReg: 13.93679) QuantErr: 13.93679 batch_time=0.40021 
Train Epoch: 50 [481/500 30784/32000 (96%)] Loss: 0.26982 (QuantReg: 13.84216) QuantErr: 13.84216 batch_time=0.39378 
Train Epoch: 50 [489/500 31296/32000 (98%)] Loss: 0.46615 (QuantReg: 14.19638) QuantErr: 14.19638 batch_time=0.39990 
Train Epoch: 50 [497/500 31808/32000 (99%)] Loss: 0.50921 (QuantReg: 14.05301) QuantErr: 14.05301 batch_time=0.39711 
Train Epoch: 50 codebook_update_time=1.81325
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/checkpoint-epoch50.pth ...
Done in 3.690s
removing stale ckpt [epoch 49] [took 0.59s]
 epoch          : 50
 loss           : 0.4659360290467739
 quant_reg      : 13.978385345458985
 quant_err      : 13.978385345458985
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 25000
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.354124748490946
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.5345290271981
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.885311871227364
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.10655936763641
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 39.56521739130435
 MSRVTT_full_test/t2v_metrics/R10: 53.1438127090301
 MSRVTT_full_test/t2v_metrics/R50: 81.87290969899665
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.1056856187291
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.935636608208934
 MSRVTT_full_test/v2t_metrics/R1: 17.859531772575252
 MSRVTT_full_test/v2t_metrics/R5: 46.65551839464883
 MSRVTT_full_test/v2t_metrics/R10: 61.37123745819398
 MSRVTT_full_test/v2t_metrics/R50: 87.65886287625418
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.057190635451505
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.11755175393594
 mnt_best       : 31.21627740799768
 not_improved_count: 6
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/trained_model.pth ...
Ckpt loaded at epoch 44.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 14.648829431438127
 t2v_metrics/R5/final_eval: 39.197324414715716
 t2v_metrics/R10/final_eval: 52.97658862876254
 t2v_metrics/R50/final_eval: 82.27424749163879
 t2v_metrics/MedR/final_eval: 9.0
 t2v_metrics/MeanR/final_eval: 44.13010033444816
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 31.21627740799768
 v2t_metrics/R1/final_eval: 17.692307692307693
 v2t_metrics/R5/final_eval: 46.58862876254181
 v2t_metrics/R10/final_eval: 61.103678929765884
 v2t_metrics/R50/final_eval: 87.82608695652173
 v2t_metrics/MedR/final_eval: 6.0
 v2t_metrics/MeanR/final_eval: 31.56421404682274
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 36.929825619817166
Best epoch for the monitored metric: 44
Script took 05h13m19s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_bs64/trained_model.pth
