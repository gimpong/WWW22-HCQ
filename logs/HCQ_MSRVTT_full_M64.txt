Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 699.7655742168427 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 37.973520278930664 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 227.29818081855774 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 153.1819097995758 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch0.pth ...
Done in 1.398s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch0.pth ...
Done in 3.957s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.4024144869215292
 MSRVTT_full_val/t2v_metrics/R5: 0.6036217303822937
 MSRVTT_full_val/t2v_metrics/R10: 2.0120724346076457
 MSRVTT_full_val/t2v_metrics/R50: 7.847082494969819
 MSRVTT_full_val/t2v_metrics/MedR: 259.0
 MSRVTT_full_val/t2v_metrics/MeanR: 252.95372233400403
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.7876997265933326
 MSRVTT_full_val/v2t_metrics/R1: 0.0
 MSRVTT_full_val/v2t_metrics/R5: 1.2072434607645874
 MSRVTT_full_val/v2t_metrics/R10: 2.0120724346076457
 MSRVTT_full_val/v2t_metrics/R50: 10.060362173038229
 MSRVTT_full_val/v2t_metrics/MedR: 268.0
 MSRVTT_full_val/v2t_metrics/MeanR: 254.9979879275654
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/t2v_metrics/R1: 0.0
 MSRVTT_full_test/t2v_metrics/R5: 0.26755852842809363
 MSRVTT_full_test/t2v_metrics/R10: 0.43478260869565216
 MSRVTT_full_test/t2v_metrics/R50: 1.6722408026755853
 MSRVTT_full_test/t2v_metrics/MedR: 1534.0
 MSRVTT_full_test/t2v_metrics/MeanR: 1516.915719063545
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/v2t_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/v2t_metrics/R5: 0.10033444816053512
 MSRVTT_full_test/v2t_metrics/R10: 0.3010033444816054
 MSRVTT_full_test/v2t_metrics/R50: 1.4046822742474916
 MSRVTT_full_test/v2t_metrics/MedR: 1501.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1500.770568561873
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.10033444816053508
 mnt_best       : 0.0
 not_improved_count: 0
Train Epoch: 1 [1/250 128/32000 (0%)] Loss: 9.84107 (QuantReg: 21.64523) QuantErr: 21.64523 batch_time=31.23449 
Train Epoch: 1 [12/250 1536/32000 (5%)] Loss: 8.75718 (QuantReg: 21.86864) QuantErr: 21.86864 batch_time=0.59063 
Train Epoch: 1 [23/250 2944/32000 (9%)] Loss: 6.96475 (QuantReg: 21.96830) QuantErr: 21.96830 batch_time=0.57910 
Train Epoch: 1 [34/250 4352/32000 (14%)] Loss: 6.84821 (QuantReg: 21.88293) QuantErr: 21.88293 batch_time=0.60060 
Train Epoch: 1 [45/250 5760/32000 (18%)] Loss: 6.36984 (QuantReg: 21.88220) QuantErr: 21.88220 batch_time=1.05850 
Train Epoch: 1 [56/250 7168/32000 (22%)] Loss: 6.10447 (QuantReg: 21.93598) QuantErr: 21.93598 batch_time=0.61938 
Train Epoch: 1 [67/250 8576/32000 (27%)] Loss: 6.14486 (QuantReg: 21.86426) QuantErr: 21.86426 batch_time=0.62251 
Train Epoch: 1 [78/250 9984/32000 (31%)] Loss: 5.84340 (QuantReg: 21.84121) QuantErr: 21.84121 batch_time=0.59618 
Train Epoch: 1 [89/250 11392/32000 (36%)] Loss: 5.26277 (QuantReg: 21.84746) QuantErr: 21.84746 batch_time=0.57968 
Train Epoch: 1 [100/250 12800/32000 (40%)] Loss: 5.54440 (QuantReg: 21.97083) QuantErr: 21.97083 batch_time=0.58173 
Train Epoch: 1 [111/250 14208/32000 (44%)] Loss: 5.08175 (QuantReg: 21.99950) QuantErr: 21.99950 batch_time=0.60330 
Train Epoch: 1 [122/250 15616/32000 (49%)] Loss: 4.84912 (QuantReg: 21.95480) QuantErr: 21.95480 batch_time=0.59673 
Train Epoch: 1 [133/250 17024/32000 (53%)] Loss: 4.82949 (QuantReg: 21.91630) QuantErr: 21.91630 batch_time=0.60081 
Train Epoch: 1 [144/250 18432/32000 (58%)] Loss: 4.61996 (QuantReg: 21.99438) QuantErr: 21.99438 batch_time=0.59282 
Train Epoch: 1 [155/250 19840/32000 (62%)] Loss: 4.77879 (QuantReg: 21.89929) QuantErr: 21.89929 batch_time=0.60055 
Train Epoch: 1 [166/250 21248/32000 (66%)] Loss: 5.01980 (QuantReg: 21.90684) QuantErr: 21.90684 batch_time=0.91110 
Train Epoch: 1 [177/250 22656/32000 (71%)] Loss: 4.69256 (QuantReg: 21.94803) QuantErr: 21.94803 batch_time=0.58780 
Train Epoch: 1 [188/250 24064/32000 (75%)] Loss: 4.46452 (QuantReg: 21.98446) QuantErr: 21.98446 batch_time=0.59184 
Train Epoch: 1 [199/250 25472/32000 (80%)] Loss: 4.42184 (QuantReg: 21.90111) QuantErr: 21.90111 batch_time=0.61127 
Train Epoch: 1 [210/250 26880/32000 (84%)] Loss: 4.21491 (QuantReg: 21.93777) QuantErr: 21.93777 batch_time=0.61493 
Train Epoch: 1 [221/250 28288/32000 (88%)] Loss: 4.50560 (QuantReg: 21.93088) QuantErr: 21.93088 batch_time=0.59723 
Train Epoch: 1 [232/250 29696/32000 (93%)] Loss: 4.23803 (QuantReg: 21.93600) QuantErr: 21.93600 batch_time=0.58482 
Train Epoch: 1 [243/250 31104/32000 (97%)] Loss: 3.96540 (QuantReg: 21.93834) QuantErr: 21.93834 batch_time=0.60046 
Train Epoch: 1 codebook_update_time=3.39217
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch1.pth ...
Done in 4.780s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch1.pth ...
Done in 9.616s
 epoch          : 1
 loss           : 5.321539053916931
 quant_reg      : 21.91211215209961
 quant_err      : 21.91211215209961
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 250
 MSRVTT_full_val/t2v_metrics/R1: 20.72434607645875
 MSRVTT_full_val/t2v_metrics/R5: 55.1307847082495
 MSRVTT_full_val/t2v_metrics/R10: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R50: 95.57344064386318
 MSRVTT_full_val/t2v_metrics/MedR: 5.0
 MSRVTT_full_val/t2v_metrics/MeanR: 11.865191146881287
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 43.13018782459013
 MSRVTT_full_val/v2t_metrics/R1: 25.35211267605634
 MSRVTT_full_val/v2t_metrics/R5: 61.971830985915496
 MSRVTT_full_val/v2t_metrics/R10: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R50: 96.17706237424547
 MSRVTT_full_val/v2t_metrics/MedR: 4.0
 MSRVTT_full_val/v2t_metrics/MeanR: 10.014084507042254
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 49.55691636708076
 MSRVTT_full_test/t2v_metrics/R1: 7.25752508361204
 MSRVTT_full_test/t2v_metrics/R5: 23.010033444816052
 MSRVTT_full_test/t2v_metrics/R10: 34.54849498327759
 MSRVTT_full_test/t2v_metrics/R50: 70.40133779264214
 MSRVTT_full_test/t2v_metrics/MedR: 20.0
 MSRVTT_full_test/t2v_metrics/MeanR: 62.49765886287626
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 17.935423787838374
 MSRVTT_full_test/v2t_metrics/R1: 7.926421404682274
 MSRVTT_full_test/v2t_metrics/R5: 26.622073578595316
 MSRVTT_full_test/v2t_metrics/R10: 39.66555183946488
 MSRVTT_full_test/v2t_metrics/R50: 75.91973244147157
 MSRVTT_full_test/v2t_metrics/MedR: 17.0
 MSRVTT_full_test/v2t_metrics/MeanR: 51.374916387959864
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 20.303808685995474
 mnt_best       : 17.935423787838374
 not_improved_count: 0
Train Epoch: 2 [1/250 128/32000 (0%)] Loss: 3.64126 (QuantReg: 14.16699) QuantErr: 14.16699 batch_time=28.36624 
Train Epoch: 2 [12/250 1536/32000 (5%)] Loss: 3.97685 (QuantReg: 14.49990) QuantErr: 14.49990 batch_time=0.58689 
Train Epoch: 2 [23/250 2944/32000 (9%)] Loss: 3.79063 (QuantReg: 14.51346) QuantErr: 14.51346 batch_time=2.28799 
Train Epoch: 2 [34/250 4352/32000 (14%)] Loss: 3.72569 (QuantReg: 14.63170) QuantErr: 14.63170 batch_time=1.09270 
Train Epoch: 2 [45/250 5760/32000 (18%)] Loss: 3.70320 (QuantReg: 14.79098) QuantErr: 14.79098 batch_time=0.66040 
Train Epoch: 2 [56/250 7168/32000 (22%)] Loss: 3.80816 (QuantReg: 14.79479) QuantErr: 14.79479 batch_time=0.59197 
Train Epoch: 2 [67/250 8576/32000 (27%)] Loss: 3.98862 (QuantReg: 15.01952) QuantErr: 15.01952 batch_time=0.58949 
Train Epoch: 2 [78/250 9984/32000 (31%)] Loss: 3.50670 (QuantReg: 15.42972) QuantErr: 15.42972 batch_time=0.58887 
Train Epoch: 2 [89/250 11392/32000 (36%)] Loss: 4.07613 (QuantReg: 15.26204) QuantErr: 15.26204 batch_time=0.59522 
Train Epoch: 2 [100/250 12800/32000 (40%)] Loss: 3.49094 (QuantReg: 15.52607) QuantErr: 15.52607 batch_time=0.58242 
Train Epoch: 2 [111/250 14208/32000 (44%)] Loss: 3.49617 (QuantReg: 15.66782) QuantErr: 15.66782 batch_time=0.57236 
Train Epoch: 2 [122/250 15616/32000 (49%)] Loss: 3.33956 (QuantReg: 15.97831) QuantErr: 15.97831 batch_time=0.68941 
Train Epoch: 2 [133/250 17024/32000 (53%)] Loss: 3.23604 (QuantReg: 15.69199) QuantErr: 15.69199 batch_time=2.23767 
Train Epoch: 2 [144/250 18432/32000 (58%)] Loss: 3.41553 (QuantReg: 15.94725) QuantErr: 15.94725 batch_time=3.11013 
Train Epoch: 2 [155/250 19840/32000 (62%)] Loss: 3.24432 (QuantReg: 15.93342) QuantErr: 15.93342 batch_time=0.61200 
Train Epoch: 2 [166/250 21248/32000 (66%)] Loss: 3.24295 (QuantReg: 16.46363) QuantErr: 16.46363 batch_time=0.61733 
Train Epoch: 2 [177/250 22656/32000 (71%)] Loss: 3.46243 (QuantReg: 16.25108) QuantErr: 16.25108 batch_time=0.62366 
Train Epoch: 2 [188/250 24064/32000 (75%)] Loss: 3.47945 (QuantReg: 16.36459) QuantErr: 16.36459 batch_time=0.82491 
Train Epoch: 2 [199/250 25472/32000 (80%)] Loss: 3.13007 (QuantReg: 16.27084) QuantErr: 16.27084 batch_time=0.69930 
Train Epoch: 2 [210/250 26880/32000 (84%)] Loss: 3.09304 (QuantReg: 16.43120) QuantErr: 16.43120 batch_time=0.60297 
Train Epoch: 2 [221/250 28288/32000 (88%)] Loss: 2.76927 (QuantReg: 16.79702) QuantErr: 16.79702 batch_time=0.60712 
Train Epoch: 2 [232/250 29696/32000 (93%)] Loss: 3.97498 (QuantReg: 16.80825) QuantErr: 16.80825 batch_time=0.61037 
Train Epoch: 2 [243/250 31104/32000 (97%)] Loss: 3.34359 (QuantReg: 16.82433) QuantErr: 16.82433 batch_time=0.60044 
Train Epoch: 2 codebook_update_time=3.76665
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch2.pth ...
Done in 3.721s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch2.pth ...
Done in 7.321s
removing stale ckpt [epoch 1] [took 0.00s]
removing stale ckpt [epoch 0] [took 0.00s]
 epoch          : 2
 loss           : 3.542511791229248
 quant_reg      : 15.67380562210083
 quant_err      : 15.67380562210083
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 25.75452716297787
 MSRVTT_full_val/t2v_metrics/R5: 64.58752515090544
 MSRVTT_full_val/t2v_metrics/R10: 76.45875251509054
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.002012072434608
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 50.28940270742057
 MSRVTT_full_val/v2t_metrics/R1: 31.187122736418512
 MSRVTT_full_val/v2t_metrics/R5: 69.81891348088531
 MSRVTT_full_val/v2t_metrics/R10: 82.29376257545272
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.044265593561368
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.37740799895777
 MSRVTT_full_test/t2v_metrics/R1: 9.23076923076923
 MSRVTT_full_test/t2v_metrics/R5: 30.20066889632107
 MSRVTT_full_test/t2v_metrics/R10: 43.1438127090301
 MSRVTT_full_test/t2v_metrics/R50: 74.18060200668896
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 52.257859531772574
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.91171820677931
 MSRVTT_full_test/v2t_metrics/R1: 12.508361204013378
 MSRVTT_full_test/v2t_metrics/R5: 35.1505016722408
 MSRVTT_full_test/v2t_metrics/R10: 48.862876254180605
 MSRVTT_full_test/v2t_metrics/R50: 81.67224080267559
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 38.725752508361204
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.799500315823163
 mnt_best       : 22.91171820677931
 not_improved_count: 0
Train Epoch: 3 [1/250 128/32000 (0%)] Loss: 2.97338 (QuantReg: 14.25529) QuantErr: 14.25529 batch_time=29.22966 
Train Epoch: 3 [12/250 1536/32000 (5%)] Loss: 3.11378 (QuantReg: 14.35239) QuantErr: 14.35239 batch_time=0.59420 
Train Epoch: 3 [23/250 2944/32000 (9%)] Loss: 3.44392 (QuantReg: 14.58715) QuantErr: 14.58715 batch_time=0.58781 
Train Epoch: 3 [34/250 4352/32000 (14%)] Loss: 2.71491 (QuantReg: 14.26878) QuantErr: 14.26878 batch_time=0.58728 
Train Epoch: 3 [45/250 5760/32000 (18%)] Loss: 3.26237 (QuantReg: 14.47257) QuantErr: 14.47257 batch_time=0.58172 
Train Epoch: 3 [56/250 7168/32000 (22%)] Loss: 2.62706 (QuantReg: 14.72720) QuantErr: 14.72720 batch_time=0.58515 
Train Epoch: 3 [67/250 8576/32000 (27%)] Loss: 2.84487 (QuantReg: 14.68552) QuantErr: 14.68552 batch_time=0.60221 
Train Epoch: 3 [78/250 9984/32000 (31%)] Loss: 3.04068 (QuantReg: 14.67648) QuantErr: 14.67648 batch_time=0.59052 
Train Epoch: 3 [89/250 11392/32000 (36%)] Loss: 2.99181 (QuantReg: 14.94877) QuantErr: 14.94877 batch_time=0.60459 
Train Epoch: 3 [100/250 12800/32000 (40%)] Loss: 2.80847 (QuantReg: 14.76844) QuantErr: 14.76844 batch_time=0.59857 
Train Epoch: 3 [111/250 14208/32000 (44%)] Loss: 2.90268 (QuantReg: 14.52486) QuantErr: 14.52486 batch_time=0.60165 
Train Epoch: 3 [122/250 15616/32000 (49%)] Loss: 2.52919 (QuantReg: 14.84119) QuantErr: 14.84119 batch_time=0.59035 
Train Epoch: 3 [133/250 17024/32000 (53%)] Loss: 3.08769 (QuantReg: 15.02775) QuantErr: 15.02775 batch_time=0.58014 
Train Epoch: 3 [144/250 18432/32000 (58%)] Loss: 2.87199 (QuantReg: 14.92443) QuantErr: 14.92443 batch_time=0.62182 
Train Epoch: 3 [155/250 19840/32000 (62%)] Loss: 3.56130 (QuantReg: 14.82546) QuantErr: 14.82546 batch_time=0.59126 
Train Epoch: 3 [166/250 21248/32000 (66%)] Loss: 2.31932 (QuantReg: 15.73215) QuantErr: 15.73215 batch_time=0.59665 
Train Epoch: 3 [177/250 22656/32000 (71%)] Loss: 2.51124 (QuantReg: 15.26971) QuantErr: 15.26971 batch_time=0.70447 
Train Epoch: 3 [188/250 24064/32000 (75%)] Loss: 3.13850 (QuantReg: 15.00201) QuantErr: 15.00201 batch_time=0.63592 
Train Epoch: 3 [199/250 25472/32000 (80%)] Loss: 2.61472 (QuantReg: 14.96303) QuantErr: 14.96303 batch_time=0.60284 
Train Epoch: 3 [210/250 26880/32000 (84%)] Loss: 2.84925 (QuantReg: 15.35983) QuantErr: 15.35983 batch_time=0.59277 
Train Epoch: 3 [221/250 28288/32000 (88%)] Loss: 2.55795 (QuantReg: 15.45343) QuantErr: 15.45343 batch_time=0.60055 
Train Epoch: 3 [232/250 29696/32000 (93%)] Loss: 2.28242 (QuantReg: 15.68906) QuantErr: 15.68906 batch_time=0.59575 
Train Epoch: 3 [243/250 31104/32000 (97%)] Loss: 2.72492 (QuantReg: 15.60001) QuantErr: 15.60001 batch_time=0.59623 
Train Epoch: 3 codebook_update_time=3.28232
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch3.pth ...
Done in 5.407s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch3.pth ...
Done in 9.057s
removing stale ckpt [epoch 2] [took 0.06s]
 epoch          : 3
 loss           : 2.925414920806885
 quant_reg      : 14.963696022033691
 quant_err      : 14.963696022033691
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 750
 MSRVTT_full_val/t2v_metrics/R1: 29.175050301810867
 MSRVTT_full_val/t2v_metrics/R5: 63.78269617706238
 MSRVTT_full_val/t2v_metrics/R10: 79.27565392354124
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.967806841046277
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.83861677800643
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 71.42857142857143
 MSRVTT_full_val/v2t_metrics/R10: 85.11066398390342
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.647887323943662
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.93831305386576
 MSRVTT_full_test/t2v_metrics/R1: 11.471571906354516
 MSRVTT_full_test/t2v_metrics/R5: 31.73913043478261
 MSRVTT_full_test/t2v_metrics/R10: 44.64882943143812
 MSRVTT_full_test/t2v_metrics/R50: 76.72240802675586
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 49.289966555183945
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.332380991566197
 MSRVTT_full_test/v2t_metrics/R1: 13.143812709030101
 MSRVTT_full_test/v2t_metrics/R5: 36.2876254180602
 MSRVTT_full_test/v2t_metrics/R10: 50.903010033444815
 MSRVTT_full_test/v2t_metrics/R50: 81.40468227424749
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 38.759197324414714
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.956170510638064
 mnt_best       : 25.332380991566197
 not_improved_count: 0
Train Epoch: 4 [1/250 128/32000 (0%)] Loss: 3.22601 (QuantReg: 14.29694) QuantErr: 14.29694 batch_time=31.45500 
Train Epoch: 4 [12/250 1536/32000 (5%)] Loss: 2.76464 (QuantReg: 14.32090) QuantErr: 14.32090 batch_time=0.58279 
Train Epoch: 4 [23/250 2944/32000 (9%)] Loss: 2.22160 (QuantReg: 14.41803) QuantErr: 14.41803 batch_time=0.87297 
Train Epoch: 4 [34/250 4352/32000 (14%)] Loss: 2.51324 (QuantReg: 14.41874) QuantErr: 14.41874 batch_time=0.60041 
Train Epoch: 4 [45/250 5760/32000 (18%)] Loss: 2.66253 (QuantReg: 14.43830) QuantErr: 14.43830 batch_time=0.59005 
Train Epoch: 4 [56/250 7168/32000 (22%)] Loss: 3.01391 (QuantReg: 14.40920) QuantErr: 14.40920 batch_time=0.59039 
Train Epoch: 4 [67/250 8576/32000 (27%)] Loss: 3.05664 (QuantReg: 14.66743) QuantErr: 14.66743 batch_time=0.58711 
Train Epoch: 4 [78/250 9984/32000 (31%)] Loss: 2.79063 (QuantReg: 14.90826) QuantErr: 14.90826 batch_time=0.59873 
Train Epoch: 4 [89/250 11392/32000 (36%)] Loss: 2.63188 (QuantReg: 14.66634) QuantErr: 14.66634 batch_time=0.59002 
Train Epoch: 4 [100/250 12800/32000 (40%)] Loss: 2.57874 (QuantReg: 14.60490) QuantErr: 14.60490 batch_time=0.58632 
Train Epoch: 4 [111/250 14208/32000 (44%)] Loss: 2.73087 (QuantReg: 14.73402) QuantErr: 14.73402 batch_time=0.58867 
Train Epoch: 4 [122/250 15616/32000 (49%)] Loss: 2.56963 (QuantReg: 14.78740) QuantErr: 14.78740 batch_time=0.58374 
Train Epoch: 4 [133/250 17024/32000 (53%)] Loss: 2.46960 (QuantReg: 14.77747) QuantErr: 14.77747 batch_time=0.60202 
Train Epoch: 4 [144/250 18432/32000 (58%)] Loss: 2.72564 (QuantReg: 14.77863) QuantErr: 14.77863 batch_time=0.58825 
Train Epoch: 4 [155/250 19840/32000 (62%)] Loss: 2.81536 (QuantReg: 15.19646) QuantErr: 15.19646 batch_time=0.60606 
Train Epoch: 4 [166/250 21248/32000 (66%)] Loss: 2.95314 (QuantReg: 15.18117) QuantErr: 15.18117 batch_time=0.61954 
Train Epoch: 4 [177/250 22656/32000 (71%)] Loss: 2.93532 (QuantReg: 14.97595) QuantErr: 14.97595 batch_time=0.58502 
Train Epoch: 4 [188/250 24064/32000 (75%)] Loss: 2.69398 (QuantReg: 15.29047) QuantErr: 15.29047 batch_time=0.60819 
Train Epoch: 4 [199/250 25472/32000 (80%)] Loss: 2.71173 (QuantReg: 14.91224) QuantErr: 14.91224 batch_time=0.59320 
Train Epoch: 4 [210/250 26880/32000 (84%)] Loss: 2.39472 (QuantReg: 15.19447) QuantErr: 15.19447 batch_time=0.58684 
Train Epoch: 4 [221/250 28288/32000 (88%)] Loss: 2.36449 (QuantReg: 15.37149) QuantErr: 15.37149 batch_time=0.60495 
Train Epoch: 4 [232/250 29696/32000 (93%)] Loss: 2.64860 (QuantReg: 14.80807) QuantErr: 14.80807 batch_time=0.59391 
Train Epoch: 4 [243/250 31104/32000 (97%)] Loss: 2.40370 (QuantReg: 14.93432) QuantErr: 14.93432 batch_time=0.66159 
Train Epoch: 4 codebook_update_time=3.34696
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch4.pth ...
Done in 5.591s
removing stale ckpt [epoch 3] [took 0.01s]
 epoch          : 4
 loss           : 2.6154040184020997
 quant_reg      : 14.815018100738525
 quant_err      : 14.815018100738525
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 27.16297786720322
 MSRVTT_full_val/t2v_metrics/R5: 65.59356136820925
 MSRVTT_full_val/t2v_metrics/R10: 79.07444668008048
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.694164989939637
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.034523779234966
 MSRVTT_full_val/v2t_metrics/R1: 35.61368209255533
 MSRVTT_full_val/v2t_metrics/R5: 74.24547283702213
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.394366197183099
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.01727107682054
 MSRVTT_full_test/t2v_metrics/R1: 11.237458193979933
 MSRVTT_full_test/t2v_metrics/R5: 31.304347826086957
 MSRVTT_full_test/t2v_metrics/R10: 44.54849498327759
 MSRVTT_full_test/t2v_metrics/R50: 76.65551839464882
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 51.57692307692308
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.02468360881761
 MSRVTT_full_test/v2t_metrics/R1: 14.214046822742475
 MSRVTT_full_test/v2t_metrics/R5: 39.23076923076923
 MSRVTT_full_test/v2t_metrics/R10: 53.779264214046826
 MSRVTT_full_test/v2t_metrics/R50: 84.38127090301003
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.623745819397996
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.06846575894387
 mnt_best       : 25.332380991566197
 not_improved_count: 1
Train Epoch: 5 [1/250 128/32000 (0%)] Loss: 2.60866 (QuantReg: 14.59197) QuantErr: 14.59197 batch_time=26.45988 
Train Epoch: 5 [12/250 1536/32000 (5%)] Loss: 2.66340 (QuantReg: 14.53155) QuantErr: 14.53155 batch_time=0.57582 
Train Epoch: 5 [23/250 2944/32000 (9%)] Loss: 2.82779 (QuantReg: 14.48937) QuantErr: 14.48937 batch_time=0.58906 
Train Epoch: 5 [34/250 4352/32000 (14%)] Loss: 2.16315 (QuantReg: 14.79783) QuantErr: 14.79783 batch_time=0.58502 
Train Epoch: 5 [45/250 5760/32000 (18%)] Loss: 2.30209 (QuantReg: 14.39651) QuantErr: 14.39651 batch_time=0.60440 
Train Epoch: 5 [56/250 7168/32000 (22%)] Loss: 2.47138 (QuantReg: 15.06170) QuantErr: 15.06170 batch_time=0.59323 
Train Epoch: 5 [67/250 8576/32000 (27%)] Loss: 2.33794 (QuantReg: 14.47606) QuantErr: 14.47606 batch_time=0.59532 
Train Epoch: 5 [78/250 9984/32000 (31%)] Loss: 2.68722 (QuantReg: 14.55662) QuantErr: 14.55662 batch_time=0.59744 
Train Epoch: 5 [89/250 11392/32000 (36%)] Loss: 2.18550 (QuantReg: 14.66592) QuantErr: 14.66592 batch_time=0.58319 
Train Epoch: 5 [100/250 12800/32000 (40%)] Loss: 2.60448 (QuantReg: 14.86302) QuantErr: 14.86302 batch_time=0.59927 
Train Epoch: 5 [111/250 14208/32000 (44%)] Loss: 2.26121 (QuantReg: 14.85518) QuantErr: 14.85518 batch_time=0.74625 
Train Epoch: 5 [122/250 15616/32000 (49%)] Loss: 2.38710 (QuantReg: 14.94091) QuantErr: 14.94091 batch_time=0.60849 
Train Epoch: 5 [133/250 17024/32000 (53%)] Loss: 2.53704 (QuantReg: 14.99354) QuantErr: 14.99354 batch_time=0.58904 
Train Epoch: 5 [144/250 18432/32000 (58%)] Loss: 1.78529 (QuantReg: 14.97338) QuantErr: 14.97338 batch_time=3.26731 
Train Epoch: 5 [155/250 19840/32000 (62%)] Loss: 2.37497 (QuantReg: 14.83386) QuantErr: 14.83386 batch_time=0.60525 
Train Epoch: 5 [166/250 21248/32000 (66%)] Loss: 2.24372 (QuantReg: 15.09606) QuantErr: 15.09606 batch_time=0.60723 
Train Epoch: 5 [177/250 22656/32000 (71%)] Loss: 2.16717 (QuantReg: 15.28164) QuantErr: 15.28164 batch_time=0.58998 
Train Epoch: 5 [188/250 24064/32000 (75%)] Loss: 2.56200 (QuantReg: 14.95469) QuantErr: 14.95469 batch_time=0.62400 
Train Epoch: 5 [199/250 25472/32000 (80%)] Loss: 2.22112 (QuantReg: 15.10982) QuantErr: 15.10982 batch_time=0.59928 
Train Epoch: 5 [210/250 26880/32000 (84%)] Loss: 2.34612 (QuantReg: 14.72991) QuantErr: 14.72991 batch_time=0.60386 
Train Epoch: 5 [221/250 28288/32000 (88%)] Loss: 2.28513 (QuantReg: 15.18830) QuantErr: 15.18830 batch_time=1.01376 
Train Epoch: 5 [232/250 29696/32000 (93%)] Loss: 1.97610 (QuantReg: 15.16856) QuantErr: 15.16856 batch_time=0.60221 
Train Epoch: 5 [243/250 31104/32000 (97%)] Loss: 2.24502 (QuantReg: 15.11371) QuantErr: 15.11371 batch_time=0.71742 
Train Epoch: 5 codebook_update_time=3.24762
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch5.pth ...
Done in 4.958s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch5.pth ...
Done in 12.331s
removing stale ckpt [epoch 4] [took 0.00s]
 epoch          : 5
 loss           : 2.3330318994522097
 quant_reg      : 14.844124626159667
 quant_err      : 14.844124626159667
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 1250
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.329979879275655
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.69181884387441
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.386317907444668
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.151809490687704
 MSRVTT_full_test/t2v_metrics/R1: 11.906354515050166
 MSRVTT_full_test/t2v_metrics/R5: 34.214046822742475
 MSRVTT_full_test/t2v_metrics/R10: 48.12709030100334
 MSRVTT_full_test/t2v_metrics/R50: 79.53177257525084
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.637123745819395
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.964411954892267
 MSRVTT_full_test/v2t_metrics/R1: 15.551839464882944
 MSRVTT_full_test/v2t_metrics/R5: 41.53846153846154
 MSRVTT_full_test/v2t_metrics/R10: 56.38795986622073
 MSRVTT_full_test/v2t_metrics/R50: 85.91973244147157
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.262541806020067
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.14918469193156
 mnt_best       : 26.964411954892267
 not_improved_count: 0
Train Epoch: 6 [1/250 128/32000 (0%)] Loss: 2.43388 (QuantReg: 14.58242) QuantErr: 14.58242 batch_time=27.27870 
Train Epoch: 6 [12/250 1536/32000 (5%)] Loss: 2.40945 (QuantReg: 14.40860) QuantErr: 14.40860 batch_time=0.58861 
Train Epoch: 6 [23/250 2944/32000 (9%)] Loss: 1.96574 (QuantReg: 14.74355) QuantErr: 14.74355 batch_time=0.58337 
Train Epoch: 6 [34/250 4352/32000 (14%)] Loss: 2.21380 (QuantReg: 14.59332) QuantErr: 14.59332 batch_time=0.57424 
Train Epoch: 6 [45/250 5760/32000 (18%)] Loss: 1.66816 (QuantReg: 14.71906) QuantErr: 14.71906 batch_time=0.63062 
Train Epoch: 6 [56/250 7168/32000 (22%)] Loss: 2.00218 (QuantReg: 14.90226) QuantErr: 14.90226 batch_time=0.59463 
Train Epoch: 6 [67/250 8576/32000 (27%)] Loss: 2.15569 (QuantReg: 14.99964) QuantErr: 14.99964 batch_time=2.38002 
Train Epoch: 6 [78/250 9984/32000 (31%)] Loss: 1.77766 (QuantReg: 14.77501) QuantErr: 14.77501 batch_time=0.59168 
Train Epoch: 6 [89/250 11392/32000 (36%)] Loss: 2.31792 (QuantReg: 14.70892) QuantErr: 14.70892 batch_time=0.59072 
Train Epoch: 6 [100/250 12800/32000 (40%)] Loss: 2.13122 (QuantReg: 14.96975) QuantErr: 14.96975 batch_time=0.59049 
Train Epoch: 6 [111/250 14208/32000 (44%)] Loss: 2.19770 (QuantReg: 14.70490) QuantErr: 14.70490 batch_time=0.58915 
Train Epoch: 6 [122/250 15616/32000 (49%)] Loss: 2.07376 (QuantReg: 15.09650) QuantErr: 15.09650 batch_time=0.60677 
Train Epoch: 6 [133/250 17024/32000 (53%)] Loss: 2.08730 (QuantReg: 14.69294) QuantErr: 14.69294 batch_time=0.59831 
Train Epoch: 6 [144/250 18432/32000 (58%)] Loss: 2.26188 (QuantReg: 14.77342) QuantErr: 14.77342 batch_time=0.62738 
Train Epoch: 6 [155/250 19840/32000 (62%)] Loss: 1.70668 (QuantReg: 15.04004) QuantErr: 15.04004 batch_time=3.52286 
Train Epoch: 6 [166/250 21248/32000 (66%)] Loss: 1.92299 (QuantReg: 14.93961) QuantErr: 14.93961 batch_time=0.63423 
Train Epoch: 6 [177/250 22656/32000 (71%)] Loss: 2.27786 (QuantReg: 15.01934) QuantErr: 15.01934 batch_time=0.60102 
Train Epoch: 6 [188/250 24064/32000 (75%)] Loss: 1.97466 (QuantReg: 15.28391) QuantErr: 15.28391 batch_time=0.58490 
Train Epoch: 6 [199/250 25472/32000 (80%)] Loss: 2.14579 (QuantReg: 14.96497) QuantErr: 14.96497 batch_time=0.60467 
Train Epoch: 6 [210/250 26880/32000 (84%)] Loss: 1.93967 (QuantReg: 14.82831) QuantErr: 14.82831 batch_time=1.98405 
Train Epoch: 6 [221/250 28288/32000 (88%)] Loss: 1.89309 (QuantReg: 15.22901) QuantErr: 15.22901 batch_time=0.59670 
Train Epoch: 6 [232/250 29696/32000 (93%)] Loss: 2.12433 (QuantReg: 15.00047) QuantErr: 15.00047 batch_time=0.60458 
Train Epoch: 6 [243/250 31104/32000 (97%)] Loss: 2.12651 (QuantReg: 15.03514) QuantErr: 15.03514 batch_time=0.60305 
Train Epoch: 6 codebook_update_time=3.34960
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch6.pth ...
Done in 11.788s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch6.pth ...
Done in 15.927s
removing stale ckpt [epoch 5] [took 1.04s]
 epoch          : 6
 loss           : 2.1486281337738036
 quant_reg      : 14.839117599487304
 quant_err      : 14.839117599487304
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.313883299798793
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.70483725707078
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.655935613682092
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.3680337711892
 MSRVTT_full_test/t2v_metrics/R1: 12.675585284280936
 MSRVTT_full_test/t2v_metrics/R5: 35.25083612040134
 MSRVTT_full_test/t2v_metrics/R10: 48.52842809364549
 MSRVTT_full_test/t2v_metrics/R50: 80.03344481605352
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.1247491638796
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.885464905880784
 MSRVTT_full_test/v2t_metrics/R1: 16.02006688963211
 MSRVTT_full_test/v2t_metrics/R5: 42.575250836120404
 MSRVTT_full_test/v2t_metrics/R10: 57.424749163879596
 MSRVTT_full_test/v2t_metrics/R50: 85.11705685618729
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.476923076923075
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.96045881794106
 mnt_best       : 27.885464905880784
 not_improved_count: 0
Train Epoch: 7 [1/250 128/32000 (0%)] Loss: 2.15980 (QuantReg: 14.22302) QuantErr: 14.22302 batch_time=34.63313 
Train Epoch: 7 [12/250 1536/32000 (5%)] Loss: 1.80483 (QuantReg: 14.82961) QuantErr: 14.82961 batch_time=0.58888 
Train Epoch: 7 [23/250 2944/32000 (9%)] Loss: 2.28090 (QuantReg: 14.84699) QuantErr: 14.84699 batch_time=0.58076 
Train Epoch: 7 [34/250 4352/32000 (14%)] Loss: 2.06873 (QuantReg: 14.94256) QuantErr: 14.94256 batch_time=0.61080 
Train Epoch: 7 [45/250 5760/32000 (18%)] Loss: 1.85399 (QuantReg: 14.65824) QuantErr: 14.65824 batch_time=0.58280 
Train Epoch: 7 [56/250 7168/32000 (22%)] Loss: 2.11536 (QuantReg: 14.58759) QuantErr: 14.58759 batch_time=0.60257 
Train Epoch: 7 [67/250 8576/32000 (27%)] Loss: 2.09607 (QuantReg: 14.96019) QuantErr: 14.96019 batch_time=0.58848 
Train Epoch: 7 [78/250 9984/32000 (31%)] Loss: 2.20799 (QuantReg: 14.80360) QuantErr: 14.80360 batch_time=0.61404 
Train Epoch: 7 [89/250 11392/32000 (36%)] Loss: 2.22569 (QuantReg: 14.77804) QuantErr: 14.77804 batch_time=0.60201 
Train Epoch: 7 [100/250 12800/32000 (40%)] Loss: 1.99995 (QuantReg: 14.79376) QuantErr: 14.79376 batch_time=0.64555 
Train Epoch: 7 [111/250 14208/32000 (44%)] Loss: 2.28994 (QuantReg: 14.84123) QuantErr: 14.84123 batch_time=0.64558 
Train Epoch: 7 [122/250 15616/32000 (49%)] Loss: 1.60302 (QuantReg: 15.09911) QuantErr: 15.09911 batch_time=0.63904 
Train Epoch: 7 [133/250 17024/32000 (53%)] Loss: 1.76118 (QuantReg: 14.83868) QuantErr: 14.83868 batch_time=0.63870 
Train Epoch: 7 [144/250 18432/32000 (58%)] Loss: 2.16697 (QuantReg: 14.76243) QuantErr: 14.76243 batch_time=0.76438 
Train Epoch: 7 [155/250 19840/32000 (62%)] Loss: 2.04544 (QuantReg: 14.65879) QuantErr: 14.65879 batch_time=0.67398 
Train Epoch: 7 [166/250 21248/32000 (66%)] Loss: 1.71686 (QuantReg: 15.07928) QuantErr: 15.07928 batch_time=0.60762 
Train Epoch: 7 [177/250 22656/32000 (71%)] Loss: 1.58723 (QuantReg: 15.14732) QuantErr: 15.14732 batch_time=0.60805 
Train Epoch: 7 [188/250 24064/32000 (75%)] Loss: 2.06696 (QuantReg: 14.88246) QuantErr: 14.88246 batch_time=0.60161 
Train Epoch: 7 [199/250 25472/32000 (80%)] Loss: 1.51408 (QuantReg: 15.05488) QuantErr: 15.05488 batch_time=0.60285 
Train Epoch: 7 [210/250 26880/32000 (84%)] Loss: 1.77925 (QuantReg: 15.23532) QuantErr: 15.23532 batch_time=0.59861 
Train Epoch: 7 [221/250 28288/32000 (88%)] Loss: 2.42308 (QuantReg: 14.94334) QuantErr: 14.94334 batch_time=0.60538 
Train Epoch: 7 [232/250 29696/32000 (93%)] Loss: 1.92202 (QuantReg: 15.01513) QuantErr: 15.01513 batch_time=0.59967 
Train Epoch: 7 [243/250 31104/32000 (97%)] Loss: 2.15829 (QuantReg: 15.10649) QuantErr: 15.10649 batch_time=0.60005 
Train Epoch: 7 codebook_update_time=3.29158
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch7.pth ...
Done in 4.921s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch7.pth ...
Done in 8.753s
removing stale ckpt [epoch 6] [took 0.16s]
 epoch          : 7
 loss           : 1.9851738071441651
 quant_reg      : 14.913331508636475
 quant_err      : 14.913331508636475
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 1750
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.476861167002012
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.90149564971023
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 89.33601609657947
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.354124748490945
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.08883407936669
 MSRVTT_full_test/t2v_metrics/R1: 13.7123745819398
 MSRVTT_full_test/t2v_metrics/R5: 35.986622073578594
 MSRVTT_full_test/t2v_metrics/R10: 49.79933110367893
 MSRVTT_full_test/t2v_metrics/R50: 81.23745819397993
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 39.94581939799331
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.07317217714021
 MSRVTT_full_test/v2t_metrics/R1: 15.819397993311037
 MSRVTT_full_test/v2t_metrics/R5: 44.51505016722408
 MSRVTT_full_test/v2t_metrics/R10: 57.85953177257525
 MSRVTT_full_test/v2t_metrics/R50: 86.08695652173913
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.504347826086956
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.41046790761742
 mnt_best       : 29.07317217714021
 not_improved_count: 0
Train Epoch: 8 [1/250 128/32000 (0%)] Loss: 1.93568 (QuantReg: 14.78811) QuantErr: 14.78811 batch_time=28.28370 
Train Epoch: 8 [12/250 1536/32000 (5%)] Loss: 2.18475 (QuantReg: 14.74728) QuantErr: 14.74728 batch_time=0.58921 
Train Epoch: 8 [23/250 2944/32000 (9%)] Loss: 2.41754 (QuantReg: 14.54165) QuantErr: 14.54165 batch_time=0.60117 
Train Epoch: 8 [34/250 4352/32000 (14%)] Loss: 1.84173 (QuantReg: 14.83693) QuantErr: 14.83693 batch_time=0.59336 
Train Epoch: 8 [45/250 5760/32000 (18%)] Loss: 2.05190 (QuantReg: 14.70982) QuantErr: 14.70982 batch_time=0.59967 
Train Epoch: 8 [56/250 7168/32000 (22%)] Loss: 1.99738 (QuantReg: 14.63113) QuantErr: 14.63113 batch_time=0.60282 
Train Epoch: 8 [67/250 8576/32000 (27%)] Loss: 1.79673 (QuantReg: 15.00523) QuantErr: 15.00523 batch_time=0.69516 
Train Epoch: 8 [78/250 9984/32000 (31%)] Loss: 1.65327 (QuantReg: 15.04038) QuantErr: 15.04038 batch_time=0.58427 
Train Epoch: 8 [89/250 11392/32000 (36%)] Loss: 2.10137 (QuantReg: 14.91953) QuantErr: 14.91953 batch_time=0.59593 
Train Epoch: 8 [100/250 12800/32000 (40%)] Loss: 1.85857 (QuantReg: 14.84324) QuantErr: 14.84324 batch_time=0.58515 
Train Epoch: 8 [111/250 14208/32000 (44%)] Loss: 1.72643 (QuantReg: 15.02591) QuantErr: 15.02591 batch_time=0.58397 
Train Epoch: 8 [122/250 15616/32000 (49%)] Loss: 2.48995 (QuantReg: 14.90913) QuantErr: 14.90913 batch_time=0.58518 
Train Epoch: 8 [133/250 17024/32000 (53%)] Loss: 1.69990 (QuantReg: 14.91588) QuantErr: 14.91588 batch_time=1.00234 
Train Epoch: 8 [144/250 18432/32000 (58%)] Loss: 1.63718 (QuantReg: 15.04898) QuantErr: 15.04898 batch_time=0.59166 
Train Epoch: 8 [155/250 19840/32000 (62%)] Loss: 2.33139 (QuantReg: 14.99419) QuantErr: 14.99419 batch_time=0.60598 
Train Epoch: 8 [166/250 21248/32000 (66%)] Loss: 1.64939 (QuantReg: 14.92306) QuantErr: 14.92306 batch_time=0.59522 
Train Epoch: 8 [177/250 22656/32000 (71%)] Loss: 2.14704 (QuantReg: 15.01029) QuantErr: 15.01029 batch_time=0.59872 
Train Epoch: 8 [188/250 24064/32000 (75%)] Loss: 2.06874 (QuantReg: 15.13957) QuantErr: 15.13957 batch_time=0.65288 
Train Epoch: 8 [199/250 25472/32000 (80%)] Loss: 1.49847 (QuantReg: 15.13208) QuantErr: 15.13208 batch_time=2.42600 
Train Epoch: 8 [210/250 26880/32000 (84%)] Loss: 1.35226 (QuantReg: 15.06992) QuantErr: 15.06992 batch_time=2.60974 
Train Epoch: 8 [221/250 28288/32000 (88%)] Loss: 1.45233 (QuantReg: 15.23576) QuantErr: 15.23576 batch_time=0.62704 
Train Epoch: 8 [232/250 29696/32000 (93%)] Loss: 1.11281 (QuantReg: 14.97675) QuantErr: 14.97675 batch_time=0.59568 
Train Epoch: 8 [243/250 31104/32000 (97%)] Loss: 1.44110 (QuantReg: 15.15862) QuantErr: 15.15862 batch_time=0.58819 
Train Epoch: 8 codebook_update_time=3.19866
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch8.pth ...
Done in 5.445s
removing stale ckpt [epoch 7] [took 0.00s]
 epoch          : 8
 loss           : 1.8834106917381286
 quant_reg      : 14.90578693008423
 quant_err      : 14.90578693008423
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.58148893360161
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.77400780426852
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.659959758551308
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.88029669345725
 MSRVTT_full_test/t2v_metrics/R1: 13.210702341137123
 MSRVTT_full_test/t2v_metrics/R5: 36.020066889632105
 MSRVTT_full_test/t2v_metrics/R10: 49.197324414715716
 MSRVTT_full_test/t2v_metrics/R50: 79.79933110367892
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.68394648829432
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.60688931115262
 MSRVTT_full_test/v2t_metrics/R1: 15.953177257525084
 MSRVTT_full_test/v2t_metrics/R5: 44.64882943143812
 MSRVTT_full_test/v2t_metrics/R10: 58.59531772575251
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 28.266220735785954
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.68753142121373
 mnt_best       : 29.07317217714021
 not_improved_count: 1
Train Epoch: 9 [1/250 128/32000 (0%)] Loss: 2.05570 (QuantReg: 14.66310) QuantErr: 14.66310 batch_time=33.87898 
Train Epoch: 9 [12/250 1536/32000 (5%)] Loss: 1.67796 (QuantReg: 14.55721) QuantErr: 14.55721 batch_time=0.62803 
Train Epoch: 9 [23/250 2944/32000 (9%)] Loss: 2.20565 (QuantReg: 14.89284) QuantErr: 14.89284 batch_time=0.59222 
Train Epoch: 9 [34/250 4352/32000 (14%)] Loss: 2.06519 (QuantReg: 14.75515) QuantErr: 14.75515 batch_time=0.93362 
Train Epoch: 9 [45/250 5760/32000 (18%)] Loss: 2.17123 (QuantReg: 14.65852) QuantErr: 14.65852 batch_time=0.59410 
Train Epoch: 9 [56/250 7168/32000 (22%)] Loss: 2.02926 (QuantReg: 14.77864) QuantErr: 14.77864 batch_time=0.59821 
Train Epoch: 9 [67/250 8576/32000 (27%)] Loss: 1.77209 (QuantReg: 14.87567) QuantErr: 14.87567 batch_time=0.61603 
Train Epoch: 9 [78/250 9984/32000 (31%)] Loss: 1.43492 (QuantReg: 14.87451) QuantErr: 14.87451 batch_time=0.59023 
Train Epoch: 9 [89/250 11392/32000 (36%)] Loss: 2.00982 (QuantReg: 14.84590) QuantErr: 14.84590 batch_time=0.60517 
Train Epoch: 9 [100/250 12800/32000 (40%)] Loss: 1.75498 (QuantReg: 14.95747) QuantErr: 14.95747 batch_time=0.62970 
Train Epoch: 9 [111/250 14208/32000 (44%)] Loss: 1.79285 (QuantReg: 14.93070) QuantErr: 14.93070 batch_time=0.59834 
Train Epoch: 9 [122/250 15616/32000 (49%)] Loss: 1.65967 (QuantReg: 15.05693) QuantErr: 15.05693 batch_time=0.61931 
Train Epoch: 9 [133/250 17024/32000 (53%)] Loss: 1.80542 (QuantReg: 14.99379) QuantErr: 14.99379 batch_time=0.58938 
Train Epoch: 9 [144/250 18432/32000 (58%)] Loss: 1.89221 (QuantReg: 15.16433) QuantErr: 15.16433 batch_time=1.69127 
Train Epoch: 9 [155/250 19840/32000 (62%)] Loss: 1.86998 (QuantReg: 15.07862) QuantErr: 15.07862 batch_time=0.61161 
Train Epoch: 9 [166/250 21248/32000 (66%)] Loss: 1.91334 (QuantReg: 14.88633) QuantErr: 14.88633 batch_time=0.61288 
Train Epoch: 9 [177/250 22656/32000 (71%)] Loss: 1.30760 (QuantReg: 15.08015) QuantErr: 15.08015 batch_time=0.60810 
Train Epoch: 9 [188/250 24064/32000 (75%)] Loss: 1.46782 (QuantReg: 15.24715) QuantErr: 15.24715 batch_time=0.60449 
Train Epoch: 9 [199/250 25472/32000 (80%)] Loss: 1.53571 (QuantReg: 15.21202) QuantErr: 15.21202 batch_time=0.58719 
Train Epoch: 9 [210/250 26880/32000 (84%)] Loss: 1.52154 (QuantReg: 14.97859) QuantErr: 14.97859 batch_time=0.73763 
Train Epoch: 9 [221/250 28288/32000 (88%)] Loss: 1.65598 (QuantReg: 15.23914) QuantErr: 15.23914 batch_time=0.58397 
Train Epoch: 9 [232/250 29696/32000 (93%)] Loss: 1.77604 (QuantReg: 15.22729) QuantErr: 15.22729 batch_time=0.59337 
Train Epoch: 9 [243/250 31104/32000 (97%)] Loss: 1.16136 (QuantReg: 15.19561) QuantErr: 15.19561 batch_time=0.58978 
Train Epoch: 9 codebook_update_time=3.24177
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch9.pth ...
Done in 5.066s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch9.pth ...
Done in 8.797s
removing stale ckpt [epoch 8] [took 0.00s]
 epoch          : 9
 loss           : 1.7521605019569397
 quant_reg      : 14.978067325592042
 quant_err      : 14.978067325592042
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 2250
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.563380281690141
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.34322678355373
 MSRVTT_full_val/v2t_metrics/R1: 43.25955734406438
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.782696177062374
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.69777152403623
 MSRVTT_full_test/t2v_metrics/R1: 14.448160535117056
 MSRVTT_full_test/t2v_metrics/R5: 38.62876254180602
 MSRVTT_full_test/t2v_metrics/R10: 51.73913043478261
 MSRVTT_full_test/t2v_metrics/R50: 81.63879598662207
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 38.917056856187294
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.679444605866454
 MSRVTT_full_test/v2t_metrics/R1: 18.02675585284281
 MSRVTT_full_test/v2t_metrics/R5: 45.68561872909699
 MSRVTT_full_test/v2t_metrics/R10: 59.096989966555185
 MSRVTT_full_test/v2t_metrics/R50: 87.22408026755853
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.085284280936456
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.510755219191644
 mnt_best       : 30.679444605866454
 not_improved_count: 0
Train Epoch: 10 [1/250 128/32000 (0%)] Loss: 1.44615 (QuantReg: 14.69489) QuantErr: 14.69489 batch_time=30.98184 
Train Epoch: 10 [12/250 1536/32000 (5%)] Loss: 1.59076 (QuantReg: 14.85128) QuantErr: 14.85128 batch_time=0.59080 
Train Epoch: 10 [23/250 2944/32000 (9%)] Loss: 1.44127 (QuantReg: 14.82528) QuantErr: 14.82528 batch_time=0.67140 
Train Epoch: 10 [34/250 4352/32000 (14%)] Loss: 1.35395 (QuantReg: 14.57940) QuantErr: 14.57940 batch_time=0.59617 
Train Epoch: 10 [45/250 5760/32000 (18%)] Loss: 1.63174 (QuantReg: 15.15854) QuantErr: 15.15854 batch_time=0.59293 
Train Epoch: 10 [56/250 7168/32000 (22%)] Loss: 2.24010 (QuantReg: 14.87066) QuantErr: 14.87066 batch_time=0.60249 
Train Epoch: 10 [67/250 8576/32000 (27%)] Loss: 1.39410 (QuantReg: 14.99360) QuantErr: 14.99360 batch_time=0.68284 
Train Epoch: 10 [78/250 9984/32000 (31%)] Loss: 1.59571 (QuantReg: 14.82956) QuantErr: 14.82956 batch_time=0.59094 
Train Epoch: 10 [89/250 11392/32000 (36%)] Loss: 1.72724 (QuantReg: 14.94964) QuantErr: 14.94964 batch_time=0.60749 
Train Epoch: 10 [100/250 12800/32000 (40%)] Loss: 2.17026 (QuantReg: 14.63113) QuantErr: 14.63113 batch_time=0.59211 
Train Epoch: 10 [111/250 14208/32000 (44%)] Loss: 1.49203 (QuantReg: 15.06522) QuantErr: 15.06522 batch_time=0.60253 
Train Epoch: 10 [122/250 15616/32000 (49%)] Loss: 1.91049 (QuantReg: 15.09598) QuantErr: 15.09598 batch_time=0.82246 
Train Epoch: 10 [133/250 17024/32000 (53%)] Loss: 2.02189 (QuantReg: 15.01568) QuantErr: 15.01568 batch_time=0.59695 
Train Epoch: 10 [144/250 18432/32000 (58%)] Loss: 2.12710 (QuantReg: 15.05322) QuantErr: 15.05322 batch_time=0.84771 
Train Epoch: 10 [155/250 19840/32000 (62%)] Loss: 1.36936 (QuantReg: 15.25391) QuantErr: 15.25391 batch_time=0.58195 
Train Epoch: 10 [166/250 21248/32000 (66%)] Loss: 1.30833 (QuantReg: 15.16306) QuantErr: 15.16306 batch_time=0.61326 
Train Epoch: 10 [177/250 22656/32000 (71%)] Loss: 2.56979 (QuantReg: 14.81009) QuantErr: 14.81009 batch_time=0.59518 
Train Epoch: 10 [188/250 24064/32000 (75%)] Loss: 1.47491 (QuantReg: 15.28393) QuantErr: 15.28393 batch_time=0.61037 
Train Epoch: 10 [199/250 25472/32000 (80%)] Loss: 1.38671 (QuantReg: 15.28031) QuantErr: 15.28031 batch_time=0.66890 
Train Epoch: 10 [210/250 26880/32000 (84%)] Loss: 1.55428 (QuantReg: 15.07630) QuantErr: 15.07630 batch_time=0.60535 
Train Epoch: 10 [221/250 28288/32000 (88%)] Loss: 1.48919 (QuantReg: 15.05504) QuantErr: 15.05504 batch_time=0.61716 
Train Epoch: 10 [232/250 29696/32000 (93%)] Loss: 2.15830 (QuantReg: 14.88203) QuantErr: 14.88203 batch_time=0.60301 
Train Epoch: 10 [243/250 31104/32000 (97%)] Loss: 1.93818 (QuantReg: 14.87529) QuantErr: 14.87529 batch_time=0.59273 
Train Epoch: 10 codebook_update_time=3.48648
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch10.pth ...
Done in 4.693s
removing stale ckpt [epoch 9] [took 0.00s]
 epoch          : 10
 loss           : 1.6554821891784668
 quant_reg      : 14.98584457397461
 quant_err      : 14.98584457397461
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 72.63581488933602
 MSRVTT_full_val/t2v_metrics/R10: 83.90342052313883
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.2716297786720325
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.43411944352593
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 78.67203219315896
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.448692152917505
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.62530152878021
 MSRVTT_full_test/t2v_metrics/R1: 13.946488294314381
 MSRVTT_full_test/t2v_metrics/R5: 37.89297658862876
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 81.97324414715719
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 39.03779264214047
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.92383148654793
 MSRVTT_full_test/v2t_metrics/R1: 17.45819397993311
 MSRVTT_full_test/v2t_metrics/R5: 44.91638795986622
 MSRVTT_full_test/v2t_metrics/R10: 60.43478260869565
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.489297658862878
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.18792662670533
 mnt_best       : 30.679444605866454
 not_improved_count: 1
Train Epoch: 11 [1/250 128/32000 (0%)] Loss: 1.47206 (QuantReg: 14.83887) QuantErr: 14.83887 batch_time=30.09034 
Train Epoch: 11 [12/250 1536/32000 (5%)] Loss: 1.38982 (QuantReg: 14.85051) QuantErr: 14.85051 batch_time=0.58415 
Train Epoch: 11 [23/250 2944/32000 (9%)] Loss: 1.60800 (QuantReg: 14.84577) QuantErr: 14.84577 batch_time=1.44107 
Train Epoch: 11 [34/250 4352/32000 (14%)] Loss: 1.67050 (QuantReg: 14.96682) QuantErr: 14.96682 batch_time=0.60028 
Train Epoch: 11 [45/250 5760/32000 (18%)] Loss: 1.78765 (QuantReg: 15.19716) QuantErr: 15.19716 batch_time=0.60179 
Train Epoch: 11 [56/250 7168/32000 (22%)] Loss: 1.44582 (QuantReg: 15.07976) QuantErr: 15.07976 batch_time=0.58877 
Train Epoch: 11 [67/250 8576/32000 (27%)] Loss: 1.81244 (QuantReg: 14.93754) QuantErr: 14.93754 batch_time=0.59486 
Train Epoch: 11 [78/250 9984/32000 (31%)] Loss: 1.45717 (QuantReg: 15.21458) QuantErr: 15.21458 batch_time=0.59655 
Train Epoch: 11 [89/250 11392/32000 (36%)] Loss: 1.53133 (QuantReg: 14.81812) QuantErr: 14.81812 batch_time=0.59223 
Train Epoch: 11 [100/250 12800/32000 (40%)] Loss: 1.84066 (QuantReg: 15.00951) QuantErr: 15.00951 batch_time=0.57739 
Train Epoch: 11 [111/250 14208/32000 (44%)] Loss: 1.86489 (QuantReg: 14.92870) QuantErr: 14.92870 batch_time=0.59557 
Train Epoch: 11 [122/250 15616/32000 (49%)] Loss: 1.56832 (QuantReg: 15.33211) QuantErr: 15.33211 batch_time=0.59442 
Train Epoch: 11 [133/250 17024/32000 (53%)] Loss: 2.09322 (QuantReg: 14.89225) QuantErr: 14.89225 batch_time=0.60412 
Train Epoch: 11 [144/250 18432/32000 (58%)] Loss: 1.80211 (QuantReg: 14.88733) QuantErr: 14.88733 batch_time=2.03016 
Train Epoch: 11 [155/250 19840/32000 (62%)] Loss: 1.60666 (QuantReg: 14.95863) QuantErr: 14.95863 batch_time=0.59904 
Train Epoch: 11 [166/250 21248/32000 (66%)] Loss: 1.59120 (QuantReg: 14.92749) QuantErr: 14.92749 batch_time=0.59434 
Train Epoch: 11 [177/250 22656/32000 (71%)] Loss: 1.55375 (QuantReg: 14.91104) QuantErr: 14.91104 batch_time=0.58860 
Train Epoch: 11 [188/250 24064/32000 (75%)] Loss: 1.28351 (QuantReg: 15.00454) QuantErr: 15.00454 batch_time=0.77948 
Train Epoch: 11 [199/250 25472/32000 (80%)] Loss: 1.40028 (QuantReg: 15.25593) QuantErr: 15.25593 batch_time=0.59331 
Train Epoch: 11 [210/250 26880/32000 (84%)] Loss: 1.59002 (QuantReg: 15.11599) QuantErr: 15.11599 batch_time=0.60482 
Train Epoch: 11 [221/250 28288/32000 (88%)] Loss: 1.73282 (QuantReg: 15.27256) QuantErr: 15.27256 batch_time=0.61975 
Train Epoch: 11 [232/250 29696/32000 (93%)] Loss: 1.33043 (QuantReg: 15.21089) QuantErr: 15.21089 batch_time=0.60912 
Train Epoch: 11 [243/250 31104/32000 (97%)] Loss: 1.18848 (QuantReg: 15.44115) QuantErr: 15.44115 batch_time=1.20195 
Train Epoch: 11 codebook_update_time=3.25222
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch11.pth ...
Done in 15.602s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 1.5636049489974975
 quant_reg      : 15.061582023620605
 quant_err      : 15.061582023620605
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 2750
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.150905432595573
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.7270581442563
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.843058350100604
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.88915983379755
 MSRVTT_full_test/t2v_metrics/R1: 13.411371237458194
 MSRVTT_full_test/t2v_metrics/R5: 36.8561872909699
 MSRVTT_full_test/t2v_metrics/R10: 50.16722408026756
 MSRVTT_full_test/t2v_metrics/R50: 81.1371237458194
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.7
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.160919929875316
 MSRVTT_full_test/v2t_metrics/R1: 17.224080267558527
 MSRVTT_full_test/v2t_metrics/R5: 45.585284280936456
 MSRVTT_full_test/v2t_metrics/R10: 60.53511705685619
 MSRVTT_full_test/v2t_metrics/R50: 88.46153846153847
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.422073578595317
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.22341278580377
 mnt_best       : 30.679444605866454
 not_improved_count: 2
Train Epoch: 12 [1/250 128/32000 (0%)] Loss: 1.50070 (QuantReg: 14.88648) QuantErr: 14.88648 batch_time=29.55973 
Train Epoch: 12 [12/250 1536/32000 (5%)] Loss: 1.70349 (QuantReg: 14.95365) QuantErr: 14.95365 batch_time=0.58923 
Train Epoch: 12 [23/250 2944/32000 (9%)] Loss: 1.32250 (QuantReg: 14.84921) QuantErr: 14.84921 batch_time=0.79045 
Train Epoch: 12 [34/250 4352/32000 (14%)] Loss: 1.37496 (QuantReg: 15.01220) QuantErr: 15.01220 batch_time=0.59523 
Train Epoch: 12 [45/250 5760/32000 (18%)] Loss: 1.19241 (QuantReg: 15.21419) QuantErr: 15.21419 batch_time=0.59727 
Train Epoch: 12 [56/250 7168/32000 (22%)] Loss: 1.48967 (QuantReg: 14.99223) QuantErr: 14.99223 batch_time=0.59485 
Train Epoch: 12 [67/250 8576/32000 (27%)] Loss: 1.25521 (QuantReg: 15.14949) QuantErr: 15.14949 batch_time=0.58695 
Train Epoch: 12 [78/250 9984/32000 (31%)] Loss: 1.45923 (QuantReg: 14.99283) QuantErr: 14.99283 batch_time=0.59177 
Train Epoch: 12 [89/250 11392/32000 (36%)] Loss: 1.33833 (QuantReg: 14.93348) QuantErr: 14.93348 batch_time=0.59071 
Train Epoch: 12 [100/250 12800/32000 (40%)] Loss: 1.65993 (QuantReg: 14.98050) QuantErr: 14.98050 batch_time=0.60375 
Train Epoch: 12 [111/250 14208/32000 (44%)] Loss: 1.22424 (QuantReg: 15.00231) QuantErr: 15.00231 batch_time=0.59247 
Train Epoch: 12 [122/250 15616/32000 (49%)] Loss: 1.59499 (QuantReg: 14.96282) QuantErr: 14.96282 batch_time=0.60103 
Train Epoch: 12 [133/250 17024/32000 (53%)] Loss: 1.29363 (QuantReg: 15.08128) QuantErr: 15.08128 batch_time=1.54023 
Train Epoch: 12 [144/250 18432/32000 (58%)] Loss: 1.23189 (QuantReg: 15.49268) QuantErr: 15.49268 batch_time=0.59819 
Train Epoch: 12 [155/250 19840/32000 (62%)] Loss: 1.64027 (QuantReg: 14.95790) QuantErr: 14.95790 batch_time=0.59244 
Train Epoch: 12 [166/250 21248/32000 (66%)] Loss: 1.09033 (QuantReg: 15.18823) QuantErr: 15.18823 batch_time=0.57926 
Train Epoch: 12 [177/250 22656/32000 (71%)] Loss: 1.20988 (QuantReg: 15.20975) QuantErr: 15.20975 batch_time=0.69586 
Train Epoch: 12 [188/250 24064/32000 (75%)] Loss: 1.85156 (QuantReg: 14.97162) QuantErr: 14.97162 batch_time=0.63477 
Train Epoch: 12 [199/250 25472/32000 (80%)] Loss: 1.52513 (QuantReg: 14.98967) QuantErr: 14.98967 batch_time=0.58839 
Train Epoch: 12 [210/250 26880/32000 (84%)] Loss: 1.83758 (QuantReg: 15.00292) QuantErr: 15.00292 batch_time=0.59897 
Train Epoch: 12 [221/250 28288/32000 (88%)] Loss: 1.49122 (QuantReg: 14.93729) QuantErr: 14.93729 batch_time=0.60855 
Train Epoch: 12 [232/250 29696/32000 (93%)] Loss: 1.50357 (QuantReg: 15.18191) QuantErr: 15.18191 batch_time=1.65485 
Train Epoch: 12 [243/250 31104/32000 (97%)] Loss: 1.58391 (QuantReg: 15.24162) QuantErr: 15.24162 batch_time=0.58914 
Train Epoch: 12 codebook_update_time=3.53405
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch12.pth ...
Done in 5.255s
removing stale ckpt [epoch 11] [took 0.00s]
 epoch          : 12
 loss           : 1.4879341719150543
 quant_reg      : 15.066435317993164
 quant_err      : 15.066435317993164
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 37.02213279678068
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.098591549295775
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.604294674161956
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.3762575452716295
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.60009874668222
 MSRVTT_full_test/t2v_metrics/R1: 14.180602006688963
 MSRVTT_full_test/t2v_metrics/R5: 38.66220735785953
 MSRVTT_full_test/t2v_metrics/R10: 52.17391304347826
 MSRVTT_full_test/t2v_metrics/R50: 81.90635451505017
 MSRVTT_full_test/t2v_metrics/MedR: 9.5
 MSRVTT_full_test/t2v_metrics/MeanR: 38.09581939799331
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.582870190162186
 MSRVTT_full_test/v2t_metrics/R1: 18.02675585284281
 MSRVTT_full_test/v2t_metrics/R5: 46.32107023411371
 MSRVTT_full_test/v2t_metrics/R10: 61.070234113712374
 MSRVTT_full_test/v2t_metrics/R50: 88.16053511705685
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 25.58494983277592
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.08303311234069
 mnt_best       : 30.679444605866454
 not_improved_count: 3
Train Epoch: 13 [1/250 128/32000 (0%)] Loss: 1.31951 (QuantReg: 14.97837) QuantErr: 14.97837 batch_time=32.42217 
Train Epoch: 13 [12/250 1536/32000 (5%)] Loss: 2.00691 (QuantReg: 14.76697) QuantErr: 14.76697 batch_time=0.60042 
Train Epoch: 13 [23/250 2944/32000 (9%)] Loss: 1.49970 (QuantReg: 15.11268) QuantErr: 15.11268 batch_time=0.60155 
Train Epoch: 13 [34/250 4352/32000 (14%)] Loss: 1.25393 (QuantReg: 15.08242) QuantErr: 15.08242 batch_time=0.61955 
Train Epoch: 13 [45/250 5760/32000 (18%)] Loss: 1.36427 (QuantReg: 15.09823) QuantErr: 15.09823 batch_time=0.62593 
Train Epoch: 13 [56/250 7168/32000 (22%)] Loss: 1.43643 (QuantReg: 15.31944) QuantErr: 15.31944 batch_time=0.63078 
Train Epoch: 13 [67/250 8576/32000 (27%)] Loss: 1.41460 (QuantReg: 15.23104) QuantErr: 15.23104 batch_time=0.58416 
Train Epoch: 13 [78/250 9984/32000 (31%)] Loss: 1.79692 (QuantReg: 15.18834) QuantErr: 15.18834 batch_time=0.60022 
Train Epoch: 13 [89/250 11392/32000 (36%)] Loss: 1.15727 (QuantReg: 14.99453) QuantErr: 14.99453 batch_time=0.59994 
Train Epoch: 13 [100/250 12800/32000 (40%)] Loss: 1.63860 (QuantReg: 15.08789) QuantErr: 15.08789 batch_time=0.60474 
Train Epoch: 13 [111/250 14208/32000 (44%)] Loss: 1.52055 (QuantReg: 14.98742) QuantErr: 14.98742 batch_time=0.61323 
Train Epoch: 13 [122/250 15616/32000 (49%)] Loss: 1.03780 (QuantReg: 15.28675) QuantErr: 15.28675 batch_time=0.63314 
Train Epoch: 13 [133/250 17024/32000 (53%)] Loss: 1.28488 (QuantReg: 15.30424) QuantErr: 15.30424 batch_time=0.92006 
Train Epoch: 13 [144/250 18432/32000 (58%)] Loss: 1.39229 (QuantReg: 15.25673) QuantErr: 15.25673 batch_time=1.35303 
Train Epoch: 13 [155/250 19840/32000 (62%)] Loss: 1.65451 (QuantReg: 14.92945) QuantErr: 14.92945 batch_time=0.59103 
Train Epoch: 13 [166/250 21248/32000 (66%)] Loss: 1.29358 (QuantReg: 15.00253) QuantErr: 15.00253 batch_time=0.59616 
Train Epoch: 13 [177/250 22656/32000 (71%)] Loss: 1.09119 (QuantReg: 15.38520) QuantErr: 15.38520 batch_time=0.58847 
Train Epoch: 13 [188/250 24064/32000 (75%)] Loss: 1.82262 (QuantReg: 15.01490) QuantErr: 15.01490 batch_time=0.60291 
Train Epoch: 13 [199/250 25472/32000 (80%)] Loss: 1.10869 (QuantReg: 15.42174) QuantErr: 15.42174 batch_time=0.60276 
Train Epoch: 13 [210/250 26880/32000 (84%)] Loss: 1.85609 (QuantReg: 15.24324) QuantErr: 15.24324 batch_time=0.58184 
Train Epoch: 13 [221/250 28288/32000 (88%)] Loss: 1.74571 (QuantReg: 15.26279) QuantErr: 15.26279 batch_time=0.58325 
Train Epoch: 13 [232/250 29696/32000 (93%)] Loss: 1.23128 (QuantReg: 15.15437) QuantErr: 15.15437 batch_time=0.59331 
Train Epoch: 13 [243/250 31104/32000 (97%)] Loss: 1.46697 (QuantReg: 15.36857) QuantErr: 15.36857 batch_time=0.60477 
Train Epoch: 13 codebook_update_time=3.36265
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch13.pth ...
Done in 4.242s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch13.pth ...
Done in 8.261s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 1.4168066389560698
 quant_reg      : 15.129783615112304
 quant_err      : 15.129783615112304
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 3250
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 71.42857142857143
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.442655935613682
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.307536819783465
 MSRVTT_full_val/v2t_metrics/R1: 43.66197183098591
 MSRVTT_full_val/v2t_metrics/R5: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.305835010060362
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.59986956219437
 MSRVTT_full_test/t2v_metrics/R1: 14.51505016722408
 MSRVTT_full_test/t2v_metrics/R5: 39.63210702341137
 MSRVTT_full_test/t2v_metrics/R10: 53.67892976588629
 MSRVTT_full_test/t2v_metrics/R50: 82.74247491638796
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 36.36488294314381
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.37303378709888
 MSRVTT_full_test/v2t_metrics/R1: 19.096989966555185
 MSRVTT_full_test/v2t_metrics/R5: 48.09364548494983
 MSRVTT_full_test/v2t_metrics/R10: 61.87290969899666
 MSRVTT_full_test/v2t_metrics/R50: 88.76254180602007
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 24.218060200668898
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.44599034784385
 mnt_best       : 31.37303378709888
 not_improved_count: 0
Train Epoch: 14 [1/250 128/32000 (0%)] Loss: 1.19343 (QuantReg: 15.15117) QuantErr: 15.15117 batch_time=30.98930 
Train Epoch: 14 [12/250 1536/32000 (5%)] Loss: 1.86364 (QuantReg: 15.24765) QuantErr: 15.24765 batch_time=0.83487 
Train Epoch: 14 [23/250 2944/32000 (9%)] Loss: 1.33820 (QuantReg: 15.21631) QuantErr: 15.21631 batch_time=0.60475 
Train Epoch: 14 [34/250 4352/32000 (14%)] Loss: 1.29604 (QuantReg: 14.92479) QuantErr: 14.92479 batch_time=0.60375 
Train Epoch: 14 [45/250 5760/32000 (18%)] Loss: 1.66693 (QuantReg: 15.09009) QuantErr: 15.09009 batch_time=0.59086 
Train Epoch: 14 [56/250 7168/32000 (22%)] Loss: 1.34084 (QuantReg: 15.12473) QuantErr: 15.12473 batch_time=0.57874 
Train Epoch: 14 [67/250 8576/32000 (27%)] Loss: 1.72197 (QuantReg: 15.15766) QuantErr: 15.15766 batch_time=0.82425 
Train Epoch: 14 [78/250 9984/32000 (31%)] Loss: 1.60446 (QuantReg: 14.96226) QuantErr: 14.96226 batch_time=0.59938 
Train Epoch: 14 [89/250 11392/32000 (36%)] Loss: 1.01862 (QuantReg: 14.91827) QuantErr: 14.91827 batch_time=0.61303 
Train Epoch: 14 [100/250 12800/32000 (40%)] Loss: 1.26661 (QuantReg: 14.97479) QuantErr: 14.97479 batch_time=0.59699 
Train Epoch: 14 [111/250 14208/32000 (44%)] Loss: 1.22796 (QuantReg: 15.15955) QuantErr: 15.15955 batch_time=0.59805 
Train Epoch: 14 [122/250 15616/32000 (49%)] Loss: 1.67202 (QuantReg: 14.82919) QuantErr: 14.82919 batch_time=0.59672 
Train Epoch: 14 [133/250 17024/32000 (53%)] Loss: 1.13451 (QuantReg: 15.38679) QuantErr: 15.38679 batch_time=0.58718 
Train Epoch: 14 [144/250 18432/32000 (58%)] Loss: 1.05443 (QuantReg: 15.14956) QuantErr: 15.14956 batch_time=1.12543 
Train Epoch: 14 [155/250 19840/32000 (62%)] Loss: 1.34197 (QuantReg: 15.26363) QuantErr: 15.26363 batch_time=0.58311 
Train Epoch: 14 [166/250 21248/32000 (66%)] Loss: 1.15412 (QuantReg: 15.22618) QuantErr: 15.22618 batch_time=0.59294 
Train Epoch: 14 [177/250 22656/32000 (71%)] Loss: 1.13769 (QuantReg: 15.07460) QuantErr: 15.07460 batch_time=0.81136 
Train Epoch: 14 [188/250 24064/32000 (75%)] Loss: 1.61654 (QuantReg: 15.26482) QuantErr: 15.26482 batch_time=0.59326 
Train Epoch: 14 [199/250 25472/32000 (80%)] Loss: 1.29290 (QuantReg: 15.19787) QuantErr: 15.19787 batch_time=0.58882 
Train Epoch: 14 [210/250 26880/32000 (84%)] Loss: 1.60742 (QuantReg: 14.98136) QuantErr: 14.98136 batch_time=0.59030 
Train Epoch: 14 [221/250 28288/32000 (88%)] Loss: 1.38990 (QuantReg: 15.25173) QuantErr: 15.25173 batch_time=0.67909 
Train Epoch: 14 [232/250 29696/32000 (93%)] Loss: 1.34067 (QuantReg: 15.31333) QuantErr: 15.31333 batch_time=1.33912 
Train Epoch: 14 [243/250 31104/32000 (97%)] Loss: 1.27021 (QuantReg: 15.07195) QuantErr: 15.07195 batch_time=0.58248 
Train Epoch: 14 codebook_update_time=3.22636
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch14.pth ...
Done in 3.837s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 1.3748275306224822
 quant_reg      : 15.13911178970337
 quant_err      : 15.13911178970337
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.277665995975855
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.99965731877895
 MSRVTT_full_val/v2t_metrics/R1: 43.86317907444668
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.808853118712274
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.9281600938147
 MSRVTT_full_test/t2v_metrics/R1: 13.34448160535117
 MSRVTT_full_test/t2v_metrics/R5: 36.88963210702341
 MSRVTT_full_test/t2v_metrics/R10: 50.735785953177256
 MSRVTT_full_test/t2v_metrics/R50: 80.5351170568562
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.54013377926422
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.230762298452383
 MSRVTT_full_test/v2t_metrics/R1: 17.25752508361204
 MSRVTT_full_test/v2t_metrics/R5: 45.953177257525084
 MSRVTT_full_test/v2t_metrics/R10: 60.33444816053512
 MSRVTT_full_test/v2t_metrics/R50: 87.72575250836121
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.729096989966557
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.30388762215901
 mnt_best       : 31.37303378709888
 not_improved_count: 1
Train Epoch: 15 [1/250 128/32000 (0%)] Loss: 1.64667 (QuantReg: 14.83879) QuantErr: 14.83879 batch_time=31.35219 
Train Epoch: 15 [12/250 1536/32000 (5%)] Loss: 1.27724 (QuantReg: 14.97599) QuantErr: 14.97599 batch_time=1.16004 
Train Epoch: 15 [23/250 2944/32000 (9%)] Loss: 1.31123 (QuantReg: 15.14371) QuantErr: 15.14371 batch_time=0.60943 
Train Epoch: 15 [34/250 4352/32000 (14%)] Loss: 1.43952 (QuantReg: 15.08550) QuantErr: 15.08550 batch_time=0.60893 
Train Epoch: 15 [45/250 5760/32000 (18%)] Loss: 1.34781 (QuantReg: 15.25484) QuantErr: 15.25484 batch_time=0.60099 
Train Epoch: 15 [56/250 7168/32000 (22%)] Loss: 1.58484 (QuantReg: 14.94024) QuantErr: 14.94024 batch_time=0.59111 
Train Epoch: 15 [67/250 8576/32000 (27%)] Loss: 1.67394 (QuantReg: 15.10223) QuantErr: 15.10223 batch_time=0.61776 
Train Epoch: 15 [78/250 9984/32000 (31%)] Loss: 1.10224 (QuantReg: 15.19144) QuantErr: 15.19144 batch_time=0.59691 
Train Epoch: 15 [89/250 11392/32000 (36%)] Loss: 1.53658 (QuantReg: 15.17630) QuantErr: 15.17630 batch_time=0.60194 
Train Epoch: 15 [100/250 12800/32000 (40%)] Loss: 1.41538 (QuantReg: 15.17936) QuantErr: 15.17936 batch_time=0.59950 
Train Epoch: 15 [111/250 14208/32000 (44%)] Loss: 1.60174 (QuantReg: 15.14384) QuantErr: 15.14384 batch_time=0.61188 
Train Epoch: 15 [122/250 15616/32000 (49%)] Loss: 1.10138 (QuantReg: 15.10344) QuantErr: 15.10344 batch_time=0.59912 
Train Epoch: 15 [133/250 17024/32000 (53%)] Loss: 1.24023 (QuantReg: 15.24273) QuantErr: 15.24273 batch_time=0.60472 
Train Epoch: 15 [144/250 18432/32000 (58%)] Loss: 1.60774 (QuantReg: 15.10386) QuantErr: 15.10386 batch_time=4.25311 
Train Epoch: 15 [155/250 19840/32000 (62%)] Loss: 1.36119 (QuantReg: 15.01244) QuantErr: 15.01244 batch_time=0.59584 
Train Epoch: 15 [166/250 21248/32000 (66%)] Loss: 1.45619 (QuantReg: 15.22632) QuantErr: 15.22632 batch_time=0.60303 
Train Epoch: 15 [177/250 22656/32000 (71%)] Loss: 1.58082 (QuantReg: 15.39558) QuantErr: 15.39558 batch_time=0.58346 
Train Epoch: 15 [188/250 24064/32000 (75%)] Loss: 1.20106 (QuantReg: 15.29060) QuantErr: 15.29060 batch_time=0.59056 
Train Epoch: 15 [199/250 25472/32000 (80%)] Loss: 1.28191 (QuantReg: 15.25148) QuantErr: 15.25148 batch_time=0.58521 
Train Epoch: 15 [210/250 26880/32000 (84%)] Loss: 1.49836 (QuantReg: 14.94733) QuantErr: 14.94733 batch_time=0.59830 
Train Epoch: 15 [221/250 28288/32000 (88%)] Loss: 1.55880 (QuantReg: 15.26484) QuantErr: 15.26484 batch_time=0.58868 
Train Epoch: 15 [232/250 29696/32000 (93%)] Loss: 1.50709 (QuantReg: 15.12302) QuantErr: 15.12302 batch_time=0.59532 
Train Epoch: 15 [243/250 31104/32000 (97%)] Loss: 1.43622 (QuantReg: 15.02885) QuantErr: 15.02885 batch_time=0.57882 
Train Epoch: 15 codebook_update_time=3.22309
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch15.pth ...
Done in 3.774s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch15.pth ...
Done in 7.382s
removing stale ckpt [epoch 14] [took 0.00s]
 epoch          : 15
 loss           : 1.3137582383155824
 quant_reg      : 15.167015743255615
 quant_err      : 15.167015743255615
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 3750
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.589537223340041
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.79988851340493
 MSRVTT_full_val/v2t_metrics/R1: 44.46680080482897
 MSRVTT_full_val/v2t_metrics/R5: 80.6841046277666
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.877263581488934
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 68.07426678888264
 MSRVTT_full_test/t2v_metrics/R1: 15.016722408026755
 MSRVTT_full_test/t2v_metrics/R5: 40.0
 MSRVTT_full_test/t2v_metrics/R10: 52.675585284280935
 MSRVTT_full_test/t2v_metrics/R50: 82.54180602006689
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.2675585284281
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.628711845665258
 MSRVTT_full_test/v2t_metrics/R1: 19.264214046822744
 MSRVTT_full_test/v2t_metrics/R5: 46.98996655518395
 MSRVTT_full_test/v2t_metrics/R10: 61.47157190635451
 MSRVTT_full_test/v2t_metrics/R50: 88.66220735785953
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.369899665551838
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.177742983429816
 mnt_best       : 31.628711845665258
 not_improved_count: 0
Train Epoch: 16 [1/250 128/32000 (0%)] Loss: 1.24678 (QuantReg: 14.82405) QuantErr: 14.82405 batch_time=29.90381 
Train Epoch: 16 [12/250 1536/32000 (5%)] Loss: 1.21541 (QuantReg: 15.28336) QuantErr: 15.28336 batch_time=0.58410 
Train Epoch: 16 [23/250 2944/32000 (9%)] Loss: 1.45690 (QuantReg: 15.08592) QuantErr: 15.08592 batch_time=0.62361 
Train Epoch: 16 [34/250 4352/32000 (14%)] Loss: 1.18553 (QuantReg: 15.23431) QuantErr: 15.23431 batch_time=0.60075 
Train Epoch: 16 [45/250 5760/32000 (18%)] Loss: 1.20952 (QuantReg: 15.14283) QuantErr: 15.14283 batch_time=0.59806 
Train Epoch: 16 [56/250 7168/32000 (22%)] Loss: 1.39950 (QuantReg: 15.06962) QuantErr: 15.06962 batch_time=0.60100 
Train Epoch: 16 [67/250 8576/32000 (27%)] Loss: 1.40186 (QuantReg: 15.31634) QuantErr: 15.31634 batch_time=0.58940 
Train Epoch: 16 [78/250 9984/32000 (31%)] Loss: 1.25584 (QuantReg: 15.15533) QuantErr: 15.15533 batch_time=0.60243 
Train Epoch: 16 [89/250 11392/32000 (36%)] Loss: 1.17050 (QuantReg: 15.26510) QuantErr: 15.26510 batch_time=0.58305 
Train Epoch: 16 [100/250 12800/32000 (40%)] Loss: 1.01160 (QuantReg: 15.21605) QuantErr: 15.21605 batch_time=0.58737 
Train Epoch: 16 [111/250 14208/32000 (44%)] Loss: 1.39608 (QuantReg: 15.42529) QuantErr: 15.42529 batch_time=0.59188 
Train Epoch: 16 [122/250 15616/32000 (49%)] Loss: 1.30822 (QuantReg: 15.26449) QuantErr: 15.26449 batch_time=0.58807 
Train Epoch: 16 [133/250 17024/32000 (53%)] Loss: 1.36537 (QuantReg: 15.18488) QuantErr: 15.18488 batch_time=0.59302 
Train Epoch: 16 [144/250 18432/32000 (58%)] Loss: 1.14606 (QuantReg: 15.24547) QuantErr: 15.24547 batch_time=0.58983 
Train Epoch: 16 [155/250 19840/32000 (62%)] Loss: 1.33021 (QuantReg: 15.32564) QuantErr: 15.32564 batch_time=0.94763 
Train Epoch: 16 [166/250 21248/32000 (66%)] Loss: 1.19029 (QuantReg: 15.15281) QuantErr: 15.15281 batch_time=0.58727 
Train Epoch: 16 [177/250 22656/32000 (71%)] Loss: 1.40762 (QuantReg: 15.10033) QuantErr: 15.10033 batch_time=0.58603 
Train Epoch: 16 [188/250 24064/32000 (75%)] Loss: 1.03379 (QuantReg: 15.27262) QuantErr: 15.27262 batch_time=0.58675 
Train Epoch: 16 [199/250 25472/32000 (80%)] Loss: 1.27339 (QuantReg: 15.35265) QuantErr: 15.35265 batch_time=0.58927 
Train Epoch: 16 [210/250 26880/32000 (84%)] Loss: 1.16634 (QuantReg: 15.38805) QuantErr: 15.38805 batch_time=0.64073 
Train Epoch: 16 [221/250 28288/32000 (88%)] Loss: 1.05939 (QuantReg: 15.45017) QuantErr: 15.45017 batch_time=0.60294 
Train Epoch: 16 [232/250 29696/32000 (93%)] Loss: 1.22715 (QuantReg: 15.14034) QuantErr: 15.14034 batch_time=0.60657 
Train Epoch: 16 [243/250 31104/32000 (97%)] Loss: 1.24267 (QuantReg: 15.50199) QuantErr: 15.50199 batch_time=0.60707 
Train Epoch: 16 codebook_update_time=3.32657
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch16.pth ...
Done in 3.632s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 1.288271166086197
 quant_reg      : 15.199882564544678
 quant_err      : 15.199882564544678
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 37.42454728370221
 MSRVTT_full_val/t2v_metrics/R5: 72.23340040241449
 MSRVTT_full_val/t2v_metrics/R10: 84.30583501006036
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.229376257545272
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.082586197152736
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 80.6841046277666
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.569416498993964
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.39242938266992
 MSRVTT_full_test/t2v_metrics/R1: 14.715719063545151
 MSRVTT_full_test/t2v_metrics/R5: 39.79933110367893
 MSRVTT_full_test/t2v_metrics/R10: 53.94648829431438
 MSRVTT_full_test/t2v_metrics/R50: 83.01003344481606
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 37.610033444816054
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.613565506361496
 MSRVTT_full_test/v2t_metrics/R1: 18.795986622073578
 MSRVTT_full_test/v2t_metrics/R5: 47.491638795986624
 MSRVTT_full_test/v2t_metrics/R10: 61.87290969899666
 MSRVTT_full_test/v2t_metrics/R50: 88.16053511705685
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 25.434113712374582
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.08268914717458
 mnt_best       : 31.628711845665258
 not_improved_count: 1
Train Epoch: 17 [1/250 128/32000 (0%)] Loss: 1.25366 (QuantReg: 14.93258) QuantErr: 14.93258 batch_time=35.77163 
Train Epoch: 17 [12/250 1536/32000 (5%)] Loss: 1.41172 (QuantReg: 15.01552) QuantErr: 15.01552 batch_time=1.46507 
Train Epoch: 17 [23/250 2944/32000 (9%)] Loss: 1.07830 (QuantReg: 15.10121) QuantErr: 15.10121 batch_time=0.61632 
Train Epoch: 17 [34/250 4352/32000 (14%)] Loss: 1.05680 (QuantReg: 15.23354) QuantErr: 15.23354 batch_time=0.59435 
Train Epoch: 17 [45/250 5760/32000 (18%)] Loss: 1.48785 (QuantReg: 15.16572) QuantErr: 15.16572 batch_time=0.60998 
Train Epoch: 17 [56/250 7168/32000 (22%)] Loss: 1.12160 (QuantReg: 15.14499) QuantErr: 15.14499 batch_time=0.60620 
Train Epoch: 17 [67/250 8576/32000 (27%)] Loss: 0.95550 (QuantReg: 15.40232) QuantErr: 15.40232 batch_time=0.59028 
Train Epoch: 17 [78/250 9984/32000 (31%)] Loss: 1.26682 (QuantReg: 15.16483) QuantErr: 15.16483 batch_time=0.59962 
Train Epoch: 17 [89/250 11392/32000 (36%)] Loss: 1.06339 (QuantReg: 15.45359) QuantErr: 15.45359 batch_time=0.60251 
Train Epoch: 17 [100/250 12800/32000 (40%)] Loss: 1.22801 (QuantReg: 15.27157) QuantErr: 15.27157 batch_time=0.60010 
Train Epoch: 17 [111/250 14208/32000 (44%)] Loss: 1.23682 (QuantReg: 15.29616) QuantErr: 15.29616 batch_time=0.59035 
Train Epoch: 17 [122/250 15616/32000 (49%)] Loss: 1.27150 (QuantReg: 14.99908) QuantErr: 14.99908 batch_time=0.59055 
Train Epoch: 17 [133/250 17024/32000 (53%)] Loss: 1.10438 (QuantReg: 15.24912) QuantErr: 15.24912 batch_time=0.61444 
Train Epoch: 17 [144/250 18432/32000 (58%)] Loss: 1.75655 (QuantReg: 15.09893) QuantErr: 15.09893 batch_time=0.82450 
Train Epoch: 17 [155/250 19840/32000 (62%)] Loss: 1.22245 (QuantReg: 15.50191) QuantErr: 15.50191 batch_time=0.58919 
Train Epoch: 17 [166/250 21248/32000 (66%)] Loss: 1.09182 (QuantReg: 14.98058) QuantErr: 14.98058 batch_time=0.60701 
Train Epoch: 17 [177/250 22656/32000 (71%)] Loss: 1.07121 (QuantReg: 15.23958) QuantErr: 15.23958 batch_time=0.59795 
Train Epoch: 17 [188/250 24064/32000 (75%)] Loss: 1.14405 (QuantReg: 15.23289) QuantErr: 15.23289 batch_time=0.65830 
Train Epoch: 17 [199/250 25472/32000 (80%)] Loss: 1.40968 (QuantReg: 15.38296) QuantErr: 15.38296 batch_time=0.60449 
Train Epoch: 17 [210/250 26880/32000 (84%)] Loss: 1.17467 (QuantReg: 15.40209) QuantErr: 15.40209 batch_time=0.60470 
Train Epoch: 17 [221/250 28288/32000 (88%)] Loss: 1.00637 (QuantReg: 15.28224) QuantErr: 15.28224 batch_time=0.59580 
Train Epoch: 17 [232/250 29696/32000 (93%)] Loss: 1.36095 (QuantReg: 15.47236) QuantErr: 15.47236 batch_time=0.59487 
Train Epoch: 17 [243/250 31104/32000 (97%)] Loss: 1.12802 (QuantReg: 15.37249) QuantErr: 15.37249 batch_time=0.59026 
Train Epoch: 17 codebook_update_time=3.23019
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch17.pth ...
Done in 3.761s
removing stale ckpt [epoch 16] [took 0.69s]
 epoch          : 17
 loss           : 1.22765030169487
 quant_reg      : 15.254802932739258
 quant_err      : 15.254802932739258
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 4250
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 72.23340040241449
 MSRVTT_full_val/t2v_metrics/R10: 83.90342052313883
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.474849094567404
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.32230768130019
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.79476861167002
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.84605966685093
 MSRVTT_full_test/t2v_metrics/R1: 14.782608695652174
 MSRVTT_full_test/t2v_metrics/R5: 39.63210702341137
 MSRVTT_full_test/t2v_metrics/R10: 52.30769230769231
 MSRVTT_full_test/t2v_metrics/R50: 82.40802675585284
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 38.309030100334446
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.293533283957622
 MSRVTT_full_test/v2t_metrics/R1: 18.695652173913043
 MSRVTT_full_test/v2t_metrics/R5: 47.19063545150502
 MSRVTT_full_test/v2t_metrics/R10: 60.53511705685619
 MSRVTT_full_test/v2t_metrics/R50: 87.82608695652173
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.79799331103679
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.65892718721384
 mnt_best       : 31.628711845665258
 not_improved_count: 2
Train Epoch: 18 [1/250 128/32000 (0%)] Loss: 1.33722 (QuantReg: 15.25218) QuantErr: 15.25218 batch_time=35.45148 
Train Epoch: 18 [12/250 1536/32000 (5%)] Loss: 1.25277 (QuantReg: 15.14188) QuantErr: 15.14188 batch_time=0.60027 
Train Epoch: 18 [23/250 2944/32000 (9%)] Loss: 1.19793 (QuantReg: 15.12619) QuantErr: 15.12619 batch_time=0.59479 
Train Epoch: 18 [34/250 4352/32000 (14%)] Loss: 1.06311 (QuantReg: 15.09393) QuantErr: 15.09393 batch_time=0.59172 
Train Epoch: 18 [45/250 5760/32000 (18%)] Loss: 1.22413 (QuantReg: 15.11061) QuantErr: 15.11061 batch_time=0.58613 
Train Epoch: 18 [56/250 7168/32000 (22%)] Loss: 1.28769 (QuantReg: 15.22972) QuantErr: 15.22972 batch_time=0.57773 
Train Epoch: 18 [67/250 8576/32000 (27%)] Loss: 1.57977 (QuantReg: 15.13215) QuantErr: 15.13215 batch_time=0.61533 
Train Epoch: 18 [78/250 9984/32000 (31%)] Loss: 1.27635 (QuantReg: 15.20497) QuantErr: 15.20497 batch_time=0.59223 
Train Epoch: 18 [89/250 11392/32000 (36%)] Loss: 1.07802 (QuantReg: 15.11801) QuantErr: 15.11801 batch_time=0.59828 
Train Epoch: 18 [100/250 12800/32000 (40%)] Loss: 1.12787 (QuantReg: 15.29331) QuantErr: 15.29331 batch_time=0.59561 
Train Epoch: 18 [111/250 14208/32000 (44%)] Loss: 1.01686 (QuantReg: 15.25696) QuantErr: 15.25696 batch_time=0.59694 
Train Epoch: 18 [122/250 15616/32000 (49%)] Loss: 1.56643 (QuantReg: 15.15948) QuantErr: 15.15948 batch_time=0.59929 
Train Epoch: 18 [133/250 17024/32000 (53%)] Loss: 1.62935 (QuantReg: 15.41040) QuantErr: 15.41040 batch_time=0.58302 
Train Epoch: 18 [144/250 18432/32000 (58%)] Loss: 1.04829 (QuantReg: 15.20881) QuantErr: 15.20881 batch_time=1.87618 
Train Epoch: 18 [155/250 19840/32000 (62%)] Loss: 1.22824 (QuantReg: 15.43387) QuantErr: 15.43387 batch_time=0.59090 
Train Epoch: 18 [166/250 21248/32000 (66%)] Loss: 1.48121 (QuantReg: 15.28773) QuantErr: 15.28773 batch_time=0.60335 
Train Epoch: 18 [177/250 22656/32000 (71%)] Loss: 1.10355 (QuantReg: 15.34624) QuantErr: 15.34624 batch_time=0.59415 
Train Epoch: 18 [188/250 24064/32000 (75%)] Loss: 0.98961 (QuantReg: 15.36501) QuantErr: 15.36501 batch_time=0.58959 
Train Epoch: 18 [199/250 25472/32000 (80%)] Loss: 1.16219 (QuantReg: 15.30906) QuantErr: 15.30906 batch_time=0.61488 
Train Epoch: 18 [210/250 26880/32000 (84%)] Loss: 1.56996 (QuantReg: 15.38624) QuantErr: 15.38624 batch_time=1.06451 
Train Epoch: 18 [221/250 28288/32000 (88%)] Loss: 1.14922 (QuantReg: 15.30975) QuantErr: 15.30975 batch_time=0.58082 
Train Epoch: 18 [232/250 29696/32000 (93%)] Loss: 0.81726 (QuantReg: 15.47216) QuantErr: 15.47216 batch_time=0.60013 
Train Epoch: 18 [243/250 31104/32000 (97%)] Loss: 1.00146 (QuantReg: 15.42152) QuantErr: 15.42152 batch_time=0.60547 
Train Epoch: 18 codebook_update_time=3.50563
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch18.pth ...
Done in 3.696s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch18.pth ...
Done in 7.464s
removing stale ckpt [epoch 17] [took 0.00s]
 epoch          : 18
 loss           : 1.1823849959373474
 quant_reg      : 15.255027542114258
 quant_err      : 15.255027542114258
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.424547283702213
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.567136912134394
 MSRVTT_full_val/v2t_metrics/R1: 41.64989939637827
 MSRVTT_full_val/v2t_metrics/R5: 80.88531187122736
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.488933601609658
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.50775995365822
 MSRVTT_full_test/t2v_metrics/R1: 14.91638795986622
 MSRVTT_full_test/t2v_metrics/R5: 40.2675585284281
 MSRVTT_full_test/t2v_metrics/R10: 53.21070234113712
 MSRVTT_full_test/t2v_metrics/R50: 82.40802675585284
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.42040133779264
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.73505973338051
 MSRVTT_full_test/v2t_metrics/R1: 18.82943143812709
 MSRVTT_full_test/v2t_metrics/R5: 47.05685618729097
 MSRVTT_full_test/v2t_metrics/R10: 61.40468227424749
 MSRVTT_full_test/v2t_metrics/R50: 88.26086956521739
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.254180602006688
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.89255311614679
 mnt_best       : 31.73505973338051
 not_improved_count: 0
Train Epoch: 19 [1/250 128/32000 (0%)] Loss: 1.05454 (QuantReg: 15.31637) QuantErr: 15.31637 batch_time=34.36657 
Train Epoch: 19 [12/250 1536/32000 (5%)] Loss: 1.17502 (QuantReg: 15.32325) QuantErr: 15.32325 batch_time=0.59144 
Train Epoch: 19 [23/250 2944/32000 (9%)] Loss: 1.31540 (QuantReg: 15.04217) QuantErr: 15.04217 batch_time=0.58798 
Train Epoch: 19 [34/250 4352/32000 (14%)] Loss: 1.18398 (QuantReg: 15.22989) QuantErr: 15.22989 batch_time=0.58611 
Train Epoch: 19 [45/250 5760/32000 (18%)] Loss: 1.06190 (QuantReg: 15.34219) QuantErr: 15.34219 batch_time=0.60035 
Train Epoch: 19 [56/250 7168/32000 (22%)] Loss: 1.25319 (QuantReg: 15.35042) QuantErr: 15.35042 batch_time=0.63803 
Train Epoch: 19 [67/250 8576/32000 (27%)] Loss: 1.14970 (QuantReg: 15.28220) QuantErr: 15.28220 batch_time=0.59903 
Train Epoch: 19 [78/250 9984/32000 (31%)] Loss: 1.40037 (QuantReg: 15.38005) QuantErr: 15.38005 batch_time=0.60981 
Train Epoch: 19 [89/250 11392/32000 (36%)] Loss: 1.19341 (QuantReg: 15.06910) QuantErr: 15.06910 batch_time=0.64379 
Train Epoch: 19 [100/250 12800/32000 (40%)] Loss: 1.13889 (QuantReg: 15.42588) QuantErr: 15.42588 batch_time=0.59761 
Train Epoch: 19 [111/250 14208/32000 (44%)] Loss: 0.97839 (QuantReg: 15.45793) QuantErr: 15.45793 batch_time=0.61848 
Train Epoch: 19 [122/250 15616/32000 (49%)] Loss: 1.06389 (QuantReg: 15.34404) QuantErr: 15.34404 batch_time=0.69973 
Train Epoch: 19 [133/250 17024/32000 (53%)] Loss: 1.22233 (QuantReg: 15.37639) QuantErr: 15.37639 batch_time=0.60145 
Train Epoch: 19 [144/250 18432/32000 (58%)] Loss: 0.80179 (QuantReg: 15.27276) QuantErr: 15.27276 batch_time=0.60214 
Train Epoch: 19 [155/250 19840/32000 (62%)] Loss: 1.21577 (QuantReg: 15.35715) QuantErr: 15.35715 batch_time=0.58205 
Train Epoch: 19 [166/250 21248/32000 (66%)] Loss: 0.80058 (QuantReg: 15.08398) QuantErr: 15.08398 batch_time=0.63314 
Train Epoch: 19 [177/250 22656/32000 (71%)] Loss: 1.27106 (QuantReg: 15.36708) QuantErr: 15.36708 batch_time=0.60896 
Train Epoch: 19 [188/250 24064/32000 (75%)] Loss: 1.25870 (QuantReg: 15.32020) QuantErr: 15.32020 batch_time=0.70822 
Train Epoch: 19 [199/250 25472/32000 (80%)] Loss: 1.14158 (QuantReg: 15.29889) QuantErr: 15.29889 batch_time=0.58096 
Train Epoch: 19 [210/250 26880/32000 (84%)] Loss: 0.81330 (QuantReg: 15.42488) QuantErr: 15.42488 batch_time=0.59058 
Train Epoch: 19 [221/250 28288/32000 (88%)] Loss: 0.86854 (QuantReg: 15.44743) QuantErr: 15.44743 batch_time=0.59606 
Train Epoch: 19 [232/250 29696/32000 (93%)] Loss: 0.86334 (QuantReg: 15.39627) QuantErr: 15.39627 batch_time=0.59069 
Train Epoch: 19 [243/250 31104/32000 (97%)] Loss: 1.05821 (QuantReg: 15.29946) QuantErr: 15.29946 batch_time=0.58472 
Train Epoch: 19 codebook_update_time=3.22024
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch19.pth ...
Done in 3.791s
removing stale ckpt [epoch 18] [took 0.00s]
 epoch          : 19
 loss           : 1.1415325555801392
 quant_reg      : 15.28750708770752
 quant_err      : 15.28750708770752
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 4750
 MSRVTT_full_val/t2v_metrics/R1: 35.814889336016094
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.822937625754527
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.417144144521515
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 89.53722334004024
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.507042253521127
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.83097301923546
 MSRVTT_full_test/t2v_metrics/R1: 14.414715719063546
 MSRVTT_full_test/t2v_metrics/R5: 39.364548494983275
 MSRVTT_full_test/t2v_metrics/R10: 52.608695652173914
 MSRVTT_full_test/t2v_metrics/R50: 81.87290969899665
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.84096989966555
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.02103594040536
 MSRVTT_full_test/v2t_metrics/R1: 19.130434782608695
 MSRVTT_full_test/v2t_metrics/R5: 47.491638795986624
 MSRVTT_full_test/v2t_metrics/R10: 62.17391304347826
 MSRVTT_full_test/v2t_metrics/R50: 88.82943143812709
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.379933110367894
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.369257876764124
 mnt_best       : 31.73505973338051
 not_improved_count: 1
Train Epoch: 20 [1/250 128/32000 (0%)] Loss: 1.22292 (QuantReg: 15.07183) QuantErr: 15.07183 batch_time=28.68790 
Train Epoch: 20 [12/250 1536/32000 (5%)] Loss: 1.23395 (QuantReg: 15.19223) QuantErr: 15.19223 batch_time=0.59454 
Train Epoch: 20 [23/250 2944/32000 (9%)] Loss: 1.13244 (QuantReg: 15.14324) QuantErr: 15.14324 batch_time=3.10182 
Train Epoch: 20 [34/250 4352/32000 (14%)] Loss: 1.07930 (QuantReg: 15.46293) QuantErr: 15.46293 batch_time=0.59698 
Train Epoch: 20 [45/250 5760/32000 (18%)] Loss: 1.26618 (QuantReg: 15.38618) QuantErr: 15.38618 batch_time=0.66627 
Train Epoch: 20 [56/250 7168/32000 (22%)] Loss: 1.15508 (QuantReg: 15.10578) QuantErr: 15.10578 batch_time=0.66656 
Train Epoch: 20 [67/250 8576/32000 (27%)] Loss: 1.03351 (QuantReg: 15.43473) QuantErr: 15.43473 batch_time=0.60178 
Train Epoch: 20 [78/250 9984/32000 (31%)] Loss: 0.96177 (QuantReg: 15.38146) QuantErr: 15.38146 batch_time=0.84034 
Train Epoch: 20 [89/250 11392/32000 (36%)] Loss: 1.46077 (QuantReg: 15.12969) QuantErr: 15.12969 batch_time=0.57858 
Train Epoch: 20 [100/250 12800/32000 (40%)] Loss: 1.10360 (QuantReg: 15.41010) QuantErr: 15.41010 batch_time=0.64042 
Train Epoch: 20 [111/250 14208/32000 (44%)] Loss: 0.96165 (QuantReg: 15.52618) QuantErr: 15.52618 batch_time=0.59281 
Train Epoch: 20 [122/250 15616/32000 (49%)] Loss: 0.84727 (QuantReg: 15.32812) QuantErr: 15.32812 batch_time=0.59259 
Train Epoch: 20 [133/250 17024/32000 (53%)] Loss: 1.16784 (QuantReg: 15.29664) QuantErr: 15.29664 batch_time=0.58967 
Train Epoch: 20 [144/250 18432/32000 (58%)] Loss: 1.27491 (QuantReg: 15.22802) QuantErr: 15.22802 batch_time=1.47528 
Train Epoch: 20 [155/250 19840/32000 (62%)] Loss: 1.32307 (QuantReg: 15.10871) QuantErr: 15.10871 batch_time=0.58360 
Train Epoch: 20 [166/250 21248/32000 (66%)] Loss: 1.47200 (QuantReg: 15.31846) QuantErr: 15.31846 batch_time=0.58137 
Train Epoch: 20 [177/250 22656/32000 (71%)] Loss: 1.08485 (QuantReg: 15.36175) QuantErr: 15.36175 batch_time=0.59142 
Train Epoch: 20 [188/250 24064/32000 (75%)] Loss: 0.95456 (QuantReg: 15.50793) QuantErr: 15.50793 batch_time=0.59694 
Train Epoch: 20 [199/250 25472/32000 (80%)] Loss: 0.93701 (QuantReg: 15.22572) QuantErr: 15.22572 batch_time=0.58691 
Train Epoch: 20 [210/250 26880/32000 (84%)] Loss: 1.45982 (QuantReg: 15.11795) QuantErr: 15.11795 batch_time=1.01804 
Train Epoch: 20 [221/250 28288/32000 (88%)] Loss: 1.63084 (QuantReg: 15.11781) QuantErr: 15.11781 batch_time=0.91420 
Train Epoch: 20 [232/250 29696/32000 (93%)] Loss: 1.08540 (QuantReg: 15.23669) QuantErr: 15.23669 batch_time=0.59493 
Train Epoch: 20 [243/250 31104/32000 (97%)] Loss: 0.72837 (QuantReg: 15.62906) QuantErr: 15.62906 batch_time=0.59751 
Train Epoch: 20 codebook_update_time=3.28346
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch20.pth ...
Done in 4.849s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch20.pth ...
Done in 9.014s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 1.1251424052715302
 quant_reg      : 15.287356727600098
 quant_err      : 15.287356727600098
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 39.23541247484909
 MSRVTT_full_val/t2v_metrics/R5: 73.03822937625755
 MSRVTT_full_val/t2v_metrics/R10: 84.10462776659959
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.118712273641851
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 62.232338010174225
 MSRVTT_full_val/v2t_metrics/R1: 43.66197183098591
 MSRVTT_full_val/v2t_metrics/R5: 81.28772635814889
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.211267605633803
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.93269086569423
 MSRVTT_full_test/t2v_metrics/R1: 15.217391304347826
 MSRVTT_full_test/t2v_metrics/R5: 39.59866220735786
 MSRVTT_full_test/t2v_metrics/R10: 54.51505016722408
 MSRVTT_full_test/t2v_metrics/R50: 83.37792642140468
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 38.63745819397993
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.02671384940022
 MSRVTT_full_test/v2t_metrics/R1: 18.99665551839465
 MSRVTT_full_test/v2t_metrics/R5: 47.558528428093645
 MSRVTT_full_test/v2t_metrics/R10: 61.97324414715719
 MSRVTT_full_test/v2t_metrics/R50: 89.09698996655518
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.170903010033445
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.25632622346131
 mnt_best       : 32.02671384940022
 not_improved_count: 0
Train Epoch: 21 [1/250 128/32000 (0%)] Loss: 1.04131 (QuantReg: 15.06460) QuantErr: 15.06460 batch_time=29.99899 
Train Epoch: 21 [12/250 1536/32000 (5%)] Loss: 1.09926 (QuantReg: 15.11433) QuantErr: 15.11433 batch_time=0.59371 
Train Epoch: 21 [23/250 2944/32000 (9%)] Loss: 1.17685 (QuantReg: 15.16289) QuantErr: 15.16289 batch_time=0.63937 
Train Epoch: 21 [34/250 4352/32000 (14%)] Loss: 0.93896 (QuantReg: 15.44935) QuantErr: 15.44935 batch_time=0.58824 
Train Epoch: 21 [45/250 5760/32000 (18%)] Loss: 0.82157 (QuantReg: 15.30365) QuantErr: 15.30365 batch_time=0.61098 
Train Epoch: 21 [56/250 7168/32000 (22%)] Loss: 0.84547 (QuantReg: 15.56105) QuantErr: 15.56105 batch_time=0.60693 
Train Epoch: 21 [67/250 8576/32000 (27%)] Loss: 1.13570 (QuantReg: 15.18373) QuantErr: 15.18373 batch_time=0.59085 
Train Epoch: 21 [78/250 9984/32000 (31%)] Loss: 1.29002 (QuantReg: 15.15698) QuantErr: 15.15698 batch_time=0.60150 
Train Epoch: 21 [89/250 11392/32000 (36%)] Loss: 1.20618 (QuantReg: 15.28951) QuantErr: 15.28951 batch_time=0.59557 
Train Epoch: 21 [100/250 12800/32000 (40%)] Loss: 1.16469 (QuantReg: 15.12882) QuantErr: 15.12882 batch_time=0.60404 
Train Epoch: 21 [111/250 14208/32000 (44%)] Loss: 0.95388 (QuantReg: 15.30679) QuantErr: 15.30679 batch_time=0.59654 
Train Epoch: 21 [122/250 15616/32000 (49%)] Loss: 1.05590 (QuantReg: 15.38558) QuantErr: 15.38558 batch_time=0.58666 
Train Epoch: 21 [133/250 17024/32000 (53%)] Loss: 0.91494 (QuantReg: 15.22714) QuantErr: 15.22714 batch_time=0.59481 
Train Epoch: 21 [144/250 18432/32000 (58%)] Loss: 1.18097 (QuantReg: 15.33291) QuantErr: 15.33291 batch_time=0.61304 
Train Epoch: 21 [155/250 19840/32000 (62%)] Loss: 1.13258 (QuantReg: 15.14045) QuantErr: 15.14045 batch_time=0.58939 
Train Epoch: 21 [166/250 21248/32000 (66%)] Loss: 0.97328 (QuantReg: 15.33827) QuantErr: 15.33827 batch_time=0.58459 
Train Epoch: 21 [177/250 22656/32000 (71%)] Loss: 1.27314 (QuantReg: 15.42428) QuantErr: 15.42428 batch_time=0.59507 
Train Epoch: 21 [188/250 24064/32000 (75%)] Loss: 1.00601 (QuantReg: 15.20568) QuantErr: 15.20568 batch_time=0.59347 
Train Epoch: 21 [199/250 25472/32000 (80%)] Loss: 1.10342 (QuantReg: 15.41257) QuantErr: 15.41257 batch_time=0.62006 
Train Epoch: 21 [210/250 26880/32000 (84%)] Loss: 1.34237 (QuantReg: 15.26075) QuantErr: 15.26075 batch_time=0.60830 
Train Epoch: 21 [221/250 28288/32000 (88%)] Loss: 1.06931 (QuantReg: 15.40482) QuantErr: 15.40482 batch_time=0.58721 
Train Epoch: 21 [232/250 29696/32000 (93%)] Loss: 0.99440 (QuantReg: 15.59761) QuantErr: 15.59761 batch_time=0.59205 
Train Epoch: 21 [243/250 31104/32000 (97%)] Loss: 0.90802 (QuantReg: 15.30324) QuantErr: 15.30324 batch_time=0.59560 
Train Epoch: 21 codebook_update_time=3.29083
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch21.pth ...
Done in 11.518s
removing stale ckpt [epoch 20] [took 0.17s]
 epoch          : 21
 loss           : 1.084606710910797
 quant_reg      : 15.279024703979491
 quant_err      : 15.279024703979491
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 5250
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.215291750503019
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.298051080351954
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.744466800804829
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.00977901384711
 MSRVTT_full_test/t2v_metrics/R1: 14.715719063545151
 MSRVTT_full_test/t2v_metrics/R5: 38.99665551839465
 MSRVTT_full_test/t2v_metrics/R10: 51.73913043478261
 MSRVTT_full_test/t2v_metrics/R50: 81.93979933110369
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.311705685618726
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.965349906846658
 MSRVTT_full_test/v2t_metrics/R1: 18.361204013377925
 MSRVTT_full_test/v2t_metrics/R5: 46.68896321070234
 MSRVTT_full_test/v2t_metrics/R10: 60.10033444816054
 MSRVTT_full_test/v2t_metrics/R50: 87.6923076923077
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 28.578929765886286
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.21037884127833
 mnt_best       : 32.02671384940022
 not_improved_count: 1
Train Epoch: 22 [1/250 128/32000 (0%)] Loss: 1.23072 (QuantReg: 15.08513) QuantErr: 15.08513 batch_time=29.97353 
Train Epoch: 22 [12/250 1536/32000 (5%)] Loss: 1.14971 (QuantReg: 15.19240) QuantErr: 15.19240 batch_time=0.57856 
Train Epoch: 22 [23/250 2944/32000 (9%)] Loss: 1.01368 (QuantReg: 15.31642) QuantErr: 15.31642 batch_time=0.58462 
Train Epoch: 22 [34/250 4352/32000 (14%)] Loss: 1.03763 (QuantReg: 15.07631) QuantErr: 15.07631 batch_time=0.59081 
Train Epoch: 22 [45/250 5760/32000 (18%)] Loss: 0.94773 (QuantReg: 15.39814) QuantErr: 15.39814 batch_time=0.59481 
Train Epoch: 22 [56/250 7168/32000 (22%)] Loss: 0.94015 (QuantReg: 15.29012) QuantErr: 15.29012 batch_time=0.58855 
Train Epoch: 22 [67/250 8576/32000 (27%)] Loss: 1.18517 (QuantReg: 15.13449) QuantErr: 15.13449 batch_time=5.27971 
Train Epoch: 22 [78/250 9984/32000 (31%)] Loss: 1.00893 (QuantReg: 15.18946) QuantErr: 15.18946 batch_time=0.58898 
Train Epoch: 22 [89/250 11392/32000 (36%)] Loss: 1.23396 (QuantReg: 14.98319) QuantErr: 14.98319 batch_time=0.58865 
Train Epoch: 22 [100/250 12800/32000 (40%)] Loss: 1.09698 (QuantReg: 15.40217) QuantErr: 15.40217 batch_time=0.58931 
Train Epoch: 22 [111/250 14208/32000 (44%)] Loss: 1.25891 (QuantReg: 15.23915) QuantErr: 15.23915 batch_time=1.03034 
Train Epoch: 22 [122/250 15616/32000 (49%)] Loss: 0.99510 (QuantReg: 15.30354) QuantErr: 15.30354 batch_time=0.58869 
Train Epoch: 22 [133/250 17024/32000 (53%)] Loss: 1.12610 (QuantReg: 15.27899) QuantErr: 15.27899 batch_time=0.60737 
Train Epoch: 22 [144/250 18432/32000 (58%)] Loss: 1.16919 (QuantReg: 15.37550) QuantErr: 15.37550 batch_time=1.31233 
Train Epoch: 22 [155/250 19840/32000 (62%)] Loss: 1.00904 (QuantReg: 15.36193) QuantErr: 15.36193 batch_time=0.59477 
Train Epoch: 22 [166/250 21248/32000 (66%)] Loss: 1.24079 (QuantReg: 15.32470) QuantErr: 15.32470 batch_time=0.59355 
Train Epoch: 22 [177/250 22656/32000 (71%)] Loss: 1.24945 (QuantReg: 15.31705) QuantErr: 15.31705 batch_time=0.58506 
Train Epoch: 22 [188/250 24064/32000 (75%)] Loss: 1.08392 (QuantReg: 15.43843) QuantErr: 15.43843 batch_time=0.58921 
Train Epoch: 22 [199/250 25472/32000 (80%)] Loss: 1.09102 (QuantReg: 15.19335) QuantErr: 15.19335 batch_time=0.58810 
Train Epoch: 22 [210/250 26880/32000 (84%)] Loss: 1.09066 (QuantReg: 15.37836) QuantErr: 15.37836 batch_time=0.61692 
Train Epoch: 22 [221/250 28288/32000 (88%)] Loss: 1.09171 (QuantReg: 15.26061) QuantErr: 15.26061 batch_time=0.59348 
Train Epoch: 22 [232/250 29696/32000 (93%)] Loss: 0.97534 (QuantReg: 15.29708) QuantErr: 15.29708 batch_time=0.62401 
Train Epoch: 22 [243/250 31104/32000 (97%)] Loss: 0.81748 (QuantReg: 15.53220) QuantErr: 15.53220 batch_time=0.82313 
Train Epoch: 22 codebook_update_time=3.18435
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch22.pth ...
Done in 10.126s
removing stale ckpt [epoch 21] [took 0.00s]
 epoch          : 22
 loss           : 1.047626344203949
 quant_reg      : 15.310496719360351
 quant_err      : 15.310496719360351
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 71.42857142857143
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.851106639839034
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.80780145205952
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 78.87323943661971
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.474849094567404
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.56743436773814
 MSRVTT_full_test/t2v_metrics/R1: 14.816053511705686
 MSRVTT_full_test/t2v_metrics/R5: 39.331103678929765
 MSRVTT_full_test/t2v_metrics/R10: 52.408026755852845
 MSRVTT_full_test/t2v_metrics/R50: 81.93979933110369
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.608695652173914
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.257590204156784
 MSRVTT_full_test/v2t_metrics/R1: 18.193979933110366
 MSRVTT_full_test/v2t_metrics/R5: 48.16053511705686
 MSRVTT_full_test/v2t_metrics/R10: 61.93979933110368
 MSRVTT_full_test/v2t_metrics/R50: 88.39464882943143
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.20133779264214
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.86136520697874
 mnt_best       : 32.02671384940022
 not_improved_count: 2
Train Epoch: 23 [1/250 128/32000 (0%)] Loss: 1.14419 (QuantReg: 15.08550) QuantErr: 15.08550 batch_time=33.24436 
Train Epoch: 23 [12/250 1536/32000 (5%)] Loss: 1.15393 (QuantReg: 15.38404) QuantErr: 15.38404 batch_time=0.59078 
Train Epoch: 23 [23/250 2944/32000 (9%)] Loss: 0.74133 (QuantReg: 15.34702) QuantErr: 15.34702 batch_time=0.59333 
Train Epoch: 23 [34/250 4352/32000 (14%)] Loss: 1.07022 (QuantReg: 15.24025) QuantErr: 15.24025 batch_time=0.57832 
Train Epoch: 23 [45/250 5760/32000 (18%)] Loss: 1.06047 (QuantReg: 15.21158) QuantErr: 15.21158 batch_time=0.64181 
Train Epoch: 23 [56/250 7168/32000 (22%)] Loss: 0.98490 (QuantReg: 15.27270) QuantErr: 15.27270 batch_time=0.93522 
Train Epoch: 23 [67/250 8576/32000 (27%)] Loss: 0.92195 (QuantReg: 15.22533) QuantErr: 15.22533 batch_time=0.58957 
Train Epoch: 23 [78/250 9984/32000 (31%)] Loss: 1.12090 (QuantReg: 15.29800) QuantErr: 15.29800 batch_time=0.59603 
Train Epoch: 23 [89/250 11392/32000 (36%)] Loss: 1.12144 (QuantReg: 15.08255) QuantErr: 15.08255 batch_time=0.63589 
Train Epoch: 23 [100/250 12800/32000 (40%)] Loss: 0.88091 (QuantReg: 15.39481) QuantErr: 15.39481 batch_time=0.60960 
Train Epoch: 23 [111/250 14208/32000 (44%)] Loss: 1.29588 (QuantReg: 15.26038) QuantErr: 15.26038 batch_time=0.66693 
Train Epoch: 23 [122/250 15616/32000 (49%)] Loss: 1.10382 (QuantReg: 15.20130) QuantErr: 15.20130 batch_time=0.59107 
Train Epoch: 23 [133/250 17024/32000 (53%)] Loss: 1.02432 (QuantReg: 15.25260) QuantErr: 15.25260 batch_time=0.59583 
Train Epoch: 23 [144/250 18432/32000 (58%)] Loss: 1.20139 (QuantReg: 15.48025) QuantErr: 15.48025 batch_time=0.60214 
Train Epoch: 23 [155/250 19840/32000 (62%)] Loss: 1.29547 (QuantReg: 15.32049) QuantErr: 15.32049 batch_time=0.59311 
Train Epoch: 23 [166/250 21248/32000 (66%)] Loss: 1.15731 (QuantReg: 15.15407) QuantErr: 15.15407 batch_time=0.59430 
Train Epoch: 23 [177/250 22656/32000 (71%)] Loss: 0.81632 (QuantReg: 15.62408) QuantErr: 15.62408 batch_time=0.59692 
Train Epoch: 23 [188/250 24064/32000 (75%)] Loss: 1.09804 (QuantReg: 15.38669) QuantErr: 15.38669 batch_time=0.59621 
Train Epoch: 23 [199/250 25472/32000 (80%)] Loss: 0.77082 (QuantReg: 15.45779) QuantErr: 15.45779 batch_time=0.58462 
Train Epoch: 23 [210/250 26880/32000 (84%)] Loss: 0.84755 (QuantReg: 15.48396) QuantErr: 15.48396 batch_time=0.58901 
Train Epoch: 23 [221/250 28288/32000 (88%)] Loss: 0.79728 (QuantReg: 15.56683) QuantErr: 15.56683 batch_time=0.59792 
Train Epoch: 23 [232/250 29696/32000 (93%)] Loss: 0.90627 (QuantReg: 15.32162) QuantErr: 15.32162 batch_time=0.59891 
Train Epoch: 23 [243/250 31104/32000 (97%)] Loss: 1.24610 (QuantReg: 15.05360) QuantErr: 15.05360 batch_time=0.60062 
Train Epoch: 23 codebook_update_time=3.20366
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch23.pth ...
Done in 3.760s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 1.0639706988334656
 quant_reg      : 15.299249084472656
 quant_err      : 15.299249084472656
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 5750
 MSRVTT_full_val/t2v_metrics/R1: 37.42454728370221
 MSRVTT_full_val/t2v_metrics/R5: 74.24547283702213
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.979879275653923
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.44776345780633
 MSRVTT_full_val/v2t_metrics/R1: 44.668008048289735
 MSRVTT_full_val/v2t_metrics/R5: 80.0804828973843
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.73440643863179
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 68.1099351626391
 MSRVTT_full_test/t2v_metrics/R1: 15.08361204013378
 MSRVTT_full_test/t2v_metrics/R5: 40.635451505016725
 MSRVTT_full_test/t2v_metrics/R10: 53.34448160535117
 MSRVTT_full_test/t2v_metrics/R50: 82.6086956521739
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.81070234113712
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.97667582074677
 MSRVTT_full_test/v2t_metrics/R1: 18.361204013377925
 MSRVTT_full_test/v2t_metrics/R5: 47.491638795986624
 MSRVTT_full_test/v2t_metrics/R10: 61.438127090301
 MSRVTT_full_test/v2t_metrics/R50: 88.89632107023411
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.6066889632107
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.69803905745342
 mnt_best       : 32.02671384940022
 not_improved_count: 3
Train Epoch: 24 [1/250 128/32000 (0%)] Loss: 1.25470 (QuantReg: 15.10808) QuantErr: 15.10808 batch_time=29.73088 
Train Epoch: 24 [12/250 1536/32000 (5%)] Loss: 0.92954 (QuantReg: 15.27937) QuantErr: 15.27937 batch_time=0.58200 
Train Epoch: 24 [23/250 2944/32000 (9%)] Loss: 0.82450 (QuantReg: 15.35981) QuantErr: 15.35981 batch_time=0.80204 
Train Epoch: 24 [34/250 4352/32000 (14%)] Loss: 1.15601 (QuantReg: 15.37492) QuantErr: 15.37492 batch_time=0.58353 
Train Epoch: 24 [45/250 5760/32000 (18%)] Loss: 1.22000 (QuantReg: 15.03370) QuantErr: 15.03370 batch_time=0.59983 
Train Epoch: 24 [56/250 7168/32000 (22%)] Loss: 0.73255 (QuantReg: 15.37828) QuantErr: 15.37828 batch_time=0.60032 
Train Epoch: 24 [67/250 8576/32000 (27%)] Loss: 0.70885 (QuantReg: 15.45130) QuantErr: 15.45130 batch_time=4.88766 
Train Epoch: 24 [78/250 9984/32000 (31%)] Loss: 0.98229 (QuantReg: 15.29621) QuantErr: 15.29621 batch_time=0.59373 
Train Epoch: 24 [89/250 11392/32000 (36%)] Loss: 0.90751 (QuantReg: 15.33030) QuantErr: 15.33030 batch_time=0.60020 
Train Epoch: 24 [100/250 12800/32000 (40%)] Loss: 0.94076 (QuantReg: 15.21864) QuantErr: 15.21864 batch_time=0.70784 
Train Epoch: 24 [111/250 14208/32000 (44%)] Loss: 1.14889 (QuantReg: 15.21458) QuantErr: 15.21458 batch_time=0.59988 
Train Epoch: 24 [122/250 15616/32000 (49%)] Loss: 1.16953 (QuantReg: 15.20098) QuantErr: 15.20098 batch_time=0.59760 
Train Epoch: 24 [133/250 17024/32000 (53%)] Loss: 0.90395 (QuantReg: 15.43065) QuantErr: 15.43065 batch_time=0.59138 
Train Epoch: 24 [144/250 18432/32000 (58%)] Loss: 1.41443 (QuantReg: 15.58002) QuantErr: 15.58002 batch_time=2.46693 
Train Epoch: 24 [155/250 19840/32000 (62%)] Loss: 1.14008 (QuantReg: 15.18259) QuantErr: 15.18259 batch_time=0.59834 
Train Epoch: 24 [166/250 21248/32000 (66%)] Loss: 0.79403 (QuantReg: 15.58282) QuantErr: 15.58282 batch_time=0.59500 
Train Epoch: 24 [177/250 22656/32000 (71%)] Loss: 0.87843 (QuantReg: 15.58631) QuantErr: 15.58631 batch_time=0.59665 
Train Epoch: 24 [188/250 24064/32000 (75%)] Loss: 0.83216 (QuantReg: 15.42891) QuantErr: 15.42891 batch_time=0.60214 
Train Epoch: 24 [199/250 25472/32000 (80%)] Loss: 1.06025 (QuantReg: 15.23436) QuantErr: 15.23436 batch_time=0.63048 
Train Epoch: 24 [210/250 26880/32000 (84%)] Loss: 0.82293 (QuantReg: 15.53191) QuantErr: 15.53191 batch_time=0.59259 
Train Epoch: 24 [221/250 28288/32000 (88%)] Loss: 1.17142 (QuantReg: 15.25788) QuantErr: 15.25788 batch_time=0.71771 
Train Epoch: 24 [232/250 29696/32000 (93%)] Loss: 1.31695 (QuantReg: 15.34978) QuantErr: 15.34978 batch_time=0.60209 
Train Epoch: 24 [243/250 31104/32000 (97%)] Loss: 0.97242 (QuantReg: 15.29587) QuantErr: 15.29587 batch_time=0.61742 
Train Epoch: 24 codebook_update_time=3.32924
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch24.pth ...
Done in 15.324s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 1.0059540114402772
 quant_reg      : 15.347312370300292
 quant_err      : 15.347312370300292
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 36.41851106639839
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.551307847082494
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.17637031143047
 MSRVTT_full_val/v2t_metrics/R1: 41.64989939637827
 MSRVTT_full_val/v2t_metrics/R5: 80.0804828973843
 MSRVTT_full_val/v2t_metrics/R10: 89.13480885311871
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.162977867203219
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.74150452119751
 MSRVTT_full_test/t2v_metrics/R1: 14.51505016722408
 MSRVTT_full_test/t2v_metrics/R5: 39.197324414715716
 MSRVTT_full_test/t2v_metrics/R10: 52.374581939799334
 MSRVTT_full_test/t2v_metrics/R50: 82.17391304347827
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.676923076923075
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.002628148207986
 MSRVTT_full_test/v2t_metrics/R1: 18.862876254180602
 MSRVTT_full_test/v2t_metrics/R5: 47.123745819397996
 MSRVTT_full_test/v2t_metrics/R10: 62.474916387959865
 MSRVTT_full_test/v2t_metrics/R50: 88.59531772575251
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.014046822742475
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.1520432136228
 mnt_best       : 32.02671384940022
 not_improved_count: 4
Train Epoch: 25 [1/250 128/32000 (0%)] Loss: 1.15180 (QuantReg: 15.18692) QuantErr: 15.18692 batch_time=29.23444 
Train Epoch: 25 [12/250 1536/32000 (5%)] Loss: 0.95442 (QuantReg: 15.14470) QuantErr: 15.14470 batch_time=0.58500 
Train Epoch: 25 [23/250 2944/32000 (9%)] Loss: 0.88676 (QuantReg: 15.48748) QuantErr: 15.48748 batch_time=0.59857 
Train Epoch: 25 [34/250 4352/32000 (14%)] Loss: 1.11163 (QuantReg: 15.18619) QuantErr: 15.18619 batch_time=0.70535 
Train Epoch: 25 [45/250 5760/32000 (18%)] Loss: 0.97751 (QuantReg: 15.19995) QuantErr: 15.19995 batch_time=0.59946 
Train Epoch: 25 [56/250 7168/32000 (22%)] Loss: 0.98637 (QuantReg: 15.30839) QuantErr: 15.30839 batch_time=0.60437 
Train Epoch: 25 [67/250 8576/32000 (27%)] Loss: 1.15442 (QuantReg: 15.24009) QuantErr: 15.24009 batch_time=0.59499 
Train Epoch: 25 [78/250 9984/32000 (31%)] Loss: 1.11091 (QuantReg: 15.42499) QuantErr: 15.42499 batch_time=0.93117 
Train Epoch: 25 [89/250 11392/32000 (36%)] Loss: 0.71727 (QuantReg: 15.42453) QuantErr: 15.42453 batch_time=1.13755 
Train Epoch: 25 [100/250 12800/32000 (40%)] Loss: 1.08375 (QuantReg: 15.28376) QuantErr: 15.28376 batch_time=0.58781 
Train Epoch: 25 [111/250 14208/32000 (44%)] Loss: 1.21604 (QuantReg: 15.23199) QuantErr: 15.23199 batch_time=0.59321 
Train Epoch: 25 [122/250 15616/32000 (49%)] Loss: 0.80061 (QuantReg: 15.30945) QuantErr: 15.30945 batch_time=0.61173 
Train Epoch: 25 [133/250 17024/32000 (53%)] Loss: 0.94079 (QuantReg: 15.33278) QuantErr: 15.33278 batch_time=0.59264 
Train Epoch: 25 [144/250 18432/32000 (58%)] Loss: 0.98595 (QuantReg: 15.45756) QuantErr: 15.45756 batch_time=0.58911 
Train Epoch: 25 [155/250 19840/32000 (62%)] Loss: 1.05541 (QuantReg: 15.31456) QuantErr: 15.31456 batch_time=0.59310 
Train Epoch: 25 [166/250 21248/32000 (66%)] Loss: 1.24989 (QuantReg: 15.11253) QuantErr: 15.11253 batch_time=0.59863 
Train Epoch: 25 [177/250 22656/32000 (71%)] Loss: 0.89557 (QuantReg: 15.34844) QuantErr: 15.34844 batch_time=0.59286 
Train Epoch: 25 [188/250 24064/32000 (75%)] Loss: 0.94086 (QuantReg: 15.53426) QuantErr: 15.53426 batch_time=0.59155 
Train Epoch: 25 [199/250 25472/32000 (80%)] Loss: 0.85855 (QuantReg: 15.43103) QuantErr: 15.43103 batch_time=0.58991 
Train Epoch: 25 [210/250 26880/32000 (84%)] Loss: 1.01715 (QuantReg: 15.30801) QuantErr: 15.30801 batch_time=0.60327 
Train Epoch: 25 [221/250 28288/32000 (88%)] Loss: 1.04604 (QuantReg: 15.35707) QuantErr: 15.35707 batch_time=1.40237 
Train Epoch: 25 [232/250 29696/32000 (93%)] Loss: 0.98834 (QuantReg: 15.30246) QuantErr: 15.30246 batch_time=0.58988 
Train Epoch: 25 [243/250 31104/32000 (97%)] Loss: 1.00636 (QuantReg: 15.28988) QuantErr: 15.28988 batch_time=0.59949 
Train Epoch: 25 codebook_update_time=3.26028
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch25.pth ...
Done in 3.841s
removing stale ckpt [epoch 24] [took 0.02s]
 epoch          : 25
 loss           : 1.0074176111221314
 quant_reg      : 15.328772426605225
 quant_err      : 15.328772426605225
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 6250
 MSRVTT_full_val/t2v_metrics/R1: 36.01609657947686
 MSRVTT_full_val/t2v_metrics/R5: 73.2394366197183
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.977867203219316
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.34322678355373
 MSRVTT_full_val/v2t_metrics/R1: 43.66197183098591
 MSRVTT_full_val/v2t_metrics/R5: 80.88531187122736
 MSRVTT_full_val/v2t_metrics/R10: 89.53722334004024
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.889336016096579
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 68.12798496340041
 MSRVTT_full_test/t2v_metrics/R1: 14.983277591973245
 MSRVTT_full_test/t2v_metrics/R5: 40.60200668896321
 MSRVTT_full_test/t2v_metrics/R10: 53.44481605351171
 MSRVTT_full_test/t2v_metrics/R50: 83.04347826086956
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 39.71705685618729
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.91684615578908
 MSRVTT_full_test/v2t_metrics/R1: 19.23076923076923
 MSRVTT_full_test/v2t_metrics/R5: 48.09364548494983
 MSRVTT_full_test/v2t_metrics/R10: 62.240802675585286
 MSRVTT_full_test/v2t_metrics/R50: 88.79598662207358
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.214715719063545
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.61178206897278
 mnt_best       : 32.02671384940022
 not_improved_count: 5
Train Epoch: 26 [1/250 128/32000 (0%)] Loss: 1.11032 (QuantReg: 15.17939) QuantErr: 15.17939 batch_time=34.41640 
Train Epoch: 26 [12/250 1536/32000 (5%)] Loss: 1.11175 (QuantReg: 15.07475) QuantErr: 15.07475 batch_time=0.58291 
Train Epoch: 26 [23/250 2944/32000 (9%)] Loss: 0.67147 (QuantReg: 15.40483) QuantErr: 15.40483 batch_time=0.59139 
Train Epoch: 26 [34/250 4352/32000 (14%)] Loss: 0.89869 (QuantReg: 15.36953) QuantErr: 15.36953 batch_time=0.59381 
Train Epoch: 26 [45/250 5760/32000 (18%)] Loss: 0.91369 (QuantReg: 15.37676) QuantErr: 15.37676 batch_time=0.59635 
Train Epoch: 26 [56/250 7168/32000 (22%)] Loss: 1.08419 (QuantReg: 15.30611) QuantErr: 15.30611 batch_time=0.59154 
Train Epoch: 26 [67/250 8576/32000 (27%)] Loss: 0.86737 (QuantReg: 15.44812) QuantErr: 15.44812 batch_time=0.81916 
Train Epoch: 26 [78/250 9984/32000 (31%)] Loss: 1.08941 (QuantReg: 15.42852) QuantErr: 15.42852 batch_time=0.60446 
Train Epoch: 26 [89/250 11392/32000 (36%)] Loss: 1.02876 (QuantReg: 15.31705) QuantErr: 15.31705 batch_time=0.63009 
Train Epoch: 26 [100/250 12800/32000 (40%)] Loss: 0.90945 (QuantReg: 15.21709) QuantErr: 15.21709 batch_time=0.59348 
Train Epoch: 26 [111/250 14208/32000 (44%)] Loss: 0.76239 (QuantReg: 15.46364) QuantErr: 15.46364 batch_time=0.59260 
Train Epoch: 26 [122/250 15616/32000 (49%)] Loss: 0.77021 (QuantReg: 15.32576) QuantErr: 15.32576 batch_time=0.59134 
Train Epoch: 26 [133/250 17024/32000 (53%)] Loss: 0.87781 (QuantReg: 15.23241) QuantErr: 15.23241 batch_time=0.63645 
Train Epoch: 26 [144/250 18432/32000 (58%)] Loss: 0.99044 (QuantReg: 15.32277) QuantErr: 15.32277 batch_time=0.60916 
Train Epoch: 26 [155/250 19840/32000 (62%)] Loss: 1.20768 (QuantReg: 15.13055) QuantErr: 15.13055 batch_time=0.92929 
Train Epoch: 26 [166/250 21248/32000 (66%)] Loss: 0.91704 (QuantReg: 15.34947) QuantErr: 15.34947 batch_time=0.60278 
Train Epoch: 26 [177/250 22656/32000 (71%)] Loss: 0.96837 (QuantReg: 15.20011) QuantErr: 15.20011 batch_time=0.59140 
Train Epoch: 26 [188/250 24064/32000 (75%)] Loss: 0.85862 (QuantReg: 15.43522) QuantErr: 15.43522 batch_time=0.59236 
Train Epoch: 26 [199/250 25472/32000 (80%)] Loss: 0.96488 (QuantReg: 15.44314) QuantErr: 15.44314 batch_time=0.60106 
Train Epoch: 26 [210/250 26880/32000 (84%)] Loss: 0.76360 (QuantReg: 15.48626) QuantErr: 15.48626 batch_time=1.71155 
Train Epoch: 26 [221/250 28288/32000 (88%)] Loss: 1.59295 (QuantReg: 15.29514) QuantErr: 15.29514 batch_time=0.63683 
Train Epoch: 26 [232/250 29696/32000 (93%)] Loss: 0.91475 (QuantReg: 15.50426) QuantErr: 15.50426 batch_time=0.59585 
Train Epoch: 26 [243/250 31104/32000 (97%)] Loss: 0.77956 (QuantReg: 15.41107) QuantErr: 15.41107 batch_time=0.59222 
Train Epoch: 26 codebook_update_time=3.92635
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch26.pth ...
Done in 3.796s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 0.9862366724014282
 quant_reg      : 15.344247226715089
 quant_err      : 15.344247226715089
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 36.82092555331992
 MSRVTT_full_val/t2v_metrics/R5: 72.63581488933602
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.002012072434606
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.573089569375064
 MSRVTT_full_val/v2t_metrics/R1: 42.857142857142854
 MSRVTT_full_val/v2t_metrics/R5: 81.89134808853119
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.744466800804829
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.83321042533456
 MSRVTT_full_test/t2v_metrics/R1: 14.247491638795987
 MSRVTT_full_test/t2v_metrics/R5: 39.364548494983275
 MSRVTT_full_test/t2v_metrics/R10: 52.876254180602004
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.15083612040134
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.952907911355034
 MSRVTT_full_test/v2t_metrics/R1: 19.096989966555185
 MSRVTT_full_test/v2t_metrics/R5: 47.290969899665555
 MSRVTT_full_test/v2t_metrics/R10: 61.90635451505017
 MSRVTT_full_test/v2t_metrics/R50: 88.36120401337793
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.046153846153846
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.237790594187345
 mnt_best       : 32.02671384940022
 not_improved_count: 6
Train Epoch: 27 [1/250 128/32000 (0%)] Loss: 0.73817 (QuantReg: 15.43239) QuantErr: 15.43239 batch_time=30.24794 
Train Epoch: 27 [12/250 1536/32000 (5%)] Loss: 1.15150 (QuantReg: 15.38450) QuantErr: 15.38450 batch_time=0.61310 
Train Epoch: 27 [23/250 2944/32000 (9%)] Loss: 0.94841 (QuantReg: 15.42733) QuantErr: 15.42733 batch_time=0.59308 
Train Epoch: 27 [34/250 4352/32000 (14%)] Loss: 0.88891 (QuantReg: 15.42086) QuantErr: 15.42086 batch_time=0.72470 
Train Epoch: 27 [45/250 5760/32000 (18%)] Loss: 0.89927 (QuantReg: 15.36655) QuantErr: 15.36655 batch_time=0.58699 
Train Epoch: 27 [56/250 7168/32000 (22%)] Loss: 0.68092 (QuantReg: 15.56444) QuantErr: 15.56444 batch_time=0.61561 
Train Epoch: 27 [67/250 8576/32000 (27%)] Loss: 0.79279 (QuantReg: 15.38021) QuantErr: 15.38021 batch_time=0.69812 
Train Epoch: 27 [78/250 9984/32000 (31%)] Loss: 0.80213 (QuantReg: 15.29189) QuantErr: 15.29189 batch_time=0.58772 
Train Epoch: 27 [89/250 11392/32000 (36%)] Loss: 0.85330 (QuantReg: 15.50883) QuantErr: 15.50883 batch_time=0.60694 
Train Epoch: 27 [100/250 12800/32000 (40%)] Loss: 0.98915 (QuantReg: 15.19600) QuantErr: 15.19600 batch_time=0.60210 
Train Epoch: 27 [111/250 14208/32000 (44%)] Loss: 0.85409 (QuantReg: 15.50654) QuantErr: 15.50654 batch_time=0.57808 
Train Epoch: 27 [122/250 15616/32000 (49%)] Loss: 0.98069 (QuantReg: 15.39998) QuantErr: 15.39998 batch_time=0.59023 
Train Epoch: 27 [133/250 17024/32000 (53%)] Loss: 0.98236 (QuantReg: 15.33530) QuantErr: 15.33530 batch_time=0.61105 
Train Epoch: 27 [144/250 18432/32000 (58%)] Loss: 0.75592 (QuantReg: 15.42188) QuantErr: 15.42188 batch_time=0.60734 
Train Epoch: 27 [155/250 19840/32000 (62%)] Loss: 0.83761 (QuantReg: 15.50424) QuantErr: 15.50424 batch_time=0.66360 
Train Epoch: 27 [166/250 21248/32000 (66%)] Loss: 1.04644 (QuantReg: 15.38826) QuantErr: 15.38826 batch_time=1.88665 
Train Epoch: 27 [177/250 22656/32000 (71%)] Loss: 1.19844 (QuantReg: 15.20205) QuantErr: 15.20205 batch_time=0.60560 
Train Epoch: 27 [188/250 24064/32000 (75%)] Loss: 0.90688 (QuantReg: 15.32485) QuantErr: 15.32485 batch_time=0.61259 
Train Epoch: 27 [199/250 25472/32000 (80%)] Loss: 1.14982 (QuantReg: 15.53422) QuantErr: 15.53422 batch_time=0.57841 
Train Epoch: 27 [210/250 26880/32000 (84%)] Loss: 0.83861 (QuantReg: 15.61992) QuantErr: 15.61992 batch_time=0.60333 
Train Epoch: 27 [221/250 28288/32000 (88%)] Loss: 0.85112 (QuantReg: 15.28086) QuantErr: 15.28086 batch_time=0.66084 
Train Epoch: 27 [232/250 29696/32000 (93%)] Loss: 0.87381 (QuantReg: 15.43054) QuantErr: 15.43054 batch_time=0.61487 
Train Epoch: 27 [243/250 31104/32000 (97%)] Loss: 0.90861 (QuantReg: 15.34826) QuantErr: 15.34826 batch_time=0.60430 
Train Epoch: 27 codebook_update_time=3.30560
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch27.pth ...
Done in 9.903s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch27.pth ...
Done in 13.447s
removing stale ckpt [epoch 26] [took 0.00s]
 epoch          : 27
 loss           : 0.9459475960731506
 quant_reg      : 15.360492031097412
 quant_err      : 15.360492031097412
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 6750
 MSRVTT_full_val/t2v_metrics/R1: 37.625754527162975
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.464788732394366
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.165946782173144
 MSRVTT_full_val/v2t_metrics/R1: 43.05835010060362
 MSRVTT_full_val/v2t_metrics/R5: 80.48289738430583
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.414486921529175
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.54744960024918
 MSRVTT_full_test/t2v_metrics/R1: 15.852842809364548
 MSRVTT_full_test/t2v_metrics/R5: 40.735785953177256
 MSRVTT_full_test/t2v_metrics/R10: 53.44481605351171
 MSRVTT_full_test/t2v_metrics/R50: 82.90969899665552
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.52173913043478
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.558391919742526
 MSRVTT_full_test/v2t_metrics/R1: 19.39799331103679
 MSRVTT_full_test/v2t_metrics/R5: 46.92307692307692
 MSRVTT_full_test/v2t_metrics/R10: 62.14046822742475
 MSRVTT_full_test/v2t_metrics/R50: 89.26421404682274
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.331772575250834
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.38597738394443
 mnt_best       : 32.558391919742526
 not_improved_count: 0
Train Epoch: 28 [1/250 128/32000 (0%)] Loss: 0.74035 (QuantReg: 15.29588) QuantErr: 15.29588 batch_time=29.59194 
Train Epoch: 28 [12/250 1536/32000 (5%)] Loss: 1.17426 (QuantReg: 15.33868) QuantErr: 15.33868 batch_time=0.70548 
Train Epoch: 28 [23/250 2944/32000 (9%)] Loss: 0.97746 (QuantReg: 15.14972) QuantErr: 15.14972 batch_time=0.57713 
Train Epoch: 28 [34/250 4352/32000 (14%)] Loss: 0.99499 (QuantReg: 15.44679) QuantErr: 15.44679 batch_time=0.61778 
Train Epoch: 28 [45/250 5760/32000 (18%)] Loss: 1.22004 (QuantReg: 15.17560) QuantErr: 15.17560 batch_time=0.64254 
Train Epoch: 28 [56/250 7168/32000 (22%)] Loss: 0.94808 (QuantReg: 15.48042) QuantErr: 15.48042 batch_time=0.59038 
Train Epoch: 28 [67/250 8576/32000 (27%)] Loss: 1.18462 (QuantReg: 15.32299) QuantErr: 15.32299 batch_time=0.58722 
Train Epoch: 28 [78/250 9984/32000 (31%)] Loss: 0.79803 (QuantReg: 15.53334) QuantErr: 15.53334 batch_time=1.16429 
Train Epoch: 28 [89/250 11392/32000 (36%)] Loss: 1.08994 (QuantReg: 15.28347) QuantErr: 15.28347 batch_time=0.60992 
Train Epoch: 28 [100/250 12800/32000 (40%)] Loss: 1.09163 (QuantReg: 15.28325) QuantErr: 15.28325 batch_time=0.62174 
Train Epoch: 28 [111/250 14208/32000 (44%)] Loss: 0.92597 (QuantReg: 15.40191) QuantErr: 15.40191 batch_time=0.59867 
Train Epoch: 28 [122/250 15616/32000 (49%)] Loss: 0.91148 (QuantReg: 15.48452) QuantErr: 15.48452 batch_time=0.58669 
Train Epoch: 28 [133/250 17024/32000 (53%)] Loss: 1.03959 (QuantReg: 15.40207) QuantErr: 15.40207 batch_time=0.59412 
Train Epoch: 28 [144/250 18432/32000 (58%)] Loss: 1.15208 (QuantReg: 15.14377) QuantErr: 15.14377 batch_time=0.58903 
Train Epoch: 28 [155/250 19840/32000 (62%)] Loss: 1.09398 (QuantReg: 15.40306) QuantErr: 15.40306 batch_time=2.16976 
Train Epoch: 28 [166/250 21248/32000 (66%)] Loss: 0.66420 (QuantReg: 15.28281) QuantErr: 15.28281 batch_time=0.59165 
Train Epoch: 28 [177/250 22656/32000 (71%)] Loss: 1.14254 (QuantReg: 15.39643) QuantErr: 15.39643 batch_time=0.72826 
Train Epoch: 28 [188/250 24064/32000 (75%)] Loss: 0.92070 (QuantReg: 15.33184) QuantErr: 15.33184 batch_time=1.27284 
Train Epoch: 28 [199/250 25472/32000 (80%)] Loss: 0.69551 (QuantReg: 15.43485) QuantErr: 15.43485 batch_time=0.59762 
Train Epoch: 28 [210/250 26880/32000 (84%)] Loss: 0.94657 (QuantReg: 15.54805) QuantErr: 15.54805 batch_time=0.61889 
Train Epoch: 28 [221/250 28288/32000 (88%)] Loss: 0.95025 (QuantReg: 15.25962) QuantErr: 15.25962 batch_time=0.59933 
Train Epoch: 28 [232/250 29696/32000 (93%)] Loss: 1.20420 (QuantReg: 15.27592) QuantErr: 15.27592 batch_time=0.59553 
Train Epoch: 28 [243/250 31104/32000 (97%)] Loss: 0.84066 (QuantReg: 15.49378) QuantErr: 15.49378 batch_time=0.59870 
Train Epoch: 28 codebook_update_time=3.24953
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch28.pth ...
Done in 3.785s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 0.9381308648586273
 quant_reg      : 15.37271427154541
 quant_err      : 15.37271427154541
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 74.04426559356136
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.438631790744467
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.75247202357022
 MSRVTT_full_val/v2t_metrics/R1: 44.265593561368206
 MSRVTT_full_val/v2t_metrics/R5: 81.08651911468813
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 99.3963782696177
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.420523138832998
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 68.18795936411375
 MSRVTT_full_test/t2v_metrics/R1: 14.983277591973245
 MSRVTT_full_test/t2v_metrics/R5: 39.79933110367893
 MSRVTT_full_test/t2v_metrics/R10: 53.47826086956522
 MSRVTT_full_test/t2v_metrics/R50: 82.47491638795987
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.843812709030104
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.711731672392435
 MSRVTT_full_test/v2t_metrics/R1: 19.39799331103679
 MSRVTT_full_test/v2t_metrics/R5: 48.09364548494983
 MSRVTT_full_test/v2t_metrics/R10: 62.74247491638796
 MSRVTT_full_test/v2t_metrics/R50: 88.69565217391305
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.505016722408026
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.827138321083886
 mnt_best       : 32.558391919742526
 not_improved_count: 1
Train Epoch: 29 [1/250 128/32000 (0%)] Loss: 1.00769 (QuantReg: 15.42087) QuantErr: 15.42087 batch_time=30.17250 
Train Epoch: 29 [12/250 1536/32000 (5%)] Loss: 1.02846 (QuantReg: 15.31777) QuantErr: 15.31777 batch_time=0.59511 
Train Epoch: 29 [23/250 2944/32000 (9%)] Loss: 1.17631 (QuantReg: 15.33931) QuantErr: 15.33931 batch_time=0.58648 
Train Epoch: 29 [34/250 4352/32000 (14%)] Loss: 0.96453 (QuantReg: 15.18975) QuantErr: 15.18975 batch_time=0.60253 
Train Epoch: 29 [45/250 5760/32000 (18%)] Loss: 0.89394 (QuantReg: 15.49976) QuantErr: 15.49976 batch_time=0.60580 
Train Epoch: 29 [56/250 7168/32000 (22%)] Loss: 0.99445 (QuantReg: 15.39774) QuantErr: 15.39774 batch_time=0.58625 
Train Epoch: 29 [67/250 8576/32000 (27%)] Loss: 0.95144 (QuantReg: 15.46140) QuantErr: 15.46140 batch_time=0.58261 
Train Epoch: 29 [78/250 9984/32000 (31%)] Loss: 1.06563 (QuantReg: 15.32695) QuantErr: 15.32695 batch_time=0.59253 
Train Epoch: 29 [89/250 11392/32000 (36%)] Loss: 0.74574 (QuantReg: 15.42592) QuantErr: 15.42592 batch_time=0.60959 
Train Epoch: 29 [100/250 12800/32000 (40%)] Loss: 0.73978 (QuantReg: 15.30532) QuantErr: 15.30532 batch_time=0.60245 
Train Epoch: 29 [111/250 14208/32000 (44%)] Loss: 1.13076 (QuantReg: 15.19446) QuantErr: 15.19446 batch_time=0.59152 
Train Epoch: 29 [122/250 15616/32000 (49%)] Loss: 0.81716 (QuantReg: 15.58328) QuantErr: 15.58328 batch_time=0.61067 
Train Epoch: 29 [133/250 17024/32000 (53%)] Loss: 1.10326 (QuantReg: 15.28040) QuantErr: 15.28040 batch_time=0.59270 
Train Epoch: 29 [144/250 18432/32000 (58%)] Loss: 0.90119 (QuantReg: 15.37842) QuantErr: 15.37842 batch_time=0.59339 
Train Epoch: 29 [155/250 19840/32000 (62%)] Loss: 0.88032 (QuantReg: 15.34591) QuantErr: 15.34591 batch_time=0.61772 
Train Epoch: 29 [166/250 21248/32000 (66%)] Loss: 0.82499 (QuantReg: 15.38669) QuantErr: 15.38669 batch_time=0.60177 
Train Epoch: 29 [177/250 22656/32000 (71%)] Loss: 1.06176 (QuantReg: 15.26884) QuantErr: 15.26884 batch_time=0.73230 
Train Epoch: 29 [188/250 24064/32000 (75%)] Loss: 0.83429 (QuantReg: 15.43486) QuantErr: 15.43486 batch_time=0.60554 
Train Epoch: 29 [199/250 25472/32000 (80%)] Loss: 0.99803 (QuantReg: 15.31226) QuantErr: 15.31226 batch_time=0.59550 
Train Epoch: 29 [210/250 26880/32000 (84%)] Loss: 0.75428 (QuantReg: 15.60915) QuantErr: 15.60915 batch_time=0.59305 
Train Epoch: 29 [221/250 28288/32000 (88%)] Loss: 0.79823 (QuantReg: 15.34841) QuantErr: 15.34841 batch_time=0.83285 
Train Epoch: 29 [232/250 29696/32000 (93%)] Loss: 0.93353 (QuantReg: 15.26192) QuantErr: 15.26192 batch_time=0.58849 
Train Epoch: 29 [243/250 31104/32000 (97%)] Loss: 0.72408 (QuantReg: 15.57938) QuantErr: 15.57938 batch_time=1.12751 
Train Epoch: 29 codebook_update_time=3.35263
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch29.pth ...
Done in 3.797s
removing stale ckpt [epoch 28] [took 0.00s]
 epoch          : 29
 loss           : 0.9343811099529267
 quant_reg      : 15.377557216644288
 quant_err      : 15.377557216644288
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 7250
 MSRVTT_full_val/t2v_metrics/R1: 39.03420523138833
 MSRVTT_full_val/t2v_metrics/R5: 74.04426559356136
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.484909456740443
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 62.260054002208975
 MSRVTT_full_val/v2t_metrics/R1: 44.46680080482897
 MSRVTT_full_val/v2t_metrics/R5: 80.6841046277666
 MSRVTT_full_val/v2t_metrics/R10: 89.738430583501
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.921529175050302
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 68.53842385353451
 MSRVTT_full_test/t2v_metrics/R1: 14.91638795986622
 MSRVTT_full_test/t2v_metrics/R5: 40.43478260869565
 MSRVTT_full_test/t2v_metrics/R10: 53.04347826086956
 MSRVTT_full_test/t2v_metrics/R50: 82.47491638795987
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.57859531772575
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.745603856725783
 MSRVTT_full_test/v2t_metrics/R1: 18.929765886287626
 MSRVTT_full_test/v2t_metrics/R5: 48.02675585284281
 MSRVTT_full_test/v2t_metrics/R10: 62.207357859531776
 MSRVTT_full_test/v2t_metrics/R50: 88.62876254180603
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.62608695652174
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.38457621260735
 mnt_best       : 32.558391919742526
 not_improved_count: 2
Train Epoch: 30 [1/250 128/32000 (0%)] Loss: 0.77602 (QuantReg: 15.31432) QuantErr: 15.31432 batch_time=26.00754 
Train Epoch: 30 [12/250 1536/32000 (5%)] Loss: 0.98537 (QuantReg: 15.31886) QuantErr: 15.31886 batch_time=0.81498 
Train Epoch: 30 [23/250 2944/32000 (9%)] Loss: 0.97417 (QuantReg: 15.33808) QuantErr: 15.33808 batch_time=0.59226 
Train Epoch: 30 [34/250 4352/32000 (14%)] Loss: 0.94328 (QuantReg: 15.25059) QuantErr: 15.25059 batch_time=0.59400 
Train Epoch: 30 [45/250 5760/32000 (18%)] Loss: 0.82891 (QuantReg: 15.38642) QuantErr: 15.38642 batch_time=0.58958 
Train Epoch: 30 [56/250 7168/32000 (22%)] Loss: 0.91371 (QuantReg: 15.59624) QuantErr: 15.59624 batch_time=0.59263 
Train Epoch: 30 [67/250 8576/32000 (27%)] Loss: 0.91775 (QuantReg: 15.34010) QuantErr: 15.34010 batch_time=0.59600 
Train Epoch: 30 [78/250 9984/32000 (31%)] Loss: 0.76414 (QuantReg: 15.52928) QuantErr: 15.52928 batch_time=0.59415 
Train Epoch: 30 [89/250 11392/32000 (36%)] Loss: 1.12678 (QuantReg: 15.29602) QuantErr: 15.29602 batch_time=1.57179 
Train Epoch: 30 [100/250 12800/32000 (40%)] Loss: 0.87923 (QuantReg: 15.49939) QuantErr: 15.49939 batch_time=0.59812 
Train Epoch: 30 [111/250 14208/32000 (44%)] Loss: 0.86167 (QuantReg: 15.31340) QuantErr: 15.31340 batch_time=0.61495 
Train Epoch: 30 [122/250 15616/32000 (49%)] Loss: 0.84392 (QuantReg: 15.37701) QuantErr: 15.37701 batch_time=0.58756 
Train Epoch: 30 [133/250 17024/32000 (53%)] Loss: 0.90529 (QuantReg: 15.47712) QuantErr: 15.47712 batch_time=0.60542 
Train Epoch: 30 [144/250 18432/32000 (58%)] Loss: 0.99233 (QuantReg: 15.26841) QuantErr: 15.26841 batch_time=0.58672 
Train Epoch: 30 [155/250 19840/32000 (62%)] Loss: 0.88583 (QuantReg: 15.50745) QuantErr: 15.50745 batch_time=0.58645 
Train Epoch: 30 [166/250 21248/32000 (66%)] Loss: 0.88668 (QuantReg: 15.44080) QuantErr: 15.44080 batch_time=0.59974 
Train Epoch: 30 [177/250 22656/32000 (71%)] Loss: 0.87184 (QuantReg: 15.38539) QuantErr: 15.38539 batch_time=0.61259 
Train Epoch: 30 [188/250 24064/32000 (75%)] Loss: 0.64511 (QuantReg: 15.51648) QuantErr: 15.51648 batch_time=0.59105 
Train Epoch: 30 [199/250 25472/32000 (80%)] Loss: 1.14573 (QuantReg: 15.33006) QuantErr: 15.33006 batch_time=0.59423 
Train Epoch: 30 [210/250 26880/32000 (84%)] Loss: 0.85594 (QuantReg: 15.39758) QuantErr: 15.39758 batch_time=0.59588 
Train Epoch: 30 [221/250 28288/32000 (88%)] Loss: 0.87406 (QuantReg: 15.53669) QuantErr: 15.53669 batch_time=0.64910 
Train Epoch: 30 [232/250 29696/32000 (93%)] Loss: 1.07476 (QuantReg: 15.46973) QuantErr: 15.46973 batch_time=0.64567 
Train Epoch: 30 [243/250 31104/32000 (97%)] Loss: 1.17037 (QuantReg: 15.49040) QuantErr: 15.49040 batch_time=0.59718 
Train Epoch: 30 codebook_update_time=3.74179
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch30.pth ...
Done in 3.730s
removing stale ckpt [epoch 29] [took 0.00s]
 epoch          : 30
 loss           : 0.8925696411132813
 quant_reg      : 15.40382553100586
 quant_err      : 15.40382553100586
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 84.10462776659959
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.76056338028169
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.8579232125976
 MSRVTT_full_val/v2t_metrics/R1: 45.070422535211264
 MSRVTT_full_val/v2t_metrics/R5: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.865191146881288
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 68.52641400353319
 MSRVTT_full_test/t2v_metrics/R1: 14.91638795986622
 MSRVTT_full_test/t2v_metrics/R5: 39.23076923076923
 MSRVTT_full_test/t2v_metrics/R10: 52.575250836120404
 MSRVTT_full_test/t2v_metrics/R50: 81.67224080267559
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.90401337792642
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.334585142416866
 MSRVTT_full_test/v2t_metrics/R1: 19.331103678929765
 MSRVTT_full_test/v2t_metrics/R5: 47.625418060200666
 MSRVTT_full_test/v2t_metrics/R10: 62.374581939799334
 MSRVTT_full_test/v2t_metrics/R50: 88.42809364548495
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.881270903010034
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.580486485287345
 mnt_best       : 32.558391919742526
 not_improved_count: 3
Train Epoch: 31 [1/250 128/32000 (0%)] Loss: 1.14182 (QuantReg: 15.37977) QuantErr: 15.37977 batch_time=32.31475 
Train Epoch: 31 [12/250 1536/32000 (5%)] Loss: 0.94159 (QuantReg: 15.39590) QuantErr: 15.39590 batch_time=0.59775 
Train Epoch: 31 [23/250 2944/32000 (9%)] Loss: 1.14731 (QuantReg: 15.30328) QuantErr: 15.30328 batch_time=0.60758 
Train Epoch: 31 [34/250 4352/32000 (14%)] Loss: 0.76905 (QuantReg: 15.31524) QuantErr: 15.31524 batch_time=0.59143 
Train Epoch: 31 [45/250 5760/32000 (18%)] Loss: 0.87892 (QuantReg: 15.21388) QuantErr: 15.21388 batch_time=0.66953 
Train Epoch: 31 [56/250 7168/32000 (22%)] Loss: 1.24479 (QuantReg: 14.95045) QuantErr: 14.95045 batch_time=0.59650 
Train Epoch: 31 [67/250 8576/32000 (27%)] Loss: 0.89718 (QuantReg: 15.36060) QuantErr: 15.36060 batch_time=0.58294 
Train Epoch: 31 [78/250 9984/32000 (31%)] Loss: 0.95218 (QuantReg: 15.40900) QuantErr: 15.40900 batch_time=0.60045 
Train Epoch: 31 [89/250 11392/32000 (36%)] Loss: 0.96030 (QuantReg: 15.39274) QuantErr: 15.39274 batch_time=0.60547 
Train Epoch: 31 [100/250 12800/32000 (40%)] Loss: 0.90592 (QuantReg: 15.27113) QuantErr: 15.27113 batch_time=0.59056 
Train Epoch: 31 [111/250 14208/32000 (44%)] Loss: 0.73402 (QuantReg: 15.43641) QuantErr: 15.43641 batch_time=0.58902 
Train Epoch: 31 [122/250 15616/32000 (49%)] Loss: 0.77252 (QuantReg: 15.35426) QuantErr: 15.35426 batch_time=0.59140 
Train Epoch: 31 [133/250 17024/32000 (53%)] Loss: 0.90259 (QuantReg: 15.48488) QuantErr: 15.48488 batch_time=0.59301 
Train Epoch: 31 [144/250 18432/32000 (58%)] Loss: 1.14014 (QuantReg: 15.48914) QuantErr: 15.48914 batch_time=4.72654 
Train Epoch: 31 [155/250 19840/32000 (62%)] Loss: 0.92046 (QuantReg: 15.35328) QuantErr: 15.35328 batch_time=0.59257 
Train Epoch: 31 [166/250 21248/32000 (66%)] Loss: 0.79264 (QuantReg: 15.17064) QuantErr: 15.17064 batch_time=0.62596 
Train Epoch: 31 [177/250 22656/32000 (71%)] Loss: 1.18581 (QuantReg: 15.21559) QuantErr: 15.21559 batch_time=0.59900 
Train Epoch: 31 [188/250 24064/32000 (75%)] Loss: 0.90534 (QuantReg: 15.57509) QuantErr: 15.57509 batch_time=0.58665 
Train Epoch: 31 [199/250 25472/32000 (80%)] Loss: 0.77064 (QuantReg: 15.45202) QuantErr: 15.45202 batch_time=0.59315 
Train Epoch: 31 [210/250 26880/32000 (84%)] Loss: 1.16425 (QuantReg: 15.35861) QuantErr: 15.35861 batch_time=0.58925 
Train Epoch: 31 [221/250 28288/32000 (88%)] Loss: 0.66653 (QuantReg: 15.65502) QuantErr: 15.65502 batch_time=0.62021 
Train Epoch: 31 [232/250 29696/32000 (93%)] Loss: 0.89792 (QuantReg: 15.36631) QuantErr: 15.36631 batch_time=0.60506 
Train Epoch: 31 [243/250 31104/32000 (97%)] Loss: 0.99590 (QuantReg: 15.43094) QuantErr: 15.43094 batch_time=0.60420 
Train Epoch: 31 codebook_update_time=3.37897
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch31.pth ...
Done in 18.821s
removing stale ckpt [epoch 30] [took 0.01s]
 epoch          : 31
 loss           : 0.9105083272457123
 quant_reg      : 15.399879333496093
 quant_err      : 15.399879333496093
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 7750
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 74.04426559356136
 MSRVTT_full_val/t2v_metrics/R10: 84.70824949698189
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.344064386317908
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.241249844278144
 MSRVTT_full_val/v2t_metrics/R1: 43.46076458752515
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 89.13480885311871
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.370221327967807
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.581500851321
 MSRVTT_full_test/t2v_metrics/R1: 15.852842809364548
 MSRVTT_full_test/t2v_metrics/R5: 40.635451505016725
 MSRVTT_full_test/t2v_metrics/R10: 53.31103678929766
 MSRVTT_full_test/t2v_metrics/R50: 82.8428093645485
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 38.84548494983277
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.50447260697685
 MSRVTT_full_test/v2t_metrics/R1: 19.23076923076923
 MSRVTT_full_test/v2t_metrics/R5: 48.06020066889632
 MSRVTT_full_test/v2t_metrics/R10: 62.508361204013376
 MSRVTT_full_test/v2t_metrics/R50: 88.96321070234114
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.451839464882944
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.65806539635499
 mnt_best       : 32.558391919742526
 not_improved_count: 4
Train Epoch: 32 [1/250 128/32000 (0%)] Loss: 0.63152 (QuantReg: 15.53204) QuantErr: 15.53204 batch_time=31.06960 
Train Epoch: 32 [12/250 1536/32000 (5%)] Loss: 0.98121 (QuantReg: 15.48776) QuantErr: 15.48776 batch_time=0.58821 
Train Epoch: 32 [23/250 2944/32000 (9%)] Loss: 0.88981 (QuantReg: 15.35884) QuantErr: 15.35884 batch_time=0.64368 
Train Epoch: 32 [34/250 4352/32000 (14%)] Loss: 0.82571 (QuantReg: 15.61252) QuantErr: 15.61252 batch_time=0.59287 
Train Epoch: 32 [45/250 5760/32000 (18%)] Loss: 0.59305 (QuantReg: 15.56518) QuantErr: 15.56518 batch_time=0.63000 
Train Epoch: 32 [56/250 7168/32000 (22%)] Loss: 0.92083 (QuantReg: 15.24004) QuantErr: 15.24004 batch_time=0.70533 
Train Epoch: 32 [67/250 8576/32000 (27%)] Loss: 0.60803 (QuantReg: 15.53715) QuantErr: 15.53715 batch_time=0.59631 
Train Epoch: 32 [78/250 9984/32000 (31%)] Loss: 0.84793 (QuantReg: 15.37345) QuantErr: 15.37345 batch_time=0.59427 
Train Epoch: 32 [89/250 11392/32000 (36%)] Loss: 1.01630 (QuantReg: 15.38895) QuantErr: 15.38895 batch_time=0.59627 
Train Epoch: 32 [100/250 12800/32000 (40%)] Loss: 0.81442 (QuantReg: 15.31014) QuantErr: 15.31014 batch_time=0.58398 
Train Epoch: 32 [111/250 14208/32000 (44%)] Loss: 0.96822 (QuantReg: 15.70512) QuantErr: 15.70512 batch_time=0.57461 
Train Epoch: 32 [122/250 15616/32000 (49%)] Loss: 0.68494 (QuantReg: 15.36609) QuantErr: 15.36609 batch_time=0.84769 
Train Epoch: 32 [133/250 17024/32000 (53%)] Loss: 0.94783 (QuantReg: 15.40663) QuantErr: 15.40663 batch_time=0.58768 
Train Epoch: 32 [144/250 18432/32000 (58%)] Loss: 0.89785 (QuantReg: 15.40083) QuantErr: 15.40083 batch_time=0.85472 
Train Epoch: 32 [155/250 19840/32000 (62%)] Loss: 0.69897 (QuantReg: 15.48208) QuantErr: 15.48208 batch_time=0.58702 
Train Epoch: 32 [166/250 21248/32000 (66%)] Loss: 0.86438 (QuantReg: 15.63037) QuantErr: 15.63037 batch_time=0.58789 
Train Epoch: 32 [177/250 22656/32000 (71%)] Loss: 0.91387 (QuantReg: 15.49872) QuantErr: 15.49872 batch_time=0.95111 
Train Epoch: 32 [188/250 24064/32000 (75%)] Loss: 1.04299 (QuantReg: 15.57164) QuantErr: 15.57164 batch_time=0.84332 
Train Epoch: 32 [199/250 25472/32000 (80%)] Loss: 0.85179 (QuantReg: 15.44979) QuantErr: 15.44979 batch_time=0.62122 
Train Epoch: 32 [210/250 26880/32000 (84%)] Loss: 1.07572 (QuantReg: 15.50991) QuantErr: 15.50991 batch_time=2.94431 
Train Epoch: 32 [221/250 28288/32000 (88%)] Loss: 0.77407 (QuantReg: 15.56474) QuantErr: 15.56474 batch_time=0.59922 
Train Epoch: 32 [232/250 29696/32000 (93%)] Loss: 0.90275 (QuantReg: 15.29018) QuantErr: 15.29018 batch_time=0.93184 
Train Epoch: 32 [243/250 31104/32000 (97%)] Loss: 0.70685 (QuantReg: 15.59491) QuantErr: 15.59491 batch_time=0.60556 
Train Epoch: 32 codebook_update_time=3.34671
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch32.pth ...
Done in 21.047s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch32.pth ...
Done in 24.796s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 0.8734686081409454
 quant_reg      : 15.427351612091064
 quant_err      : 15.427351612091064
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 37.82696177062374
 MSRVTT_full_val/t2v_metrics/R5: 73.64185110663983
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.724346076458753
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.54900450400454
 MSRVTT_full_val/v2t_metrics/R1: 44.668008048289735
 MSRVTT_full_val/v2t_metrics/R5: 79.07444668008048
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.4607645875251505
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.7203611001814
 MSRVTT_full_test/t2v_metrics/R1: 15.919732441471572
 MSRVTT_full_test/t2v_metrics/R5: 40.702341137123746
 MSRVTT_full_test/t2v_metrics/R10: 53.979933110367895
 MSRVTT_full_test/t2v_metrics/R50: 83.04347826086956
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 39.41304347826087
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.70362032092116
 MSRVTT_full_test/v2t_metrics/R1: 19.19732441471572
 MSRVTT_full_test/v2t_metrics/R5: 48.39464882943144
 MSRVTT_full_test/v2t_metrics/R10: 62.675585284280935
 MSRVTT_full_test/v2t_metrics/R50: 88.56187290969899
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.735117056856186
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.75955792523508
 mnt_best       : 32.70362032092116
 not_improved_count: 0
Train Epoch: 33 [1/250 128/32000 (0%)] Loss: 0.85697 (QuantReg: 15.58521) QuantErr: 15.58521 batch_time=30.25848 
Train Epoch: 33 [12/250 1536/32000 (5%)] Loss: 0.75252 (QuantReg: 15.25505) QuantErr: 15.25505 batch_time=0.79788 
Train Epoch: 33 [23/250 2944/32000 (9%)] Loss: 0.97256 (QuantReg: 15.63364) QuantErr: 15.63364 batch_time=0.74124 
Train Epoch: 33 [34/250 4352/32000 (14%)] Loss: 0.69756 (QuantReg: 15.03678) QuantErr: 15.03678 batch_time=0.60425 
Train Epoch: 33 [45/250 5760/32000 (18%)] Loss: 0.83742 (QuantReg: 15.53674) QuantErr: 15.53674 batch_time=0.58912 
Train Epoch: 33 [56/250 7168/32000 (22%)] Loss: 0.87139 (QuantReg: 15.46786) QuantErr: 15.46786 batch_time=0.92703 
Train Epoch: 33 [67/250 8576/32000 (27%)] Loss: 1.07522 (QuantReg: 15.25286) QuantErr: 15.25286 batch_time=1.39770 
Train Epoch: 33 [78/250 9984/32000 (31%)] Loss: 0.88070 (QuantReg: 15.21353) QuantErr: 15.21353 batch_time=0.59877 
Train Epoch: 33 [89/250 11392/32000 (36%)] Loss: 0.89859 (QuantReg: 15.20566) QuantErr: 15.20566 batch_time=0.80945 
Train Epoch: 33 [100/250 12800/32000 (40%)] Loss: 0.87977 (QuantReg: 15.24051) QuantErr: 15.24051 batch_time=0.58090 
Train Epoch: 33 [111/250 14208/32000 (44%)] Loss: 0.96585 (QuantReg: 15.38937) QuantErr: 15.38937 batch_time=0.67453 
Train Epoch: 33 [122/250 15616/32000 (49%)] Loss: 0.79553 (QuantReg: 15.41584) QuantErr: 15.41584 batch_time=0.60693 
Train Epoch: 33 [133/250 17024/32000 (53%)] Loss: 1.20214 (QuantReg: 15.25735) QuantErr: 15.25735 batch_time=0.60283 
Train Epoch: 33 [144/250 18432/32000 (58%)] Loss: 0.94739 (QuantReg: 15.41710) QuantErr: 15.41710 batch_time=0.59468 
Train Epoch: 33 [155/250 19840/32000 (62%)] Loss: 0.75980 (QuantReg: 15.18596) QuantErr: 15.18596 batch_time=0.58757 
Train Epoch: 33 [166/250 21248/32000 (66%)] Loss: 0.83226 (QuantReg: 15.53475) QuantErr: 15.53475 batch_time=0.58619 
Train Epoch: 33 [177/250 22656/32000 (71%)] Loss: 0.74740 (QuantReg: 15.49303) QuantErr: 15.49303 batch_time=0.58241 
Train Epoch: 33 [188/250 24064/32000 (75%)] Loss: 1.00194 (QuantReg: 15.49979) QuantErr: 15.49979 batch_time=0.59659 
Train Epoch: 33 [199/250 25472/32000 (80%)] Loss: 0.84037 (QuantReg: 15.25163) QuantErr: 15.25163 batch_time=0.59829 
Train Epoch: 33 [210/250 26880/32000 (84%)] Loss: 0.87100 (QuantReg: 15.55409) QuantErr: 15.55409 batch_time=1.59185 
Train Epoch: 33 [221/250 28288/32000 (88%)] Loss: 1.18366 (QuantReg: 15.20781) QuantErr: 15.20781 batch_time=0.59150 
Train Epoch: 33 [232/250 29696/32000 (93%)] Loss: 0.76031 (QuantReg: 15.39746) QuantErr: 15.39746 batch_time=0.95020 
Train Epoch: 33 [243/250 31104/32000 (97%)] Loss: 0.84105 (QuantReg: 15.45458) QuantErr: 15.45458 batch_time=0.74356 
Train Epoch: 33 codebook_update_time=3.26254
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch33.pth ...
Done in 3.930s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch33.pth ...
Done in 7.580s
removing stale ckpt [epoch 32] [took 0.01s]
 epoch          : 33
 loss           : 0.863114496231079
 quant_reg      : 15.409527053833008
 quant_err      : 15.409527053833008
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 8250
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 84.10462776659959
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.754527162977867
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.09361234054113
 MSRVTT_full_val/v2t_metrics/R1: 43.66197183098591
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.704225352112676
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.26504062349497
 MSRVTT_full_test/t2v_metrics/R1: 16.02006688963211
 MSRVTT_full_test/t2v_metrics/R5: 40.96989966555184
 MSRVTT_full_test/t2v_metrics/R10: 54.247491638795985
 MSRVTT_full_test/t2v_metrics/R50: 83.01003344481606
 MSRVTT_full_test/t2v_metrics/MedR: 8.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.47926421404682
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.89801005500416
 MSRVTT_full_test/v2t_metrics/R1: 19.163879598662206
 MSRVTT_full_test/v2t_metrics/R5: 48.26086956521739
 MSRVTT_full_test/v2t_metrics/R10: 62.94314381270903
 MSRVTT_full_test/v2t_metrics/R50: 88.69565217391305
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.649498327759197
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.75630238680506
 mnt_best       : 32.89801005500416
 not_improved_count: 0
Train Epoch: 34 [1/250 128/32000 (0%)] Loss: 0.76533 (QuantReg: 15.50362) QuantErr: 15.50362 batch_time=29.34818 
Train Epoch: 34 [12/250 1536/32000 (5%)] Loss: 0.76218 (QuantReg: 15.43377) QuantErr: 15.43377 batch_time=0.61055 
Train Epoch: 34 [23/250 2944/32000 (9%)] Loss: 0.83642 (QuantReg: 15.45991) QuantErr: 15.45991 batch_time=0.59141 
Train Epoch: 34 [34/250 4352/32000 (14%)] Loss: 0.87295 (QuantReg: 15.43831) QuantErr: 15.43831 batch_time=0.90335 
Train Epoch: 34 [45/250 5760/32000 (18%)] Loss: 0.92650 (QuantReg: 15.47332) QuantErr: 15.47332 batch_time=0.59577 
Train Epoch: 34 [56/250 7168/32000 (22%)] Loss: 0.88182 (QuantReg: 15.28881) QuantErr: 15.28881 batch_time=0.58945 
Train Epoch: 34 [67/250 8576/32000 (27%)] Loss: 0.88797 (QuantReg: 15.32293) QuantErr: 15.32293 batch_time=0.59633 
Train Epoch: 34 [78/250 9984/32000 (31%)] Loss: 1.15297 (QuantReg: 15.27552) QuantErr: 15.27552 batch_time=0.63203 
Train Epoch: 34 [89/250 11392/32000 (36%)] Loss: 0.97142 (QuantReg: 15.38314) QuantErr: 15.38314 batch_time=0.59166 
Train Epoch: 34 [100/250 12800/32000 (40%)] Loss: 1.21387 (QuantReg: 15.26392) QuantErr: 15.26392 batch_time=1.55443 
Train Epoch: 34 [111/250 14208/32000 (44%)] Loss: 1.04232 (QuantReg: 15.04501) QuantErr: 15.04501 batch_time=0.57920 
Train Epoch: 34 [122/250 15616/32000 (49%)] Loss: 0.88012 (QuantReg: 15.31397) QuantErr: 15.31397 batch_time=0.58921 
Train Epoch: 34 [133/250 17024/32000 (53%)] Loss: 0.89695 (QuantReg: 15.47485) QuantErr: 15.47485 batch_time=0.58400 
Train Epoch: 34 [144/250 18432/32000 (58%)] Loss: 0.90480 (QuantReg: 15.26044) QuantErr: 15.26044 batch_time=0.61072 
Train Epoch: 34 [155/250 19840/32000 (62%)] Loss: 0.81228 (QuantReg: 15.68043) QuantErr: 15.68043 batch_time=0.59260 
Train Epoch: 34 [166/250 21248/32000 (66%)] Loss: 0.98689 (QuantReg: 15.18907) QuantErr: 15.18907 batch_time=0.59673 
Train Epoch: 34 [177/250 22656/32000 (71%)] Loss: 0.78955 (QuantReg: 15.47470) QuantErr: 15.47470 batch_time=0.58766 
Train Epoch: 34 [188/250 24064/32000 (75%)] Loss: 0.99560 (QuantReg: 15.27262) QuantErr: 15.27262 batch_time=0.58955 
Train Epoch: 34 [199/250 25472/32000 (80%)] Loss: 0.68943 (QuantReg: 15.33981) QuantErr: 15.33981 batch_time=0.59417 
Train Epoch: 34 [210/250 26880/32000 (84%)] Loss: 0.90808 (QuantReg: 15.35094) QuantErr: 15.35094 batch_time=0.59422 
Train Epoch: 34 [221/250 28288/32000 (88%)] Loss: 0.74908 (QuantReg: 15.49598) QuantErr: 15.49598 batch_time=0.59351 
Train Epoch: 34 [232/250 29696/32000 (93%)] Loss: 0.70754 (QuantReg: 15.46389) QuantErr: 15.46389 batch_time=0.59353 
Train Epoch: 34 [243/250 31104/32000 (97%)] Loss: 1.06387 (QuantReg: 15.47831) QuantErr: 15.47831 batch_time=0.59901 
Train Epoch: 34 codebook_update_time=3.35080
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch34.pth ...
Done in 14.203s
removing stale ckpt [epoch 33] [took 0.03s]
 epoch          : 34
 loss           : 0.8865052666664124
 quant_reg      : 15.398958126068115
 quant_err      : 15.398958126068115
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 36.01609657947686
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.7283702213279675
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.61407780209277
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 80.88531187122736
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.45271629778672
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.0273346287488
 MSRVTT_full_test/t2v_metrics/R1: 15.050167224080267
 MSRVTT_full_test/t2v_metrics/R5: 39.197324414715716
 MSRVTT_full_test/t2v_metrics/R10: 52.642140468227424
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.323076923076925
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.432367692851308
 MSRVTT_full_test/v2t_metrics/R1: 18.729096989966557
 MSRVTT_full_test/v2t_metrics/R5: 48.36120401337793
 MSRVTT_full_test/v2t_metrics/R10: 62.240802675585286
 MSRVTT_full_test/v2t_metrics/R50: 88.26086956521739
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.972909698996656
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.34390818320665
 mnt_best       : 32.89801005500416
 not_improved_count: 1
Train Epoch: 35 [1/250 128/32000 (0%)] Loss: 0.84598 (QuantReg: 15.40401) QuantErr: 15.40401 batch_time=30.09019 
Train Epoch: 35 [12/250 1536/32000 (5%)] Loss: 0.88941 (QuantReg: 15.38179) QuantErr: 15.38179 batch_time=0.65502 
Train Epoch: 35 [23/250 2944/32000 (9%)] Loss: 0.97048 (QuantReg: 15.35728) QuantErr: 15.35728 batch_time=0.58801 
Train Epoch: 35 [34/250 4352/32000 (14%)] Loss: 0.98382 (QuantReg: 15.50109) QuantErr: 15.50109 batch_time=0.59321 
Train Epoch: 35 [45/250 5760/32000 (18%)] Loss: 0.94358 (QuantReg: 15.43528) QuantErr: 15.43528 batch_time=0.58809 
Train Epoch: 35 [56/250 7168/32000 (22%)] Loss: 0.76027 (QuantReg: 15.40920) QuantErr: 15.40920 batch_time=0.61357 
Train Epoch: 35 [67/250 8576/32000 (27%)] Loss: 0.73877 (QuantReg: 15.63603) QuantErr: 15.63603 batch_time=0.59727 
Train Epoch: 35 [78/250 9984/32000 (31%)] Loss: 1.14860 (QuantReg: 15.46154) QuantErr: 15.46154 batch_time=0.58786 
Train Epoch: 35 [89/250 11392/32000 (36%)] Loss: 0.89304 (QuantReg: 15.44486) QuantErr: 15.44486 batch_time=0.58860 
Train Epoch: 35 [100/250 12800/32000 (40%)] Loss: 0.94880 (QuantReg: 15.47177) QuantErr: 15.47177 batch_time=0.59130 
Train Epoch: 35 [111/250 14208/32000 (44%)] Loss: 0.91373 (QuantReg: 15.29498) QuantErr: 15.29498 batch_time=0.59319 
Train Epoch: 35 [122/250 15616/32000 (49%)] Loss: 0.85814 (QuantReg: 15.31019) QuantErr: 15.31019 batch_time=0.58719 
Train Epoch: 35 [133/250 17024/32000 (53%)] Loss: 1.20653 (QuantReg: 15.22142) QuantErr: 15.22142 batch_time=0.58798 
Train Epoch: 35 [144/250 18432/32000 (58%)] Loss: 0.74927 (QuantReg: 15.65237) QuantErr: 15.65237 batch_time=0.59188 
Train Epoch: 35 [155/250 19840/32000 (62%)] Loss: 0.82780 (QuantReg: 15.31542) QuantErr: 15.31542 batch_time=0.59022 
Train Epoch: 35 [166/250 21248/32000 (66%)] Loss: 1.01890 (QuantReg: 15.42821) QuantErr: 15.42821 batch_time=0.59413 
Train Epoch: 35 [177/250 22656/32000 (71%)] Loss: 0.77065 (QuantReg: 15.77958) QuantErr: 15.77958 batch_time=0.82925 
Train Epoch: 35 [188/250 24064/32000 (75%)] Loss: 0.73109 (QuantReg: 15.21860) QuantErr: 15.21860 batch_time=0.59933 
Train Epoch: 35 [199/250 25472/32000 (80%)] Loss: 0.76669 (QuantReg: 15.57660) QuantErr: 15.57660 batch_time=0.59288 
Train Epoch: 35 [210/250 26880/32000 (84%)] Loss: 0.71046 (QuantReg: 15.53314) QuantErr: 15.53314 batch_time=2.77845 
Train Epoch: 35 [221/250 28288/32000 (88%)] Loss: 0.80869 (QuantReg: 15.51838) QuantErr: 15.51838 batch_time=0.61362 
Train Epoch: 35 [232/250 29696/32000 (93%)] Loss: 0.74135 (QuantReg: 15.54952) QuantErr: 15.54952 batch_time=0.58239 
Train Epoch: 35 [243/250 31104/32000 (97%)] Loss: 0.74790 (QuantReg: 15.57653) QuantErr: 15.57653 batch_time=0.60006 
Train Epoch: 35 codebook_update_time=3.28985
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch35.pth ...
Done in 13.808s
removing stale ckpt [epoch 34] [took 0.08s]
 epoch          : 35
 loss           : 0.846410085439682
 quant_reg      : 15.42511190032959
 quant_err      : 15.42511190032959
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 8750
 MSRVTT_full_val/t2v_metrics/R1: 37.42454728370221
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.929577464788732
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.53641583641775
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 79.87927565392354
 MSRVTT_full_val/v2t_metrics/R10: 88.73239436619718
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.796780684104628
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.79881199806911
 MSRVTT_full_test/t2v_metrics/R1: 14.949832775919733
 MSRVTT_full_test/t2v_metrics/R5: 39.66555183946488
 MSRVTT_full_test/t2v_metrics/R10: 52.94314381270903
 MSRVTT_full_test/t2v_metrics/R50: 81.77257525083613
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.857859531772576
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.546645634051107
 MSRVTT_full_test/v2t_metrics/R1: 19.23076923076923
 MSRVTT_full_test/v2t_metrics/R5: 47.82608695652174
 MSRVTT_full_test/v2t_metrics/R10: 61.90635451505017
 MSRVTT_full_test/v2t_metrics/R50: 88.36120401337793
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.827759197324415
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.47089104146
 mnt_best       : 32.89801005500416
 not_improved_count: 2
Train Epoch: 36 [1/250 128/32000 (0%)] Loss: 0.76375 (QuantReg: 15.29588) QuantErr: 15.29588 batch_time=34.99472 
Train Epoch: 36 [12/250 1536/32000 (5%)] Loss: 0.97960 (QuantReg: 15.48880) QuantErr: 15.48880 batch_time=0.59273 
Train Epoch: 36 [23/250 2944/32000 (9%)] Loss: 0.59335 (QuantReg: 15.27761) QuantErr: 15.27761 batch_time=0.59591 
Train Epoch: 36 [34/250 4352/32000 (14%)] Loss: 0.79110 (QuantReg: 15.37604) QuantErr: 15.37604 batch_time=0.59865 
Train Epoch: 36 [45/250 5760/32000 (18%)] Loss: 0.88108 (QuantReg: 15.48383) QuantErr: 15.48383 batch_time=0.62136 
Train Epoch: 36 [56/250 7168/32000 (22%)] Loss: 0.62526 (QuantReg: 15.28129) QuantErr: 15.28129 batch_time=0.58791 
Train Epoch: 36 [67/250 8576/32000 (27%)] Loss: 0.84211 (QuantReg: 15.59249) QuantErr: 15.59249 batch_time=0.59002 
Train Epoch: 36 [78/250 9984/32000 (31%)] Loss: 0.92434 (QuantReg: 15.47830) QuantErr: 15.47830 batch_time=0.60996 
Train Epoch: 36 [89/250 11392/32000 (36%)] Loss: 0.96618 (QuantReg: 15.32841) QuantErr: 15.32841 batch_time=0.60987 
Train Epoch: 36 [100/250 12800/32000 (40%)] Loss: 0.87465 (QuantReg: 15.46041) QuantErr: 15.46041 batch_time=0.59244 
Train Epoch: 36 [111/250 14208/32000 (44%)] Loss: 1.04797 (QuantReg: 15.27941) QuantErr: 15.27941 batch_time=0.60139 
Train Epoch: 36 [122/250 15616/32000 (49%)] Loss: 0.99401 (QuantReg: 15.44156) QuantErr: 15.44156 batch_time=0.60350 
Train Epoch: 36 [133/250 17024/32000 (53%)] Loss: 0.81931 (QuantReg: 15.28707) QuantErr: 15.28707 batch_time=0.57856 
Train Epoch: 36 [144/250 18432/32000 (58%)] Loss: 0.88949 (QuantReg: 15.50023) QuantErr: 15.50023 batch_time=2.33182 
Train Epoch: 36 [155/250 19840/32000 (62%)] Loss: 0.67990 (QuantReg: 15.46247) QuantErr: 15.46247 batch_time=0.60169 
Train Epoch: 36 [166/250 21248/32000 (66%)] Loss: 0.96055 (QuantReg: 15.41287) QuantErr: 15.41287 batch_time=0.59279 
Train Epoch: 36 [177/250 22656/32000 (71%)] Loss: 0.94930 (QuantReg: 15.44985) QuantErr: 15.44985 batch_time=0.59367 
Train Epoch: 36 [188/250 24064/32000 (75%)] Loss: 0.64192 (QuantReg: 15.47770) QuantErr: 15.47770 batch_time=1.01904 
Train Epoch: 36 [199/250 25472/32000 (80%)] Loss: 0.71415 (QuantReg: 15.42959) QuantErr: 15.42959 batch_time=0.58834 
Train Epoch: 36 [210/250 26880/32000 (84%)] Loss: 0.96155 (QuantReg: 15.36881) QuantErr: 15.36881 batch_time=0.58378 
Train Epoch: 36 [221/250 28288/32000 (88%)] Loss: 0.98132 (QuantReg: 15.19186) QuantErr: 15.19186 batch_time=0.59251 
Train Epoch: 36 [232/250 29696/32000 (93%)] Loss: 0.87001 (QuantReg: 15.31406) QuantErr: 15.31406 batch_time=0.59551 
Train Epoch: 36 [243/250 31104/32000 (97%)] Loss: 0.71276 (QuantReg: 15.21660) QuantErr: 15.21660 batch_time=0.60013 
Train Epoch: 36 codebook_update_time=3.34844
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch36.pth ...
Done in 6.549s
removing stale ckpt [epoch 35] [took 0.01s]
 epoch          : 36
 loss           : 0.8409216692447662
 quant_reg      : 15.43960514831543
 quant_err      : 15.43960514831543
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 37.02213279678068
 MSRVTT_full_val/t2v_metrics/R5: 72.63581488933602
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.9396378269617705
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.3879225412152
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 79.87927565392354
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.653923541247485
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.06613713882638
 MSRVTT_full_test/t2v_metrics/R1: 15.284280936454849
 MSRVTT_full_test/t2v_metrics/R5: 40.50167224080268
 MSRVTT_full_test/t2v_metrics/R10: 54.68227424749164
 MSRVTT_full_test/t2v_metrics/R50: 82.07357859531773
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.666220735785956
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.348551978991054
 MSRVTT_full_test/v2t_metrics/R1: 18.929765886287626
 MSRVTT_full_test/v2t_metrics/R5: 47.82608695652174
 MSRVTT_full_test/v2t_metrics/R10: 62.14046822742475
 MSRVTT_full_test/v2t_metrics/R50: 88.42809364548495
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.075585284280937
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.317297517686576
 mnt_best       : 32.89801005500416
 not_improved_count: 3
Train Epoch: 37 [1/250 128/32000 (0%)] Loss: 0.86258 (QuantReg: 15.47318) QuantErr: 15.47318 batch_time=27.54137 
Train Epoch: 37 [12/250 1536/32000 (5%)] Loss: 0.68683 (QuantReg: 15.45095) QuantErr: 15.45095 batch_time=0.59008 
Train Epoch: 37 [23/250 2944/32000 (9%)] Loss: 0.87066 (QuantReg: 15.29541) QuantErr: 15.29541 batch_time=0.60166 
Train Epoch: 37 [34/250 4352/32000 (14%)] Loss: 0.75465 (QuantReg: 15.43195) QuantErr: 15.43195 batch_time=0.59336 
Train Epoch: 37 [45/250 5760/32000 (18%)] Loss: 0.82216 (QuantReg: 15.43571) QuantErr: 15.43571 batch_time=0.58843 
Train Epoch: 37 [56/250 7168/32000 (22%)] Loss: 1.01870 (QuantReg: 15.23832) QuantErr: 15.23832 batch_time=0.58818 
Train Epoch: 37 [67/250 8576/32000 (27%)] Loss: 1.05835 (QuantReg: 15.42187) QuantErr: 15.42187 batch_time=0.59599 
Train Epoch: 37 [78/250 9984/32000 (31%)] Loss: 0.72359 (QuantReg: 15.34700) QuantErr: 15.34700 batch_time=0.59145 
Train Epoch: 37 [89/250 11392/32000 (36%)] Loss: 0.83047 (QuantReg: 15.47188) QuantErr: 15.47188 batch_time=0.59935 
Train Epoch: 37 [100/250 12800/32000 (40%)] Loss: 0.70580 (QuantReg: 15.24389) QuantErr: 15.24389 batch_time=0.60187 
Train Epoch: 37 [111/250 14208/32000 (44%)] Loss: 0.78905 (QuantReg: 15.47019) QuantErr: 15.47019 batch_time=0.60202 
Train Epoch: 37 [122/250 15616/32000 (49%)] Loss: 0.79042 (QuantReg: 15.42715) QuantErr: 15.42715 batch_time=0.60163 
Train Epoch: 37 [133/250 17024/32000 (53%)] Loss: 0.88268 (QuantReg: 15.32528) QuantErr: 15.32528 batch_time=0.60897 
Train Epoch: 37 [144/250 18432/32000 (58%)] Loss: 1.07556 (QuantReg: 15.19686) QuantErr: 15.19686 batch_time=0.59639 
Train Epoch: 37 [155/250 19840/32000 (62%)] Loss: 0.79009 (QuantReg: 15.34998) QuantErr: 15.34998 batch_time=0.62492 
Train Epoch: 37 [166/250 21248/32000 (66%)] Loss: 0.88102 (QuantReg: 15.35534) QuantErr: 15.35534 batch_time=0.60043 
Train Epoch: 37 [177/250 22656/32000 (71%)] Loss: 0.95448 (QuantReg: 15.54667) QuantErr: 15.54667 batch_time=0.58972 
Train Epoch: 37 [188/250 24064/32000 (75%)] Loss: 0.95438 (QuantReg: 15.27509) QuantErr: 15.27509 batch_time=0.60619 
Train Epoch: 37 [199/250 25472/32000 (80%)] Loss: 0.80663 (QuantReg: 15.54023) QuantErr: 15.54023 batch_time=0.63444 
Train Epoch: 37 [210/250 26880/32000 (84%)] Loss: 0.95215 (QuantReg: 15.41453) QuantErr: 15.41453 batch_time=1.17806 
Train Epoch: 37 [221/250 28288/32000 (88%)] Loss: 0.76771 (QuantReg: 15.74652) QuantErr: 15.74652 batch_time=0.60186 
Train Epoch: 37 [232/250 29696/32000 (93%)] Loss: 1.15022 (QuantReg: 15.25772) QuantErr: 15.25772 batch_time=0.59469 
Train Epoch: 37 [243/250 31104/32000 (97%)] Loss: 0.73577 (QuantReg: 15.57373) QuantErr: 15.57373 batch_time=0.59813 
Train Epoch: 37 codebook_update_time=3.21302
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch37.pth ...
Done in 3.924s
removing stale ckpt [epoch 36] [took 0.01s]
 epoch          : 37
 loss           : 0.8493552138805389
 quant_reg      : 15.423954669952392
 quant_err      : 15.423954669952392
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 9250
 MSRVTT_full_val/t2v_metrics/R1: 37.82696177062374
 MSRVTT_full_val/t2v_metrics/R5: 73.2394366197183
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.7283702213279675
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.84017817890003
 MSRVTT_full_val/v2t_metrics/R1: 43.05835010060362
 MSRVTT_full_val/v2t_metrics/R5: 81.08651911468813
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.73440643863179
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.45958990826362
 MSRVTT_full_test/t2v_metrics/R1: 15.48494983277592
 MSRVTT_full_test/t2v_metrics/R5: 39.96655518394649
 MSRVTT_full_test/t2v_metrics/R10: 53.87959866220736
 MSRVTT_full_test/t2v_metrics/R50: 82.70903010033445
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.205016722408025
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.186737435304515
 MSRVTT_full_test/v2t_metrics/R1: 19.06354515050167
 MSRVTT_full_test/v2t_metrics/R5: 48.42809364548495
 MSRVTT_full_test/v2t_metrics/R10: 62.74247491638796
 MSRVTT_full_test/v2t_metrics/R50: 88.32775919732441
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.923745819397993
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.691974736577606
 mnt_best       : 32.89801005500416
 not_improved_count: 4
Train Epoch: 38 [1/250 128/32000 (0%)] Loss: 0.92861 (QuantReg: 15.34313) QuantErr: 15.34313 batch_time=34.34250 
Train Epoch: 38 [12/250 1536/32000 (5%)] Loss: 0.86633 (QuantReg: 15.52998) QuantErr: 15.52998 batch_time=0.60747 
Train Epoch: 38 [23/250 2944/32000 (9%)] Loss: 0.63661 (QuantReg: 15.44749) QuantErr: 15.44749 batch_time=0.59929 
Train Epoch: 38 [34/250 4352/32000 (14%)] Loss: 0.82414 (QuantReg: 15.33307) QuantErr: 15.33307 batch_time=0.59470 
Train Epoch: 38 [45/250 5760/32000 (18%)] Loss: 0.94702 (QuantReg: 15.38680) QuantErr: 15.38680 batch_time=0.59396 
Train Epoch: 38 [56/250 7168/32000 (22%)] Loss: 1.04395 (QuantReg: 15.44088) QuantErr: 15.44088 batch_time=0.71839 
Train Epoch: 38 [67/250 8576/32000 (27%)] Loss: 0.77786 (QuantReg: 15.29108) QuantErr: 15.29108 batch_time=0.59589 
Train Epoch: 38 [78/250 9984/32000 (31%)] Loss: 0.60915 (QuantReg: 15.64677) QuantErr: 15.64677 batch_time=0.60151 
Train Epoch: 38 [89/250 11392/32000 (36%)] Loss: 0.63373 (QuantReg: 15.39918) QuantErr: 15.39918 batch_time=0.59776 
Train Epoch: 38 [100/250 12800/32000 (40%)] Loss: 0.72000 (QuantReg: 15.61368) QuantErr: 15.61368 batch_time=0.59480 
Train Epoch: 38 [111/250 14208/32000 (44%)] Loss: 0.88506 (QuantReg: 15.21503) QuantErr: 15.21503 batch_time=0.62211 
Train Epoch: 38 [122/250 15616/32000 (49%)] Loss: 0.98722 (QuantReg: 15.27729) QuantErr: 15.27729 batch_time=0.68258 
Train Epoch: 38 [133/250 17024/32000 (53%)] Loss: 0.81773 (QuantReg: 15.45219) QuantErr: 15.45219 batch_time=0.65199 
Train Epoch: 38 [144/250 18432/32000 (58%)] Loss: 0.83847 (QuantReg: 15.39954) QuantErr: 15.39954 batch_time=0.61556 
Train Epoch: 38 [155/250 19840/32000 (62%)] Loss: 0.67722 (QuantReg: 15.57368) QuantErr: 15.57368 batch_time=0.59387 
Train Epoch: 38 [166/250 21248/32000 (66%)] Loss: 0.97574 (QuantReg: 15.34292) QuantErr: 15.34292 batch_time=0.59022 
Train Epoch: 38 [177/250 22656/32000 (71%)] Loss: 0.79134 (QuantReg: 15.36609) QuantErr: 15.36609 batch_time=0.60537 
Train Epoch: 38 [188/250 24064/32000 (75%)] Loss: 0.80820 (QuantReg: 15.42840) QuantErr: 15.42840 batch_time=0.60601 
Train Epoch: 38 [199/250 25472/32000 (80%)] Loss: 0.78775 (QuantReg: 15.33962) QuantErr: 15.33962 batch_time=0.59557 
Train Epoch: 38 [210/250 26880/32000 (84%)] Loss: 0.83424 (QuantReg: 15.38630) QuantErr: 15.38630 batch_time=1.16594 
Train Epoch: 38 [221/250 28288/32000 (88%)] Loss: 0.83344 (QuantReg: 15.54786) QuantErr: 15.54786 batch_time=0.59369 
Train Epoch: 38 [232/250 29696/32000 (93%)] Loss: 0.79406 (QuantReg: 15.31960) QuantErr: 15.31960 batch_time=0.60402 
Train Epoch: 38 [243/250 31104/32000 (97%)] Loss: 0.75883 (QuantReg: 15.52288) QuantErr: 15.52288 batch_time=0.58920 
Train Epoch: 38 codebook_update_time=3.62330
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch38.pth ...
Done in 22.122s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 0.8307582535743714
 quant_reg      : 15.422770236968994
 quant_err      : 15.422770236968994
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 37.02213279678068
 MSRVTT_full_val/t2v_metrics/R5: 72.23340040241449
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.020120724346077
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.325522128054715
 MSRVTT_full_val/v2t_metrics/R1: 43.25955734406438
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.76056338028169
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.86218783282514
 MSRVTT_full_test/t2v_metrics/R1: 15.217391304347826
 MSRVTT_full_test/t2v_metrics/R5: 39.89966555183946
 MSRVTT_full_test/t2v_metrics/R10: 53.24414715719063
 MSRVTT_full_test/t2v_metrics/R50: 82.64214046822742
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.624080267558526
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.856186085219885
 MSRVTT_full_test/v2t_metrics/R1: 19.096989966555185
 MSRVTT_full_test/v2t_metrics/R5: 48.26086956521739
 MSRVTT_full_test/v2t_metrics/R10: 62.97658862876254
 MSRVTT_full_test/v2t_metrics/R50: 88.46153846153847
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.60602006688963
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.718013310629104
 mnt_best       : 32.89801005500416
 not_improved_count: 5
Train Epoch: 39 [1/250 128/32000 (0%)] Loss: 0.98257 (QuantReg: 15.40972) QuantErr: 15.40972 batch_time=29.35566 
Train Epoch: 39 [12/250 1536/32000 (5%)] Loss: 1.00187 (QuantReg: 15.34538) QuantErr: 15.34538 batch_time=0.59667 
Train Epoch: 39 [23/250 2944/32000 (9%)] Loss: 0.70630 (QuantReg: 15.46391) QuantErr: 15.46391 batch_time=0.59764 
Train Epoch: 39 [34/250 4352/32000 (14%)] Loss: 1.03239 (QuantReg: 15.47157) QuantErr: 15.47157 batch_time=0.62592 
Train Epoch: 39 [45/250 5760/32000 (18%)] Loss: 0.66255 (QuantReg: 15.37006) QuantErr: 15.37006 batch_time=0.59023 
Train Epoch: 39 [56/250 7168/32000 (22%)] Loss: 0.72667 (QuantReg: 15.38745) QuantErr: 15.38745 batch_time=0.60888 
Train Epoch: 39 [67/250 8576/32000 (27%)] Loss: 0.76606 (QuantReg: 15.41717) QuantErr: 15.41717 batch_time=0.60775 
Train Epoch: 39 [78/250 9984/32000 (31%)] Loss: 0.60484 (QuantReg: 15.57445) QuantErr: 15.57445 batch_time=0.58844 
Train Epoch: 39 [89/250 11392/32000 (36%)] Loss: 0.61536 (QuantReg: 15.32759) QuantErr: 15.32759 batch_time=0.58818 
Train Epoch: 39 [100/250 12800/32000 (40%)] Loss: 0.64392 (QuantReg: 15.63341) QuantErr: 15.63341 batch_time=0.60882 
Train Epoch: 39 [111/250 14208/32000 (44%)] Loss: 0.67782 (QuantReg: 15.34678) QuantErr: 15.34678 batch_time=0.58728 
Train Epoch: 39 [122/250 15616/32000 (49%)] Loss: 0.65462 (QuantReg: 15.56892) QuantErr: 15.56892 batch_time=0.58914 
Train Epoch: 39 [133/250 17024/32000 (53%)] Loss: 0.87081 (QuantReg: 15.44522) QuantErr: 15.44522 batch_time=2.26769 
Train Epoch: 39 [144/250 18432/32000 (58%)] Loss: 0.93146 (QuantReg: 15.25391) QuantErr: 15.25391 batch_time=4.12698 
Train Epoch: 39 [155/250 19840/32000 (62%)] Loss: 0.67528 (QuantReg: 15.30879) QuantErr: 15.30879 batch_time=0.59697 
Train Epoch: 39 [166/250 21248/32000 (66%)] Loss: 0.60449 (QuantReg: 15.51068) QuantErr: 15.51068 batch_time=0.59303 
Train Epoch: 39 [177/250 22656/32000 (71%)] Loss: 0.74300 (QuantReg: 15.51003) QuantErr: 15.51003 batch_time=0.58914 
Train Epoch: 39 [188/250 24064/32000 (75%)] Loss: 0.79727 (QuantReg: 15.32598) QuantErr: 15.32598 batch_time=0.59674 
Train Epoch: 39 [199/250 25472/32000 (80%)] Loss: 0.78040 (QuantReg: 15.59511) QuantErr: 15.59511 batch_time=0.60037 
Train Epoch: 39 [210/250 26880/32000 (84%)] Loss: 0.71103 (QuantReg: 15.77099) QuantErr: 15.77099 batch_time=0.59866 
Train Epoch: 39 [221/250 28288/32000 (88%)] Loss: 0.74525 (QuantReg: 15.54449) QuantErr: 15.54449 batch_time=0.58496 
Train Epoch: 39 [232/250 29696/32000 (93%)] Loss: 0.67490 (QuantReg: 15.72225) QuantErr: 15.72225 batch_time=0.59901 
Train Epoch: 39 [243/250 31104/32000 (97%)] Loss: 0.79934 (QuantReg: 15.47953) QuantErr: 15.47953 batch_time=0.60256 
Train Epoch: 39 codebook_update_time=3.19606
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch39.pth ...
Done in 3.868s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 0.8082200565338135
 quant_reg      : 15.461811206817627
 quant_err      : 15.461811206817627
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 9750
 MSRVTT_full_val/t2v_metrics/R1: 37.82696177062374
 MSRVTT_full_val/t2v_metrics/R5: 74.04426559356136
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.06841046277666
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.011801593506206
 MSRVTT_full_val/v2t_metrics/R1: 42.454728370221325
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.611670020120724
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.38415312418766
 MSRVTT_full_test/t2v_metrics/R1: 15.48494983277592
 MSRVTT_full_test/t2v_metrics/R5: 39.96655518394649
 MSRVTT_full_test/t2v_metrics/R10: 53.04347826086956
 MSRVTT_full_test/t2v_metrics/R50: 81.77257525083613
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.070234113712374
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.01937408717339
 MSRVTT_full_test/v2t_metrics/R1: 18.561872909698998
 MSRVTT_full_test/v2t_metrics/R5: 47.792642140468224
 MSRVTT_full_test/v2t_metrics/R10: 62.240802675585286
 MSRVTT_full_test/v2t_metrics/R50: 88.49498327759197
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.724414715719064
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.07904137801164
 mnt_best       : 32.89801005500416
 not_improved_count: 6
Train Epoch: 40 [1/250 128/32000 (0%)] Loss: 0.81552 (QuantReg: 15.52606) QuantErr: 15.52606 batch_time=29.97212 
Train Epoch: 40 [12/250 1536/32000 (5%)] Loss: 0.78449 (QuantReg: 15.45878) QuantErr: 15.45878 batch_time=0.59158 
Train Epoch: 40 [23/250 2944/32000 (9%)] Loss: 0.87193 (QuantReg: 15.40222) QuantErr: 15.40222 batch_time=0.59723 
Train Epoch: 40 [34/250 4352/32000 (14%)] Loss: 0.70237 (QuantReg: 15.36299) QuantErr: 15.36299 batch_time=0.57925 
Train Epoch: 40 [45/250 5760/32000 (18%)] Loss: 0.96565 (QuantReg: 15.30869) QuantErr: 15.30869 batch_time=0.59674 
Train Epoch: 40 [56/250 7168/32000 (22%)] Loss: 0.97852 (QuantReg: 15.49666) QuantErr: 15.49666 batch_time=0.59290 
Train Epoch: 40 [67/250 8576/32000 (27%)] Loss: 0.85282 (QuantReg: 15.46875) QuantErr: 15.46875 batch_time=0.59297 
Train Epoch: 40 [78/250 9984/32000 (31%)] Loss: 0.69815 (QuantReg: 15.58469) QuantErr: 15.58469 batch_time=0.58741 
Train Epoch: 40 [89/250 11392/32000 (36%)] Loss: 1.05599 (QuantReg: 15.11477) QuantErr: 15.11477 batch_time=0.59534 
Train Epoch: 40 [100/250 12800/32000 (40%)] Loss: 0.65897 (QuantReg: 15.35092) QuantErr: 15.35092 batch_time=0.58384 
Train Epoch: 40 [111/250 14208/32000 (44%)] Loss: 0.77938 (QuantReg: 15.42057) QuantErr: 15.42057 batch_time=0.60815 
Train Epoch: 40 [122/250 15616/32000 (49%)] Loss: 0.63210 (QuantReg: 15.46273) QuantErr: 15.46273 batch_time=0.60488 
Train Epoch: 40 [133/250 17024/32000 (53%)] Loss: 0.83658 (QuantReg: 15.60977) QuantErr: 15.60977 batch_time=0.59519 
Train Epoch: 40 [144/250 18432/32000 (58%)] Loss: 0.68833 (QuantReg: 15.43283) QuantErr: 15.43283 batch_time=0.80788 
Train Epoch: 40 [155/250 19840/32000 (62%)] Loss: 0.78838 (QuantReg: 15.43374) QuantErr: 15.43374 batch_time=0.61387 
Train Epoch: 40 [166/250 21248/32000 (66%)] Loss: 0.93991 (QuantReg: 15.43806) QuantErr: 15.43806 batch_time=0.59464 
Train Epoch: 40 [177/250 22656/32000 (71%)] Loss: 0.86502 (QuantReg: 15.45455) QuantErr: 15.45455 batch_time=0.60800 
Train Epoch: 40 [188/250 24064/32000 (75%)] Loss: 1.07231 (QuantReg: 15.38023) QuantErr: 15.38023 batch_time=0.58072 
Train Epoch: 40 [199/250 25472/32000 (80%)] Loss: 0.91789 (QuantReg: 15.49321) QuantErr: 15.49321 batch_time=0.59001 
Train Epoch: 40 [210/250 26880/32000 (84%)] Loss: 0.77521 (QuantReg: 15.39880) QuantErr: 15.39880 batch_time=2.89299 
Train Epoch: 40 [221/250 28288/32000 (88%)] Loss: 0.84231 (QuantReg: 15.57391) QuantErr: 15.57391 batch_time=0.61382 
Train Epoch: 40 [232/250 29696/32000 (93%)] Loss: 0.98015 (QuantReg: 15.30949) QuantErr: 15.30949 batch_time=0.59471 
Train Epoch: 40 [243/250 31104/32000 (97%)] Loss: 0.72444 (QuantReg: 15.28462) QuantErr: 15.28462 batch_time=0.59404 
Train Epoch: 40 codebook_update_time=3.45756
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch40.pth ...
Done in 20.817s
removing stale ckpt [epoch 39] [took 0.40s]
 epoch          : 40
 loss           : 0.8183811113834382
 quant_reg      : 15.448969356536866
 quant_err      : 15.448969356536866
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 36.41851106639839
 MSRVTT_full_val/t2v_metrics/R5: 73.2394366197183
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.824949698189135
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.32231962045492
 MSRVTT_full_val/v2t_metrics/R1: 42.25352112676056
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.788732394366197
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.43218482445266
 MSRVTT_full_test/t2v_metrics/R1: 14.949832775919733
 MSRVTT_full_test/t2v_metrics/R5: 39.23076923076923
 MSRVTT_full_test/t2v_metrics/R10: 53.91304347826087
 MSRVTT_full_test/t2v_metrics/R50: 82.37458193979933
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.87023411371238
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.62173313758518
 MSRVTT_full_test/v2t_metrics/R1: 18.896321070234112
 MSRVTT_full_test/v2t_metrics/R5: 48.09364548494983
 MSRVTT_full_test/v2t_metrics/R10: 62.84280936454849
 MSRVTT_full_test/v2t_metrics/R50: 88.39464882943143
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 26.94715719063545
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.5099997968023
 mnt_best       : 32.89801005500416
 not_improved_count: 7
Train Epoch: 41 [1/250 128/32000 (0%)] Loss: 0.83454 (QuantReg: 15.35267) QuantErr: 15.35267 batch_time=33.55631 
Train Epoch: 41 [12/250 1536/32000 (5%)] Loss: 0.93136 (QuantReg: 15.23331) QuantErr: 15.23331 batch_time=0.58427 
Train Epoch: 41 [23/250 2944/32000 (9%)] Loss: 0.81466 (QuantReg: 15.49073) QuantErr: 15.49073 batch_time=0.58094 
Train Epoch: 41 [34/250 4352/32000 (14%)] Loss: 0.86405 (QuantReg: 15.43494) QuantErr: 15.43494 batch_time=0.57626 
Train Epoch: 41 [45/250 5760/32000 (18%)] Loss: 0.52839 (QuantReg: 15.53176) QuantErr: 15.53176 batch_time=0.59207 
Train Epoch: 41 [56/250 7168/32000 (22%)] Loss: 0.86578 (QuantReg: 15.22089) QuantErr: 15.22089 batch_time=0.58473 
Train Epoch: 41 [67/250 8576/32000 (27%)] Loss: 1.00286 (QuantReg: 15.11031) QuantErr: 15.11031 batch_time=0.57520 
Train Epoch: 41 [78/250 9984/32000 (31%)] Loss: 0.86951 (QuantReg: 15.49998) QuantErr: 15.49998 batch_time=0.58542 
Train Epoch: 41 [89/250 11392/32000 (36%)] Loss: 0.80953 (QuantReg: 15.50514) QuantErr: 15.50514 batch_time=0.59061 
Train Epoch: 41 [100/250 12800/32000 (40%)] Loss: 0.66989 (QuantReg: 15.62931) QuantErr: 15.62931 batch_time=0.58538 
Train Epoch: 41 [111/250 14208/32000 (44%)] Loss: 0.95507 (QuantReg: 15.52357) QuantErr: 15.52357 batch_time=0.59784 
Train Epoch: 41 [122/250 15616/32000 (49%)] Loss: 0.79766 (QuantReg: 15.47556) QuantErr: 15.47556 batch_time=0.58186 
Train Epoch: 41 [133/250 17024/32000 (53%)] Loss: 0.66513 (QuantReg: 15.45865) QuantErr: 15.45865 batch_time=0.57946 
Train Epoch: 41 [144/250 18432/32000 (58%)] Loss: 0.66411 (QuantReg: 15.45710) QuantErr: 15.45710 batch_time=3.40599 
Train Epoch: 41 [155/250 19840/32000 (62%)] Loss: 0.79916 (QuantReg: 15.50713) QuantErr: 15.50713 batch_time=0.59891 
Train Epoch: 41 [166/250 21248/32000 (66%)] Loss: 0.81112 (QuantReg: 15.61078) QuantErr: 15.61078 batch_time=0.62624 
Train Epoch: 41 [177/250 22656/32000 (71%)] Loss: 0.89034 (QuantReg: 15.50400) QuantErr: 15.50400 batch_time=0.59292 
Train Epoch: 41 [188/250 24064/32000 (75%)] Loss: 0.97583 (QuantReg: 15.32184) QuantErr: 15.32184 batch_time=0.74725 
Train Epoch: 41 [199/250 25472/32000 (80%)] Loss: 0.75965 (QuantReg: 15.39185) QuantErr: 15.39185 batch_time=0.57277 
Train Epoch: 41 [210/250 26880/32000 (84%)] Loss: 0.75228 (QuantReg: 15.55989) QuantErr: 15.55989 batch_time=0.58581 
Train Epoch: 41 [221/250 28288/32000 (88%)] Loss: 0.87861 (QuantReg: 15.47978) QuantErr: 15.47978 batch_time=0.59334 
Train Epoch: 41 [232/250 29696/32000 (93%)] Loss: 0.80939 (QuantReg: 15.58163) QuantErr: 15.58163 batch_time=0.81580 
Train Epoch: 41 [243/250 31104/32000 (97%)] Loss: 0.95051 (QuantReg: 15.44765) QuantErr: 15.44765 batch_time=0.61232 
Train Epoch: 41 codebook_update_time=3.55201
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch41.pth ...
Done in 3.964s
removing stale ckpt [epoch 40] [took 0.01s]
 epoch          : 41
 loss           : 0.8226146438121795
 quant_reg      : 15.4811265335083
 quant_err      : 15.4811265335083
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 10250
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 73.64185110663983
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.93158953722334
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.072340845951
 MSRVTT_full_val/v2t_metrics/R1: 43.86317907444668
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.5875251509054324
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.37890106073382
 MSRVTT_full_test/t2v_metrics/R1: 15.183946488294314
 MSRVTT_full_test/t2v_metrics/R5: 39.86622073578595
 MSRVTT_full_test/t2v_metrics/R10: 53.57859531772575
 MSRVTT_full_test/t2v_metrics/R50: 82.50836120401338
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.72408026755853
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.89042827536171
 MSRVTT_full_test/v2t_metrics/R1: 18.62876254180602
 MSRVTT_full_test/v2t_metrics/R5: 47.95986622073578
 MSRVTT_full_test/v2t_metrics/R10: 62.17391304347826
 MSRVTT_full_test/v2t_metrics/R50: 88.16053511705685
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.010702341137122
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.15546263718545
 mnt_best       : 32.89801005500416
 not_improved_count: 8
Train Epoch: 42 [1/250 128/32000 (0%)] Loss: 0.78288 (QuantReg: 15.41375) QuantErr: 15.41375 batch_time=28.54892 
Train Epoch: 42 [12/250 1536/32000 (5%)] Loss: 0.77996 (QuantReg: 15.35115) QuantErr: 15.35115 batch_time=2.14380 
Train Epoch: 42 [23/250 2944/32000 (9%)] Loss: 0.80618 (QuantReg: 15.44677) QuantErr: 15.44677 batch_time=0.60975 
Train Epoch: 42 [34/250 4352/32000 (14%)] Loss: 0.67941 (QuantReg: 15.56509) QuantErr: 15.56509 batch_time=0.59438 
Train Epoch: 42 [45/250 5760/32000 (18%)] Loss: 0.87591 (QuantReg: 15.48634) QuantErr: 15.48634 batch_time=0.58384 
Train Epoch: 42 [56/250 7168/32000 (22%)] Loss: 0.80781 (QuantReg: 15.54210) QuantErr: 15.54210 batch_time=0.59050 
Train Epoch: 42 [67/250 8576/32000 (27%)] Loss: 0.70156 (QuantReg: 15.56522) QuantErr: 15.56522 batch_time=0.70035 
Train Epoch: 42 [78/250 9984/32000 (31%)] Loss: 0.91895 (QuantReg: 15.22412) QuantErr: 15.22412 batch_time=1.07352 
Train Epoch: 42 [89/250 11392/32000 (36%)] Loss: 0.90275 (QuantReg: 15.41449) QuantErr: 15.41449 batch_time=0.59822 
Train Epoch: 42 [100/250 12800/32000 (40%)] Loss: 0.72041 (QuantReg: 15.67763) QuantErr: 15.67763 batch_time=0.59686 
Train Epoch: 42 [111/250 14208/32000 (44%)] Loss: 0.91817 (QuantReg: 15.40327) QuantErr: 15.40327 batch_time=0.59495 
Train Epoch: 42 [122/250 15616/32000 (49%)] Loss: 0.98598 (QuantReg: 15.60322) QuantErr: 15.60322 batch_time=0.59160 
Train Epoch: 42 [133/250 17024/32000 (53%)] Loss: 0.76682 (QuantReg: 15.59766) QuantErr: 15.59766 batch_time=0.78491 
Train Epoch: 42 [144/250 18432/32000 (58%)] Loss: 0.74774 (QuantReg: 15.45165) QuantErr: 15.45165 batch_time=0.65195 
Train Epoch: 42 [155/250 19840/32000 (62%)] Loss: 1.00496 (QuantReg: 15.42552) QuantErr: 15.42552 batch_time=0.65737 
Train Epoch: 42 [166/250 21248/32000 (66%)] Loss: 0.77640 (QuantReg: 15.48059) QuantErr: 15.48059 batch_time=0.65966 
Train Epoch: 42 [177/250 22656/32000 (71%)] Loss: 1.07707 (QuantReg: 15.43715) QuantErr: 15.43715 batch_time=0.64719 
Train Epoch: 42 [188/250 24064/32000 (75%)] Loss: 0.70337 (QuantReg: 15.49545) QuantErr: 15.49545 batch_time=0.64853 
Train Epoch: 42 [199/250 25472/32000 (80%)] Loss: 0.80851 (QuantReg: 15.59488) QuantErr: 15.59488 batch_time=0.65959 
Train Epoch: 42 [210/250 26880/32000 (84%)] Loss: 0.83517 (QuantReg: 15.55918) QuantErr: 15.55918 batch_time=0.59763 
Train Epoch: 42 [221/250 28288/32000 (88%)] Loss: 0.62894 (QuantReg: 15.51314) QuantErr: 15.51314 batch_time=0.60037 
Train Epoch: 42 [232/250 29696/32000 (93%)] Loss: 0.93107 (QuantReg: 15.47371) QuantErr: 15.47371 batch_time=0.59670 
Train Epoch: 42 [243/250 31104/32000 (97%)] Loss: 0.66605 (QuantReg: 15.52884) QuantErr: 15.52884 batch_time=0.59200 
Train Epoch: 42 codebook_update_time=3.21777
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch42.pth ...
Done in 3.923s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 0.8132537846565246
 quant_reg      : 15.481703643798829
 quant_err      : 15.481703643798829
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 37.82696177062374
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.09456740442656
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.27478321593424
 MSRVTT_full_val/v2t_metrics/R1: 43.86317907444668
 MSRVTT_full_val/v2t_metrics/R5: 80.48289738430583
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.668008048289739
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.86304332719921
 MSRVTT_full_test/t2v_metrics/R1: 15.351170568561873
 MSRVTT_full_test/t2v_metrics/R5: 40.53511705685619
 MSRVTT_full_test/t2v_metrics/R10: 54.78260869565217
 MSRVTT_full_test/t2v_metrics/R50: 82.5752508361204
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.60301003344482
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.424394839556165
 MSRVTT_full_test/v2t_metrics/R1: 18.99665551839465
 MSRVTT_full_test/v2t_metrics/R5: 48.16053511705686
 MSRVTT_full_test/v2t_metrics/R10: 62.97658862876254
 MSRVTT_full_test/v2t_metrics/R50: 87.85953177257525
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.923411371237457
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.62328371185546
 mnt_best       : 32.89801005500416
 not_improved_count: 9
Train Epoch: 43 [1/250 128/32000 (0%)] Loss: 0.91547 (QuantReg: 15.62295) QuantErr: 15.62295 batch_time=32.19671 
Train Epoch: 43 [12/250 1536/32000 (5%)] Loss: 0.92768 (QuantReg: 15.42316) QuantErr: 15.42316 batch_time=0.60301 
Train Epoch: 43 [23/250 2944/32000 (9%)] Loss: 0.75309 (QuantReg: 15.42444) QuantErr: 15.42444 batch_time=0.59470 
Train Epoch: 43 [34/250 4352/32000 (14%)] Loss: 0.64129 (QuantReg: 15.60998) QuantErr: 15.60998 batch_time=0.59332 
Train Epoch: 43 [45/250 5760/32000 (18%)] Loss: 0.73899 (QuantReg: 15.59504) QuantErr: 15.59504 batch_time=0.59492 
Train Epoch: 43 [56/250 7168/32000 (22%)] Loss: 0.82222 (QuantReg: 15.57566) QuantErr: 15.57566 batch_time=0.58420 
Train Epoch: 43 [67/250 8576/32000 (27%)] Loss: 0.72609 (QuantReg: 15.34162) QuantErr: 15.34162 batch_time=1.10951 
Train Epoch: 43 [78/250 9984/32000 (31%)] Loss: 0.80053 (QuantReg: 15.47708) QuantErr: 15.47708 batch_time=0.60539 
Train Epoch: 43 [89/250 11392/32000 (36%)] Loss: 0.80830 (QuantReg: 15.56886) QuantErr: 15.56886 batch_time=0.64908 
Train Epoch: 43 [100/250 12800/32000 (40%)] Loss: 0.80090 (QuantReg: 15.41151) QuantErr: 15.41151 batch_time=0.60044 
Train Epoch: 43 [111/250 14208/32000 (44%)] Loss: 1.03270 (QuantReg: 15.53346) QuantErr: 15.53346 batch_time=1.64992 
Train Epoch: 43 [122/250 15616/32000 (49%)] Loss: 1.09737 (QuantReg: 15.35247) QuantErr: 15.35247 batch_time=0.59609 
Train Epoch: 43 [133/250 17024/32000 (53%)] Loss: 0.88299 (QuantReg: 15.59409) QuantErr: 15.59409 batch_time=0.58918 
Train Epoch: 43 [144/250 18432/32000 (58%)] Loss: 0.63397 (QuantReg: 15.50696) QuantErr: 15.50696 batch_time=0.58955 
Train Epoch: 43 [155/250 19840/32000 (62%)] Loss: 0.95046 (QuantReg: 15.48839) QuantErr: 15.48839 batch_time=0.59924 
Train Epoch: 43 [166/250 21248/32000 (66%)] Loss: 0.85380 (QuantReg: 15.54398) QuantErr: 15.54398 batch_time=0.63202 
Train Epoch: 43 [177/250 22656/32000 (71%)] Loss: 0.72541 (QuantReg: 15.45758) QuantErr: 15.45758 batch_time=0.59667 
Train Epoch: 43 [188/250 24064/32000 (75%)] Loss: 0.74223 (QuantReg: 15.60335) QuantErr: 15.60335 batch_time=0.59298 
Train Epoch: 43 [199/250 25472/32000 (80%)] Loss: 0.60901 (QuantReg: 15.64369) QuantErr: 15.64369 batch_time=0.58388 
Train Epoch: 43 [210/250 26880/32000 (84%)] Loss: 0.82994 (QuantReg: 15.67059) QuantErr: 15.67059 batch_time=0.58801 
Train Epoch: 43 [221/250 28288/32000 (88%)] Loss: 0.95036 (QuantReg: 15.47443) QuantErr: 15.47443 batch_time=0.58219 
Train Epoch: 43 [232/250 29696/32000 (93%)] Loss: 0.69538 (QuantReg: 15.45733) QuantErr: 15.45733 batch_time=0.58311 
Train Epoch: 43 [243/250 31104/32000 (97%)] Loss: 0.93422 (QuantReg: 15.55992) QuantErr: 15.55992 batch_time=0.60541 
Train Epoch: 43 codebook_update_time=3.29326
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch43.pth ...
Done in 4.395s
removing stale ckpt [epoch 42] [took 0.00s]
 epoch          : 43
 loss           : 0.8047691466808319
 quant_reg      : 15.482147541046142
 quant_err      : 15.482147541046142
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 10750
 MSRVTT_full_val/t2v_metrics/R1: 38.43058350100603
 MSRVTT_full_val/t2v_metrics/R5: 73.2394366197183
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.907444668008048
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.662620231787145
 MSRVTT_full_val/v2t_metrics/R1: 43.05835010060362
 MSRVTT_full_val/v2t_metrics/R5: 80.0804828973843
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.647887323943662
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.1281568475837
 MSRVTT_full_test/t2v_metrics/R1: 14.882943143812708
 MSRVTT_full_test/t2v_metrics/R5: 40.20066889632107
 MSRVTT_full_test/t2v_metrics/R10: 53.779264214046826
 MSRVTT_full_test/t2v_metrics/R50: 82.50836120401338
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.42508361204013
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.806239098360553
 MSRVTT_full_test/v2t_metrics/R1: 19.19732441471572
 MSRVTT_full_test/v2t_metrics/R5: 47.9933110367893
 MSRVTT_full_test/v2t_metrics/R10: 62.709030100334445
 MSRVTT_full_test/v2t_metrics/R50: 87.65886287625418
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.63444816053512
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.65898970352581
 mnt_best       : 32.89801005500416
 not_improved_count: 10
Train Epoch: 44 [1/250 128/32000 (0%)] Loss: 0.59899 (QuantReg: 15.55929) QuantErr: 15.55929 batch_time=30.25977 
Train Epoch: 44 [12/250 1536/32000 (5%)] Loss: 0.63135 (QuantReg: 15.51601) QuantErr: 15.51601 batch_time=0.60210 
Train Epoch: 44 [23/250 2944/32000 (9%)] Loss: 0.66762 (QuantReg: 15.47431) QuantErr: 15.47431 batch_time=0.59044 
Train Epoch: 44 [34/250 4352/32000 (14%)] Loss: 0.70417 (QuantReg: 15.45656) QuantErr: 15.45656 batch_time=0.61541 
Train Epoch: 44 [45/250 5760/32000 (18%)] Loss: 0.95251 (QuantReg: 15.40992) QuantErr: 15.40992 batch_time=0.59317 
Train Epoch: 44 [56/250 7168/32000 (22%)] Loss: 0.65695 (QuantReg: 15.21105) QuantErr: 15.21105 batch_time=0.58371 
Train Epoch: 44 [67/250 8576/32000 (27%)] Loss: 0.72701 (QuantReg: 15.57179) QuantErr: 15.57179 batch_time=0.58539 
Train Epoch: 44 [78/250 9984/32000 (31%)] Loss: 1.01251 (QuantReg: 15.56975) QuantErr: 15.56975 batch_time=0.58791 
Train Epoch: 44 [89/250 11392/32000 (36%)] Loss: 0.74321 (QuantReg: 15.52582) QuantErr: 15.52582 batch_time=0.59075 
Train Epoch: 44 [100/250 12800/32000 (40%)] Loss: 0.72462 (QuantReg: 15.42845) QuantErr: 15.42845 batch_time=0.58748 
Train Epoch: 44 [111/250 14208/32000 (44%)] Loss: 0.86033 (QuantReg: 15.68715) QuantErr: 15.68715 batch_time=0.59052 
Train Epoch: 44 [122/250 15616/32000 (49%)] Loss: 0.92567 (QuantReg: 15.44061) QuantErr: 15.44061 batch_time=0.58731 
Train Epoch: 44 [133/250 17024/32000 (53%)] Loss: 0.77067 (QuantReg: 15.51526) QuantErr: 15.51526 batch_time=0.60656 
Train Epoch: 44 [144/250 18432/32000 (58%)] Loss: 0.81569 (QuantReg: 15.30323) QuantErr: 15.30323 batch_time=0.62807 
Train Epoch: 44 [155/250 19840/32000 (62%)] Loss: 0.89493 (QuantReg: 15.45489) QuantErr: 15.45489 batch_time=0.60492 
Train Epoch: 44 [166/250 21248/32000 (66%)] Loss: 0.74026 (QuantReg: 15.58528) QuantErr: 15.58528 batch_time=0.70180 
Train Epoch: 44 [177/250 22656/32000 (71%)] Loss: 0.75785 (QuantReg: 15.33589) QuantErr: 15.33589 batch_time=0.60354 
Train Epoch: 44 [188/250 24064/32000 (75%)] Loss: 0.72738 (QuantReg: 15.28529) QuantErr: 15.28529 batch_time=0.58811 
Train Epoch: 44 [199/250 25472/32000 (80%)] Loss: 0.84633 (QuantReg: 15.37263) QuantErr: 15.37263 batch_time=0.59979 
Train Epoch: 44 [210/250 26880/32000 (84%)] Loss: 0.77839 (QuantReg: 15.53466) QuantErr: 15.53466 batch_time=0.60166 
Train Epoch: 44 [221/250 28288/32000 (88%)] Loss: 0.73035 (QuantReg: 15.55964) QuantErr: 15.55964 batch_time=0.59717 
Train Epoch: 44 [232/250 29696/32000 (93%)] Loss: 0.51538 (QuantReg: 15.41441) QuantErr: 15.41441 batch_time=0.58884 
Train Epoch: 44 [243/250 31104/32000 (97%)] Loss: 0.76692 (QuantReg: 15.62379) QuantErr: 15.62379 batch_time=0.58635 
Train Epoch: 44 codebook_update_time=3.75501
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch44.pth ...
Done in 11.526s
removing stale ckpt [epoch 43] [took 0.00s]
 epoch          : 44
 loss           : 0.7993802337646484
 quant_reg      : 15.48173586654663
 quant_err      : 15.48173586654663
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 73.44064386317908
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.909456740442656
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.06587568430936
 MSRVTT_full_val/v2t_metrics/R1: 41.85110663983903
 MSRVTT_full_val/v2t_metrics/R5: 80.0804828973843
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.617706237424548
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.39300467064578
 MSRVTT_full_test/t2v_metrics/R1: 15.351170568561873
 MSRVTT_full_test/t2v_metrics/R5: 40.5685618729097
 MSRVTT_full_test/t2v_metrics/R10: 54.080267558528426
 MSRVTT_full_test/t2v_metrics/R50: 82.5752508361204
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.94113712374582
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.2941095200496
 MSRVTT_full_test/v2t_metrics/R1: 18.896321070234112
 MSRVTT_full_test/v2t_metrics/R5: 48.09364548494983
 MSRVTT_full_test/v2t_metrics/R10: 62.508361204013376
 MSRVTT_full_test/v2t_metrics/R50: 88.06020066889631
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.568561872909697
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.441561764188165
 mnt_best       : 32.89801005500416
 not_improved_count: 11
Train Epoch: 45 [1/250 128/32000 (0%)] Loss: 0.82447 (QuantReg: 15.46057) QuantErr: 15.46057 batch_time=31.58504 
Train Epoch: 45 [12/250 1536/32000 (5%)] Loss: 0.67206 (QuantReg: 15.53853) QuantErr: 15.53853 batch_time=0.59249 
Train Epoch: 45 [23/250 2944/32000 (9%)] Loss: 0.87328 (QuantReg: 15.42932) QuantErr: 15.42932 batch_time=1.29659 
Train Epoch: 45 [34/250 4352/32000 (14%)] Loss: 0.60134 (QuantReg: 15.56720) QuantErr: 15.56720 batch_time=0.61650 
Train Epoch: 45 [45/250 5760/32000 (18%)] Loss: 0.79944 (QuantReg: 15.47890) QuantErr: 15.47890 batch_time=0.94574 
Train Epoch: 45 [56/250 7168/32000 (22%)] Loss: 0.56016 (QuantReg: 15.53213) QuantErr: 15.53213 batch_time=0.61416 
Train Epoch: 45 [67/250 8576/32000 (27%)] Loss: 0.86996 (QuantReg: 15.33686) QuantErr: 15.33686 batch_time=0.59791 
Train Epoch: 45 [78/250 9984/32000 (31%)] Loss: 1.10422 (QuantReg: 15.31170) QuantErr: 15.31170 batch_time=0.59488 
Train Epoch: 45 [89/250 11392/32000 (36%)] Loss: 0.83825 (QuantReg: 15.55589) QuantErr: 15.55589 batch_time=0.58547 
Train Epoch: 45 [100/250 12800/32000 (40%)] Loss: 0.65776 (QuantReg: 15.34725) QuantErr: 15.34725 batch_time=0.57809 
Train Epoch: 45 [111/250 14208/32000 (44%)] Loss: 0.92567 (QuantReg: 15.66959) QuantErr: 15.66959 batch_time=0.58459 
Train Epoch: 45 [122/250 15616/32000 (49%)] Loss: 0.77704 (QuantReg: 15.48821) QuantErr: 15.48821 batch_time=0.59655 
Train Epoch: 45 [133/250 17024/32000 (53%)] Loss: 0.77590 (QuantReg: 15.49244) QuantErr: 15.49244 batch_time=0.59911 
Train Epoch: 45 [144/250 18432/32000 (58%)] Loss: 0.77390 (QuantReg: 15.58264) QuantErr: 15.58264 batch_time=2.33807 
Train Epoch: 45 [155/250 19840/32000 (62%)] Loss: 0.77229 (QuantReg: 15.62090) QuantErr: 15.62090 batch_time=0.60500 
Train Epoch: 45 [166/250 21248/32000 (66%)] Loss: 0.67133 (QuantReg: 15.44007) QuantErr: 15.44007 batch_time=0.58543 
Train Epoch: 45 [177/250 22656/32000 (71%)] Loss: 0.71674 (QuantReg: 15.48998) QuantErr: 15.48998 batch_time=0.57853 
Train Epoch: 45 [188/250 24064/32000 (75%)] Loss: 0.78955 (QuantReg: 15.73193) QuantErr: 15.73193 batch_time=0.63052 
Train Epoch: 45 [199/250 25472/32000 (80%)] Loss: 0.54069 (QuantReg: 15.63960) QuantErr: 15.63960 batch_time=0.60278 
Train Epoch: 45 [210/250 26880/32000 (84%)] Loss: 0.79672 (QuantReg: 15.42744) QuantErr: 15.42744 batch_time=0.60472 
Train Epoch: 45 [221/250 28288/32000 (88%)] Loss: 0.81994 (QuantReg: 15.32554) QuantErr: 15.32554 batch_time=0.59758 
Train Epoch: 45 [232/250 29696/32000 (93%)] Loss: 0.57191 (QuantReg: 15.66806) QuantErr: 15.66806 batch_time=0.82895 
Train Epoch: 45 [243/250 31104/32000 (97%)] Loss: 0.82407 (QuantReg: 15.52957) QuantErr: 15.52957 batch_time=0.59410 
Train Epoch: 45 codebook_update_time=3.33244
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch45.pth ...
Done in 3.777s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 0.7826037068367004
 quant_reg      : 15.493309631347657
 quant_err      : 15.493309631347657
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 11250
 MSRVTT_full_val/t2v_metrics/R1: 40.44265593561368
 MSRVTT_full_val/t2v_metrics/R5: 74.04426559356136
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.893360160965795
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 62.949412852490056
 MSRVTT_full_val/v2t_metrics/R1: 43.05835010060362
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.762575452716298
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.1178394386255
 MSRVTT_full_test/t2v_metrics/R1: 15.48494983277592
 MSRVTT_full_test/t2v_metrics/R5: 39.93311036789298
 MSRVTT_full_test/t2v_metrics/R10: 53.812709030100336
 MSRVTT_full_test/t2v_metrics/R50: 82.40802675585284
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.09030100334448
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.164435393972745
 MSRVTT_full_test/v2t_metrics/R1: 19.163879598662206
 MSRVTT_full_test/v2t_metrics/R5: 48.49498327759197
 MSRVTT_full_test/v2t_metrics/R10: 62.408026755852845
 MSRVTT_full_test/v2t_metrics/R50: 87.85953177257525
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.79096989966555
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.70854967415547
 mnt_best       : 32.89801005500416
 not_improved_count: 12
Train Epoch: 46 [1/250 128/32000 (0%)] Loss: 0.82555 (QuantReg: 15.28600) QuantErr: 15.28600 batch_time=27.36719 
Train Epoch: 46 [12/250 1536/32000 (5%)] Loss: 0.75876 (QuantReg: 15.42451) QuantErr: 15.42451 batch_time=0.59250 
Train Epoch: 46 [23/250 2944/32000 (9%)] Loss: 0.56742 (QuantReg: 15.58425) QuantErr: 15.58425 batch_time=0.59082 
Train Epoch: 46 [34/250 4352/32000 (14%)] Loss: 0.67811 (QuantReg: 15.51197) QuantErr: 15.51197 batch_time=0.59428 
Train Epoch: 46 [45/250 5760/32000 (18%)] Loss: 0.97037 (QuantReg: 15.30810) QuantErr: 15.30810 batch_time=1.12172 
Train Epoch: 46 [56/250 7168/32000 (22%)] Loss: 0.67146 (QuantReg: 15.49187) QuantErr: 15.49187 batch_time=0.60575 
Train Epoch: 46 [67/250 8576/32000 (27%)] Loss: 0.92451 (QuantReg: 15.54612) QuantErr: 15.54612 batch_time=0.60995 
Train Epoch: 46 [78/250 9984/32000 (31%)] Loss: 0.83763 (QuantReg: 15.49869) QuantErr: 15.49869 batch_time=0.59132 
Train Epoch: 46 [89/250 11392/32000 (36%)] Loss: 0.90285 (QuantReg: 15.50363) QuantErr: 15.50363 batch_time=0.60239 
Train Epoch: 46 [100/250 12800/32000 (40%)] Loss: 0.84846 (QuantReg: 15.44913) QuantErr: 15.44913 batch_time=0.62023 
Train Epoch: 46 [111/250 14208/32000 (44%)] Loss: 0.61709 (QuantReg: 15.37983) QuantErr: 15.37983 batch_time=0.59472 
Train Epoch: 46 [122/250 15616/32000 (49%)] Loss: 0.75845 (QuantReg: 15.52901) QuantErr: 15.52901 batch_time=0.58335 
Train Epoch: 46 [133/250 17024/32000 (53%)] Loss: 0.99694 (QuantReg: 15.45047) QuantErr: 15.45047 batch_time=0.60613 
Train Epoch: 46 [144/250 18432/32000 (58%)] Loss: 0.79095 (QuantReg: 15.30569) QuantErr: 15.30569 batch_time=0.58917 
Train Epoch: 46 [155/250 19840/32000 (62%)] Loss: 0.72993 (QuantReg: 15.55907) QuantErr: 15.55907 batch_time=0.62148 
Train Epoch: 46 [166/250 21248/32000 (66%)] Loss: 0.65281 (QuantReg: 15.61042) QuantErr: 15.61042 batch_time=0.59737 
Train Epoch: 46 [177/250 22656/32000 (71%)] Loss: 0.85224 (QuantReg: 15.54307) QuantErr: 15.54307 batch_time=0.59158 
Train Epoch: 46 [188/250 24064/32000 (75%)] Loss: 0.74396 (QuantReg: 15.54623) QuantErr: 15.54623 batch_time=0.60063 
Train Epoch: 46 [199/250 25472/32000 (80%)] Loss: 0.72543 (QuantReg: 15.56117) QuantErr: 15.56117 batch_time=0.60503 
Train Epoch: 46 [210/250 26880/32000 (84%)] Loss: 0.67967 (QuantReg: 15.89017) QuantErr: 15.89017 batch_time=0.59778 
Train Epoch: 46 [221/250 28288/32000 (88%)] Loss: 0.62683 (QuantReg: 15.44484) QuantErr: 15.44484 batch_time=0.59292 
Train Epoch: 46 [232/250 29696/32000 (93%)] Loss: 0.70331 (QuantReg: 15.65216) QuantErr: 15.65216 batch_time=0.60449 
Train Epoch: 46 [243/250 31104/32000 (97%)] Loss: 0.62177 (QuantReg: 15.53754) QuantErr: 15.53754 batch_time=0.72721 
Train Epoch: 46 codebook_update_time=3.25478
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch46.pth ...
Done in 4.010s
removing stale ckpt [epoch 45] [took 0.00s]
 epoch          : 46
 loss           : 0.7816780178546906
 quant_reg      : 15.48997649383545
 quant_err      : 15.48997649383545
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.839034205231388
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.77375961617073
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 80.28169014084507
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.406438631790745
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.02554321672015
 MSRVTT_full_test/t2v_metrics/R1: 15.150501672240802
 MSRVTT_full_test/t2v_metrics/R5: 39.89966555183946
 MSRVTT_full_test/t2v_metrics/R10: 52.80936454849498
 MSRVTT_full_test/t2v_metrics/R50: 82.34113712374582
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.30518394648829
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.722621558525237
 MSRVTT_full_test/v2t_metrics/R1: 19.096989966555185
 MSRVTT_full_test/v2t_metrics/R5: 48.02675585284281
 MSRVTT_full_test/v2t_metrics/R10: 62.876254180602004
 MSRVTT_full_test/v2t_metrics/R50: 88.32775919732441
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.40066889632107
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.63476522536905
 mnt_best       : 32.89801005500416
 not_improved_count: 13
Train Epoch: 47 [1/250 128/32000 (0%)] Loss: 0.70370 (QuantReg: 15.64623) QuantErr: 15.64623 batch_time=29.09054 
Train Epoch: 47 [12/250 1536/32000 (5%)] Loss: 0.90096 (QuantReg: 15.42345) QuantErr: 15.42345 batch_time=0.68643 
Train Epoch: 47 [23/250 2944/32000 (9%)] Loss: 0.77402 (QuantReg: 15.30839) QuantErr: 15.30839 batch_time=0.64839 
Train Epoch: 47 [34/250 4352/32000 (14%)] Loss: 0.65688 (QuantReg: 15.48327) QuantErr: 15.48327 batch_time=0.67865 
Train Epoch: 47 [45/250 5760/32000 (18%)] Loss: 0.84906 (QuantReg: 15.60449) QuantErr: 15.60449 batch_time=0.62234 
Train Epoch: 47 [56/250 7168/32000 (22%)] Loss: 0.69255 (QuantReg: 15.42280) QuantErr: 15.42280 batch_time=0.60204 
Train Epoch: 47 [67/250 8576/32000 (27%)] Loss: 1.03073 (QuantReg: 15.34248) QuantErr: 15.34248 batch_time=0.70863 
Train Epoch: 47 [78/250 9984/32000 (31%)] Loss: 0.61639 (QuantReg: 15.43608) QuantErr: 15.43608 batch_time=0.59896 
Train Epoch: 47 [89/250 11392/32000 (36%)] Loss: 0.77669 (QuantReg: 15.60924) QuantErr: 15.60924 batch_time=0.58474 
Train Epoch: 47 [100/250 12800/32000 (40%)] Loss: 0.66173 (QuantReg: 15.47026) QuantErr: 15.47026 batch_time=0.58642 
Train Epoch: 47 [111/250 14208/32000 (44%)] Loss: 0.98501 (QuantReg: 15.34404) QuantErr: 15.34404 batch_time=0.58620 
Train Epoch: 47 [122/250 15616/32000 (49%)] Loss: 0.57383 (QuantReg: 15.53023) QuantErr: 15.53023 batch_time=0.58431 
Train Epoch: 47 [133/250 17024/32000 (53%)] Loss: 0.77243 (QuantReg: 15.74392) QuantErr: 15.74392 batch_time=0.58759 
Train Epoch: 47 [144/250 18432/32000 (58%)] Loss: 0.74066 (QuantReg: 15.45370) QuantErr: 15.45370 batch_time=0.69351 
Train Epoch: 47 [155/250 19840/32000 (62%)] Loss: 0.87513 (QuantReg: 15.33609) QuantErr: 15.33609 batch_time=0.59143 
Train Epoch: 47 [166/250 21248/32000 (66%)] Loss: 0.78202 (QuantReg: 15.56198) QuantErr: 15.56198 batch_time=1.23321 
Train Epoch: 47 [177/250 22656/32000 (71%)] Loss: 1.01806 (QuantReg: 15.23895) QuantErr: 15.23895 batch_time=0.59634 
Train Epoch: 47 [188/250 24064/32000 (75%)] Loss: 0.61939 (QuantReg: 15.58638) QuantErr: 15.58638 batch_time=0.59044 
Train Epoch: 47 [199/250 25472/32000 (80%)] Loss: 0.65635 (QuantReg: 15.57458) QuantErr: 15.57458 batch_time=0.61073 
Train Epoch: 47 [210/250 26880/32000 (84%)] Loss: 0.77622 (QuantReg: 15.51661) QuantErr: 15.51661 batch_time=0.60146 
Train Epoch: 47 [221/250 28288/32000 (88%)] Loss: 0.88919 (QuantReg: 15.52595) QuantErr: 15.52595 batch_time=0.58642 
Train Epoch: 47 [232/250 29696/32000 (93%)] Loss: 0.74557 (QuantReg: 15.51396) QuantErr: 15.51396 batch_time=0.58844 
Train Epoch: 47 [243/250 31104/32000 (97%)] Loss: 0.77736 (QuantReg: 15.49316) QuantErr: 15.49316 batch_time=0.60202 
Train Epoch: 47 codebook_update_time=3.35549
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch47.pth ...
Done in 3.712s
removing stale ckpt [epoch 46] [took 0.00s]
 epoch          : 47
 loss           : 0.7919252419471741
 quant_reg      : 15.499291439056396
 quant_err      : 15.499291439056396
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 11750
 MSRVTT_full_val/t2v_metrics/R1: 39.23541247484909
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.092555331991953
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.811981488029424
 MSRVTT_full_val/v2t_metrics/R1: 43.46076458752515
 MSRVTT_full_val/v2t_metrics/R5: 78.67203219315896
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.746478873239437
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.04172047404056
 MSRVTT_full_test/t2v_metrics/R1: 15.618729096989966
 MSRVTT_full_test/t2v_metrics/R5: 40.40133779264214
 MSRVTT_full_test/t2v_metrics/R10: 54.046822742474916
 MSRVTT_full_test/t2v_metrics/R50: 82.20735785953177
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.71571906354515
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.429272204346354
 MSRVTT_full_test/v2t_metrics/R1: 19.933110367892976
 MSRVTT_full_test/v2t_metrics/R5: 47.9933110367893
 MSRVTT_full_test/v2t_metrics/R10: 62.94314381270903
 MSRVTT_full_test/v2t_metrics/R50: 88.52842809364549
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.17458193979933
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.19536727575621
 mnt_best       : 32.89801005500416
 not_improved_count: 14
Train Epoch: 48 [1/250 128/32000 (0%)] Loss: 0.89706 (QuantReg: 15.40253) QuantErr: 15.40253 batch_time=29.68385 
Train Epoch: 48 [12/250 1536/32000 (5%)] Loss: 0.81155 (QuantReg: 15.71165) QuantErr: 15.71165 batch_time=0.60099 
Train Epoch: 48 [23/250 2944/32000 (9%)] Loss: 0.61535 (QuantReg: 15.58309) QuantErr: 15.58309 batch_time=0.94504 
Train Epoch: 48 [34/250 4352/32000 (14%)] Loss: 0.70991 (QuantReg: 15.57939) QuantErr: 15.57939 batch_time=0.73725 
Train Epoch: 48 [45/250 5760/32000 (18%)] Loss: 0.75677 (QuantReg: 15.25304) QuantErr: 15.25304 batch_time=0.59161 
Train Epoch: 48 [56/250 7168/32000 (22%)] Loss: 0.73093 (QuantReg: 15.63203) QuantErr: 15.63203 batch_time=0.58392 
Train Epoch: 48 [67/250 8576/32000 (27%)] Loss: 0.84302 (QuantReg: 15.52686) QuantErr: 15.52686 batch_time=0.60194 
Train Epoch: 48 [78/250 9984/32000 (31%)] Loss: 0.70025 (QuantReg: 15.44600) QuantErr: 15.44600 batch_time=0.59860 
Train Epoch: 48 [89/250 11392/32000 (36%)] Loss: 0.66501 (QuantReg: 15.43068) QuantErr: 15.43068 batch_time=0.57688 
Train Epoch: 48 [100/250 12800/32000 (40%)] Loss: 0.74455 (QuantReg: 15.54929) QuantErr: 15.54929 batch_time=0.60501 
Train Epoch: 48 [111/250 14208/32000 (44%)] Loss: 0.68766 (QuantReg: 15.53878) QuantErr: 15.53878 batch_time=0.93630 
Train Epoch: 48 [122/250 15616/32000 (49%)] Loss: 0.80547 (QuantReg: 15.46271) QuantErr: 15.46271 batch_time=0.59699 
Train Epoch: 48 [133/250 17024/32000 (53%)] Loss: 0.75242 (QuantReg: 15.34610) QuantErr: 15.34610 batch_time=0.60538 
Train Epoch: 48 [144/250 18432/32000 (58%)] Loss: 0.75500 (QuantReg: 15.52993) QuantErr: 15.52993 batch_time=2.15445 
Train Epoch: 48 [155/250 19840/32000 (62%)] Loss: 0.67513 (QuantReg: 15.72286) QuantErr: 15.72286 batch_time=0.59971 
Train Epoch: 48 [166/250 21248/32000 (66%)] Loss: 1.03033 (QuantReg: 15.40246) QuantErr: 15.40246 batch_time=0.59966 
Train Epoch: 48 [177/250 22656/32000 (71%)] Loss: 0.64587 (QuantReg: 15.57640) QuantErr: 15.57640 batch_time=0.57806 
Train Epoch: 48 [188/250 24064/32000 (75%)] Loss: 0.78496 (QuantReg: 15.42222) QuantErr: 15.42222 batch_time=0.58749 
Train Epoch: 48 [199/250 25472/32000 (80%)] Loss: 0.96706 (QuantReg: 15.61105) QuantErr: 15.61105 batch_time=0.61278 
Train Epoch: 48 [210/250 26880/32000 (84%)] Loss: 0.76180 (QuantReg: 15.58088) QuantErr: 15.58088 batch_time=0.62314 
Train Epoch: 48 [221/250 28288/32000 (88%)] Loss: 0.81553 (QuantReg: 15.44336) QuantErr: 15.44336 batch_time=0.59980 
Train Epoch: 48 [232/250 29696/32000 (93%)] Loss: 1.03834 (QuantReg: 15.66304) QuantErr: 15.66304 batch_time=2.44903 
Train Epoch: 48 [243/250 31104/32000 (97%)] Loss: 0.95346 (QuantReg: 15.32829) QuantErr: 15.32829 batch_time=0.59450 
Train Epoch: 48 codebook_update_time=3.53513
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch48.pth ...
Done in 3.954s
removing stale ckpt [epoch 47] [took 0.01s]
 epoch          : 48
 loss           : 0.7889854774475098
 quant_reg      : 15.495303657531739
 quant_err      : 15.495303657531739
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 37.42454728370221
 MSRVTT_full_val/t2v_metrics/R5: 72.83702213279678
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.883299798792756
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.90924106648764
 MSRVTT_full_val/v2t_metrics/R1: 43.05835010060362
 MSRVTT_full_val/v2t_metrics/R5: 79.27565392354124
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.565392354124748
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.9025142817223
 MSRVTT_full_test/t2v_metrics/R1: 15.953177257525084
 MSRVTT_full_test/t2v_metrics/R5: 40.10033444816054
 MSRVTT_full_test/t2v_metrics/R10: 53.94648829431438
 MSRVTT_full_test/t2v_metrics/R50: 82.50836120401338
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.1
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.55763036344264
 MSRVTT_full_test/v2t_metrics/R1: 19.598662207357858
 MSRVTT_full_test/v2t_metrics/R5: 48.66220735785953
 MSRVTT_full_test/v2t_metrics/R10: 62.34113712374582
 MSRVTT_full_test/v2t_metrics/R50: 87.92642140468227
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.879933110367894
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.02991907346891
 mnt_best       : 32.89801005500416
 not_improved_count: 15
Train Epoch: 49 [1/250 128/32000 (0%)] Loss: 0.66667 (QuantReg: 15.42473) QuantErr: 15.42473 batch_time=33.97730 
Train Epoch: 49 [12/250 1536/32000 (5%)] Loss: 0.66491 (QuantReg: 15.53787) QuantErr: 15.53787 batch_time=0.58397 
Train Epoch: 49 [23/250 2944/32000 (9%)] Loss: 0.71669 (QuantReg: 15.52763) QuantErr: 15.52763 batch_time=0.57678 
Train Epoch: 49 [34/250 4352/32000 (14%)] Loss: 0.73283 (QuantReg: 15.60028) QuantErr: 15.60028 batch_time=0.57729 
Train Epoch: 49 [45/250 5760/32000 (18%)] Loss: 0.57854 (QuantReg: 15.60423) QuantErr: 15.60423 batch_time=0.58459 
Train Epoch: 49 [56/250 7168/32000 (22%)] Loss: 0.93682 (QuantReg: 15.52312) QuantErr: 15.52312 batch_time=0.58687 
Train Epoch: 49 [67/250 8576/32000 (27%)] Loss: 0.77194 (QuantReg: 15.64002) QuantErr: 15.64002 batch_time=0.58423 
Train Epoch: 49 [78/250 9984/32000 (31%)] Loss: 0.72748 (QuantReg: 15.38744) QuantErr: 15.38744 batch_time=0.59569 
Train Epoch: 49 [89/250 11392/32000 (36%)] Loss: 0.98431 (QuantReg: 15.38231) QuantErr: 15.38231 batch_time=2.36920 
Train Epoch: 49 [100/250 12800/32000 (40%)] Loss: 0.73752 (QuantReg: 15.45247) QuantErr: 15.45247 batch_time=0.60790 
Train Epoch: 49 [111/250 14208/32000 (44%)] Loss: 0.76921 (QuantReg: 15.57876) QuantErr: 15.57876 batch_time=1.25248 
Train Epoch: 49 [122/250 15616/32000 (49%)] Loss: 0.96788 (QuantReg: 15.23804) QuantErr: 15.23804 batch_time=0.58586 
Train Epoch: 49 [133/250 17024/32000 (53%)] Loss: 0.94060 (QuantReg: 15.35073) QuantErr: 15.35073 batch_time=0.58078 
Train Epoch: 49 [144/250 18432/32000 (58%)] Loss: 0.76385 (QuantReg: 15.53986) QuantErr: 15.53986 batch_time=0.60968 
Train Epoch: 49 [155/250 19840/32000 (62%)] Loss: 0.80202 (QuantReg: 15.60131) QuantErr: 15.60131 batch_time=0.59833 
Train Epoch: 49 [166/250 21248/32000 (66%)] Loss: 0.82714 (QuantReg: 15.46864) QuantErr: 15.46864 batch_time=0.61533 
Train Epoch: 49 [177/250 22656/32000 (71%)] Loss: 0.71211 (QuantReg: 15.44704) QuantErr: 15.44704 batch_time=0.60483 
Train Epoch: 49 [188/250 24064/32000 (75%)] Loss: 0.80754 (QuantReg: 15.48445) QuantErr: 15.48445 batch_time=0.71329 
Train Epoch: 49 [199/250 25472/32000 (80%)] Loss: 0.80313 (QuantReg: 15.64976) QuantErr: 15.64976 batch_time=0.59167 
Train Epoch: 49 [210/250 26880/32000 (84%)] Loss: 0.88650 (QuantReg: 15.51623) QuantErr: 15.51623 batch_time=0.59083 
Train Epoch: 49 [221/250 28288/32000 (88%)] Loss: 0.85760 (QuantReg: 15.63365) QuantErr: 15.63365 batch_time=0.59384 
Train Epoch: 49 [232/250 29696/32000 (93%)] Loss: 0.57154 (QuantReg: 15.55883) QuantErr: 15.55883 batch_time=0.58879 
Train Epoch: 49 [243/250 31104/32000 (97%)] Loss: 0.72005 (QuantReg: 15.42146) QuantErr: 15.42146 batch_time=0.58506 
Train Epoch: 49 codebook_update_time=3.63795
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch49.pth ...
Done in 4.239s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 0.7785479011535644
 quant_reg      : 15.489645137786866
 quant_err      : 15.489645137786866
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 12250
 MSRVTT_full_val/t2v_metrics/R1: 37.625754527162975
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.11871227364185
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.85630609408314
 MSRVTT_full_val/v2t_metrics/R1: 43.25955734406438
 MSRVTT_full_val/v2t_metrics/R5: 79.67806841046277
 MSRVTT_full_val/v2t_metrics/R10: 88.93360160965794
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.72635814889336
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 67.42623600275644
 MSRVTT_full_test/t2v_metrics/R1: 15.08361204013378
 MSRVTT_full_test/t2v_metrics/R5: 39.83277591973244
 MSRVTT_full_test/t2v_metrics/R10: 52.97658862876254
 MSRVTT_full_test/t2v_metrics/R50: 82.10702341137124
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.30501672240803
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.691537202287233
 MSRVTT_full_test/v2t_metrics/R1: 18.729096989966557
 MSRVTT_full_test/v2t_metrics/R5: 47.625418060200666
 MSRVTT_full_test/v2t_metrics/R10: 63.21070234113712
 MSRVTT_full_test/v2t_metrics/R50: 88.22742474916387
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.879933110367894
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.345589481122104
 mnt_best       : 32.89801005500416
 not_improved_count: 16
Train Epoch: 50 [1/250 128/32000 (0%)] Loss: 0.74810 (QuantReg: 15.50886) QuantErr: 15.50886 batch_time=33.45795 
Train Epoch: 50 [12/250 1536/32000 (5%)] Loss: 0.69584 (QuantReg: 15.54379) QuantErr: 15.54379 batch_time=0.59459 
Train Epoch: 50 [23/250 2944/32000 (9%)] Loss: 0.74785 (QuantReg: 15.53377) QuantErr: 15.53377 batch_time=0.58462 
Train Epoch: 50 [34/250 4352/32000 (14%)] Loss: 0.72603 (QuantReg: 15.65963) QuantErr: 15.65963 batch_time=0.60861 
Train Epoch: 50 [45/250 5760/32000 (18%)] Loss: 0.95993 (QuantReg: 15.39206) QuantErr: 15.39206 batch_time=0.59819 
Train Epoch: 50 [56/250 7168/32000 (22%)] Loss: 0.68518 (QuantReg: 15.60140) QuantErr: 15.60140 batch_time=0.59724 
Train Epoch: 50 [67/250 8576/32000 (27%)] Loss: 0.72634 (QuantReg: 15.62440) QuantErr: 15.62440 batch_time=0.59817 
Train Epoch: 50 [78/250 9984/32000 (31%)] Loss: 0.87208 (QuantReg: 15.41445) QuantErr: 15.41445 batch_time=0.60339 
Train Epoch: 50 [89/250 11392/32000 (36%)] Loss: 0.77781 (QuantReg: 15.52583) QuantErr: 15.52583 batch_time=0.60409 
Train Epoch: 50 [100/250 12800/32000 (40%)] Loss: 0.63713 (QuantReg: 15.39285) QuantErr: 15.39285 batch_time=0.60518 
Train Epoch: 50 [111/250 14208/32000 (44%)] Loss: 0.79456 (QuantReg: 15.52394) QuantErr: 15.52394 batch_time=0.72878 
Train Epoch: 50 [122/250 15616/32000 (49%)] Loss: 0.74210 (QuantReg: 15.59528) QuantErr: 15.59528 batch_time=0.59951 
Train Epoch: 50 [133/250 17024/32000 (53%)] Loss: 0.82954 (QuantReg: 15.55289) QuantErr: 15.55289 batch_time=0.58512 
Train Epoch: 50 [144/250 18432/32000 (58%)] Loss: 0.80664 (QuantReg: 15.29562) QuantErr: 15.29562 batch_time=0.59197 
Train Epoch: 50 [155/250 19840/32000 (62%)] Loss: 1.00157 (QuantReg: 15.45962) QuantErr: 15.45962 batch_time=0.59768 
Train Epoch: 50 [166/250 21248/32000 (66%)] Loss: 0.59080 (QuantReg: 15.68094) QuantErr: 15.68094 batch_time=0.59383 
Train Epoch: 50 [177/250 22656/32000 (71%)] Loss: 0.85537 (QuantReg: 15.45237) QuantErr: 15.45237 batch_time=0.59798 
Train Epoch: 50 [188/250 24064/32000 (75%)] Loss: 0.93872 (QuantReg: 15.43472) QuantErr: 15.43472 batch_time=0.69622 
Train Epoch: 50 [199/250 25472/32000 (80%)] Loss: 0.57612 (QuantReg: 15.59457) QuantErr: 15.59457 batch_time=1.61760 
Train Epoch: 50 [210/250 26880/32000 (84%)] Loss: 0.80628 (QuantReg: 15.57474) QuantErr: 15.57474 batch_time=0.59056 
Train Epoch: 50 [221/250 28288/32000 (88%)] Loss: 0.76617 (QuantReg: 15.37577) QuantErr: 15.37577 batch_time=0.59114 
Train Epoch: 50 [232/250 29696/32000 (93%)] Loss: 0.85675 (QuantReg: 15.54220) QuantErr: 15.54220 batch_time=0.80049 
Train Epoch: 50 [243/250 31104/32000 (97%)] Loss: 0.79640 (QuantReg: 15.47066) QuantErr: 15.47066 batch_time=0.60028 
Train Epoch: 50 codebook_update_time=3.16436
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/checkpoint-epoch50.pth ...
Done in 4.019s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 0.7751973383426666
 quant_reg      : 15.500000602722167
 quant_err      : 15.500000602722167
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 38.83299798792756
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.09456740442656
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 61.634162637319776
 MSRVTT_full_val/v2t_metrics/R1: 42.65593561368209
 MSRVTT_full_val/v2t_metrics/R5: 79.47686116700201
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.814889336016097
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.80081213073106
 MSRVTT_full_test/t2v_metrics/R1: 15.183946488294314
 MSRVTT_full_test/t2v_metrics/R5: 40.60200668896321
 MSRVTT_full_test/t2v_metrics/R10: 54.046822742474916
 MSRVTT_full_test/t2v_metrics/R50: 82.6086956521739
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.6690635451505
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 32.17862211256979
 MSRVTT_full_test/v2t_metrics/R1: 19.096989966555185
 MSRVTT_full_test/v2t_metrics/R5: 48.49498327759197
 MSRVTT_full_test/v2t_metrics/R10: 62.84280936454849
 MSRVTT_full_test/v2t_metrics/R50: 88.12709030100335
 MSRVTT_full_test/v2t_metrics/MedR: 6.0
 MSRVTT_full_test/v2t_metrics/MeanR: 27.395652173913042
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.753039874555064
 mnt_best       : 32.89801005500416
 not_improved_count: 17
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/trained_model.pth ...
Ckpt loaded at epoch 33.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 16.02006688963211
 t2v_metrics/R5/final_eval: 40.96989966555184
 t2v_metrics/R10/final_eval: 54.247491638795985
 t2v_metrics/R50/final_eval: 83.01003344481606
 t2v_metrics/MedR/final_eval: 8.0
 t2v_metrics/MeanR/final_eval: 40.47926421404682
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 32.89801005500416
 v2t_metrics/R1/final_eval: 19.163879598662206
 v2t_metrics/R5/final_eval: 48.26086956521739
 v2t_metrics/R10/final_eval: 62.94314381270903
 v2t_metrics/R50/final_eval: 88.69565217391305
 v2t_metrics/MedR/final_eval: 6.0
 v2t_metrics/MeanR/final_eval: 26.649498327759197
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 38.75630238680506
Best epoch for the monitored metric: 33
Script took 04h20m34s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_M64/trained_model.pth
