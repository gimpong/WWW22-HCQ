Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 1022.5835797786713 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 66.12120866775513 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 354.9544880390167 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 102.38593196868896 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch0.pth ...
Done in 1.758s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch0.pth ...
Done in 3.453s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.0
 MSRVTT_full_val/t2v_metrics/R5: 1.2072434607645874
 MSRVTT_full_val/t2v_metrics/R10: 1.6096579476861168
 MSRVTT_full_val/t2v_metrics/R50: 8.450704225352112
 MSRVTT_full_val/t2v_metrics/MedR: 252.0
 MSRVTT_full_val/t2v_metrics/MeanR: 251.21730382293762
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_val/v2t_metrics/R1: 0.0
 MSRVTT_full_val/v2t_metrics/R5: 0.8048289738430584
 MSRVTT_full_val/v2t_metrics/R10: 2.0120724346076457
 MSRVTT_full_val/v2t_metrics/R50: 9.054325955734406
 MSRVTT_full_val/v2t_metrics/MedR: 243.0
 MSRVTT_full_val/v2t_metrics/MeanR: 247.7344064386318
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/t2v_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/t2v_metrics/R5: 0.20066889632107024
 MSRVTT_full_test/t2v_metrics/R10: 0.26755852842809363
 MSRVTT_full_test/t2v_metrics/R50: 1.705685618729097
 MSRVTT_full_test/t2v_metrics/MedR: 1515.0
 MSRVTT_full_test/t2v_metrics/MeanR: 1498.5565217391304
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.12154652794863813
 MSRVTT_full_test/v2t_metrics/R1: 0.06688963210702341
 MSRVTT_full_test/v2t_metrics/R5: 0.16722408026755853
 MSRVTT_full_test/v2t_metrics/R10: 0.3010033444816054
 MSRVTT_full_test/v2t_metrics/R50: 1.806020066889632
 MSRVTT_full_test/v2t_metrics/MedR: 1471.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1495.3264214046824
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.14987975740993859
 mnt_best       : 0.12154652794863813
 not_improved_count: 0
Train Epoch: 1 [1/250 128/32000 (0%)] Loss: 9.83601 (QuantReg: 22.44707) QuantErr: 22.44707 batch_time=35.14457 
Train Epoch: 1 [12/250 1536/32000 (5%)] Loss: 8.85996 (QuantReg: 22.52926) QuantErr: 22.52926 batch_time=0.53314 
Train Epoch: 1 [23/250 2944/32000 (9%)] Loss: 7.16728 (QuantReg: 22.56572) QuantErr: 22.56572 batch_time=0.61335 
Train Epoch: 1 [34/250 4352/32000 (14%)] Loss: 6.96779 (QuantReg: 22.61984) QuantErr: 22.61984 batch_time=0.62287 
Train Epoch: 1 [45/250 5760/32000 (18%)] Loss: 6.37450 (QuantReg: 22.61680) QuantErr: 22.61680 batch_time=0.52641 
Train Epoch: 1 [56/250 7168/32000 (22%)] Loss: 6.11715 (QuantReg: 22.61637) QuantErr: 22.61637 batch_time=0.58820 
Train Epoch: 1 [67/250 8576/32000 (27%)] Loss: 6.09436 (QuantReg: 22.59203) QuantErr: 22.59203 batch_time=0.58439 
Train Epoch: 1 [78/250 9984/32000 (31%)] Loss: 5.76966 (QuantReg: 22.63376) QuantErr: 22.63376 batch_time=0.55744 
Train Epoch: 1 [89/250 11392/32000 (36%)] Loss: 5.23123 (QuantReg: 22.62047) QuantErr: 22.62047 batch_time=0.55652 
Train Epoch: 1 [100/250 12800/32000 (40%)] Loss: 5.52448 (QuantReg: 22.64792) QuantErr: 22.64792 batch_time=0.54679 
Train Epoch: 1 [111/250 14208/32000 (44%)] Loss: 5.05527 (QuantReg: 22.64563) QuantErr: 22.64563 batch_time=0.50905 
Train Epoch: 1 [122/250 15616/32000 (49%)] Loss: 4.77527 (QuantReg: 22.66315) QuantErr: 22.66315 batch_time=0.53107 
Train Epoch: 1 [133/250 17024/32000 (53%)] Loss: 4.80842 (QuantReg: 22.62115) QuantErr: 22.62115 batch_time=0.53336 
Train Epoch: 1 [144/250 18432/32000 (58%)] Loss: 4.62151 (QuantReg: 22.68834) QuantErr: 22.68834 batch_time=0.58103 
Train Epoch: 1 [155/250 19840/32000 (62%)] Loss: 4.79429 (QuantReg: 22.62875) QuantErr: 22.62875 batch_time=0.52455 
Train Epoch: 1 [166/250 21248/32000 (66%)] Loss: 4.98667 (QuantReg: 22.63139) QuantErr: 22.63139 batch_time=0.54299 
Train Epoch: 1 [177/250 22656/32000 (71%)] Loss: 4.66633 (QuantReg: 22.63806) QuantErr: 22.63806 batch_time=0.54032 
Train Epoch: 1 [188/250 24064/32000 (75%)] Loss: 4.37311 (QuantReg: 22.66245) QuantErr: 22.66245 batch_time=0.50855 
Train Epoch: 1 [199/250 25472/32000 (80%)] Loss: 4.39968 (QuantReg: 22.61786) QuantErr: 22.61786 batch_time=0.50880 
Train Epoch: 1 [210/250 26880/32000 (84%)] Loss: 4.09325 (QuantReg: 22.62950) QuantErr: 22.62950 batch_time=0.59869 
Train Epoch: 1 [221/250 28288/32000 (88%)] Loss: 4.40390 (QuantReg: 22.63296) QuantErr: 22.63296 batch_time=0.50985 
Train Epoch: 1 [232/250 29696/32000 (93%)] Loss: 4.20040 (QuantReg: 22.69141) QuantErr: 22.69141 batch_time=0.58151 
Train Epoch: 1 [243/250 31104/32000 (97%)] Loss: 3.91421 (QuantReg: 22.64389) QuantErr: 22.64389 batch_time=0.58514 
Train Epoch: 1 codebook_update_time=1.87644
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch1.pth ...
Done in 4.078s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch1.pth ...
Done in 8.461s
 epoch          : 1
 loss           : 5.3136826505661015
 quant_reg      : 22.62510693359375
 quant_err      : 22.62510693359375
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 250
 MSRVTT_full_val/t2v_metrics/R1: 19.919517102615693
 MSRVTT_full_val/t2v_metrics/R5: 51.30784708249497
 MSRVTT_full_val/t2v_metrics/R10: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R50: 95.97585513078471
 MSRVTT_full_val/t2v_metrics/MedR: 5.0
 MSRVTT_full_val/t2v_metrics/MeanR: 12.672032193158953
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 40.829876616690115
 MSRVTT_full_val/v2t_metrics/R1: 21.93158953722334
 MSRVTT_full_val/v2t_metrics/R5: 58.75251509054326
 MSRVTT_full_val/v2t_metrics/R10: 72.23340040241449
 MSRVTT_full_val/v2t_metrics/R50: 94.56740442655935
 MSRVTT_full_val/v2t_metrics/MedR: 4.0
 MSRVTT_full_val/v2t_metrics/MeanR: 11.96579476861167
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 45.31878006517563
 MSRVTT_full_test/t2v_metrics/R1: 6.989966555183947
 MSRVTT_full_test/t2v_metrics/R5: 21.638795986622075
 MSRVTT_full_test/t2v_metrics/R10: 32.90969899665552
 MSRVTT_full_test/t2v_metrics/R50: 67.22408026755853
 MSRVTT_full_test/t2v_metrics/MedR: 23.0
 MSRVTT_full_test/t2v_metrics/MeanR: 68.29866220735786
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 17.074344252666624
 MSRVTT_full_test/v2t_metrics/R1: 7.157190635451505
 MSRVTT_full_test/v2t_metrics/R5: 24.347826086956523
 MSRVTT_full_test/v2t_metrics/R10: 36.58862876254181
 MSRVTT_full_test/v2t_metrics/R50: 71.73913043478261
 MSRVTT_full_test/v2t_metrics/MedR: 20.0
 MSRVTT_full_test/v2t_metrics/MeanR: 62.57809364548495
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 18.54312687766534
 mnt_best       : 17.074344252666624
 not_improved_count: 0
Train Epoch: 2 [1/250 128/32000 (0%)] Loss: 3.54046 (QuantReg: 12.01409) QuantErr: 12.01409 batch_time=41.73562 
Train Epoch: 2 [12/250 1536/32000 (5%)] Loss: 3.93292 (QuantReg: 12.39205) QuantErr: 12.39205 batch_time=0.50230 
Train Epoch: 2 [23/250 2944/32000 (9%)] Loss: 3.81195 (QuantReg: 12.47752) QuantErr: 12.47752 batch_time=0.52521 
Train Epoch: 2 [34/250 4352/32000 (14%)] Loss: 3.65322 (QuantReg: 12.56524) QuantErr: 12.56524 batch_time=0.61843 
Train Epoch: 2 [45/250 5760/32000 (18%)] Loss: 3.63213 (QuantReg: 12.83250) QuantErr: 12.83250 batch_time=0.52966 
Train Epoch: 2 [56/250 7168/32000 (22%)] Loss: 3.81472 (QuantReg: 12.57137) QuantErr: 12.57137 batch_time=0.50328 
Train Epoch: 2 [67/250 8576/32000 (27%)] Loss: 3.93923 (QuantReg: 13.09774) QuantErr: 13.09774 batch_time=0.57035 
Train Epoch: 2 [78/250 9984/32000 (31%)] Loss: 3.50291 (QuantReg: 13.29130) QuantErr: 13.29130 batch_time=0.62475 
Train Epoch: 2 [89/250 11392/32000 (36%)] Loss: 4.08532 (QuantReg: 13.28710) QuantErr: 13.28710 batch_time=0.50778 
Train Epoch: 2 [100/250 12800/32000 (40%)] Loss: 3.47723 (QuantReg: 13.49839) QuantErr: 13.49839 batch_time=0.58172 
Train Epoch: 2 [111/250 14208/32000 (44%)] Loss: 3.50694 (QuantReg: 13.58084) QuantErr: 13.58084 batch_time=0.56823 
Train Epoch: 2 [122/250 15616/32000 (49%)] Loss: 3.25665 (QuantReg: 14.01648) QuantErr: 14.01648 batch_time=0.55725 
Train Epoch: 2 [133/250 17024/32000 (53%)] Loss: 3.25069 (QuantReg: 13.69487) QuantErr: 13.69487 batch_time=0.52820 
Train Epoch: 2 [144/250 18432/32000 (58%)] Loss: 3.45960 (QuantReg: 13.91894) QuantErr: 13.91894 batch_time=0.62018 
Train Epoch: 2 [155/250 19840/32000 (62%)] Loss: 3.19850 (QuantReg: 13.95918) QuantErr: 13.95918 batch_time=0.55077 
Train Epoch: 2 [166/250 21248/32000 (66%)] Loss: 3.20213 (QuantReg: 14.64342) QuantErr: 14.64342 batch_time=0.54448 
Train Epoch: 2 [177/250 22656/32000 (71%)] Loss: 3.45062 (QuantReg: 14.41717) QuantErr: 14.41717 batch_time=0.50726 
Train Epoch: 2 [188/250 24064/32000 (75%)] Loss: 3.44118 (QuantReg: 14.57709) QuantErr: 14.57709 batch_time=0.68350 
Train Epoch: 2 [199/250 25472/32000 (80%)] Loss: 3.14286 (QuantReg: 14.26092) QuantErr: 14.26092 batch_time=5.05866 
Train Epoch: 2 [210/250 26880/32000 (84%)] Loss: 2.99660 (QuantReg: 14.49301) QuantErr: 14.49301 batch_time=1.25176 
Train Epoch: 2 [221/250 28288/32000 (88%)] Loss: 2.76733 (QuantReg: 14.67500) QuantErr: 14.67500 batch_time=0.59315 
Train Epoch: 2 [232/250 29696/32000 (93%)] Loss: 3.86488 (QuantReg: 14.72295) QuantErr: 14.72295 batch_time=0.55742 
Train Epoch: 2 [243/250 31104/32000 (97%)] Loss: 3.37663 (QuantReg: 15.07507) QuantErr: 15.07507 batch_time=0.54472 
Train Epoch: 2 codebook_update_time=1.67365
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch2.pth ...
Done in 12.960s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch2.pth ...
Done in 29.122s
removing stale ckpt [epoch 1] [took 0.01s]
removing stale ckpt [epoch 0] [took 0.01s]
 epoch          : 2
 loss           : 3.511594988822937
 quant_reg      : 13.67512890625
 quant_err      : 13.67512890625
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 23.138832997987926
 MSRVTT_full_val/t2v_metrics/R5: 60.160965794768615
 MSRVTT_full_val/t2v_metrics/R10: 73.8430583501006
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.746478873239436
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 46.84414416955262
 MSRVTT_full_val/v2t_metrics/R1: 27.364185110663986
 MSRVTT_full_val/v2t_metrics/R5: 67.6056338028169
 MSRVTT_full_val/v2t_metrics/R10: 80.6841046277666
 MSRVTT_full_val/v2t_metrics/R50: 96.78068410462777
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.865191146881287
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 53.04581553683502
 MSRVTT_full_test/t2v_metrics/R1: 8.22742474916388
 MSRVTT_full_test/t2v_metrics/R5: 26.722408026755854
 MSRVTT_full_test/t2v_metrics/R10: 39.264214046822744
 MSRVTT_full_test/t2v_metrics/R50: 72.97658862876254
 MSRVTT_full_test/t2v_metrics/MedR: 17.0
 MSRVTT_full_test/t2v_metrics/MeanR: 57.19498327759197
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 20.513769569180845
 MSRVTT_full_test/v2t_metrics/R1: 10.535117056856187
 MSRVTT_full_test/v2t_metrics/R5: 30.869565217391305
 MSRVTT_full_test/v2t_metrics/R10: 43.84615384615385
 MSRVTT_full_test/v2t_metrics/R50: 78.26086956521739
 MSRVTT_full_test/v2t_metrics/MedR: 14.0
 MSRVTT_full_test/v2t_metrics/MeanR: 45.150334448160535
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 24.24937002350997
 mnt_best       : 20.513769569180845
 not_improved_count: 0
Train Epoch: 3 [1/250 128/32000 (0%)] Loss: 2.95852 (QuantReg: 12.27915) QuantErr: 12.27915 batch_time=52.21468 
Train Epoch: 3 [12/250 1536/32000 (5%)] Loss: 3.14480 (QuantReg: 12.44404) QuantErr: 12.44404 batch_time=0.55308 
Train Epoch: 3 [23/250 2944/32000 (9%)] Loss: 3.47106 (QuantReg: 12.86234) QuantErr: 12.86234 batch_time=0.59734 
Train Epoch: 3 [34/250 4352/32000 (14%)] Loss: 2.65865 (QuantReg: 12.15534) QuantErr: 12.15534 batch_time=0.50995 
Train Epoch: 3 [45/250 5760/32000 (18%)] Loss: 3.21549 (QuantReg: 12.48284) QuantErr: 12.48284 batch_time=0.57618 
Train Epoch: 3 [56/250 7168/32000 (22%)] Loss: 2.60299 (QuantReg: 12.76546) QuantErr: 12.76546 batch_time=0.50675 
Train Epoch: 3 [67/250 8576/32000 (27%)] Loss: 2.80472 (QuantReg: 12.67714) QuantErr: 12.67714 batch_time=0.79967 
Train Epoch: 3 [78/250 9984/32000 (31%)] Loss: 3.02620 (QuantReg: 12.70516) QuantErr: 12.70516 batch_time=0.54698 
Train Epoch: 3 [89/250 11392/32000 (36%)] Loss: 3.04814 (QuantReg: 12.78236) QuantErr: 12.78236 batch_time=0.51678 
Train Epoch: 3 [100/250 12800/32000 (40%)] Loss: 2.78944 (QuantReg: 12.52773) QuantErr: 12.52773 batch_time=0.54072 
Train Epoch: 3 [111/250 14208/32000 (44%)] Loss: 2.98643 (QuantReg: 12.52534) QuantErr: 12.52534 batch_time=0.55113 
Train Epoch: 3 [122/250 15616/32000 (49%)] Loss: 2.55634 (QuantReg: 12.83131) QuantErr: 12.83131 batch_time=0.51294 
Train Epoch: 3 [133/250 17024/32000 (53%)] Loss: 3.06464 (QuantReg: 13.12629) QuantErr: 13.12629 batch_time=0.51400 
Train Epoch: 3 [144/250 18432/32000 (58%)] Loss: 2.76009 (QuantReg: 13.24108) QuantErr: 13.24108 batch_time=0.51163 
Train Epoch: 3 [155/250 19840/32000 (62%)] Loss: 3.58899 (QuantReg: 12.86288) QuantErr: 12.86288 batch_time=0.51610 
Train Epoch: 3 [166/250 21248/32000 (66%)] Loss: 2.23875 (QuantReg: 13.76208) QuantErr: 13.76208 batch_time=0.56785 
Train Epoch: 3 [177/250 22656/32000 (71%)] Loss: 2.48953 (QuantReg: 13.24901) QuantErr: 13.24901 batch_time=0.51202 
Train Epoch: 3 [188/250 24064/32000 (75%)] Loss: 3.08478 (QuantReg: 13.04236) QuantErr: 13.04236 batch_time=0.53615 
Train Epoch: 3 [199/250 25472/32000 (80%)] Loss: 2.60918 (QuantReg: 13.03259) QuantErr: 13.03259 batch_time=0.55612 
Train Epoch: 3 [210/250 26880/32000 (84%)] Loss: 2.82892 (QuantReg: 13.49016) QuantErr: 13.49016 batch_time=0.55459 
Train Epoch: 3 [221/250 28288/32000 (88%)] Loss: 2.56724 (QuantReg: 13.55560) QuantErr: 13.55560 batch_time=0.52010 
Train Epoch: 3 [232/250 29696/32000 (93%)] Loss: 2.34663 (QuantReg: 13.76391) QuantErr: 13.76391 batch_time=0.53779 
Train Epoch: 3 [243/250 31104/32000 (97%)] Loss: 2.65552 (QuantReg: 13.58110) QuantErr: 13.58110 batch_time=0.54008 
Train Epoch: 3 codebook_update_time=1.72436
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch3.pth ...
Done in 6.138s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch3.pth ...
Done in 18.980s
removing stale ckpt [epoch 2] [took 0.16s]
 epoch          : 3
 loss           : 2.900078523635864
 quant_reg      : 13.007189140319824
 quant_err      : 13.007189140319824
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 750
 MSRVTT_full_val/t2v_metrics/R1: 25.553319919517104
 MSRVTT_full_val/t2v_metrics/R5: 61.971830985915496
 MSRVTT_full_val/t2v_metrics/R10: 76.65995975855131
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.442655935613683
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 49.514996076983756
 MSRVTT_full_val/v2t_metrics/R1: 31.58953722334004
 MSRVTT_full_val/v2t_metrics/R5: 67.80684104627767
 MSRVTT_full_val/v2t_metrics/R10: 80.88531187122736
 MSRVTT_full_val/v2t_metrics/R50: 97.1830985915493
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.058350100603622
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 55.74793864419913
 MSRVTT_full_test/t2v_metrics/R1: 9.03010033444816
 MSRVTT_full_test/t2v_metrics/R5: 27.993311036789297
 MSRVTT_full_test/t2v_metrics/R10: 41.137123745819395
 MSRVTT_full_test/t2v_metrics/R50: 75.28428093645485
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 53.91438127090301
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 21.826976936102067
 MSRVTT_full_test/v2t_metrics/R1: 11.37123745819398
 MSRVTT_full_test/v2t_metrics/R5: 32.80936454849498
 MSRVTT_full_test/v2t_metrics/R10: 46.52173913043478
 MSRVTT_full_test/v2t_metrics/R50: 80.10033444816054
 MSRVTT_full_test/v2t_metrics/MedR: 12.0
 MSRVTT_full_test/v2t_metrics/MeanR: 45.085284280936456
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.89129838687588
 mnt_best       : 21.826976936102067
 not_improved_count: 0
Train Epoch: 4 [1/250 128/32000 (0%)] Loss: 3.17784 (QuantReg: 12.23457) QuantErr: 12.23457 batch_time=34.59153 
Train Epoch: 4 [12/250 1536/32000 (5%)] Loss: 2.71912 (QuantReg: 12.36826) QuantErr: 12.36826 batch_time=0.50962 
Train Epoch: 4 [23/250 2944/32000 (9%)] Loss: 2.17273 (QuantReg: 12.47676) QuantErr: 12.47676 batch_time=0.51988 
Train Epoch: 4 [34/250 4352/32000 (14%)] Loss: 2.39374 (QuantReg: 12.42306) QuantErr: 12.42306 batch_time=0.51946 
Train Epoch: 4 [45/250 5760/32000 (18%)] Loss: 2.68108 (QuantReg: 12.26249) QuantErr: 12.26249 batch_time=0.54022 
Train Epoch: 4 [56/250 7168/32000 (22%)] Loss: 3.02735 (QuantReg: 12.38818) QuantErr: 12.38818 batch_time=0.60972 
Train Epoch: 4 [67/250 8576/32000 (27%)] Loss: 3.00565 (QuantReg: 12.56863) QuantErr: 12.56863 batch_time=0.55761 
Train Epoch: 4 [78/250 9984/32000 (31%)] Loss: 2.81599 (QuantReg: 12.81678) QuantErr: 12.81678 batch_time=0.57313 
Train Epoch: 4 [89/250 11392/32000 (36%)] Loss: 2.59676 (QuantReg: 12.57445) QuantErr: 12.57445 batch_time=0.54855 
Train Epoch: 4 [100/250 12800/32000 (40%)] Loss: 2.55793 (QuantReg: 12.52168) QuantErr: 12.52168 batch_time=0.50296 
Train Epoch: 4 [111/250 14208/32000 (44%)] Loss: 2.72835 (QuantReg: 12.83059) QuantErr: 12.83059 batch_time=0.52618 
Train Epoch: 4 [122/250 15616/32000 (49%)] Loss: 2.60968 (QuantReg: 12.66768) QuantErr: 12.66768 batch_time=0.50612 
Train Epoch: 4 [133/250 17024/32000 (53%)] Loss: 2.53732 (QuantReg: 12.76329) QuantErr: 12.76329 batch_time=0.98479 
Train Epoch: 4 [144/250 18432/32000 (58%)] Loss: 2.67730 (QuantReg: 12.92435) QuantErr: 12.92435 batch_time=0.76167 
Train Epoch: 4 [155/250 19840/32000 (62%)] Loss: 2.79698 (QuantReg: 13.11701) QuantErr: 13.11701 batch_time=0.60453 
Train Epoch: 4 [166/250 21248/32000 (66%)] Loss: 2.93930 (QuantReg: 13.21875) QuantErr: 13.21875 batch_time=0.50950 
Train Epoch: 4 [177/250 22656/32000 (71%)] Loss: 2.93704 (QuantReg: 12.87346) QuantErr: 12.87346 batch_time=0.55148 
Train Epoch: 4 [188/250 24064/32000 (75%)] Loss: 2.70700 (QuantReg: 13.34987) QuantErr: 13.34987 batch_time=0.55618 
Train Epoch: 4 [199/250 25472/32000 (80%)] Loss: 2.74146 (QuantReg: 12.94382) QuantErr: 12.94382 batch_time=0.51867 
Train Epoch: 4 [210/250 26880/32000 (84%)] Loss: 2.39571 (QuantReg: 13.15816) QuantErr: 13.15816 batch_time=0.53494 
Train Epoch: 4 [221/250 28288/32000 (88%)] Loss: 2.33933 (QuantReg: 13.47045) QuantErr: 13.47045 batch_time=0.56690 
Train Epoch: 4 [232/250 29696/32000 (93%)] Loss: 2.59222 (QuantReg: 12.74652) QuantErr: 12.74652 batch_time=0.56915 
Train Epoch: 4 [243/250 31104/32000 (97%)] Loss: 2.40653 (QuantReg: 12.91019) QuantErr: 12.91019 batch_time=0.53398 
Train Epoch: 4 codebook_update_time=2.00432
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch4.pth ...
Done in 19.913s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch4.pth ...
Done in 24.935s
removing stale ckpt [epoch 3] [took 0.15s]
 epoch          : 4
 loss           : 2.5992415437698364
 quant_reg      : 12.807410766601562
 quant_err      : 12.807410766601562
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 25.150905432595575
 MSRVTT_full_val/t2v_metrics/R5: 60.96579476861167
 MSRVTT_full_val/t2v_metrics/R10: 75.0503018108652
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.839034205231389
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 48.64043337064883
 MSRVTT_full_val/v2t_metrics/R1: 29.37625754527163
 MSRVTT_full_val/v2t_metrics/R5: 72.03219315895372
 MSRVTT_full_val/v2t_metrics/R10: 83.90342052313883
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.130784708249497
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.204047274139995
 MSRVTT_full_test/t2v_metrics/R1: 9.565217391304348
 MSRVTT_full_test/t2v_metrics/R5: 27.45819397993311
 MSRVTT_full_test/t2v_metrics/R10: 41.070234113712374
 MSRVTT_full_test/t2v_metrics/R50: 74.74916387959867
 MSRVTT_full_test/t2v_metrics/MedR: 16.0
 MSRVTT_full_test/t2v_metrics/MeanR: 55.72107023411371
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.09520306901761
 MSRVTT_full_test/v2t_metrics/R1: 11.705685618729097
 MSRVTT_full_test/v2t_metrics/R5: 33.91304347826087
 MSRVTT_full_test/v2t_metrics/R10: 47.391304347826086
 MSRVTT_full_test/v2t_metrics/R50: 82.0066889632107
 MSRVTT_full_test/v2t_metrics/MedR: 12.0
 MSRVTT_full_test/v2t_metrics/MeanR: 41.81103678929766
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 26.59627173728336
 mnt_best       : 22.09520306901761
 not_improved_count: 0
Train Epoch: 5 [1/250 128/32000 (0%)] Loss: 2.57680 (QuantReg: 12.54195) QuantErr: 12.54195 batch_time=39.11689 
Train Epoch: 5 [12/250 1536/32000 (5%)] Loss: 2.69845 (QuantReg: 12.60822) QuantErr: 12.60822 batch_time=0.50447 
Train Epoch: 5 [23/250 2944/32000 (9%)] Loss: 2.78558 (QuantReg: 12.45181) QuantErr: 12.45181 batch_time=0.51655 
Train Epoch: 5 [34/250 4352/32000 (14%)] Loss: 2.09201 (QuantReg: 12.85870) QuantErr: 12.85870 batch_time=0.55504 
Train Epoch: 5 [45/250 5760/32000 (18%)] Loss: 2.31810 (QuantReg: 12.32722) QuantErr: 12.32722 batch_time=0.57536 
Train Epoch: 5 [56/250 7168/32000 (22%)] Loss: 2.46397 (QuantReg: 13.35134) QuantErr: 13.35134 batch_time=0.55678 
Train Epoch: 5 [67/250 8576/32000 (27%)] Loss: 2.37301 (QuantReg: 12.56506) QuantErr: 12.56506 batch_time=1.13575 
Train Epoch: 5 [78/250 9984/32000 (31%)] Loss: 2.58894 (QuantReg: 12.61009) QuantErr: 12.61009 batch_time=0.56695 
Train Epoch: 5 [89/250 11392/32000 (36%)] Loss: 2.09916 (QuantReg: 12.72439) QuantErr: 12.72439 batch_time=0.58284 
Train Epoch: 5 [100/250 12800/32000 (40%)] Loss: 2.52670 (QuantReg: 12.84987) QuantErr: 12.84987 batch_time=0.53734 
Train Epoch: 5 [111/250 14208/32000 (44%)] Loss: 2.22998 (QuantReg: 12.99709) QuantErr: 12.99709 batch_time=0.51683 
Train Epoch: 5 [122/250 15616/32000 (49%)] Loss: 2.25690 (QuantReg: 13.03214) QuantErr: 13.03214 batch_time=0.62460 
Train Epoch: 5 [133/250 17024/32000 (53%)] Loss: 2.46275 (QuantReg: 13.07800) QuantErr: 13.07800 batch_time=0.51342 
Train Epoch: 5 [144/250 18432/32000 (58%)] Loss: 1.67978 (QuantReg: 13.13015) QuantErr: 13.13015 batch_time=0.59997 
Train Epoch: 5 [155/250 19840/32000 (62%)] Loss: 2.33470 (QuantReg: 13.13824) QuantErr: 13.13824 batch_time=0.61158 
Train Epoch: 5 [166/250 21248/32000 (66%)] Loss: 2.29250 (QuantReg: 13.13954) QuantErr: 13.13954 batch_time=0.51421 
Train Epoch: 5 [177/250 22656/32000 (71%)] Loss: 2.14612 (QuantReg: 13.57609) QuantErr: 13.57609 batch_time=0.52995 
Train Epoch: 5 [188/250 24064/32000 (75%)] Loss: 2.53479 (QuantReg: 12.97376) QuantErr: 12.97376 batch_time=0.56716 
Train Epoch: 5 [199/250 25472/32000 (80%)] Loss: 2.10174 (QuantReg: 13.13409) QuantErr: 13.13409 batch_time=0.55033 
Train Epoch: 5 [210/250 26880/32000 (84%)] Loss: 2.33059 (QuantReg: 12.74100) QuantErr: 12.74100 batch_time=0.50108 
Train Epoch: 5 [221/250 28288/32000 (88%)] Loss: 2.31631 (QuantReg: 13.13864) QuantErr: 13.13864 batch_time=0.52277 
Train Epoch: 5 [232/250 29696/32000 (93%)] Loss: 1.93046 (QuantReg: 13.23812) QuantErr: 13.23812 batch_time=0.50725 
Train Epoch: 5 [243/250 31104/32000 (97%)] Loss: 2.12162 (QuantReg: 13.16052) QuantErr: 13.16052 batch_time=0.53594 
Train Epoch: 5 codebook_update_time=1.75064
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch5.pth ...
Done in 5.467s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch5.pth ...
Done in 10.531s
removing stale ckpt [epoch 4] [took 0.00s]
 epoch          : 5
 loss           : 2.307945333003998
 quant_reg      : 12.910928462982177
 quant_err      : 12.910928462982177
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 1250
 MSRVTT_full_val/t2v_metrics/R1: 28.772635814889338
 MSRVTT_full_val/t2v_metrics/R5: 65.59356136820925
 MSRVTT_full_val/t2v_metrics/R10: 80.28169014084507
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.951710261569417
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.31128151115823
 MSRVTT_full_val/v2t_metrics/R1: 31.388329979879277
 MSRVTT_full_val/v2t_metrics/R5: 73.8430583501006
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.729376257545272
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.396003215554785
 MSRVTT_full_test/t2v_metrics/R1: 10.133779264214047
 MSRVTT_full_test/t2v_metrics/R5: 30.735785953177256
 MSRVTT_full_test/t2v_metrics/R10: 44.31438127090301
 MSRVTT_full_test/t2v_metrics/R50: 77.59197324414716
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.67056856187291
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.987601076293736
 MSRVTT_full_test/v2t_metrics/R1: 12.240802675585284
 MSRVTT_full_test/v2t_metrics/R5: 36.72240802675585
 MSRVTT_full_test/v2t_metrics/R10: 51.53846153846154
 MSRVTT_full_test/v2t_metrics/R50: 83.4113712374582
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.8566889632107
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.50739279254908
 mnt_best       : 23.987601076293736
 not_improved_count: 0
Train Epoch: 6 [1/250 128/32000 (0%)] Loss: 2.43323 (QuantReg: 12.59281) QuantErr: 12.59281 batch_time=32.07245 
Train Epoch: 6 [12/250 1536/32000 (5%)] Loss: 2.39548 (QuantReg: 12.35006) QuantErr: 12.35006 batch_time=1.05758 
Train Epoch: 6 [23/250 2944/32000 (9%)] Loss: 1.95031 (QuantReg: 12.73042) QuantErr: 12.73042 batch_time=0.51929 
Train Epoch: 6 [34/250 4352/32000 (14%)] Loss: 2.23315 (QuantReg: 12.64951) QuantErr: 12.64951 batch_time=0.50162 
Train Epoch: 6 [45/250 5760/32000 (18%)] Loss: 1.65812 (QuantReg: 12.72907) QuantErr: 12.72907 batch_time=0.52145 
Train Epoch: 6 [56/250 7168/32000 (22%)] Loss: 2.00621 (QuantReg: 13.07515) QuantErr: 13.07515 batch_time=0.62085 
Train Epoch: 6 [67/250 8576/32000 (27%)] Loss: 2.10885 (QuantReg: 13.27433) QuantErr: 13.27433 batch_time=0.51519 
Train Epoch: 6 [78/250 9984/32000 (31%)] Loss: 1.72104 (QuantReg: 12.83606) QuantErr: 12.83606 batch_time=0.68747 
Train Epoch: 6 [89/250 11392/32000 (36%)] Loss: 2.32504 (QuantReg: 12.91540) QuantErr: 12.91540 batch_time=0.51729 
Train Epoch: 6 [100/250 12800/32000 (40%)] Loss: 2.07677 (QuantReg: 13.09188) QuantErr: 13.09188 batch_time=0.58237 
Train Epoch: 6 [111/250 14208/32000 (44%)] Loss: 2.14010 (QuantReg: 12.60723) QuantErr: 12.60723 batch_time=0.50752 
Train Epoch: 6 [122/250 15616/32000 (49%)] Loss: 2.07884 (QuantReg: 13.19710) QuantErr: 13.19710 batch_time=0.51800 
Train Epoch: 6 [133/250 17024/32000 (53%)] Loss: 2.04157 (QuantReg: 12.77241) QuantErr: 12.77241 batch_time=0.55455 
Train Epoch: 6 [144/250 18432/32000 (58%)] Loss: 2.22533 (QuantReg: 12.71221) QuantErr: 12.71221 batch_time=0.59906 
Train Epoch: 6 [155/250 19840/32000 (62%)] Loss: 1.77512 (QuantReg: 13.06599) QuantErr: 13.06599 batch_time=0.51978 
Train Epoch: 6 [166/250 21248/32000 (66%)] Loss: 1.79861 (QuantReg: 13.06303) QuantErr: 13.06303 batch_time=0.53226 
Train Epoch: 6 [177/250 22656/32000 (71%)] Loss: 2.28922 (QuantReg: 13.32424) QuantErr: 13.32424 batch_time=0.64114 
Train Epoch: 6 [188/250 24064/32000 (75%)] Loss: 1.94997 (QuantReg: 13.52094) QuantErr: 13.52094 batch_time=0.50868 
Train Epoch: 6 [199/250 25472/32000 (80%)] Loss: 2.10002 (QuantReg: 13.11885) QuantErr: 13.11885 batch_time=0.55993 
Train Epoch: 6 [210/250 26880/32000 (84%)] Loss: 1.87879 (QuantReg: 12.95961) QuantErr: 12.95961 batch_time=2.93862 
Train Epoch: 6 [221/250 28288/32000 (88%)] Loss: 1.93704 (QuantReg: 13.18013) QuantErr: 13.18013 batch_time=0.52022 
Train Epoch: 6 [232/250 29696/32000 (93%)] Loss: 2.09416 (QuantReg: 13.04946) QuantErr: 13.04946 batch_time=0.54019 
Train Epoch: 6 [243/250 31104/32000 (97%)] Loss: 2.13997 (QuantReg: 13.08232) QuantErr: 13.08232 batch_time=0.55652 
Train Epoch: 6 codebook_update_time=1.78885
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch6.pth ...
Done in 5.838s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch6.pth ...
Done in 11.167s
removing stale ckpt [epoch 5] [took 0.00s]
 epoch          : 6
 loss           : 2.1283623571395873
 quant_reg      : 12.939004829406738
 quant_err      : 12.939004829406738
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 27.364185110663986
 MSRVTT_full_val/t2v_metrics/R5: 66.80080482897384
 MSRVTT_full_val/t2v_metrics/R10: 79.87927565392354
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.219315895372233
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.65821227266437
 MSRVTT_full_val/v2t_metrics/R1: 32.99798792756539
 MSRVTT_full_val/v2t_metrics/R5: 72.43460764587525
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.426559356136821
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.99769158087788
 MSRVTT_full_test/t2v_metrics/R1: 11.070234113712374
 MSRVTT_full_test/t2v_metrics/R5: 30.80267558528428
 MSRVTT_full_test/t2v_metrics/R10: 44.54849498327759
 MSRVTT_full_test/t2v_metrics/R50: 77.72575250836121
 MSRVTT_full_test/t2v_metrics/MedR: 13.5
 MSRVTT_full_test/t2v_metrics/MeanR: 47.520066889632105
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.766202976066804
 MSRVTT_full_test/v2t_metrics/R1: 12.775919732441471
 MSRVTT_full_test/v2t_metrics/R5: 37.89297658862876
 MSRVTT_full_test/v2t_metrics/R10: 50.802675585284284
 MSRVTT_full_test/v2t_metrics/R50: 83.17725752508362
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.086622073578596
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.081211430610306
 mnt_best       : 24.766202976066804
 not_improved_count: 0
Train Epoch: 7 [1/250 128/32000 (0%)] Loss: 2.19814 (QuantReg: 12.20587) QuantErr: 12.20587 batch_time=33.72107 
Train Epoch: 7 [12/250 1536/32000 (5%)] Loss: 1.82900 (QuantReg: 13.04480) QuantErr: 13.04480 batch_time=0.52905 
Train Epoch: 7 [23/250 2944/32000 (9%)] Loss: 2.26560 (QuantReg: 12.98315) QuantErr: 12.98315 batch_time=0.52523 
Train Epoch: 7 [34/250 4352/32000 (14%)] Loss: 2.05190 (QuantReg: 13.05582) QuantErr: 13.05582 batch_time=0.51353 
Train Epoch: 7 [45/250 5760/32000 (18%)] Loss: 1.88160 (QuantReg: 12.71562) QuantErr: 12.71562 batch_time=0.51493 
Train Epoch: 7 [56/250 7168/32000 (22%)] Loss: 2.14248 (QuantReg: 12.76773) QuantErr: 12.76773 batch_time=0.53809 
Train Epoch: 7 [67/250 8576/32000 (27%)] Loss: 2.08655 (QuantReg: 13.18715) QuantErr: 13.18715 batch_time=1.77644 
Train Epoch: 7 [78/250 9984/32000 (31%)] Loss: 2.23222 (QuantReg: 12.98177) QuantErr: 12.98177 batch_time=4.17743 
Train Epoch: 7 [89/250 11392/32000 (36%)] Loss: 2.15620 (QuantReg: 12.91958) QuantErr: 12.91958 batch_time=0.56924 
Train Epoch: 7 [100/250 12800/32000 (40%)] Loss: 1.93651 (QuantReg: 12.95315) QuantErr: 12.95315 batch_time=0.54048 
Train Epoch: 7 [111/250 14208/32000 (44%)] Loss: 2.32943 (QuantReg: 12.98421) QuantErr: 12.98421 batch_time=0.57481 
Train Epoch: 7 [122/250 15616/32000 (49%)] Loss: 1.51292 (QuantReg: 13.30172) QuantErr: 13.30172 batch_time=0.53275 
Train Epoch: 7 [133/250 17024/32000 (53%)] Loss: 1.70469 (QuantReg: 12.93480) QuantErr: 12.93480 batch_time=0.82681 
Train Epoch: 7 [144/250 18432/32000 (58%)] Loss: 2.13421 (QuantReg: 12.94695) QuantErr: 12.94695 batch_time=0.60380 
Train Epoch: 7 [155/250 19840/32000 (62%)] Loss: 2.05990 (QuantReg: 12.77875) QuantErr: 12.77875 batch_time=0.50249 
Train Epoch: 7 [166/250 21248/32000 (66%)] Loss: 1.75664 (QuantReg: 13.15047) QuantErr: 13.15047 batch_time=0.50938 
Train Epoch: 7 [177/250 22656/32000 (71%)] Loss: 1.65060 (QuantReg: 13.36147) QuantErr: 13.36147 batch_time=0.54820 
Train Epoch: 7 [188/250 24064/32000 (75%)] Loss: 1.98485 (QuantReg: 12.86060) QuantErr: 12.86060 batch_time=0.57867 
Train Epoch: 7 [199/250 25472/32000 (80%)] Loss: 1.44366 (QuantReg: 13.21458) QuantErr: 13.21458 batch_time=0.49937 
Train Epoch: 7 [210/250 26880/32000 (84%)] Loss: 1.75860 (QuantReg: 13.31701) QuantErr: 13.31701 batch_time=0.59342 
Train Epoch: 7 [221/250 28288/32000 (88%)] Loss: 2.37195 (QuantReg: 13.14990) QuantErr: 13.14990 batch_time=0.52338 
Train Epoch: 7 [232/250 29696/32000 (93%)] Loss: 1.87897 (QuantReg: 13.05642) QuantErr: 13.05642 batch_time=0.52948 
Train Epoch: 7 [243/250 31104/32000 (97%)] Loss: 2.10383 (QuantReg: 12.98402) QuantErr: 12.98402 batch_time=0.50808 
Train Epoch: 7 codebook_update_time=1.77936
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch7.pth ...
Done in 4.939s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch7.pth ...
Done in 10.288s
removing stale ckpt [epoch 6] [took 0.01s]
 epoch          : 7
 loss           : 1.969263916015625
 quant_reg      : 13.039780002593995
 quant_err      : 13.039780002593995
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 1750
 MSRVTT_full_val/t2v_metrics/R1: 27.96780684104628
 MSRVTT_full_val/t2v_metrics/R5: 67.40442655935614
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.448692152917506
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.42429888399108
 MSRVTT_full_val/v2t_metrics/R1: 35.2112676056338
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.311871227364185
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.125088506080246
 MSRVTT_full_test/t2v_metrics/R1: 11.304347826086957
 MSRVTT_full_test/t2v_metrics/R5: 32.17391304347826
 MSRVTT_full_test/t2v_metrics/R10: 45.65217391304348
 MSRVTT_full_test/t2v_metrics/R50: 79.09698996655518
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.50033444816054
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.511556294516378
 MSRVTT_full_test/v2t_metrics/R1: 12.775919732441471
 MSRVTT_full_test/v2t_metrics/R5: 37.324414715719065
 MSRVTT_full_test/v2t_metrics/R10: 52.207357859531776
 MSRVTT_full_test/v2t_metrics/R50: 83.51170568561874
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.594314381270905
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.19929047831319
 mnt_best       : 25.511556294516378
 not_improved_count: 0
Train Epoch: 8 [1/250 128/32000 (0%)] Loss: 1.87330 (QuantReg: 13.04616) QuantErr: 13.04616 batch_time=48.80918 
Train Epoch: 8 [12/250 1536/32000 (5%)] Loss: 2.10767 (QuantReg: 13.07306) QuantErr: 13.07306 batch_time=0.51314 
Train Epoch: 8 [23/250 2944/32000 (9%)] Loss: 2.45450 (QuantReg: 12.72779) QuantErr: 12.72779 batch_time=0.52556 
Train Epoch: 8 [34/250 4352/32000 (14%)] Loss: 1.92778 (QuantReg: 13.15167) QuantErr: 13.15167 batch_time=0.55300 
Train Epoch: 8 [45/250 5760/32000 (18%)] Loss: 2.01784 (QuantReg: 13.04458) QuantErr: 13.04458 batch_time=0.51110 
Train Epoch: 8 [56/250 7168/32000 (22%)] Loss: 1.93510 (QuantReg: 12.85777) QuantErr: 12.85777 batch_time=0.50729 
Train Epoch: 8 [67/250 8576/32000 (27%)] Loss: 1.72873 (QuantReg: 13.35143) QuantErr: 13.35143 batch_time=0.57575 
Train Epoch: 8 [78/250 9984/32000 (31%)] Loss: 1.66089 (QuantReg: 13.30352) QuantErr: 13.30352 batch_time=0.52599 
Train Epoch: 8 [89/250 11392/32000 (36%)] Loss: 2.03761 (QuantReg: 13.10351) QuantErr: 13.10351 batch_time=0.59462 
Train Epoch: 8 [100/250 12800/32000 (40%)] Loss: 1.85146 (QuantReg: 13.05675) QuantErr: 13.05675 batch_time=0.54242 
Train Epoch: 8 [111/250 14208/32000 (44%)] Loss: 1.76710 (QuantReg: 13.29462) QuantErr: 13.29462 batch_time=0.50622 
Train Epoch: 8 [122/250 15616/32000 (49%)] Loss: 2.42687 (QuantReg: 13.28074) QuantErr: 13.28074 batch_time=0.53093 
Train Epoch: 8 [133/250 17024/32000 (53%)] Loss: 1.71391 (QuantReg: 13.10159) QuantErr: 13.10159 batch_time=0.51321 
Train Epoch: 8 [144/250 18432/32000 (58%)] Loss: 1.70446 (QuantReg: 13.22628) QuantErr: 13.22628 batch_time=0.53027 
Train Epoch: 8 [155/250 19840/32000 (62%)] Loss: 2.25578 (QuantReg: 13.34348) QuantErr: 13.34348 batch_time=0.54440 
Train Epoch: 8 [166/250 21248/32000 (66%)] Loss: 1.56347 (QuantReg: 13.05509) QuantErr: 13.05509 batch_time=0.58236 
Train Epoch: 8 [177/250 22656/32000 (71%)] Loss: 2.05368 (QuantReg: 13.27384) QuantErr: 13.27384 batch_time=0.63296 
Train Epoch: 8 [188/250 24064/32000 (75%)] Loss: 2.02899 (QuantReg: 13.43963) QuantErr: 13.43963 batch_time=0.53794 
Train Epoch: 8 [199/250 25472/32000 (80%)] Loss: 1.50685 (QuantReg: 13.32815) QuantErr: 13.32815 batch_time=0.51095 
Train Epoch: 8 [210/250 26880/32000 (84%)] Loss: 1.40466 (QuantReg: 13.22969) QuantErr: 13.22969 batch_time=0.52983 
Train Epoch: 8 [221/250 28288/32000 (88%)] Loss: 1.45768 (QuantReg: 13.62514) QuantErr: 13.62514 batch_time=0.52894 
Train Epoch: 8 [232/250 29696/32000 (93%)] Loss: 1.11435 (QuantReg: 13.16264) QuantErr: 13.16264 batch_time=0.52571 
Train Epoch: 8 [243/250 31104/32000 (97%)] Loss: 1.45110 (QuantReg: 13.21988) QuantErr: 13.21988 batch_time=0.51353 
Train Epoch: 8 codebook_update_time=1.69746
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch8.pth ...
Done in 6.289s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch8.pth ...
Done in 11.232s
removing stale ckpt [epoch 7] [took 0.00s]
 epoch          : 8
 loss           : 1.8663319206237794
 quant_reg      : 13.100959823608399
 quant_err      : 13.100959823608399
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 28.772635814889338
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 80.0804828973843
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.388329979879277
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.537651007573814
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 73.8430583501006
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.162977867203219
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.00337057231466
 MSRVTT_full_test/t2v_metrics/R1: 11.538461538461538
 MSRVTT_full_test/t2v_metrics/R5: 32.876254180602004
 MSRVTT_full_test/t2v_metrics/R10: 45.852842809364546
 MSRVTT_full_test/t2v_metrics/R50: 78.69565217391305
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.973578595317726
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.90988592567972
 MSRVTT_full_test/v2t_metrics/R1: 13.478260869565217
 MSRVTT_full_test/v2t_metrics/R5: 37.95986622073578
 MSRVTT_full_test/v2t_metrics/R10: 53.01003344481605
 MSRVTT_full_test/v2t_metrics/R50: 84.04682274247492
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.003010033444816
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.044999635714092
 mnt_best       : 25.90988592567972
 not_improved_count: 0
Train Epoch: 9 [1/250 128/32000 (0%)] Loss: 2.07492 (QuantReg: 12.73485) QuantErr: 12.73485 batch_time=37.22838 
Train Epoch: 9 [12/250 1536/32000 (5%)] Loss: 1.74446 (QuantReg: 12.85844) QuantErr: 12.85844 batch_time=0.58604 
Train Epoch: 9 [23/250 2944/32000 (9%)] Loss: 2.14512 (QuantReg: 13.02880) QuantErr: 13.02880 batch_time=0.55917 
Train Epoch: 9 [34/250 4352/32000 (14%)] Loss: 2.06795 (QuantReg: 12.99054) QuantErr: 12.99054 batch_time=0.49657 
Train Epoch: 9 [45/250 5760/32000 (18%)] Loss: 2.17634 (QuantReg: 12.83534) QuantErr: 12.83534 batch_time=0.83757 
Train Epoch: 9 [56/250 7168/32000 (22%)] Loss: 2.00580 (QuantReg: 12.91172) QuantErr: 12.91172 batch_time=0.51150 
Train Epoch: 9 [67/250 8576/32000 (27%)] Loss: 1.75840 (QuantReg: 12.94296) QuantErr: 12.94296 batch_time=0.54296 
Train Epoch: 9 [78/250 9984/32000 (31%)] Loss: 1.44052 (QuantReg: 13.17063) QuantErr: 13.17063 batch_time=0.50867 
Train Epoch: 9 [89/250 11392/32000 (36%)] Loss: 2.04947 (QuantReg: 12.98122) QuantErr: 12.98122 batch_time=0.50540 
Train Epoch: 9 [100/250 12800/32000 (40%)] Loss: 1.74426 (QuantReg: 13.18357) QuantErr: 13.18357 batch_time=0.52247 
Train Epoch: 9 [111/250 14208/32000 (44%)] Loss: 1.86536 (QuantReg: 13.03939) QuantErr: 13.03939 batch_time=0.49561 
Train Epoch: 9 [122/250 15616/32000 (49%)] Loss: 1.64122 (QuantReg: 13.28896) QuantErr: 13.28896 batch_time=0.50740 
Train Epoch: 9 [133/250 17024/32000 (53%)] Loss: 1.80711 (QuantReg: 13.20088) QuantErr: 13.20088 batch_time=0.61876 
Train Epoch: 9 [144/250 18432/32000 (58%)] Loss: 1.89100 (QuantReg: 13.36098) QuantErr: 13.36098 batch_time=0.54902 
Train Epoch: 9 [155/250 19840/32000 (62%)] Loss: 1.93474 (QuantReg: 13.32176) QuantErr: 13.32176 batch_time=0.52054 
Train Epoch: 9 [166/250 21248/32000 (66%)] Loss: 1.81518 (QuantReg: 13.09709) QuantErr: 13.09709 batch_time=0.52183 
Train Epoch: 9 [177/250 22656/32000 (71%)] Loss: 1.35248 (QuantReg: 13.33693) QuantErr: 13.33693 batch_time=0.50165 
Train Epoch: 9 [188/250 24064/32000 (75%)] Loss: 1.44160 (QuantReg: 13.39390) QuantErr: 13.39390 batch_time=0.55578 
Train Epoch: 9 [199/250 25472/32000 (80%)] Loss: 1.52464 (QuantReg: 13.33956) QuantErr: 13.33956 batch_time=6.34923 
Train Epoch: 9 [210/250 26880/32000 (84%)] Loss: 1.49200 (QuantReg: 13.04947) QuantErr: 13.04947 batch_time=0.83069 
Train Epoch: 9 [221/250 28288/32000 (88%)] Loss: 1.65558 (QuantReg: 13.24535) QuantErr: 13.24535 batch_time=0.58047 
Train Epoch: 9 [232/250 29696/32000 (93%)] Loss: 1.68248 (QuantReg: 13.31828) QuantErr: 13.31828 batch_time=0.55306 
Train Epoch: 9 [243/250 31104/32000 (97%)] Loss: 1.18596 (QuantReg: 13.48554) QuantErr: 13.48554 batch_time=0.52817 
Train Epoch: 9 codebook_update_time=1.83558
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch9.pth ...
Done in 15.307s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch9.pth ...
Done in 20.123s
removing stale ckpt [epoch 8] [took 0.01s]
 epoch          : 9
 loss           : 1.7392348456382751
 quant_reg      : 13.151548904418945
 quant_err      : 13.151548904418945
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 2250
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.150905432595573
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.56616284819279
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.293762575452717
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.68200989030519
 MSRVTT_full_test/t2v_metrics/R1: 11.839464882943144
 MSRVTT_full_test/t2v_metrics/R5: 35.11705685618729
 MSRVTT_full_test/t2v_metrics/R10: 48.49498327759197
 MSRVTT_full_test/t2v_metrics/R50: 80.8695652173913
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.13879598662207
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.217548122310383
 MSRVTT_full_test/v2t_metrics/R1: 14.548494983277592
 MSRVTT_full_test/v2t_metrics/R5: 39.46488294314381
 MSRVTT_full_test/v2t_metrics/R10: 54.81605351170568
 MSRVTT_full_test/v2t_metrics/R50: 85.15050167224081
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.46354515050167
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.57273595783139
 mnt_best       : 27.217548122310383
 not_improved_count: 0
Train Epoch: 10 [1/250 128/32000 (0%)] Loss: 1.42912 (QuantReg: 12.74387) QuantErr: 12.74387 batch_time=37.21371 
Train Epoch: 10 [12/250 1536/32000 (5%)] Loss: 1.63293 (QuantReg: 13.08670) QuantErr: 13.08670 batch_time=0.53423 
Train Epoch: 10 [23/250 2944/32000 (9%)] Loss: 1.46775 (QuantReg: 12.85679) QuantErr: 12.85679 batch_time=0.50560 
Train Epoch: 10 [34/250 4352/32000 (14%)] Loss: 1.32581 (QuantReg: 12.72069) QuantErr: 12.72069 batch_time=0.56423 
Train Epoch: 10 [45/250 5760/32000 (18%)] Loss: 1.53061 (QuantReg: 13.40966) QuantErr: 13.40966 batch_time=0.55802 
Train Epoch: 10 [56/250 7168/32000 (22%)] Loss: 2.29735 (QuantReg: 13.11296) QuantErr: 13.11296 batch_time=0.53911 
Train Epoch: 10 [67/250 8576/32000 (27%)] Loss: 1.41997 (QuantReg: 13.25578) QuantErr: 13.25578 batch_time=1.20958 
Train Epoch: 10 [78/250 9984/32000 (31%)] Loss: 1.62925 (QuantReg: 12.94425) QuantErr: 12.94425 batch_time=0.80345 
Train Epoch: 10 [89/250 11392/32000 (36%)] Loss: 1.66447 (QuantReg: 13.07171) QuantErr: 13.07171 batch_time=0.51656 
Train Epoch: 10 [100/250 12800/32000 (40%)] Loss: 2.12603 (QuantReg: 12.85455) QuantErr: 12.85455 batch_time=0.50771 
Train Epoch: 10 [111/250 14208/32000 (44%)] Loss: 1.45623 (QuantReg: 13.23011) QuantErr: 13.23011 batch_time=0.51588 
Train Epoch: 10 [122/250 15616/32000 (49%)] Loss: 1.82170 (QuantReg: 13.30667) QuantErr: 13.30667 batch_time=0.60373 
Train Epoch: 10 [133/250 17024/32000 (53%)] Loss: 1.95414 (QuantReg: 13.27752) QuantErr: 13.27752 batch_time=0.54087 
Train Epoch: 10 [144/250 18432/32000 (58%)] Loss: 2.14669 (QuantReg: 13.38997) QuantErr: 13.38997 batch_time=0.50757 
Train Epoch: 10 [155/250 19840/32000 (62%)] Loss: 1.29556 (QuantReg: 13.57348) QuantErr: 13.57348 batch_time=0.62654 
Train Epoch: 10 [166/250 21248/32000 (66%)] Loss: 1.31944 (QuantReg: 13.45149) QuantErr: 13.45149 batch_time=0.79560 
Train Epoch: 10 [177/250 22656/32000 (71%)] Loss: 2.51692 (QuantReg: 13.12911) QuantErr: 13.12911 batch_time=0.62917 
Train Epoch: 10 [188/250 24064/32000 (75%)] Loss: 1.47032 (QuantReg: 13.65932) QuantErr: 13.65932 batch_time=0.52598 
Train Epoch: 10 [199/250 25472/32000 (80%)] Loss: 1.39781 (QuantReg: 13.68075) QuantErr: 13.68075 batch_time=0.60411 
Train Epoch: 10 [210/250 26880/32000 (84%)] Loss: 1.54278 (QuantReg: 13.24539) QuantErr: 13.24539 batch_time=0.52263 
Train Epoch: 10 [221/250 28288/32000 (88%)] Loss: 1.50842 (QuantReg: 13.08505) QuantErr: 13.08505 batch_time=0.51790 
Train Epoch: 10 [232/250 29696/32000 (93%)] Loss: 2.16304 (QuantReg: 13.25863) QuantErr: 13.25863 batch_time=0.66401 
Train Epoch: 10 [243/250 31104/32000 (97%)] Loss: 1.81186 (QuantReg: 13.14316) QuantErr: 13.14316 batch_time=0.55396 
Train Epoch: 10 codebook_update_time=1.85086
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch10.pth ...
Done in 21.654s
removing stale ckpt [epoch 9] [took 0.00s]
 epoch          : 10
 loss           : 1.6461696848869323
 quant_reg      : 13.193038208007813
 quant_err      : 13.193038208007813
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.185110663983902
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.142618143523045
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 75.0503018108652
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.301810865191147
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.53169731125111
 MSRVTT_full_test/t2v_metrics/R1: 11.605351170568563
 MSRVTT_full_test/t2v_metrics/R5: 33.779264214046826
 MSRVTT_full_test/t2v_metrics/R10: 46.8561872909699
 MSRVTT_full_test/t2v_metrics/R50: 80.43478260869566
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.374581939799334
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.385083502996284
 MSRVTT_full_test/v2t_metrics/R1: 13.511705685618729
 MSRVTT_full_test/v2t_metrics/R5: 38.62876254180602
 MSRVTT_full_test/v2t_metrics/R10: 54.280936454849495
 MSRVTT_full_test/v2t_metrics/R50: 86.22073578595318
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.062709030100333
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.485227105584265
 mnt_best       : 27.217548122310383
 not_improved_count: 1
Train Epoch: 11 [1/250 128/32000 (0%)] Loss: 1.48286 (QuantReg: 13.02585) QuantErr: 13.02585 batch_time=33.15067 
Train Epoch: 11 [12/250 1536/32000 (5%)] Loss: 1.37539 (QuantReg: 13.24955) QuantErr: 13.24955 batch_time=0.51270 
Train Epoch: 11 [23/250 2944/32000 (9%)] Loss: 1.54585 (QuantReg: 12.90776) QuantErr: 12.90776 batch_time=0.53091 
Train Epoch: 11 [34/250 4352/32000 (14%)] Loss: 1.61331 (QuantReg: 13.25153) QuantErr: 13.25153 batch_time=0.56605 
Train Epoch: 11 [45/250 5760/32000 (18%)] Loss: 1.70705 (QuantReg: 13.49713) QuantErr: 13.49713 batch_time=0.50888 
Train Epoch: 11 [56/250 7168/32000 (22%)] Loss: 1.34999 (QuantReg: 13.29250) QuantErr: 13.29250 batch_time=0.52885 
Train Epoch: 11 [67/250 8576/32000 (27%)] Loss: 1.75094 (QuantReg: 13.03591) QuantErr: 13.03591 batch_time=0.60391 
Train Epoch: 11 [78/250 9984/32000 (31%)] Loss: 1.47455 (QuantReg: 13.49845) QuantErr: 13.49845 batch_time=0.52979 
Train Epoch: 11 [89/250 11392/32000 (36%)] Loss: 1.53572 (QuantReg: 13.11505) QuantErr: 13.11505 batch_time=0.54596 
Train Epoch: 11 [100/250 12800/32000 (40%)] Loss: 1.75581 (QuantReg: 13.06962) QuantErr: 13.06962 batch_time=2.37528 
Train Epoch: 11 [111/250 14208/32000 (44%)] Loss: 1.87041 (QuantReg: 13.07144) QuantErr: 13.07144 batch_time=0.59601 
Train Epoch: 11 [122/250 15616/32000 (49%)] Loss: 1.60434 (QuantReg: 13.56801) QuantErr: 13.56801 batch_time=1.02082 
Train Epoch: 11 [133/250 17024/32000 (53%)] Loss: 1.98561 (QuantReg: 12.98133) QuantErr: 12.98133 batch_time=0.52030 
Train Epoch: 11 [144/250 18432/32000 (58%)] Loss: 1.74221 (QuantReg: 13.10519) QuantErr: 13.10519 batch_time=0.58000 
Train Epoch: 11 [155/250 19840/32000 (62%)] Loss: 1.62246 (QuantReg: 13.10350) QuantErr: 13.10350 batch_time=0.51079 
Train Epoch: 11 [166/250 21248/32000 (66%)] Loss: 1.59495 (QuantReg: 13.00852) QuantErr: 13.00852 batch_time=0.54019 
Train Epoch: 11 [177/250 22656/32000 (71%)] Loss: 1.58029 (QuantReg: 12.99436) QuantErr: 12.99436 batch_time=0.69323 
Train Epoch: 11 [188/250 24064/32000 (75%)] Loss: 1.26559 (QuantReg: 13.25383) QuantErr: 13.25383 batch_time=0.50571 
Train Epoch: 11 [199/250 25472/32000 (80%)] Loss: 1.37681 (QuantReg: 13.70844) QuantErr: 13.70844 batch_time=1.05126 
Train Epoch: 11 [210/250 26880/32000 (84%)] Loss: 1.67211 (QuantReg: 13.45811) QuantErr: 13.45811 batch_time=0.56804 
Train Epoch: 11 [221/250 28288/32000 (88%)] Loss: 1.64100 (QuantReg: 13.63800) QuantErr: 13.63800 batch_time=0.54274 
Train Epoch: 11 [232/250 29696/32000 (93%)] Loss: 1.32532 (QuantReg: 13.44054) QuantErr: 13.44054 batch_time=0.54371 
Train Epoch: 11 [243/250 31104/32000 (97%)] Loss: 1.17232 (QuantReg: 13.83262) QuantErr: 13.83262 batch_time=0.51786 
Train Epoch: 11 codebook_update_time=1.72605
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch11.pth ...
Done in 5.937s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 1.5532874684333802
 quant_reg      : 13.290080509185792
 quant_err      : 13.290080509185792
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 2750
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 67.20321931589537
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.132796780684105
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.39609939023545
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 73.8430583501006
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.414486921529175
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.17784320760863
 MSRVTT_full_test/t2v_metrics/R1: 11.605351170568563
 MSRVTT_full_test/t2v_metrics/R5: 33.41137123745819
 MSRVTT_full_test/t2v_metrics/R10: 46.58862876254181
 MSRVTT_full_test/t2v_metrics/R50: 80.0
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.689632107023414
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.238812220433232
 MSRVTT_full_test/v2t_metrics/R1: 14.648829431438127
 MSRVTT_full_test/v2t_metrics/R5: 40.36789297658863
 MSRVTT_full_test/v2t_metrics/R10: 55.01672240802676
 MSRVTT_full_test/v2t_metrics/R50: 85.65217391304348
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.305351170568564
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.923554338135457
 mnt_best       : 27.217548122310383
 not_improved_count: 2
Train Epoch: 12 [1/250 128/32000 (0%)] Loss: 1.55157 (QuantReg: 13.14119) QuantErr: 13.14119 batch_time=33.41529 
Train Epoch: 12 [12/250 1536/32000 (5%)] Loss: 1.73068 (QuantReg: 13.28666) QuantErr: 13.28666 batch_time=0.52839 
Train Epoch: 12 [23/250 2944/32000 (9%)] Loss: 1.35408 (QuantReg: 13.06172) QuantErr: 13.06172 batch_time=0.57427 
Train Epoch: 12 [34/250 4352/32000 (14%)] Loss: 1.39330 (QuantReg: 13.16000) QuantErr: 13.16000 batch_time=0.51798 
Train Epoch: 12 [45/250 5760/32000 (18%)] Loss: 1.21143 (QuantReg: 13.45654) QuantErr: 13.45654 batch_time=0.80532 
Train Epoch: 12 [56/250 7168/32000 (22%)] Loss: 1.56333 (QuantReg: 13.30915) QuantErr: 13.30915 batch_time=0.53929 
Train Epoch: 12 [67/250 8576/32000 (27%)] Loss: 1.27319 (QuantReg: 13.34136) QuantErr: 13.34136 batch_time=0.58462 
Train Epoch: 12 [78/250 9984/32000 (31%)] Loss: 1.53792 (QuantReg: 13.23739) QuantErr: 13.23739 batch_time=0.49646 
Train Epoch: 12 [89/250 11392/32000 (36%)] Loss: 1.33294 (QuantReg: 13.23725) QuantErr: 13.23725 batch_time=0.63517 
Train Epoch: 12 [100/250 12800/32000 (40%)] Loss: 1.64892 (QuantReg: 13.26639) QuantErr: 13.26639 batch_time=1.16639 
Train Epoch: 12 [111/250 14208/32000 (44%)] Loss: 1.17716 (QuantReg: 13.23534) QuantErr: 13.23534 batch_time=0.54432 
Train Epoch: 12 [122/250 15616/32000 (49%)] Loss: 1.60701 (QuantReg: 13.25420) QuantErr: 13.25420 batch_time=0.54104 
Train Epoch: 12 [133/250 17024/32000 (53%)] Loss: 1.25334 (QuantReg: 13.40355) QuantErr: 13.40355 batch_time=0.55704 
Train Epoch: 12 [144/250 18432/32000 (58%)] Loss: 1.18459 (QuantReg: 13.84800) QuantErr: 13.84800 batch_time=0.54284 
Train Epoch: 12 [155/250 19840/32000 (62%)] Loss: 1.59435 (QuantReg: 13.15264) QuantErr: 13.15264 batch_time=0.53993 
Train Epoch: 12 [166/250 21248/32000 (66%)] Loss: 1.07408 (QuantReg: 13.45195) QuantErr: 13.45195 batch_time=0.49994 
Train Epoch: 12 [177/250 22656/32000 (71%)] Loss: 1.12423 (QuantReg: 13.42719) QuantErr: 13.42719 batch_time=0.55354 
Train Epoch: 12 [188/250 24064/32000 (75%)] Loss: 1.81575 (QuantReg: 13.11192) QuantErr: 13.11192 batch_time=0.52634 
Train Epoch: 12 [199/250 25472/32000 (80%)] Loss: 1.53057 (QuantReg: 13.15447) QuantErr: 13.15447 batch_time=0.50856 
Train Epoch: 12 [210/250 26880/32000 (84%)] Loss: 1.84784 (QuantReg: 13.22834) QuantErr: 13.22834 batch_time=0.52934 
Train Epoch: 12 [221/250 28288/32000 (88%)] Loss: 1.50352 (QuantReg: 13.01210) QuantErr: 13.01210 batch_time=0.54873 
Train Epoch: 12 [232/250 29696/32000 (93%)] Loss: 1.48036 (QuantReg: 13.46206) QuantErr: 13.46206 batch_time=0.52963 
Train Epoch: 12 [243/250 31104/32000 (97%)] Loss: 1.59590 (QuantReg: 13.67399) QuantErr: 13.67399 batch_time=0.51991 
Train Epoch: 12 codebook_update_time=1.67101
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch12.pth ...
Done in 4.341s
removing stale ckpt [epoch 11] [took 0.00s]
 epoch          : 12
 loss           : 1.4816722507476807
 quant_reg      : 13.329390342712403
 quant_err      : 13.329390342712403
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.388329979879277
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.75259486921189
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.9738430583501
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.43505293498117
 MSRVTT_full_test/t2v_metrics/R1: 11.003344481605351
 MSRVTT_full_test/t2v_metrics/R5: 34.81605351170568
 MSRVTT_full_test/t2v_metrics/R10: 48.32775919732441
 MSRVTT_full_test/t2v_metrics/R50: 80.46822742474916
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.86722408026756
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.45454541590052
 MSRVTT_full_test/v2t_metrics/R1: 14.581939799331103
 MSRVTT_full_test/v2t_metrics/R5: 41.23745819397993
 MSRVTT_full_test/v2t_metrics/R10: 56.88963210702341
 MSRVTT_full_test/v2t_metrics/R50: 86.88963210702342
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.939297658862877
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.46236113386705
 mnt_best       : 27.217548122310383
 not_improved_count: 3
Train Epoch: 13 [1/250 128/32000 (0%)] Loss: 1.37490 (QuantReg: 13.25366) QuantErr: 13.25366 batch_time=37.72533 
Train Epoch: 13 [12/250 1536/32000 (5%)] Loss: 1.95781 (QuantReg: 12.84915) QuantErr: 12.84915 batch_time=0.52168 
Train Epoch: 13 [23/250 2944/32000 (9%)] Loss: 1.48239 (QuantReg: 13.48985) QuantErr: 13.48985 batch_time=0.51385 
Train Epoch: 13 [34/250 4352/32000 (14%)] Loss: 1.24174 (QuantReg: 13.40216) QuantErr: 13.40216 batch_time=0.59127 
Train Epoch: 13 [45/250 5760/32000 (18%)] Loss: 1.37891 (QuantReg: 13.37562) QuantErr: 13.37562 batch_time=0.61661 
Train Epoch: 13 [56/250 7168/32000 (22%)] Loss: 1.41293 (QuantReg: 13.58906) QuantErr: 13.58906 batch_time=0.51335 
Train Epoch: 13 [67/250 8576/32000 (27%)] Loss: 1.53375 (QuantReg: 13.50543) QuantErr: 13.50543 batch_time=2.38206 
Train Epoch: 13 [78/250 9984/32000 (31%)] Loss: 1.82068 (QuantReg: 13.59470) QuantErr: 13.59470 batch_time=0.52690 
Train Epoch: 13 [89/250 11392/32000 (36%)] Loss: 1.15824 (QuantReg: 13.01388) QuantErr: 13.01388 batch_time=0.54336 
Train Epoch: 13 [100/250 12800/32000 (40%)] Loss: 1.58661 (QuantReg: 13.33694) QuantErr: 13.33694 batch_time=0.53280 
Train Epoch: 13 [111/250 14208/32000 (44%)] Loss: 1.56233 (QuantReg: 13.21690) QuantErr: 13.21690 batch_time=0.61534 
Train Epoch: 13 [122/250 15616/32000 (49%)] Loss: 1.05005 (QuantReg: 13.52625) QuantErr: 13.52625 batch_time=0.55593 
Train Epoch: 13 [133/250 17024/32000 (53%)] Loss: 1.30977 (QuantReg: 13.54184) QuantErr: 13.54184 batch_time=0.53681 
Train Epoch: 13 [144/250 18432/32000 (58%)] Loss: 1.40533 (QuantReg: 13.59767) QuantErr: 13.59767 batch_time=0.54187 
Train Epoch: 13 [155/250 19840/32000 (62%)] Loss: 1.67591 (QuantReg: 13.21141) QuantErr: 13.21141 batch_time=0.56422 
Train Epoch: 13 [166/250 21248/32000 (66%)] Loss: 1.24999 (QuantReg: 13.22890) QuantErr: 13.22890 batch_time=0.51847 
Train Epoch: 13 [177/250 22656/32000 (71%)] Loss: 1.15345 (QuantReg: 13.67255) QuantErr: 13.67255 batch_time=0.59439 
Train Epoch: 13 [188/250 24064/32000 (75%)] Loss: 1.82404 (QuantReg: 13.25767) QuantErr: 13.25767 batch_time=0.60758 
Train Epoch: 13 [199/250 25472/32000 (80%)] Loss: 1.12570 (QuantReg: 13.77686) QuantErr: 13.77686 batch_time=0.51628 
Train Epoch: 13 [210/250 26880/32000 (84%)] Loss: 1.79184 (QuantReg: 13.56978) QuantErr: 13.56978 batch_time=0.56352 
Train Epoch: 13 [221/250 28288/32000 (88%)] Loss: 1.71718 (QuantReg: 13.59709) QuantErr: 13.59709 batch_time=0.52322 
Train Epoch: 13 [232/250 29696/32000 (93%)] Loss: 1.23038 (QuantReg: 13.44609) QuantErr: 13.44609 batch_time=0.55321 
Train Epoch: 13 [243/250 31104/32000 (97%)] Loss: 1.41079 (QuantReg: 13.57304) QuantErr: 13.57304 batch_time=0.53195 
Train Epoch: 13 codebook_update_time=1.78294
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch13.pth ...
Done in 4.536s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch13.pth ...
Done in 8.899s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 1.4125195915699005
 quant_reg      : 13.40679708480835
 quant_err      : 13.40679708480835
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 3250
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.9476861167002015
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.96894790737305
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.861167002012072
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.41804430806891
 MSRVTT_full_test/t2v_metrics/R1: 12.608695652173912
 MSRVTT_full_test/t2v_metrics/R5: 35.819397993311036
 MSRVTT_full_test/t2v_metrics/R10: 50.468227424749166
 MSRVTT_full_test/t2v_metrics/R50: 80.96989966555184
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.40635451505017
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.353205479005165
 MSRVTT_full_test/v2t_metrics/R1: 15.284280936454849
 MSRVTT_full_test/v2t_metrics/R5: 42.14046822742475
 MSRVTT_full_test/v2t_metrics/R10: 57.69230769230769
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 28.798160535117056
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.36983760890988
 mnt_best       : 28.353205479005165
 not_improved_count: 0
Train Epoch: 14 [1/250 128/32000 (0%)] Loss: 1.19777 (QuantReg: 13.42784) QuantErr: 13.42784 batch_time=38.24104 
Train Epoch: 14 [12/250 1536/32000 (5%)] Loss: 1.87388 (QuantReg: 13.64455) QuantErr: 13.64455 batch_time=0.50265 
Train Epoch: 14 [23/250 2944/32000 (9%)] Loss: 1.37142 (QuantReg: 13.50617) QuantErr: 13.50617 batch_time=0.54306 
Train Epoch: 14 [34/250 4352/32000 (14%)] Loss: 1.32304 (QuantReg: 13.30138) QuantErr: 13.30138 batch_time=0.59001 
Train Epoch: 14 [45/250 5760/32000 (18%)] Loss: 1.71968 (QuantReg: 13.34456) QuantErr: 13.34456 batch_time=0.57818 
Train Epoch: 14 [56/250 7168/32000 (22%)] Loss: 1.36748 (QuantReg: 13.28987) QuantErr: 13.28987 batch_time=0.50415 
Train Epoch: 14 [67/250 8576/32000 (27%)] Loss: 1.64177 (QuantReg: 13.41203) QuantErr: 13.41203 batch_time=0.57442 
Train Epoch: 14 [78/250 9984/32000 (31%)] Loss: 1.63992 (QuantReg: 13.05394) QuantErr: 13.05394 batch_time=0.53274 
Train Epoch: 14 [89/250 11392/32000 (36%)] Loss: 1.02601 (QuantReg: 13.15180) QuantErr: 13.15180 batch_time=0.52744 
Train Epoch: 14 [100/250 12800/32000 (40%)] Loss: 1.33848 (QuantReg: 13.18790) QuantErr: 13.18790 batch_time=0.51651 
Train Epoch: 14 [111/250 14208/32000 (44%)] Loss: 1.24992 (QuantReg: 13.47269) QuantErr: 13.47269 batch_time=0.53363 
Train Epoch: 14 [122/250 15616/32000 (49%)] Loss: 1.62584 (QuantReg: 13.00789) QuantErr: 13.00789 batch_time=0.53799 
Train Epoch: 14 [133/250 17024/32000 (53%)] Loss: 1.20426 (QuantReg: 13.64837) QuantErr: 13.64837 batch_time=0.52410 
Train Epoch: 14 [144/250 18432/32000 (58%)] Loss: 1.04542 (QuantReg: 13.38462) QuantErr: 13.38462 batch_time=0.57412 
Train Epoch: 14 [155/250 19840/32000 (62%)] Loss: 1.34454 (QuantReg: 13.49179) QuantErr: 13.49179 batch_time=0.55257 
Train Epoch: 14 [166/250 21248/32000 (66%)] Loss: 1.13720 (QuantReg: 13.51625) QuantErr: 13.51625 batch_time=0.60019 
Train Epoch: 14 [177/250 22656/32000 (71%)] Loss: 1.12763 (QuantReg: 13.27727) QuantErr: 13.27727 batch_time=0.49637 
Train Epoch: 14 [188/250 24064/32000 (75%)] Loss: 1.66180 (QuantReg: 13.66372) QuantErr: 13.66372 batch_time=1.09746 
Train Epoch: 14 [199/250 25472/32000 (80%)] Loss: 1.34524 (QuantReg: 13.41502) QuantErr: 13.41502 batch_time=0.57640 
Train Epoch: 14 [210/250 26880/32000 (84%)] Loss: 1.56001 (QuantReg: 13.26339) QuantErr: 13.26339 batch_time=0.51265 
Train Epoch: 14 [221/250 28288/32000 (88%)] Loss: 1.38884 (QuantReg: 13.65273) QuantErr: 13.65273 batch_time=0.51469 
Train Epoch: 14 [232/250 29696/32000 (93%)] Loss: 1.30381 (QuantReg: 13.70065) QuantErr: 13.70065 batch_time=0.59070 
Train Epoch: 14 [243/250 31104/32000 (97%)] Loss: 1.33164 (QuantReg: 13.42819) QuantErr: 13.42819 batch_time=0.55539 
Train Epoch: 14 codebook_update_time=1.83464
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch14.pth ...
Done in 3.975s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 1.3727386577129363
 quant_reg      : 13.422417125701905
 quant_err      : 13.422417125701905
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 31.58953722334004
 MSRVTT_full_val/t2v_metrics/R5: 66.39839034205231
 MSRVTT_full_val/t2v_metrics/R10: 79.67806841046277
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.752515090543259
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.08244430554476
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 74.64788732394366
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.360160965794768
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.63744548799753
 MSRVTT_full_test/t2v_metrics/R1: 12.040133779264215
 MSRVTT_full_test/t2v_metrics/R5: 33.47826086956522
 MSRVTT_full_test/t2v_metrics/R10: 46.48829431438127
 MSRVTT_full_test/t2v_metrics/R50: 78.72909698996655
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.53946488294314
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.56109271748175
 MSRVTT_full_test/v2t_metrics/R1: 14.31438127090301
 MSRVTT_full_test/v2t_metrics/R5: 40.635451505016725
 MSRVTT_full_test/v2t_metrics/R10: 54.68227424749164
 MSRVTT_full_test/v2t_metrics/R50: 85.08361204013377
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.72742474916388
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.68410274812336
 mnt_best       : 28.353205479005165
 not_improved_count: 1
Train Epoch: 15 [1/250 128/32000 (0%)] Loss: 1.64915 (QuantReg: 13.13608) QuantErr: 13.13608 batch_time=36.73975 
Train Epoch: 15 [12/250 1536/32000 (5%)] Loss: 1.27670 (QuantReg: 13.24753) QuantErr: 13.24753 batch_time=0.49329 
Train Epoch: 15 [23/250 2944/32000 (9%)] Loss: 1.27538 (QuantReg: 13.37956) QuantErr: 13.37956 batch_time=0.55722 
Train Epoch: 15 [34/250 4352/32000 (14%)] Loss: 1.45542 (QuantReg: 13.24609) QuantErr: 13.24609 batch_time=0.57642 
Train Epoch: 15 [45/250 5760/32000 (18%)] Loss: 1.41041 (QuantReg: 13.61384) QuantErr: 13.61384 batch_time=0.53401 
Train Epoch: 15 [56/250 7168/32000 (22%)] Loss: 1.57314 (QuantReg: 13.12240) QuantErr: 13.12240 batch_time=0.50482 
Train Epoch: 15 [67/250 8576/32000 (27%)] Loss: 1.62477 (QuantReg: 13.37211) QuantErr: 13.37211 batch_time=0.95512 
Train Epoch: 15 [78/250 9984/32000 (31%)] Loss: 1.12540 (QuantReg: 13.50661) QuantErr: 13.50661 batch_time=0.55461 
Train Epoch: 15 [89/250 11392/32000 (36%)] Loss: 1.59848 (QuantReg: 13.43176) QuantErr: 13.43176 batch_time=0.51208 
Train Epoch: 15 [100/250 12800/32000 (40%)] Loss: 1.38144 (QuantReg: 13.51360) QuantErr: 13.51360 batch_time=0.55905 
Train Epoch: 15 [111/250 14208/32000 (44%)] Loss: 1.56620 (QuantReg: 13.37575) QuantErr: 13.37575 batch_time=0.52595 
Train Epoch: 15 [122/250 15616/32000 (49%)] Loss: 1.08852 (QuantReg: 13.20731) QuantErr: 13.20731 batch_time=0.57531 
Train Epoch: 15 [133/250 17024/32000 (53%)] Loss: 1.35198 (QuantReg: 13.46926) QuantErr: 13.46926 batch_time=0.50452 
Train Epoch: 15 [144/250 18432/32000 (58%)] Loss: 1.55159 (QuantReg: 13.49598) QuantErr: 13.49598 batch_time=0.51168 
Train Epoch: 15 [155/250 19840/32000 (62%)] Loss: 1.38141 (QuantReg: 13.30168) QuantErr: 13.30168 batch_time=0.57106 
Train Epoch: 15 [166/250 21248/32000 (66%)] Loss: 1.41373 (QuantReg: 13.64241) QuantErr: 13.64241 batch_time=0.54232 
Train Epoch: 15 [177/250 22656/32000 (71%)] Loss: 1.62188 (QuantReg: 13.69404) QuantErr: 13.69404 batch_time=0.56074 
Train Epoch: 15 [188/250 24064/32000 (75%)] Loss: 1.22014 (QuantReg: 13.54099) QuantErr: 13.54099 batch_time=0.50696 
Train Epoch: 15 [199/250 25472/32000 (80%)] Loss: 1.26385 (QuantReg: 13.65221) QuantErr: 13.65221 batch_time=4.83021 
Train Epoch: 15 [210/250 26880/32000 (84%)] Loss: 1.55293 (QuantReg: 13.23241) QuantErr: 13.23241 batch_time=0.54489 
Train Epoch: 15 [221/250 28288/32000 (88%)] Loss: 1.55234 (QuantReg: 13.64293) QuantErr: 13.64293 batch_time=0.52317 
Train Epoch: 15 [232/250 29696/32000 (93%)] Loss: 1.52833 (QuantReg: 13.53280) QuantErr: 13.53280 batch_time=0.54095 
Train Epoch: 15 [243/250 31104/32000 (97%)] Loss: 1.42519 (QuantReg: 13.25275) QuantErr: 13.25275 batch_time=0.66216 
Train Epoch: 15 codebook_update_time=1.81527
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch15.pth ...
Done in 4.348s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch15.pth ...
Done in 8.595s
removing stale ckpt [epoch 14] [took 0.00s]
 epoch          : 15
 loss           : 1.31741427898407
 quant_reg      : 13.46969380569458
 quant_err      : 13.46969380569458
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 3750
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.941649899396379
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.30483174355487
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.183098591549296
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.86124363465898
 MSRVTT_full_test/t2v_metrics/R1: 12.508361204013378
 MSRVTT_full_test/t2v_metrics/R5: 37.22408026755853
 MSRVTT_full_test/t2v_metrics/R10: 50.30100334448161
 MSRVTT_full_test/t2v_metrics/R50: 81.53846153846153
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.83846153846154
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.61104228914243
 MSRVTT_full_test/v2t_metrics/R1: 15.518394648829432
 MSRVTT_full_test/v2t_metrics/R5: 41.97324414715719
 MSRVTT_full_test/v2t_metrics/R10: 57.290969899665555
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.74113712374582
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.417080238020944
 mnt_best       : 28.61104228914243
 not_improved_count: 0
Train Epoch: 16 [1/250 128/32000 (0%)] Loss: 1.21258 (QuantReg: 13.11703) QuantErr: 13.11703 batch_time=37.06243 
Train Epoch: 16 [12/250 1536/32000 (5%)] Loss: 1.24500 (QuantReg: 13.70504) QuantErr: 13.70504 batch_time=5.28228 
Train Epoch: 16 [23/250 2944/32000 (9%)] Loss: 1.52552 (QuantReg: 13.43282) QuantErr: 13.43282 batch_time=0.50949 
Train Epoch: 16 [34/250 4352/32000 (14%)] Loss: 1.12215 (QuantReg: 13.63690) QuantErr: 13.63690 batch_time=0.51759 
Train Epoch: 16 [45/250 5760/32000 (18%)] Loss: 1.24486 (QuantReg: 13.47659) QuantErr: 13.47659 batch_time=0.55411 
Train Epoch: 16 [56/250 7168/32000 (22%)] Loss: 1.38770 (QuantReg: 13.32743) QuantErr: 13.32743 batch_time=0.57101 
Train Epoch: 16 [67/250 8576/32000 (27%)] Loss: 1.38047 (QuantReg: 13.75885) QuantErr: 13.75885 batch_time=0.51313 
Train Epoch: 16 [78/250 9984/32000 (31%)] Loss: 1.17379 (QuantReg: 13.41857) QuantErr: 13.41857 batch_time=0.50804 
Train Epoch: 16 [89/250 11392/32000 (36%)] Loss: 1.21203 (QuantReg: 13.72204) QuantErr: 13.72204 batch_time=0.52928 
Train Epoch: 16 [100/250 12800/32000 (40%)] Loss: 1.12377 (QuantReg: 13.56206) QuantErr: 13.56206 batch_time=2.17170 
Train Epoch: 16 [111/250 14208/32000 (44%)] Loss: 1.41474 (QuantReg: 14.00127) QuantErr: 14.00127 batch_time=0.52273 
Train Epoch: 16 [122/250 15616/32000 (49%)] Loss: 1.36488 (QuantReg: 13.61299) QuantErr: 13.61299 batch_time=0.54314 
Train Epoch: 16 [133/250 17024/32000 (53%)] Loss: 1.46775 (QuantReg: 13.48148) QuantErr: 13.48148 batch_time=0.54493 
Train Epoch: 16 [144/250 18432/32000 (58%)] Loss: 1.11119 (QuantReg: 13.67313) QuantErr: 13.67313 batch_time=0.59002 
Train Epoch: 16 [155/250 19840/32000 (62%)] Loss: 1.26868 (QuantReg: 13.66308) QuantErr: 13.66308 batch_time=0.60598 
Train Epoch: 16 [166/250 21248/32000 (66%)] Loss: 1.25275 (QuantReg: 13.45819) QuantErr: 13.45819 batch_time=0.58594 
Train Epoch: 16 [177/250 22656/32000 (71%)] Loss: 1.44372 (QuantReg: 13.29401) QuantErr: 13.29401 batch_time=0.55077 
Train Epoch: 16 [188/250 24064/32000 (75%)] Loss: 0.96583 (QuantReg: 13.61331) QuantErr: 13.61331 batch_time=0.59780 
Train Epoch: 16 [199/250 25472/32000 (80%)] Loss: 1.35646 (QuantReg: 13.72999) QuantErr: 13.72999 batch_time=0.50853 
Train Epoch: 16 [210/250 26880/32000 (84%)] Loss: 1.17615 (QuantReg: 13.67595) QuantErr: 13.67595 batch_time=0.56582 
Train Epoch: 16 [221/250 28288/32000 (88%)] Loss: 1.08651 (QuantReg: 13.71442) QuantErr: 13.71442 batch_time=0.52366 
Train Epoch: 16 [232/250 29696/32000 (93%)] Loss: 1.26358 (QuantReg: 13.43080) QuantErr: 13.43080 batch_time=0.59394 
Train Epoch: 16 [243/250 31104/32000 (97%)] Loss: 1.32008 (QuantReg: 13.77756) QuantErr: 13.77756 batch_time=0.54807 
Train Epoch: 16 codebook_update_time=1.86159
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch16.pth ...
Done in 4.678s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch16.pth ...
Done in 9.213s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 1.2946140427589417
 quant_reg      : 13.52443533706665
 quant_err      : 13.52443533706665
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.839034205231388
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.69316377475316
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 78.47082494969818
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.134808853118712
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.95988676079264
 MSRVTT_full_test/t2v_metrics/R1: 12.809364548494983
 MSRVTT_full_test/t2v_metrics/R5: 36.8561872909699
 MSRVTT_full_test/t2v_metrics/R10: 50.2675585284281
 MSRVTT_full_test/t2v_metrics/R50: 82.14046822742475
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.6628762541806
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.737033088279464
 MSRVTT_full_test/v2t_metrics/R1: 15.31772575250836
 MSRVTT_full_test/v2t_metrics/R5: 42.508361204013376
 MSRVTT_full_test/v2t_metrics/R10: 58.36120401337793
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.61505016722408
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.61999400229155
 mnt_best       : 28.737033088279464
 not_improved_count: 0
Train Epoch: 17 [1/250 128/32000 (0%)] Loss: 1.26756 (QuantReg: 13.24631) QuantErr: 13.24631 batch_time=35.31012 
Train Epoch: 17 [12/250 1536/32000 (5%)] Loss: 1.45196 (QuantReg: 13.47717) QuantErr: 13.47717 batch_time=0.66882 
Train Epoch: 17 [23/250 2944/32000 (9%)] Loss: 1.13220 (QuantReg: 13.40266) QuantErr: 13.40266 batch_time=0.53530 
Train Epoch: 17 [34/250 4352/32000 (14%)] Loss: 1.07250 (QuantReg: 13.40332) QuantErr: 13.40332 batch_time=0.53024 
Train Epoch: 17 [45/250 5760/32000 (18%)] Loss: 1.44141 (QuantReg: 13.42394) QuantErr: 13.42394 batch_time=0.64021 
Train Epoch: 17 [56/250 7168/32000 (22%)] Loss: 1.11007 (QuantReg: 13.31204) QuantErr: 13.31204 batch_time=0.53380 
Train Epoch: 17 [67/250 8576/32000 (27%)] Loss: 0.95884 (QuantReg: 13.86435) QuantErr: 13.86435 batch_time=0.55546 
Train Epoch: 17 [78/250 9984/32000 (31%)] Loss: 1.32035 (QuantReg: 13.44894) QuantErr: 13.44894 batch_time=1.43118 
Train Epoch: 17 [89/250 11392/32000 (36%)] Loss: 1.06397 (QuantReg: 13.87740) QuantErr: 13.87740 batch_time=0.53514 
Train Epoch: 17 [100/250 12800/32000 (40%)] Loss: 1.25138 (QuantReg: 13.63337) QuantErr: 13.63337 batch_time=0.53273 
Train Epoch: 17 [111/250 14208/32000 (44%)] Loss: 1.21541 (QuantReg: 13.65693) QuantErr: 13.65693 batch_time=0.54431 
Train Epoch: 17 [122/250 15616/32000 (49%)] Loss: 1.30096 (QuantReg: 13.31862) QuantErr: 13.31862 batch_time=0.54006 
Train Epoch: 17 [133/250 17024/32000 (53%)] Loss: 1.08565 (QuantReg: 13.45854) QuantErr: 13.45854 batch_time=0.50662 
Train Epoch: 17 [144/250 18432/32000 (58%)] Loss: 1.68331 (QuantReg: 13.41498) QuantErr: 13.41498 batch_time=1.43474 
Train Epoch: 17 [155/250 19840/32000 (62%)] Loss: 1.19327 (QuantReg: 13.88534) QuantErr: 13.88534 batch_time=0.51173 
Train Epoch: 17 [166/250 21248/32000 (66%)] Loss: 1.05655 (QuantReg: 13.27895) QuantErr: 13.27895 batch_time=0.52305 
Train Epoch: 17 [177/250 22656/32000 (71%)] Loss: 1.05967 (QuantReg: 13.54748) QuantErr: 13.54748 batch_time=0.49725 
Train Epoch: 17 [188/250 24064/32000 (75%)] Loss: 1.11867 (QuantReg: 13.67878) QuantErr: 13.67878 batch_time=0.61249 
Train Epoch: 17 [199/250 25472/32000 (80%)] Loss: 1.46273 (QuantReg: 13.87872) QuantErr: 13.87872 batch_time=0.51134 
Train Epoch: 17 [210/250 26880/32000 (84%)] Loss: 1.17210 (QuantReg: 13.81262) QuantErr: 13.81262 batch_time=0.52787 
Train Epoch: 17 [221/250 28288/32000 (88%)] Loss: 1.03163 (QuantReg: 13.56257) QuantErr: 13.56257 batch_time=0.50489 
Train Epoch: 17 [232/250 29696/32000 (93%)] Loss: 1.31649 (QuantReg: 13.94966) QuantErr: 13.94966 batch_time=0.55817 
Train Epoch: 17 [243/250 31104/32000 (97%)] Loss: 1.17963 (QuantReg: 13.66999) QuantErr: 13.66999 batch_time=0.78811 
Train Epoch: 17 codebook_update_time=1.68689
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch17.pth ...
Done in 10.623s
removing stale ckpt [epoch 16] [took 0.27s]
 epoch          : 17
 loss           : 1.2328541700839997
 quant_reg      : 13.59514994430542
 quant_err      : 13.59514994430542
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 4250
 MSRVTT_full_val/t2v_metrics/R1: 34.40643863179074
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.088531187122737
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.06358062108049
 MSRVTT_full_val/v2t_metrics/R1: 36.21730382293762
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.010060362173038
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.66862786564222
 MSRVTT_full_test/t2v_metrics/R1: 12.207357859531772
 MSRVTT_full_test/t2v_metrics/R5: 35.68561872909699
 MSRVTT_full_test/t2v_metrics/R10: 49.163879598662206
 MSRVTT_full_test/t2v_metrics/R50: 80.96989966555184
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.248829431438125
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.770712212539475
 MSRVTT_full_test/v2t_metrics/R1: 15.384615384615385
 MSRVTT_full_test/v2t_metrics/R5: 42.80936454849498
 MSRVTT_full_test/v2t_metrics/R10: 57.95986622073578
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.159030100334448
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.67060601386602
 mnt_best       : 28.737033088279464
 not_improved_count: 1
Train Epoch: 18 [1/250 128/32000 (0%)] Loss: 1.37705 (QuantReg: 13.65302) QuantErr: 13.65302 batch_time=43.24482 
Train Epoch: 18 [12/250 1536/32000 (5%)] Loss: 1.32781 (QuantReg: 13.58447) QuantErr: 13.58447 batch_time=0.50285 
Train Epoch: 18 [23/250 2944/32000 (9%)] Loss: 1.24803 (QuantReg: 13.39293) QuantErr: 13.39293 batch_time=0.51266 
Train Epoch: 18 [34/250 4352/32000 (14%)] Loss: 1.15516 (QuantReg: 13.40968) QuantErr: 13.40968 batch_time=0.50915 
Train Epoch: 18 [45/250 5760/32000 (18%)] Loss: 1.26852 (QuantReg: 13.42531) QuantErr: 13.42531 batch_time=0.58824 
Train Epoch: 18 [56/250 7168/32000 (22%)] Loss: 1.23930 (QuantReg: 13.60278) QuantErr: 13.60278 batch_time=0.51106 
Train Epoch: 18 [67/250 8576/32000 (27%)] Loss: 1.53962 (QuantReg: 13.51658) QuantErr: 13.51658 batch_time=0.57289 
Train Epoch: 18 [78/250 9984/32000 (31%)] Loss: 1.36561 (QuantReg: 13.64546) QuantErr: 13.64546 batch_time=1.33388 
Train Epoch: 18 [89/250 11392/32000 (36%)] Loss: 1.06769 (QuantReg: 13.47450) QuantErr: 13.47450 batch_time=0.62792 
Train Epoch: 18 [100/250 12800/32000 (40%)] Loss: 1.13468 (QuantReg: 13.61628) QuantErr: 13.61628 batch_time=0.50816 
Train Epoch: 18 [111/250 14208/32000 (44%)] Loss: 1.07135 (QuantReg: 13.59112) QuantErr: 13.59112 batch_time=0.61546 
Train Epoch: 18 [122/250 15616/32000 (49%)] Loss: 1.56595 (QuantReg: 13.50191) QuantErr: 13.50191 batch_time=0.51070 
Train Epoch: 18 [133/250 17024/32000 (53%)] Loss: 1.65927 (QuantReg: 13.82782) QuantErr: 13.82782 batch_time=0.51250 
Train Epoch: 18 [144/250 18432/32000 (58%)] Loss: 1.05718 (QuantReg: 13.63642) QuantErr: 13.63642 batch_time=0.56730 
Train Epoch: 18 [155/250 19840/32000 (62%)] Loss: 1.25273 (QuantReg: 13.82717) QuantErr: 13.82717 batch_time=0.51003 
Train Epoch: 18 [166/250 21248/32000 (66%)] Loss: 1.53378 (QuantReg: 13.65277) QuantErr: 13.65277 batch_time=0.52095 
Train Epoch: 18 [177/250 22656/32000 (71%)] Loss: 1.12845 (QuantReg: 13.74633) QuantErr: 13.74633 batch_time=0.51221 
Train Epoch: 18 [188/250 24064/32000 (75%)] Loss: 0.96296 (QuantReg: 13.77900) QuantErr: 13.77900 batch_time=0.60019 
Train Epoch: 18 [199/250 25472/32000 (80%)] Loss: 1.15604 (QuantReg: 13.62154) QuantErr: 13.62154 batch_time=0.56173 
Train Epoch: 18 [210/250 26880/32000 (84%)] Loss: 1.51620 (QuantReg: 13.72282) QuantErr: 13.72282 batch_time=0.54791 
Train Epoch: 18 [221/250 28288/32000 (88%)] Loss: 1.20919 (QuantReg: 13.66777) QuantErr: 13.66777 batch_time=0.56622 
Train Epoch: 18 [232/250 29696/32000 (93%)] Loss: 0.81588 (QuantReg: 13.70012) QuantErr: 13.70012 batch_time=0.59245 
Train Epoch: 18 [243/250 31104/32000 (97%)] Loss: 1.03768 (QuantReg: 13.80004) QuantErr: 13.80004 batch_time=0.51196 
Train Epoch: 18 codebook_update_time=1.78998
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch18.pth ...
Done in 4.458s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch18.pth ...
Done in 8.618s
removing stale ckpt [epoch 17] [took 0.00s]
 epoch          : 18
 loss           : 1.1960028991699219
 quant_reg      : 13.598039344787598
 quant_err      : 13.598039344787598
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.686116700201207
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.016729995999235
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 79.07444668008048
 MSRVTT_full_val/v2t_metrics/R10: 88.73239436619718
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.754527162977867
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.82956301128492
 MSRVTT_full_test/t2v_metrics/R1: 13.177257525083611
 MSRVTT_full_test/t2v_metrics/R5: 36.55518394648829
 MSRVTT_full_test/t2v_metrics/R10: 49.69899665551839
 MSRVTT_full_test/t2v_metrics/R50: 80.73578595317726
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.12876254180602
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.820878157319637
 MSRVTT_full_test/v2t_metrics/R1: 15.652173913043478
 MSRVTT_full_test/v2t_metrics/R5: 43.64548494983278
 MSRVTT_full_test/v2t_metrics/R10: 57.9933110367893
 MSRVTT_full_test/v2t_metrics/R50: 87.09030100334448
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.607190635451506
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.09028491831504
 mnt_best       : 28.820878157319637
 not_improved_count: 0
Train Epoch: 19 [1/250 128/32000 (0%)] Loss: 1.07376 (QuantReg: 13.60369) QuantErr: 13.60369 batch_time=39.50680 
Train Epoch: 19 [12/250 1536/32000 (5%)] Loss: 1.19910 (QuantReg: 13.63717) QuantErr: 13.63717 batch_time=0.51419 
Train Epoch: 19 [23/250 2944/32000 (9%)] Loss: 1.34308 (QuantReg: 13.32033) QuantErr: 13.32033 batch_time=0.51511 
Train Epoch: 19 [34/250 4352/32000 (14%)] Loss: 1.22429 (QuantReg: 13.69280) QuantErr: 13.69280 batch_time=0.54682 
Train Epoch: 19 [45/250 5760/32000 (18%)] Loss: 1.14187 (QuantReg: 13.76097) QuantErr: 13.76097 batch_time=0.54481 
Train Epoch: 19 [56/250 7168/32000 (22%)] Loss: 1.26927 (QuantReg: 13.77154) QuantErr: 13.77154 batch_time=0.56333 
Train Epoch: 19 [67/250 8576/32000 (27%)] Loss: 1.13739 (QuantReg: 13.62018) QuantErr: 13.62018 batch_time=0.57046 
Train Epoch: 19 [78/250 9984/32000 (31%)] Loss: 1.44826 (QuantReg: 13.77438) QuantErr: 13.77438 batch_time=0.57618 
Train Epoch: 19 [89/250 11392/32000 (36%)] Loss: 1.19724 (QuantReg: 13.33131) QuantErr: 13.33131 batch_time=0.51921 
Train Epoch: 19 [100/250 12800/32000 (40%)] Loss: 1.18449 (QuantReg: 13.76076) QuantErr: 13.76076 batch_time=0.57440 
Train Epoch: 19 [111/250 14208/32000 (44%)] Loss: 0.98415 (QuantReg: 13.85197) QuantErr: 13.85197 batch_time=0.51730 
Train Epoch: 19 [122/250 15616/32000 (49%)] Loss: 1.17640 (QuantReg: 13.82790) QuantErr: 13.82790 batch_time=0.53816 
Train Epoch: 19 [133/250 17024/32000 (53%)] Loss: 1.28381 (QuantReg: 13.65857) QuantErr: 13.65857 batch_time=3.37138 
Train Epoch: 19 [144/250 18432/32000 (58%)] Loss: 0.83492 (QuantReg: 13.45110) QuantErr: 13.45110 batch_time=0.55691 
Train Epoch: 19 [155/250 19840/32000 (62%)] Loss: 1.25726 (QuantReg: 13.79895) QuantErr: 13.79895 batch_time=0.52274 
Train Epoch: 19 [166/250 21248/32000 (66%)] Loss: 0.78621 (QuantReg: 13.40345) QuantErr: 13.40345 batch_time=0.50781 
Train Epoch: 19 [177/250 22656/32000 (71%)] Loss: 1.31173 (QuantReg: 13.69331) QuantErr: 13.69331 batch_time=0.57389 
Train Epoch: 19 [188/250 24064/32000 (75%)] Loss: 1.30021 (QuantReg: 13.69004) QuantErr: 13.69004 batch_time=0.51034 
Train Epoch: 19 [199/250 25472/32000 (80%)] Loss: 1.12899 (QuantReg: 13.63226) QuantErr: 13.63226 batch_time=0.56522 
Train Epoch: 19 [210/250 26880/32000 (84%)] Loss: 0.82456 (QuantReg: 13.80777) QuantErr: 13.80777 batch_time=0.60112 
Train Epoch: 19 [221/250 28288/32000 (88%)] Loss: 0.84594 (QuantReg: 13.81521) QuantErr: 13.81521 batch_time=0.55241 
Train Epoch: 19 [232/250 29696/32000 (93%)] Loss: 0.86484 (QuantReg: 13.80691) QuantErr: 13.80691 batch_time=0.51207 
Train Epoch: 19 [243/250 31104/32000 (97%)] Loss: 1.07624 (QuantReg: 13.65781) QuantErr: 13.65781 batch_time=0.52308 
Train Epoch: 19 codebook_update_time=1.70383
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch19.pth ...
Done in 4.340s
removing stale ckpt [epoch 18] [took 0.00s]
 epoch          : 19
 loss           : 1.1588630201816559
 quant_reg      : 13.644915924072265
 quant_err      : 13.644915924072265
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 4750
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 68.2092555331992
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.927565392354125
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.34523033070244
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.525150905432596
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.03777118785402
 MSRVTT_full_test/t2v_metrics/R1: 12.709030100334449
 MSRVTT_full_test/t2v_metrics/R5: 35.986622073578594
 MSRVTT_full_test/t2v_metrics/R10: 49.56521739130435
 MSRVTT_full_test/t2v_metrics/R50: 80.43478260869566
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.89698996655518
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.301546582174367
 MSRVTT_full_test/v2t_metrics/R1: 15.384615384615385
 MSRVTT_full_test/v2t_metrics/R5: 43.24414715719063
 MSRVTT_full_test/v2t_metrics/R10: 57.759197324414714
 MSRVTT_full_test/v2t_metrics/R50: 87.02341137123746
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.005016722408026
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.74517694378468
 mnt_best       : 28.820878157319637
 not_improved_count: 1
Train Epoch: 20 [1/250 128/32000 (0%)] Loss: 1.27980 (QuantReg: 13.53859) QuantErr: 13.53859 batch_time=41.02218 
Train Epoch: 20 [12/250 1536/32000 (5%)] Loss: 1.31356 (QuantReg: 13.54582) QuantErr: 13.54582 batch_time=1.34159 
Train Epoch: 20 [23/250 2944/32000 (9%)] Loss: 1.18344 (QuantReg: 13.49708) QuantErr: 13.49708 batch_time=0.49746 
Train Epoch: 20 [34/250 4352/32000 (14%)] Loss: 1.13024 (QuantReg: 13.97134) QuantErr: 13.97134 batch_time=0.50214 
Train Epoch: 20 [45/250 5760/32000 (18%)] Loss: 1.23022 (QuantReg: 13.83806) QuantErr: 13.83806 batch_time=0.60438 
Train Epoch: 20 [56/250 7168/32000 (22%)] Loss: 1.14791 (QuantReg: 13.47864) QuantErr: 13.47864 batch_time=0.57136 
Train Epoch: 20 [67/250 8576/32000 (27%)] Loss: 1.07850 (QuantReg: 13.76931) QuantErr: 13.76931 batch_time=2.56008 
Train Epoch: 20 [78/250 9984/32000 (31%)] Loss: 0.94488 (QuantReg: 13.59570) QuantErr: 13.59570 batch_time=1.06034 
Train Epoch: 20 [89/250 11392/32000 (36%)] Loss: 1.45447 (QuantReg: 13.50776) QuantErr: 13.50776 batch_time=0.56197 
Train Epoch: 20 [100/250 12800/32000 (40%)] Loss: 1.11193 (QuantReg: 13.94608) QuantErr: 13.94608 batch_time=0.57773 
Train Epoch: 20 [111/250 14208/32000 (44%)] Loss: 1.00159 (QuantReg: 13.90584) QuantErr: 13.90584 batch_time=0.51265 
Train Epoch: 20 [122/250 15616/32000 (49%)] Loss: 0.95547 (QuantReg: 13.68228) QuantErr: 13.68228 batch_time=0.51147 
Train Epoch: 20 [133/250 17024/32000 (53%)] Loss: 1.19664 (QuantReg: 13.68658) QuantErr: 13.68658 batch_time=0.89313 
Train Epoch: 20 [144/250 18432/32000 (58%)] Loss: 1.34233 (QuantReg: 13.55929) QuantErr: 13.55929 batch_time=0.60149 
Train Epoch: 20 [155/250 19840/32000 (62%)] Loss: 1.34713 (QuantReg: 13.44655) QuantErr: 13.44655 batch_time=0.50592 
Train Epoch: 20 [166/250 21248/32000 (66%)] Loss: 1.42344 (QuantReg: 13.81159) QuantErr: 13.81159 batch_time=0.54012 
Train Epoch: 20 [177/250 22656/32000 (71%)] Loss: 1.08099 (QuantReg: 13.95217) QuantErr: 13.95217 batch_time=0.51867 
Train Epoch: 20 [188/250 24064/32000 (75%)] Loss: 0.98170 (QuantReg: 13.93099) QuantErr: 13.93099 batch_time=0.49930 
Train Epoch: 20 [199/250 25472/32000 (80%)] Loss: 0.92568 (QuantReg: 13.55542) QuantErr: 13.55542 batch_time=0.53044 
Train Epoch: 20 [210/250 26880/32000 (84%)] Loss: 1.47899 (QuantReg: 13.41092) QuantErr: 13.41092 batch_time=0.52366 
Train Epoch: 20 [221/250 28288/32000 (88%)] Loss: 1.67559 (QuantReg: 13.45347) QuantErr: 13.45347 batch_time=0.50723 
Train Epoch: 20 [232/250 29696/32000 (93%)] Loss: 1.10709 (QuantReg: 13.69641) QuantErr: 13.69641 batch_time=0.52126 
Train Epoch: 20 [243/250 31104/32000 (97%)] Loss: 0.80239 (QuantReg: 14.09467) QuantErr: 14.09467 batch_time=0.50532 
Train Epoch: 20 codebook_update_time=1.71203
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch20.pth ...
Done in 4.637s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch20.pth ...
Done in 26.664s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 1.14506255030632
 quant_reg      : 13.666170700073241
 quant_err      : 13.666170700073241
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.653923541247485
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.46126642062099
 MSRVTT_full_val/v2t_metrics/R1: 40.44265593561368
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 88.73239436619718
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.370221327967807
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.20770294327578
 MSRVTT_full_test/t2v_metrics/R1: 13.34448160535117
 MSRVTT_full_test/t2v_metrics/R5: 37.424749163879596
 MSRVTT_full_test/t2v_metrics/R10: 50.96989966555184
 MSRVTT_full_test/t2v_metrics/R50: 81.63879598662207
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.73277591973244
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.416531338765903
 MSRVTT_full_test/v2t_metrics/R1: 15.585284280936454
 MSRVTT_full_test/v2t_metrics/R5: 43.37792642140468
 MSRVTT_full_test/v2t_metrics/R10: 58.16053511705686
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 28.932608695652174
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.00457124186057
 mnt_best       : 29.416531338765903
 not_improved_count: 0
Train Epoch: 21 [1/250 128/32000 (0%)] Loss: 1.03015 (QuantReg: 13.55922) QuantErr: 13.55922 batch_time=34.41757 
Train Epoch: 21 [12/250 1536/32000 (5%)] Loss: 1.11336 (QuantReg: 13.71240) QuantErr: 13.71240 batch_time=0.51894 
Train Epoch: 21 [23/250 2944/32000 (9%)] Loss: 1.12934 (QuantReg: 13.47500) QuantErr: 13.47500 batch_time=0.56103 
Train Epoch: 21 [34/250 4352/32000 (14%)] Loss: 0.96298 (QuantReg: 13.91526) QuantErr: 13.91526 batch_time=0.53147 
Train Epoch: 21 [45/250 5760/32000 (18%)] Loss: 0.86141 (QuantReg: 13.61735) QuantErr: 13.61735 batch_time=0.51211 
Train Epoch: 21 [56/250 7168/32000 (22%)] Loss: 0.86668 (QuantReg: 14.05441) QuantErr: 14.05441 batch_time=0.50711 
Train Epoch: 21 [67/250 8576/32000 (27%)] Loss: 1.14579 (QuantReg: 13.63454) QuantErr: 13.63454 batch_time=0.57421 
Train Epoch: 21 [78/250 9984/32000 (31%)] Loss: 1.26874 (QuantReg: 13.45859) QuantErr: 13.45859 batch_time=0.62128 
Train Epoch: 21 [89/250 11392/32000 (36%)] Loss: 1.26893 (QuantReg: 13.75413) QuantErr: 13.75413 batch_time=0.50584 
Train Epoch: 21 [100/250 12800/32000 (40%)] Loss: 1.19620 (QuantReg: 13.46777) QuantErr: 13.46777 batch_time=0.51085 
Train Epoch: 21 [111/250 14208/32000 (44%)] Loss: 1.05751 (QuantReg: 13.56351) QuantErr: 13.56351 batch_time=0.54039 
Train Epoch: 21 [122/250 15616/32000 (49%)] Loss: 1.09353 (QuantReg: 13.76307) QuantErr: 13.76307 batch_time=0.58701 
Train Epoch: 21 [133/250 17024/32000 (53%)] Loss: 0.88426 (QuantReg: 13.56102) QuantErr: 13.56102 batch_time=0.51451 
Train Epoch: 21 [144/250 18432/32000 (58%)] Loss: 1.22618 (QuantReg: 13.82724) QuantErr: 13.82724 batch_time=0.57914 
Train Epoch: 21 [155/250 19840/32000 (62%)] Loss: 1.11881 (QuantReg: 13.55000) QuantErr: 13.55000 batch_time=0.53985 
Train Epoch: 21 [166/250 21248/32000 (66%)] Loss: 0.96722 (QuantReg: 13.85596) QuantErr: 13.85596 batch_time=0.62827 
Train Epoch: 21 [177/250 22656/32000 (71%)] Loss: 1.30251 (QuantReg: 14.04422) QuantErr: 14.04422 batch_time=0.55166 
Train Epoch: 21 [188/250 24064/32000 (75%)] Loss: 1.03445 (QuantReg: 13.49299) QuantErr: 13.49299 batch_time=0.87586 
Train Epoch: 21 [199/250 25472/32000 (80%)] Loss: 1.11614 (QuantReg: 13.81440) QuantErr: 13.81440 batch_time=0.66843 
Train Epoch: 21 [210/250 26880/32000 (84%)] Loss: 1.40505 (QuantReg: 13.63026) QuantErr: 13.63026 batch_time=0.58038 
Train Epoch: 21 [221/250 28288/32000 (88%)] Loss: 1.07916 (QuantReg: 13.91926) QuantErr: 13.91926 batch_time=0.51203 
Train Epoch: 21 [232/250 29696/32000 (93%)] Loss: 1.02046 (QuantReg: 14.04307) QuantErr: 14.04307 batch_time=0.56790 
Train Epoch: 21 [243/250 31104/32000 (97%)] Loss: 0.87679 (QuantReg: 13.69723) QuantErr: 13.69723 batch_time=0.64126 
Train Epoch: 21 codebook_update_time=1.77622
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch21.pth ...
Done in 4.254s
removing stale ckpt [epoch 20] [took 0.00s]
 epoch          : 21
 loss           : 1.10605775308609
 quant_reg      : 13.685167694091797
 quant_err      : 13.685167694091797
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 5250
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.086519114688128
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.52519907279377
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.020120724346077
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.4356568384265
 MSRVTT_full_test/t2v_metrics/R1: 12.642140468227424
 MSRVTT_full_test/t2v_metrics/R5: 35.51839464882943
 MSRVTT_full_test/t2v_metrics/R10: 49.197324414715716
 MSRVTT_full_test/t2v_metrics/R50: 80.16722408026756
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.33913043478261
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.05897538732395
 MSRVTT_full_test/v2t_metrics/R1: 15.250836120401338
 MSRVTT_full_test/v2t_metrics/R5: 42.07357859531773
 MSRVTT_full_test/v2t_metrics/R10: 56.48829431438127
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.070234113712374
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.09435003911556
 mnt_best       : 29.416531338765903
 not_improved_count: 1
Train Epoch: 22 [1/250 128/32000 (0%)] Loss: 1.23585 (QuantReg: 13.47981) QuantErr: 13.47981 batch_time=41.42656 
Train Epoch: 22 [12/250 1536/32000 (5%)] Loss: 1.10792 (QuantReg: 13.67778) QuantErr: 13.67778 batch_time=0.62010 
Train Epoch: 22 [23/250 2944/32000 (9%)] Loss: 1.00177 (QuantReg: 13.67908) QuantErr: 13.67908 batch_time=0.53109 
Train Epoch: 22 [34/250 4352/32000 (14%)] Loss: 1.01615 (QuantReg: 13.33117) QuantErr: 13.33117 batch_time=0.63880 
Train Epoch: 22 [45/250 5760/32000 (18%)] Loss: 0.96407 (QuantReg: 13.80437) QuantErr: 13.80437 batch_time=0.50351 
Train Epoch: 22 [56/250 7168/32000 (22%)] Loss: 1.02616 (QuantReg: 13.68279) QuantErr: 13.68279 batch_time=0.55109 
Train Epoch: 22 [67/250 8576/32000 (27%)] Loss: 1.18656 (QuantReg: 13.51765) QuantErr: 13.51765 batch_time=0.50432 
Train Epoch: 22 [78/250 9984/32000 (31%)] Loss: 1.10421 (QuantReg: 13.46365) QuantErr: 13.46365 batch_time=0.51898 
Train Epoch: 22 [89/250 11392/32000 (36%)] Loss: 1.26821 (QuantReg: 13.28671) QuantErr: 13.28671 batch_time=0.55186 
Train Epoch: 22 [100/250 12800/32000 (40%)] Loss: 1.18972 (QuantReg: 13.72173) QuantErr: 13.72173 batch_time=0.55771 
Train Epoch: 22 [111/250 14208/32000 (44%)] Loss: 1.34361 (QuantReg: 13.56670) QuantErr: 13.56670 batch_time=0.58389 
Train Epoch: 22 [122/250 15616/32000 (49%)] Loss: 1.04754 (QuantReg: 13.77929) QuantErr: 13.77929 batch_time=0.51998 
Train Epoch: 22 [133/250 17024/32000 (53%)] Loss: 1.22314 (QuantReg: 13.74156) QuantErr: 13.74156 batch_time=1.35626 
Train Epoch: 22 [144/250 18432/32000 (58%)] Loss: 1.19237 (QuantReg: 13.71360) QuantErr: 13.71360 batch_time=0.53555 
Train Epoch: 22 [155/250 19840/32000 (62%)] Loss: 1.06817 (QuantReg: 13.76727) QuantErr: 13.76727 batch_time=0.59511 
Train Epoch: 22 [166/250 21248/32000 (66%)] Loss: 1.26816 (QuantReg: 13.66830) QuantErr: 13.66830 batch_time=0.58081 
Train Epoch: 22 [177/250 22656/32000 (71%)] Loss: 1.26054 (QuantReg: 13.69814) QuantErr: 13.69814 batch_time=0.57663 
Train Epoch: 22 [188/250 24064/32000 (75%)] Loss: 1.14319 (QuantReg: 13.81719) QuantErr: 13.81719 batch_time=0.50686 
Train Epoch: 22 [199/250 25472/32000 (80%)] Loss: 1.08505 (QuantReg: 13.51567) QuantErr: 13.51567 batch_time=0.53250 
Train Epoch: 22 [210/250 26880/32000 (84%)] Loss: 1.12683 (QuantReg: 13.78601) QuantErr: 13.78601 batch_time=0.52552 
Train Epoch: 22 [221/250 28288/32000 (88%)] Loss: 1.14231 (QuantReg: 13.73285) QuantErr: 13.73285 batch_time=0.53633 
Train Epoch: 22 [232/250 29696/32000 (93%)] Loss: 1.01360 (QuantReg: 13.65115) QuantErr: 13.65115 batch_time=0.53470 
Train Epoch: 22 [243/250 31104/32000 (97%)] Loss: 0.87459 (QuantReg: 13.90986) QuantErr: 13.90986 batch_time=0.59500 
Train Epoch: 22 codebook_update_time=1.86979
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch22.pth ...
Done in 17.705s
removing stale ckpt [epoch 21] [took 0.01s]
 epoch          : 22
 loss           : 1.076625516653061
 quant_reg      : 13.717993328094483
 quant_err      : 13.717993328094483
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.476861167002012
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.93438257557631
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.062374245472837
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.32092617095575
 MSRVTT_full_test/t2v_metrics/R1: 13.076923076923077
 MSRVTT_full_test/t2v_metrics/R5: 35.48494983277592
 MSRVTT_full_test/t2v_metrics/R10: 49.39799331103679
 MSRVTT_full_test/t2v_metrics/R50: 80.63545150501672
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.531772575250834
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.406628428760946
 MSRVTT_full_test/v2t_metrics/R1: 15.785953177257525
 MSRVTT_full_test/v2t_metrics/R5: 42.10702341137124
 MSRVTT_full_test/v2t_metrics/R10: 57.05685618729097
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.372240802675584
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.597817253443885
 mnt_best       : 29.416531338765903
 not_improved_count: 2
Train Epoch: 23 [1/250 128/32000 (0%)] Loss: 1.17679 (QuantReg: 13.42555) QuantErr: 13.42555 batch_time=49.55864 
Train Epoch: 23 [12/250 1536/32000 (5%)] Loss: 1.20144 (QuantReg: 13.87836) QuantErr: 13.87836 batch_time=0.52798 
Train Epoch: 23 [23/250 2944/32000 (9%)] Loss: 0.82808 (QuantReg: 13.74462) QuantErr: 13.74462 batch_time=0.51684 
Train Epoch: 23 [34/250 4352/32000 (14%)] Loss: 1.08571 (QuantReg: 13.64918) QuantErr: 13.64918 batch_time=0.53753 
Train Epoch: 23 [45/250 5760/32000 (18%)] Loss: 1.01985 (QuantReg: 13.66682) QuantErr: 13.66682 batch_time=0.52154 
Train Epoch: 23 [56/250 7168/32000 (22%)] Loss: 1.05383 (QuantReg: 13.73174) QuantErr: 13.73174 batch_time=0.55992 
Train Epoch: 23 [67/250 8576/32000 (27%)] Loss: 0.94068 (QuantReg: 13.71103) QuantErr: 13.71103 batch_time=0.58345 
Train Epoch: 23 [78/250 9984/32000 (31%)] Loss: 1.15396 (QuantReg: 13.74465) QuantErr: 13.74465 batch_time=0.55045 
Train Epoch: 23 [89/250 11392/32000 (36%)] Loss: 1.14427 (QuantReg: 13.37821) QuantErr: 13.37821 batch_time=0.56810 
Train Epoch: 23 [100/250 12800/32000 (40%)] Loss: 0.90727 (QuantReg: 13.75976) QuantErr: 13.75976 batch_time=0.54023 
Train Epoch: 23 [111/250 14208/32000 (44%)] Loss: 1.26829 (QuantReg: 13.69748) QuantErr: 13.69748 batch_time=0.55646 
Train Epoch: 23 [122/250 15616/32000 (49%)] Loss: 1.06483 (QuantReg: 13.41946) QuantErr: 13.41946 batch_time=0.50922 
Train Epoch: 23 [133/250 17024/32000 (53%)] Loss: 1.00440 (QuantReg: 13.71138) QuantErr: 13.71138 batch_time=0.52403 
Train Epoch: 23 [144/250 18432/32000 (58%)] Loss: 1.21873 (QuantReg: 13.88042) QuantErr: 13.88042 batch_time=0.51605 
Train Epoch: 23 [155/250 19840/32000 (62%)] Loss: 1.32385 (QuantReg: 13.76092) QuantErr: 13.76092 batch_time=0.52180 
Train Epoch: 23 [166/250 21248/32000 (66%)] Loss: 1.15498 (QuantReg: 13.50964) QuantErr: 13.50964 batch_time=0.51828 
Train Epoch: 23 [177/250 22656/32000 (71%)] Loss: 0.78739 (QuantReg: 14.06934) QuantErr: 14.06934 batch_time=0.55082 
Train Epoch: 23 [188/250 24064/32000 (75%)] Loss: 1.12767 (QuantReg: 13.80271) QuantErr: 13.80271 batch_time=0.56142 
Train Epoch: 23 [199/250 25472/32000 (80%)] Loss: 0.78648 (QuantReg: 14.08610) QuantErr: 14.08610 batch_time=0.55559 
Train Epoch: 23 [210/250 26880/32000 (84%)] Loss: 0.85701 (QuantReg: 13.87946) QuantErr: 13.87946 batch_time=1.78679 
Train Epoch: 23 [221/250 28288/32000 (88%)] Loss: 0.79923 (QuantReg: 13.92888) QuantErr: 13.92888 batch_time=0.54381 
Train Epoch: 23 [232/250 29696/32000 (93%)] Loss: 0.99521 (QuantReg: 13.80070) QuantErr: 13.80070 batch_time=0.55934 
Train Epoch: 23 [243/250 31104/32000 (97%)] Loss: 1.19660 (QuantReg: 13.30571) QuantErr: 13.30571 batch_time=0.53607 
Train Epoch: 23 codebook_update_time=1.95402
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch23.pth ...
Done in 4.542s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 1.0887771661281587
 quant_reg      : 13.723430633544922
 quant_err      : 13.723430633544922
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 5750
 MSRVTT_full_val/t2v_metrics/R1: 33.199195171026155
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.869215291750503
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.25759267873614
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.078470824949698
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.48358480518172
 MSRVTT_full_test/t2v_metrics/R1: 12.307692307692308
 MSRVTT_full_test/t2v_metrics/R5: 36.48829431438127
 MSRVTT_full_test/t2v_metrics/R10: 49.56521739130435
 MSRVTT_full_test/t2v_metrics/R50: 81.23745819397993
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.32541806020067
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.12995706580276
 MSRVTT_full_test/v2t_metrics/R1: 15.384615384615385
 MSRVTT_full_test/v2t_metrics/R5: 43.51170568561873
 MSRVTT_full_test/v2t_metrics/R10: 58.16053511705686
 MSRVTT_full_test/v2t_metrics/R50: 87.25752508361204
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.881270903010034
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.89276874877225
 mnt_best       : 29.416531338765903
 not_improved_count: 3
Train Epoch: 24 [1/250 128/32000 (0%)] Loss: 1.33284 (QuantReg: 13.49167) QuantErr: 13.49167 batch_time=34.28846 
Train Epoch: 24 [12/250 1536/32000 (5%)] Loss: 0.94803 (QuantReg: 13.80670) QuantErr: 13.80670 batch_time=0.53467 
Train Epoch: 24 [23/250 2944/32000 (9%)] Loss: 0.91585 (QuantReg: 13.88477) QuantErr: 13.88477 batch_time=0.65300 
Train Epoch: 24 [34/250 4352/32000 (14%)] Loss: 1.15863 (QuantReg: 13.88018) QuantErr: 13.88018 batch_time=0.56743 
Train Epoch: 24 [45/250 5760/32000 (18%)] Loss: 1.23097 (QuantReg: 13.42870) QuantErr: 13.42870 batch_time=0.50442 
Train Epoch: 24 [56/250 7168/32000 (22%)] Loss: 0.72922 (QuantReg: 13.84995) QuantErr: 13.84995 batch_time=0.53068 
Train Epoch: 24 [67/250 8576/32000 (27%)] Loss: 0.73073 (QuantReg: 13.93722) QuantErr: 13.93722 batch_time=0.51221 
Train Epoch: 24 [78/250 9984/32000 (31%)] Loss: 0.98352 (QuantReg: 13.58146) QuantErr: 13.58146 batch_time=0.51526 
Train Epoch: 24 [89/250 11392/32000 (36%)] Loss: 0.91853 (QuantReg: 13.74894) QuantErr: 13.74894 batch_time=0.56638 
Train Epoch: 24 [100/250 12800/32000 (40%)] Loss: 1.00061 (QuantReg: 13.77264) QuantErr: 13.77264 batch_time=0.51726 
Train Epoch: 24 [111/250 14208/32000 (44%)] Loss: 1.17432 (QuantReg: 13.56213) QuantErr: 13.56213 batch_time=0.57372 
Train Epoch: 24 [122/250 15616/32000 (49%)] Loss: 1.17958 (QuantReg: 13.58490) QuantErr: 13.58490 batch_time=0.53672 
Train Epoch: 24 [133/250 17024/32000 (53%)] Loss: 0.93263 (QuantReg: 13.86443) QuantErr: 13.86443 batch_time=4.91103 
Train Epoch: 24 [144/250 18432/32000 (58%)] Loss: 1.38648 (QuantReg: 14.05805) QuantErr: 14.05805 batch_time=0.52922 
Train Epoch: 24 [155/250 19840/32000 (62%)] Loss: 1.12772 (QuantReg: 13.43940) QuantErr: 13.43940 batch_time=0.52897 
Train Epoch: 24 [166/250 21248/32000 (66%)] Loss: 0.88189 (QuantReg: 14.00859) QuantErr: 14.00859 batch_time=0.50538 
Train Epoch: 24 [177/250 22656/32000 (71%)] Loss: 0.90270 (QuantReg: 14.07145) QuantErr: 14.07145 batch_time=0.56158 
Train Epoch: 24 [188/250 24064/32000 (75%)] Loss: 0.86191 (QuantReg: 13.86796) QuantErr: 13.86796 batch_time=0.59548 
Train Epoch: 24 [199/250 25472/32000 (80%)] Loss: 1.06773 (QuantReg: 13.71688) QuantErr: 13.71688 batch_time=0.50597 
Train Epoch: 24 [210/250 26880/32000 (84%)] Loss: 0.81751 (QuantReg: 14.03438) QuantErr: 14.03438 batch_time=0.55793 
Train Epoch: 24 [221/250 28288/32000 (88%)] Loss: 1.21175 (QuantReg: 13.58510) QuantErr: 13.58510 batch_time=0.51465 
Train Epoch: 24 [232/250 29696/32000 (93%)] Loss: 1.33422 (QuantReg: 13.78306) QuantErr: 13.78306 batch_time=0.54355 
Train Epoch: 24 [243/250 31104/32000 (97%)] Loss: 1.04248 (QuantReg: 13.71197) QuantErr: 13.71197 batch_time=0.55900 
Train Epoch: 24 codebook_update_time=1.72825
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch24.pth ...
Done in 17.022s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 1.0343725199699403
 quant_reg      : 13.789744724273682
 quant_err      : 13.789744724273682
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.619718309859156
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.923670246699814
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.209255533199195
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.36376064694966
 MSRVTT_full_test/t2v_metrics/R1: 13.010033444816054
 MSRVTT_full_test/t2v_metrics/R5: 35.953177257525084
 MSRVTT_full_test/t2v_metrics/R10: 49.264214046822744
 MSRVTT_full_test/t2v_metrics/R50: 80.36789297658864
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.83545150501672
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.456561115305274
 MSRVTT_full_test/v2t_metrics/R1: 15.618729096989966
 MSRVTT_full_test/v2t_metrics/R5: 42.541806020066886
 MSRVTT_full_test/v2t_metrics/R10: 57.22408026755853
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.329765886287625
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.626382245739094
 mnt_best       : 29.416531338765903
 not_improved_count: 4
Train Epoch: 25 [1/250 128/32000 (0%)] Loss: 1.20910 (QuantReg: 13.62726) QuantErr: 13.62726 batch_time=51.94996 
Train Epoch: 25 [12/250 1536/32000 (5%)] Loss: 1.05535 (QuantReg: 13.70905) QuantErr: 13.70905 batch_time=0.56824 
Train Epoch: 25 [23/250 2944/32000 (9%)] Loss: 0.93363 (QuantReg: 14.08769) QuantErr: 14.08769 batch_time=0.53972 
Train Epoch: 25 [34/250 4352/32000 (14%)] Loss: 1.21786 (QuantReg: 13.59374) QuantErr: 13.59374 batch_time=0.79464 
Train Epoch: 25 [45/250 5760/32000 (18%)] Loss: 0.97953 (QuantReg: 13.66604) QuantErr: 13.66604 batch_time=0.60006 
Train Epoch: 25 [56/250 7168/32000 (22%)] Loss: 1.02689 (QuantReg: 13.81415) QuantErr: 13.81415 batch_time=0.63691 
Train Epoch: 25 [67/250 8576/32000 (27%)] Loss: 1.13606 (QuantReg: 13.55542) QuantErr: 13.55542 batch_time=0.55982 
Train Epoch: 25 [78/250 9984/32000 (31%)] Loss: 1.06622 (QuantReg: 13.93696) QuantErr: 13.93696 batch_time=0.58018 
Train Epoch: 25 [89/250 11392/32000 (36%)] Loss: 0.75702 (QuantReg: 13.85494) QuantErr: 13.85494 batch_time=0.51572 
Train Epoch: 25 [100/250 12800/32000 (40%)] Loss: 1.13165 (QuantReg: 13.70787) QuantErr: 13.70787 batch_time=0.52579 
Train Epoch: 25 [111/250 14208/32000 (44%)] Loss: 1.20010 (QuantReg: 13.64299) QuantErr: 13.64299 batch_time=0.51552 
Train Epoch: 25 [122/250 15616/32000 (49%)] Loss: 0.81450 (QuantReg: 13.75587) QuantErr: 13.75587 batch_time=0.59448 
Train Epoch: 25 [133/250 17024/32000 (53%)] Loss: 0.98920 (QuantReg: 13.80376) QuantErr: 13.80376 batch_time=0.51180 
Train Epoch: 25 [144/250 18432/32000 (58%)] Loss: 1.00048 (QuantReg: 13.88399) QuantErr: 13.88399 batch_time=0.51922 
Train Epoch: 25 [155/250 19840/32000 (62%)] Loss: 1.14729 (QuantReg: 13.80861) QuantErr: 13.80861 batch_time=0.60490 
Train Epoch: 25 [166/250 21248/32000 (66%)] Loss: 1.18839 (QuantReg: 13.46478) QuantErr: 13.46478 batch_time=0.56121 
Train Epoch: 25 [177/250 22656/32000 (71%)] Loss: 0.91468 (QuantReg: 13.87019) QuantErr: 13.87019 batch_time=1.04174 
Train Epoch: 25 [188/250 24064/32000 (75%)] Loss: 0.95186 (QuantReg: 14.02072) QuantErr: 14.02072 batch_time=0.55204 
Train Epoch: 25 [199/250 25472/32000 (80%)] Loss: 0.94146 (QuantReg: 13.84407) QuantErr: 13.84407 batch_time=0.55590 
Train Epoch: 25 [210/250 26880/32000 (84%)] Loss: 1.08743 (QuantReg: 13.71793) QuantErr: 13.71793 batch_time=0.52449 
Train Epoch: 25 [221/250 28288/32000 (88%)] Loss: 1.08983 (QuantReg: 13.76035) QuantErr: 13.76035 batch_time=0.54455 
Train Epoch: 25 [232/250 29696/32000 (93%)] Loss: 1.03867 (QuantReg: 13.71985) QuantErr: 13.71985 batch_time=0.50897 
Train Epoch: 25 [243/250 31104/32000 (97%)] Loss: 1.06972 (QuantReg: 13.59330) QuantErr: 13.59330 batch_time=0.59470 
Train Epoch: 25 codebook_update_time=1.79902
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch25.pth ...
Done in 19.270s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 1.0371151540279389
 quant_reg      : 13.780089302062988
 quant_err      : 13.780089302062988
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 6250
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.674044265593562
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.1436063549409
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.062374245472837
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.2997065401727
 MSRVTT_full_test/t2v_metrics/R1: 13.612040133779264
 MSRVTT_full_test/t2v_metrics/R5: 36.68896321070234
 MSRVTT_full_test/t2v_metrics/R10: 49.23076923076923
 MSRVTT_full_test/t2v_metrics/R50: 81.07023411371237
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.20267558528428
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.07803761037239
 MSRVTT_full_test/v2t_metrics/R1: 15.785953177257525
 MSRVTT_full_test/v2t_metrics/R5: 44.214046822742475
 MSRVTT_full_test/v2t_metrics/R10: 58.32775919732441
 MSRVTT_full_test/v2t_metrics/R50: 87.09030100334448
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.04515050167224
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.4008196028142
 mnt_best       : 29.416531338765903
 not_improved_count: 5
Train Epoch: 26 [1/250 128/32000 (0%)] Loss: 1.14511 (QuantReg: 13.60939) QuantErr: 13.60939 batch_time=40.16054 
Train Epoch: 26 [12/250 1536/32000 (5%)] Loss: 1.19259 (QuantReg: 13.48735) QuantErr: 13.48735 batch_time=0.54390 
Train Epoch: 26 [23/250 2944/32000 (9%)] Loss: 0.70559 (QuantReg: 13.90938) QuantErr: 13.90938 batch_time=0.53015 
Train Epoch: 26 [34/250 4352/32000 (14%)] Loss: 0.96237 (QuantReg: 13.77363) QuantErr: 13.77363 batch_time=0.51743 
Train Epoch: 26 [45/250 5760/32000 (18%)] Loss: 0.94802 (QuantReg: 13.79569) QuantErr: 13.79569 batch_time=0.51564 
Train Epoch: 26 [56/250 7168/32000 (22%)] Loss: 1.10291 (QuantReg: 13.82126) QuantErr: 13.82126 batch_time=0.53981 
Train Epoch: 26 [67/250 8576/32000 (27%)] Loss: 0.94583 (QuantReg: 14.05256) QuantErr: 14.05256 batch_time=0.50528 
Train Epoch: 26 [78/250 9984/32000 (31%)] Loss: 1.09686 (QuantReg: 13.98706) QuantErr: 13.98706 batch_time=0.53097 
Train Epoch: 26 [89/250 11392/32000 (36%)] Loss: 1.03077 (QuantReg: 13.77748) QuantErr: 13.77748 batch_time=0.55728 
Train Epoch: 26 [100/250 12800/32000 (40%)] Loss: 0.88939 (QuantReg: 13.66997) QuantErr: 13.66997 batch_time=0.59640 
Train Epoch: 26 [111/250 14208/32000 (44%)] Loss: 0.82265 (QuantReg: 13.95299) QuantErr: 13.95299 batch_time=0.55043 
Train Epoch: 26 [122/250 15616/32000 (49%)] Loss: 0.89052 (QuantReg: 13.84261) QuantErr: 13.84261 batch_time=0.50511 
Train Epoch: 26 [133/250 17024/32000 (53%)] Loss: 0.87032 (QuantReg: 13.52982) QuantErr: 13.52982 batch_time=0.57520 
Train Epoch: 26 [144/250 18432/32000 (58%)] Loss: 0.95326 (QuantReg: 13.64466) QuantErr: 13.64466 batch_time=0.58399 
Train Epoch: 26 [155/250 19840/32000 (62%)] Loss: 1.18975 (QuantReg: 13.56110) QuantErr: 13.56110 batch_time=0.53619 
Train Epoch: 26 [166/250 21248/32000 (66%)] Loss: 0.98679 (QuantReg: 13.89285) QuantErr: 13.89285 batch_time=0.51001 
Train Epoch: 26 [177/250 22656/32000 (71%)] Loss: 0.97001 (QuantReg: 13.65144) QuantErr: 13.65144 batch_time=0.50660 
Train Epoch: 26 [188/250 24064/32000 (75%)] Loss: 0.87617 (QuantReg: 13.90989) QuantErr: 13.90989 batch_time=0.53778 
Train Epoch: 26 [199/250 25472/32000 (80%)] Loss: 1.03241 (QuantReg: 13.98157) QuantErr: 13.98157 batch_time=0.51023 
Train Epoch: 26 [210/250 26880/32000 (84%)] Loss: 0.81058 (QuantReg: 13.94326) QuantErr: 13.94326 batch_time=0.62082 
Train Epoch: 26 [221/250 28288/32000 (88%)] Loss: 1.63929 (QuantReg: 13.73359) QuantErr: 13.73359 batch_time=0.59069 
Train Epoch: 26 [232/250 29696/32000 (93%)] Loss: 0.93527 (QuantReg: 13.97277) QuantErr: 13.97277 batch_time=0.65060 
Train Epoch: 26 [243/250 31104/32000 (97%)] Loss: 0.80463 (QuantReg: 13.89515) QuantErr: 13.89515 batch_time=0.51991 
Train Epoch: 26 codebook_update_time=2.07629
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch26.pth ...
Done in 4.762s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 1.0253530023097992
 quant_reg      : 13.811811882019043
 quant_err      : 13.811811882019043
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.21327967806841
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.41432369930422
 MSRVTT_full_val/v2t_metrics/R1: 37.02213279678068
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.579476861167002
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.33511704071418
 MSRVTT_full_test/t2v_metrics/R1: 13.311036789297658
 MSRVTT_full_test/t2v_metrics/R5: 36.15384615384615
 MSRVTT_full_test/t2v_metrics/R10: 49.63210702341137
 MSRVTT_full_test/t2v_metrics/R50: 80.46822742474916
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.050501672240806
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.798931002579337
 MSRVTT_full_test/v2t_metrics/R1: 16.187290969899667
 MSRVTT_full_test/v2t_metrics/R5: 43.27759197324415
 MSRVTT_full_test/v2t_metrics/R10: 57.89297658862876
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.835953177257526
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.357459795142205
 mnt_best       : 29.416531338765903
 not_improved_count: 6
Train Epoch: 27 [1/250 128/32000 (0%)] Loss: 0.74855 (QuantReg: 14.01499) QuantErr: 14.01499 batch_time=42.52067 
Train Epoch: 27 [12/250 1536/32000 (5%)] Loss: 1.32431 (QuantReg: 13.93909) QuantErr: 13.93909 batch_time=0.57570 
Train Epoch: 27 [23/250 2944/32000 (9%)] Loss: 0.98987 (QuantReg: 13.94093) QuantErr: 13.94093 batch_time=0.64566 
Train Epoch: 27 [34/250 4352/32000 (14%)] Loss: 0.99515 (QuantReg: 13.97584) QuantErr: 13.97584 batch_time=0.54351 
Train Epoch: 27 [45/250 5760/32000 (18%)] Loss: 0.93910 (QuantReg: 13.77604) QuantErr: 13.77604 batch_time=0.50001 
Train Epoch: 27 [56/250 7168/32000 (22%)] Loss: 0.73187 (QuantReg: 14.07626) QuantErr: 14.07626 batch_time=0.51426 
Train Epoch: 27 [67/250 8576/32000 (27%)] Loss: 0.86977 (QuantReg: 13.87898) QuantErr: 13.87898 batch_time=0.56889 
Train Epoch: 27 [78/250 9984/32000 (31%)] Loss: 0.88728 (QuantReg: 13.70609) QuantErr: 13.70609 batch_time=0.51817 
Train Epoch: 27 [89/250 11392/32000 (36%)] Loss: 0.95840 (QuantReg: 13.94146) QuantErr: 13.94146 batch_time=0.52597 
Train Epoch: 27 [100/250 12800/32000 (40%)] Loss: 1.00531 (QuantReg: 13.61292) QuantErr: 13.61292 batch_time=0.54872 
Train Epoch: 27 [111/250 14208/32000 (44%)] Loss: 0.88348 (QuantReg: 14.04733) QuantErr: 14.04733 batch_time=0.54285 
Train Epoch: 27 [122/250 15616/32000 (49%)] Loss: 0.97943 (QuantReg: 13.84110) QuantErr: 13.84110 batch_time=0.58617 
Train Epoch: 27 [133/250 17024/32000 (53%)] Loss: 1.09125 (QuantReg: 13.88768) QuantErr: 13.88768 batch_time=0.59941 
Train Epoch: 27 [144/250 18432/32000 (58%)] Loss: 0.81936 (QuantReg: 13.84818) QuantErr: 13.84818 batch_time=0.55665 
Train Epoch: 27 [155/250 19840/32000 (62%)] Loss: 0.86578 (QuantReg: 14.06646) QuantErr: 14.06646 batch_time=0.51884 
Train Epoch: 27 [166/250 21248/32000 (66%)] Loss: 1.02059 (QuantReg: 13.81233) QuantErr: 13.81233 batch_time=0.50775 
Train Epoch: 27 [177/250 22656/32000 (71%)] Loss: 1.18870 (QuantReg: 13.73033) QuantErr: 13.73033 batch_time=0.51999 
Train Epoch: 27 [188/250 24064/32000 (75%)] Loss: 0.92794 (QuantReg: 13.77222) QuantErr: 13.77222 batch_time=0.59451 
Train Epoch: 27 [199/250 25472/32000 (80%)] Loss: 1.15577 (QuantReg: 13.93600) QuantErr: 13.93600 batch_time=0.50745 
Train Epoch: 27 [210/250 26880/32000 (84%)] Loss: 0.85980 (QuantReg: 14.21520) QuantErr: 14.21520 batch_time=0.55293 
Train Epoch: 27 [221/250 28288/32000 (88%)] Loss: 0.88012 (QuantReg: 13.74283) QuantErr: 13.74283 batch_time=0.64071 
Train Epoch: 27 [232/250 29696/32000 (93%)] Loss: 0.88366 (QuantReg: 13.84711) QuantErr: 13.84711 batch_time=0.71089 
Train Epoch: 27 [243/250 31104/32000 (97%)] Loss: 0.97417 (QuantReg: 13.85287) QuantErr: 13.85287 batch_time=0.50800 
Train Epoch: 27 codebook_update_time=1.82143
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch27.pth ...
Done in 4.348s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch27.pth ...
Done in 8.563s
removing stale ckpt [epoch 26] [took 0.00s]
 epoch          : 27
 loss           : 0.9874434907436371
 quant_reg      : 13.81380491256714
 quant_err      : 13.81380491256714
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 6750
 MSRVTT_full_val/t2v_metrics/R1: 37.02213279678068
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.979879275653923
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 60.04248604754964
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 79.47686116700201
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.41851106639839
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.06423886385082
 MSRVTT_full_test/t2v_metrics/R1: 14.381270903010034
 MSRVTT_full_test/t2v_metrics/R5: 37.759197324414714
 MSRVTT_full_test/t2v_metrics/R10: 51.070234113712374
 MSRVTT_full_test/t2v_metrics/R50: 81.30434782608695
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.086622073578596
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.268852463501958
 MSRVTT_full_test/v2t_metrics/R1: 17.090301003344482
 MSRVTT_full_test/v2t_metrics/R5: 44.080267558528426
 MSRVTT_full_test/v2t_metrics/R10: 57.82608695652174
 MSRVTT_full_test/v2t_metrics/R50: 87.4247491638796
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.6747491638796
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.18621722858385
 mnt_best       : 30.268852463501958
 not_improved_count: 0
Train Epoch: 28 [1/250 128/32000 (0%)] Loss: 0.79307 (QuantReg: 13.77691) QuantErr: 13.77691 batch_time=34.78323 
Train Epoch: 28 [12/250 1536/32000 (5%)] Loss: 1.13287 (QuantReg: 13.78346) QuantErr: 13.78346 batch_time=0.53026 
Train Epoch: 28 [23/250 2944/32000 (9%)] Loss: 1.00075 (QuantReg: 13.61812) QuantErr: 13.61812 batch_time=0.51380 
Train Epoch: 28 [34/250 4352/32000 (14%)] Loss: 1.02536 (QuantReg: 13.98885) QuantErr: 13.98885 batch_time=0.50657 
Train Epoch: 28 [45/250 5760/32000 (18%)] Loss: 1.21527 (QuantReg: 13.80520) QuantErr: 13.80520 batch_time=0.50090 
Train Epoch: 28 [56/250 7168/32000 (22%)] Loss: 0.95939 (QuantReg: 14.03460) QuantErr: 14.03460 batch_time=0.53594 
Train Epoch: 28 [67/250 8576/32000 (27%)] Loss: 1.19813 (QuantReg: 13.83126) QuantErr: 13.83126 batch_time=2.30391 
Train Epoch: 28 [78/250 9984/32000 (31%)] Loss: 0.81599 (QuantReg: 14.02609) QuantErr: 14.02609 batch_time=0.54158 
Train Epoch: 28 [89/250 11392/32000 (36%)] Loss: 1.09091 (QuantReg: 13.75776) QuantErr: 13.75776 batch_time=0.51107 
Train Epoch: 28 [100/250 12800/32000 (40%)] Loss: 1.13410 (QuantReg: 13.81948) QuantErr: 13.81948 batch_time=0.50717 
Train Epoch: 28 [111/250 14208/32000 (44%)] Loss: 0.93312 (QuantReg: 13.85071) QuantErr: 13.85071 batch_time=0.92632 
Train Epoch: 28 [122/250 15616/32000 (49%)] Loss: 0.96989 (QuantReg: 13.96804) QuantErr: 13.96804 batch_time=0.49779 
Train Epoch: 28 [133/250 17024/32000 (53%)] Loss: 1.08967 (QuantReg: 14.01616) QuantErr: 14.01616 batch_time=0.54046 
Train Epoch: 28 [144/250 18432/32000 (58%)] Loss: 1.16813 (QuantReg: 13.59325) QuantErr: 13.59325 batch_time=0.60302 
Train Epoch: 28 [155/250 19840/32000 (62%)] Loss: 1.13408 (QuantReg: 13.75926) QuantErr: 13.75926 batch_time=0.54234 
Train Epoch: 28 [166/250 21248/32000 (66%)] Loss: 0.79420 (QuantReg: 13.68329) QuantErr: 13.68329 batch_time=0.52447 
Train Epoch: 28 [177/250 22656/32000 (71%)] Loss: 1.20275 (QuantReg: 13.82237) QuantErr: 13.82237 batch_time=0.51620 
Train Epoch: 28 [188/250 24064/32000 (75%)] Loss: 1.01081 (QuantReg: 13.63878) QuantErr: 13.63878 batch_time=0.87769 
Train Epoch: 28 [199/250 25472/32000 (80%)] Loss: 0.75239 (QuantReg: 13.95663) QuantErr: 13.95663 batch_time=0.51249 
Train Epoch: 28 [210/250 26880/32000 (84%)] Loss: 0.99217 (QuantReg: 13.94610) QuantErr: 13.94610 batch_time=0.52602 
Train Epoch: 28 [221/250 28288/32000 (88%)] Loss: 0.96254 (QuantReg: 13.84932) QuantErr: 13.84932 batch_time=0.60027 
Train Epoch: 28 [232/250 29696/32000 (93%)] Loss: 1.31670 (QuantReg: 13.67186) QuantErr: 13.67186 batch_time=0.56105 
Train Epoch: 28 [243/250 31104/32000 (97%)] Loss: 0.90211 (QuantReg: 13.96572) QuantErr: 13.96572 batch_time=0.68381 
Train Epoch: 28 codebook_update_time=1.75524
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch28.pth ...
Done in 4.044s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 0.9813718664646148
 quant_reg      : 13.857641799926757
 quant_err      : 13.857641799926757
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 72.43460764587525
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.955734406438632
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.014213034801
 MSRVTT_full_val/v2t_metrics/R1: 41.04627766599597
 MSRVTT_full_val/v2t_metrics/R5: 79.47686116700201
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.5392354124748495
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.9497536997504
 MSRVTT_full_test/t2v_metrics/R1: 13.076923076923077
 MSRVTT_full_test/t2v_metrics/R5: 37.22408026755853
 MSRVTT_full_test/t2v_metrics/R10: 49.83277591973244
 MSRVTT_full_test/t2v_metrics/R50: 80.63545150501672
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.09732441471572
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.947754116721157
 MSRVTT_full_test/v2t_metrics/R1: 16.555183946488295
 MSRVTT_full_test/v2t_metrics/R5: 44.180602006688964
 MSRVTT_full_test/v2t_metrics/R10: 58.66220735785953
 MSRVTT_full_test/v2t_metrics/R50: 87.6923076923077
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.168896321070235
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.00859488940144
 mnt_best       : 30.268852463501958
 not_improved_count: 1
Train Epoch: 29 [1/250 128/32000 (0%)] Loss: 1.07042 (QuantReg: 13.91395) QuantErr: 13.91395 batch_time=44.11363 
Train Epoch: 29 [12/250 1536/32000 (5%)] Loss: 1.05549 (QuantReg: 13.92105) QuantErr: 13.92105 batch_time=0.54581 
Train Epoch: 29 [23/250 2944/32000 (9%)] Loss: 1.19359 (QuantReg: 13.72800) QuantErr: 13.72800 batch_time=0.58421 
Train Epoch: 29 [34/250 4352/32000 (14%)] Loss: 1.02642 (QuantReg: 13.66071) QuantErr: 13.66071 batch_time=0.58407 
Train Epoch: 29 [45/250 5760/32000 (18%)] Loss: 0.98403 (QuantReg: 13.95679) QuantErr: 13.95679 batch_time=0.50434 
Train Epoch: 29 [56/250 7168/32000 (22%)] Loss: 1.04541 (QuantReg: 13.99854) QuantErr: 13.99854 batch_time=0.52760 
Train Epoch: 29 [67/250 8576/32000 (27%)] Loss: 0.90736 (QuantReg: 14.02206) QuantErr: 14.02206 batch_time=0.61365 
Train Epoch: 29 [78/250 9984/32000 (31%)] Loss: 1.09930 (QuantReg: 13.78380) QuantErr: 13.78380 batch_time=0.58017 
Train Epoch: 29 [89/250 11392/32000 (36%)] Loss: 0.80808 (QuantReg: 14.00120) QuantErr: 14.00120 batch_time=0.49913 
Train Epoch: 29 [100/250 12800/32000 (40%)] Loss: 0.79382 (QuantReg: 13.84578) QuantErr: 13.84578 batch_time=0.51584 
Train Epoch: 29 [111/250 14208/32000 (44%)] Loss: 1.25435 (QuantReg: 13.73689) QuantErr: 13.73689 batch_time=0.57705 
Train Epoch: 29 [122/250 15616/32000 (49%)] Loss: 0.84522 (QuantReg: 14.16414) QuantErr: 14.16414 batch_time=0.54800 
Train Epoch: 29 [133/250 17024/32000 (53%)] Loss: 1.18370 (QuantReg: 13.79780) QuantErr: 13.79780 batch_time=0.52451 
Train Epoch: 29 [144/250 18432/32000 (58%)] Loss: 0.98673 (QuantReg: 13.83926) QuantErr: 13.83926 batch_time=0.52178 
Train Epoch: 29 [155/250 19840/32000 (62%)] Loss: 0.92132 (QuantReg: 13.70500) QuantErr: 13.70500 batch_time=0.53728 
Train Epoch: 29 [166/250 21248/32000 (66%)] Loss: 0.87290 (QuantReg: 13.90391) QuantErr: 13.90391 batch_time=0.56434 
Train Epoch: 29 [177/250 22656/32000 (71%)] Loss: 1.08421 (QuantReg: 13.74549) QuantErr: 13.74549 batch_time=0.50677 
Train Epoch: 29 [188/250 24064/32000 (75%)] Loss: 0.94088 (QuantReg: 13.81810) QuantErr: 13.81810 batch_time=0.58919 
Train Epoch: 29 [199/250 25472/32000 (80%)] Loss: 1.05904 (QuantReg: 13.82728) QuantErr: 13.82728 batch_time=0.51297 
Train Epoch: 29 [210/250 26880/32000 (84%)] Loss: 0.74534 (QuantReg: 14.13593) QuantErr: 14.13593 batch_time=0.52637 
Train Epoch: 29 [221/250 28288/32000 (88%)] Loss: 0.87274 (QuantReg: 13.56866) QuantErr: 13.56866 batch_time=0.51859 
Train Epoch: 29 [232/250 29696/32000 (93%)] Loss: 0.99084 (QuantReg: 13.77575) QuantErr: 13.77575 batch_time=0.52663 
Train Epoch: 29 [243/250 31104/32000 (97%)] Loss: 0.77508 (QuantReg: 13.99088) QuantErr: 13.99088 batch_time=0.52781 
Train Epoch: 29 codebook_update_time=1.72519
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch29.pth ...
Done in 4.890s
removing stale ckpt [epoch 28] [took 0.00s]
 epoch          : 29
 loss           : 0.9789051995277405
 quant_reg      : 13.867966598510742
 quant_err      : 13.867966598510742
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 7250
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.985915492957746
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.479368193456054
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 79.07444668008048
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.989939637826962
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.50729294115236
 MSRVTT_full_test/t2v_metrics/R1: 13.779264214046822
 MSRVTT_full_test/t2v_metrics/R5: 37.09030100334448
 MSRVTT_full_test/t2v_metrics/R10: 50.43478260869565
 MSRVTT_full_test/t2v_metrics/R50: 80.10033444816054
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.31739130434783
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.53966140233118
 MSRVTT_full_test/v2t_metrics/R1: 16.889632107023413
 MSRVTT_full_test/v2t_metrics/R5: 44.080267558528426
 MSRVTT_full_test/v2t_metrics/R10: 58.99665551839465
 MSRVTT_full_test/v2t_metrics/R50: 87.49163879598662
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.47959866220736
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.28287245340398
 mnt_best       : 30.268852463501958
 not_improved_count: 2
Train Epoch: 30 [1/250 128/32000 (0%)] Loss: 0.86651 (QuantReg: 13.91105) QuantErr: 13.91105 batch_time=39.58422 
Train Epoch: 30 [12/250 1536/32000 (5%)] Loss: 1.02457 (QuantReg: 13.77167) QuantErr: 13.77167 batch_time=6.79424 
Train Epoch: 30 [23/250 2944/32000 (9%)] Loss: 0.97921 (QuantReg: 13.83806) QuantErr: 13.83806 batch_time=0.50677 
Train Epoch: 30 [34/250 4352/32000 (14%)] Loss: 1.02294 (QuantReg: 13.73987) QuantErr: 13.73987 batch_time=0.53158 
Train Epoch: 30 [45/250 5760/32000 (18%)] Loss: 0.87620 (QuantReg: 13.88221) QuantErr: 13.88221 batch_time=0.61747 
Train Epoch: 30 [56/250 7168/32000 (22%)] Loss: 0.97414 (QuantReg: 14.16560) QuantErr: 14.16560 batch_time=0.58593 
Train Epoch: 30 [67/250 8576/32000 (27%)] Loss: 0.96455 (QuantReg: 13.78230) QuantErr: 13.78230 batch_time=0.58229 
Train Epoch: 30 [78/250 9984/32000 (31%)] Loss: 0.73950 (QuantReg: 14.12537) QuantErr: 14.12537 batch_time=0.56641 
Train Epoch: 30 [89/250 11392/32000 (36%)] Loss: 1.11657 (QuantReg: 13.73725) QuantErr: 13.73725 batch_time=1.90669 
Train Epoch: 30 [100/250 12800/32000 (40%)] Loss: 0.93201 (QuantReg: 14.05379) QuantErr: 14.05379 batch_time=0.53255 
Train Epoch: 30 [111/250 14208/32000 (44%)] Loss: 0.88320 (QuantReg: 13.94663) QuantErr: 13.94663 batch_time=0.52736 
Train Epoch: 30 [122/250 15616/32000 (49%)] Loss: 0.87817 (QuantReg: 13.89118) QuantErr: 13.89118 batch_time=0.55690 
Train Epoch: 30 [133/250 17024/32000 (53%)] Loss: 0.96843 (QuantReg: 13.91941) QuantErr: 13.91941 batch_time=0.60773 
Train Epoch: 30 [144/250 18432/32000 (58%)] Loss: 1.04041 (QuantReg: 13.72485) QuantErr: 13.72485 batch_time=0.52561 
Train Epoch: 30 [155/250 19840/32000 (62%)] Loss: 0.93271 (QuantReg: 13.85171) QuantErr: 13.85171 batch_time=0.60170 
Train Epoch: 30 [166/250 21248/32000 (66%)] Loss: 0.95886 (QuantReg: 13.93559) QuantErr: 13.93559 batch_time=0.53481 
Train Epoch: 30 [177/250 22656/32000 (71%)] Loss: 0.88092 (QuantReg: 13.80365) QuantErr: 13.80365 batch_time=0.56582 
Train Epoch: 30 [188/250 24064/32000 (75%)] Loss: 0.72096 (QuantReg: 14.04703) QuantErr: 14.04703 batch_time=0.56954 
Train Epoch: 30 [199/250 25472/32000 (80%)] Loss: 1.28021 (QuantReg: 13.88391) QuantErr: 13.88391 batch_time=1.52673 
Train Epoch: 30 [210/250 26880/32000 (84%)] Loss: 0.90196 (QuantReg: 13.87843) QuantErr: 13.87843 batch_time=0.57159 
Train Epoch: 30 [221/250 28288/32000 (88%)] Loss: 0.93149 (QuantReg: 14.00263) QuantErr: 14.00263 batch_time=0.50139 
Train Epoch: 30 [232/250 29696/32000 (93%)] Loss: 1.12224 (QuantReg: 14.06223) QuantErr: 14.06223 batch_time=0.53155 
Train Epoch: 30 [243/250 31104/32000 (97%)] Loss: 1.18773 (QuantReg: 14.03351) QuantErr: 14.03351 batch_time=0.59424 
Train Epoch: 30 codebook_update_time=2.07916
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch30.pth ...
Done in 4.227s
removing stale ckpt [epoch 29] [took 0.00s]
 epoch          : 30
 loss           : 0.9394927916526794
 quant_reg      : 13.899050331115722
 quant_err      : 13.899050331115722
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.971830985915493
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.769431664148705
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.9114688128772634
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.39031429545449
 MSRVTT_full_test/t2v_metrics/R1: 13.7123745819398
 MSRVTT_full_test/t2v_metrics/R5: 37.391304347826086
 MSRVTT_full_test/t2v_metrics/R10: 49.93311036789298
 MSRVTT_full_test/t2v_metrics/R50: 80.03344481605352
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.904347826086955
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.472974454189213
 MSRVTT_full_test/v2t_metrics/R1: 16.287625418060202
 MSRVTT_full_test/v2t_metrics/R5: 45.01672240802676
 MSRVTT_full_test/v2t_metrics/R10: 59.364548494983275
 MSRVTT_full_test/v2t_metrics/R50: 87.05685618729098
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.670234113712375
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.176525279758586
 mnt_best       : 30.268852463501958
 not_improved_count: 3
Train Epoch: 31 [1/250 128/32000 (0%)] Loss: 1.16991 (QuantReg: 13.89701) QuantErr: 13.89701 batch_time=40.37527 
Train Epoch: 31 [12/250 1536/32000 (5%)] Loss: 0.98518 (QuantReg: 13.95624) QuantErr: 13.95624 batch_time=0.56087 
Train Epoch: 31 [23/250 2944/32000 (9%)] Loss: 1.25669 (QuantReg: 13.69633) QuantErr: 13.69633 batch_time=0.85494 
Train Epoch: 31 [34/250 4352/32000 (14%)] Loss: 0.85333 (QuantReg: 13.72812) QuantErr: 13.72812 batch_time=0.62488 
Train Epoch: 31 [45/250 5760/32000 (18%)] Loss: 1.04373 (QuantReg: 13.63966) QuantErr: 13.63966 batch_time=0.51423 
Train Epoch: 31 [56/250 7168/32000 (22%)] Loss: 1.25132 (QuantReg: 13.26193) QuantErr: 13.26193 batch_time=0.59768 
Train Epoch: 31 [67/250 8576/32000 (27%)] Loss: 0.98036 (QuantReg: 13.85845) QuantErr: 13.85845 batch_time=0.56466 
Train Epoch: 31 [78/250 9984/32000 (31%)] Loss: 0.99905 (QuantReg: 13.95454) QuantErr: 13.95454 batch_time=0.51402 
Train Epoch: 31 [89/250 11392/32000 (36%)] Loss: 1.02868 (QuantReg: 13.90244) QuantErr: 13.90244 batch_time=0.60677 
Train Epoch: 31 [100/250 12800/32000 (40%)] Loss: 0.97053 (QuantReg: 13.70809) QuantErr: 13.70809 batch_time=0.55543 
Train Epoch: 31 [111/250 14208/32000 (44%)] Loss: 0.80811 (QuantReg: 14.10362) QuantErr: 14.10362 batch_time=0.63395 
Train Epoch: 31 [122/250 15616/32000 (49%)] Loss: 0.84482 (QuantReg: 13.89767) QuantErr: 13.89767 batch_time=0.64142 
Train Epoch: 31 [133/250 17024/32000 (53%)] Loss: 0.91509 (QuantReg: 14.00838) QuantErr: 14.00838 batch_time=0.57418 
Train Epoch: 31 [144/250 18432/32000 (58%)] Loss: 1.22540 (QuantReg: 14.04554) QuantErr: 14.04554 batch_time=0.56294 
Train Epoch: 31 [155/250 19840/32000 (62%)] Loss: 1.03457 (QuantReg: 13.77929) QuantErr: 13.77929 batch_time=0.51755 
Train Epoch: 31 [166/250 21248/32000 (66%)] Loss: 0.90652 (QuantReg: 13.60778) QuantErr: 13.60778 batch_time=0.56277 
Train Epoch: 31 [177/250 22656/32000 (71%)] Loss: 1.21164 (QuantReg: 13.59020) QuantErr: 13.59020 batch_time=0.59166 
Train Epoch: 31 [188/250 24064/32000 (75%)] Loss: 0.95609 (QuantReg: 14.10877) QuantErr: 14.10877 batch_time=0.55626 
Train Epoch: 31 [199/250 25472/32000 (80%)] Loss: 0.80190 (QuantReg: 13.91887) QuantErr: 13.91887 batch_time=0.52563 
Train Epoch: 31 [210/250 26880/32000 (84%)] Loss: 1.16405 (QuantReg: 13.79633) QuantErr: 13.79633 batch_time=0.53230 
Train Epoch: 31 [221/250 28288/32000 (88%)] Loss: 0.74004 (QuantReg: 14.18743) QuantErr: 14.18743 batch_time=0.51016 
Train Epoch: 31 [232/250 29696/32000 (93%)] Loss: 0.93302 (QuantReg: 13.83313) QuantErr: 13.83313 batch_time=0.51990 
Train Epoch: 31 [243/250 31104/32000 (97%)] Loss: 1.04252 (QuantReg: 13.89988) QuantErr: 13.89988 batch_time=0.59289 
Train Epoch: 31 codebook_update_time=1.75030
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch31.pth ...
Done in 15.077s
removing stale ckpt [epoch 30] [took 0.00s]
 epoch          : 31
 loss           : 0.9669149539470673
 quant_reg      : 13.90003243637085
 quant_err      : 13.90003243637085
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 7750
 MSRVTT_full_val/t2v_metrics/R1: 35.814889336016094
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.716297786720322
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.47335718102314
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 78.67203219315896
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.55533199195171
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.41079173245247
 MSRVTT_full_test/t2v_metrics/R1: 13.7123745819398
 MSRVTT_full_test/t2v_metrics/R5: 37.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 81.43812709030101
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.50267558528428
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.749855445127352
 MSRVTT_full_test/v2t_metrics/R1: 16.989966555183948
 MSRVTT_full_test/v2t_metrics/R5: 44.94983277591973
 MSRVTT_full_test/v2t_metrics/R10: 59.46488294314381
 MSRVTT_full_test/v2t_metrics/R50: 87.52508361204013
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.45953177257525
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.67744326768584
 mnt_best       : 30.268852463501958
 not_improved_count: 4
Train Epoch: 32 [1/250 128/32000 (0%)] Loss: 0.67840 (QuantReg: 14.00036) QuantErr: 14.00036 batch_time=42.13169 
Train Epoch: 32 [12/250 1536/32000 (5%)] Loss: 0.98387 (QuantReg: 14.00612) QuantErr: 14.00612 batch_time=0.52992 
Train Epoch: 32 [23/250 2944/32000 (9%)] Loss: 0.90649 (QuantReg: 13.85816) QuantErr: 13.85816 batch_time=0.61310 
Train Epoch: 32 [34/250 4352/32000 (14%)] Loss: 0.87904 (QuantReg: 14.12804) QuantErr: 14.12804 batch_time=0.50515 
Train Epoch: 32 [45/250 5760/32000 (18%)] Loss: 0.66448 (QuantReg: 14.03539) QuantErr: 14.03539 batch_time=0.51190 
Train Epoch: 32 [56/250 7168/32000 (22%)] Loss: 0.99560 (QuantReg: 13.78060) QuantErr: 13.78060 batch_time=0.51584 
Train Epoch: 32 [67/250 8576/32000 (27%)] Loss: 0.70208 (QuantReg: 14.04351) QuantErr: 14.04351 batch_time=8.25384 
Train Epoch: 32 [78/250 9984/32000 (31%)] Loss: 0.88947 (QuantReg: 13.84296) QuantErr: 13.84296 batch_time=0.61812 
Train Epoch: 32 [89/250 11392/32000 (36%)] Loss: 1.05239 (QuantReg: 13.86846) QuantErr: 13.86846 batch_time=0.52619 
Train Epoch: 32 [100/250 12800/32000 (40%)] Loss: 0.89201 (QuantReg: 13.79814) QuantErr: 13.79814 batch_time=0.56969 
Train Epoch: 32 [111/250 14208/32000 (44%)] Loss: 1.03951 (QuantReg: 14.28982) QuantErr: 14.28982 batch_time=0.53782 
Train Epoch: 32 [122/250 15616/32000 (49%)] Loss: 0.76754 (QuantReg: 13.76398) QuantErr: 13.76398 batch_time=0.65254 
Train Epoch: 32 [133/250 17024/32000 (53%)] Loss: 0.95432 (QuantReg: 13.90555) QuantErr: 13.90555 batch_time=0.56213 
Train Epoch: 32 [144/250 18432/32000 (58%)] Loss: 0.95890 (QuantReg: 13.85574) QuantErr: 13.85574 batch_time=0.53460 
Train Epoch: 32 [155/250 19840/32000 (62%)] Loss: 0.76630 (QuantReg: 13.94617) QuantErr: 13.94617 batch_time=0.63610 
Train Epoch: 32 [166/250 21248/32000 (66%)] Loss: 0.97032 (QuantReg: 13.99619) QuantErr: 13.99619 batch_time=0.54532 
Train Epoch: 32 [177/250 22656/32000 (71%)] Loss: 0.99190 (QuantReg: 14.12690) QuantErr: 14.12690 batch_time=0.52936 
Train Epoch: 32 [188/250 24064/32000 (75%)] Loss: 1.04625 (QuantReg: 14.10771) QuantErr: 14.10771 batch_time=0.54511 
Train Epoch: 32 [199/250 25472/32000 (80%)] Loss: 0.87188 (QuantReg: 14.15218) QuantErr: 14.15218 batch_time=0.52324 
Train Epoch: 32 [210/250 26880/32000 (84%)] Loss: 1.14486 (QuantReg: 14.07150) QuantErr: 14.07150 batch_time=0.54264 
Train Epoch: 32 [221/250 28288/32000 (88%)] Loss: 0.79936 (QuantReg: 14.16454) QuantErr: 14.16454 batch_time=0.60732 
Train Epoch: 32 [232/250 29696/32000 (93%)] Loss: 0.91982 (QuantReg: 13.78688) QuantErr: 13.78688 batch_time=0.51241 
Train Epoch: 32 [243/250 31104/32000 (97%)] Loss: 0.72064 (QuantReg: 14.10829) QuantErr: 14.10829 batch_time=0.52855 
Train Epoch: 32 codebook_update_time=1.84791
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch32.pth ...
Done in 4.465s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 0.9267949576377869
 quant_reg      : 13.923397136688232
 quant_err      : 13.923397136688232
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 72.03219315895372
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.71830985915493
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.49362090798122
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.71830985915493
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.375461271954094
 MSRVTT_full_test/t2v_metrics/R1: 13.478260869565217
 MSRVTT_full_test/t2v_metrics/R5: 38.16053511705686
 MSRVTT_full_test/t2v_metrics/R10: 51.60535117056856
 MSRVTT_full_test/t2v_metrics/R50: 81.67224080267559
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.06321070234114
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.82961745658705
 MSRVTT_full_test/v2t_metrics/R1: 16.588628762541806
 MSRVTT_full_test/v2t_metrics/R5: 45.01672240802676
 MSRVTT_full_test/v2t_metrics/R10: 59.49832775919732
 MSRVTT_full_test/v2t_metrics/R50: 87.59197324414716
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.334615384615386
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.418462644102426
 mnt_best       : 30.268852463501958
 not_improved_count: 5
Train Epoch: 33 [1/250 128/32000 (0%)] Loss: 0.93437 (QuantReg: 14.19758) QuantErr: 14.19758 batch_time=41.59707 
Train Epoch: 33 [12/250 1536/32000 (5%)] Loss: 0.78786 (QuantReg: 13.77962) QuantErr: 13.77962 batch_time=0.53481 
Train Epoch: 33 [23/250 2944/32000 (9%)] Loss: 1.00399 (QuantReg: 14.13194) QuantErr: 14.13194 batch_time=0.50707 
Train Epoch: 33 [34/250 4352/32000 (14%)] Loss: 0.73784 (QuantReg: 13.43025) QuantErr: 13.43025 batch_time=0.50798 
Train Epoch: 33 [45/250 5760/32000 (18%)] Loss: 0.86544 (QuantReg: 14.02586) QuantErr: 14.02586 batch_time=0.55263 
Train Epoch: 33 [56/250 7168/32000 (22%)] Loss: 0.95957 (QuantReg: 14.02370) QuantErr: 14.02370 batch_time=0.50406 
Train Epoch: 33 [67/250 8576/32000 (27%)] Loss: 1.15395 (QuantReg: 13.84304) QuantErr: 13.84304 batch_time=0.56067 
Train Epoch: 33 [78/250 9984/32000 (31%)] Loss: 0.87537 (QuantReg: 13.61324) QuantErr: 13.61324 batch_time=2.74467 
Train Epoch: 33 [89/250 11392/32000 (36%)] Loss: 0.92430 (QuantReg: 13.64037) QuantErr: 13.64037 batch_time=0.50583 
Train Epoch: 33 [100/250 12800/32000 (40%)] Loss: 0.92302 (QuantReg: 13.76635) QuantErr: 13.76635 batch_time=0.62367 
Train Epoch: 33 [111/250 14208/32000 (44%)] Loss: 1.06380 (QuantReg: 13.84027) QuantErr: 13.84027 batch_time=0.56907 
Train Epoch: 33 [122/250 15616/32000 (49%)] Loss: 0.86091 (QuantReg: 13.94497) QuantErr: 13.94497 batch_time=0.52005 
Train Epoch: 33 [133/250 17024/32000 (53%)] Loss: 1.24769 (QuantReg: 13.70741) QuantErr: 13.70741 batch_time=0.52334 
Train Epoch: 33 [144/250 18432/32000 (58%)] Loss: 0.99475 (QuantReg: 13.95317) QuantErr: 13.95317 batch_time=0.58613 
Train Epoch: 33 [155/250 19840/32000 (62%)] Loss: 0.83646 (QuantReg: 13.62254) QuantErr: 13.62254 batch_time=0.55400 
Train Epoch: 33 [166/250 21248/32000 (66%)] Loss: 0.94985 (QuantReg: 14.15831) QuantErr: 14.15831 batch_time=0.53596 
Train Epoch: 33 [177/250 22656/32000 (71%)] Loss: 0.81888 (QuantReg: 13.97484) QuantErr: 13.97484 batch_time=0.58822 
Train Epoch: 33 [188/250 24064/32000 (75%)] Loss: 1.09206 (QuantReg: 13.96352) QuantErr: 13.96352 batch_time=0.56057 
Train Epoch: 33 [199/250 25472/32000 (80%)] Loss: 0.87876 (QuantReg: 13.77976) QuantErr: 13.77976 batch_time=0.52468 
Train Epoch: 33 [210/250 26880/32000 (84%)] Loss: 0.92445 (QuantReg: 14.16297) QuantErr: 14.16297 batch_time=0.51199 
Train Epoch: 33 [221/250 28288/32000 (88%)] Loss: 1.24740 (QuantReg: 13.77052) QuantErr: 13.77052 batch_time=0.61528 
Train Epoch: 33 [232/250 29696/32000 (93%)] Loss: 0.81101 (QuantReg: 13.92367) QuantErr: 13.92367 batch_time=0.53615 
Train Epoch: 33 [243/250 31104/32000 (97%)] Loss: 0.90035 (QuantReg: 13.96499) QuantErr: 13.96499 batch_time=0.59846 
Train Epoch: 33 codebook_update_time=1.81599
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch33.pth ...
Done in 4.580s
removing stale ckpt [epoch 32] [took 0.01s]
 epoch          : 33
 loss           : 0.9206870112419129
 quant_reg      : 13.921174270629884
 quant_err      : 13.921174270629884
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 8250
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 83.5010060362173
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.09456740442656
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.60991276911831
 MSRVTT_full_val/v2t_metrics/R1: 37.02213279678068
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.748490945674044
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.15300228038783
 MSRVTT_full_test/t2v_metrics/R1: 13.846153846153847
 MSRVTT_full_test/t2v_metrics/R5: 38.12709030100334
 MSRVTT_full_test/t2v_metrics/R10: 51.60535117056856
 MSRVTT_full_test/t2v_metrics/R50: 81.43812709030101
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.41170568561873
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.089791922965606
 MSRVTT_full_test/v2t_metrics/R1: 16.354515050167223
 MSRVTT_full_test/v2t_metrics/R5: 45.08361204013378
 MSRVTT_full_test/v2t_metrics/R10: 59.79933110367893
 MSRVTT_full_test/v2t_metrics/R50: 87.45819397993311
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 28.719397993311038
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.32787921997773
 mnt_best       : 30.268852463501958
 not_improved_count: 6
Train Epoch: 34 [1/250 128/32000 (0%)] Loss: 0.85324 (QuantReg: 14.09899) QuantErr: 14.09899 batch_time=37.28337 
Train Epoch: 34 [12/250 1536/32000 (5%)] Loss: 0.89330 (QuantReg: 14.11529) QuantErr: 14.11529 batch_time=0.52168 
Train Epoch: 34 [23/250 2944/32000 (9%)] Loss: 0.86489 (QuantReg: 14.10386) QuantErr: 14.10386 batch_time=0.54579 
Train Epoch: 34 [34/250 4352/32000 (14%)] Loss: 0.90662 (QuantReg: 13.94977) QuantErr: 13.94977 batch_time=0.57622 
Train Epoch: 34 [45/250 5760/32000 (18%)] Loss: 0.98424 (QuantReg: 14.08905) QuantErr: 14.08905 batch_time=0.56417 
Train Epoch: 34 [56/250 7168/32000 (22%)] Loss: 0.95287 (QuantReg: 13.86625) QuantErr: 13.86625 batch_time=0.50827 
Train Epoch: 34 [67/250 8576/32000 (27%)] Loss: 0.98276 (QuantReg: 13.87498) QuantErr: 13.87498 batch_time=1.36026 
Train Epoch: 34 [78/250 9984/32000 (31%)] Loss: 1.27880 (QuantReg: 13.70310) QuantErr: 13.70310 batch_time=0.51836 
Train Epoch: 34 [89/250 11392/32000 (36%)] Loss: 0.99910 (QuantReg: 13.86470) QuantErr: 13.86470 batch_time=0.49986 
Train Epoch: 34 [100/250 12800/32000 (40%)] Loss: 1.29955 (QuantReg: 13.84988) QuantErr: 13.84988 batch_time=0.53050 
Train Epoch: 34 [111/250 14208/32000 (44%)] Loss: 1.09518 (QuantReg: 13.61935) QuantErr: 13.61935 batch_time=0.57106 
Train Epoch: 34 [122/250 15616/32000 (49%)] Loss: 0.91339 (QuantReg: 13.91151) QuantErr: 13.91151 batch_time=0.53185 
Train Epoch: 34 [133/250 17024/32000 (53%)] Loss: 0.93439 (QuantReg: 13.96762) QuantErr: 13.96762 batch_time=0.57431 
Train Epoch: 34 [144/250 18432/32000 (58%)] Loss: 0.94539 (QuantReg: 13.79288) QuantErr: 13.79288 batch_time=0.53848 
Train Epoch: 34 [155/250 19840/32000 (62%)] Loss: 0.89852 (QuantReg: 14.28424) QuantErr: 14.28424 batch_time=0.56010 
Train Epoch: 34 [166/250 21248/32000 (66%)] Loss: 1.08469 (QuantReg: 13.55479) QuantErr: 13.55479 batch_time=0.54313 
Train Epoch: 34 [177/250 22656/32000 (71%)] Loss: 0.80969 (QuantReg: 13.95482) QuantErr: 13.95482 batch_time=0.59179 
Train Epoch: 34 [188/250 24064/32000 (75%)] Loss: 1.07350 (QuantReg: 13.73017) QuantErr: 13.73017 batch_time=0.50877 
Train Epoch: 34 [199/250 25472/32000 (80%)] Loss: 0.77628 (QuantReg: 13.83751) QuantErr: 13.83751 batch_time=2.90905 
Train Epoch: 34 [210/250 26880/32000 (84%)] Loss: 1.01485 (QuantReg: 13.82891) QuantErr: 13.82891 batch_time=0.61253 
Train Epoch: 34 [221/250 28288/32000 (88%)] Loss: 0.81779 (QuantReg: 14.01982) QuantErr: 14.01982 batch_time=0.51155 
Train Epoch: 34 [232/250 29696/32000 (93%)] Loss: 0.75365 (QuantReg: 14.05085) QuantErr: 14.05085 batch_time=0.54101 
Train Epoch: 34 [243/250 31104/32000 (97%)] Loss: 1.12685 (QuantReg: 14.08204) QuantErr: 14.08204 batch_time=0.54299 
Train Epoch: 34 codebook_update_time=1.74625
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch34.pth ...
Done in 4.335s
removing stale ckpt [epoch 33] [took 0.00s]
 epoch          : 34
 loss           : 0.9474633083343506
 quant_reg      : 13.91710517501831
 quant_err      : 13.91710517501831
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.066398390342052
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.519229538497314
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.810865191146881
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.26032406374446
 MSRVTT_full_test/t2v_metrics/R1: 13.244147157190636
 MSRVTT_full_test/t2v_metrics/R5: 36.15384615384615
 MSRVTT_full_test/t2v_metrics/R10: 49.49832775919732
 MSRVTT_full_test/t2v_metrics/R50: 80.16722408026756
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.47458193979933
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.724755678229318
 MSRVTT_full_test/v2t_metrics/R1: 17.224080267558527
 MSRVTT_full_test/v2t_metrics/R5: 45.25083612040134
 MSRVTT_full_test/v2t_metrics/R10: 59.03010033444816
 MSRVTT_full_test/v2t_metrics/R50: 87.65886287625418
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.566722408026756
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.83263316058138
 mnt_best       : 30.268852463501958
 not_improved_count: 7
Train Epoch: 35 [1/250 128/32000 (0%)] Loss: 0.85551 (QuantReg: 13.91171) QuantErr: 13.91171 batch_time=43.48290 
Train Epoch: 35 [12/250 1536/32000 (5%)] Loss: 0.98547 (QuantReg: 13.96151) QuantErr: 13.96151 batch_time=0.60601 
Train Epoch: 35 [23/250 2944/32000 (9%)] Loss: 1.06083 (QuantReg: 13.87059) QuantErr: 13.87059 batch_time=1.23426 
Train Epoch: 35 [34/250 4352/32000 (14%)] Loss: 1.08621 (QuantReg: 13.88041) QuantErr: 13.88041 batch_time=0.51168 
Train Epoch: 35 [45/250 5760/32000 (18%)] Loss: 0.91699 (QuantReg: 13.79931) QuantErr: 13.79931 batch_time=0.53984 
Train Epoch: 35 [56/250 7168/32000 (22%)] Loss: 0.85392 (QuantReg: 13.96558) QuantErr: 13.96558 batch_time=0.51239 
Train Epoch: 35 [67/250 8576/32000 (27%)] Loss: 0.85799 (QuantReg: 14.17839) QuantErr: 14.17839 batch_time=0.58506 
Train Epoch: 35 [78/250 9984/32000 (31%)] Loss: 1.23834 (QuantReg: 14.03962) QuantErr: 14.03962 batch_time=0.54398 
Train Epoch: 35 [89/250 11392/32000 (36%)] Loss: 0.95392 (QuantReg: 13.89907) QuantErr: 13.89907 batch_time=0.60682 
Train Epoch: 35 [100/250 12800/32000 (40%)] Loss: 1.03372 (QuantReg: 13.96644) QuantErr: 13.96644 batch_time=0.53380 
Train Epoch: 35 [111/250 14208/32000 (44%)] Loss: 0.99094 (QuantReg: 13.82641) QuantErr: 13.82641 batch_time=0.53094 
Train Epoch: 35 [122/250 15616/32000 (49%)] Loss: 0.92673 (QuantReg: 13.84674) QuantErr: 13.84674 batch_time=0.62030 
Train Epoch: 35 [133/250 17024/32000 (53%)] Loss: 1.21440 (QuantReg: 13.69845) QuantErr: 13.69845 batch_time=0.56650 
Train Epoch: 35 [144/250 18432/32000 (58%)] Loss: 0.82059 (QuantReg: 14.20428) QuantErr: 14.20428 batch_time=0.55216 
Train Epoch: 35 [155/250 19840/32000 (62%)] Loss: 0.85911 (QuantReg: 13.85701) QuantErr: 13.85701 batch_time=0.52512 
Train Epoch: 35 [166/250 21248/32000 (66%)] Loss: 1.09367 (QuantReg: 14.06078) QuantErr: 14.06078 batch_time=0.57280 
Train Epoch: 35 [177/250 22656/32000 (71%)] Loss: 0.83154 (QuantReg: 14.41811) QuantErr: 14.41811 batch_time=0.68002 
Train Epoch: 35 [188/250 24064/32000 (75%)] Loss: 0.83068 (QuantReg: 13.78130) QuantErr: 13.78130 batch_time=0.50898 
Train Epoch: 35 [199/250 25472/32000 (80%)] Loss: 0.84007 (QuantReg: 14.17486) QuantErr: 14.17486 batch_time=1.90003 
Train Epoch: 35 [210/250 26880/32000 (84%)] Loss: 0.80627 (QuantReg: 14.02364) QuantErr: 14.02364 batch_time=0.67386 
Train Epoch: 35 [221/250 28288/32000 (88%)] Loss: 0.91667 (QuantReg: 14.03654) QuantErr: 14.03654 batch_time=0.57109 
Train Epoch: 35 [232/250 29696/32000 (93%)] Loss: 0.79974 (QuantReg: 14.17032) QuantErr: 14.17032 batch_time=0.54090 
Train Epoch: 35 [243/250 31104/32000 (97%)] Loss: 0.79154 (QuantReg: 14.10484) QuantErr: 14.10484 batch_time=0.52378 
Train Epoch: 35 codebook_update_time=1.76951
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch35.pth ...
Done in 4.404s
removing stale ckpt [epoch 34] [took 0.01s]
 epoch          : 35
 loss           : 0.9058855729103088
 quant_reg      : 13.953722438812257
 quant_err      : 13.953722438812257
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 8750
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.539235412474849
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.742835108942536
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.742454728370221
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.362737145560615
 MSRVTT_full_test/t2v_metrics/R1: 14.013377926421406
 MSRVTT_full_test/t2v_metrics/R5: 36.45484949832776
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 80.23411371237458
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.73511705685619
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.587530530739762
 MSRVTT_full_test/v2t_metrics/R1: 16.52173913043478
 MSRVTT_full_test/v2t_metrics/R5: 45.31772575250836
 MSRVTT_full_test/v2t_metrics/R10: 58.66220735785953
 MSRVTT_full_test/v2t_metrics/R50: 87.02341137123746
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.259364548494982
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.28261421346969
 mnt_best       : 30.268852463501958
 not_improved_count: 8
Train Epoch: 36 [1/250 128/32000 (0%)] Loss: 0.80817 (QuantReg: 13.85544) QuantErr: 13.85544 batch_time=43.56866 
Train Epoch: 36 [12/250 1536/32000 (5%)] Loss: 1.06200 (QuantReg: 13.95342) QuantErr: 13.95342 batch_time=0.59249 
Train Epoch: 36 [23/250 2944/32000 (9%)] Loss: 0.64248 (QuantReg: 13.75704) QuantErr: 13.75704 batch_time=0.54935 
Train Epoch: 36 [34/250 4352/32000 (14%)] Loss: 0.81511 (QuantReg: 13.84421) QuantErr: 13.84421 batch_time=0.49947 
Train Epoch: 36 [45/250 5760/32000 (18%)] Loss: 0.96241 (QuantReg: 14.00586) QuantErr: 14.00586 batch_time=0.51821 
Train Epoch: 36 [56/250 7168/32000 (22%)] Loss: 0.68546 (QuantReg: 13.80250) QuantErr: 13.80250 batch_time=0.53327 
Train Epoch: 36 [67/250 8576/32000 (27%)] Loss: 0.88084 (QuantReg: 14.02975) QuantErr: 14.02975 batch_time=0.61975 
Train Epoch: 36 [78/250 9984/32000 (31%)] Loss: 1.02981 (QuantReg: 14.04713) QuantErr: 14.04713 batch_time=0.60851 
Train Epoch: 36 [89/250 11392/32000 (36%)] Loss: 1.05017 (QuantReg: 13.78326) QuantErr: 13.78326 batch_time=0.58559 
Train Epoch: 36 [100/250 12800/32000 (40%)] Loss: 0.92807 (QuantReg: 13.97610) QuantErr: 13.97610 batch_time=0.60398 
Train Epoch: 36 [111/250 14208/32000 (44%)] Loss: 1.10742 (QuantReg: 13.81950) QuantErr: 13.81950 batch_time=0.52350 
Train Epoch: 36 [122/250 15616/32000 (49%)] Loss: 1.01867 (QuantReg: 13.98569) QuantErr: 13.98569 batch_time=0.51005 
Train Epoch: 36 [133/250 17024/32000 (53%)] Loss: 0.89918 (QuantReg: 13.73543) QuantErr: 13.73543 batch_time=4.92082 
Train Epoch: 36 [144/250 18432/32000 (58%)] Loss: 0.99714 (QuantReg: 14.15746) QuantErr: 14.15746 batch_time=0.51735 
Train Epoch: 36 [155/250 19840/32000 (62%)] Loss: 0.72991 (QuantReg: 13.96916) QuantErr: 13.96916 batch_time=0.50537 
Train Epoch: 36 [166/250 21248/32000 (66%)] Loss: 1.00854 (QuantReg: 14.00009) QuantErr: 14.00009 batch_time=0.58276 
Train Epoch: 36 [177/250 22656/32000 (71%)] Loss: 1.04560 (QuantReg: 13.95367) QuantErr: 13.95367 batch_time=0.53899 
Train Epoch: 36 [188/250 24064/32000 (75%)] Loss: 0.70527 (QuantReg: 14.03365) QuantErr: 14.03365 batch_time=0.51630 
Train Epoch: 36 [199/250 25472/32000 (80%)] Loss: 0.76037 (QuantReg: 13.92104) QuantErr: 13.92104 batch_time=0.53005 
Train Epoch: 36 [210/250 26880/32000 (84%)] Loss: 0.95159 (QuantReg: 13.92374) QuantErr: 13.92374 batch_time=0.52703 
Train Epoch: 36 [221/250 28288/32000 (88%)] Loss: 1.09886 (QuantReg: 13.60699) QuantErr: 13.60699 batch_time=0.50707 
Train Epoch: 36 [232/250 29696/32000 (93%)] Loss: 0.96702 (QuantReg: 13.91865) QuantErr: 13.91865 batch_time=0.53026 
Train Epoch: 36 [243/250 31104/32000 (97%)] Loss: 0.79363 (QuantReg: 13.68718) QuantErr: 13.68718 batch_time=0.51194 
Train Epoch: 36 codebook_update_time=2.05813
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch36.pth ...
Done in 20.823s
removing stale ckpt [epoch 35] [took 0.00s]
 epoch          : 36
 loss           : 0.9089150454998016
 quant_reg      : 13.971526355743409
 quant_err      : 13.971526355743409
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 36.01609657947686
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.583501006036217
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.383013166306164
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.826961770623742
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.75546668880013
 MSRVTT_full_test/t2v_metrics/R1: 14.147157190635452
 MSRVTT_full_test/t2v_metrics/R5: 37.65886287625418
 MSRVTT_full_test/t2v_metrics/R10: 51.137123745819395
 MSRVTT_full_test/t2v_metrics/R50: 80.80267558528428
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.82675585284281
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.09014122834013
 MSRVTT_full_test/v2t_metrics/R1: 16.923076923076923
 MSRVTT_full_test/v2t_metrics/R5: 45.28428093645485
 MSRVTT_full_test/v2t_metrics/R10: 59.39799331103679
 MSRVTT_full_test/v2t_metrics/R50: 87.55852842809365
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.42675585284281
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.70531420679475
 mnt_best       : 30.268852463501958
 not_improved_count: 9
Train Epoch: 37 [1/250 128/32000 (0%)] Loss: 0.94323 (QuantReg: 13.90903) QuantErr: 13.90903 batch_time=33.74066 
Train Epoch: 37 [12/250 1536/32000 (5%)] Loss: 0.74254 (QuantReg: 13.91922) QuantErr: 13.91922 batch_time=0.53587 
Train Epoch: 37 [23/250 2944/32000 (9%)] Loss: 0.89627 (QuantReg: 13.75815) QuantErr: 13.75815 batch_time=0.51914 
Train Epoch: 37 [34/250 4352/32000 (14%)] Loss: 0.75376 (QuantReg: 13.96436) QuantErr: 13.96436 batch_time=0.56445 
Train Epoch: 37 [45/250 5760/32000 (18%)] Loss: 0.89593 (QuantReg: 13.96051) QuantErr: 13.96051 batch_time=0.53332 
Train Epoch: 37 [56/250 7168/32000 (22%)] Loss: 1.09723 (QuantReg: 13.81671) QuantErr: 13.81671 batch_time=0.53453 
Train Epoch: 37 [67/250 8576/32000 (27%)] Loss: 1.16756 (QuantReg: 13.87972) QuantErr: 13.87972 batch_time=0.53257 
Train Epoch: 37 [78/250 9984/32000 (31%)] Loss: 0.84466 (QuantReg: 13.97375) QuantErr: 13.97375 batch_time=1.69493 
Train Epoch: 37 [89/250 11392/32000 (36%)] Loss: 0.95012 (QuantReg: 14.05834) QuantErr: 14.05834 batch_time=0.61368 
Train Epoch: 37 [100/250 12800/32000 (40%)] Loss: 0.80430 (QuantReg: 13.75846) QuantErr: 13.75846 batch_time=0.64646 
Train Epoch: 37 [111/250 14208/32000 (44%)] Loss: 0.83354 (QuantReg: 13.97207) QuantErr: 13.97207 batch_time=0.53980 
Train Epoch: 37 [122/250 15616/32000 (49%)] Loss: 0.84092 (QuantReg: 14.04720) QuantErr: 14.04720 batch_time=0.53605 
Train Epoch: 37 [133/250 17024/32000 (53%)] Loss: 0.98909 (QuantReg: 13.86559) QuantErr: 13.86559 batch_time=2.12436 
Train Epoch: 37 [144/250 18432/32000 (58%)] Loss: 1.12043 (QuantReg: 13.80564) QuantErr: 13.80564 batch_time=2.66432 
Train Epoch: 37 [155/250 19840/32000 (62%)] Loss: 0.87753 (QuantReg: 13.80946) QuantErr: 13.80946 batch_time=0.55082 
Train Epoch: 37 [166/250 21248/32000 (66%)] Loss: 0.92117 (QuantReg: 13.99343) QuantErr: 13.99343 batch_time=0.51330 
Train Epoch: 37 [177/250 22656/32000 (71%)] Loss: 0.98633 (QuantReg: 14.08877) QuantErr: 14.08877 batch_time=0.56387 
Train Epoch: 37 [188/250 24064/32000 (75%)] Loss: 1.01383 (QuantReg: 13.77319) QuantErr: 13.77319 batch_time=0.62816 
Train Epoch: 37 [199/250 25472/32000 (80%)] Loss: 0.87053 (QuantReg: 14.10913) QuantErr: 14.10913 batch_time=0.58887 
Train Epoch: 37 [210/250 26880/32000 (84%)] Loss: 1.14446 (QuantReg: 13.92360) QuantErr: 13.92360 batch_time=0.64143 
Train Epoch: 37 [221/250 28288/32000 (88%)] Loss: 0.89879 (QuantReg: 14.33475) QuantErr: 14.33475 batch_time=1.24907 
Train Epoch: 37 [232/250 29696/32000 (93%)] Loss: 1.24039 (QuantReg: 13.70228) QuantErr: 13.70228 batch_time=0.52361 
Train Epoch: 37 [243/250 31104/32000 (97%)] Loss: 0.81616 (QuantReg: 14.07289) QuantErr: 14.07289 batch_time=0.57941 
Train Epoch: 37 codebook_update_time=1.83956
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch37.pth ...
Done in 4.282s
removing stale ckpt [epoch 36] [took 0.00s]
 epoch          : 37
 loss           : 0.9194127759933471
 quant_reg      : 13.954641098022462
 quant_err      : 13.954641098022462
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 9250
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.177062374245473
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.11817844350066
 MSRVTT_full_val/v2t_metrics/R1: 39.23541247484909
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.830985915492958
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.46807892644006
 MSRVTT_full_test/t2v_metrics/R1: 13.946488294314381
 MSRVTT_full_test/t2v_metrics/R5: 37.25752508361204
 MSRVTT_full_test/t2v_metrics/R10: 51.070234113712374
 MSRVTT_full_test/t2v_metrics/R50: 80.90301003344482
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.525083612040135
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.827411969347107
 MSRVTT_full_test/v2t_metrics/R1: 17.157190635451506
 MSRVTT_full_test/v2t_metrics/R5: 45.31772575250836
 MSRVTT_full_test/v2t_metrics/R10: 59.297658862876254
 MSRVTT_full_test/v2t_metrics/R50: 87.3913043478261
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.38361204013378
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.85782502353654
 mnt_best       : 30.268852463501958
 not_improved_count: 10
Train Epoch: 38 [1/250 128/32000 (0%)] Loss: 1.02762 (QuantReg: 13.89451) QuantErr: 13.89451 batch_time=34.58540 
Train Epoch: 38 [12/250 1536/32000 (5%)] Loss: 0.96250 (QuantReg: 14.04291) QuantErr: 14.04291 batch_time=0.51871 
Train Epoch: 38 [23/250 2944/32000 (9%)] Loss: 0.70696 (QuantReg: 13.91553) QuantErr: 13.91553 batch_time=0.56866 
Train Epoch: 38 [34/250 4352/32000 (14%)] Loss: 0.93647 (QuantReg: 13.94376) QuantErr: 13.94376 batch_time=0.50748 
Train Epoch: 38 [45/250 5760/32000 (18%)] Loss: 1.02427 (QuantReg: 13.89940) QuantErr: 13.89940 batch_time=0.54233 
Train Epoch: 38 [56/250 7168/32000 (22%)] Loss: 1.15510 (QuantReg: 14.06746) QuantErr: 14.06746 batch_time=0.57921 
Train Epoch: 38 [67/250 8576/32000 (27%)] Loss: 0.84905 (QuantReg: 13.78500) QuantErr: 13.78500 batch_time=0.57105 
Train Epoch: 38 [78/250 9984/32000 (31%)] Loss: 0.70293 (QuantReg: 14.25258) QuantErr: 14.25258 batch_time=0.54136 
Train Epoch: 38 [89/250 11392/32000 (36%)] Loss: 0.69487 (QuantReg: 13.97363) QuantErr: 13.97363 batch_time=0.50505 
Train Epoch: 38 [100/250 12800/32000 (40%)] Loss: 0.75857 (QuantReg: 14.26901) QuantErr: 14.26901 batch_time=0.50870 
Train Epoch: 38 [111/250 14208/32000 (44%)] Loss: 1.01849 (QuantReg: 13.85522) QuantErr: 13.85522 batch_time=0.51305 
Train Epoch: 38 [122/250 15616/32000 (49%)] Loss: 0.98515 (QuantReg: 13.86882) QuantErr: 13.86882 batch_time=0.50059 
Train Epoch: 38 [133/250 17024/32000 (53%)] Loss: 0.88042 (QuantReg: 14.01261) QuantErr: 14.01261 batch_time=2.87314 
Train Epoch: 38 [144/250 18432/32000 (58%)] Loss: 0.92911 (QuantReg: 13.91503) QuantErr: 13.91503 batch_time=1.58070 
Train Epoch: 38 [155/250 19840/32000 (62%)] Loss: 0.71382 (QuantReg: 14.18331) QuantErr: 14.18331 batch_time=0.60296 
Train Epoch: 38 [166/250 21248/32000 (66%)] Loss: 1.04274 (QuantReg: 13.89854) QuantErr: 13.89854 batch_time=0.74169 
Train Epoch: 38 [177/250 22656/32000 (71%)] Loss: 0.88115 (QuantReg: 13.95388) QuantErr: 13.95388 batch_time=0.51142 
Train Epoch: 38 [188/250 24064/32000 (75%)] Loss: 0.81383 (QuantReg: 13.93888) QuantErr: 13.93888 batch_time=0.62179 
Train Epoch: 38 [199/250 25472/32000 (80%)] Loss: 0.85552 (QuantReg: 13.91244) QuantErr: 13.91244 batch_time=0.57549 
Train Epoch: 38 [210/250 26880/32000 (84%)] Loss: 0.89476 (QuantReg: 13.93401) QuantErr: 13.93401 batch_time=0.51468 
Train Epoch: 38 [221/250 28288/32000 (88%)] Loss: 0.94843 (QuantReg: 14.13832) QuantErr: 14.13832 batch_time=0.52103 
Train Epoch: 38 [232/250 29696/32000 (93%)] Loss: 0.81615 (QuantReg: 13.85571) QuantErr: 13.85571 batch_time=0.58321 
Train Epoch: 38 [243/250 31104/32000 (97%)] Loss: 0.84951 (QuantReg: 14.05281) QuantErr: 14.05281 batch_time=0.53020 
Train Epoch: 38 codebook_update_time=1.75435
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch38.pth ...
Done in 15.305s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 0.9062006301879882
 quant_reg      : 13.96484150314331
 quant_err      : 13.96484150314331
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.515090543259557
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.60834901111755
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.092555331991952
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.93306844778112
 MSRVTT_full_test/t2v_metrics/R1: 13.74581939799331
 MSRVTT_full_test/t2v_metrics/R5: 37.625418060200666
 MSRVTT_full_test/t2v_metrics/R10: 50.13377926421405
 MSRVTT_full_test/t2v_metrics/R50: 81.03678929765886
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.727090301003344
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.597893561920472
 MSRVTT_full_test/v2t_metrics/R1: 16.68896321070234
 MSRVTT_full_test/v2t_metrics/R5: 44.88294314381271
 MSRVTT_full_test/v2t_metrics/R10: 59.76588628762542
 MSRVTT_full_test/v2t_metrics/R50: 87.55852842809365
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.64732441471572
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.50760252134586
 mnt_best       : 30.268852463501958
 not_improved_count: 11
Train Epoch: 39 [1/250 128/32000 (0%)] Loss: 1.07454 (QuantReg: 14.05591) QuantErr: 14.05591 batch_time=47.11346 
Train Epoch: 39 [12/250 1536/32000 (5%)] Loss: 1.04937 (QuantReg: 13.88533) QuantErr: 13.88533 batch_time=0.55060 
Train Epoch: 39 [23/250 2944/32000 (9%)] Loss: 0.76513 (QuantReg: 13.92049) QuantErr: 13.92049 batch_time=0.56112 
Train Epoch: 39 [34/250 4352/32000 (14%)] Loss: 1.09701 (QuantReg: 14.00464) QuantErr: 14.00464 batch_time=0.51844 
Train Epoch: 39 [45/250 5760/32000 (18%)] Loss: 0.73964 (QuantReg: 13.89207) QuantErr: 13.89207 batch_time=0.53837 
Train Epoch: 39 [56/250 7168/32000 (22%)] Loss: 0.80948 (QuantReg: 14.00075) QuantErr: 14.00075 batch_time=0.56555 
Train Epoch: 39 [67/250 8576/32000 (27%)] Loss: 0.84478 (QuantReg: 13.80678) QuantErr: 13.80678 batch_time=0.53024 
Train Epoch: 39 [78/250 9984/32000 (31%)] Loss: 0.73744 (QuantReg: 14.18038) QuantErr: 14.18038 batch_time=0.50621 
Train Epoch: 39 [89/250 11392/32000 (36%)] Loss: 0.67644 (QuantReg: 13.80344) QuantErr: 13.80344 batch_time=0.54123 
Train Epoch: 39 [100/250 12800/32000 (40%)] Loss: 0.70174 (QuantReg: 14.08343) QuantErr: 14.08343 batch_time=0.59226 
Train Epoch: 39 [111/250 14208/32000 (44%)] Loss: 0.75150 (QuantReg: 13.75638) QuantErr: 13.75638 batch_time=0.54923 
Train Epoch: 39 [122/250 15616/32000 (49%)] Loss: 0.72647 (QuantReg: 14.26390) QuantErr: 14.26390 batch_time=0.53901 
Train Epoch: 39 [133/250 17024/32000 (53%)] Loss: 0.95354 (QuantReg: 13.92548) QuantErr: 13.92548 batch_time=0.53846 
Train Epoch: 39 [144/250 18432/32000 (58%)] Loss: 1.04446 (QuantReg: 13.64487) QuantErr: 13.64487 batch_time=0.60165 
Train Epoch: 39 [155/250 19840/32000 (62%)] Loss: 0.74981 (QuantReg: 13.84178) QuantErr: 13.84178 batch_time=0.50212 
Train Epoch: 39 [166/250 21248/32000 (66%)] Loss: 0.64131 (QuantReg: 14.06621) QuantErr: 14.06621 batch_time=0.64925 
Train Epoch: 39 [177/250 22656/32000 (71%)] Loss: 0.82541 (QuantReg: 14.14596) QuantErr: 14.14596 batch_time=0.63507 
Train Epoch: 39 [188/250 24064/32000 (75%)] Loss: 0.92064 (QuantReg: 13.80755) QuantErr: 13.80755 batch_time=0.94694 
Train Epoch: 39 [199/250 25472/32000 (80%)] Loss: 0.82992 (QuantReg: 14.17441) QuantErr: 14.17441 batch_time=0.55092 
Train Epoch: 39 [210/250 26880/32000 (84%)] Loss: 0.80811 (QuantReg: 14.40499) QuantErr: 14.40499 batch_time=0.59847 
Train Epoch: 39 [221/250 28288/32000 (88%)] Loss: 0.88628 (QuantReg: 14.14087) QuantErr: 14.14087 batch_time=0.65221 
Train Epoch: 39 [232/250 29696/32000 (93%)] Loss: 0.79364 (QuantReg: 14.29380) QuantErr: 14.29380 batch_time=0.55130 
Train Epoch: 39 [243/250 31104/32000 (97%)] Loss: 0.81205 (QuantReg: 13.98857) QuantErr: 13.98857 batch_time=0.59996 
Train Epoch: 39 codebook_update_time=1.71605
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch39.pth ...
Done in 4.814s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 0.8818431646823883
 quant_reg      : 14.009421993255616
 quant_err      : 14.009421993255616
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 9750
 MSRVTT_full_val/t2v_metrics/R1: 35.2112676056338
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.3943661971831
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.6326374930165
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.766599597585513
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.60152876772425
 MSRVTT_full_test/t2v_metrics/R1: 13.91304347826087
 MSRVTT_full_test/t2v_metrics/R5: 38.72909698996656
 MSRVTT_full_test/t2v_metrics/R10: 50.5685618729097
 MSRVTT_full_test/t2v_metrics/R50: 81.20401337792642
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.79297658862876
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.09169874898965
 MSRVTT_full_test/v2t_metrics/R1: 17.82608695652174
 MSRVTT_full_test/v2t_metrics/R5: 45.4180602006689
 MSRVTT_full_test/v2t_metrics/R10: 59.93311036789298
 MSRVTT_full_test/v2t_metrics/R50: 87.62541806020067
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.013879598662207
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.47403465816469
 mnt_best       : 30.268852463501958
 not_improved_count: 12
Train Epoch: 40 [1/250 128/32000 (0%)] Loss: 0.92005 (QuantReg: 14.00242) QuantErr: 14.00242 batch_time=37.35496 
Train Epoch: 40 [12/250 1536/32000 (5%)] Loss: 0.85231 (QuantReg: 13.99993) QuantErr: 13.99993 batch_time=0.54754 
Train Epoch: 40 [23/250 2944/32000 (9%)] Loss: 0.86691 (QuantReg: 13.90848) QuantErr: 13.90848 batch_time=0.57121 
Train Epoch: 40 [34/250 4352/32000 (14%)] Loss: 0.81129 (QuantReg: 13.90006) QuantErr: 13.90006 batch_time=0.49986 
Train Epoch: 40 [45/250 5760/32000 (18%)] Loss: 1.01170 (QuantReg: 13.86079) QuantErr: 13.86079 batch_time=0.53215 
Train Epoch: 40 [56/250 7168/32000 (22%)] Loss: 1.08094 (QuantReg: 14.08945) QuantErr: 14.08945 batch_time=0.51953 
Train Epoch: 40 [67/250 8576/32000 (27%)] Loss: 0.93837 (QuantReg: 14.03356) QuantErr: 14.03356 batch_time=0.62345 
Train Epoch: 40 [78/250 9984/32000 (31%)] Loss: 0.81984 (QuantReg: 14.21348) QuantErr: 14.21348 batch_time=0.52787 
Train Epoch: 40 [89/250 11392/32000 (36%)] Loss: 1.19663 (QuantReg: 13.72882) QuantErr: 13.72882 batch_time=0.55629 
Train Epoch: 40 [100/250 12800/32000 (40%)] Loss: 0.68093 (QuantReg: 13.85337) QuantErr: 13.85337 batch_time=0.68909 
Train Epoch: 40 [111/250 14208/32000 (44%)] Loss: 0.84146 (QuantReg: 13.98078) QuantErr: 13.98078 batch_time=0.64398 
Train Epoch: 40 [122/250 15616/32000 (49%)] Loss: 0.72033 (QuantReg: 13.97806) QuantErr: 13.97806 batch_time=0.50064 
Train Epoch: 40 [133/250 17024/32000 (53%)] Loss: 0.92047 (QuantReg: 14.17887) QuantErr: 14.17887 batch_time=5.41332 
Train Epoch: 40 [144/250 18432/32000 (58%)] Loss: 0.76590 (QuantReg: 13.98970) QuantErr: 13.98970 batch_time=0.55593 
Train Epoch: 40 [155/250 19840/32000 (62%)] Loss: 0.81584 (QuantReg: 13.97034) QuantErr: 13.97034 batch_time=0.53641 
Train Epoch: 40 [166/250 21248/32000 (66%)] Loss: 1.06523 (QuantReg: 14.02404) QuantErr: 14.02404 batch_time=0.57843 
Train Epoch: 40 [177/250 22656/32000 (71%)] Loss: 0.94623 (QuantReg: 14.07983) QuantErr: 14.07983 batch_time=0.59611 
Train Epoch: 40 [188/250 24064/32000 (75%)] Loss: 1.15095 (QuantReg: 13.95702) QuantErr: 13.95702 batch_time=0.51797 
Train Epoch: 40 [199/250 25472/32000 (80%)] Loss: 0.96728 (QuantReg: 14.07002) QuantErr: 14.07002 batch_time=0.55056 
Train Epoch: 40 [210/250 26880/32000 (84%)] Loss: 0.87849 (QuantReg: 13.99001) QuantErr: 13.99001 batch_time=0.62674 
Train Epoch: 40 [221/250 28288/32000 (88%)] Loss: 0.87609 (QuantReg: 14.16050) QuantErr: 14.16050 batch_time=0.53625 
Train Epoch: 40 [232/250 29696/32000 (93%)] Loss: 1.03350 (QuantReg: 13.98143) QuantErr: 13.98143 batch_time=0.55432 
Train Epoch: 40 [243/250 31104/32000 (97%)] Loss: 0.85507 (QuantReg: 13.79755) QuantErr: 13.79755 batch_time=0.51058 
Train Epoch: 40 codebook_update_time=2.19062
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch40.pth ...
Done in 4.657s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 0.8955693323612213
 quant_reg      : 14.012401706695556
 quant_err      : 14.012401706695556
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.551307847082494
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.05349145779203
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.887323943661972
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.11108132353971
 MSRVTT_full_test/t2v_metrics/R1: 13.578595317725753
 MSRVTT_full_test/t2v_metrics/R5: 38.06020066889632
 MSRVTT_full_test/t2v_metrics/R10: 50.936454849498325
 MSRVTT_full_test/t2v_metrics/R50: 80.93645484949833
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.28829431438127
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.747573391652345
 MSRVTT_full_test/v2t_metrics/R1: 16.889632107023413
 MSRVTT_full_test/v2t_metrics/R5: 44.54849498327759
 MSRVTT_full_test/v2t_metrics/R10: 59.89966555183946
 MSRVTT_full_test/v2t_metrics/R50: 87.45819397993311
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.7505016722408
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.587095294537214
 mnt_best       : 30.268852463501958
 not_improved_count: 13
Train Epoch: 41 [1/250 128/32000 (0%)] Loss: 0.98856 (QuantReg: 13.83239) QuantErr: 13.83239 batch_time=39.73777 
Train Epoch: 41 [12/250 1536/32000 (5%)] Loss: 1.04146 (QuantReg: 13.79133) QuantErr: 13.79133 batch_time=0.58923 
Train Epoch: 41 [23/250 2944/32000 (9%)] Loss: 0.86968 (QuantReg: 14.05039) QuantErr: 14.05039 batch_time=0.55758 
Train Epoch: 41 [34/250 4352/32000 (14%)] Loss: 0.93415 (QuantReg: 14.06108) QuantErr: 14.06108 batch_time=0.52530 
Train Epoch: 41 [45/250 5760/32000 (18%)] Loss: 0.57907 (QuantReg: 14.01402) QuantErr: 14.01402 batch_time=0.51165 
Train Epoch: 41 [56/250 7168/32000 (22%)] Loss: 0.98097 (QuantReg: 13.76659) QuantErr: 13.76659 batch_time=0.51811 
Train Epoch: 41 [67/250 8576/32000 (27%)] Loss: 1.12669 (QuantReg: 13.70720) QuantErr: 13.70720 batch_time=0.49958 
Train Epoch: 41 [78/250 9984/32000 (31%)] Loss: 0.95897 (QuantReg: 14.08126) QuantErr: 14.08126 batch_time=0.51194 
Train Epoch: 41 [89/250 11392/32000 (36%)] Loss: 0.90864 (QuantReg: 14.07018) QuantErr: 14.07018 batch_time=0.71685 
Train Epoch: 41 [100/250 12800/32000 (40%)] Loss: 0.76248 (QuantReg: 14.22053) QuantErr: 14.22053 batch_time=0.58426 
Train Epoch: 41 [111/250 14208/32000 (44%)] Loss: 1.01418 (QuantReg: 14.03397) QuantErr: 14.03397 batch_time=0.54186 
Train Epoch: 41 [122/250 15616/32000 (49%)] Loss: 0.88538 (QuantReg: 14.05444) QuantErr: 14.05444 batch_time=0.52893 
Train Epoch: 41 [133/250 17024/32000 (53%)] Loss: 0.77403 (QuantReg: 14.11139) QuantErr: 14.11139 batch_time=0.53593 
Train Epoch: 41 [144/250 18432/32000 (58%)] Loss: 0.72718 (QuantReg: 14.05451) QuantErr: 14.05451 batch_time=0.49840 
Train Epoch: 41 [155/250 19840/32000 (62%)] Loss: 0.91296 (QuantReg: 14.15542) QuantErr: 14.15542 batch_time=0.55856 
Train Epoch: 41 [166/250 21248/32000 (66%)] Loss: 0.89462 (QuantReg: 14.18207) QuantErr: 14.18207 batch_time=0.55045 
Train Epoch: 41 [177/250 22656/32000 (71%)] Loss: 0.99632 (QuantReg: 14.07610) QuantErr: 14.07610 batch_time=0.55095 
Train Epoch: 41 [188/250 24064/32000 (75%)] Loss: 1.01810 (QuantReg: 13.88432) QuantErr: 13.88432 batch_time=0.52317 
Train Epoch: 41 [199/250 25472/32000 (80%)] Loss: 0.86844 (QuantReg: 13.91572) QuantErr: 13.91572 batch_time=0.50691 
Train Epoch: 41 [210/250 26880/32000 (84%)] Loss: 0.80489 (QuantReg: 14.16221) QuantErr: 14.16221 batch_time=2.08451 
Train Epoch: 41 [221/250 28288/32000 (88%)] Loss: 0.94106 (QuantReg: 14.15835) QuantErr: 14.15835 batch_time=0.52141 
Train Epoch: 41 [232/250 29696/32000 (93%)] Loss: 0.88284 (QuantReg: 14.16927) QuantErr: 14.16927 batch_time=0.52166 
Train Epoch: 41 [243/250 31104/32000 (97%)] Loss: 0.99208 (QuantReg: 14.04161) QuantErr: 14.04161 batch_time=0.57255 
Train Epoch: 41 codebook_update_time=1.82274
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch41.pth ...
Done in 22.353s
removing stale ckpt [epoch 40] [took 0.00s]
 epoch          : 41
 loss           : 0.8989890241622924
 quant_reg      : 14.059222576141357
 quant_err      : 14.059222576141357
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 10250
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 70.82494969818913
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.527162977867203
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.51714407544023
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.915492957746479
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.49313673733229
 MSRVTT_full_test/t2v_metrics/R1: 14.214046822742475
 MSRVTT_full_test/t2v_metrics/R5: 37.65886287625418
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 81.1371237458194
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.302675585284284
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.051834304905178
 MSRVTT_full_test/v2t_metrics/R1: 17.090301003344482
 MSRVTT_full_test/v2t_metrics/R5: 44.5819397993311
 MSRVTT_full_test/v2t_metrics/R10: 59.63210702341137
 MSRVTT_full_test/v2t_metrics/R50: 87.72575250836121
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.04314381270903
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.683130033507624
 mnt_best       : 30.268852463501958
 not_improved_count: 14
Train Epoch: 42 [1/250 128/32000 (0%)] Loss: 0.85777 (QuantReg: 13.86484) QuantErr: 13.86484 batch_time=47.91146 
Train Epoch: 42 [12/250 1536/32000 (5%)] Loss: 0.93238 (QuantReg: 13.90417) QuantErr: 13.90417 batch_time=0.50207 
Train Epoch: 42 [23/250 2944/32000 (9%)] Loss: 0.87434 (QuantReg: 13.96291) QuantErr: 13.96291 batch_time=0.52601 
Train Epoch: 42 [34/250 4352/32000 (14%)] Loss: 0.83987 (QuantReg: 14.09402) QuantErr: 14.09402 batch_time=0.53011 
Train Epoch: 42 [45/250 5760/32000 (18%)] Loss: 0.99045 (QuantReg: 14.10625) QuantErr: 14.10625 batch_time=0.61378 
Train Epoch: 42 [56/250 7168/32000 (22%)] Loss: 0.85969 (QuantReg: 14.16026) QuantErr: 14.16026 batch_time=0.65312 
Train Epoch: 42 [67/250 8576/32000 (27%)] Loss: 0.78633 (QuantReg: 14.14048) QuantErr: 14.14048 batch_time=0.67398 
Train Epoch: 42 [78/250 9984/32000 (31%)] Loss: 1.00113 (QuantReg: 13.84615) QuantErr: 13.84615 batch_time=0.60010 
Train Epoch: 42 [89/250 11392/32000 (36%)] Loss: 0.97589 (QuantReg: 14.00256) QuantErr: 14.00256 batch_time=0.99698 
Train Epoch: 42 [100/250 12800/32000 (40%)] Loss: 0.83934 (QuantReg: 14.26786) QuantErr: 14.26786 batch_time=0.52609 
Train Epoch: 42 [111/250 14208/32000 (44%)] Loss: 1.07465 (QuantReg: 14.08836) QuantErr: 14.08836 batch_time=0.50184 
Train Epoch: 42 [122/250 15616/32000 (49%)] Loss: 1.02204 (QuantReg: 14.29001) QuantErr: 14.29001 batch_time=0.51548 
Train Epoch: 42 [133/250 17024/32000 (53%)] Loss: 0.82190 (QuantReg: 14.09716) QuantErr: 14.09716 batch_time=0.51844 
Train Epoch: 42 [144/250 18432/32000 (58%)] Loss: 0.82776 (QuantReg: 13.95529) QuantErr: 13.95529 batch_time=0.50399 
Train Epoch: 42 [155/250 19840/32000 (62%)] Loss: 1.12311 (QuantReg: 13.97553) QuantErr: 13.97553 batch_time=0.52508 
Train Epoch: 42 [166/250 21248/32000 (66%)] Loss: 0.86522 (QuantReg: 14.10166) QuantErr: 14.10166 batch_time=0.55502 
Train Epoch: 42 [177/250 22656/32000 (71%)] Loss: 1.15824 (QuantReg: 14.08462) QuantErr: 14.08462 batch_time=0.52686 
Train Epoch: 42 [188/250 24064/32000 (75%)] Loss: 0.79161 (QuantReg: 14.05267) QuantErr: 14.05267 batch_time=0.51990 
Train Epoch: 42 [199/250 25472/32000 (80%)] Loss: 0.87293 (QuantReg: 14.27604) QuantErr: 14.27604 batch_time=0.52094 
Train Epoch: 42 [210/250 26880/32000 (84%)] Loss: 0.96811 (QuantReg: 14.04335) QuantErr: 14.04335 batch_time=0.50807 
Train Epoch: 42 [221/250 28288/32000 (88%)] Loss: 0.71476 (QuantReg: 14.09716) QuantErr: 14.09716 batch_time=0.54840 
Train Epoch: 42 [232/250 29696/32000 (93%)] Loss: 1.01810 (QuantReg: 14.03364) QuantErr: 14.03364 batch_time=0.55803 
Train Epoch: 42 [243/250 31104/32000 (97%)] Loss: 0.74264 (QuantReg: 14.10206) QuantErr: 14.10206 batch_time=0.52579 
Train Epoch: 42 codebook_update_time=1.76010
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch42.pth ...
Done in 6.076s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch42.pth ...
Done in 10.491s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 0.8980247275829315
 quant_reg      : 14.053722816467285
 quant_err      : 14.053722816467285
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 34.40643863179074
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.71830985915493
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.95996786772826
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 79.07444668008048
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.2354124748490944
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.38551097244898
 MSRVTT_full_test/t2v_metrics/R1: 15.150501672240802
 MSRVTT_full_test/t2v_metrics/R5: 38.52842809364549
 MSRVTT_full_test/t2v_metrics/R10: 51.00334448160535
 MSRVTT_full_test/t2v_metrics/R50: 81.33779264214047
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.22374581939799
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.993383251313407
 MSRVTT_full_test/v2t_metrics/R1: 18.26086956521739
 MSRVTT_full_test/v2t_metrics/R5: 44.88294314381271
 MSRVTT_full_test/v2t_metrics/R10: 59.063545150501675
 MSRVTT_full_test/v2t_metrics/R50: 87.1571906354515
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.96086956521739
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.44523578470286
 mnt_best       : 30.993383251313407
 not_improved_count: 0
Train Epoch: 43 [1/250 128/32000 (0%)] Loss: 0.98178 (QuantReg: 14.15147) QuantErr: 14.15147 batch_time=40.13648 
Train Epoch: 43 [12/250 1536/32000 (5%)] Loss: 0.98601 (QuantReg: 14.08465) QuantErr: 14.08465 batch_time=0.57711 
Train Epoch: 43 [23/250 2944/32000 (9%)] Loss: 0.85031 (QuantReg: 13.99395) QuantErr: 13.99395 batch_time=0.52974 
Train Epoch: 43 [34/250 4352/32000 (14%)] Loss: 0.75700 (QuantReg: 14.12539) QuantErr: 14.12539 batch_time=0.53477 
Train Epoch: 43 [45/250 5760/32000 (18%)] Loss: 0.85946 (QuantReg: 14.07874) QuantErr: 14.07874 batch_time=0.52456 
Train Epoch: 43 [56/250 7168/32000 (22%)] Loss: 0.89575 (QuantReg: 14.23547) QuantErr: 14.23547 batch_time=0.58171 
Train Epoch: 43 [67/250 8576/32000 (27%)] Loss: 0.73426 (QuantReg: 13.93504) QuantErr: 13.93504 batch_time=0.80367 
Train Epoch: 43 [78/250 9984/32000 (31%)] Loss: 0.85862 (QuantReg: 14.02827) QuantErr: 14.02827 batch_time=0.51936 
Train Epoch: 43 [89/250 11392/32000 (36%)] Loss: 0.92312 (QuantReg: 14.06056) QuantErr: 14.06056 batch_time=0.51408 
Train Epoch: 43 [100/250 12800/32000 (40%)] Loss: 0.93131 (QuantReg: 13.98663) QuantErr: 13.98663 batch_time=0.55078 
Train Epoch: 43 [111/250 14208/32000 (44%)] Loss: 1.14236 (QuantReg: 14.07203) QuantErr: 14.07203 batch_time=0.53301 
Train Epoch: 43 [122/250 15616/32000 (49%)] Loss: 1.22461 (QuantReg: 13.89174) QuantErr: 13.89174 batch_time=0.51082 
Train Epoch: 43 [133/250 17024/32000 (53%)] Loss: 0.99647 (QuantReg: 14.23755) QuantErr: 14.23755 batch_time=1.35341 
Train Epoch: 43 [144/250 18432/32000 (58%)] Loss: 0.67899 (QuantReg: 14.12822) QuantErr: 14.12822 batch_time=0.60605 
Train Epoch: 43 [155/250 19840/32000 (62%)] Loss: 1.06562 (QuantReg: 14.08892) QuantErr: 14.08892 batch_time=0.55243 
Train Epoch: 43 [166/250 21248/32000 (66%)] Loss: 0.93193 (QuantReg: 14.10678) QuantErr: 14.10678 batch_time=0.50326 
Train Epoch: 43 [177/250 22656/32000 (71%)] Loss: 0.82564 (QuantReg: 14.04435) QuantErr: 14.04435 batch_time=0.98643 
Train Epoch: 43 [188/250 24064/32000 (75%)] Loss: 0.89467 (QuantReg: 14.18007) QuantErr: 14.18007 batch_time=0.57826 
Train Epoch: 43 [199/250 25472/32000 (80%)] Loss: 0.69503 (QuantReg: 14.23144) QuantErr: 14.23144 batch_time=0.53881 
Train Epoch: 43 [210/250 26880/32000 (84%)] Loss: 0.90848 (QuantReg: 14.25830) QuantErr: 14.25830 batch_time=0.50782 
Train Epoch: 43 [221/250 28288/32000 (88%)] Loss: 0.97975 (QuantReg: 14.13069) QuantErr: 14.13069 batch_time=0.51901 
Train Epoch: 43 [232/250 29696/32000 (93%)] Loss: 0.81225 (QuantReg: 14.05649) QuantErr: 14.05649 batch_time=0.62013 
Train Epoch: 43 [243/250 31104/32000 (97%)] Loss: 1.01524 (QuantReg: 14.07800) QuantErr: 14.07800 batch_time=0.55396 
Train Epoch: 43 codebook_update_time=2.10660
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch43.pth ...
Done in 4.314s
removing stale ckpt [epoch 42] [took 0.00s]
 epoch          : 43
 loss           : 0.887129406452179
 quant_reg      : 14.064725734710693
 quant_err      : 14.064725734710693
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 10750
 MSRVTT_full_val/t2v_metrics/R1: 35.814889336016094
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.480885311871226
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.01439617957666
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.921529175050302
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.40460475709546
 MSRVTT_full_test/t2v_metrics/R1: 13.946488294314381
 MSRVTT_full_test/t2v_metrics/R5: 38.862876254180605
 MSRVTT_full_test/t2v_metrics/R10: 50.33444816053512
 MSRVTT_full_test/t2v_metrics/R50: 81.10367892976589
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.66020066889632
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.10382675529298
 MSRVTT_full_test/v2t_metrics/R1: 17.32441471571906
 MSRVTT_full_test/v2t_metrics/R5: 45.4180602006689
 MSRVTT_full_test/v2t_metrics/R10: 59.197324414715716
 MSRVTT_full_test/v2t_metrics/R50: 87.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.286956521739132
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.98015890228995
 mnt_best       : 30.993383251313407
 not_improved_count: 1
Train Epoch: 44 [1/250 128/32000 (0%)] Loss: 0.68401 (QuantReg: 14.17509) QuantErr: 14.17509 batch_time=38.40931 
Train Epoch: 44 [12/250 1536/32000 (5%)] Loss: 0.70574 (QuantReg: 14.02068) QuantErr: 14.02068 batch_time=0.51392 
Train Epoch: 44 [23/250 2944/32000 (9%)] Loss: 0.74916 (QuantReg: 14.02821) QuantErr: 14.02821 batch_time=0.60153 
Train Epoch: 44 [34/250 4352/32000 (14%)] Loss: 0.84020 (QuantReg: 13.99557) QuantErr: 13.99557 batch_time=0.53466 
Train Epoch: 44 [45/250 5760/32000 (18%)] Loss: 1.05781 (QuantReg: 14.04160) QuantErr: 14.04160 batch_time=0.52934 
Train Epoch: 44 [56/250 7168/32000 (22%)] Loss: 0.72670 (QuantReg: 13.71199) QuantErr: 13.71199 batch_time=0.64015 
Train Epoch: 44 [67/250 8576/32000 (27%)] Loss: 0.83372 (QuantReg: 14.24927) QuantErr: 14.24927 batch_time=0.76013 
Train Epoch: 44 [78/250 9984/32000 (31%)] Loss: 1.19666 (QuantReg: 14.22119) QuantErr: 14.22119 batch_time=0.50846 
Train Epoch: 44 [89/250 11392/32000 (36%)] Loss: 0.80568 (QuantReg: 14.17681) QuantErr: 14.17681 batch_time=0.51887 
Train Epoch: 44 [100/250 12800/32000 (40%)] Loss: 0.87490 (QuantReg: 13.98618) QuantErr: 13.98618 batch_time=0.57553 
Train Epoch: 44 [111/250 14208/32000 (44%)] Loss: 0.97363 (QuantReg: 14.41790) QuantErr: 14.41790 batch_time=0.51447 
Train Epoch: 44 [122/250 15616/32000 (49%)] Loss: 1.00473 (QuantReg: 14.03255) QuantErr: 14.03255 batch_time=0.50485 
Train Epoch: 44 [133/250 17024/32000 (53%)] Loss: 0.81629 (QuantReg: 14.08030) QuantErr: 14.08030 batch_time=0.54295 
Train Epoch: 44 [144/250 18432/32000 (58%)] Loss: 0.92526 (QuantReg: 13.94626) QuantErr: 13.94626 batch_time=0.51083 
Train Epoch: 44 [155/250 19840/32000 (62%)] Loss: 0.98651 (QuantReg: 14.15459) QuantErr: 14.15459 batch_time=0.49854 
Train Epoch: 44 [166/250 21248/32000 (66%)] Loss: 0.80321 (QuantReg: 14.19581) QuantErr: 14.19581 batch_time=0.63392 
Train Epoch: 44 [177/250 22656/32000 (71%)] Loss: 0.82751 (QuantReg: 13.83481) QuantErr: 13.83481 batch_time=0.79297 
Train Epoch: 44 [188/250 24064/32000 (75%)] Loss: 0.85429 (QuantReg: 13.75111) QuantErr: 13.75111 batch_time=0.59956 
Train Epoch: 44 [199/250 25472/32000 (80%)] Loss: 0.91039 (QuantReg: 13.96729) QuantErr: 13.96729 batch_time=0.53525 
Train Epoch: 44 [210/250 26880/32000 (84%)] Loss: 0.91005 (QuantReg: 14.19447) QuantErr: 14.19447 batch_time=0.52154 
Train Epoch: 44 [221/250 28288/32000 (88%)] Loss: 0.89158 (QuantReg: 14.14671) QuantErr: 14.14671 batch_time=0.54175 
Train Epoch: 44 [232/250 29696/32000 (93%)] Loss: 0.62581 (QuantReg: 13.91186) QuantErr: 13.91186 batch_time=0.60419 
Train Epoch: 44 [243/250 31104/32000 (97%)] Loss: 0.83251 (QuantReg: 14.23500) QuantErr: 14.23500 batch_time=0.50008 
Train Epoch: 44 codebook_update_time=1.84248
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch44.pth ...
Done in 4.356s
removing stale ckpt [epoch 43] [took 0.00s]
 epoch          : 44
 loss           : 0.8833390500545502
 quant_reg      : 14.067059837341308
 quant_err      : 14.067059837341308
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.368209255533198
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.02477635294718
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.00804828973843
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.29107522917155
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 39.23076923076923
 MSRVTT_full_test/t2v_metrics/R10: 50.802675585284284
 MSRVTT_full_test/t2v_metrics/R50: 80.90301003344482
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.60903010033445
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.388418980667403
 MSRVTT_full_test/v2t_metrics/R1: 17.926421404682273
 MSRVTT_full_test/v2t_metrics/R5: 45.48494983277592
 MSRVTT_full_test/v2t_metrics/R10: 59.297658862876254
 MSRVTT_full_test/v2t_metrics/R50: 86.8561872909699
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.732441471571907
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.43059711231143
 mnt_best       : 30.993383251313407
 not_improved_count: 2
Train Epoch: 45 [1/250 128/32000 (0%)] Loss: 0.93847 (QuantReg: 13.94024) QuantErr: 13.94024 batch_time=38.36184 
Train Epoch: 45 [12/250 1536/32000 (5%)] Loss: 0.78408 (QuantReg: 14.10853) QuantErr: 14.10853 batch_time=0.53917 
Train Epoch: 45 [23/250 2944/32000 (9%)] Loss: 0.94294 (QuantReg: 14.05422) QuantErr: 14.05422 batch_time=0.59682 
Train Epoch: 45 [34/250 4352/32000 (14%)] Loss: 0.64478 (QuantReg: 14.22507) QuantErr: 14.22507 batch_time=1.12177 
Train Epoch: 45 [45/250 5760/32000 (18%)] Loss: 0.88450 (QuantReg: 14.00922) QuantErr: 14.00922 batch_time=0.49972 
Train Epoch: 45 [56/250 7168/32000 (22%)] Loss: 0.60177 (QuantReg: 14.02862) QuantErr: 14.02862 batch_time=0.58120 
Train Epoch: 45 [67/250 8576/32000 (27%)] Loss: 0.98453 (QuantReg: 13.91127) QuantErr: 13.91127 batch_time=0.60023 
Train Epoch: 45 [78/250 9984/32000 (31%)] Loss: 1.19521 (QuantReg: 13.95219) QuantErr: 13.95219 batch_time=0.85910 
Train Epoch: 45 [89/250 11392/32000 (36%)] Loss: 0.87789 (QuantReg: 14.15024) QuantErr: 14.15024 batch_time=0.49881 
Train Epoch: 45 [100/250 12800/32000 (40%)] Loss: 0.71559 (QuantReg: 13.89679) QuantErr: 13.89679 batch_time=0.51605 
Train Epoch: 45 [111/250 14208/32000 (44%)] Loss: 1.05647 (QuantReg: 14.16777) QuantErr: 14.16777 batch_time=0.56125 
Train Epoch: 45 [122/250 15616/32000 (49%)] Loss: 0.86808 (QuantReg: 14.10773) QuantErr: 14.10773 batch_time=0.53778 
Train Epoch: 45 [133/250 17024/32000 (53%)] Loss: 0.86640 (QuantReg: 14.17507) QuantErr: 14.17507 batch_time=0.51969 
Train Epoch: 45 [144/250 18432/32000 (58%)] Loss: 0.86324 (QuantReg: 14.24052) QuantErr: 14.24052 batch_time=0.55099 
Train Epoch: 45 [155/250 19840/32000 (62%)] Loss: 0.92300 (QuantReg: 14.16050) QuantErr: 14.16050 batch_time=0.53161 
Train Epoch: 45 [166/250 21248/32000 (66%)] Loss: 0.76918 (QuantReg: 13.97422) QuantErr: 13.97422 batch_time=1.27122 
Train Epoch: 45 [177/250 22656/32000 (71%)] Loss: 0.84658 (QuantReg: 14.08804) QuantErr: 14.08804 batch_time=0.50198 
Train Epoch: 45 [188/250 24064/32000 (75%)] Loss: 0.86995 (QuantReg: 14.36987) QuantErr: 14.36987 batch_time=0.63830 
Train Epoch: 45 [199/250 25472/32000 (80%)] Loss: 0.63834 (QuantReg: 14.36603) QuantErr: 14.36603 batch_time=0.52485 
Train Epoch: 45 [210/250 26880/32000 (84%)] Loss: 0.93115 (QuantReg: 14.01485) QuantErr: 14.01485 batch_time=0.52242 
Train Epoch: 45 [221/250 28288/32000 (88%)] Loss: 0.93884 (QuantReg: 13.95821) QuantErr: 13.95821 batch_time=0.51775 
Train Epoch: 45 [232/250 29696/32000 (93%)] Loss: 0.62269 (QuantReg: 14.10578) QuantErr: 14.10578 batch_time=0.56740 
Train Epoch: 45 [243/250 31104/32000 (97%)] Loss: 0.90048 (QuantReg: 13.99289) QuantErr: 13.99289 batch_time=0.58063 
Train Epoch: 45 codebook_update_time=1.88790
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch45.pth ...
Done in 5.509s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 0.872698166847229
 quant_reg      : 14.10313285446167
 quant_err      : 14.10313285446167
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 11250
 MSRVTT_full_val/t2v_metrics/R1: 36.01609657947686
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.259557344064387
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.80149075189096
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.193158953722334
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.612574185405414
 MSRVTT_full_test/t2v_metrics/R1: 14.414715719063546
 MSRVTT_full_test/t2v_metrics/R5: 38.82943143812709
 MSRVTT_full_test/t2v_metrics/R10: 51.03678929765886
 MSRVTT_full_test/t2v_metrics/R50: 80.8695652173913
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.60484949832776
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.569158671658457
 MSRVTT_full_test/v2t_metrics/R1: 16.923076923076923
 MSRVTT_full_test/v2t_metrics/R5: 45.38461538461539
 MSRVTT_full_test/v2t_metrics/R10: 59.56521739130435
 MSRVTT_full_test/v2t_metrics/R50: 87.52508361204013
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.853177257525083
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.765165551096494
 mnt_best       : 30.993383251313407
 not_improved_count: 3
Train Epoch: 46 [1/250 128/32000 (0%)] Loss: 0.85829 (QuantReg: 13.77627) QuantErr: 13.77627 batch_time=47.25501 
Train Epoch: 46 [12/250 1536/32000 (5%)] Loss: 0.83250 (QuantReg: 14.07655) QuantErr: 14.07655 batch_time=0.52211 
Train Epoch: 46 [23/250 2944/32000 (9%)] Loss: 0.67705 (QuantReg: 14.08477) QuantErr: 14.08477 batch_time=0.58306 
Train Epoch: 46 [34/250 4352/32000 (14%)] Loss: 0.69815 (QuantReg: 14.10427) QuantErr: 14.10427 batch_time=0.54091 
Train Epoch: 46 [45/250 5760/32000 (18%)] Loss: 1.04077 (QuantReg: 13.98718) QuantErr: 13.98718 batch_time=0.61547 
Train Epoch: 46 [56/250 7168/32000 (22%)] Loss: 0.75021 (QuantReg: 14.00102) QuantErr: 14.00102 batch_time=0.67968 
Train Epoch: 46 [67/250 8576/32000 (27%)] Loss: 0.95656 (QuantReg: 14.26749) QuantErr: 14.26749 batch_time=0.60456 
Train Epoch: 46 [78/250 9984/32000 (31%)] Loss: 0.98444 (QuantReg: 14.22960) QuantErr: 14.22960 batch_time=1.30608 
Train Epoch: 46 [89/250 11392/32000 (36%)] Loss: 0.98746 (QuantReg: 14.11925) QuantErr: 14.11925 batch_time=0.58983 
Train Epoch: 46 [100/250 12800/32000 (40%)] Loss: 0.93549 (QuantReg: 14.01973) QuantErr: 14.01973 batch_time=0.56306 
Train Epoch: 46 [111/250 14208/32000 (44%)] Loss: 0.70191 (QuantReg: 13.86480) QuantErr: 13.86480 batch_time=0.54094 
Train Epoch: 46 [122/250 15616/32000 (49%)] Loss: 0.88372 (QuantReg: 14.14523) QuantErr: 14.14523 batch_time=0.53238 
Train Epoch: 46 [133/250 17024/32000 (53%)] Loss: 1.05920 (QuantReg: 14.01375) QuantErr: 14.01375 batch_time=0.50917 
Train Epoch: 46 [144/250 18432/32000 (58%)] Loss: 0.90920 (QuantReg: 13.87978) QuantErr: 13.87978 batch_time=0.53285 
Train Epoch: 46 [155/250 19840/32000 (62%)] Loss: 0.78961 (QuantReg: 14.20268) QuantErr: 14.20268 batch_time=0.54224 
Train Epoch: 46 [166/250 21248/32000 (66%)] Loss: 0.69353 (QuantReg: 14.24557) QuantErr: 14.24557 batch_time=0.64933 
Train Epoch: 46 [177/250 22656/32000 (71%)] Loss: 0.94336 (QuantReg: 14.21976) QuantErr: 14.21976 batch_time=0.51711 
Train Epoch: 46 [188/250 24064/32000 (75%)] Loss: 0.83106 (QuantReg: 14.17931) QuantErr: 14.17931 batch_time=0.52716 
Train Epoch: 46 [199/250 25472/32000 (80%)] Loss: 0.81448 (QuantReg: 14.13608) QuantErr: 14.13608 batch_time=0.56462 
Train Epoch: 46 [210/250 26880/32000 (84%)] Loss: 0.72992 (QuantReg: 14.41060) QuantErr: 14.41060 batch_time=0.50138 
Train Epoch: 46 [221/250 28288/32000 (88%)] Loss: 0.70625 (QuantReg: 13.98730) QuantErr: 13.98730 batch_time=0.50457 
Train Epoch: 46 [232/250 29696/32000 (93%)] Loss: 0.80013 (QuantReg: 14.26660) QuantErr: 14.26660 batch_time=0.64651 
Train Epoch: 46 [243/250 31104/32000 (97%)] Loss: 0.71940 (QuantReg: 14.18368) QuantErr: 14.18368 batch_time=0.64383 
Train Epoch: 46 codebook_update_time=1.81494
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch46.pth ...
Done in 4.192s
removing stale ckpt [epoch 45] [took 0.00s]
 epoch          : 46
 loss           : 0.8764626131057739
 quant_reg      : 14.094462745666505
 quant_err      : 14.094462745666505
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 36.01609657947686
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.505030181086518
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.815263173103524
 MSRVTT_full_val/v2t_metrics/R1: 41.64989939637827
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.7847082494969815
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.1275693737642
 MSRVTT_full_test/t2v_metrics/R1: 14.548494983277592
 MSRVTT_full_test/t2v_metrics/R5: 37.792642140468224
 MSRVTT_full_test/t2v_metrics/R10: 50.635451505016725
 MSRVTT_full_test/t2v_metrics/R50: 80.93645484949833
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.922909698996655
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.308190167083442
 MSRVTT_full_test/v2t_metrics/R1: 17.357859531772576
 MSRVTT_full_test/v2t_metrics/R5: 45.785953177257525
 MSRVTT_full_test/v2t_metrics/R10: 59.23076923076923
 MSRVTT_full_test/v2t_metrics/R50: 87.32441471571906
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.787625418060202
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.1070439057912
 mnt_best       : 30.993383251313407
 not_improved_count: 4
Train Epoch: 47 [1/250 128/32000 (0%)] Loss: 0.78976 (QuantReg: 14.25753) QuantErr: 14.25753 batch_time=37.53082 
Train Epoch: 47 [12/250 1536/32000 (5%)] Loss: 0.97311 (QuantReg: 13.99231) QuantErr: 13.99231 batch_time=3.15788 
Train Epoch: 47 [23/250 2944/32000 (9%)] Loss: 0.83732 (QuantReg: 13.91626) QuantErr: 13.91626 batch_time=0.57530 
Train Epoch: 47 [34/250 4352/32000 (14%)] Loss: 0.81850 (QuantReg: 14.10800) QuantErr: 14.10800 batch_time=0.56087 
Train Epoch: 47 [45/250 5760/32000 (18%)] Loss: 0.91417 (QuantReg: 14.29555) QuantErr: 14.29555 batch_time=0.55519 
Train Epoch: 47 [56/250 7168/32000 (22%)] Loss: 0.82087 (QuantReg: 13.97202) QuantErr: 13.97202 batch_time=0.52900 
Train Epoch: 47 [67/250 8576/32000 (27%)] Loss: 1.16173 (QuantReg: 14.01344) QuantErr: 14.01344 batch_time=2.59475 
Train Epoch: 47 [78/250 9984/32000 (31%)] Loss: 0.76183 (QuantReg: 13.92277) QuantErr: 13.92277 batch_time=0.58024 
Train Epoch: 47 [89/250 11392/32000 (36%)] Loss: 0.86707 (QuantReg: 14.23937) QuantErr: 14.23937 batch_time=0.54913 
Train Epoch: 47 [100/250 12800/32000 (40%)] Loss: 0.75011 (QuantReg: 14.08949) QuantErr: 14.08949 batch_time=0.56415 
Train Epoch: 47 [111/250 14208/32000 (44%)] Loss: 1.10422 (QuantReg: 13.91470) QuantErr: 13.91470 batch_time=1.01602 
Train Epoch: 47 [122/250 15616/32000 (49%)] Loss: 0.68542 (QuantReg: 14.17355) QuantErr: 14.17355 batch_time=0.55882 
Train Epoch: 47 [133/250 17024/32000 (53%)] Loss: 0.91750 (QuantReg: 14.33833) QuantErr: 14.33833 batch_time=0.51508 
Train Epoch: 47 [144/250 18432/32000 (58%)] Loss: 0.84449 (QuantReg: 14.05628) QuantErr: 14.05628 batch_time=0.56610 
Train Epoch: 47 [155/250 19840/32000 (62%)] Loss: 0.98257 (QuantReg: 14.01901) QuantErr: 14.01901 batch_time=0.63597 
Train Epoch: 47 [166/250 21248/32000 (66%)] Loss: 0.88602 (QuantReg: 14.25170) QuantErr: 14.25170 batch_time=0.61789 
Train Epoch: 47 [177/250 22656/32000 (71%)] Loss: 1.13033 (QuantReg: 13.86609) QuantErr: 13.86609 batch_time=0.56806 
Train Epoch: 47 [188/250 24064/32000 (75%)] Loss: 0.75179 (QuantReg: 14.20428) QuantErr: 14.20428 batch_time=0.59746 
Train Epoch: 47 [199/250 25472/32000 (80%)] Loss: 0.73574 (QuantReg: 14.04671) QuantErr: 14.04671 batch_time=0.58391 
Train Epoch: 47 [210/250 26880/32000 (84%)] Loss: 0.84003 (QuantReg: 14.14284) QuantErr: 14.14284 batch_time=0.57894 
Train Epoch: 47 [221/250 28288/32000 (88%)] Loss: 0.94198 (QuantReg: 14.15613) QuantErr: 14.15613 batch_time=0.51059 
Train Epoch: 47 [232/250 29696/32000 (93%)] Loss: 0.86720 (QuantReg: 14.09295) QuantErr: 14.09295 batch_time=0.63716 
Train Epoch: 47 [243/250 31104/32000 (97%)] Loss: 0.86099 (QuantReg: 14.18465) QuantErr: 14.18465 batch_time=0.52570 
Train Epoch: 47 codebook_update_time=1.97575
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch47.pth ...
Done in 4.456s
removing stale ckpt [epoch 46] [took 0.00s]
 epoch          : 47
 loss           : 0.886307422876358
 quant_reg      : 14.112257026672363
 quant_err      : 14.112257026672363
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 11750
 MSRVTT_full_val/t2v_metrics/R1: 36.21730382293762
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.78672032193159
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.09637824162865
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.187122736418511
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.67308867450961
 MSRVTT_full_test/t2v_metrics/R1: 13.879598662207357
 MSRVTT_full_test/t2v_metrics/R5: 38.59531772575251
 MSRVTT_full_test/t2v_metrics/R10: 51.33779264214047
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.146153846153844
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.184424975038766
 MSRVTT_full_test/v2t_metrics/R1: 17.157190635451506
 MSRVTT_full_test/v2t_metrics/R5: 45.88628762541806
 MSRVTT_full_test/v2t_metrics/R10: 59.86622073578595
 MSRVTT_full_test/v2t_metrics/R50: 87.1571906354515
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.563879598662208
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.12187739126812
 mnt_best       : 30.993383251313407
 not_improved_count: 5
Train Epoch: 48 [1/250 128/32000 (0%)] Loss: 1.02037 (QuantReg: 13.94248) QuantErr: 13.94248 batch_time=40.54154 
Train Epoch: 48 [12/250 1536/32000 (5%)] Loss: 0.86320 (QuantReg: 14.19811) QuantErr: 14.19811 batch_time=0.54124 
Train Epoch: 48 [23/250 2944/32000 (9%)] Loss: 0.71008 (QuantReg: 14.11473) QuantErr: 14.11473 batch_time=0.59965 
Train Epoch: 48 [34/250 4352/32000 (14%)] Loss: 0.80537 (QuantReg: 14.24812) QuantErr: 14.24812 batch_time=0.52956 
Train Epoch: 48 [45/250 5760/32000 (18%)] Loss: 0.86359 (QuantReg: 13.86805) QuantErr: 13.86805 batch_time=0.54399 
Train Epoch: 48 [56/250 7168/32000 (22%)] Loss: 0.81206 (QuantReg: 14.20419) QuantErr: 14.20419 batch_time=0.57967 
Train Epoch: 48 [67/250 8576/32000 (27%)] Loss: 0.95752 (QuantReg: 14.18166) QuantErr: 14.18166 batch_time=4.87191 
Train Epoch: 48 [78/250 9984/32000 (31%)] Loss: 0.81328 (QuantReg: 14.04230) QuantErr: 14.04230 batch_time=0.54003 
Train Epoch: 48 [89/250 11392/32000 (36%)] Loss: 0.77675 (QuantReg: 14.18620) QuantErr: 14.18620 batch_time=0.66295 
Train Epoch: 48 [100/250 12800/32000 (40%)] Loss: 0.82771 (QuantReg: 14.10831) QuantErr: 14.10831 batch_time=0.57101 
Train Epoch: 48 [111/250 14208/32000 (44%)] Loss: 0.77138 (QuantReg: 14.15313) QuantErr: 14.15313 batch_time=0.57516 
Train Epoch: 48 [122/250 15616/32000 (49%)] Loss: 0.88131 (QuantReg: 14.03688) QuantErr: 14.03688 batch_time=0.81713 
Train Epoch: 48 [133/250 17024/32000 (53%)] Loss: 0.83897 (QuantReg: 14.01423) QuantErr: 14.01423 batch_time=0.51495 
Train Epoch: 48 [144/250 18432/32000 (58%)] Loss: 0.86458 (QuantReg: 14.11633) QuantErr: 14.11633 batch_time=0.56607 
Train Epoch: 48 [155/250 19840/32000 (62%)] Loss: 0.79445 (QuantReg: 14.35196) QuantErr: 14.35196 batch_time=0.50137 
Train Epoch: 48 [166/250 21248/32000 (66%)] Loss: 1.08542 (QuantReg: 13.98737) QuantErr: 13.98737 batch_time=0.61378 
Train Epoch: 48 [177/250 22656/32000 (71%)] Loss: 0.71649 (QuantReg: 14.25418) QuantErr: 14.25418 batch_time=0.54198 
Train Epoch: 48 [188/250 24064/32000 (75%)] Loss: 0.88962 (QuantReg: 14.08008) QuantErr: 14.08008 batch_time=0.53901 
Train Epoch: 48 [199/250 25472/32000 (80%)] Loss: 1.06299 (QuantReg: 14.21687) QuantErr: 14.21687 batch_time=0.51682 
Train Epoch: 48 [210/250 26880/32000 (84%)] Loss: 0.92472 (QuantReg: 14.30613) QuantErr: 14.30613 batch_time=0.52165 
Train Epoch: 48 [221/250 28288/32000 (88%)] Loss: 0.86699 (QuantReg: 14.11879) QuantErr: 14.11879 batch_time=0.53447 
Train Epoch: 48 [232/250 29696/32000 (93%)] Loss: 1.12915 (QuantReg: 14.36337) QuantErr: 14.36337 batch_time=0.55893 
Train Epoch: 48 [243/250 31104/32000 (97%)] Loss: 1.06362 (QuantReg: 13.92575) QuantErr: 13.92575 batch_time=0.51077 
Train Epoch: 48 codebook_update_time=2.03265
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch48.pth ...
Done in 4.935s
removing stale ckpt [epoch 47] [took 0.00s]
 epoch          : 48
 loss           : 0.8862601697444916
 quant_reg      : 14.123158535003663
 quant_err      : 14.123158535003663
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.599597585513077
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.73675421363487
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.806841046277666
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.85524414504602
 MSRVTT_full_test/t2v_metrics/R1: 14.648829431438127
 MSRVTT_full_test/t2v_metrics/R5: 38.896321070234116
 MSRVTT_full_test/t2v_metrics/R10: 51.40468227424749
 MSRVTT_full_test/t2v_metrics/R50: 81.63879598662207
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.57090301003345
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.82511526611658
 MSRVTT_full_test/v2t_metrics/R1: 17.357859531772576
 MSRVTT_full_test/v2t_metrics/R5: 46.35451505016722
 MSRVTT_full_test/v2t_metrics/R10: 60.0
 MSRVTT_full_test/v2t_metrics/R50: 87.05685618729098
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.38695652173913
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.4121637623118
 mnt_best       : 30.993383251313407
 not_improved_count: 6
Train Epoch: 49 [1/250 128/32000 (0%)] Loss: 0.77123 (QuantReg: 13.94005) QuantErr: 13.94005 batch_time=41.56170 
Train Epoch: 49 [12/250 1536/32000 (5%)] Loss: 0.76179 (QuantReg: 14.15714) QuantErr: 14.15714 batch_time=0.52382 
Train Epoch: 49 [23/250 2944/32000 (9%)] Loss: 0.82686 (QuantReg: 14.11368) QuantErr: 14.11368 batch_time=0.59392 
Train Epoch: 49 [34/250 4352/32000 (14%)] Loss: 0.84065 (QuantReg: 14.22084) QuantErr: 14.22084 batch_time=0.51725 
Train Epoch: 49 [45/250 5760/32000 (18%)] Loss: 0.70084 (QuantReg: 14.19921) QuantErr: 14.19921 batch_time=0.52206 
Train Epoch: 49 [56/250 7168/32000 (22%)] Loss: 1.02007 (QuantReg: 14.15546) QuantErr: 14.15546 batch_time=0.56589 
Train Epoch: 49 [67/250 8576/32000 (27%)] Loss: 0.87732 (QuantReg: 14.28988) QuantErr: 14.28988 batch_time=0.56972 
Train Epoch: 49 [78/250 9984/32000 (31%)] Loss: 0.78528 (QuantReg: 13.98427) QuantErr: 13.98427 batch_time=0.50801 
Train Epoch: 49 [89/250 11392/32000 (36%)] Loss: 1.02472 (QuantReg: 13.96002) QuantErr: 13.96002 batch_time=0.52239 
Train Epoch: 49 [100/250 12800/32000 (40%)] Loss: 0.80823 (QuantReg: 14.02024) QuantErr: 14.02024 batch_time=0.59755 
Train Epoch: 49 [111/250 14208/32000 (44%)] Loss: 0.89057 (QuantReg: 14.16529) QuantErr: 14.16529 batch_time=0.61668 
Train Epoch: 49 [122/250 15616/32000 (49%)] Loss: 1.06108 (QuantReg: 13.94454) QuantErr: 13.94454 batch_time=0.61433 
Train Epoch: 49 [133/250 17024/32000 (53%)] Loss: 1.08445 (QuantReg: 13.95394) QuantErr: 13.95394 batch_time=0.54579 
Train Epoch: 49 [144/250 18432/32000 (58%)] Loss: 0.91137 (QuantReg: 14.19875) QuantErr: 14.19875 batch_time=0.94564 
Train Epoch: 49 [155/250 19840/32000 (62%)] Loss: 0.89448 (QuantReg: 14.17291) QuantErr: 14.17291 batch_time=0.51852 
Train Epoch: 49 [166/250 21248/32000 (66%)] Loss: 0.91695 (QuantReg: 14.10263) QuantErr: 14.10263 batch_time=0.50992 
Train Epoch: 49 [177/250 22656/32000 (71%)] Loss: 0.80472 (QuantReg: 14.05304) QuantErr: 14.05304 batch_time=0.61252 
Train Epoch: 49 [188/250 24064/32000 (75%)] Loss: 0.92609 (QuantReg: 14.08411) QuantErr: 14.08411 batch_time=0.64301 
Train Epoch: 49 [199/250 25472/32000 (80%)] Loss: 0.95326 (QuantReg: 14.32407) QuantErr: 14.32407 batch_time=0.51665 
Train Epoch: 49 [210/250 26880/32000 (84%)] Loss: 0.96927 (QuantReg: 14.11943) QuantErr: 14.11943 batch_time=0.51623 
Train Epoch: 49 [221/250 28288/32000 (88%)] Loss: 0.92117 (QuantReg: 14.24755) QuantErr: 14.24755 batch_time=0.55779 
Train Epoch: 49 [232/250 29696/32000 (93%)] Loss: 0.66171 (QuantReg: 14.21265) QuantErr: 14.21265 batch_time=0.60309 
Train Epoch: 49 [243/250 31104/32000 (97%)] Loss: 0.81122 (QuantReg: 14.02487) QuantErr: 14.02487 batch_time=0.53768 
Train Epoch: 49 codebook_update_time=1.66649
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch49.pth ...
Done in 4.473s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 0.8802721953392029
 quant_reg      : 14.113445999145508
 quant_err      : 14.113445999145508
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 12250
 MSRVTT_full_val/t2v_metrics/R1: 36.82092555331992
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.808853118712275
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.10456394615558
 MSRVTT_full_val/v2t_metrics/R1: 39.63782696177062
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.2152917505030185
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.22306597264755
 MSRVTT_full_test/t2v_metrics/R1: 14.581939799331103
 MSRVTT_full_test/t2v_metrics/R5: 38.69565217391305
 MSRVTT_full_test/t2v_metrics/R10: 51.070234113712374
 MSRVTT_full_test/t2v_metrics/R50: 80.73578595317726
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.642140468227424
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.658326155229467
 MSRVTT_full_test/v2t_metrics/R1: 18.160535117056856
 MSRVTT_full_test/v2t_metrics/R5: 45.752508361204015
 MSRVTT_full_test/v2t_metrics/R10: 58.82943143812709
 MSRVTT_full_test/v2t_metrics/R50: 87.02341137123746
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.10334448160535
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.56335736031011
 mnt_best       : 30.993383251313407
 not_improved_count: 7
Train Epoch: 50 [1/250 128/32000 (0%)] Loss: 0.80824 (QuantReg: 14.17235) QuantErr: 14.17235 batch_time=43.98558 
Train Epoch: 50 [12/250 1536/32000 (5%)] Loss: 0.77039 (QuantReg: 14.07452) QuantErr: 14.07452 batch_time=0.50482 
Train Epoch: 50 [23/250 2944/32000 (9%)] Loss: 0.86674 (QuantReg: 14.18107) QuantErr: 14.18107 batch_time=0.91408 
Train Epoch: 50 [34/250 4352/32000 (14%)] Loss: 0.82393 (QuantReg: 14.30090) QuantErr: 14.30090 batch_time=0.59708 
Train Epoch: 50 [45/250 5760/32000 (18%)] Loss: 1.06692 (QuantReg: 13.95322) QuantErr: 13.95322 batch_time=0.54644 
Train Epoch: 50 [56/250 7168/32000 (22%)] Loss: 0.73065 (QuantReg: 14.24093) QuantErr: 14.24093 batch_time=0.51016 
Train Epoch: 50 [67/250 8576/32000 (27%)] Loss: 0.85051 (QuantReg: 14.23775) QuantErr: 14.23775 batch_time=0.54660 
Train Epoch: 50 [78/250 9984/32000 (31%)] Loss: 1.00242 (QuantReg: 13.99440) QuantErr: 13.99440 batch_time=0.51700 
Train Epoch: 50 [89/250 11392/32000 (36%)] Loss: 0.89897 (QuantReg: 14.16244) QuantErr: 14.16244 batch_time=0.53252 
Train Epoch: 50 [100/250 12800/32000 (40%)] Loss: 0.73741 (QuantReg: 14.02329) QuantErr: 14.02329 batch_time=0.52012 
Train Epoch: 50 [111/250 14208/32000 (44%)] Loss: 0.84423 (QuantReg: 14.09952) QuantErr: 14.09952 batch_time=0.55285 
Train Epoch: 50 [122/250 15616/32000 (49%)] Loss: 0.85033 (QuantReg: 14.37124) QuantErr: 14.37124 batch_time=0.57200 
Train Epoch: 50 [133/250 17024/32000 (53%)] Loss: 0.92486 (QuantReg: 14.15438) QuantErr: 14.15438 batch_time=0.56904 
Train Epoch: 50 [144/250 18432/32000 (58%)] Loss: 0.94774 (QuantReg: 13.78585) QuantErr: 13.78585 batch_time=0.50856 
Train Epoch: 50 [155/250 19840/32000 (62%)] Loss: 1.06525 (QuantReg: 14.07673) QuantErr: 14.07673 batch_time=0.52723 
Train Epoch: 50 [166/250 21248/32000 (66%)] Loss: 0.72707 (QuantReg: 14.43525) QuantErr: 14.43525 batch_time=0.81544 
Train Epoch: 50 [177/250 22656/32000 (71%)] Loss: 1.01042 (QuantReg: 14.10126) QuantErr: 14.10126 batch_time=0.55930 
Train Epoch: 50 [188/250 24064/32000 (75%)] Loss: 1.11576 (QuantReg: 14.10151) QuantErr: 14.10151 batch_time=0.58356 
Train Epoch: 50 [199/250 25472/32000 (80%)] Loss: 0.62335 (QuantReg: 14.24180) QuantErr: 14.24180 batch_time=0.55848 
Train Epoch: 50 [210/250 26880/32000 (84%)] Loss: 0.93877 (QuantReg: 14.33069) QuantErr: 14.33069 batch_time=0.53008 
Train Epoch: 50 [221/250 28288/32000 (88%)] Loss: 0.85869 (QuantReg: 14.03343) QuantErr: 14.03343 batch_time=0.51523 
Train Epoch: 50 [232/250 29696/32000 (93%)] Loss: 0.89042 (QuantReg: 14.19624) QuantErr: 14.19624 batch_time=0.57575 
Train Epoch: 50 [243/250 31104/32000 (97%)] Loss: 0.90363 (QuantReg: 14.08632) QuantErr: 14.08632 batch_time=0.71145 
Train Epoch: 50 codebook_update_time=1.77281
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/checkpoint-epoch50.pth ...
Done in 21.749s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 0.8769690954685211
 quant_reg      : 14.1331413230896
 quant_err      : 14.1331413230896
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.70020120724346
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.573257389610546
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.084507042253521
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.61317917893587
 MSRVTT_full_test/t2v_metrics/R1: 14.481605351170568
 MSRVTT_full_test/t2v_metrics/R5: 38.49498327759197
 MSRVTT_full_test/t2v_metrics/R10: 51.20401337792642
 MSRVTT_full_test/t2v_metrics/R50: 81.1371237458194
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.79464882943144
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.561519871113955
 MSRVTT_full_test/v2t_metrics/R1: 17.525083612040135
 MSRVTT_full_test/v2t_metrics/R5: 45.65217391304348
 MSRVTT_full_test/v2t_metrics/R10: 59.531772575250834
 MSRVTT_full_test/v2t_metrics/R50: 86.98996655518394
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.867558528428095
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.248507136529675
 mnt_best       : 30.993383251313407
 not_improved_count: 8
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/trained_model.pth ...
Ckpt loaded at epoch 42.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 15.150501672240802
 t2v_metrics/R5/final_eval: 38.52842809364549
 t2v_metrics/R10/final_eval: 51.00334448160535
 t2v_metrics/R50/final_eval: 81.33779264214047
 t2v_metrics/MedR/final_eval: 10.0
 t2v_metrics/MeanR/final_eval: 46.22374581939799
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 30.993383251313407
 v2t_metrics/R1/final_eval: 18.26086956521739
 v2t_metrics/R5/final_eval: 44.88294314381271
 v2t_metrics/R10/final_eval: 59.063545150501675
 v2t_metrics/R50/final_eval: 87.1571906354515
 v2t_metrics/MedR/final_eval: 7.0
 v2t_metrics/MeanR/final_eval: 30.96086956521739
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 36.44523578470286
Best epoch for the monitored metric: 42
Script took 04h42m34s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full/trained_model.pth
