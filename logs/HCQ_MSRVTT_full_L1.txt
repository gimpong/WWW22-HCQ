Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 718.8456420898438 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 31.74428963661194 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 195.07984566688538 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 199.8620789051056 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch0.pth ...
Done in 2.260s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch0.pth ...
Done in 4.208s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.2012072434607646
 MSRVTT_full_val/t2v_metrics/R5: 1.2072434607645874
 MSRVTT_full_val/t2v_metrics/R10: 2.414486921529175
 MSRVTT_full_val/t2v_metrics/R50: 9.6579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 258.0
 MSRVTT_full_val/t2v_metrics/MeanR: 252.8893360160966
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.8370558644072049
 MSRVTT_full_val/v2t_metrics/R1: 0.4024144869215292
 MSRVTT_full_val/v2t_metrics/R5: 1.0060362173038229
 MSRVTT_full_val/v2t_metrics/R10: 2.0120724346076457
 MSRVTT_full_val/v2t_metrics/R50: 10.261569416498993
 MSRVTT_full_val/v2t_metrics/MedR: 252.0
 MSRVTT_full_val/v2t_metrics/MeanR: 254.52515090543258
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.9339212944894927
 MSRVTT_full_test/t2v_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/t2v_metrics/R5: 0.23411371237458195
 MSRVTT_full_test/t2v_metrics/R10: 0.3010033444816054
 MSRVTT_full_test/t2v_metrics/R50: 1.806020066889632
 MSRVTT_full_test/t2v_metrics/MedR: 1476.5
 MSRVTT_full_test/t2v_metrics/MeanR: 1480.3498327759198
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.1330788363844947
 MSRVTT_full_test/v2t_metrics/R1: 0.033444816053511704
 MSRVTT_full_test/v2t_metrics/R5: 0.20066889632107024
 MSRVTT_full_test/v2t_metrics/R10: 0.43478260869565216
 MSRVTT_full_test/v2t_metrics/R50: 1.2374581939799332
 MSRVTT_full_test/v2t_metrics/MedR: 1523.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1519.7267558528429
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.14289828366882665
 mnt_best       : 0.1330788363844947
 not_improved_count: 0
Train Epoch: 1 [1/250 128/32000 (0%)] Loss: 39.49795 (QuantReg: 22.52384) QuantErr: 22.52384 batch_time=31.60816 
Train Epoch: 1 [12/250 1536/32000 (5%)] Loss: 37.34332 (QuantReg: 22.38425) QuantErr: 22.38425 batch_time=0.39577 
Train Epoch: 1 [23/250 2944/32000 (9%)] Loss: 30.98862 (QuantReg: 22.66319) QuantErr: 22.66319 batch_time=0.41700 
Train Epoch: 1 [34/250 4352/32000 (14%)] Loss: 28.15693 (QuantReg: 22.66246) QuantErr: 22.66246 batch_time=0.40994 
Train Epoch: 1 [45/250 5760/32000 (18%)] Loss: 26.09302 (QuantReg: 22.66771) QuantErr: 22.66771 batch_time=0.40458 
Train Epoch: 1 [56/250 7168/32000 (22%)] Loss: 25.98850 (QuantReg: 22.56647) QuantErr: 22.56647 batch_time=0.38951 
Train Epoch: 1 [67/250 8576/32000 (27%)] Loss: 24.75508 (QuantReg: 22.54847) QuantErr: 22.54847 batch_time=0.40539 
Train Epoch: 1 [78/250 9984/32000 (31%)] Loss: 23.20779 (QuantReg: 22.65297) QuantErr: 22.65297 batch_time=0.43300 
Train Epoch: 1 [89/250 11392/32000 (36%)] Loss: 23.19925 (QuantReg: 22.64698) QuantErr: 22.64698 batch_time=0.39726 
Train Epoch: 1 [100/250 12800/32000 (40%)] Loss: 22.59953 (QuantReg: 22.55651) QuantErr: 22.55651 batch_time=0.40628 
Train Epoch: 1 [111/250 14208/32000 (44%)] Loss: 20.85506 (QuantReg: 22.59692) QuantErr: 22.59692 batch_time=0.43842 
Train Epoch: 1 [122/250 15616/32000 (49%)] Loss: 21.28959 (QuantReg: 22.62316) QuantErr: 22.62316 batch_time=0.43109 
Train Epoch: 1 [133/250 17024/32000 (53%)] Loss: 20.75331 (QuantReg: 22.66196) QuantErr: 22.66196 batch_time=0.40403 
Train Epoch: 1 [144/250 18432/32000 (58%)] Loss: 19.65504 (QuantReg: 22.62380) QuantErr: 22.62380 batch_time=0.41307 
Train Epoch: 1 [155/250 19840/32000 (62%)] Loss: 19.08725 (QuantReg: 22.66782) QuantErr: 22.66782 batch_time=0.42904 
Train Epoch: 1 [166/250 21248/32000 (66%)] Loss: 18.88899 (QuantReg: 22.67997) QuantErr: 22.67997 batch_time=0.41922 
Train Epoch: 1 [177/250 22656/32000 (71%)] Loss: 17.97786 (QuantReg: 22.68871) QuantErr: 22.68871 batch_time=0.39768 
Train Epoch: 1 [188/250 24064/32000 (75%)] Loss: 18.43876 (QuantReg: 22.74523) QuantErr: 22.74523 batch_time=0.42602 
Train Epoch: 1 [199/250 25472/32000 (80%)] Loss: 18.35728 (QuantReg: 22.70723) QuantErr: 22.70723 batch_time=2.15975 
Train Epoch: 1 [210/250 26880/32000 (84%)] Loss: 18.28521 (QuantReg: 22.74262) QuantErr: 22.74262 batch_time=0.42416 
Train Epoch: 1 [221/250 28288/32000 (88%)] Loss: 17.58568 (QuantReg: 22.69681) QuantErr: 22.69681 batch_time=0.41234 
Train Epoch: 1 [232/250 29696/32000 (93%)] Loss: 17.46659 (QuantReg: 22.72867) QuantErr: 22.72867 batch_time=0.41438 
Train Epoch: 1 [243/250 31104/32000 (97%)] Loss: 15.37688 (QuantReg: 22.65070) QuantErr: 22.65070 batch_time=0.41085 
Train Epoch: 1 codebook_update_time=0.56089
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch1.pth ...
Done in 4.414s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch1.pth ...
Done in 8.720s
 epoch          : 1
 loss           : 22.399550048828125
 quant_reg      : 22.627704833984374
 quant_err      : 22.627704833984374
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 250
 MSRVTT_full_val/t2v_metrics/R1: 16.096579476861166
 MSRVTT_full_val/t2v_metrics/R5: 46.27766599597585
 MSRVTT_full_val/t2v_metrics/R10: 63.17907444668008
 MSRVTT_full_val/t2v_metrics/R50: 93.96378269617706
 MSRVTT_full_val/t2v_metrics/MedR: 6.0
 MSRVTT_full_val/t2v_metrics/MeanR: 14.525150905432596
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 36.10434204616997
 MSRVTT_full_val/v2t_metrics/R1: 19.718309859154928
 MSRVTT_full_val/v2t_metrics/R5: 53.521126760563384
 MSRVTT_full_val/v2t_metrics/R10: 67.6056338028169
 MSRVTT_full_val/v2t_metrics/R50: 93.36016096579476
 MSRVTT_full_val/v2t_metrics/MedR: 5.0
 MSRVTT_full_val/v2t_metrics/MeanR: 14.9476861167002
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 41.47559335748855
 MSRVTT_full_test/t2v_metrics/R1: 4.548494983277592
 MSRVTT_full_test/t2v_metrics/R5: 15.852842809364548
 MSRVTT_full_test/t2v_metrics/R10: 25.986622073578594
 MSRVTT_full_test/t2v_metrics/R50: 60.735785953177256
 MSRVTT_full_test/t2v_metrics/MedR: 32.0
 MSRVTT_full_test/t2v_metrics/MeanR: 87.53076923076924
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 12.328443086783441
 MSRVTT_full_test/v2t_metrics/R1: 5.418060200668896
 MSRVTT_full_test/v2t_metrics/R5: 20.066889632107024
 MSRVTT_full_test/v2t_metrics/R10: 29.531772575250837
 MSRVTT_full_test/v2t_metrics/R50: 63.979933110367895
 MSRVTT_full_test/v2t_metrics/MedR: 28.0
 MSRVTT_full_test/v2t_metrics/MeanR: 81.81086956521739
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 14.752687210486652
 mnt_best       : 12.328443086783441
 not_improved_count: 0
Train Epoch: 2 [1/250 128/32000 (0%)] Loss: 18.10233 (QuantReg: 11.87307) QuantErr: 11.87307 batch_time=29.44275 
Train Epoch: 2 [12/250 1536/32000 (5%)] Loss: 17.77732 (QuantReg: 11.91683) QuantErr: 11.91683 batch_time=0.39909 
Train Epoch: 2 [23/250 2944/32000 (9%)] Loss: 17.72733 (QuantReg: 12.05382) QuantErr: 12.05382 batch_time=0.39026 
Train Epoch: 2 [34/250 4352/32000 (14%)] Loss: 14.69604 (QuantReg: 12.40336) QuantErr: 12.40336 batch_time=0.38426 
Train Epoch: 2 [45/250 5760/32000 (18%)] Loss: 15.10744 (QuantReg: 12.44991) QuantErr: 12.44991 batch_time=0.40691 
Train Epoch: 2 [56/250 7168/32000 (22%)] Loss: 15.95441 (QuantReg: 12.70280) QuantErr: 12.70280 batch_time=0.39451 
Train Epoch: 2 [67/250 8576/32000 (27%)] Loss: 15.05391 (QuantReg: 12.71427) QuantErr: 12.71427 batch_time=1.48034 
Train Epoch: 2 [78/250 9984/32000 (31%)] Loss: 15.24794 (QuantReg: 13.01373) QuantErr: 13.01373 batch_time=0.64609 
Train Epoch: 2 [89/250 11392/32000 (36%)] Loss: 12.43337 (QuantReg: 13.27625) QuantErr: 13.27625 batch_time=0.39033 
Train Epoch: 2 [100/250 12800/32000 (40%)] Loss: 14.45883 (QuantReg: 13.49717) QuantErr: 13.49717 batch_time=1.15059 
Train Epoch: 2 [111/250 14208/32000 (44%)] Loss: 17.37507 (QuantReg: 13.50080) QuantErr: 13.50080 batch_time=0.40580 
Train Epoch: 2 [122/250 15616/32000 (49%)] Loss: 13.97449 (QuantReg: 13.70474) QuantErr: 13.70474 batch_time=0.40856 
Train Epoch: 2 [133/250 17024/32000 (53%)] Loss: 15.98515 (QuantReg: 13.98277) QuantErr: 13.98277 batch_time=0.40062 
Train Epoch: 2 [144/250 18432/32000 (58%)] Loss: 14.62093 (QuantReg: 13.42213) QuantErr: 13.42213 batch_time=1.76242 
Train Epoch: 2 [155/250 19840/32000 (62%)] Loss: 15.66959 (QuantReg: 13.76247) QuantErr: 13.76247 batch_time=0.38856 
Train Epoch: 2 [166/250 21248/32000 (66%)] Loss: 17.46343 (QuantReg: 13.93058) QuantErr: 13.93058 batch_time=0.40141 
Train Epoch: 2 [177/250 22656/32000 (71%)] Loss: 13.65529 (QuantReg: 14.39009) QuantErr: 14.39009 batch_time=0.40352 
Train Epoch: 2 [188/250 24064/32000 (75%)] Loss: 14.13309 (QuantReg: 14.33200) QuantErr: 14.33200 batch_time=0.39500 
Train Epoch: 2 [199/250 25472/32000 (80%)] Loss: 14.36799 (QuantReg: 14.28442) QuantErr: 14.28442 batch_time=0.40388 
Train Epoch: 2 [210/250 26880/32000 (84%)] Loss: 16.09453 (QuantReg: 14.33061) QuantErr: 14.33061 batch_time=0.43805 
Train Epoch: 2 [221/250 28288/32000 (88%)] Loss: 14.20123 (QuantReg: 14.42404) QuantErr: 14.42404 batch_time=0.38907 
Train Epoch: 2 [232/250 29696/32000 (93%)] Loss: 13.84661 (QuantReg: 14.58818) QuantErr: 14.58818 batch_time=0.43294 
Train Epoch: 2 [243/250 31104/32000 (97%)] Loss: 13.82683 (QuantReg: 14.83412) QuantErr: 14.83412 batch_time=0.39782 
Train Epoch: 2 codebook_update_time=0.46543
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch2.pth ...
Done in 4.130s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch2.pth ...
Done in 9.046s
removing stale ckpt [epoch 1] [took 0.33s]
removing stale ckpt [epoch 0] [took 0.03s]
 epoch          : 2
 loss           : 14.973683807373046
 quant_reg      : 13.490907512664794
 quant_err      : 13.490907512664794
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 21.327967806841045
 MSRVTT_full_val/t2v_metrics/R5: 56.53923541247485
 MSRVTT_full_val/t2v_metrics/R10: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 11.776659959758552
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 44.121346755583296
 MSRVTT_full_val/v2t_metrics/R1: 21.52917505030181
 MSRVTT_full_val/v2t_metrics/R5: 61.16700201207244
 MSRVTT_full_val/v2t_metrics/R10: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 9.388329979879275
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 46.52188076891588
 MSRVTT_full_test/t2v_metrics/R1: 7.558528428093646
 MSRVTT_full_test/t2v_metrics/R5: 24.414715719063544
 MSRVTT_full_test/t2v_metrics/R10: 36.05351170568562
 MSRVTT_full_test/t2v_metrics/R50: 70.46822742474916
 MSRVTT_full_test/t2v_metrics/MedR: 20.0
 MSRVTT_full_test/t2v_metrics/MeanR: 65.54648829431439
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 18.80812482271822
 MSRVTT_full_test/v2t_metrics/R1: 8.762541806020067
 MSRVTT_full_test/v2t_metrics/R5: 27.49163879598662
 MSRVTT_full_test/v2t_metrics/R10: 39.63210702341137
 MSRVTT_full_test/v2t_metrics/R50: 73.9799331103679
 MSRVTT_full_test/v2t_metrics/MedR: 17.0
 MSRVTT_full_test/v2t_metrics/MeanR: 56.68494983277592
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 21.214166091750986
 mnt_best       : 18.80812482271822
 not_improved_count: 0
Train Epoch: 3 [1/250 128/32000 (0%)] Loss: 14.02149 (QuantReg: 11.70376) QuantErr: 11.70376 batch_time=33.71718 
Train Epoch: 3 [12/250 1536/32000 (5%)] Loss: 12.53799 (QuantReg: 12.00362) QuantErr: 12.00362 batch_time=0.39284 
Train Epoch: 3 [23/250 2944/32000 (9%)] Loss: 13.39302 (QuantReg: 11.70116) QuantErr: 11.70116 batch_time=0.39433 
Train Epoch: 3 [34/250 4352/32000 (14%)] Loss: 14.00514 (QuantReg: 12.57281) QuantErr: 12.57281 batch_time=0.40830 
Train Epoch: 3 [45/250 5760/32000 (18%)] Loss: 13.11802 (QuantReg: 12.21014) QuantErr: 12.21014 batch_time=0.44480 
Train Epoch: 3 [56/250 7168/32000 (22%)] Loss: 12.48300 (QuantReg: 12.25318) QuantErr: 12.25318 batch_time=0.43726 
Train Epoch: 3 [67/250 8576/32000 (27%)] Loss: 11.61669 (QuantReg: 12.65630) QuantErr: 12.65630 batch_time=4.93298 
Train Epoch: 3 [78/250 9984/32000 (31%)] Loss: 12.18910 (QuantReg: 12.26964) QuantErr: 12.26964 batch_time=0.40203 
Train Epoch: 3 [89/250 11392/32000 (36%)] Loss: 13.26896 (QuantReg: 12.25048) QuantErr: 12.25048 batch_time=0.40465 
Train Epoch: 3 [100/250 12800/32000 (40%)] Loss: 12.41553 (QuantReg: 12.50833) QuantErr: 12.50833 batch_time=0.40584 
Train Epoch: 3 [111/250 14208/32000 (44%)] Loss: 12.11292 (QuantReg: 12.85411) QuantErr: 12.85411 batch_time=0.41929 
Train Epoch: 3 [122/250 15616/32000 (49%)] Loss: 13.46008 (QuantReg: 13.00527) QuantErr: 13.00527 batch_time=0.41125 
Train Epoch: 3 [133/250 17024/32000 (53%)] Loss: 11.41973 (QuantReg: 12.85218) QuantErr: 12.85218 batch_time=0.38730 
Train Epoch: 3 [144/250 18432/32000 (58%)] Loss: 12.29348 (QuantReg: 12.94612) QuantErr: 12.94612 batch_time=0.41524 
Train Epoch: 3 [155/250 19840/32000 (62%)] Loss: 12.10041 (QuantReg: 12.51146) QuantErr: 12.51146 batch_time=0.40188 
Train Epoch: 3 [166/250 21248/32000 (66%)] Loss: 12.12134 (QuantReg: 12.97768) QuantErr: 12.97768 batch_time=0.40585 
Train Epoch: 3 [177/250 22656/32000 (71%)] Loss: 10.38684 (QuantReg: 13.08421) QuantErr: 13.08421 batch_time=0.41124 
Train Epoch: 3 [188/250 24064/32000 (75%)] Loss: 11.61217 (QuantReg: 13.19003) QuantErr: 13.19003 batch_time=0.43571 
Train Epoch: 3 [199/250 25472/32000 (80%)] Loss: 13.26641 (QuantReg: 12.99355) QuantErr: 12.99355 batch_time=0.40142 
Train Epoch: 3 [210/250 26880/32000 (84%)] Loss: 11.26374 (QuantReg: 12.99477) QuantErr: 12.99477 batch_time=0.41204 
Train Epoch: 3 [221/250 28288/32000 (88%)] Loss: 12.41247 (QuantReg: 13.27071) QuantErr: 13.27071 batch_time=0.39980 
Train Epoch: 3 [232/250 29696/32000 (93%)] Loss: 12.65660 (QuantReg: 13.24327) QuantErr: 13.24327 batch_time=0.41098 
Train Epoch: 3 [243/250 31104/32000 (97%)] Loss: 11.64779 (QuantReg: 13.66502) QuantErr: 13.66502 batch_time=0.41934 
Train Epoch: 3 codebook_update_time=0.42343
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch3.pth ...
Done in 4.326s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch3.pth ...
Done in 16.472s
removing stale ckpt [epoch 2] [took 0.03s]
 epoch          : 3
 loss           : 12.481977165222167
 quant_reg      : 12.754533981323242
 quant_err      : 12.754533981323242
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 750
 MSRVTT_full_val/t2v_metrics/R1: 24.748490945674043
 MSRVTT_full_val/t2v_metrics/R5: 59.356136820925556
 MSRVTT_full_val/t2v_metrics/R10: 75.85513078470825
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.064386317907445
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 48.12082936361093
 MSRVTT_full_val/v2t_metrics/R1: 27.16297786720322
 MSRVTT_full_val/v2t_metrics/R5: 65.3923541247485
 MSRVTT_full_val/v2t_metrics/R10: 80.6841046277666
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.006036217303823
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 52.331611903894725
 MSRVTT_full_test/t2v_metrics/R1: 8.62876254180602
 MSRVTT_full_test/t2v_metrics/R5: 26.45484949832776
 MSRVTT_full_test/t2v_metrics/R10: 37.9933110367893
 MSRVTT_full_test/t2v_metrics/R50: 72.67558528428094
 MSRVTT_full_test/t2v_metrics/MedR: 18.0
 MSRVTT_full_test/t2v_metrics/MeanR: 60.01438127090301
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 20.545670488621695
 MSRVTT_full_test/v2t_metrics/R1: 9.498327759197325
 MSRVTT_full_test/v2t_metrics/R5: 31.37123745819398
 MSRVTT_full_test/v2t_metrics/R10: 43.91304347826087
 MSRVTT_full_test/v2t_metrics/R50: 78.36120401337793
 MSRVTT_full_test/v2t_metrics/MedR: 14.0
 MSRVTT_full_test/v2t_metrics/MeanR: 46.658026755852845
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 23.564457533292455
 mnt_best       : 20.545670488621695
 not_improved_count: 0
Train Epoch: 4 [1/250 128/32000 (0%)] Loss: 10.66987 (QuantReg: 12.24523) QuantErr: 12.24523 batch_time=36.02622 
Train Epoch: 4 [12/250 1536/32000 (5%)] Loss: 12.69441 (QuantReg: 12.13173) QuantErr: 12.13173 batch_time=0.39948 
Train Epoch: 4 [23/250 2944/32000 (9%)] Loss: 9.37280 (QuantReg: 12.12717) QuantErr: 12.12717 batch_time=0.41037 
Train Epoch: 4 [34/250 4352/32000 (14%)] Loss: 10.51302 (QuantReg: 12.57289) QuantErr: 12.57289 batch_time=0.44039 
Train Epoch: 4 [45/250 5760/32000 (18%)] Loss: 9.94194 (QuantReg: 12.39471) QuantErr: 12.39471 batch_time=0.39088 
Train Epoch: 4 [56/250 7168/32000 (22%)] Loss: 10.39409 (QuantReg: 12.43028) QuantErr: 12.43028 batch_time=0.44260 
Train Epoch: 4 [67/250 8576/32000 (27%)] Loss: 11.09333 (QuantReg: 12.33693) QuantErr: 12.33693 batch_time=0.40141 
Train Epoch: 4 [78/250 9984/32000 (31%)] Loss: 10.36231 (QuantReg: 12.40902) QuantErr: 12.40902 batch_time=0.41327 
Train Epoch: 4 [89/250 11392/32000 (36%)] Loss: 10.21286 (QuantReg: 12.92824) QuantErr: 12.92824 batch_time=0.39176 
Train Epoch: 4 [100/250 12800/32000 (40%)] Loss: 9.93175 (QuantReg: 12.57999) QuantErr: 12.57999 batch_time=0.40715 
Train Epoch: 4 [111/250 14208/32000 (44%)] Loss: 8.59459 (QuantReg: 12.44403) QuantErr: 12.44403 batch_time=0.41872 
Train Epoch: 4 [122/250 15616/32000 (49%)] Loss: 11.02537 (QuantReg: 12.60856) QuantErr: 12.60856 batch_time=0.40086 
Train Epoch: 4 [133/250 17024/32000 (53%)] Loss: 11.20419 (QuantReg: 12.90561) QuantErr: 12.90561 batch_time=0.40171 
Train Epoch: 4 [144/250 18432/32000 (58%)] Loss: 10.36976 (QuantReg: 12.48410) QuantErr: 12.48410 batch_time=0.40793 
Train Epoch: 4 [155/250 19840/32000 (62%)] Loss: 8.96074 (QuantReg: 12.73000) QuantErr: 12.73000 batch_time=0.38836 
Train Epoch: 4 [166/250 21248/32000 (66%)] Loss: 11.61548 (QuantReg: 12.58820) QuantErr: 12.58820 batch_time=0.40519 
Train Epoch: 4 [177/250 22656/32000 (71%)] Loss: 9.93322 (QuantReg: 12.28435) QuantErr: 12.28435 batch_time=0.42595 
Train Epoch: 4 [188/250 24064/32000 (75%)] Loss: 12.31914 (QuantReg: 12.65851) QuantErr: 12.65851 batch_time=0.42629 
Train Epoch: 4 [199/250 25472/32000 (80%)] Loss: 11.26132 (QuantReg: 12.76093) QuantErr: 12.76093 batch_time=0.45770 
Train Epoch: 4 [210/250 26880/32000 (84%)] Loss: 10.31074 (QuantReg: 12.90252) QuantErr: 12.90252 batch_time=0.40263 
Train Epoch: 4 [221/250 28288/32000 (88%)] Loss: 9.55751 (QuantReg: 13.11491) QuantErr: 13.11491 batch_time=0.39040 
Train Epoch: 4 [232/250 29696/32000 (93%)] Loss: 11.19553 (QuantReg: 12.71603) QuantErr: 12.71603 batch_time=0.42243 
Train Epoch: 4 [243/250 31104/32000 (97%)] Loss: 10.53226 (QuantReg: 13.01500) QuantErr: 13.01500 batch_time=0.43562 
Train Epoch: 4 codebook_update_time=0.67750
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch4.pth ...
Done in 23.598s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch4.pth ...
Done in 28.921s
removing stale ckpt [epoch 3] [took 0.02s]
 epoch          : 4
 loss           : 11.038489490509033
 quant_reg      : 12.632359203338623
 quant_err      : 12.632359203338623
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 24.748490945674043
 MSRVTT_full_val/t2v_metrics/R5: 60.36217303822938
 MSRVTT_full_val/t2v_metrics/R10: 76.65995975855131
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.503018108651911
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 48.56171977598913
 MSRVTT_full_val/v2t_metrics/R1: 26.156941649899398
 MSRVTT_full_val/v2t_metrics/R5: 67.00201207243461
 MSRVTT_full_val/v2t_metrics/R10: 82.29376257545272
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.183098591549296
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 52.44216056318534
 MSRVTT_full_test/t2v_metrics/R1: 8.695652173913043
 MSRVTT_full_test/t2v_metrics/R5: 26.82274247491639
 MSRVTT_full_test/t2v_metrics/R10: 39.063545150501675
 MSRVTT_full_test/t2v_metrics/R50: 73.87959866220736
 MSRVTT_full_test/t2v_metrics/MedR: 17.0
 MSRVTT_full_test/t2v_metrics/MeanR: 57.14866220735786
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 20.886179111503036
 MSRVTT_full_test/v2t_metrics/R1: 10.602006688963211
 MSRVTT_full_test/v2t_metrics/R5: 31.872909698996654
 MSRVTT_full_test/v2t_metrics/R10: 46.32107023411371
 MSRVTT_full_test/v2t_metrics/R50: 80.06688963210702
 MSRVTT_full_test/v2t_metrics/MedR: 13.0
 MSRVTT_full_test/v2t_metrics/MeanR: 42.93946488294314
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.014747517729017
 mnt_best       : 20.886179111503036
 not_improved_count: 0
Train Epoch: 5 [1/250 128/32000 (0%)] Loss: 10.71105 (QuantReg: 12.13640) QuantErr: 12.13640 batch_time=35.62675 
Train Epoch: 5 [12/250 1536/32000 (5%)] Loss: 10.40845 (QuantReg: 12.43810) QuantErr: 12.43810 batch_time=0.40240 
Train Epoch: 5 [23/250 2944/32000 (9%)] Loss: 9.77889 (QuantReg: 12.42992) QuantErr: 12.42992 batch_time=0.40218 
Train Epoch: 5 [34/250 4352/32000 (14%)] Loss: 10.50717 (QuantReg: 12.35401) QuantErr: 12.35401 batch_time=0.38828 
Train Epoch: 5 [45/250 5760/32000 (18%)] Loss: 10.74602 (QuantReg: 12.29907) QuantErr: 12.29907 batch_time=0.39416 
Train Epoch: 5 [56/250 7168/32000 (22%)] Loss: 9.25035 (QuantReg: 12.47705) QuantErr: 12.47705 batch_time=0.55626 
Train Epoch: 5 [67/250 8576/32000 (27%)] Loss: 11.23244 (QuantReg: 12.45434) QuantErr: 12.45434 batch_time=0.40601 
Train Epoch: 5 [78/250 9984/32000 (31%)] Loss: 10.37747 (QuantReg: 12.48346) QuantErr: 12.48346 batch_time=0.39045 
Train Epoch: 5 [89/250 11392/32000 (36%)] Loss: 11.63840 (QuantReg: 12.54638) QuantErr: 12.54638 batch_time=0.44736 
Train Epoch: 5 [100/250 12800/32000 (40%)] Loss: 12.21579 (QuantReg: 12.54743) QuantErr: 12.54743 batch_time=0.38249 
Train Epoch: 5 [111/250 14208/32000 (44%)] Loss: 11.17505 (QuantReg: 12.41008) QuantErr: 12.41008 batch_time=0.39083 
Train Epoch: 5 [122/250 15616/32000 (49%)] Loss: 10.37071 (QuantReg: 12.74586) QuantErr: 12.74586 batch_time=0.37538 
Train Epoch: 5 [133/250 17024/32000 (53%)] Loss: 11.19382 (QuantReg: 12.49717) QuantErr: 12.49717 batch_time=0.43799 
Train Epoch: 5 [144/250 18432/32000 (58%)] Loss: 8.75254 (QuantReg: 12.99968) QuantErr: 12.99968 batch_time=0.43104 
Train Epoch: 5 [155/250 19840/32000 (62%)] Loss: 11.54028 (QuantReg: 12.63180) QuantErr: 12.63180 batch_time=0.40877 
Train Epoch: 5 [166/250 21248/32000 (66%)] Loss: 8.76136 (QuantReg: 12.86229) QuantErr: 12.86229 batch_time=0.42179 
Train Epoch: 5 [177/250 22656/32000 (71%)] Loss: 11.74095 (QuantReg: 12.62530) QuantErr: 12.62530 batch_time=0.40299 
Train Epoch: 5 [188/250 24064/32000 (75%)] Loss: 9.93086 (QuantReg: 12.90833) QuantErr: 12.90833 batch_time=0.43350 
Train Epoch: 5 [199/250 25472/32000 (80%)] Loss: 9.95438 (QuantReg: 12.80993) QuantErr: 12.80993 batch_time=0.40543 
Train Epoch: 5 [210/250 26880/32000 (84%)] Loss: 8.28265 (QuantReg: 12.64763) QuantErr: 12.64763 batch_time=0.41700 
Train Epoch: 5 [221/250 28288/32000 (88%)] Loss: 9.66545 (QuantReg: 12.87011) QuantErr: 12.87011 batch_time=0.38501 
Train Epoch: 5 [232/250 29696/32000 (93%)] Loss: 9.20818 (QuantReg: 12.59995) QuantErr: 12.59995 batch_time=0.46726 
Train Epoch: 5 [243/250 31104/32000 (97%)] Loss: 7.14364 (QuantReg: 13.04236) QuantErr: 13.04236 batch_time=0.53458 
Train Epoch: 5 codebook_update_time=0.46558
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch5.pth ...
Done in 5.161s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch5.pth ...
Done in 10.161s
removing stale ckpt [epoch 4] [took 0.00s]
 epoch          : 5
 loss           : 10.045966205596924
 quant_reg      : 12.650605129241944
 quant_err      : 12.650605129241944
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 1250
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 64.1851106639839
 MSRVTT_full_val/t2v_metrics/R10: 77.2635814889336
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.434607645875252
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.61810448491835
 MSRVTT_full_val/v2t_metrics/R1: 30.58350100603622
 MSRVTT_full_val/v2t_metrics/R5: 69.61770623742454
 MSRVTT_full_val/v2t_metrics/R10: 83.5010060362173
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.21327967806841
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.22975687881379
 MSRVTT_full_test/t2v_metrics/R1: 9.19732441471572
 MSRVTT_full_test/t2v_metrics/R5: 29.297658862876254
 MSRVTT_full_test/t2v_metrics/R10: 43.41137123745819
 MSRVTT_full_test/t2v_metrics/R50: 76.8561872909699
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.3505016722408
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.70035466163077
 MSRVTT_full_test/v2t_metrics/R1: 12.341137123745819
 MSRVTT_full_test/v2t_metrics/R5: 34.74916387959866
 MSRVTT_full_test/v2t_metrics/R10: 48.862876254180605
 MSRVTT_full_test/v2t_metrics/R50: 81.93979933110369
 MSRVTT_full_test/v2t_metrics/MedR: 11.0
 MSRVTT_full_test/v2t_metrics/MeanR: 39.083946488294316
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.5693285003312
 mnt_best       : 22.70035466163077
 not_improved_count: 0
Train Epoch: 6 [1/250 128/32000 (0%)] Loss: 9.14635 (QuantReg: 12.61827) QuantErr: 12.61827 batch_time=32.59657 
Train Epoch: 6 [12/250 1536/32000 (5%)] Loss: 8.57504 (QuantReg: 12.51983) QuantErr: 12.51983 batch_time=0.40194 
Train Epoch: 6 [23/250 2944/32000 (9%)] Loss: 9.18007 (QuantReg: 12.53815) QuantErr: 12.53815 batch_time=0.42465 
Train Epoch: 6 [34/250 4352/32000 (14%)] Loss: 9.52044 (QuantReg: 12.14651) QuantErr: 12.14651 batch_time=0.43719 
Train Epoch: 6 [45/250 5760/32000 (18%)] Loss: 7.71904 (QuantReg: 12.36567) QuantErr: 12.36567 batch_time=0.39861 
Train Epoch: 6 [56/250 7168/32000 (22%)] Loss: 10.40046 (QuantReg: 12.38438) QuantErr: 12.38438 batch_time=0.38821 
Train Epoch: 6 [67/250 8576/32000 (27%)] Loss: 8.87288 (QuantReg: 12.64741) QuantErr: 12.64741 batch_time=0.40608 
Train Epoch: 6 [78/250 9984/32000 (31%)] Loss: 9.26620 (QuantReg: 12.72392) QuantErr: 12.72392 batch_time=0.44266 
Train Epoch: 6 [89/250 11392/32000 (36%)] Loss: 10.56551 (QuantReg: 12.49788) QuantErr: 12.49788 batch_time=0.41119 
Train Epoch: 6 [100/250 12800/32000 (40%)] Loss: 9.20042 (QuantReg: 12.84590) QuantErr: 12.84590 batch_time=0.41517 
Train Epoch: 6 [111/250 14208/32000 (44%)] Loss: 7.56449 (QuantReg: 12.56962) QuantErr: 12.56962 batch_time=0.40852 
Train Epoch: 6 [122/250 15616/32000 (49%)] Loss: 9.73160 (QuantReg: 12.55550) QuantErr: 12.55550 batch_time=0.40613 
Train Epoch: 6 [133/250 17024/32000 (53%)] Loss: 9.89241 (QuantReg: 12.81250) QuantErr: 12.81250 batch_time=0.41645 
Train Epoch: 6 [144/250 18432/32000 (58%)] Loss: 9.52533 (QuantReg: 12.80872) QuantErr: 12.80872 batch_time=2.00944 
Train Epoch: 6 [155/250 19840/32000 (62%)] Loss: 10.41447 (QuantReg: 12.86673) QuantErr: 12.86673 batch_time=1.27097 
Train Epoch: 6 [166/250 21248/32000 (66%)] Loss: 9.54800 (QuantReg: 12.74190) QuantErr: 12.74190 batch_time=0.40726 
Train Epoch: 6 [177/250 22656/32000 (71%)] Loss: 9.55612 (QuantReg: 12.79424) QuantErr: 12.79424 batch_time=0.39770 
Train Epoch: 6 [188/250 24064/32000 (75%)] Loss: 9.16665 (QuantReg: 13.09422) QuantErr: 13.09422 batch_time=0.65067 
Train Epoch: 6 [199/250 25472/32000 (80%)] Loss: 8.49284 (QuantReg: 12.82249) QuantErr: 12.82249 batch_time=0.42040 
Train Epoch: 6 [210/250 26880/32000 (84%)] Loss: 8.34840 (QuantReg: 12.89504) QuantErr: 12.89504 batch_time=0.45271 
Train Epoch: 6 [221/250 28288/32000 (88%)] Loss: 8.74470 (QuantReg: 12.80721) QuantErr: 12.80721 batch_time=0.39536 
Train Epoch: 6 [232/250 29696/32000 (93%)] Loss: 8.68264 (QuantReg: 12.97554) QuantErr: 12.97554 batch_time=1.60442 
Train Epoch: 6 [243/250 31104/32000 (97%)] Loss: 9.75568 (QuantReg: 12.89647) QuantErr: 12.89647 batch_time=0.40840 
Train Epoch: 6 codebook_update_time=0.63051
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch6.pth ...
Done in 4.852s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch6.pth ...
Done in 9.180s
removing stale ckpt [epoch 5] [took 0.00s]
 epoch          : 6
 loss           : 9.124582710266113
 quant_reg      : 12.705857822418213
 quant_err      : 12.705857822418213
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 27.766599597585515
 MSRVTT_full_val/t2v_metrics/R5: 65.79476861167002
 MSRVTT_full_val/t2v_metrics/R10: 79.27565392354124
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.482897384305835
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.51515257034553
 MSRVTT_full_val/v2t_metrics/R1: 34.40643863179074
 MSRVTT_full_val/v2t_metrics/R5: 70.62374245472837
 MSRVTT_full_val/v2t_metrics/R10: 84.50704225352112
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.227364185110664
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.996708662803314
 MSRVTT_full_test/t2v_metrics/R1: 9.765886287625419
 MSRVTT_full_test/t2v_metrics/R5: 30.735785953177256
 MSRVTT_full_test/t2v_metrics/R10: 44.48160535117057
 MSRVTT_full_test/t2v_metrics/R50: 77.82608695652173
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.63795986622073
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.723502771683712
 MSRVTT_full_test/v2t_metrics/R1: 11.237458193979933
 MSRVTT_full_test/v2t_metrics/R5: 35.719063545150505
 MSRVTT_full_test/v2t_metrics/R10: 50.869565217391305
 MSRVTT_full_test/v2t_metrics/R50: 83.07692307692308
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.4876254180602
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.332250542633265
 mnt_best       : 23.723502771683712
 not_improved_count: 0
Train Epoch: 7 [1/250 128/32000 (0%)] Loss: 8.66740 (QuantReg: 12.26917) QuantErr: 12.26917 batch_time=38.03647 
Train Epoch: 7 [12/250 1536/32000 (5%)] Loss: 9.23838 (QuantReg: 12.58732) QuantErr: 12.58732 batch_time=0.39034 
Train Epoch: 7 [23/250 2944/32000 (9%)] Loss: 8.80175 (QuantReg: 12.72493) QuantErr: 12.72493 batch_time=0.39019 
Train Epoch: 7 [34/250 4352/32000 (14%)] Loss: 7.14077 (QuantReg: 12.77327) QuantErr: 12.77327 batch_time=0.41771 
Train Epoch: 7 [45/250 5760/32000 (18%)] Loss: 8.18925 (QuantReg: 12.61812) QuantErr: 12.61812 batch_time=0.40032 
Train Epoch: 7 [56/250 7168/32000 (22%)] Loss: 8.00810 (QuantReg: 12.52519) QuantErr: 12.52519 batch_time=0.38909 
Train Epoch: 7 [67/250 8576/32000 (27%)] Loss: 10.02768 (QuantReg: 12.32197) QuantErr: 12.32197 batch_time=0.87404 
Train Epoch: 7 [78/250 9984/32000 (31%)] Loss: 9.60296 (QuantReg: 12.38981) QuantErr: 12.38981 batch_time=0.41573 
Train Epoch: 7 [89/250 11392/32000 (36%)] Loss: 8.98322 (QuantReg: 12.68363) QuantErr: 12.68363 batch_time=0.39168 
Train Epoch: 7 [100/250 12800/32000 (40%)] Loss: 9.22732 (QuantReg: 12.62011) QuantErr: 12.62011 batch_time=0.40233 
Train Epoch: 7 [111/250 14208/32000 (44%)] Loss: 8.25288 (QuantReg: 12.70265) QuantErr: 12.70265 batch_time=0.39643 
Train Epoch: 7 [122/250 15616/32000 (49%)] Loss: 9.21223 (QuantReg: 13.32178) QuantErr: 13.32178 batch_time=0.38735 
Train Epoch: 7 [133/250 17024/32000 (53%)] Loss: 9.01300 (QuantReg: 12.54767) QuantErr: 12.54767 batch_time=0.86999 
Train Epoch: 7 [144/250 18432/32000 (58%)] Loss: 10.20812 (QuantReg: 12.53410) QuantErr: 12.53410 batch_time=3.93220 
Train Epoch: 7 [155/250 19840/32000 (62%)] Loss: 8.78574 (QuantReg: 12.67858) QuantErr: 12.67858 batch_time=0.40592 
Train Epoch: 7 [166/250 21248/32000 (66%)] Loss: 10.58719 (QuantReg: 12.87107) QuantErr: 12.87107 batch_time=0.41028 
Train Epoch: 7 [177/250 22656/32000 (71%)] Loss: 7.98877 (QuantReg: 12.99805) QuantErr: 12.99805 batch_time=1.28491 
Train Epoch: 7 [188/250 24064/32000 (75%)] Loss: 9.75777 (QuantReg: 13.01333) QuantErr: 13.01333 batch_time=0.41172 
Train Epoch: 7 [199/250 25472/32000 (80%)] Loss: 9.14436 (QuantReg: 12.91026) QuantErr: 12.91026 batch_time=0.39753 
Train Epoch: 7 [210/250 26880/32000 (84%)] Loss: 9.47043 (QuantReg: 12.86142) QuantErr: 12.86142 batch_time=0.40048 
Train Epoch: 7 [221/250 28288/32000 (88%)] Loss: 6.46658 (QuantReg: 12.80296) QuantErr: 12.80296 batch_time=0.38925 
Train Epoch: 7 [232/250 29696/32000 (93%)] Loss: 7.67534 (QuantReg: 12.66438) QuantErr: 12.66438 batch_time=0.39002 
Train Epoch: 7 [243/250 31104/32000 (97%)] Loss: 7.83017 (QuantReg: 13.34122) QuantErr: 13.34122 batch_time=0.41926 
Train Epoch: 7 codebook_update_time=0.44326
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch7.pth ...
Done in 23.292s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch7.pth ...
Done in 28.746s
removing stale ckpt [epoch 6] [took 0.01s]
 epoch          : 7
 loss           : 8.453279584884644
 quant_reg      : 12.749325252532959
 quant_err      : 12.749325252532959
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 1750
 MSRVTT_full_val/t2v_metrics/R1: 25.955734406438633
 MSRVTT_full_val/t2v_metrics/R5: 65.3923541247485
 MSRVTT_full_val/t2v_metrics/R10: 77.06237424547284
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.653923541247485
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 50.76147421038054
 MSRVTT_full_val/v2t_metrics/R1: 30.985915492957748
 MSRVTT_full_val/v2t_metrics/R5: 71.22736418511066
 MSRVTT_full_val/v2t_metrics/R10: 84.30583501006036
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.386317907444668
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 57.08950532139273
 MSRVTT_full_test/t2v_metrics/R1: 10.0
 MSRVTT_full_test/t2v_metrics/R5: 30.100334448160535
 MSRVTT_full_test/t2v_metrics/R10: 44.414715719063544
 MSRVTT_full_test/t2v_metrics/R50: 77.85953177257525
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.25484949832776
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.733733926204522
 MSRVTT_full_test/v2t_metrics/R1: 11.77257525083612
 MSRVTT_full_test/v2t_metrics/R5: 34.71571906354515
 MSRVTT_full_test/v2t_metrics/R10: 50.43478260869565
 MSRVTT_full_test/v2t_metrics/R50: 82.6086956521739
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 37.76672240802676
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 27.418430928992212
 mnt_best       : 23.733733926204522
 not_improved_count: 0
Train Epoch: 8 [1/250 128/32000 (0%)] Loss: 7.77085 (QuantReg: 12.62397) QuantErr: 12.62397 batch_time=35.98919 
Train Epoch: 8 [12/250 1536/32000 (5%)] Loss: 7.84460 (QuantReg: 12.77481) QuantErr: 12.77481 batch_time=3.88137 
Train Epoch: 8 [23/250 2944/32000 (9%)] Loss: 7.95860 (QuantReg: 12.72100) QuantErr: 12.72100 batch_time=0.43437 
Train Epoch: 8 [34/250 4352/32000 (14%)] Loss: 7.96348 (QuantReg: 12.93909) QuantErr: 12.93909 batch_time=0.40958 
Train Epoch: 8 [45/250 5760/32000 (18%)] Loss: 8.34936 (QuantReg: 12.31043) QuantErr: 12.31043 batch_time=0.40208 
Train Epoch: 8 [56/250 7168/32000 (22%)] Loss: 10.07245 (QuantReg: 12.70868) QuantErr: 12.70868 batch_time=0.39119 
Train Epoch: 8 [67/250 8576/32000 (27%)] Loss: 7.29999 (QuantReg: 12.97077) QuantErr: 12.97077 batch_time=0.88919 
Train Epoch: 8 [78/250 9984/32000 (31%)] Loss: 7.17147 (QuantReg: 13.05650) QuantErr: 13.05650 batch_time=0.41031 
Train Epoch: 8 [89/250 11392/32000 (36%)] Loss: 8.02314 (QuantReg: 12.79714) QuantErr: 12.79714 batch_time=0.38622 
Train Epoch: 8 [100/250 12800/32000 (40%)] Loss: 9.47398 (QuantReg: 12.66828) QuantErr: 12.66828 batch_time=0.41679 
Train Epoch: 8 [111/250 14208/32000 (44%)] Loss: 7.32817 (QuantReg: 12.63902) QuantErr: 12.63902 batch_time=0.43747 
Train Epoch: 8 [122/250 15616/32000 (49%)] Loss: 8.14139 (QuantReg: 12.63560) QuantErr: 12.63560 batch_time=0.39229 
Train Epoch: 8 [133/250 17024/32000 (53%)] Loss: 7.50104 (QuantReg: 12.88100) QuantErr: 12.88100 batch_time=0.38892 
Train Epoch: 8 [144/250 18432/32000 (58%)] Loss: 8.35529 (QuantReg: 12.86603) QuantErr: 12.86603 batch_time=0.38656 
Train Epoch: 8 [155/250 19840/32000 (62%)] Loss: 8.25439 (QuantReg: 12.91891) QuantErr: 12.91891 batch_time=0.38637 
Train Epoch: 8 [166/250 21248/32000 (66%)] Loss: 7.80174 (QuantReg: 12.88395) QuantErr: 12.88395 batch_time=0.37852 
Train Epoch: 8 [177/250 22656/32000 (71%)] Loss: 7.39327 (QuantReg: 12.79852) QuantErr: 12.79852 batch_time=0.38701 
Train Epoch: 8 [188/250 24064/32000 (75%)] Loss: 7.97499 (QuantReg: 13.04577) QuantErr: 13.04577 batch_time=0.49721 
Train Epoch: 8 [199/250 25472/32000 (80%)] Loss: 8.02343 (QuantReg: 12.77414) QuantErr: 12.77414 batch_time=0.65214 
Train Epoch: 8 [210/250 26880/32000 (84%)] Loss: 8.49168 (QuantReg: 13.03554) QuantErr: 13.03554 batch_time=0.38956 
Train Epoch: 8 [221/250 28288/32000 (88%)] Loss: 6.56017 (QuantReg: 13.02319) QuantErr: 13.02319 batch_time=0.39408 
Train Epoch: 8 [232/250 29696/32000 (93%)] Loss: 6.27245 (QuantReg: 12.88964) QuantErr: 12.88964 batch_time=0.51133 
Train Epoch: 8 [243/250 31104/32000 (97%)] Loss: 7.89669 (QuantReg: 12.83150) QuantErr: 12.83150 batch_time=0.37989 
Train Epoch: 8 codebook_update_time=0.43742
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch8.pth ...
Done in 4.973s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch8.pth ...
Done in 9.499s
removing stale ckpt [epoch 7] [took 0.01s]
 epoch          : 8
 loss           : 7.951428991317749
 quant_reg      : 12.857873432159424
 quant_err      : 12.857873432159424
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.3762575452716295
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.0416536275967
 MSRVTT_full_val/v2t_metrics/R1: 34.40643863179074
 MSRVTT_full_val/v2t_metrics/R5: 72.63581488933602
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.400402414486922
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.344615953491285
 MSRVTT_full_test/t2v_metrics/R1: 11.73913043478261
 MSRVTT_full_test/t2v_metrics/R5: 33.07692307692308
 MSRVTT_full_test/t2v_metrics/R10: 46.65551839464883
 MSRVTT_full_test/t2v_metrics/R50: 79.53177257525084
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.226254180602005
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.263625894363518
 MSRVTT_full_test/v2t_metrics/R1: 12.54180602006689
 MSRVTT_full_test/v2t_metrics/R5: 37.22408026755853
 MSRVTT_full_test/v2t_metrics/R10: 52.240802675585286
 MSRVTT_full_test/v2t_metrics/R50: 84.08026755852843
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.966722408026754
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.999997839463767
 mnt_best       : 26.263625894363518
 not_improved_count: 0
Train Epoch: 9 [1/250 128/32000 (0%)] Loss: 7.90188 (QuantReg: 12.21461) QuantErr: 12.21461 batch_time=33.94872 
Train Epoch: 9 [12/250 1536/32000 (5%)] Loss: 7.45036 (QuantReg: 12.82357) QuantErr: 12.82357 batch_time=0.40623 
Train Epoch: 9 [23/250 2944/32000 (9%)] Loss: 9.07741 (QuantReg: 12.65688) QuantErr: 12.65688 batch_time=0.86161 
Train Epoch: 9 [34/250 4352/32000 (14%)] Loss: 9.19606 (QuantReg: 12.48086) QuantErr: 12.48086 batch_time=0.40207 
Train Epoch: 9 [45/250 5760/32000 (18%)] Loss: 8.13097 (QuantReg: 12.83492) QuantErr: 12.83492 batch_time=0.42307 
Train Epoch: 9 [56/250 7168/32000 (22%)] Loss: 7.64007 (QuantReg: 12.90901) QuantErr: 12.90901 batch_time=0.40732 
Train Epoch: 9 [67/250 8576/32000 (27%)] Loss: 8.79595 (QuantReg: 12.63868) QuantErr: 12.63868 batch_time=0.38274 
Train Epoch: 9 [78/250 9984/32000 (31%)] Loss: 8.65936 (QuantReg: 12.91586) QuantErr: 12.91586 batch_time=0.42374 
Train Epoch: 9 [89/250 11392/32000 (36%)] Loss: 5.73016 (QuantReg: 13.05623) QuantErr: 13.05623 batch_time=0.38571 
Train Epoch: 9 [100/250 12800/32000 (40%)] Loss: 5.45056 (QuantReg: 12.90577) QuantErr: 12.90577 batch_time=0.38909 
Train Epoch: 9 [111/250 14208/32000 (44%)] Loss: 7.83929 (QuantReg: 12.90291) QuantErr: 12.90291 batch_time=0.40576 
Train Epoch: 9 [122/250 15616/32000 (49%)] Loss: 7.33324 (QuantReg: 13.18076) QuantErr: 13.18076 batch_time=0.45138 
Train Epoch: 9 [133/250 17024/32000 (53%)] Loss: 7.00854 (QuantReg: 13.00811) QuantErr: 13.00811 batch_time=0.39830 
Train Epoch: 9 [144/250 18432/32000 (58%)] Loss: 8.07313 (QuantReg: 12.74189) QuantErr: 12.74189 batch_time=0.39638 
Train Epoch: 9 [155/250 19840/32000 (62%)] Loss: 8.69144 (QuantReg: 12.70936) QuantErr: 12.70936 batch_time=0.40620 
Train Epoch: 9 [166/250 21248/32000 (66%)] Loss: 7.46786 (QuantReg: 13.04775) QuantErr: 13.04775 batch_time=0.43484 
Train Epoch: 9 [177/250 22656/32000 (71%)] Loss: 7.65220 (QuantReg: 12.79992) QuantErr: 12.79992 batch_time=0.40724 
Train Epoch: 9 [188/250 24064/32000 (75%)] Loss: 6.56224 (QuantReg: 13.38867) QuantErr: 13.38867 batch_time=0.41008 
Train Epoch: 9 [199/250 25472/32000 (80%)] Loss: 8.11316 (QuantReg: 13.01414) QuantErr: 13.01414 batch_time=0.39649 
Train Epoch: 9 [210/250 26880/32000 (84%)] Loss: 7.43387 (QuantReg: 13.35576) QuantErr: 13.35576 batch_time=0.43687 
Train Epoch: 9 [221/250 28288/32000 (88%)] Loss: 6.39862 (QuantReg: 12.99770) QuantErr: 12.99770 batch_time=0.42895 
Train Epoch: 9 [232/250 29696/32000 (93%)] Loss: 6.57992 (QuantReg: 13.19323) QuantErr: 13.19323 batch_time=0.82066 
Train Epoch: 9 [243/250 31104/32000 (97%)] Loss: 7.72266 (QuantReg: 12.84375) QuantErr: 12.84375 batch_time=0.40006 
Train Epoch: 9 codebook_update_time=0.47202
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch9.pth ...
Done in 6.201s
removing stale ckpt [epoch 8] [took 0.00s]
 epoch          : 9
 loss           : 7.485374895095825
 quant_reg      : 12.91818058013916
 quant_err      : 12.91818058013916
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 2250
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 79.07444668008048
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.476861167002012
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.230990787251386
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 73.2394366197183
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 96.98189134808852
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.696177062374246
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.146761957741035
 MSRVTT_full_test/t2v_metrics/R1: 10.635451505016722
 MSRVTT_full_test/t2v_metrics/R5: 30.93645484949833
 MSRVTT_full_test/t2v_metrics/R10: 44.34782608695652
 MSRVTT_full_test/t2v_metrics/R50: 77.123745819398
 MSRVTT_full_test/t2v_metrics/MedR: 14.0
 MSRVTT_full_test/t2v_metrics/MeanR: 49.718060200668894
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.436158716293466
 MSRVTT_full_test/v2t_metrics/R1: 12.274247491638796
 MSRVTT_full_test/v2t_metrics/R5: 37.09030100334448
 MSRVTT_full_test/v2t_metrics/R10: 52.10702341137124
 MSRVTT_full_test/v2t_metrics/R50: 83.04347826086956
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 37.61705685618729
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.733189223012765
 mnt_best       : 26.263625894363518
 not_improved_count: 1
Train Epoch: 10 [1/250 128/32000 (0%)] Loss: 7.98403 (QuantReg: 12.60446) QuantErr: 12.60446 batch_time=40.89091 
Train Epoch: 10 [12/250 1536/32000 (5%)] Loss: 5.59983 (QuantReg: 12.88146) QuantErr: 12.88146 batch_time=0.40159 
Train Epoch: 10 [23/250 2944/32000 (9%)] Loss: 6.01090 (QuantReg: 12.57000) QuantErr: 12.57000 batch_time=0.41146 
Train Epoch: 10 [34/250 4352/32000 (14%)] Loss: 7.03343 (QuantReg: 12.43331) QuantErr: 12.43331 batch_time=0.40208 
Train Epoch: 10 [45/250 5760/32000 (18%)] Loss: 6.54912 (QuantReg: 13.18118) QuantErr: 13.18118 batch_time=0.39277 
Train Epoch: 10 [56/250 7168/32000 (22%)] Loss: 7.24209 (QuantReg: 12.55242) QuantErr: 12.55242 batch_time=0.39532 
Train Epoch: 10 [67/250 8576/32000 (27%)] Loss: 7.26451 (QuantReg: 12.76284) QuantErr: 12.76284 batch_time=3.97019 
Train Epoch: 10 [78/250 9984/32000 (31%)] Loss: 9.00258 (QuantReg: 13.09462) QuantErr: 13.09462 batch_time=0.39924 
Train Epoch: 10 [89/250 11392/32000 (36%)] Loss: 6.45661 (QuantReg: 12.84941) QuantErr: 12.84941 batch_time=0.39955 
Train Epoch: 10 [100/250 12800/32000 (40%)] Loss: 7.56940 (QuantReg: 12.94000) QuantErr: 12.94000 batch_time=0.41848 
Train Epoch: 10 [111/250 14208/32000 (44%)] Loss: 7.05272 (QuantReg: 12.77451) QuantErr: 12.77451 batch_time=0.42658 
Train Epoch: 10 [122/250 15616/32000 (49%)] Loss: 7.97122 (QuantReg: 13.13860) QuantErr: 13.13860 batch_time=0.40495 
Train Epoch: 10 [133/250 17024/32000 (53%)] Loss: 7.65662 (QuantReg: 12.48341) QuantErr: 12.48341 batch_time=0.38709 
Train Epoch: 10 [144/250 18432/32000 (58%)] Loss: 8.24879 (QuantReg: 12.94026) QuantErr: 12.94026 batch_time=0.41240 
Train Epoch: 10 [155/250 19840/32000 (62%)] Loss: 5.50606 (QuantReg: 13.36690) QuantErr: 13.36690 batch_time=0.45775 
Train Epoch: 10 [166/250 21248/32000 (66%)] Loss: 8.81540 (QuantReg: 13.01651) QuantErr: 13.01651 batch_time=0.42619 
Train Epoch: 10 [177/250 22656/32000 (71%)] Loss: 7.37475 (QuantReg: 13.05726) QuantErr: 13.05726 batch_time=0.39893 
Train Epoch: 10 [188/250 24064/32000 (75%)] Loss: 6.77784 (QuantReg: 13.40046) QuantErr: 13.40046 batch_time=0.41343 
Train Epoch: 10 [199/250 25472/32000 (80%)] Loss: 5.71620 (QuantReg: 12.92500) QuantErr: 12.92500 batch_time=0.39068 
Train Epoch: 10 [210/250 26880/32000 (84%)] Loss: 6.64957 (QuantReg: 12.80534) QuantErr: 12.80534 batch_time=0.41392 
Train Epoch: 10 [221/250 28288/32000 (88%)] Loss: 6.41110 (QuantReg: 12.99695) QuantErr: 12.99695 batch_time=0.41056 
Train Epoch: 10 [232/250 29696/32000 (93%)] Loss: 5.97659 (QuantReg: 13.09880) QuantErr: 13.09880 batch_time=0.40393 
Train Epoch: 10 [243/250 31104/32000 (97%)] Loss: 6.27055 (QuantReg: 13.14175) QuantErr: 13.14175 batch_time=0.40262 
Train Epoch: 10 codebook_update_time=0.48303
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch10.pth ...
Done in 4.147s
removing stale ckpt [epoch 9] [took 0.08s]
 epoch          : 10
 loss           : 7.067066215515137
 quant_reg      : 12.944038570404052
 quant_err      : 12.944038570404052
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 67.6056338028169
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.13682092555332
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.97404629737407
 MSRVTT_full_val/v2t_metrics/R1: 35.010060362173036
 MSRVTT_full_val/v2t_metrics/R5: 74.24547283702213
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.575452716297787
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.85943359132971
 MSRVTT_full_test/t2v_metrics/R1: 11.270903010033445
 MSRVTT_full_test/t2v_metrics/R5: 33.11036789297659
 MSRVTT_full_test/t2v_metrics/R10: 46.65551839464883
 MSRVTT_full_test/t2v_metrics/R50: 79.6989966555184
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.46622073578595
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.918423352448595
 MSRVTT_full_test/v2t_metrics/R1: 13.177257525083611
 MSRVTT_full_test/v2t_metrics/R5: 38.46153846153846
 MSRVTT_full_test/v2t_metrics/R10: 53.37792642140468
 MSRVTT_full_test/v2t_metrics/R50: 83.7123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.52625418060201
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.0195696049355
 mnt_best       : 26.263625894363518
 not_improved_count: 2
Train Epoch: 11 [1/250 128/32000 (0%)] Loss: 5.97322 (QuantReg: 12.89840) QuantErr: 12.89840 batch_time=33.75825 
Train Epoch: 11 [12/250 1536/32000 (5%)] Loss: 7.75796 (QuantReg: 12.64964) QuantErr: 12.64964 batch_time=0.40631 
Train Epoch: 11 [23/250 2944/32000 (9%)] Loss: 6.99095 (QuantReg: 12.75397) QuantErr: 12.75397 batch_time=0.70024 
Train Epoch: 11 [34/250 4352/32000 (14%)] Loss: 7.59066 (QuantReg: 12.31626) QuantErr: 12.31626 batch_time=0.39682 
Train Epoch: 11 [45/250 5760/32000 (18%)] Loss: 8.31740 (QuantReg: 12.84676) QuantErr: 12.84676 batch_time=0.47748 
Train Epoch: 11 [56/250 7168/32000 (22%)] Loss: 5.35719 (QuantReg: 12.78331) QuantErr: 12.78331 batch_time=0.39768 
Train Epoch: 11 [67/250 8576/32000 (27%)] Loss: 6.87802 (QuantReg: 13.08679) QuantErr: 13.08679 batch_time=0.97696 
Train Epoch: 11 [78/250 9984/32000 (31%)] Loss: 6.91077 (QuantReg: 12.85339) QuantErr: 12.85339 batch_time=0.39743 
Train Epoch: 11 [89/250 11392/32000 (36%)] Loss: 6.14752 (QuantReg: 13.03632) QuantErr: 13.03632 batch_time=0.40795 
Train Epoch: 11 [100/250 12800/32000 (40%)] Loss: 6.53312 (QuantReg: 12.93784) QuantErr: 12.93784 batch_time=0.39319 
Train Epoch: 11 [111/250 14208/32000 (44%)] Loss: 7.94156 (QuantReg: 13.05040) QuantErr: 13.05040 batch_time=0.40978 
Train Epoch: 11 [122/250 15616/32000 (49%)] Loss: 7.82302 (QuantReg: 12.93157) QuantErr: 12.93157 batch_time=0.54079 
Train Epoch: 11 [133/250 17024/32000 (53%)] Loss: 7.24476 (QuantReg: 12.85083) QuantErr: 12.85083 batch_time=0.40476 
Train Epoch: 11 [144/250 18432/32000 (58%)] Loss: 7.55065 (QuantReg: 13.01783) QuantErr: 13.01783 batch_time=0.39842 
Train Epoch: 11 [155/250 19840/32000 (62%)] Loss: 7.68376 (QuantReg: 12.90526) QuantErr: 12.90526 batch_time=0.41358 
Train Epoch: 11 [166/250 21248/32000 (66%)] Loss: 6.43544 (QuantReg: 13.05480) QuantErr: 13.05480 batch_time=0.44016 
Train Epoch: 11 [177/250 22656/32000 (71%)] Loss: 7.44890 (QuantReg: 12.92042) QuantErr: 12.92042 batch_time=0.41245 
Train Epoch: 11 [188/250 24064/32000 (75%)] Loss: 8.33270 (QuantReg: 12.99202) QuantErr: 12.99202 batch_time=0.45523 
Train Epoch: 11 [199/250 25472/32000 (80%)] Loss: 6.93947 (QuantReg: 12.88988) QuantErr: 12.88988 batch_time=0.42757 
Train Epoch: 11 [210/250 26880/32000 (84%)] Loss: 7.53977 (QuantReg: 12.87202) QuantErr: 12.87202 batch_time=1.94035 
Train Epoch: 11 [221/250 28288/32000 (88%)] Loss: 5.61969 (QuantReg: 13.30184) QuantErr: 13.30184 batch_time=0.40815 
Train Epoch: 11 [232/250 29696/32000 (93%)] Loss: 4.46524 (QuantReg: 13.02108) QuantErr: 13.02108 batch_time=0.41581 
Train Epoch: 11 [243/250 31104/32000 (97%)] Loss: 6.45186 (QuantReg: 13.33990) QuantErr: 13.33990 batch_time=0.53739 
Train Epoch: 11 codebook_update_time=0.41068
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch11.pth ...
Done in 4.708s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 6.784471035003662
 quant_reg      : 12.957321010589599
 quant_err      : 12.957321010589599
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 2750
 MSRVTT_full_val/t2v_metrics/R1: 27.364185110663986
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 78.06841046277665
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.661971830985916
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.20472597988572
 MSRVTT_full_val/v2t_metrics/R1: 34.20523138832998
 MSRVTT_full_val/v2t_metrics/R5: 73.64185110663983
 MSRVTT_full_val/v2t_metrics/R10: 84.90945674044265
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.26056338028169
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.80320100609537
 MSRVTT_full_test/t2v_metrics/R1: 10.602006688963211
 MSRVTT_full_test/t2v_metrics/R5: 31.705685618729095
 MSRVTT_full_test/t2v_metrics/R10: 44.64882943143812
 MSRVTT_full_test/t2v_metrics/R50: 77.45819397993311
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.303177257525086
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.666740602385552
 MSRVTT_full_test/v2t_metrics/R1: 11.906354515050166
 MSRVTT_full_test/v2t_metrics/R5: 36.88963210702341
 MSRVTT_full_test/v2t_metrics/R10: 51.438127090301
 MSRVTT_full_test/v2t_metrics/R50: 83.24414715719064
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 38.42040133779264
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.26980158171471
 mnt_best       : 26.263625894363518
 not_improved_count: 3
Train Epoch: 12 [1/250 128/32000 (0%)] Loss: 6.88349 (QuantReg: 12.87817) QuantErr: 12.87817 batch_time=33.93579 
Train Epoch: 12 [12/250 1536/32000 (5%)] Loss: 9.04668 (QuantReg: 12.60923) QuantErr: 12.60923 batch_time=0.73745 
Train Epoch: 12 [23/250 2944/32000 (9%)] Loss: 7.07218 (QuantReg: 12.85329) QuantErr: 12.85329 batch_time=0.39877 
Train Epoch: 12 [34/250 4352/32000 (14%)] Loss: 6.52361 (QuantReg: 12.99038) QuantErr: 12.99038 batch_time=0.40247 
Train Epoch: 12 [45/250 5760/32000 (18%)] Loss: 6.41294 (QuantReg: 12.98804) QuantErr: 12.98804 batch_time=0.39893 
Train Epoch: 12 [56/250 7168/32000 (22%)] Loss: 6.66519 (QuantReg: 12.72920) QuantErr: 12.72920 batch_time=0.40051 
Train Epoch: 12 [67/250 8576/32000 (27%)] Loss: 7.31886 (QuantReg: 12.73151) QuantErr: 12.73151 batch_time=0.41091 
Train Epoch: 12 [78/250 9984/32000 (31%)] Loss: 6.49320 (QuantReg: 13.24494) QuantErr: 13.24494 batch_time=0.41158 
Train Epoch: 12 [89/250 11392/32000 (36%)] Loss: 7.25924 (QuantReg: 12.81208) QuantErr: 12.81208 batch_time=0.40026 
Train Epoch: 12 [100/250 12800/32000 (40%)] Loss: 6.64161 (QuantReg: 12.53743) QuantErr: 12.53743 batch_time=0.40431 
Train Epoch: 12 [111/250 14208/32000 (44%)] Loss: 5.63496 (QuantReg: 12.72746) QuantErr: 12.72746 batch_time=0.40267 
Train Epoch: 12 [122/250 15616/32000 (49%)] Loss: 6.44168 (QuantReg: 12.67121) QuantErr: 12.67121 batch_time=0.39304 
Train Epoch: 12 [133/250 17024/32000 (53%)] Loss: 6.54852 (QuantReg: 12.81329) QuantErr: 12.81329 batch_time=0.40304 
Train Epoch: 12 [144/250 18432/32000 (58%)] Loss: 7.20043 (QuantReg: 13.04055) QuantErr: 13.04055 batch_time=1.05292 
Train Epoch: 12 [155/250 19840/32000 (62%)] Loss: 5.04929 (QuantReg: 13.12038) QuantErr: 13.12038 batch_time=0.42337 
Train Epoch: 12 [166/250 21248/32000 (66%)] Loss: 6.78187 (QuantReg: 13.00866) QuantErr: 13.00866 batch_time=0.42333 
Train Epoch: 12 [177/250 22656/32000 (71%)] Loss: 6.46314 (QuantReg: 12.86598) QuantErr: 12.86598 batch_time=0.42986 
Train Epoch: 12 [188/250 24064/32000 (75%)] Loss: 6.35378 (QuantReg: 13.01974) QuantErr: 13.01974 batch_time=0.65107 
Train Epoch: 12 [199/250 25472/32000 (80%)] Loss: 6.32099 (QuantReg: 13.14989) QuantErr: 13.14989 batch_time=0.40321 
Train Epoch: 12 [210/250 26880/32000 (84%)] Loss: 6.65861 (QuantReg: 13.05977) QuantErr: 13.05977 batch_time=0.40797 
Train Epoch: 12 [221/250 28288/32000 (88%)] Loss: 7.01458 (QuantReg: 12.88423) QuantErr: 12.88423 batch_time=0.39717 
Train Epoch: 12 [232/250 29696/32000 (93%)] Loss: 5.80835 (QuantReg: 13.37851) QuantErr: 13.37851 batch_time=0.39912 
Train Epoch: 12 [243/250 31104/32000 (97%)] Loss: 6.52368 (QuantReg: 13.18763) QuantErr: 13.18763 batch_time=0.40213 
Train Epoch: 12 codebook_update_time=0.45854
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch12.pth ...
Done in 4.348s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch12.pth ...
Done in 8.341s
removing stale ckpt [epoch 11] [took 0.00s]
 epoch          : 12
 loss           : 6.466595821380615
 quant_reg      : 12.961618785858155
 quant_err      : 12.961618785858155
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 66.80080482897384
 MSRVTT_full_val/t2v_metrics/R10: 79.87927565392354
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.29979879275654
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.04898566387895
 MSRVTT_full_val/v2t_metrics/R1: 33.80281690140845
 MSRVTT_full_val/v2t_metrics/R5: 73.8430583501006
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.479879275653923
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.13555987643377
 MSRVTT_full_test/t2v_metrics/R1: 11.906354515050166
 MSRVTT_full_test/t2v_metrics/R5: 35.01672240802676
 MSRVTT_full_test/t2v_metrics/R10: 48.49498327759197
 MSRVTT_full_test/t2v_metrics/R50: 80.33444816053512
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.12441471571906
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.24271407549861
 MSRVTT_full_test/v2t_metrics/R1: 13.74581939799331
 MSRVTT_full_test/v2t_metrics/R5: 40.802675585284284
 MSRVTT_full_test/v2t_metrics/R10: 55.88628762541806
 MSRVTT_full_test/v2t_metrics/R50: 84.61538461538461
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.10351170568562
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.52982152975473
 mnt_best       : 27.24271407549861
 not_improved_count: 0
Train Epoch: 13 [1/250 128/32000 (0%)] Loss: 4.96877 (QuantReg: 13.09289) QuantErr: 13.09289 batch_time=36.51606 
Train Epoch: 13 [12/250 1536/32000 (5%)] Loss: 7.11337 (QuantReg: 13.26767) QuantErr: 13.26767 batch_time=0.40671 
Train Epoch: 13 [23/250 2944/32000 (9%)] Loss: 6.92568 (QuantReg: 13.14144) QuantErr: 13.14144 batch_time=0.40647 
Train Epoch: 13 [34/250 4352/32000 (14%)] Loss: 5.87298 (QuantReg: 12.55634) QuantErr: 12.55634 batch_time=0.39917 
Train Epoch: 13 [45/250 5760/32000 (18%)] Loss: 5.81412 (QuantReg: 13.21790) QuantErr: 13.21790 batch_time=0.86490 
Train Epoch: 13 [56/250 7168/32000 (22%)] Loss: 5.69225 (QuantReg: 13.18446) QuantErr: 13.18446 batch_time=0.42245 
Train Epoch: 13 [67/250 8576/32000 (27%)] Loss: 6.26741 (QuantReg: 12.78940) QuantErr: 12.78940 batch_time=3.23524 
Train Epoch: 13 [78/250 9984/32000 (31%)] Loss: 6.85882 (QuantReg: 12.91873) QuantErr: 12.91873 batch_time=0.39819 
Train Epoch: 13 [89/250 11392/32000 (36%)] Loss: 6.87634 (QuantReg: 13.11733) QuantErr: 13.11733 batch_time=0.38600 
Train Epoch: 13 [100/250 12800/32000 (40%)] Loss: 5.00557 (QuantReg: 12.83521) QuantErr: 12.83521 batch_time=0.40059 
Train Epoch: 13 [111/250 14208/32000 (44%)] Loss: 5.20763 (QuantReg: 12.96992) QuantErr: 12.96992 batch_time=0.38828 
Train Epoch: 13 [122/250 15616/32000 (49%)] Loss: 7.29963 (QuantReg: 12.75923) QuantErr: 12.75923 batch_time=0.40826 
Train Epoch: 13 [133/250 17024/32000 (53%)] Loss: 5.64597 (QuantReg: 13.21129) QuantErr: 13.21129 batch_time=0.38984 
Train Epoch: 13 [144/250 18432/32000 (58%)] Loss: 7.71781 (QuantReg: 12.51776) QuantErr: 12.51776 batch_time=1.39111 
Train Epoch: 13 [155/250 19840/32000 (62%)] Loss: 6.18323 (QuantReg: 13.01869) QuantErr: 13.01869 batch_time=0.39268 
Train Epoch: 13 [166/250 21248/32000 (66%)] Loss: 4.67523 (QuantReg: 13.10538) QuantErr: 13.10538 batch_time=0.40580 
Train Epoch: 13 [177/250 22656/32000 (71%)] Loss: 6.49612 (QuantReg: 13.28518) QuantErr: 13.28518 batch_time=0.39010 
Train Epoch: 13 [188/250 24064/32000 (75%)] Loss: 6.95741 (QuantReg: 13.41383) QuantErr: 13.41383 batch_time=0.40046 
Train Epoch: 13 [199/250 25472/32000 (80%)] Loss: 6.00491 (QuantReg: 13.13482) QuantErr: 13.13482 batch_time=0.40064 
Train Epoch: 13 [210/250 26880/32000 (84%)] Loss: 5.56747 (QuantReg: 13.14117) QuantErr: 13.14117 batch_time=1.50270 
Train Epoch: 13 [221/250 28288/32000 (88%)] Loss: 5.51672 (QuantReg: 13.29762) QuantErr: 13.29762 batch_time=0.38699 
Train Epoch: 13 [232/250 29696/32000 (93%)] Loss: 6.74762 (QuantReg: 13.10607) QuantErr: 13.10607 batch_time=0.39875 
Train Epoch: 13 [243/250 31104/32000 (97%)] Loss: 5.89857 (QuantReg: 13.17221) QuantErr: 13.17221 batch_time=0.41561 
Train Epoch: 13 codebook_update_time=0.50943
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch13.pth ...
Done in 5.124s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 6.254003549575805
 quant_reg      : 13.042649738311768
 quant_err      : 13.042649738311768
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 3250
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 67.20321931589537
 MSRVTT_full_val/t2v_metrics/R10: 78.67203219315896
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.895372233400402
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.303216881138894
 MSRVTT_full_val/v2t_metrics/R1: 34.80885311871227
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.0321931589537225
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.65605254975875
 MSRVTT_full_test/t2v_metrics/R1: 10.76923076923077
 MSRVTT_full_test/t2v_metrics/R5: 32.97658862876254
 MSRVTT_full_test/t2v_metrics/R10: 46.58862876254181
 MSRVTT_full_test/t2v_metrics/R50: 79.96655518394648
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.11939799331104
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.481409428021863
 MSRVTT_full_test/v2t_metrics/R1: 14.214046822742475
 MSRVTT_full_test/v2t_metrics/R5: 39.531772575250834
 MSRVTT_full_test/v2t_metrics/R10: 53.812709030100336
 MSRVTT_full_test/v2t_metrics/R50: 84.64882943143813
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.058528428093645
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.154177879252117
 mnt_best       : 27.24271407549861
 not_improved_count: 1
Train Epoch: 14 [1/250 128/32000 (0%)] Loss: 7.21242 (QuantReg: 13.00114) QuantErr: 13.00114 batch_time=36.55609 
Train Epoch: 14 [12/250 1536/32000 (5%)] Loss: 7.30973 (QuantReg: 13.01889) QuantErr: 13.01889 batch_time=0.40517 
Train Epoch: 14 [23/250 2944/32000 (9%)] Loss: 6.95847 (QuantReg: 12.90530) QuantErr: 12.90530 batch_time=0.42026 
Train Epoch: 14 [34/250 4352/32000 (14%)] Loss: 5.99214 (QuantReg: 12.73302) QuantErr: 12.73302 batch_time=0.42588 
Train Epoch: 14 [45/250 5760/32000 (18%)] Loss: 6.25416 (QuantReg: 12.86175) QuantErr: 12.86175 batch_time=0.42033 
Train Epoch: 14 [56/250 7168/32000 (22%)] Loss: 6.42371 (QuantReg: 12.87835) QuantErr: 12.87835 batch_time=0.42375 
Train Epoch: 14 [67/250 8576/32000 (27%)] Loss: 6.25424 (QuantReg: 13.07035) QuantErr: 13.07035 batch_time=0.45410 
Train Epoch: 14 [78/250 9984/32000 (31%)] Loss: 7.29057 (QuantReg: 12.67962) QuantErr: 12.67962 batch_time=0.41853 
Train Epoch: 14 [89/250 11392/32000 (36%)] Loss: 4.71089 (QuantReg: 13.09335) QuantErr: 13.09335 batch_time=0.41357 
Train Epoch: 14 [100/250 12800/32000 (40%)] Loss: 5.09835 (QuantReg: 12.77695) QuantErr: 12.77695 batch_time=0.40002 
Train Epoch: 14 [111/250 14208/32000 (44%)] Loss: 6.55493 (QuantReg: 12.96231) QuantErr: 12.96231 batch_time=0.40689 
Train Epoch: 14 [122/250 15616/32000 (49%)] Loss: 6.12961 (QuantReg: 13.06355) QuantErr: 13.06355 batch_time=0.39342 
Train Epoch: 14 [133/250 17024/32000 (53%)] Loss: 6.43954 (QuantReg: 13.52666) QuantErr: 13.52666 batch_time=0.41184 
Train Epoch: 14 [144/250 18432/32000 (58%)] Loss: 5.92646 (QuantReg: 13.31176) QuantErr: 13.31176 batch_time=0.41994 
Train Epoch: 14 [155/250 19840/32000 (62%)] Loss: 4.10043 (QuantReg: 13.27909) QuantErr: 13.27909 batch_time=0.39932 
Train Epoch: 14 [166/250 21248/32000 (66%)] Loss: 6.27578 (QuantReg: 12.95312) QuantErr: 12.95312 batch_time=1.06853 
Train Epoch: 14 [177/250 22656/32000 (71%)] Loss: 4.46029 (QuantReg: 13.17663) QuantErr: 13.17663 batch_time=0.39617 
Train Epoch: 14 [188/250 24064/32000 (75%)] Loss: 6.59735 (QuantReg: 12.86549) QuantErr: 12.86549 batch_time=0.38746 
Train Epoch: 14 [199/250 25472/32000 (80%)] Loss: 6.76525 (QuantReg: 13.07986) QuantErr: 13.07986 batch_time=0.40344 
Train Epoch: 14 [210/250 26880/32000 (84%)] Loss: 5.25296 (QuantReg: 13.02791) QuantErr: 13.02791 batch_time=1.44166 
Train Epoch: 14 [221/250 28288/32000 (88%)] Loss: 6.01355 (QuantReg: 13.13218) QuantErr: 13.13218 batch_time=0.39939 
Train Epoch: 14 [232/250 29696/32000 (93%)] Loss: 5.42980 (QuantReg: 12.76365) QuantErr: 12.76365 batch_time=0.95919 
Train Epoch: 14 [243/250 31104/32000 (97%)] Loss: 4.83278 (QuantReg: 13.19440) QuantErr: 13.19440 batch_time=0.44129 
Train Epoch: 14 codebook_update_time=0.44685
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch14.pth ...
Done in 3.752s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 6.036417518615723
 quant_reg      : 13.083238750457763
 quant_err      : 13.083238750457763
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.569416498993964
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.46162928638256
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 75.0503018108652
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.832997987927565
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.25776057338753
 MSRVTT_full_test/t2v_metrics/R1: 11.97324414715719
 MSRVTT_full_test/t2v_metrics/R5: 34.147157190635454
 MSRVTT_full_test/t2v_metrics/R10: 48.06020066889632
 MSRVTT_full_test/t2v_metrics/R50: 79.89966555183946
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.15652173913043
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.984683209137128
 MSRVTT_full_test/v2t_metrics/R1: 13.812709030100335
 MSRVTT_full_test/v2t_metrics/R5: 41.80602006688963
 MSRVTT_full_test/v2t_metrics/R10: 55.585284280936456
 MSRVTT_full_test/v2t_metrics/R50: 85.55183946488295
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.833444816053515
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.780386385253493
 mnt_best       : 27.24271407549861
 not_improved_count: 2
Train Epoch: 15 [1/250 128/32000 (0%)] Loss: 7.74913 (QuantReg: 12.57231) QuantErr: 12.57231 batch_time=30.06087 
Train Epoch: 15 [12/250 1536/32000 (5%)] Loss: 4.73178 (QuantReg: 13.23613) QuantErr: 13.23613 batch_time=0.44289 
Train Epoch: 15 [23/250 2944/32000 (9%)] Loss: 5.50698 (QuantReg: 12.95464) QuantErr: 12.95464 batch_time=0.42027 
Train Epoch: 15 [34/250 4352/32000 (14%)] Loss: 6.57769 (QuantReg: 12.80397) QuantErr: 12.80397 batch_time=0.53460 
Train Epoch: 15 [45/250 5760/32000 (18%)] Loss: 5.30353 (QuantReg: 13.23506) QuantErr: 13.23506 batch_time=0.40757 
Train Epoch: 15 [56/250 7168/32000 (22%)] Loss: 5.75007 (QuantReg: 12.90080) QuantErr: 12.90080 batch_time=0.40750 
Train Epoch: 15 [67/250 8576/32000 (27%)] Loss: 5.90563 (QuantReg: 13.07048) QuantErr: 13.07048 batch_time=0.40314 
Train Epoch: 15 [78/250 9984/32000 (31%)] Loss: 5.10818 (QuantReg: 12.98156) QuantErr: 12.98156 batch_time=0.40153 
Train Epoch: 15 [89/250 11392/32000 (36%)] Loss: 6.61573 (QuantReg: 13.04811) QuantErr: 13.04811 batch_time=0.41615 
Train Epoch: 15 [100/250 12800/32000 (40%)] Loss: 6.84640 (QuantReg: 13.04403) QuantErr: 13.04403 batch_time=0.41024 
Train Epoch: 15 [111/250 14208/32000 (44%)] Loss: 5.61115 (QuantReg: 12.94785) QuantErr: 12.94785 batch_time=0.41051 
Train Epoch: 15 [122/250 15616/32000 (49%)] Loss: 6.36905 (QuantReg: 13.30319) QuantErr: 13.30319 batch_time=0.41894 
Train Epoch: 15 [133/250 17024/32000 (53%)] Loss: 4.88896 (QuantReg: 12.83305) QuantErr: 12.83305 batch_time=0.39701 
Train Epoch: 15 [144/250 18432/32000 (58%)] Loss: 6.11091 (QuantReg: 13.24864) QuantErr: 13.24864 batch_time=0.40611 
Train Epoch: 15 [155/250 19840/32000 (62%)] Loss: 4.90399 (QuantReg: 13.36924) QuantErr: 13.36924 batch_time=0.47130 
Train Epoch: 15 [166/250 21248/32000 (66%)] Loss: 6.10574 (QuantReg: 13.15313) QuantErr: 13.15313 batch_time=0.40254 
Train Epoch: 15 [177/250 22656/32000 (71%)] Loss: 6.42347 (QuantReg: 13.12519) QuantErr: 13.12519 batch_time=0.41211 
Train Epoch: 15 [188/250 24064/32000 (75%)] Loss: 5.81926 (QuantReg: 13.31871) QuantErr: 13.31871 batch_time=0.41219 
Train Epoch: 15 [199/250 25472/32000 (80%)] Loss: 7.08675 (QuantReg: 12.72823) QuantErr: 12.72823 batch_time=0.43583 
Train Epoch: 15 [210/250 26880/32000 (84%)] Loss: 5.23602 (QuantReg: 13.53762) QuantErr: 13.53762 batch_time=0.39242 
Train Epoch: 15 [221/250 28288/32000 (88%)] Loss: 5.04547 (QuantReg: 13.25009) QuantErr: 13.25009 batch_time=0.41985 
Train Epoch: 15 [232/250 29696/32000 (93%)] Loss: 6.36019 (QuantReg: 12.92800) QuantErr: 12.92800 batch_time=0.40489 
Train Epoch: 15 [243/250 31104/32000 (97%)] Loss: 5.27257 (QuantReg: 12.97940) QuantErr: 12.97940 batch_time=0.41006 
Train Epoch: 15 codebook_update_time=0.41129
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch15.pth ...
Done in 16.249s
removing stale ckpt [epoch 14] [took 0.08s]
 epoch          : 15
 loss           : 5.770687482833862
 quant_reg      : 13.070415390014649
 quant_err      : 13.070415390014649
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 3750
 MSRVTT_full_val/t2v_metrics/R1: 30.58350100603622
 MSRVTT_full_val/t2v_metrics/R5: 67.40442655935614
 MSRVTT_full_val/t2v_metrics/R10: 79.67806841046277
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.613682092555333
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.765215998571094
 MSRVTT_full_val/v2t_metrics/R1: 36.61971830985915
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.824949698189135
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.42059686171331
 MSRVTT_full_test/t2v_metrics/R1: 11.672240802675585
 MSRVTT_full_test/t2v_metrics/R5: 33.84615384615385
 MSRVTT_full_test/t2v_metrics/R10: 48.02675585284281
 MSRVTT_full_test/t2v_metrics/R50: 78.96321070234114
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.27458193979933
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.671591943239342
 MSRVTT_full_test/v2t_metrics/R1: 14.51505016722408
 MSRVTT_full_test/v2t_metrics/R5: 41.070234113712374
 MSRVTT_full_test/v2t_metrics/R10: 55.618729096989966
 MSRVTT_full_test/v2t_metrics/R50: 85.35117056856187
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.26137123745819
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.1259214777672
 mnt_best       : 27.24271407549861
 not_improved_count: 3
Train Epoch: 16 [1/250 128/32000 (0%)] Loss: 6.29345 (QuantReg: 12.77841) QuantErr: 12.77841 batch_time=34.84146 
Train Epoch: 16 [12/250 1536/32000 (5%)] Loss: 7.04717 (QuantReg: 13.00570) QuantErr: 13.00570 batch_time=0.39747 
Train Epoch: 16 [23/250 2944/32000 (9%)] Loss: 4.49565 (QuantReg: 13.32831) QuantErr: 13.32831 batch_time=0.40512 
Train Epoch: 16 [34/250 4352/32000 (14%)] Loss: 7.39946 (QuantReg: 12.60719) QuantErr: 12.60719 batch_time=0.42247 
Train Epoch: 16 [45/250 5760/32000 (18%)] Loss: 4.76874 (QuantReg: 13.27135) QuantErr: 13.27135 batch_time=0.40093 
Train Epoch: 16 [56/250 7168/32000 (22%)] Loss: 5.47979 (QuantReg: 13.09699) QuantErr: 13.09699 batch_time=0.49481 
Train Epoch: 16 [67/250 8576/32000 (27%)] Loss: 6.98182 (QuantReg: 13.07392) QuantErr: 13.07392 batch_time=0.40624 
Train Epoch: 16 [78/250 9984/32000 (31%)] Loss: 6.18898 (QuantReg: 13.21198) QuantErr: 13.21198 batch_time=0.39149 
Train Epoch: 16 [89/250 11392/32000 (36%)] Loss: 5.41929 (QuantReg: 13.14443) QuantErr: 13.14443 batch_time=0.40302 
Train Epoch: 16 [100/250 12800/32000 (40%)] Loss: 4.42851 (QuantReg: 13.19623) QuantErr: 13.19623 batch_time=0.40504 
Train Epoch: 16 [111/250 14208/32000 (44%)] Loss: 4.94395 (QuantReg: 13.09795) QuantErr: 13.09795 batch_time=0.41538 
Train Epoch: 16 [122/250 15616/32000 (49%)] Loss: 5.09912 (QuantReg: 13.17821) QuantErr: 13.17821 batch_time=0.40365 
Train Epoch: 16 [133/250 17024/32000 (53%)] Loss: 4.77544 (QuantReg: 13.14241) QuantErr: 13.14241 batch_time=0.76848 
Train Epoch: 16 [144/250 18432/32000 (58%)] Loss: 5.39576 (QuantReg: 13.17804) QuantErr: 13.17804 batch_time=0.40957 
Train Epoch: 16 [155/250 19840/32000 (62%)] Loss: 5.39822 (QuantReg: 13.41227) QuantErr: 13.41227 batch_time=0.41836 
Train Epoch: 16 [166/250 21248/32000 (66%)] Loss: 5.59467 (QuantReg: 13.30151) QuantErr: 13.30151 batch_time=0.40396 
Train Epoch: 16 [177/250 22656/32000 (71%)] Loss: 5.76887 (QuantReg: 13.19814) QuantErr: 13.19814 batch_time=0.65595 
Train Epoch: 16 [188/250 24064/32000 (75%)] Loss: 6.55496 (QuantReg: 13.09735) QuantErr: 13.09735 batch_time=0.40051 
Train Epoch: 16 [199/250 25472/32000 (80%)] Loss: 5.87783 (QuantReg: 13.30300) QuantErr: 13.30300 batch_time=0.40709 
Train Epoch: 16 [210/250 26880/32000 (84%)] Loss: 6.34474 (QuantReg: 13.20755) QuantErr: 13.20755 batch_time=0.38420 
Train Epoch: 16 [221/250 28288/32000 (88%)] Loss: 4.59265 (QuantReg: 13.11652) QuantErr: 13.11652 batch_time=0.42788 
Train Epoch: 16 [232/250 29696/32000 (93%)] Loss: 5.61623 (QuantReg: 13.05751) QuantErr: 13.05751 batch_time=0.38943 
Train Epoch: 16 [243/250 31104/32000 (97%)] Loss: 5.16844 (QuantReg: 13.16400) QuantErr: 13.16400 batch_time=0.41244 
Train Epoch: 16 codebook_update_time=0.40890
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch16.pth ...
Done in 4.589s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 5.633476549148559
 quant_reg      : 13.138426452636718
 quant_err      : 13.138426452636718
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 79.67806841046277
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.843058350100604
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.141077849303926
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.9476861167002015
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.34052631256489
 MSRVTT_full_test/t2v_metrics/R1: 12.909698996655518
 MSRVTT_full_test/t2v_metrics/R5: 32.642140468227424
 MSRVTT_full_test/t2v_metrics/R10: 47.82608695652174
 MSRVTT_full_test/t2v_metrics/R50: 78.99665551839465
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.58996655518395
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.213633499156206
 MSRVTT_full_test/v2t_metrics/R1: 14.715719063545151
 MSRVTT_full_test/v2t_metrics/R5: 40.30100334448161
 MSRVTT_full_test/v2t_metrics/R10: 55.4180602006689
 MSRVTT_full_test/v2t_metrics/R50: 85.18394648829431
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.93913043478261
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.03191393734173
 mnt_best       : 27.24271407549861
 not_improved_count: 4
Train Epoch: 17 [1/250 128/32000 (0%)] Loss: 4.50463 (QuantReg: 13.09109) QuantErr: 13.09109 batch_time=39.97196 
Train Epoch: 17 [12/250 1536/32000 (5%)] Loss: 5.22531 (QuantReg: 12.41657) QuantErr: 12.41657 batch_time=0.40341 
Train Epoch: 17 [23/250 2944/32000 (9%)] Loss: 4.88340 (QuantReg: 13.23280) QuantErr: 13.23280 batch_time=0.39071 
Train Epoch: 17 [34/250 4352/32000 (14%)] Loss: 5.08186 (QuantReg: 12.90343) QuantErr: 12.90343 batch_time=0.39903 
Train Epoch: 17 [45/250 5760/32000 (18%)] Loss: 6.06937 (QuantReg: 13.16816) QuantErr: 13.16816 batch_time=0.40195 
Train Epoch: 17 [56/250 7168/32000 (22%)] Loss: 5.73154 (QuantReg: 13.25092) QuantErr: 13.25092 batch_time=0.39092 
Train Epoch: 17 [67/250 8576/32000 (27%)] Loss: 6.19287 (QuantReg: 13.01606) QuantErr: 13.01606 batch_time=3.19904 
Train Epoch: 17 [78/250 9984/32000 (31%)] Loss: 4.27557 (QuantReg: 13.14351) QuantErr: 13.14351 batch_time=0.38578 
Train Epoch: 17 [89/250 11392/32000 (36%)] Loss: 5.20593 (QuantReg: 13.12180) QuantErr: 13.12180 batch_time=0.40029 
Train Epoch: 17 [100/250 12800/32000 (40%)] Loss: 7.01194 (QuantReg: 12.93692) QuantErr: 12.93692 batch_time=0.40840 
Train Epoch: 17 [111/250 14208/32000 (44%)] Loss: 5.03411 (QuantReg: 12.96272) QuantErr: 12.96272 batch_time=0.38701 
Train Epoch: 17 [122/250 15616/32000 (49%)] Loss: 5.04215 (QuantReg: 13.46621) QuantErr: 13.46621 batch_time=0.39018 
Train Epoch: 17 [133/250 17024/32000 (53%)] Loss: 4.89364 (QuantReg: 12.91726) QuantErr: 12.91726 batch_time=0.41722 
Train Epoch: 17 [144/250 18432/32000 (58%)] Loss: 4.69542 (QuantReg: 13.31265) QuantErr: 13.31265 batch_time=0.39191 
Train Epoch: 17 [155/250 19840/32000 (62%)] Loss: 5.06698 (QuantReg: 13.17013) QuantErr: 13.17013 batch_time=0.39288 
Train Epoch: 17 [166/250 21248/32000 (66%)] Loss: 5.79005 (QuantReg: 13.03832) QuantErr: 13.03832 batch_time=0.39276 
Train Epoch: 17 [177/250 22656/32000 (71%)] Loss: 4.90166 (QuantReg: 13.38302) QuantErr: 13.38302 batch_time=0.40124 
Train Epoch: 17 [188/250 24064/32000 (75%)] Loss: 4.52375 (QuantReg: 13.15122) QuantErr: 13.15122 batch_time=0.40303 
Train Epoch: 17 [199/250 25472/32000 (80%)] Loss: 4.58617 (QuantReg: 13.34515) QuantErr: 13.34515 batch_time=0.39164 
Train Epoch: 17 [210/250 26880/32000 (84%)] Loss: 5.68631 (QuantReg: 13.28357) QuantErr: 13.28357 batch_time=0.39261 
Train Epoch: 17 [221/250 28288/32000 (88%)] Loss: 5.03146 (QuantReg: 13.37377) QuantErr: 13.37377 batch_time=0.38828 
Train Epoch: 17 [232/250 29696/32000 (93%)] Loss: 6.17724 (QuantReg: 13.08392) QuantErr: 13.08392 batch_time=0.44870 
Train Epoch: 17 [243/250 31104/32000 (97%)] Loss: 5.04713 (QuantReg: 13.05488) QuantErr: 13.05488 batch_time=0.42006 
Train Epoch: 17 codebook_update_time=0.48268
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch17.pth ...
Done in 3.942s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch17.pth ...
Done in 7.720s
removing stale ckpt [epoch 16] [took 0.00s]
 epoch          : 17
 loss           : 5.415340081214905
 quant_reg      : 13.13377038192749
 quant_err      : 13.13377038192749
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 4250
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.505030181086519
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.77324812000017
 MSRVTT_full_val/v2t_metrics/R1: 35.412474849094565
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.963782696177063
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.17374838183115
 MSRVTT_full_test/t2v_metrics/R1: 12.508361204013378
 MSRVTT_full_test/t2v_metrics/R5: 35.18394648829432
 MSRVTT_full_test/t2v_metrics/R10: 49.23076923076923
 MSRVTT_full_test/t2v_metrics/R50: 80.20066889632108
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.77224080267558
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.877930369094873
 MSRVTT_full_test/v2t_metrics/R1: 14.414715719063546
 MSRVTT_full_test/v2t_metrics/R5: 41.73913043478261
 MSRVTT_full_test/v2t_metrics/R10: 55.852842809364546
 MSRVTT_full_test/v2t_metrics/R50: 86.42140468227424
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.74665551839465
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.26994713169773
 mnt_best       : 27.877930369094873
 not_improved_count: 0
Train Epoch: 18 [1/250 128/32000 (0%)] Loss: 4.46892 (QuantReg: 12.92054) QuantErr: 12.92054 batch_time=37.28963 
Train Epoch: 18 [12/250 1536/32000 (5%)] Loss: 5.30812 (QuantReg: 12.96043) QuantErr: 12.96043 batch_time=0.39635 
Train Epoch: 18 [23/250 2944/32000 (9%)] Loss: 5.19672 (QuantReg: 13.19451) QuantErr: 13.19451 batch_time=0.38452 
Train Epoch: 18 [34/250 4352/32000 (14%)] Loss: 5.26814 (QuantReg: 13.28251) QuantErr: 13.28251 batch_time=0.43266 
Train Epoch: 18 [45/250 5760/32000 (18%)] Loss: 5.81527 (QuantReg: 13.25508) QuantErr: 13.25508 batch_time=0.39297 
Train Epoch: 18 [56/250 7168/32000 (22%)] Loss: 6.07337 (QuantReg: 13.21410) QuantErr: 13.21410 batch_time=0.42783 
Train Epoch: 18 [67/250 8576/32000 (27%)] Loss: 5.40108 (QuantReg: 13.34063) QuantErr: 13.34063 batch_time=0.39978 
Train Epoch: 18 [78/250 9984/32000 (31%)] Loss: 5.46874 (QuantReg: 12.98673) QuantErr: 12.98673 batch_time=0.39278 
Train Epoch: 18 [89/250 11392/32000 (36%)] Loss: 4.79860 (QuantReg: 13.13035) QuantErr: 13.13035 batch_time=0.40571 
Train Epoch: 18 [100/250 12800/32000 (40%)] Loss: 5.41796 (QuantReg: 13.28017) QuantErr: 13.28017 batch_time=0.39616 
Train Epoch: 18 [111/250 14208/32000 (44%)] Loss: 5.57172 (QuantReg: 13.07629) QuantErr: 13.07629 batch_time=0.51729 
Train Epoch: 18 [122/250 15616/32000 (49%)] Loss: 4.65024 (QuantReg: 13.11492) QuantErr: 13.11492 batch_time=0.38278 
Train Epoch: 18 [133/250 17024/32000 (53%)] Loss: 5.66317 (QuantReg: 13.50040) QuantErr: 13.50040 batch_time=0.40021 
Train Epoch: 18 [144/250 18432/32000 (58%)] Loss: 4.61506 (QuantReg: 13.25164) QuantErr: 13.25164 batch_time=0.42827 
Train Epoch: 18 [155/250 19840/32000 (62%)] Loss: 5.52813 (QuantReg: 13.27904) QuantErr: 13.27904 batch_time=0.38501 
Train Epoch: 18 [166/250 21248/32000 (66%)] Loss: 4.99871 (QuantReg: 13.18500) QuantErr: 13.18500 batch_time=0.39997 
Train Epoch: 18 [177/250 22656/32000 (71%)] Loss: 5.63142 (QuantReg: 13.14158) QuantErr: 13.14158 batch_time=0.42192 
Train Epoch: 18 [188/250 24064/32000 (75%)] Loss: 5.34582 (QuantReg: 13.17025) QuantErr: 13.17025 batch_time=0.77435 
Train Epoch: 18 [199/250 25472/32000 (80%)] Loss: 4.97669 (QuantReg: 13.04993) QuantErr: 13.04993 batch_time=0.41533 
Train Epoch: 18 [210/250 26880/32000 (84%)] Loss: 5.86482 (QuantReg: 13.06614) QuantErr: 13.06614 batch_time=0.42086 
Train Epoch: 18 [221/250 28288/32000 (88%)] Loss: 4.69130 (QuantReg: 13.20391) QuantErr: 13.20391 batch_time=0.39244 
Train Epoch: 18 [232/250 29696/32000 (93%)] Loss: 4.08400 (QuantReg: 13.55223) QuantErr: 13.55223 batch_time=0.93167 
Train Epoch: 18 [243/250 31104/32000 (97%)] Loss: 5.60967 (QuantReg: 13.22332) QuantErr: 13.22332 batch_time=0.40491 
Train Epoch: 18 codebook_update_time=0.45452
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch18.pth ...
Done in 4.065s
removing stale ckpt [epoch 17] [took 0.00s]
 epoch          : 18
 loss           : 5.19858872795105
 quant_reg      : 13.172630451202393
 quant_err      : 13.172630451202393
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 30.58350100603622
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.044265593561368
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.467065665219536
 MSRVTT_full_val/v2t_metrics/R1: 36.61971830985915
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.909456740442656
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.95429119792733
 MSRVTT_full_test/t2v_metrics/R1: 12.040133779264215
 MSRVTT_full_test/t2v_metrics/R5: 35.4180602006689
 MSRVTT_full_test/t2v_metrics/R10: 48.79598662207358
 MSRVTT_full_test/t2v_metrics/R50: 80.20066889632108
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.2061872909699
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.505110619851255
 MSRVTT_full_test/v2t_metrics/R1: 14.51505016722408
 MSRVTT_full_test/v2t_metrics/R5: 41.67224080267559
 MSRVTT_full_test/v2t_metrics/R10: 56.220735785953174
 MSRVTT_full_test/v2t_metrics/R50: 86.32107023411372
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.818729096989966
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.39818194954352
 mnt_best       : 27.877930369094873
 not_improved_count: 1
Train Epoch: 19 [1/250 128/32000 (0%)] Loss: 5.87414 (QuantReg: 12.83912) QuantErr: 12.83912 batch_time=41.53434 
Train Epoch: 19 [12/250 1536/32000 (5%)] Loss: 5.82330 (QuantReg: 12.87228) QuantErr: 12.87228 batch_time=0.38547 
Train Epoch: 19 [23/250 2944/32000 (9%)] Loss: 7.15230 (QuantReg: 13.12378) QuantErr: 13.12378 batch_time=0.38724 
Train Epoch: 19 [34/250 4352/32000 (14%)] Loss: 5.07914 (QuantReg: 13.35531) QuantErr: 13.35531 batch_time=0.38312 
Train Epoch: 19 [45/250 5760/32000 (18%)] Loss: 4.26676 (QuantReg: 13.24606) QuantErr: 13.24606 batch_time=0.38201 
Train Epoch: 19 [56/250 7168/32000 (22%)] Loss: 5.88015 (QuantReg: 12.90748) QuantErr: 12.90748 batch_time=0.41203 
Train Epoch: 19 [67/250 8576/32000 (27%)] Loss: 5.37589 (QuantReg: 13.32142) QuantErr: 13.32142 batch_time=0.71971 
Train Epoch: 19 [78/250 9984/32000 (31%)] Loss: 5.05156 (QuantReg: 13.21349) QuantErr: 13.21349 batch_time=0.41401 
Train Epoch: 19 [89/250 11392/32000 (36%)] Loss: 3.79677 (QuantReg: 13.37796) QuantErr: 13.37796 batch_time=0.37982 
Train Epoch: 19 [100/250 12800/32000 (40%)] Loss: 5.12288 (QuantReg: 13.22015) QuantErr: 13.22015 batch_time=0.40359 
Train Epoch: 19 [111/250 14208/32000 (44%)] Loss: 5.50944 (QuantReg: 13.34426) QuantErr: 13.34426 batch_time=0.38114 
Train Epoch: 19 [122/250 15616/32000 (49%)] Loss: 4.27664 (QuantReg: 13.45653) QuantErr: 13.45653 batch_time=0.37847 
Train Epoch: 19 [133/250 17024/32000 (53%)] Loss: 4.65293 (QuantReg: 13.13961) QuantErr: 13.13961 batch_time=0.40580 
Train Epoch: 19 [144/250 18432/32000 (58%)] Loss: 4.52453 (QuantReg: 12.98933) QuantErr: 12.98933 batch_time=0.41916 
Train Epoch: 19 [155/250 19840/32000 (62%)] Loss: 5.54048 (QuantReg: 13.29936) QuantErr: 13.29936 batch_time=0.40465 
Train Epoch: 19 [166/250 21248/32000 (66%)] Loss: 4.68196 (QuantReg: 13.40268) QuantErr: 13.40268 batch_time=0.38273 
Train Epoch: 19 [177/250 22656/32000 (71%)] Loss: 4.35738 (QuantReg: 13.38170) QuantErr: 13.38170 batch_time=0.37876 
Train Epoch: 19 [188/250 24064/32000 (75%)] Loss: 5.05846 (QuantReg: 13.26068) QuantErr: 13.26068 batch_time=0.38082 
Train Epoch: 19 [199/250 25472/32000 (80%)] Loss: 4.88095 (QuantReg: 13.30119) QuantErr: 13.30119 batch_time=0.40739 
Train Epoch: 19 [210/250 26880/32000 (84%)] Loss: 4.67516 (QuantReg: 13.57327) QuantErr: 13.57327 batch_time=1.17972 
Train Epoch: 19 [221/250 28288/32000 (88%)] Loss: 4.79607 (QuantReg: 13.28971) QuantErr: 13.28971 batch_time=0.37903 
Train Epoch: 19 [232/250 29696/32000 (93%)] Loss: 5.84106 (QuantReg: 13.19909) QuantErr: 13.19909 batch_time=0.40974 
Train Epoch: 19 [243/250 31104/32000 (97%)] Loss: 4.84683 (QuantReg: 13.25795) QuantErr: 13.25795 batch_time=0.38121 
Train Epoch: 19 codebook_update_time=0.45133
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch19.pth ...
Done in 4.073s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch19.pth ...
Done in 8.026s
removing stale ckpt [epoch 18] [took 0.02s]
 epoch          : 19
 loss           : 5.15193643283844
 quant_reg      : 13.190096057891846
 quant_err      : 13.190096057891846
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 4750
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.75251509054326
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.98108496437307
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.525150905432596
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.68516483115823
 MSRVTT_full_test/t2v_metrics/R1: 13.411371237458194
 MSRVTT_full_test/t2v_metrics/R5: 35.852842809364546
 MSRVTT_full_test/t2v_metrics/R10: 50.16722408026756
 MSRVTT_full_test/t2v_metrics/R50: 81.30434782608695
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.58428093645485
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.89386353893123
 MSRVTT_full_test/v2t_metrics/R1: 15.68561872909699
 MSRVTT_full_test/v2t_metrics/R5: 42.575250836120404
 MSRVTT_full_test/v2t_metrics/R10: 57.25752508361204
 MSRVTT_full_test/v2t_metrics/R50: 86.62207357859532
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.91839464882943
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.689700275553804
 mnt_best       : 28.89386353893123
 not_improved_count: 0
Train Epoch: 20 [1/250 128/32000 (0%)] Loss: 4.72088 (QuantReg: 13.22688) QuantErr: 13.22688 batch_time=32.90511 
Train Epoch: 20 [12/250 1536/32000 (5%)] Loss: 4.25988 (QuantReg: 13.05755) QuantErr: 13.05755 batch_time=0.45059 
Train Epoch: 20 [23/250 2944/32000 (9%)] Loss: 4.72761 (QuantReg: 12.88826) QuantErr: 12.88826 batch_time=0.40987 
Train Epoch: 20 [34/250 4352/32000 (14%)] Loss: 3.87992 (QuantReg: 12.89004) QuantErr: 12.89004 batch_time=0.42584 
Train Epoch: 20 [45/250 5760/32000 (18%)] Loss: 4.61746 (QuantReg: 13.19032) QuantErr: 13.19032 batch_time=0.40712 
Train Epoch: 20 [56/250 7168/32000 (22%)] Loss: 6.19374 (QuantReg: 12.98981) QuantErr: 12.98981 batch_time=0.41292 
Train Epoch: 20 [67/250 8576/32000 (27%)] Loss: 5.26899 (QuantReg: 13.27955) QuantErr: 13.27955 batch_time=3.82573 
Train Epoch: 20 [78/250 9984/32000 (31%)] Loss: 4.19234 (QuantReg: 13.25893) QuantErr: 13.25893 batch_time=0.39748 
Train Epoch: 20 [89/250 11392/32000 (36%)] Loss: 4.89473 (QuantReg: 12.92230) QuantErr: 12.92230 batch_time=0.40412 
Train Epoch: 20 [100/250 12800/32000 (40%)] Loss: 6.85543 (QuantReg: 13.05055) QuantErr: 13.05055 batch_time=0.42217 
Train Epoch: 20 [111/250 14208/32000 (44%)] Loss: 5.88890 (QuantReg: 13.14701) QuantErr: 13.14701 batch_time=0.40770 
Train Epoch: 20 [122/250 15616/32000 (49%)] Loss: 5.20670 (QuantReg: 13.49153) QuantErr: 13.49153 batch_time=0.40809 
Train Epoch: 20 [133/250 17024/32000 (53%)] Loss: 6.15278 (QuantReg: 12.86480) QuantErr: 12.86480 batch_time=0.43493 
Train Epoch: 20 [144/250 18432/32000 (58%)] Loss: 4.63730 (QuantReg: 13.32960) QuantErr: 13.32960 batch_time=0.40790 
Train Epoch: 20 [155/250 19840/32000 (62%)] Loss: 6.55887 (QuantReg: 12.49638) QuantErr: 12.49638 batch_time=0.39984 
Train Epoch: 20 [166/250 21248/32000 (66%)] Loss: 3.95840 (QuantReg: 13.33176) QuantErr: 13.33176 batch_time=0.40003 
Train Epoch: 20 [177/250 22656/32000 (71%)] Loss: 4.17884 (QuantReg: 12.87694) QuantErr: 12.87694 batch_time=0.40500 
Train Epoch: 20 [188/250 24064/32000 (75%)] Loss: 4.89157 (QuantReg: 13.42017) QuantErr: 13.42017 batch_time=0.40836 
Train Epoch: 20 [199/250 25472/32000 (80%)] Loss: 4.20122 (QuantReg: 13.26882) QuantErr: 13.26882 batch_time=0.40374 
Train Epoch: 20 [210/250 26880/32000 (84%)] Loss: 5.56743 (QuantReg: 13.17259) QuantErr: 13.17259 batch_time=0.40455 
Train Epoch: 20 [221/250 28288/32000 (88%)] Loss: 6.73271 (QuantReg: 13.16450) QuantErr: 13.16450 batch_time=0.42493 
Train Epoch: 20 [232/250 29696/32000 (93%)] Loss: 4.92197 (QuantReg: 13.33212) QuantErr: 13.33212 batch_time=0.41116 
Train Epoch: 20 [243/250 31104/32000 (97%)] Loss: 5.60122 (QuantReg: 13.19107) QuantErr: 13.19107 batch_time=0.40112 
Train Epoch: 20 codebook_update_time=0.43343
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch20.pth ...
Done in 18.271s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 5.020201056480408
 quant_reg      : 13.19249157333374
 quant_err      : 13.19249157333374
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 31.58953722334004
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 79.87927565392354
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.374245472837021
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.515846287169055
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.875251509054326
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.59531349649406
 MSRVTT_full_test/t2v_metrics/R1: 12.240802675585284
 MSRVTT_full_test/t2v_metrics/R5: 34.81605351170568
 MSRVTT_full_test/t2v_metrics/R10: 47.95986622073578
 MSRVTT_full_test/t2v_metrics/R50: 79.83277591973244
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.30234113712375
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.341508189802475
 MSRVTT_full_test/v2t_metrics/R1: 14.882943143812708
 MSRVTT_full_test/v2t_metrics/R5: 42.0066889632107
 MSRVTT_full_test/v2t_metrics/R10: 56.68896321070234
 MSRVTT_full_test/v2t_metrics/R50: 86.42140468227424
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.733444816053513
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.84747035205142
 mnt_best       : 28.89386353893123
 not_improved_count: 1
Train Epoch: 21 [1/250 128/32000 (0%)] Loss: 4.91077 (QuantReg: 13.20906) QuantErr: 13.20906 batch_time=46.80585 
Train Epoch: 21 [12/250 1536/32000 (5%)] Loss: 4.18541 (QuantReg: 13.10276) QuantErr: 13.10276 batch_time=0.40842 
Train Epoch: 21 [23/250 2944/32000 (9%)] Loss: 5.05057 (QuantReg: 13.26485) QuantErr: 13.26485 batch_time=0.39002 
Train Epoch: 21 [34/250 4352/32000 (14%)] Loss: 4.15830 (QuantReg: 13.71016) QuantErr: 13.71016 batch_time=0.38317 
Train Epoch: 21 [45/250 5760/32000 (18%)] Loss: 4.72390 (QuantReg: 13.40731) QuantErr: 13.40731 batch_time=0.38503 
Train Epoch: 21 [56/250 7168/32000 (22%)] Loss: 5.31426 (QuantReg: 12.98399) QuantErr: 12.98399 batch_time=0.40801 
Train Epoch: 21 [67/250 8576/32000 (27%)] Loss: 5.96392 (QuantReg: 13.00462) QuantErr: 13.00462 batch_time=0.40574 
Train Epoch: 21 [78/250 9984/32000 (31%)] Loss: 4.42175 (QuantReg: 13.22974) QuantErr: 13.22974 batch_time=0.38813 
Train Epoch: 21 [89/250 11392/32000 (36%)] Loss: 5.48435 (QuantReg: 13.00617) QuantErr: 13.00617 batch_time=0.40584 
Train Epoch: 21 [100/250 12800/32000 (40%)] Loss: 4.73191 (QuantReg: 13.35101) QuantErr: 13.35101 batch_time=0.88419 
Train Epoch: 21 [111/250 14208/32000 (44%)] Loss: 4.27169 (QuantReg: 13.23558) QuantErr: 13.23558 batch_time=0.40422 
Train Epoch: 21 [122/250 15616/32000 (49%)] Loss: 4.67587 (QuantReg: 13.26537) QuantErr: 13.26537 batch_time=0.39829 
Train Epoch: 21 [133/250 17024/32000 (53%)] Loss: 7.21285 (QuantReg: 13.10320) QuantErr: 13.10320 batch_time=0.45713 
Train Epoch: 21 [144/250 18432/32000 (58%)] Loss: 4.40834 (QuantReg: 13.27640) QuantErr: 13.27640 batch_time=0.42073 
Train Epoch: 21 [155/250 19840/32000 (62%)] Loss: 4.42112 (QuantReg: 13.50617) QuantErr: 13.50617 batch_time=0.40983 
Train Epoch: 21 [166/250 21248/32000 (66%)] Loss: 4.59016 (QuantReg: 13.07581) QuantErr: 13.07581 batch_time=0.41023 
Train Epoch: 21 [177/250 22656/32000 (71%)] Loss: 5.15183 (QuantReg: 13.27867) QuantErr: 13.27867 batch_time=0.41713 
Train Epoch: 21 [188/250 24064/32000 (75%)] Loss: 4.59029 (QuantReg: 13.39124) QuantErr: 13.39124 batch_time=0.40153 
Train Epoch: 21 [199/250 25472/32000 (80%)] Loss: 4.00750 (QuantReg: 13.35912) QuantErr: 13.35912 batch_time=0.40413 
Train Epoch: 21 [210/250 26880/32000 (84%)] Loss: 4.55475 (QuantReg: 13.34360) QuantErr: 13.34360 batch_time=0.59478 
Train Epoch: 21 [221/250 28288/32000 (88%)] Loss: 4.87253 (QuantReg: 13.28645) QuantErr: 13.28645 batch_time=0.39558 
Train Epoch: 21 [232/250 29696/32000 (93%)] Loss: 4.65576 (QuantReg: 13.33643) QuantErr: 13.33643 batch_time=0.40454 
Train Epoch: 21 [243/250 31104/32000 (97%)] Loss: 5.56080 (QuantReg: 13.15055) QuantErr: 13.15055 batch_time=0.39438 
Train Epoch: 21 codebook_update_time=0.45872
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch21.pth ...
Done in 16.972s
removing stale ckpt [epoch 20] [took 0.00s]
 epoch          : 21
 loss           : 4.81917924118042
 quant_reg      : 13.23524927520752
 quant_err      : 13.23524927520752
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 5250
 MSRVTT_full_val/t2v_metrics/R1: 30.58350100603622
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.466800804828974
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.72941452965395
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.601609657947686
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.217481048697124
 MSRVTT_full_test/t2v_metrics/R1: 12.006688963210703
 MSRVTT_full_test/t2v_metrics/R5: 33.67892976588629
 MSRVTT_full_test/t2v_metrics/R10: 48.16053511705686
 MSRVTT_full_test/t2v_metrics/R50: 79.23076923076923
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.364214046822745
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.904460145495754
 MSRVTT_full_test/v2t_metrics/R1: 14.31438127090301
 MSRVTT_full_test/v2t_metrics/R5: 41.27090301003344
 MSRVTT_full_test/v2t_metrics/R10: 55.01672240802676
 MSRVTT_full_test/v2t_metrics/R50: 85.78595317725753
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.38428093645485
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.91320500122655
 mnt_best       : 28.89386353893123
 not_improved_count: 2
Train Epoch: 22 [1/250 128/32000 (0%)] Loss: 4.66131 (QuantReg: 13.10318) QuantErr: 13.10318 batch_time=34.29995 
Train Epoch: 22 [12/250 1536/32000 (5%)] Loss: 5.10556 (QuantReg: 13.16121) QuantErr: 13.16121 batch_time=0.40284 
Train Epoch: 22 [23/250 2944/32000 (9%)] Loss: 4.81815 (QuantReg: 13.42793) QuantErr: 13.42793 batch_time=0.39912 
Train Epoch: 22 [34/250 4352/32000 (14%)] Loss: 4.18362 (QuantReg: 13.06478) QuantErr: 13.06478 batch_time=0.39751 
Train Epoch: 22 [45/250 5760/32000 (18%)] Loss: 5.24035 (QuantReg: 13.08482) QuantErr: 13.08482 batch_time=0.51828 
Train Epoch: 22 [56/250 7168/32000 (22%)] Loss: 5.16329 (QuantReg: 13.34304) QuantErr: 13.34304 batch_time=0.40340 
Train Epoch: 22 [67/250 8576/32000 (27%)] Loss: 4.41117 (QuantReg: 13.23205) QuantErr: 13.23205 batch_time=1.82647 
Train Epoch: 22 [78/250 9984/32000 (31%)] Loss: 4.40682 (QuantReg: 13.06922) QuantErr: 13.06922 batch_time=0.41744 
Train Epoch: 22 [89/250 11392/32000 (36%)] Loss: 5.39581 (QuantReg: 13.08189) QuantErr: 13.08189 batch_time=0.42618 
Train Epoch: 22 [100/250 12800/32000 (40%)] Loss: 3.99176 (QuantReg: 13.38607) QuantErr: 13.38607 batch_time=0.38975 
Train Epoch: 22 [111/250 14208/32000 (44%)] Loss: 3.93107 (QuantReg: 13.35847) QuantErr: 13.35847 batch_time=0.42046 
Train Epoch: 22 [122/250 15616/32000 (49%)] Loss: 7.60075 (QuantReg: 12.89664) QuantErr: 12.89664 batch_time=0.42841 
Train Epoch: 22 [133/250 17024/32000 (53%)] Loss: 3.78197 (QuantReg: 13.39847) QuantErr: 13.39847 batch_time=0.39801 
Train Epoch: 22 [144/250 18432/32000 (58%)] Loss: 4.88668 (QuantReg: 13.22786) QuantErr: 13.22786 batch_time=0.66766 
Train Epoch: 22 [155/250 19840/32000 (62%)] Loss: 5.00740 (QuantReg: 13.45194) QuantErr: 13.45194 batch_time=0.41577 
Train Epoch: 22 [166/250 21248/32000 (66%)] Loss: 4.25046 (QuantReg: 13.33494) QuantErr: 13.33494 batch_time=0.39525 
Train Epoch: 22 [177/250 22656/32000 (71%)] Loss: 4.68805 (QuantReg: 13.41808) QuantErr: 13.41808 batch_time=0.40150 
Train Epoch: 22 [188/250 24064/32000 (75%)] Loss: 5.26859 (QuantReg: 13.25218) QuantErr: 13.25218 batch_time=0.40435 
Train Epoch: 22 [199/250 25472/32000 (80%)] Loss: 4.77353 (QuantReg: 13.02517) QuantErr: 13.02517 batch_time=3.31292 
Train Epoch: 22 [210/250 26880/32000 (84%)] Loss: 4.03119 (QuantReg: 13.21524) QuantErr: 13.21524 batch_time=2.12003 
Train Epoch: 22 [221/250 28288/32000 (88%)] Loss: 5.25608 (QuantReg: 12.99163) QuantErr: 12.99163 batch_time=0.40267 
Train Epoch: 22 [232/250 29696/32000 (93%)] Loss: 5.12488 (QuantReg: 13.51298) QuantErr: 13.51298 batch_time=0.40072 
Train Epoch: 22 [243/250 31104/32000 (97%)] Loss: 4.16438 (QuantReg: 13.17627) QuantErr: 13.17627 batch_time=0.46810 
Train Epoch: 22 codebook_update_time=0.40640
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch22.pth ...
Done in 5.380s
removing stale ckpt [epoch 21] [took 0.33s]
 epoch          : 22
 loss           : 4.800017040252685
 quant_reg      : 13.212193264007569
 quant_err      : 13.212193264007569
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.229376257545272
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.48572556111955
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.253521126760563
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.92283451600243
 MSRVTT_full_test/t2v_metrics/R1: 12.073578595317725
 MSRVTT_full_test/t2v_metrics/R5: 35.35117056856188
 MSRVTT_full_test/t2v_metrics/R10: 49.4314381270903
 MSRVTT_full_test/t2v_metrics/R50: 79.76588628762542
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.023745819397995
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.63212932090295
 MSRVTT_full_test/v2t_metrics/R1: 15.585284280936454
 MSRVTT_full_test/v2t_metrics/R5: 42.14046822742475
 MSRVTT_full_test/v2t_metrics/R10: 57.02341137123746
 MSRVTT_full_test/v2t_metrics/R50: 86.18729096989966
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.731772575250837
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.4571615515938
 mnt_best       : 28.89386353893123
 not_improved_count: 3
Train Epoch: 23 [1/250 128/32000 (0%)] Loss: 3.90087 (QuantReg: 13.12134) QuantErr: 13.12134 batch_time=37.71482 
Train Epoch: 23 [12/250 1536/32000 (5%)] Loss: 5.00526 (QuantReg: 13.01226) QuantErr: 13.01226 batch_time=0.75348 
Train Epoch: 23 [23/250 2944/32000 (9%)] Loss: 4.77365 (QuantReg: 13.17016) QuantErr: 13.17016 batch_time=0.43255 
Train Epoch: 23 [34/250 4352/32000 (14%)] Loss: 4.03666 (QuantReg: 13.25688) QuantErr: 13.25688 batch_time=0.47437 
Train Epoch: 23 [45/250 5760/32000 (18%)] Loss: 4.18467 (QuantReg: 13.23545) QuantErr: 13.23545 batch_time=0.39582 
Train Epoch: 23 [56/250 7168/32000 (22%)] Loss: 4.17364 (QuantReg: 13.05732) QuantErr: 13.05732 batch_time=0.43148 
Train Epoch: 23 [67/250 8576/32000 (27%)] Loss: 5.21659 (QuantReg: 13.13894) QuantErr: 13.13894 batch_time=0.70639 
Train Epoch: 23 [78/250 9984/32000 (31%)] Loss: 5.21452 (QuantReg: 13.05941) QuantErr: 13.05941 batch_time=1.76837 
Train Epoch: 23 [89/250 11392/32000 (36%)] Loss: 3.81250 (QuantReg: 13.53312) QuantErr: 13.53312 batch_time=0.41231 
Train Epoch: 23 [100/250 12800/32000 (40%)] Loss: 5.26278 (QuantReg: 13.14458) QuantErr: 13.14458 batch_time=0.40253 
Train Epoch: 23 [111/250 14208/32000 (44%)] Loss: 4.79262 (QuantReg: 12.92335) QuantErr: 12.92335 batch_time=0.38863 
Train Epoch: 23 [122/250 15616/32000 (49%)] Loss: 4.18723 (QuantReg: 13.33506) QuantErr: 13.33506 batch_time=0.44224 
Train Epoch: 23 [133/250 17024/32000 (53%)] Loss: 5.13579 (QuantReg: 13.37397) QuantErr: 13.37397 batch_time=0.39442 
Train Epoch: 23 [144/250 18432/32000 (58%)] Loss: 4.45284 (QuantReg: 13.24844) QuantErr: 13.24844 batch_time=0.43868 
Train Epoch: 23 [155/250 19840/32000 (62%)] Loss: 4.53450 (QuantReg: 13.38345) QuantErr: 13.38345 batch_time=0.40582 
Train Epoch: 23 [166/250 21248/32000 (66%)] Loss: 4.35079 (QuantReg: 12.96934) QuantErr: 12.96934 batch_time=0.75829 
Train Epoch: 23 [177/250 22656/32000 (71%)] Loss: 5.43911 (QuantReg: 12.98485) QuantErr: 12.98485 batch_time=0.40651 
Train Epoch: 23 [188/250 24064/32000 (75%)] Loss: 5.18959 (QuantReg: 13.43686) QuantErr: 13.43686 batch_time=0.53298 
Train Epoch: 23 [199/250 25472/32000 (80%)] Loss: 4.92418 (QuantReg: 13.17473) QuantErr: 13.17473 batch_time=0.40756 
Train Epoch: 23 [210/250 26880/32000 (84%)] Loss: 4.09443 (QuantReg: 13.41397) QuantErr: 13.41397 batch_time=0.42670 
Train Epoch: 23 [221/250 28288/32000 (88%)] Loss: 4.13192 (QuantReg: 13.40989) QuantErr: 13.40989 batch_time=0.40017 
Train Epoch: 23 [232/250 29696/32000 (93%)] Loss: 5.32679 (QuantReg: 13.34278) QuantErr: 13.34278 batch_time=0.40278 
Train Epoch: 23 [243/250 31104/32000 (97%)] Loss: 4.42742 (QuantReg: 13.53265) QuantErr: 13.53265 batch_time=0.49945 
Train Epoch: 23 codebook_update_time=0.40354
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch23.pth ...
Done in 3.960s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 4.702354241371155
 quant_reg      : 13.255707225799561
 quant_err      : 13.255707225799561
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 5750
 MSRVTT_full_val/t2v_metrics/R1: 32.19315895372233
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.122736418511067
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.782910549887305
 MSRVTT_full_val/v2t_metrics/R1: 36.61971830985915
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.346076458752515
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.881746763371446
 MSRVTT_full_test/t2v_metrics/R1: 12.775919732441471
 MSRVTT_full_test/t2v_metrics/R5: 35.551839464882946
 MSRVTT_full_test/t2v_metrics/R10: 48.862876254180605
 MSRVTT_full_test/t2v_metrics/R50: 80.06688963210702
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.879933110367894
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.102465681696227
 MSRVTT_full_test/v2t_metrics/R1: 15.351170568561873
 MSRVTT_full_test/v2t_metrics/R5: 42.274247491638796
 MSRVTT_full_test/v2t_metrics/R10: 56.72240802675585
 MSRVTT_full_test/v2t_metrics/R50: 86.0200668896321
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.588127090301
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.26524150863233
 mnt_best       : 28.89386353893123
 not_improved_count: 4
Train Epoch: 24 [1/250 128/32000 (0%)] Loss: 4.86118 (QuantReg: 13.20486) QuantErr: 13.20486 batch_time=41.49016 
Train Epoch: 24 [12/250 1536/32000 (5%)] Loss: 4.80506 (QuantReg: 12.94179) QuantErr: 12.94179 batch_time=0.40173 
Train Epoch: 24 [23/250 2944/32000 (9%)] Loss: 3.92071 (QuantReg: 13.04448) QuantErr: 13.04448 batch_time=0.39977 
Train Epoch: 24 [34/250 4352/32000 (14%)] Loss: 4.73657 (QuantReg: 13.24413) QuantErr: 13.24413 batch_time=0.43217 
Train Epoch: 24 [45/250 5760/32000 (18%)] Loss: 5.09036 (QuantReg: 13.21805) QuantErr: 13.21805 batch_time=0.38943 
Train Epoch: 24 [56/250 7168/32000 (22%)] Loss: 4.46984 (QuantReg: 13.24154) QuantErr: 13.24154 batch_time=0.38428 
Train Epoch: 24 [67/250 8576/32000 (27%)] Loss: 3.63316 (QuantReg: 13.14656) QuantErr: 13.14656 batch_time=0.41484 
Train Epoch: 24 [78/250 9984/32000 (31%)] Loss: 5.00637 (QuantReg: 13.18390) QuantErr: 13.18390 batch_time=0.42218 
Train Epoch: 24 [89/250 11392/32000 (36%)] Loss: 3.86924 (QuantReg: 13.36299) QuantErr: 13.36299 batch_time=0.38816 
Train Epoch: 24 [100/250 12800/32000 (40%)] Loss: 4.06821 (QuantReg: 13.21065) QuantErr: 13.21065 batch_time=0.38673 
Train Epoch: 24 [111/250 14208/32000 (44%)] Loss: 5.82448 (QuantReg: 13.02151) QuantErr: 13.02151 batch_time=0.43489 
Train Epoch: 24 [122/250 15616/32000 (49%)] Loss: 3.90069 (QuantReg: 13.51813) QuantErr: 13.51813 batch_time=0.41133 
Train Epoch: 24 [133/250 17024/32000 (53%)] Loss: 4.39801 (QuantReg: 13.45545) QuantErr: 13.45545 batch_time=0.41324 
Train Epoch: 24 [144/250 18432/32000 (58%)] Loss: 3.65639 (QuantReg: 13.62290) QuantErr: 13.62290 batch_time=0.39853 
Train Epoch: 24 [155/250 19840/32000 (62%)] Loss: 3.10179 (QuantReg: 13.55897) QuantErr: 13.55897 batch_time=0.41693 
Train Epoch: 24 [166/250 21248/32000 (66%)] Loss: 4.47065 (QuantReg: 13.09163) QuantErr: 13.09163 batch_time=0.41999 
Train Epoch: 24 [177/250 22656/32000 (71%)] Loss: 4.74895 (QuantReg: 13.16354) QuantErr: 13.16354 batch_time=0.41266 
Train Epoch: 24 [188/250 24064/32000 (75%)] Loss: 4.24765 (QuantReg: 13.22643) QuantErr: 13.22643 batch_time=0.40321 
Train Epoch: 24 [199/250 25472/32000 (80%)] Loss: 5.29307 (QuantReg: 13.52413) QuantErr: 13.52413 batch_time=1.48549 
Train Epoch: 24 [210/250 26880/32000 (84%)] Loss: 2.61897 (QuantReg: 13.78725) QuantErr: 13.78725 batch_time=0.39840 
Train Epoch: 24 [221/250 28288/32000 (88%)] Loss: 4.27104 (QuantReg: 13.23112) QuantErr: 13.23112 batch_time=0.44316 
Train Epoch: 24 [232/250 29696/32000 (93%)] Loss: 5.35875 (QuantReg: 13.39553) QuantErr: 13.39553 batch_time=1.66072 
Train Epoch: 24 [243/250 31104/32000 (97%)] Loss: 5.23889 (QuantReg: 13.29795) QuantErr: 13.29795 batch_time=0.41149 
Train Epoch: 24 codebook_update_time=0.44321
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch24.pth ...
Done in 20.139s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 4.512018509864808
 quant_reg      : 13.288917713165283
 quant_err      : 13.288917713165283
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 67.40442655935614
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.567404426559357
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.98551948409998
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.420523138832998
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.25711194113796
 MSRVTT_full_test/t2v_metrics/R1: 12.575250836120402
 MSRVTT_full_test/t2v_metrics/R5: 35.48494983277592
 MSRVTT_full_test/t2v_metrics/R10: 49.93311036789298
 MSRVTT_full_test/t2v_metrics/R50: 79.86622073578596
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.372240802675584
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.139507397613293
 MSRVTT_full_test/v2t_metrics/R1: 15.551839464882944
 MSRVTT_full_test/v2t_metrics/R5: 42.90969899665552
 MSRVTT_full_test/v2t_metrics/R10: 58.02675585284281
 MSRVTT_full_test/v2t_metrics/R50: 86.52173913043478
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.370735785953176
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.8315457620259
 mnt_best       : 28.89386353893123
 not_improved_count: 5
Train Epoch: 25 [1/250 128/32000 (0%)] Loss: 4.48568 (QuantReg: 13.28848) QuantErr: 13.28848 batch_time=36.15743 
Train Epoch: 25 [12/250 1536/32000 (5%)] Loss: 4.79281 (QuantReg: 12.79230) QuantErr: 12.79230 batch_time=0.41000 
Train Epoch: 25 [23/250 2944/32000 (9%)] Loss: 5.20404 (QuantReg: 13.05308) QuantErr: 13.05308 batch_time=0.38606 
Train Epoch: 25 [34/250 4352/32000 (14%)] Loss: 5.24012 (QuantReg: 13.16721) QuantErr: 13.16721 batch_time=0.43413 
Train Epoch: 25 [45/250 5760/32000 (18%)] Loss: 5.05690 (QuantReg: 13.58438) QuantErr: 13.58438 batch_time=0.41069 
Train Epoch: 25 [56/250 7168/32000 (22%)] Loss: 4.83374 (QuantReg: 13.34804) QuantErr: 13.34804 batch_time=0.40697 
Train Epoch: 25 [67/250 8576/32000 (27%)] Loss: 4.95629 (QuantReg: 13.33252) QuantErr: 13.33252 batch_time=0.38173 
Train Epoch: 25 [78/250 9984/32000 (31%)] Loss: 5.75645 (QuantReg: 13.19544) QuantErr: 13.19544 batch_time=0.40652 
Train Epoch: 25 [89/250 11392/32000 (36%)] Loss: 4.31510 (QuantReg: 13.42043) QuantErr: 13.42043 batch_time=0.43006 
Train Epoch: 25 [100/250 12800/32000 (40%)] Loss: 4.93755 (QuantReg: 12.99976) QuantErr: 12.99976 batch_time=0.38519 
Train Epoch: 25 [111/250 14208/32000 (44%)] Loss: 4.17006 (QuantReg: 13.28771) QuantErr: 13.28771 batch_time=0.41304 
Train Epoch: 25 [122/250 15616/32000 (49%)] Loss: 4.13084 (QuantReg: 13.48309) QuantErr: 13.48309 batch_time=0.41707 
Train Epoch: 25 [133/250 17024/32000 (53%)] Loss: 4.47608 (QuantReg: 13.16664) QuantErr: 13.16664 batch_time=0.40798 
Train Epoch: 25 [144/250 18432/32000 (58%)] Loss: 3.73242 (QuantReg: 13.84551) QuantErr: 13.84551 batch_time=0.43915 
Train Epoch: 25 [155/250 19840/32000 (62%)] Loss: 4.19749 (QuantReg: 13.46463) QuantErr: 13.46463 batch_time=0.42260 
Train Epoch: 25 [166/250 21248/32000 (66%)] Loss: 3.91937 (QuantReg: 13.46942) QuantErr: 13.46942 batch_time=0.40149 
Train Epoch: 25 [177/250 22656/32000 (71%)] Loss: 3.46578 (QuantReg: 13.42153) QuantErr: 13.42153 batch_time=0.42439 
Train Epoch: 25 [188/250 24064/32000 (75%)] Loss: 3.90050 (QuantReg: 13.22031) QuantErr: 13.22031 batch_time=0.41243 
Train Epoch: 25 [199/250 25472/32000 (80%)] Loss: 5.42462 (QuantReg: 13.33427) QuantErr: 13.33427 batch_time=0.43542 
Train Epoch: 25 [210/250 26880/32000 (84%)] Loss: 4.39549 (QuantReg: 13.48301) QuantErr: 13.48301 batch_time=0.38925 
Train Epoch: 25 [221/250 28288/32000 (88%)] Loss: 4.60797 (QuantReg: 13.58074) QuantErr: 13.58074 batch_time=0.38976 
Train Epoch: 25 [232/250 29696/32000 (93%)] Loss: 4.56559 (QuantReg: 13.33191) QuantErr: 13.33191 batch_time=0.88631 
Train Epoch: 25 [243/250 31104/32000 (97%)] Loss: 3.79274 (QuantReg: 13.33286) QuantErr: 13.33286 batch_time=0.42275 
Train Epoch: 25 codebook_update_time=0.44305
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch25.pth ...
Done in 4.118s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 4.48760409450531
 quant_reg      : 13.340205142974854
 quant_err      : 13.340205142974854
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 6250
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.261569416498993
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.847611030460634
 MSRVTT_full_val/v2t_metrics/R1: 38.22937625754527
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.730382293762576
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.801716848475714
 MSRVTT_full_test/t2v_metrics/R1: 12.37458193979933
 MSRVTT_full_test/t2v_metrics/R5: 35.45150501672241
 MSRVTT_full_test/t2v_metrics/R10: 50.06688963210702
 MSRVTT_full_test/t2v_metrics/R50: 80.5351170568562
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.1866220735786
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.005195466141686
 MSRVTT_full_test/v2t_metrics/R1: 16.08695652173913
 MSRVTT_full_test/v2t_metrics/R5: 43.979933110367895
 MSRVTT_full_test/v2t_metrics/R10: 58.36120401337793
 MSRVTT_full_test/v2t_metrics/R50: 86.48829431438126
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.050334448160534
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.563488159647875
 mnt_best       : 28.89386353893123
 not_improved_count: 6
Train Epoch: 26 [1/250 128/32000 (0%)] Loss: 4.36019 (QuantReg: 13.32914) QuantErr: 13.32914 batch_time=33.99827 
Train Epoch: 26 [12/250 1536/32000 (5%)] Loss: 4.42432 (QuantReg: 13.30401) QuantErr: 13.30401 batch_time=4.31756 
Train Epoch: 26 [23/250 2944/32000 (9%)] Loss: 3.42318 (QuantReg: 13.37164) QuantErr: 13.37164 batch_time=0.40885 
Train Epoch: 26 [34/250 4352/32000 (14%)] Loss: 4.38434 (QuantReg: 13.40729) QuantErr: 13.40729 batch_time=0.40958 
Train Epoch: 26 [45/250 5760/32000 (18%)] Loss: 5.68356 (QuantReg: 13.01250) QuantErr: 13.01250 batch_time=0.40871 
Train Epoch: 26 [56/250 7168/32000 (22%)] Loss: 4.69176 (QuantReg: 13.19081) QuantErr: 13.19081 batch_time=0.42236 
Train Epoch: 26 [67/250 8576/32000 (27%)] Loss: 5.21170 (QuantReg: 13.37359) QuantErr: 13.37359 batch_time=0.39587 
Train Epoch: 26 [78/250 9984/32000 (31%)] Loss: 4.12223 (QuantReg: 13.57193) QuantErr: 13.57193 batch_time=2.36118 
Train Epoch: 26 [89/250 11392/32000 (36%)] Loss: 3.93236 (QuantReg: 13.02079) QuantErr: 13.02079 batch_time=0.63098 
Train Epoch: 26 [100/250 12800/32000 (40%)] Loss: 4.96156 (QuantReg: 13.25225) QuantErr: 13.25225 batch_time=0.39097 
Train Epoch: 26 [111/250 14208/32000 (44%)] Loss: 4.48371 (QuantReg: 12.93018) QuantErr: 12.93018 batch_time=0.39514 
Train Epoch: 26 [122/250 15616/32000 (49%)] Loss: 5.20721 (QuantReg: 13.40373) QuantErr: 13.40373 batch_time=0.39771 
Train Epoch: 26 [133/250 17024/32000 (53%)] Loss: 4.53887 (QuantReg: 13.45370) QuantErr: 13.45370 batch_time=1.31913 
Train Epoch: 26 [144/250 18432/32000 (58%)] Loss: 4.31256 (QuantReg: 13.31983) QuantErr: 13.31983 batch_time=0.39979 
Train Epoch: 26 [155/250 19840/32000 (62%)] Loss: 4.41654 (QuantReg: 13.38128) QuantErr: 13.38128 batch_time=0.40599 
Train Epoch: 26 [166/250 21248/32000 (66%)] Loss: 4.92927 (QuantReg: 13.36647) QuantErr: 13.36647 batch_time=0.40165 
Train Epoch: 26 [177/250 22656/32000 (71%)] Loss: 3.37282 (QuantReg: 13.32444) QuantErr: 13.32444 batch_time=0.40725 
Train Epoch: 26 [188/250 24064/32000 (75%)] Loss: 3.48062 (QuantReg: 13.50569) QuantErr: 13.50569 batch_time=0.40122 
Train Epoch: 26 [199/250 25472/32000 (80%)] Loss: 4.34982 (QuantReg: 13.53716) QuantErr: 13.53716 batch_time=0.40735 
Train Epoch: 26 [210/250 26880/32000 (84%)] Loss: 4.10330 (QuantReg: 13.69280) QuantErr: 13.69280 batch_time=0.40373 
Train Epoch: 26 [221/250 28288/32000 (88%)] Loss: 4.53253 (QuantReg: 13.24570) QuantErr: 13.24570 batch_time=0.40049 
Train Epoch: 26 [232/250 29696/32000 (93%)] Loss: 3.23831 (QuantReg: 13.73503) QuantErr: 13.73503 batch_time=0.40451 
Train Epoch: 26 [243/250 31104/32000 (97%)] Loss: 3.82955 (QuantReg: 13.51401) QuantErr: 13.51401 batch_time=0.40326 
Train Epoch: 26 codebook_update_time=0.92913
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch26.pth ...
Done in 8.120s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 4.375925303459168
 quant_reg      : 13.328145503997803
 quant_err      : 13.328145503997803
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 72.23340040241449
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.682092555331992
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.10285588768708
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.722334004024145
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.50765248645371
 MSRVTT_full_test/t2v_metrics/R1: 12.94314381270903
 MSRVTT_full_test/t2v_metrics/R5: 36.32107023411371
 MSRVTT_full_test/t2v_metrics/R10: 49.96655518394649
 MSRVTT_full_test/t2v_metrics/R50: 81.07023411371237
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.45752508361204
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.63909395689729
 MSRVTT_full_test/v2t_metrics/R1: 15.752508361204013
 MSRVTT_full_test/v2t_metrics/R5: 43.24414715719063
 MSRVTT_full_test/v2t_metrics/R10: 58.36120401337793
 MSRVTT_full_test/v2t_metrics/R50: 86.65551839464882
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.418060200668897
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.12980179036204
 mnt_best       : 28.89386353893123
 not_improved_count: 7
Train Epoch: 27 [1/250 128/32000 (0%)] Loss: 4.29888 (QuantReg: 13.33376) QuantErr: 13.33376 batch_time=32.93891 
Train Epoch: 27 [12/250 1536/32000 (5%)] Loss: 4.25047 (QuantReg: 13.03413) QuantErr: 13.03413 batch_time=0.51575 
Train Epoch: 27 [23/250 2944/32000 (9%)] Loss: 5.73320 (QuantReg: 13.04722) QuantErr: 13.04722 batch_time=0.40014 
Train Epoch: 27 [34/250 4352/32000 (14%)] Loss: 4.08001 (QuantReg: 13.36365) QuantErr: 13.36365 batch_time=0.39414 
Train Epoch: 27 [45/250 5760/32000 (18%)] Loss: 5.23545 (QuantReg: 13.57660) QuantErr: 13.57660 batch_time=0.38884 
Train Epoch: 27 [56/250 7168/32000 (22%)] Loss: 3.79508 (QuantReg: 13.27448) QuantErr: 13.27448 batch_time=0.39076 
Train Epoch: 27 [67/250 8576/32000 (27%)] Loss: 3.63315 (QuantReg: 13.16363) QuantErr: 13.16363 batch_time=0.75862 
Train Epoch: 27 [78/250 9984/32000 (31%)] Loss: 3.53989 (QuantReg: 13.68130) QuantErr: 13.68130 batch_time=0.39177 
Train Epoch: 27 [89/250 11392/32000 (36%)] Loss: 3.92740 (QuantReg: 13.46655) QuantErr: 13.46655 batch_time=0.38826 
Train Epoch: 27 [100/250 12800/32000 (40%)] Loss: 4.73344 (QuantReg: 13.27843) QuantErr: 13.27843 batch_time=0.42300 
Train Epoch: 27 [111/250 14208/32000 (44%)] Loss: 4.89758 (QuantReg: 13.46992) QuantErr: 13.46992 batch_time=0.39059 
Train Epoch: 27 [122/250 15616/32000 (49%)] Loss: 4.29412 (QuantReg: 13.56800) QuantErr: 13.56800 batch_time=0.69306 
Train Epoch: 27 [133/250 17024/32000 (53%)] Loss: 4.14613 (QuantReg: 13.32503) QuantErr: 13.32503 batch_time=2.31479 
Train Epoch: 27 [144/250 18432/32000 (58%)] Loss: 3.06161 (QuantReg: 13.30653) QuantErr: 13.30653 batch_time=0.42631 
Train Epoch: 27 [155/250 19840/32000 (62%)] Loss: 3.44942 (QuantReg: 13.16385) QuantErr: 13.16385 batch_time=0.40057 
Train Epoch: 27 [166/250 21248/32000 (66%)] Loss: 3.55831 (QuantReg: 13.27881) QuantErr: 13.27881 batch_time=0.40488 
Train Epoch: 27 [177/250 22656/32000 (71%)] Loss: 3.82802 (QuantReg: 13.37567) QuantErr: 13.37567 batch_time=0.40729 
Train Epoch: 27 [188/250 24064/32000 (75%)] Loss: 4.34618 (QuantReg: 13.41857) QuantErr: 13.41857 batch_time=0.38620 
Train Epoch: 27 [199/250 25472/32000 (80%)] Loss: 4.51623 (QuantReg: 13.50267) QuantErr: 13.50267 batch_time=0.38537 
Train Epoch: 27 [210/250 26880/32000 (84%)] Loss: 4.15375 (QuantReg: 13.30374) QuantErr: 13.30374 batch_time=0.38498 
Train Epoch: 27 [221/250 28288/32000 (88%)] Loss: 4.11336 (QuantReg: 13.31081) QuantErr: 13.31081 batch_time=0.39580 
Train Epoch: 27 [232/250 29696/32000 (93%)] Loss: 3.55390 (QuantReg: 13.44857) QuantErr: 13.44857 batch_time=0.44425 
Train Epoch: 27 [243/250 31104/32000 (97%)] Loss: 3.45146 (QuantReg: 13.41564) QuantErr: 13.41564 batch_time=0.42032 
Train Epoch: 27 codebook_update_time=0.44813
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch27.pth ...
Done in 9.456s
removing stale ckpt [epoch 26] [took 0.00s]
 epoch          : 27
 loss           : 4.364361605644226
 quant_reg      : 13.303963451385497
 quant_err      : 13.303963451385497
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 6750
 MSRVTT_full_val/t2v_metrics/R1: 30.985915492957748
 MSRVTT_full_val/t2v_metrics/R5: 71.83098591549296
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.048289738430583
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.60545226413339
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.806841046277666
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.579919901796345
 MSRVTT_full_test/t2v_metrics/R1: 13.143812709030101
 MSRVTT_full_test/t2v_metrics/R5: 36.58862876254181
 MSRVTT_full_test/t2v_metrics/R10: 49.4314381270903
 MSRVTT_full_test/t2v_metrics/R50: 80.63545150501672
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.94080267558528
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.75346892972126
 MSRVTT_full_test/v2t_metrics/R1: 15.852842809364548
 MSRVTT_full_test/v2t_metrics/R5: 43.64548494983278
 MSRVTT_full_test/v2t_metrics/R10: 57.357859531772576
 MSRVTT_full_test/v2t_metrics/R50: 86.2876254180602
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.97926421404682
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.10984958171628
 mnt_best       : 28.89386353893123
 not_improved_count: 8
Train Epoch: 28 [1/250 128/32000 (0%)] Loss: 6.08606 (QuantReg: 13.25234) QuantErr: 13.25234 batch_time=37.20968 
Train Epoch: 28 [12/250 1536/32000 (5%)] Loss: 4.66618 (QuantReg: 13.34040) QuantErr: 13.34040 batch_time=0.40313 
Train Epoch: 28 [23/250 2944/32000 (9%)] Loss: 4.20546 (QuantReg: 13.39871) QuantErr: 13.39871 batch_time=0.40427 
Train Epoch: 28 [34/250 4352/32000 (14%)] Loss: 4.31557 (QuantReg: 13.45227) QuantErr: 13.45227 batch_time=0.41552 
Train Epoch: 28 [45/250 5760/32000 (18%)] Loss: 4.79687 (QuantReg: 13.32678) QuantErr: 13.32678 batch_time=0.41353 
Train Epoch: 28 [56/250 7168/32000 (22%)] Loss: 4.04865 (QuantReg: 13.42461) QuantErr: 13.42461 batch_time=0.39138 
Train Epoch: 28 [67/250 8576/32000 (27%)] Loss: 4.92364 (QuantReg: 13.23099) QuantErr: 13.23099 batch_time=0.39441 
Train Epoch: 28 [78/250 9984/32000 (31%)] Loss: 4.09609 (QuantReg: 13.36810) QuantErr: 13.36810 batch_time=0.41330 
Train Epoch: 28 [89/250 11392/32000 (36%)] Loss: 3.91150 (QuantReg: 13.46098) QuantErr: 13.46098 batch_time=0.40640 
Train Epoch: 28 [100/250 12800/32000 (40%)] Loss: 4.98489 (QuantReg: 13.10524) QuantErr: 13.10524 batch_time=0.40572 
Train Epoch: 28 [111/250 14208/32000 (44%)] Loss: 4.26248 (QuantReg: 13.54888) QuantErr: 13.54888 batch_time=0.43405 
Train Epoch: 28 [122/250 15616/32000 (49%)] Loss: 4.73662 (QuantReg: 13.25437) QuantErr: 13.25437 batch_time=0.40941 
Train Epoch: 28 [133/250 17024/32000 (53%)] Loss: 4.24098 (QuantReg: 13.30956) QuantErr: 13.30956 batch_time=0.45717 
Train Epoch: 28 [144/250 18432/32000 (58%)] Loss: 3.11945 (QuantReg: 13.23334) QuantErr: 13.23334 batch_time=2.72181 
Train Epoch: 28 [155/250 19840/32000 (62%)] Loss: 3.62026 (QuantReg: 13.37388) QuantErr: 13.37388 batch_time=0.40356 
Train Epoch: 28 [166/250 21248/32000 (66%)] Loss: 4.75072 (QuantReg: 13.41279) QuantErr: 13.41279 batch_time=0.41257 
Train Epoch: 28 [177/250 22656/32000 (71%)] Loss: 3.80535 (QuantReg: 13.27975) QuantErr: 13.27975 batch_time=0.40739 
Train Epoch: 28 [188/250 24064/32000 (75%)] Loss: 3.89612 (QuantReg: 13.51813) QuantErr: 13.51813 batch_time=0.40587 
Train Epoch: 28 [199/250 25472/32000 (80%)] Loss: 4.05211 (QuantReg: 13.49387) QuantErr: 13.49387 batch_time=1.02843 
Train Epoch: 28 [210/250 26880/32000 (84%)] Loss: 5.28989 (QuantReg: 13.46863) QuantErr: 13.46863 batch_time=0.42352 
Train Epoch: 28 [221/250 28288/32000 (88%)] Loss: 3.33926 (QuantReg: 13.39006) QuantErr: 13.39006 batch_time=0.41272 
Train Epoch: 28 [232/250 29696/32000 (93%)] Loss: 4.88460 (QuantReg: 13.33035) QuantErr: 13.33035 batch_time=0.42031 
Train Epoch: 28 [243/250 31104/32000 (97%)] Loss: 4.29306 (QuantReg: 13.58595) QuantErr: 13.58595 batch_time=0.42557 
Train Epoch: 28 codebook_update_time=0.43093
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch28.pth ...
Done in 12.097s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 4.258610955238343
 quant_reg      : 13.343357620239258
 quant_err      : 13.343357620239258
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.9114688128772634
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.57824118704483
 MSRVTT_full_val/v2t_metrics/R1: 38.028169014084504
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.915492957746479
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.86118175825205
 MSRVTT_full_test/t2v_metrics/R1: 13.043478260869565
 MSRVTT_full_test/t2v_metrics/R5: 37.15719063545151
 MSRVTT_full_test/t2v_metrics/R10: 49.76588628762542
 MSRVTT_full_test/t2v_metrics/R50: 79.79933110367892
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.09230769230769
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.892780888125717
 MSRVTT_full_test/v2t_metrics/R1: 16.387959866220736
 MSRVTT_full_test/v2t_metrics/R5: 43.74581939799331
 MSRVTT_full_test/v2t_metrics/R10: 58.66220735785953
 MSRVTT_full_test/v2t_metrics/R50: 86.45484949832776
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.357859531772576
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.775491970453196
 mnt_best       : 28.89386353893123
 not_improved_count: 9
Train Epoch: 29 [1/250 128/32000 (0%)] Loss: 4.63390 (QuantReg: 13.23110) QuantErr: 13.23110 batch_time=40.54512 
Train Epoch: 29 [12/250 1536/32000 (5%)] Loss: 3.85556 (QuantReg: 13.32257) QuantErr: 13.32257 batch_time=0.40242 
Train Epoch: 29 [23/250 2944/32000 (9%)] Loss: 4.09785 (QuantReg: 13.40536) QuantErr: 13.40536 batch_time=0.41948 
Train Epoch: 29 [34/250 4352/32000 (14%)] Loss: 4.26405 (QuantReg: 13.36788) QuantErr: 13.36788 batch_time=0.39901 
Train Epoch: 29 [45/250 5760/32000 (18%)] Loss: 6.25612 (QuantReg: 13.18797) QuantErr: 13.18797 batch_time=0.69028 
Train Epoch: 29 [56/250 7168/32000 (22%)] Loss: 3.60848 (QuantReg: 13.62044) QuantErr: 13.62044 batch_time=0.40315 
Train Epoch: 29 [67/250 8576/32000 (27%)] Loss: 3.68610 (QuantReg: 13.02831) QuantErr: 13.02831 batch_time=0.44240 
Train Epoch: 29 [78/250 9984/32000 (31%)] Loss: 3.61667 (QuantReg: 13.42730) QuantErr: 13.42730 batch_time=0.42641 
Train Epoch: 29 [89/250 11392/32000 (36%)] Loss: 4.69713 (QuantReg: 13.10963) QuantErr: 13.10963 batch_time=0.41331 
Train Epoch: 29 [100/250 12800/32000 (40%)] Loss: 3.38617 (QuantReg: 13.39545) QuantErr: 13.39545 batch_time=2.46407 
Train Epoch: 29 [111/250 14208/32000 (44%)] Loss: 4.89173 (QuantReg: 13.13679) QuantErr: 13.13679 batch_time=0.39881 
Train Epoch: 29 [122/250 15616/32000 (49%)] Loss: 4.72459 (QuantReg: 13.49730) QuantErr: 13.49730 batch_time=0.42310 
Train Epoch: 29 [133/250 17024/32000 (53%)] Loss: 4.47109 (QuantReg: 13.34011) QuantErr: 13.34011 batch_time=0.43040 
Train Epoch: 29 [144/250 18432/32000 (58%)] Loss: 4.22025 (QuantReg: 13.52947) QuantErr: 13.52947 batch_time=0.45546 
Train Epoch: 29 [155/250 19840/32000 (62%)] Loss: 4.67378 (QuantReg: 13.44320) QuantErr: 13.44320 batch_time=0.39960 
Train Epoch: 29 [166/250 21248/32000 (66%)] Loss: 4.58675 (QuantReg: 13.33236) QuantErr: 13.33236 batch_time=0.43327 
Train Epoch: 29 [177/250 22656/32000 (71%)] Loss: 6.00668 (QuantReg: 13.54569) QuantErr: 13.54569 batch_time=0.39188 
Train Epoch: 29 [188/250 24064/32000 (75%)] Loss: 4.34663 (QuantReg: 13.51805) QuantErr: 13.51805 batch_time=0.40656 
Train Epoch: 29 [199/250 25472/32000 (80%)] Loss: 5.75463 (QuantReg: 13.08343) QuantErr: 13.08343 batch_time=1.09654 
Train Epoch: 29 [210/250 26880/32000 (84%)] Loss: 4.33766 (QuantReg: 13.57983) QuantErr: 13.57983 batch_time=0.39693 
Train Epoch: 29 [221/250 28288/32000 (88%)] Loss: 4.47551 (QuantReg: 13.09348) QuantErr: 13.09348 batch_time=0.40788 
Train Epoch: 29 [232/250 29696/32000 (93%)] Loss: 4.31563 (QuantReg: 13.24914) QuantErr: 13.24914 batch_time=0.41830 
Train Epoch: 29 [243/250 31104/32000 (97%)] Loss: 3.38910 (QuantReg: 13.79413) QuantErr: 13.79413 batch_time=0.39586 
Train Epoch: 29 codebook_update_time=0.96319
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch29.pth ...
Done in 22.310s
removing stale ckpt [epoch 28] [took 0.01s]
 epoch          : 29
 loss           : 4.286508018493652
 quant_reg      : 13.330526103973389
 quant_err      : 13.330526103973389
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 7250
 MSRVTT_full_val/t2v_metrics/R1: 33.40040241448692
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.714285714285714
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.562193814642455
 MSRVTT_full_val/v2t_metrics/R1: 37.223340040241446
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.138832997987928
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.58111681958622
 MSRVTT_full_test/t2v_metrics/R1: 12.608695652173912
 MSRVTT_full_test/t2v_metrics/R5: 36.2876254180602
 MSRVTT_full_test/t2v_metrics/R10: 49.4314381270903
 MSRVTT_full_test/t2v_metrics/R50: 80.5351170568562
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.71204013377926
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.279864168240405
 MSRVTT_full_test/v2t_metrics/R1: 15.585284280936454
 MSRVTT_full_test/v2t_metrics/R5: 41.7056856187291
 MSRVTT_full_test/v2t_metrics/R10: 57.19063545150502
 MSRVTT_full_test/v2t_metrics/R50: 86.25418060200668
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.17491638795987
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.37425950542224
 mnt_best       : 28.89386353893123
 not_improved_count: 10
Train Epoch: 30 [1/250 128/32000 (0%)] Loss: 4.75190 (QuantReg: 13.09434) QuantErr: 13.09434 batch_time=34.82435 
Train Epoch: 30 [12/250 1536/32000 (5%)] Loss: 4.73820 (QuantReg: 13.22499) QuantErr: 13.22499 batch_time=0.41214 
Train Epoch: 30 [23/250 2944/32000 (9%)] Loss: 4.95455 (QuantReg: 13.22166) QuantErr: 13.22166 batch_time=0.40834 
Train Epoch: 30 [34/250 4352/32000 (14%)] Loss: 4.72443 (QuantReg: 13.32674) QuantErr: 13.32674 batch_time=0.39868 
Train Epoch: 30 [45/250 5760/32000 (18%)] Loss: 4.49689 (QuantReg: 13.38989) QuantErr: 13.38989 batch_time=0.65868 
Train Epoch: 30 [56/250 7168/32000 (22%)] Loss: 3.50534 (QuantReg: 13.42378) QuantErr: 13.42378 batch_time=0.39886 
Train Epoch: 30 [67/250 8576/32000 (27%)] Loss: 4.99174 (QuantReg: 13.19349) QuantErr: 13.19349 batch_time=0.50926 
Train Epoch: 30 [78/250 9984/32000 (31%)] Loss: 4.43241 (QuantReg: 13.63181) QuantErr: 13.63181 batch_time=0.39954 
Train Epoch: 30 [89/250 11392/32000 (36%)] Loss: 4.99318 (QuantReg: 13.28220) QuantErr: 13.28220 batch_time=0.39660 
Train Epoch: 30 [100/250 12800/32000 (40%)] Loss: 3.75645 (QuantReg: 13.22849) QuantErr: 13.22849 batch_time=0.39015 
Train Epoch: 30 [111/250 14208/32000 (44%)] Loss: 4.96110 (QuantReg: 13.19525) QuantErr: 13.19525 batch_time=0.40210 
Train Epoch: 30 [122/250 15616/32000 (49%)] Loss: 4.21433 (QuantReg: 13.50305) QuantErr: 13.50305 batch_time=0.40614 
Train Epoch: 30 [133/250 17024/32000 (53%)] Loss: 4.61004 (QuantReg: 13.23191) QuantErr: 13.23191 batch_time=0.44653 
Train Epoch: 30 [144/250 18432/32000 (58%)] Loss: 4.15695 (QuantReg: 13.46791) QuantErr: 13.46791 batch_time=0.39869 
Train Epoch: 30 [155/250 19840/32000 (62%)] Loss: 3.93073 (QuantReg: 13.34584) QuantErr: 13.34584 batch_time=0.39330 
Train Epoch: 30 [166/250 21248/32000 (66%)] Loss: 3.52407 (QuantReg: 13.32866) QuantErr: 13.32866 batch_time=0.40136 
Train Epoch: 30 [177/250 22656/32000 (71%)] Loss: 3.64729 (QuantReg: 13.22625) QuantErr: 13.22625 batch_time=0.40182 
Train Epoch: 30 [188/250 24064/32000 (75%)] Loss: 4.48712 (QuantReg: 13.23908) QuantErr: 13.23908 batch_time=0.39407 
Train Epoch: 30 [199/250 25472/32000 (80%)] Loss: 4.25816 (QuantReg: 13.14502) QuantErr: 13.14502 batch_time=0.41263 
Train Epoch: 30 [210/250 26880/32000 (84%)] Loss: 5.16857 (QuantReg: 13.38613) QuantErr: 13.38613 batch_time=2.16628 
Train Epoch: 30 [221/250 28288/32000 (88%)] Loss: 4.35680 (QuantReg: 13.40302) QuantErr: 13.40302 batch_time=0.45606 
Train Epoch: 30 [232/250 29696/32000 (93%)] Loss: 3.96656 (QuantReg: 13.62955) QuantErr: 13.62955 batch_time=0.41196 
Train Epoch: 30 [243/250 31104/32000 (97%)] Loss: 3.61141 (QuantReg: 13.44384) QuantErr: 13.44384 batch_time=0.39892 
Train Epoch: 30 codebook_update_time=0.44871
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch30.pth ...
Done in 4.573s
removing stale ckpt [epoch 29] [took 0.00s]
 epoch          : 30
 loss           : 4.1720136594772335
 quant_reg      : 13.367715209960938
 quant_err      : 13.367715209960938
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.6438631790744465
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.90892770936197
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 76.25754527162978
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.977867203219316
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.49351607833812
 MSRVTT_full_test/t2v_metrics/R1: 12.675585284280936
 MSRVTT_full_test/t2v_metrics/R5: 35.51839464882943
 MSRVTT_full_test/t2v_metrics/R10: 48.12709030100334
 MSRVTT_full_test/t2v_metrics/R50: 79.63210702341136
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.19397993311037
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.878558779767427
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 42.709030100334445
 MSRVTT_full_test/v2t_metrics/R10: 58.19397993311037
 MSRVTT_full_test/v2t_metrics/R50: 85.35117056856187
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.314046822742476
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.07567842336154
 mnt_best       : 28.89386353893123
 not_improved_count: 11
Train Epoch: 31 [1/250 128/32000 (0%)] Loss: 3.98953 (QuantReg: 13.38581) QuantErr: 13.38581 batch_time=35.22411 
Train Epoch: 31 [12/250 1536/32000 (5%)] Loss: 3.76908 (QuantReg: 13.05685) QuantErr: 13.05685 batch_time=0.40195 
Train Epoch: 31 [23/250 2944/32000 (9%)] Loss: 4.74222 (QuantReg: 13.09561) QuantErr: 13.09561 batch_time=0.46588 
Train Epoch: 31 [34/250 4352/32000 (14%)] Loss: 4.11686 (QuantReg: 13.41063) QuantErr: 13.41063 batch_time=0.45251 
Train Epoch: 31 [45/250 5760/32000 (18%)] Loss: 4.21149 (QuantReg: 13.32465) QuantErr: 13.32465 batch_time=0.43961 
Train Epoch: 31 [56/250 7168/32000 (22%)] Loss: 5.10332 (QuantReg: 13.54532) QuantErr: 13.54532 batch_time=0.41260 
Train Epoch: 31 [67/250 8576/32000 (27%)] Loss: 4.32092 (QuantReg: 13.51675) QuantErr: 13.51675 batch_time=0.51473 
Train Epoch: 31 [78/250 9984/32000 (31%)] Loss: 4.26662 (QuantReg: 13.32854) QuantErr: 13.32854 batch_time=0.40576 
Train Epoch: 31 [89/250 11392/32000 (36%)] Loss: 3.93899 (QuantReg: 13.42211) QuantErr: 13.42211 batch_time=0.43266 
Train Epoch: 31 [100/250 12800/32000 (40%)] Loss: 4.14213 (QuantReg: 13.38034) QuantErr: 13.38034 batch_time=0.39083 
Train Epoch: 31 [111/250 14208/32000 (44%)] Loss: 3.56832 (QuantReg: 13.13984) QuantErr: 13.13984 batch_time=0.41836 
Train Epoch: 31 [122/250 15616/32000 (49%)] Loss: 4.70135 (QuantReg: 13.43097) QuantErr: 13.43097 batch_time=0.55397 
Train Epoch: 31 [133/250 17024/32000 (53%)] Loss: 3.97804 (QuantReg: 13.42761) QuantErr: 13.42761 batch_time=1.93236 
Train Epoch: 31 [144/250 18432/32000 (58%)] Loss: 4.85462 (QuantReg: 13.50518) QuantErr: 13.50518 batch_time=0.41794 
Train Epoch: 31 [155/250 19840/32000 (62%)] Loss: 3.66497 (QuantReg: 13.18542) QuantErr: 13.18542 batch_time=0.46123 
Train Epoch: 31 [166/250 21248/32000 (66%)] Loss: 3.52611 (QuantReg: 13.50229) QuantErr: 13.50229 batch_time=0.42407 
Train Epoch: 31 [177/250 22656/32000 (71%)] Loss: 3.58146 (QuantReg: 13.23215) QuantErr: 13.23215 batch_time=0.39399 
Train Epoch: 31 [188/250 24064/32000 (75%)] Loss: 3.90136 (QuantReg: 13.38115) QuantErr: 13.38115 batch_time=0.55017 
Train Epoch: 31 [199/250 25472/32000 (80%)] Loss: 4.40866 (QuantReg: 13.45560) QuantErr: 13.45560 batch_time=0.40236 
Train Epoch: 31 [210/250 26880/32000 (84%)] Loss: 4.51064 (QuantReg: 13.39668) QuantErr: 13.39668 batch_time=0.40669 
Train Epoch: 31 [221/250 28288/32000 (88%)] Loss: 3.95780 (QuantReg: 13.38887) QuantErr: 13.38887 batch_time=0.39709 
Train Epoch: 31 [232/250 29696/32000 (93%)] Loss: 4.34367 (QuantReg: 13.18817) QuantErr: 13.18817 batch_time=0.40801 
Train Epoch: 31 [243/250 31104/32000 (97%)] Loss: 4.62702 (QuantReg: 13.39629) QuantErr: 13.39629 batch_time=0.43591 
Train Epoch: 31 codebook_update_time=0.55864
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch31.pth ...
Done in 6.349s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch31.pth ...
Done in 10.573s
removing stale ckpt [epoch 30] [took 0.00s]
 epoch          : 31
 loss           : 4.137713131904602
 quant_reg      : 13.385299900054932
 quant_err      : 13.385299900054932
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 7750
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.317907444668008
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.343009240044005
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.76056338028169
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.94349204687453
 MSRVTT_full_test/t2v_metrics/R1: 13.612040133779264
 MSRVTT_full_test/t2v_metrics/R5: 37.09030100334448
 MSRVTT_full_test/t2v_metrics/R10: 51.103678929765884
 MSRVTT_full_test/t2v_metrics/R50: 81.23745819397993
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.88645484949833
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.549167388996054
 MSRVTT_full_test/v2t_metrics/R1: 16.254180602006688
 MSRVTT_full_test/v2t_metrics/R5: 43.91304347826087
 MSRVTT_full_test/v2t_metrics/R10: 58.49498327759197
 MSRVTT_full_test/v2t_metrics/R50: 85.85284280936455
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.973076923076924
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.691713139575604
 mnt_best       : 29.549167388996054
 not_improved_count: 0
Train Epoch: 32 [1/250 128/32000 (0%)] Loss: 5.45467 (QuantReg: 13.72589) QuantErr: 13.72589 batch_time=34.25216 
Train Epoch: 32 [12/250 1536/32000 (5%)] Loss: 4.02821 (QuantReg: 13.23438) QuantErr: 13.23438 batch_time=0.39832 
Train Epoch: 32 [23/250 2944/32000 (9%)] Loss: 5.41939 (QuantReg: 13.15296) QuantErr: 13.15296 batch_time=0.44205 
Train Epoch: 32 [34/250 4352/32000 (14%)] Loss: 3.30512 (QuantReg: 13.36327) QuantErr: 13.36327 batch_time=0.38251 
Train Epoch: 32 [45/250 5760/32000 (18%)] Loss: 3.07474 (QuantReg: 13.82881) QuantErr: 13.82881 batch_time=0.41205 
Train Epoch: 32 [56/250 7168/32000 (22%)] Loss: 4.48777 (QuantReg: 13.50846) QuantErr: 13.50846 batch_time=0.39337 
Train Epoch: 32 [67/250 8576/32000 (27%)] Loss: 5.21714 (QuantReg: 13.00282) QuantErr: 13.00282 batch_time=0.43726 
Train Epoch: 32 [78/250 9984/32000 (31%)] Loss: 3.83902 (QuantReg: 13.57335) QuantErr: 13.57335 batch_time=0.38640 
Train Epoch: 32 [89/250 11392/32000 (36%)] Loss: 3.44860 (QuantReg: 13.48944) QuantErr: 13.48944 batch_time=0.44801 
Train Epoch: 32 [100/250 12800/32000 (40%)] Loss: 3.80165 (QuantReg: 13.68295) QuantErr: 13.68295 batch_time=0.41644 
Train Epoch: 32 [111/250 14208/32000 (44%)] Loss: 3.92265 (QuantReg: 13.40173) QuantErr: 13.40173 batch_time=0.52846 
Train Epoch: 32 [122/250 15616/32000 (49%)] Loss: 4.97359 (QuantReg: 13.51701) QuantErr: 13.51701 batch_time=0.39793 
Train Epoch: 32 [133/250 17024/32000 (53%)] Loss: 3.99829 (QuantReg: 13.38880) QuantErr: 13.38880 batch_time=0.39682 
Train Epoch: 32 [144/250 18432/32000 (58%)] Loss: 3.97224 (QuantReg: 13.68396) QuantErr: 13.68396 batch_time=0.40800 
Train Epoch: 32 [155/250 19840/32000 (62%)] Loss: 5.23003 (QuantReg: 13.39768) QuantErr: 13.39768 batch_time=0.42292 
Train Epoch: 32 [166/250 21248/32000 (66%)] Loss: 2.97059 (QuantReg: 13.57576) QuantErr: 13.57576 batch_time=0.39621 
Train Epoch: 32 [177/250 22656/32000 (71%)] Loss: 3.94695 (QuantReg: 13.43324) QuantErr: 13.43324 batch_time=0.40992 
Train Epoch: 32 [188/250 24064/32000 (75%)] Loss: 3.41203 (QuantReg: 13.39891) QuantErr: 13.39891 batch_time=0.38727 
Train Epoch: 32 [199/250 25472/32000 (80%)] Loss: 3.12920 (QuantReg: 13.49018) QuantErr: 13.49018 batch_time=0.42875 
Train Epoch: 32 [210/250 26880/32000 (84%)] Loss: 3.54735 (QuantReg: 13.50672) QuantErr: 13.50672 batch_time=0.39205 
Train Epoch: 32 [221/250 28288/32000 (88%)] Loss: 4.90037 (QuantReg: 13.25216) QuantErr: 13.25216 batch_time=0.38794 
Train Epoch: 32 [232/250 29696/32000 (93%)] Loss: 4.03129 (QuantReg: 13.20337) QuantErr: 13.20337 batch_time=0.41486 
Train Epoch: 32 [243/250 31104/32000 (97%)] Loss: 3.56836 (QuantReg: 13.10164) QuantErr: 13.10164 batch_time=0.44837 
Train Epoch: 32 codebook_update_time=0.54463
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch32.pth ...
Done in 14.928s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 4.119746831893921
 quant_reg      : 13.392701927185058
 quant_err      : 13.392701927185058
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.199195171026158
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.6039929882912
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 73.44064386317908
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.00804828973843
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.016539959839896
 MSRVTT_full_test/t2v_metrics/R1: 12.94314381270903
 MSRVTT_full_test/t2v_metrics/R5: 35.986622073578594
 MSRVTT_full_test/t2v_metrics/R10: 48.929765886287626
 MSRVTT_full_test/t2v_metrics/R50: 79.23076923076923
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 50.41036789297659
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.352063038981434
 MSRVTT_full_test/v2t_metrics/R1: 15.68561872909699
 MSRVTT_full_test/v2t_metrics/R5: 42.34113712374582
 MSRVTT_full_test/v2t_metrics/R10: 57.391304347826086
 MSRVTT_full_test/v2t_metrics/R50: 85.41806020066889
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.329765886287625
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.65400505646476
 mnt_best       : 29.549167388996054
 not_improved_count: 1
Train Epoch: 33 [1/250 128/32000 (0%)] Loss: 5.11843 (QuantReg: 13.42234) QuantErr: 13.42234 batch_time=34.19382 
Train Epoch: 33 [12/250 1536/32000 (5%)] Loss: 3.76523 (QuantReg: 13.26128) QuantErr: 13.26128 batch_time=0.42491 
Train Epoch: 33 [23/250 2944/32000 (9%)] Loss: 3.96605 (QuantReg: 13.46215) QuantErr: 13.46215 batch_time=0.41837 
Train Epoch: 33 [34/250 4352/32000 (14%)] Loss: 5.55207 (QuantReg: 13.42561) QuantErr: 13.42561 batch_time=0.40375 
Train Epoch: 33 [45/250 5760/32000 (18%)] Loss: 4.74186 (QuantReg: 13.29284) QuantErr: 13.29284 batch_time=0.40184 
Train Epoch: 33 [56/250 7168/32000 (22%)] Loss: 5.26264 (QuantReg: 13.38589) QuantErr: 13.38589 batch_time=0.47284 
Train Epoch: 33 [67/250 8576/32000 (27%)] Loss: 4.42945 (QuantReg: 13.44964) QuantErr: 13.44964 batch_time=0.40025 
Train Epoch: 33 [78/250 9984/32000 (31%)] Loss: 4.30174 (QuantReg: 13.35741) QuantErr: 13.35741 batch_time=0.41864 
Train Epoch: 33 [89/250 11392/32000 (36%)] Loss: 4.36261 (QuantReg: 13.54425) QuantErr: 13.54425 batch_time=0.38582 
Train Epoch: 33 [100/250 12800/32000 (40%)] Loss: 3.30501 (QuantReg: 13.51574) QuantErr: 13.51574 batch_time=0.40675 
Train Epoch: 33 [111/250 14208/32000 (44%)] Loss: 5.20381 (QuantReg: 13.10760) QuantErr: 13.10760 batch_time=0.44955 
Train Epoch: 33 [122/250 15616/32000 (49%)] Loss: 4.03788 (QuantReg: 13.34538) QuantErr: 13.34538 batch_time=0.44380 
Train Epoch: 33 [133/250 17024/32000 (53%)] Loss: 3.40826 (QuantReg: 13.46416) QuantErr: 13.46416 batch_time=4.19340 
Train Epoch: 33 [144/250 18432/32000 (58%)] Loss: 4.70952 (QuantReg: 13.30800) QuantErr: 13.30800 batch_time=0.40762 
Train Epoch: 33 [155/250 19840/32000 (62%)] Loss: 3.73745 (QuantReg: 13.11951) QuantErr: 13.11951 batch_time=1.73319 
Train Epoch: 33 [166/250 21248/32000 (66%)] Loss: 4.80355 (QuantReg: 13.28984) QuantErr: 13.28984 batch_time=0.44409 
Train Epoch: 33 [177/250 22656/32000 (71%)] Loss: 4.35957 (QuantReg: 13.35850) QuantErr: 13.35850 batch_time=0.42417 
Train Epoch: 33 [188/250 24064/32000 (75%)] Loss: 4.69014 (QuantReg: 13.06373) QuantErr: 13.06373 batch_time=0.38975 
Train Epoch: 33 [199/250 25472/32000 (80%)] Loss: 3.47833 (QuantReg: 13.58811) QuantErr: 13.58811 batch_time=0.43233 
Train Epoch: 33 [210/250 26880/32000 (84%)] Loss: 4.11708 (QuantReg: 13.37499) QuantErr: 13.37499 batch_time=0.40827 
Train Epoch: 33 [221/250 28288/32000 (88%)] Loss: 3.42658 (QuantReg: 13.26108) QuantErr: 13.26108 batch_time=0.39086 
Train Epoch: 33 [232/250 29696/32000 (93%)] Loss: 3.48284 (QuantReg: 13.59807) QuantErr: 13.59807 batch_time=0.41257 
Train Epoch: 33 [243/250 31104/32000 (97%)] Loss: 3.96081 (QuantReg: 13.57138) QuantErr: 13.57138 batch_time=0.39167 
Train Epoch: 33 codebook_update_time=0.85669
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch33.pth ...
Done in 22.123s
removing stale ckpt [epoch 32] [took 0.00s]
 epoch          : 33
 loss           : 4.1064816102981565
 quant_reg      : 13.397573635101319
 quant_err      : 13.397573635101319
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 8250
 MSRVTT_full_val/t2v_metrics/R1: 35.412474849094565
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.963782696177063
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.30566706439161
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 85.51307847082495
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.7645875251509056
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.97585602880933
 MSRVTT_full_test/t2v_metrics/R1: 13.277591973244148
 MSRVTT_full_test/t2v_metrics/R5: 37.591973244147155
 MSRVTT_full_test/t2v_metrics/R10: 50.802675585284284
 MSRVTT_full_test/t2v_metrics/R50: 80.40133779264214
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.170234113712375
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.3787744908577
 MSRVTT_full_test/v2t_metrics/R1: 17.123745819397993
 MSRVTT_full_test/v2t_metrics/R5: 44.68227424749164
 MSRVTT_full_test/v2t_metrics/R10: 59.130434782608695
 MSRVTT_full_test/v2t_metrics/R50: 86.5886287625418
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.974749163879597
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.632670477008666
 mnt_best       : 29.549167388996054
 not_improved_count: 2
Train Epoch: 34 [1/250 128/32000 (0%)] Loss: 4.56701 (QuantReg: 13.35318) QuantErr: 13.35318 batch_time=36.38230 
Train Epoch: 34 [12/250 1536/32000 (5%)] Loss: 3.66216 (QuantReg: 13.42639) QuantErr: 13.42639 batch_time=7.16353 
Train Epoch: 34 [23/250 2944/32000 (9%)] Loss: 4.62865 (QuantReg: 13.23319) QuantErr: 13.23319 batch_time=0.40906 
Train Epoch: 34 [34/250 4352/32000 (14%)] Loss: 3.96743 (QuantReg: 13.21983) QuantErr: 13.21983 batch_time=0.45047 
Train Epoch: 34 [45/250 5760/32000 (18%)] Loss: 4.04234 (QuantReg: 13.27141) QuantErr: 13.27141 batch_time=0.39452 
Train Epoch: 34 [56/250 7168/32000 (22%)] Loss: 4.95238 (QuantReg: 13.24607) QuantErr: 13.24607 batch_time=0.39730 
Train Epoch: 34 [67/250 8576/32000 (27%)] Loss: 3.53139 (QuantReg: 13.43526) QuantErr: 13.43526 batch_time=0.41926 
Train Epoch: 34 [78/250 9984/32000 (31%)] Loss: 3.48812 (QuantReg: 13.51317) QuantErr: 13.51317 batch_time=0.40037 
Train Epoch: 34 [89/250 11392/32000 (36%)] Loss: 4.41843 (QuantReg: 13.18275) QuantErr: 13.18275 batch_time=0.39115 
Train Epoch: 34 [100/250 12800/32000 (40%)] Loss: 3.39583 (QuantReg: 13.67212) QuantErr: 13.67212 batch_time=0.43397 
Train Epoch: 34 [111/250 14208/32000 (44%)] Loss: 3.63945 (QuantReg: 13.54773) QuantErr: 13.54773 batch_time=0.39466 
Train Epoch: 34 [122/250 15616/32000 (49%)] Loss: 4.64568 (QuantReg: 13.28987) QuantErr: 13.28987 batch_time=0.40341 
Train Epoch: 34 [133/250 17024/32000 (53%)] Loss: 3.35075 (QuantReg: 13.48748) QuantErr: 13.48748 batch_time=0.46238 
Train Epoch: 34 [144/250 18432/32000 (58%)] Loss: 4.95864 (QuantReg: 13.31448) QuantErr: 13.31448 batch_time=0.44155 
Train Epoch: 34 [155/250 19840/32000 (62%)] Loss: 4.62206 (QuantReg: 13.28033) QuantErr: 13.28033 batch_time=0.41039 
Train Epoch: 34 [166/250 21248/32000 (66%)] Loss: 4.09323 (QuantReg: 13.21577) QuantErr: 13.21577 batch_time=0.40758 
Train Epoch: 34 [177/250 22656/32000 (71%)] Loss: 3.83679 (QuantReg: 13.68185) QuantErr: 13.68185 batch_time=0.44083 
Train Epoch: 34 [188/250 24064/32000 (75%)] Loss: 4.14040 (QuantReg: 13.41346) QuantErr: 13.41346 batch_time=0.75092 
Train Epoch: 34 [199/250 25472/32000 (80%)] Loss: 4.79267 (QuantReg: 13.37827) QuantErr: 13.37827 batch_time=0.44133 
Train Epoch: 34 [210/250 26880/32000 (84%)] Loss: 3.13436 (QuantReg: 13.61210) QuantErr: 13.61210 batch_time=0.40470 
Train Epoch: 34 [221/250 28288/32000 (88%)] Loss: 5.09363 (QuantReg: 13.14814) QuantErr: 13.14814 batch_time=0.39719 
Train Epoch: 34 [232/250 29696/32000 (93%)] Loss: 4.38188 (QuantReg: 13.38046) QuantErr: 13.38046 batch_time=0.44922 
Train Epoch: 34 [243/250 31104/32000 (97%)] Loss: 4.39470 (QuantReg: 13.24410) QuantErr: 13.24410 batch_time=0.41316 
Train Epoch: 34 codebook_update_time=0.50859
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch34.pth ...
Done in 4.065s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch34.pth ...
Done in 8.023s
removing stale ckpt [epoch 33] [took 0.00s]
 epoch          : 34
 loss           : 4.055946758270264
 quant_reg      : 13.417135982513427
 quant_err      : 13.417135982513427
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.583501006036217
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.72667476834475
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 75.45271629778672
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.903420523138833
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.30778933264484
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 37.424749163879596
 MSRVTT_full_test/t2v_metrics/R10: 50.468227424749166
 MSRVTT_full_test/t2v_metrics/R50: 81.10367892976589
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.176923076923075
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.8489656164837
 MSRVTT_full_test/v2t_metrics/R1: 17.023411371237458
 MSRVTT_full_test/v2t_metrics/R5: 44.414715719063544
 MSRVTT_full_test/v2t_metrics/R10: 59.364548494983275
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.32441471571906
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.53859192275201
 mnt_best       : 29.8489656164837
 not_improved_count: 0
Train Epoch: 35 [1/250 128/32000 (0%)] Loss: 4.77962 (QuantReg: 13.38430) QuantErr: 13.38430 batch_time=31.68202 
Train Epoch: 35 [12/250 1536/32000 (5%)] Loss: 4.13688 (QuantReg: 13.49841) QuantErr: 13.49841 batch_time=0.41052 
Train Epoch: 35 [23/250 2944/32000 (9%)] Loss: 3.93648 (QuantReg: 13.56303) QuantErr: 13.56303 batch_time=0.43373 
Train Epoch: 35 [34/250 4352/32000 (14%)] Loss: 4.21273 (QuantReg: 13.44246) QuantErr: 13.44246 batch_time=0.38019 
Train Epoch: 35 [45/250 5760/32000 (18%)] Loss: 4.49488 (QuantReg: 13.38874) QuantErr: 13.38874 batch_time=0.44667 
Train Epoch: 35 [56/250 7168/32000 (22%)] Loss: 4.19860 (QuantReg: 13.23853) QuantErr: 13.23853 batch_time=0.42249 
Train Epoch: 35 [67/250 8576/32000 (27%)] Loss: 3.50104 (QuantReg: 13.57387) QuantErr: 13.57387 batch_time=2.88044 
Train Epoch: 35 [78/250 9984/32000 (31%)] Loss: 3.99877 (QuantReg: 13.22681) QuantErr: 13.22681 batch_time=0.42705 
Train Epoch: 35 [89/250 11392/32000 (36%)] Loss: 4.43269 (QuantReg: 13.56111) QuantErr: 13.56111 batch_time=0.39576 
Train Epoch: 35 [100/250 12800/32000 (40%)] Loss: 4.77830 (QuantReg: 13.66899) QuantErr: 13.66899 batch_time=0.40651 
Train Epoch: 35 [111/250 14208/32000 (44%)] Loss: 4.33741 (QuantReg: 13.21546) QuantErr: 13.21546 batch_time=0.38497 
Train Epoch: 35 [122/250 15616/32000 (49%)] Loss: 3.73185 (QuantReg: 13.32462) QuantErr: 13.32462 batch_time=0.38633 
Train Epoch: 35 [133/250 17024/32000 (53%)] Loss: 3.70019 (QuantReg: 13.53621) QuantErr: 13.53621 batch_time=0.39913 
Train Epoch: 35 [144/250 18432/32000 (58%)] Loss: 4.28080 (QuantReg: 13.66809) QuantErr: 13.66809 batch_time=0.89496 
Train Epoch: 35 [155/250 19840/32000 (62%)] Loss: 2.80065 (QuantReg: 13.50233) QuantErr: 13.50233 batch_time=0.38516 
Train Epoch: 35 [166/250 21248/32000 (66%)] Loss: 5.32879 (QuantReg: 13.20975) QuantErr: 13.20975 batch_time=0.39216 
Train Epoch: 35 [177/250 22656/32000 (71%)] Loss: 3.39908 (QuantReg: 13.38814) QuantErr: 13.38814 batch_time=0.43071 
Train Epoch: 35 [188/250 24064/32000 (75%)] Loss: 3.57162 (QuantReg: 13.54851) QuantErr: 13.54851 batch_time=0.71918 
Train Epoch: 35 [199/250 25472/32000 (80%)] Loss: 3.85526 (QuantReg: 13.31927) QuantErr: 13.31927 batch_time=0.38257 
Train Epoch: 35 [210/250 26880/32000 (84%)] Loss: 3.79953 (QuantReg: 13.36753) QuantErr: 13.36753 batch_time=0.42274 
Train Epoch: 35 [221/250 28288/32000 (88%)] Loss: 4.78950 (QuantReg: 13.58573) QuantErr: 13.58573 batch_time=0.38744 
Train Epoch: 35 [232/250 29696/32000 (93%)] Loss: 3.89710 (QuantReg: 13.75035) QuantErr: 13.75035 batch_time=0.81969 
Train Epoch: 35 [243/250 31104/32000 (97%)] Loss: 3.91841 (QuantReg: 13.47746) QuantErr: 13.47746 batch_time=0.39201 
Train Epoch: 35 codebook_update_time=0.44864
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch35.pth ...
Done in 12.941s
removing stale ckpt [epoch 34] [took 0.00s]
 epoch          : 35
 loss           : 4.092947848320008
 quant_reg      : 13.438552780151367
 quant_err      : 13.438552780151367
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 8750
 MSRVTT_full_val/t2v_metrics/R1: 34.00402414486921
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.022132796780685
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.32628814203851
 MSRVTT_full_val/v2t_metrics/R1: 41.64989939637827
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.778672032193159
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.5501797380633
 MSRVTT_full_test/t2v_metrics/R1: 13.311036789297658
 MSRVTT_full_test/t2v_metrics/R5: 36.75585284280937
 MSRVTT_full_test/t2v_metrics/R10: 50.2675585284281
 MSRVTT_full_test/t2v_metrics/R50: 80.70234113712375
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.06555183946488
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.08095917362496
 MSRVTT_full_test/v2t_metrics/R1: 16.187290969899667
 MSRVTT_full_test/v2t_metrics/R5: 43.91304347826087
 MSRVTT_full_test/v2t_metrics/R10: 59.46488294314381
 MSRVTT_full_test/v2t_metrics/R50: 86.18729096989966
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.023745819397995
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.83448758622657
 mnt_best       : 29.8489656164837
 not_improved_count: 1
Train Epoch: 36 [1/250 128/32000 (0%)] Loss: 3.14511 (QuantReg: 13.67968) QuantErr: 13.67968 batch_time=42.62183 
Train Epoch: 36 [12/250 1536/32000 (5%)] Loss: 3.95996 (QuantReg: 13.62603) QuantErr: 13.62603 batch_time=0.40200 
Train Epoch: 36 [23/250 2944/32000 (9%)] Loss: 3.97613 (QuantReg: 13.44793) QuantErr: 13.44793 batch_time=0.40465 
Train Epoch: 36 [34/250 4352/32000 (14%)] Loss: 3.46307 (QuantReg: 13.33379) QuantErr: 13.33379 batch_time=0.41263 
Train Epoch: 36 [45/250 5760/32000 (18%)] Loss: 3.60195 (QuantReg: 13.43434) QuantErr: 13.43434 batch_time=0.40684 
Train Epoch: 36 [56/250 7168/32000 (22%)] Loss: 4.17868 (QuantReg: 13.55394) QuantErr: 13.55394 batch_time=0.44936 
Train Epoch: 36 [67/250 8576/32000 (27%)] Loss: 4.07012 (QuantReg: 13.49821) QuantErr: 13.49821 batch_time=0.69522 
Train Epoch: 36 [78/250 9984/32000 (31%)] Loss: 4.16193 (QuantReg: 13.44924) QuantErr: 13.44924 batch_time=0.40631 
Train Epoch: 36 [89/250 11392/32000 (36%)] Loss: 3.49035 (QuantReg: 13.58410) QuantErr: 13.58410 batch_time=0.40126 
Train Epoch: 36 [100/250 12800/32000 (40%)] Loss: 5.34764 (QuantReg: 13.38111) QuantErr: 13.38111 batch_time=0.41365 
Train Epoch: 36 [111/250 14208/32000 (44%)] Loss: 3.55978 (QuantReg: 13.51999) QuantErr: 13.51999 batch_time=0.39300 
Train Epoch: 36 [122/250 15616/32000 (49%)] Loss: 5.70723 (QuantReg: 13.21459) QuantErr: 13.21459 batch_time=0.41272 
Train Epoch: 36 [133/250 17024/32000 (53%)] Loss: 4.48535 (QuantReg: 13.42633) QuantErr: 13.42633 batch_time=0.39977 
Train Epoch: 36 [144/250 18432/32000 (58%)] Loss: 4.53894 (QuantReg: 13.48534) QuantErr: 13.48534 batch_time=0.39746 
Train Epoch: 36 [155/250 19840/32000 (62%)] Loss: 4.18304 (QuantReg: 13.64624) QuantErr: 13.64624 batch_time=0.40750 
Train Epoch: 36 [166/250 21248/32000 (66%)] Loss: 3.83939 (QuantReg: 13.73224) QuantErr: 13.73224 batch_time=0.39986 
Train Epoch: 36 [177/250 22656/32000 (71%)] Loss: 4.67561 (QuantReg: 13.52456) QuantErr: 13.52456 batch_time=0.39979 
Train Epoch: 36 [188/250 24064/32000 (75%)] Loss: 5.00506 (QuantReg: 13.25236) QuantErr: 13.25236 batch_time=0.41029 
Train Epoch: 36 [199/250 25472/32000 (80%)] Loss: 3.38523 (QuantReg: 13.43438) QuantErr: 13.43438 batch_time=0.40279 
Train Epoch: 36 [210/250 26880/32000 (84%)] Loss: 3.45287 (QuantReg: 13.29584) QuantErr: 13.29584 batch_time=2.12714 
Train Epoch: 36 [221/250 28288/32000 (88%)] Loss: 3.33140 (QuantReg: 13.40634) QuantErr: 13.40634 batch_time=0.41137 
Train Epoch: 36 [232/250 29696/32000 (93%)] Loss: 3.55118 (QuantReg: 13.57675) QuantErr: 13.57675 batch_time=0.40157 
Train Epoch: 36 [243/250 31104/32000 (97%)] Loss: 4.29069 (QuantReg: 13.48407) QuantErr: 13.48407 batch_time=0.42717 
Train Epoch: 36 codebook_update_time=0.45109
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch36.pth ...
Done in 4.169s
removing stale ckpt [epoch 35] [took 0.00s]
 epoch          : 36
 loss           : 3.975114150047302
 quant_reg      : 13.444333286285401
 quant_err      : 13.444333286285401
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.804828973843058
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.15536739421277
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.03420523138833
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.00094669946468
 MSRVTT_full_test/t2v_metrics/R1: 13.678929765886288
 MSRVTT_full_test/t2v_metrics/R5: 37.05685618729097
 MSRVTT_full_test/t2v_metrics/R10: 51.30434782608695
 MSRVTT_full_test/t2v_metrics/R50: 80.2675585284281
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.494314381270904
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.627269023388596
 MSRVTT_full_test/v2t_metrics/R1: 16.48829431438127
 MSRVTT_full_test/v2t_metrics/R5: 44.247491638795985
 MSRVTT_full_test/v2t_metrics/R10: 59.69899665551839
 MSRVTT_full_test/v2t_metrics/R50: 86.65551839464882
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.598996655518395
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.18388611830483
 mnt_best       : 29.8489656164837
 not_improved_count: 2
Train Epoch: 37 [1/250 128/32000 (0%)] Loss: 4.70887 (QuantReg: 13.33740) QuantErr: 13.33740 batch_time=33.86955 
Train Epoch: 37 [12/250 1536/32000 (5%)] Loss: 4.88557 (QuantReg: 13.45416) QuantErr: 13.45416 batch_time=0.63765 
Train Epoch: 37 [23/250 2944/32000 (9%)] Loss: 4.08603 (QuantReg: 13.04874) QuantErr: 13.04874 batch_time=0.40226 
Train Epoch: 37 [34/250 4352/32000 (14%)] Loss: 3.51519 (QuantReg: 13.55157) QuantErr: 13.55157 batch_time=0.40379 
Train Epoch: 37 [45/250 5760/32000 (18%)] Loss: 3.59018 (QuantReg: 13.24821) QuantErr: 13.24821 batch_time=0.40312 
Train Epoch: 37 [56/250 7168/32000 (22%)] Loss: 3.67311 (QuantReg: 13.56883) QuantErr: 13.56883 batch_time=0.39661 
Train Epoch: 37 [67/250 8576/32000 (27%)] Loss: 4.60586 (QuantReg: 13.42217) QuantErr: 13.42217 batch_time=0.41215 
Train Epoch: 37 [78/250 9984/32000 (31%)] Loss: 3.67475 (QuantReg: 13.52262) QuantErr: 13.52262 batch_time=0.38919 
Train Epoch: 37 [89/250 11392/32000 (36%)] Loss: 4.70582 (QuantReg: 13.19227) QuantErr: 13.19227 batch_time=0.38475 
Train Epoch: 37 [100/250 12800/32000 (40%)] Loss: 3.86289 (QuantReg: 13.64337) QuantErr: 13.64337 batch_time=0.41607 
Train Epoch: 37 [111/250 14208/32000 (44%)] Loss: 2.93189 (QuantReg: 13.63323) QuantErr: 13.63323 batch_time=0.42900 
Train Epoch: 37 [122/250 15616/32000 (49%)] Loss: 3.43552 (QuantReg: 13.27796) QuantErr: 13.27796 batch_time=0.40632 
Train Epoch: 37 [133/250 17024/32000 (53%)] Loss: 3.71442 (QuantReg: 13.58455) QuantErr: 13.58455 batch_time=1.33169 
Train Epoch: 37 [144/250 18432/32000 (58%)] Loss: 4.54974 (QuantReg: 13.57953) QuantErr: 13.57953 batch_time=0.40016 
Train Epoch: 37 [155/250 19840/32000 (62%)] Loss: 5.11724 (QuantReg: 13.01890) QuantErr: 13.01890 batch_time=0.40165 
Train Epoch: 37 [166/250 21248/32000 (66%)] Loss: 3.79535 (QuantReg: 13.50859) QuantErr: 13.50859 batch_time=0.40132 
Train Epoch: 37 [177/250 22656/32000 (71%)] Loss: 2.64164 (QuantReg: 13.53988) QuantErr: 13.53988 batch_time=0.45016 
Train Epoch: 37 [188/250 24064/32000 (75%)] Loss: 3.99759 (QuantReg: 13.27190) QuantErr: 13.27190 batch_time=0.39417 
Train Epoch: 37 [199/250 25472/32000 (80%)] Loss: 3.68713 (QuantReg: 13.52714) QuantErr: 13.52714 batch_time=2.10358 
Train Epoch: 37 [210/250 26880/32000 (84%)] Loss: 4.29544 (QuantReg: 13.53972) QuantErr: 13.53972 batch_time=0.41184 
Train Epoch: 37 [221/250 28288/32000 (88%)] Loss: 4.57947 (QuantReg: 13.55455) QuantErr: 13.55455 batch_time=0.38193 
Train Epoch: 37 [232/250 29696/32000 (93%)] Loss: 3.70250 (QuantReg: 13.79075) QuantErr: 13.79075 batch_time=0.87918 
Train Epoch: 37 [243/250 31104/32000 (97%)] Loss: 4.55061 (QuantReg: 13.29009) QuantErr: 13.29009 batch_time=0.40807 
Train Epoch: 37 codebook_update_time=0.43511
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch37.pth ...
Done in 4.136s
removing stale ckpt [epoch 36] [took 0.00s]
 epoch          : 37
 loss           : 3.9892946004867555
 quant_reg      : 13.417264572143555
 quant_err      : 13.417264572143555
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 9250
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 80.0804828973843
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.754527162977867
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.006912612008584
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 86.11670020120724
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.72635814889336
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.35604509066888
 MSRVTT_full_test/t2v_metrics/R1: 13.545150501672241
 MSRVTT_full_test/t2v_metrics/R5: 37.290969899665555
 MSRVTT_full_test/t2v_metrics/R10: 51.60535117056856
 MSRVTT_full_test/t2v_metrics/R50: 80.80267558528428
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.59030100334448
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.650185667327595
 MSRVTT_full_test/v2t_metrics/R1: 16.82274247491639
 MSRVTT_full_test/v2t_metrics/R5: 44.080267558528426
 MSRVTT_full_test/v2t_metrics/R10: 59.163879598662206
 MSRVTT_full_test/v2t_metrics/R50: 86.5886287625418
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.803010033444817
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.26949335465258
 mnt_best       : 29.8489656164837
 not_improved_count: 3
Train Epoch: 38 [1/250 128/32000 (0%)] Loss: 3.19312 (QuantReg: 13.54640) QuantErr: 13.54640 batch_time=34.90407 
Train Epoch: 38 [12/250 1536/32000 (5%)] Loss: 4.62629 (QuantReg: 13.17114) QuantErr: 13.17114 batch_time=0.41995 
Train Epoch: 38 [23/250 2944/32000 (9%)] Loss: 3.80623 (QuantReg: 13.44126) QuantErr: 13.44126 batch_time=0.40399 
Train Epoch: 38 [34/250 4352/32000 (14%)] Loss: 3.51802 (QuantReg: 13.48739) QuantErr: 13.48739 batch_time=0.40773 
Train Epoch: 38 [45/250 5760/32000 (18%)] Loss: 3.14184 (QuantReg: 13.48281) QuantErr: 13.48281 batch_time=0.40738 
Train Epoch: 38 [56/250 7168/32000 (22%)] Loss: 3.33415 (QuantReg: 13.10298) QuantErr: 13.10298 batch_time=0.40100 
Train Epoch: 38 [67/250 8576/32000 (27%)] Loss: 4.32128 (QuantReg: 13.70149) QuantErr: 13.70149 batch_time=0.38381 
Train Epoch: 38 [78/250 9984/32000 (31%)] Loss: 3.61648 (QuantReg: 13.47928) QuantErr: 13.47928 batch_time=1.69081 
Train Epoch: 38 [89/250 11392/32000 (36%)] Loss: 4.72987 (QuantReg: 13.12229) QuantErr: 13.12229 batch_time=0.42377 
Train Epoch: 38 [100/250 12800/32000 (40%)] Loss: 4.03236 (QuantReg: 13.37133) QuantErr: 13.37133 batch_time=0.43481 
Train Epoch: 38 [111/250 14208/32000 (44%)] Loss: 3.94750 (QuantReg: 13.39560) QuantErr: 13.39560 batch_time=0.40870 
Train Epoch: 38 [122/250 15616/32000 (49%)] Loss: 4.42073 (QuantReg: 13.42326) QuantErr: 13.42326 batch_time=0.40699 
Train Epoch: 38 [133/250 17024/32000 (53%)] Loss: 3.40276 (QuantReg: 13.45040) QuantErr: 13.45040 batch_time=0.41310 
Train Epoch: 38 [144/250 18432/32000 (58%)] Loss: 4.35961 (QuantReg: 13.39974) QuantErr: 13.39974 batch_time=0.38143 
Train Epoch: 38 [155/250 19840/32000 (62%)] Loss: 4.33769 (QuantReg: 13.36366) QuantErr: 13.36366 batch_time=0.68061 
Train Epoch: 38 [166/250 21248/32000 (66%)] Loss: 4.53353 (QuantReg: 13.60607) QuantErr: 13.60607 batch_time=0.41406 
Train Epoch: 38 [177/250 22656/32000 (71%)] Loss: 3.91118 (QuantReg: 13.58206) QuantErr: 13.58206 batch_time=0.40207 
Train Epoch: 38 [188/250 24064/32000 (75%)] Loss: 3.97741 (QuantReg: 13.57537) QuantErr: 13.57537 batch_time=0.40124 
Train Epoch: 38 [199/250 25472/32000 (80%)] Loss: 4.45408 (QuantReg: 13.23613) QuantErr: 13.23613 batch_time=0.41750 
Train Epoch: 38 [210/250 26880/32000 (84%)] Loss: 3.01633 (QuantReg: 13.47071) QuantErr: 13.47071 batch_time=0.42058 
Train Epoch: 38 [221/250 28288/32000 (88%)] Loss: 4.98575 (QuantReg: 13.18438) QuantErr: 13.18438 batch_time=0.40067 
Train Epoch: 38 [232/250 29696/32000 (93%)] Loss: 3.33206 (QuantReg: 13.67578) QuantErr: 13.67578 batch_time=0.41842 
Train Epoch: 38 [243/250 31104/32000 (97%)] Loss: 4.92856 (QuantReg: 13.34039) QuantErr: 13.34039 batch_time=0.39070 
Train Epoch: 38 codebook_update_time=0.41326
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch38.pth ...
Done in 3.862s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 3.9211885843276977
 quant_reg      : 13.462145290374757
 quant_err      : 13.462145290374757
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 96.17706237424547
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.480885311871226
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.014774529686285
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.046277665995976
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.22123517275193
 MSRVTT_full_test/t2v_metrics/R1: 13.244147157190636
 MSRVTT_full_test/t2v_metrics/R5: 36.08695652173913
 MSRVTT_full_test/t2v_metrics/R10: 50.76923076923077
 MSRVTT_full_test/t2v_metrics/R50: 80.66889632107024
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.58695652173913
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.950647341022492
 MSRVTT_full_test/v2t_metrics/R1: 15.451505016722408
 MSRVTT_full_test/v2t_metrics/R5: 43.64548494983278
 MSRVTT_full_test/v2t_metrics/R10: 58.82943143812709
 MSRVTT_full_test/v2t_metrics/R50: 86.0200668896321
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.57090301003345
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.10632456235755
 mnt_best       : 29.8489656164837
 not_improved_count: 4
Train Epoch: 39 [1/250 128/32000 (0%)] Loss: 4.24028 (QuantReg: 13.67450) QuantErr: 13.67450 batch_time=33.64108 
Train Epoch: 39 [12/250 1536/32000 (5%)] Loss: 3.97750 (QuantReg: 13.37936) QuantErr: 13.37936 batch_time=0.40004 
Train Epoch: 39 [23/250 2944/32000 (9%)] Loss: 4.00235 (QuantReg: 13.55916) QuantErr: 13.55916 batch_time=4.05000 
Train Epoch: 39 [34/250 4352/32000 (14%)] Loss: 3.61712 (QuantReg: 13.38623) QuantErr: 13.38623 batch_time=0.41850 
Train Epoch: 39 [45/250 5760/32000 (18%)] Loss: 4.78619 (QuantReg: 13.40891) QuantErr: 13.40891 batch_time=0.40621 
Train Epoch: 39 [56/250 7168/32000 (22%)] Loss: 3.31948 (QuantReg: 13.41693) QuantErr: 13.41693 batch_time=0.39780 
Train Epoch: 39 [67/250 8576/32000 (27%)] Loss: 4.59310 (QuantReg: 13.02471) QuantErr: 13.02471 batch_time=0.38827 
Train Epoch: 39 [78/250 9984/32000 (31%)] Loss: 4.30553 (QuantReg: 13.57244) QuantErr: 13.57244 batch_time=0.51820 
Train Epoch: 39 [89/250 11392/32000 (36%)] Loss: 4.85571 (QuantReg: 13.54420) QuantErr: 13.54420 batch_time=0.40587 
Train Epoch: 39 [100/250 12800/32000 (40%)] Loss: 2.87075 (QuantReg: 13.74627) QuantErr: 13.74627 batch_time=0.61695 
Train Epoch: 39 [111/250 14208/32000 (44%)] Loss: 4.00599 (QuantReg: 13.34208) QuantErr: 13.34208 batch_time=0.39964 
Train Epoch: 39 [122/250 15616/32000 (49%)] Loss: 3.98270 (QuantReg: 13.36041) QuantErr: 13.36041 batch_time=0.40027 
Train Epoch: 39 [133/250 17024/32000 (53%)] Loss: 4.34434 (QuantReg: 13.25785) QuantErr: 13.25785 batch_time=0.41024 
Train Epoch: 39 [144/250 18432/32000 (58%)] Loss: 3.25725 (QuantReg: 13.45231) QuantErr: 13.45231 batch_time=0.40399 
Train Epoch: 39 [155/250 19840/32000 (62%)] Loss: 4.52821 (QuantReg: 13.34186) QuantErr: 13.34186 batch_time=0.39711 
Train Epoch: 39 [166/250 21248/32000 (66%)] Loss: 3.59510 (QuantReg: 13.65354) QuantErr: 13.65354 batch_time=0.39755 
Train Epoch: 39 [177/250 22656/32000 (71%)] Loss: 4.38655 (QuantReg: 13.37641) QuantErr: 13.37641 batch_time=0.40252 
Train Epoch: 39 [188/250 24064/32000 (75%)] Loss: 2.91969 (QuantReg: 13.75428) QuantErr: 13.75428 batch_time=0.40346 
Train Epoch: 39 [199/250 25472/32000 (80%)] Loss: 3.70497 (QuantReg: 13.76541) QuantErr: 13.76541 batch_time=0.39745 
Train Epoch: 39 [210/250 26880/32000 (84%)] Loss: 4.18479 (QuantReg: 13.68434) QuantErr: 13.68434 batch_time=0.40152 
Train Epoch: 39 [221/250 28288/32000 (88%)] Loss: 4.65427 (QuantReg: 13.45135) QuantErr: 13.45135 batch_time=0.41806 
Train Epoch: 39 [232/250 29696/32000 (93%)] Loss: 5.06310 (QuantReg: 13.62394) QuantErr: 13.62394 batch_time=0.41302 
Train Epoch: 39 [243/250 31104/32000 (97%)] Loss: 4.14753 (QuantReg: 13.70565) QuantErr: 13.70565 batch_time=0.42670 
Train Epoch: 39 codebook_update_time=0.42752
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch39.pth ...
Done in 4.594s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch39.pth ...
Done in 27.211s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 3.885521164894104
 quant_reg      : 13.477063419342041
 quant_err      : 13.477063419342041
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 9750
 MSRVTT_full_val/t2v_metrics/R1: 35.61368209255533
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.285714285714285
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.70939008058513
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 85.51307847082495
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.855130784708249
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.40380089874459
 MSRVTT_full_test/t2v_metrics/R1: 13.846153846153847
 MSRVTT_full_test/t2v_metrics/R5: 37.625418060200666
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 81.43812709030101
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.39230769230769
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.872867308892975
 MSRVTT_full_test/v2t_metrics/R1: 16.254180602006688
 MSRVTT_full_test/v2t_metrics/R5: 45.21739130434783
 MSRVTT_full_test/v2t_metrics/R10: 59.03010033444816
 MSRVTT_full_test/v2t_metrics/R50: 86.08695652173913
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.283277591973246
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.13835033758906
 mnt_best       : 29.872867308892975
 not_improved_count: 0
Train Epoch: 40 [1/250 128/32000 (0%)] Loss: 4.39935 (QuantReg: 13.36259) QuantErr: 13.36259 batch_time=34.70569 
Train Epoch: 40 [12/250 1536/32000 (5%)] Loss: 4.43752 (QuantReg: 13.45975) QuantErr: 13.45975 batch_time=1.99155 
Train Epoch: 40 [23/250 2944/32000 (9%)] Loss: 3.35853 (QuantReg: 13.79021) QuantErr: 13.79021 batch_time=0.39744 
Train Epoch: 40 [34/250 4352/32000 (14%)] Loss: 3.94012 (QuantReg: 13.54166) QuantErr: 13.54166 batch_time=0.41371 
Train Epoch: 40 [45/250 5760/32000 (18%)] Loss: 5.57766 (QuantReg: 13.07043) QuantErr: 13.07043 batch_time=0.41500 
Train Epoch: 40 [56/250 7168/32000 (22%)] Loss: 4.16118 (QuantReg: 13.35942) QuantErr: 13.35942 batch_time=0.40102 
Train Epoch: 40 [67/250 8576/32000 (27%)] Loss: 4.01232 (QuantReg: 13.30151) QuantErr: 13.30151 batch_time=0.41527 
Train Epoch: 40 [78/250 9984/32000 (31%)] Loss: 4.20898 (QuantReg: 13.36928) QuantErr: 13.36928 batch_time=0.41077 
Train Epoch: 40 [89/250 11392/32000 (36%)] Loss: 2.91484 (QuantReg: 13.58327) QuantErr: 13.58327 batch_time=0.45095 
Train Epoch: 40 [100/250 12800/32000 (40%)] Loss: 4.15442 (QuantReg: 13.55127) QuantErr: 13.55127 batch_time=0.41476 
Train Epoch: 40 [111/250 14208/32000 (44%)] Loss: 3.66168 (QuantReg: 13.44375) QuantErr: 13.44375 batch_time=0.40261 
Train Epoch: 40 [122/250 15616/32000 (49%)] Loss: 4.14985 (QuantReg: 13.27135) QuantErr: 13.27135 batch_time=0.40012 
Train Epoch: 40 [133/250 17024/32000 (53%)] Loss: 3.30352 (QuantReg: 13.49387) QuantErr: 13.49387 batch_time=0.40882 
Train Epoch: 40 [144/250 18432/32000 (58%)] Loss: 3.52586 (QuantReg: 13.73023) QuantErr: 13.73023 batch_time=0.40277 
Train Epoch: 40 [155/250 19840/32000 (62%)] Loss: 4.49823 (QuantReg: 13.28101) QuantErr: 13.28101 batch_time=0.40822 
Train Epoch: 40 [166/250 21248/32000 (66%)] Loss: 5.18835 (QuantReg: 13.31416) QuantErr: 13.31416 batch_time=0.43450 
Train Epoch: 40 [177/250 22656/32000 (71%)] Loss: 3.66290 (QuantReg: 13.52401) QuantErr: 13.52401 batch_time=0.40348 
Train Epoch: 40 [188/250 24064/32000 (75%)] Loss: 4.50212 (QuantReg: 13.53767) QuantErr: 13.53767 batch_time=0.40793 
Train Epoch: 40 [199/250 25472/32000 (80%)] Loss: 3.92944 (QuantReg: 13.35996) QuantErr: 13.35996 batch_time=0.39958 
Train Epoch: 40 [210/250 26880/32000 (84%)] Loss: 3.88547 (QuantReg: 13.36822) QuantErr: 13.36822 batch_time=0.38336 
Train Epoch: 40 [221/250 28288/32000 (88%)] Loss: 3.93431 (QuantReg: 13.74983) QuantErr: 13.74983 batch_time=0.40678 
Train Epoch: 40 [232/250 29696/32000 (93%)] Loss: 3.42838 (QuantReg: 13.35230) QuantErr: 13.35230 batch_time=0.40051 
Train Epoch: 40 [243/250 31104/32000 (97%)] Loss: 3.39424 (QuantReg: 13.48076) QuantErr: 13.48076 batch_time=0.40783 
Train Epoch: 40 codebook_update_time=0.45027
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch40.pth ...
Done in 4.925s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 3.894712707519531
 quant_reg      : 13.472986080169678
 quant_err      : 13.472986080169678
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 34.40643863179074
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 96.579476861167
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.406438631790746
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.09331298529654
 MSRVTT_full_val/v2t_metrics/R1: 41.64989939637827
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.943661971830986
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.52937476666149
 MSRVTT_full_test/t2v_metrics/R1: 13.846153846153847
 MSRVTT_full_test/t2v_metrics/R5: 36.75585284280937
 MSRVTT_full_test/t2v_metrics/R10: 50.836120401337794
 MSRVTT_full_test/t2v_metrics/R50: 80.63545150501672
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.004347826086956
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.57622118963922
 MSRVTT_full_test/v2t_metrics/R1: 16.254180602006688
 MSRVTT_full_test/v2t_metrics/R5: 44.080267558528426
 MSRVTT_full_test/v2t_metrics/R10: 59.331103678929765
 MSRVTT_full_test/v2t_metrics/R50: 86.12040133779264
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.74832775919732
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.900413835222686
 mnt_best       : 29.872867308892975
 not_improved_count: 1
Train Epoch: 41 [1/250 128/32000 (0%)] Loss: 2.94574 (QuantReg: 13.53691) QuantErr: 13.53691 batch_time=34.23159 
Train Epoch: 41 [12/250 1536/32000 (5%)] Loss: 4.36208 (QuantReg: 13.51020) QuantErr: 13.51020 batch_time=0.39041 
Train Epoch: 41 [23/250 2944/32000 (9%)] Loss: 4.09361 (QuantReg: 13.71667) QuantErr: 13.71667 batch_time=0.39916 
Train Epoch: 41 [34/250 4352/32000 (14%)] Loss: 4.29891 (QuantReg: 13.21065) QuantErr: 13.21065 batch_time=0.39393 
Train Epoch: 41 [45/250 5760/32000 (18%)] Loss: 3.99258 (QuantReg: 13.61093) QuantErr: 13.61093 batch_time=0.40659 
Train Epoch: 41 [56/250 7168/32000 (22%)] Loss: 4.09496 (QuantReg: 13.49866) QuantErr: 13.49866 batch_time=0.41741 
Train Epoch: 41 [67/250 8576/32000 (27%)] Loss: 3.90601 (QuantReg: 13.43239) QuantErr: 13.43239 batch_time=0.42606 
Train Epoch: 41 [78/250 9984/32000 (31%)] Loss: 4.21080 (QuantReg: 13.22414) QuantErr: 13.22414 batch_time=0.38661 
Train Epoch: 41 [89/250 11392/32000 (36%)] Loss: 4.03504 (QuantReg: 13.25902) QuantErr: 13.25902 batch_time=0.38585 
Train Epoch: 41 [100/250 12800/32000 (40%)] Loss: 4.15293 (QuantReg: 13.29062) QuantErr: 13.29062 batch_time=0.42428 
Train Epoch: 41 [111/250 14208/32000 (44%)] Loss: 3.44318 (QuantReg: 13.54704) QuantErr: 13.54704 batch_time=0.39987 
Train Epoch: 41 [122/250 15616/32000 (49%)] Loss: 3.61510 (QuantReg: 13.34577) QuantErr: 13.34577 batch_time=0.54505 
Train Epoch: 41 [133/250 17024/32000 (53%)] Loss: 3.35067 (QuantReg: 13.53466) QuantErr: 13.53466 batch_time=0.40761 
Train Epoch: 41 [144/250 18432/32000 (58%)] Loss: 3.33370 (QuantReg: 13.58146) QuantErr: 13.58146 batch_time=3.35559 
Train Epoch: 41 [155/250 19840/32000 (62%)] Loss: 3.00153 (QuantReg: 13.50126) QuantErr: 13.50126 batch_time=0.40960 
Train Epoch: 41 [166/250 21248/32000 (66%)] Loss: 3.27720 (QuantReg: 13.23572) QuantErr: 13.23572 batch_time=0.40340 
Train Epoch: 41 [177/250 22656/32000 (71%)] Loss: 3.76756 (QuantReg: 13.63987) QuantErr: 13.63987 batch_time=0.48968 
Train Epoch: 41 [188/250 24064/32000 (75%)] Loss: 3.93647 (QuantReg: 13.40109) QuantErr: 13.40109 batch_time=0.41011 
Train Epoch: 41 [199/250 25472/32000 (80%)] Loss: 3.47530 (QuantReg: 13.75133) QuantErr: 13.75133 batch_time=0.39282 
Train Epoch: 41 [210/250 26880/32000 (84%)] Loss: 3.45992 (QuantReg: 13.51298) QuantErr: 13.51298 batch_time=0.42388 
Train Epoch: 41 [221/250 28288/32000 (88%)] Loss: 3.64323 (QuantReg: 13.61880) QuantErr: 13.61880 batch_time=0.42543 
Train Epoch: 41 [232/250 29696/32000 (93%)] Loss: 4.53225 (QuantReg: 13.20049) QuantErr: 13.20049 batch_time=0.40146 
Train Epoch: 41 [243/250 31104/32000 (97%)] Loss: 3.29411 (QuantReg: 13.28078) QuantErr: 13.28078 batch_time=0.64775 
Train Epoch: 41 codebook_update_time=0.52594
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch41.pth ...
Done in 4.021s
removing stale ckpt [epoch 40] [took 0.01s]
 epoch          : 41
 loss           : 3.8429833631515504
 quant_reg      : 13.471381629943847
 quant_err      : 13.471381629943847
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 10250
 MSRVTT_full_val/t2v_metrics/R1: 34.80885311871227
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.08450704225352
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.19296505116892
 MSRVTT_full_val/v2t_metrics/R1: 41.24748490945674
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.110663983903421
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.03658623993441
 MSRVTT_full_test/t2v_metrics/R1: 13.34448160535117
 MSRVTT_full_test/t2v_metrics/R5: 36.8561872909699
 MSRVTT_full_test/t2v_metrics/R10: 50.0
 MSRVTT_full_test/t2v_metrics/R50: 80.23411371237458
 MSRVTT_full_test/t2v_metrics/MedR: 10.5
 MSRVTT_full_test/t2v_metrics/MeanR: 46.831103678929765
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.079975701165697
 MSRVTT_full_test/v2t_metrics/R1: 16.82274247491639
 MSRVTT_full_test/v2t_metrics/R5: 45.05016722408027
 MSRVTT_full_test/v2t_metrics/R10: 59.66555183946488
 MSRVTT_full_test/v2t_metrics/R50: 85.88628762541806
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.12725752508361
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.62642862313192
 mnt_best       : 29.872867308892975
 not_improved_count: 2
Train Epoch: 42 [1/250 128/32000 (0%)] Loss: 3.14831 (QuantReg: 13.34874) QuantErr: 13.34874 batch_time=34.60892 
Train Epoch: 42 [12/250 1536/32000 (5%)] Loss: 3.73045 (QuantReg: 13.36294) QuantErr: 13.36294 batch_time=0.39936 
Train Epoch: 42 [23/250 2944/32000 (9%)] Loss: 3.77863 (QuantReg: 13.23828) QuantErr: 13.23828 batch_time=0.38588 
Train Epoch: 42 [34/250 4352/32000 (14%)] Loss: 4.41423 (QuantReg: 13.51694) QuantErr: 13.51694 batch_time=0.40417 
Train Epoch: 42 [45/250 5760/32000 (18%)] Loss: 4.27823 (QuantReg: 13.42515) QuantErr: 13.42515 batch_time=0.74196 
Train Epoch: 42 [56/250 7168/32000 (22%)] Loss: 3.77143 (QuantReg: 13.42849) QuantErr: 13.42849 batch_time=0.40961 
Train Epoch: 42 [67/250 8576/32000 (27%)] Loss: 4.06262 (QuantReg: 13.40298) QuantErr: 13.40298 batch_time=0.51520 
Train Epoch: 42 [78/250 9984/32000 (31%)] Loss: 4.53725 (QuantReg: 13.32841) QuantErr: 13.32841 batch_time=0.41201 
Train Epoch: 42 [89/250 11392/32000 (36%)] Loss: 3.41442 (QuantReg: 13.66560) QuantErr: 13.66560 batch_time=0.40384 
Train Epoch: 42 [100/250 12800/32000 (40%)] Loss: 3.23998 (QuantReg: 13.47125) QuantErr: 13.47125 batch_time=0.41495 
Train Epoch: 42 [111/250 14208/32000 (44%)] Loss: 3.66545 (QuantReg: 13.50645) QuantErr: 13.50645 batch_time=0.40812 
Train Epoch: 42 [122/250 15616/32000 (49%)] Loss: 3.56031 (QuantReg: 13.56099) QuantErr: 13.56099 batch_time=0.41068 
Train Epoch: 42 [133/250 17024/32000 (53%)] Loss: 3.75706 (QuantReg: 13.44409) QuantErr: 13.44409 batch_time=2.92025 
Train Epoch: 42 [144/250 18432/32000 (58%)] Loss: 4.34600 (QuantReg: 13.60161) QuantErr: 13.60161 batch_time=0.80449 
Train Epoch: 42 [155/250 19840/32000 (62%)] Loss: 5.27457 (QuantReg: 13.42567) QuantErr: 13.42567 batch_time=0.38857 
Train Epoch: 42 [166/250 21248/32000 (66%)] Loss: 5.04179 (QuantReg: 13.19782) QuantErr: 13.19782 batch_time=0.41519 
Train Epoch: 42 [177/250 22656/32000 (71%)] Loss: 4.43291 (QuantReg: 13.28802) QuantErr: 13.28802 batch_time=0.41358 
Train Epoch: 42 [188/250 24064/32000 (75%)] Loss: 4.10868 (QuantReg: 13.63830) QuantErr: 13.63830 batch_time=0.46475 
Train Epoch: 42 [199/250 25472/32000 (80%)] Loss: 3.10718 (QuantReg: 13.68489) QuantErr: 13.68489 batch_time=0.39337 
Train Epoch: 42 [210/250 26880/32000 (84%)] Loss: 3.63080 (QuantReg: 13.60489) QuantErr: 13.60489 batch_time=0.40418 
Train Epoch: 42 [221/250 28288/32000 (88%)] Loss: 4.64898 (QuantReg: 13.56228) QuantErr: 13.56228 batch_time=0.51449 
Train Epoch: 42 [232/250 29696/32000 (93%)] Loss: 3.32174 (QuantReg: 13.59569) QuantErr: 13.59569 batch_time=0.40794 
Train Epoch: 42 [243/250 31104/32000 (97%)] Loss: 4.11131 (QuantReg: 13.57633) QuantErr: 13.57633 batch_time=0.40911 
Train Epoch: 42 codebook_update_time=0.53213
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch42.pth ...
Done in 7.472s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 3.9274331407546996
 quant_reg      : 13.475785491943359
 quant_err      : 13.475785491943359
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 35.010060362173036
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.112676056338028
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 58.705159499502635
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.340040241448692
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.41220376190402
 MSRVTT_full_test/t2v_metrics/R1: 13.91304347826087
 MSRVTT_full_test/t2v_metrics/R5: 37.324414715719065
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 80.63545150501672
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.28127090301003
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.74959473080704
 MSRVTT_full_test/v2t_metrics/R1: 16.755852842809364
 MSRVTT_full_test/v2t_metrics/R5: 45.45150501672241
 MSRVTT_full_test/v2t_metrics/R10: 59.49832775919732
 MSRVTT_full_test/v2t_metrics/R50: 86.35451505016722
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.28896321070234
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.65112086706027
 mnt_best       : 29.872867308892975
 not_improved_count: 3
Train Epoch: 43 [1/250 128/32000 (0%)] Loss: 3.47770 (QuantReg: 13.61690) QuantErr: 13.61690 batch_time=33.00442 
Train Epoch: 43 [12/250 1536/32000 (5%)] Loss: 4.35648 (QuantReg: 13.10982) QuantErr: 13.10982 batch_time=0.41581 
Train Epoch: 43 [23/250 2944/32000 (9%)] Loss: 3.90384 (QuantReg: 13.68883) QuantErr: 13.68883 batch_time=0.38743 
Train Epoch: 43 [34/250 4352/32000 (14%)] Loss: 4.21119 (QuantReg: 13.46831) QuantErr: 13.46831 batch_time=0.42008 
Train Epoch: 43 [45/250 5760/32000 (18%)] Loss: 4.40949 (QuantReg: 13.41822) QuantErr: 13.41822 batch_time=0.41244 
Train Epoch: 43 [56/250 7168/32000 (22%)] Loss: 3.66543 (QuantReg: 13.42440) QuantErr: 13.42440 batch_time=0.42228 
Train Epoch: 43 [67/250 8576/32000 (27%)] Loss: 4.25103 (QuantReg: 13.38179) QuantErr: 13.38179 batch_time=0.68934 
Train Epoch: 43 [78/250 9984/32000 (31%)] Loss: 4.15728 (QuantReg: 13.46873) QuantErr: 13.46873 batch_time=0.39685 
Train Epoch: 43 [89/250 11392/32000 (36%)] Loss: 3.28282 (QuantReg: 13.44980) QuantErr: 13.44980 batch_time=0.39738 
Train Epoch: 43 [100/250 12800/32000 (40%)] Loss: 3.42150 (QuantReg: 13.60436) QuantErr: 13.60436 batch_time=0.41125 
Train Epoch: 43 [111/250 14208/32000 (44%)] Loss: 2.91741 (QuantReg: 13.42382) QuantErr: 13.42382 batch_time=0.40051 
Train Epoch: 43 [122/250 15616/32000 (49%)] Loss: 3.61603 (QuantReg: 13.54747) QuantErr: 13.54747 batch_time=0.63663 
Train Epoch: 43 [133/250 17024/32000 (53%)] Loss: 5.34896 (QuantReg: 13.44307) QuantErr: 13.44307 batch_time=1.39353 
Train Epoch: 43 [144/250 18432/32000 (58%)] Loss: 3.74520 (QuantReg: 13.51082) QuantErr: 13.51082 batch_time=0.39131 
Train Epoch: 43 [155/250 19840/32000 (62%)] Loss: 4.62680 (QuantReg: 13.63150) QuantErr: 13.63150 batch_time=0.40016 
Train Epoch: 43 [166/250 21248/32000 (66%)] Loss: 3.20398 (QuantReg: 13.47175) QuantErr: 13.47175 batch_time=0.40724 
Train Epoch: 43 [177/250 22656/32000 (71%)] Loss: 4.65620 (QuantReg: 13.48548) QuantErr: 13.48548 batch_time=0.40503 
Train Epoch: 43 [188/250 24064/32000 (75%)] Loss: 2.85322 (QuantReg: 13.54083) QuantErr: 13.54083 batch_time=0.43174 
Train Epoch: 43 [199/250 25472/32000 (80%)] Loss: 3.69107 (QuantReg: 13.61967) QuantErr: 13.61967 batch_time=0.40373 
Train Epoch: 43 [210/250 26880/32000 (84%)] Loss: 3.48833 (QuantReg: 13.65003) QuantErr: 13.65003 batch_time=0.39148 
Train Epoch: 43 [221/250 28288/32000 (88%)] Loss: 3.44430 (QuantReg: 13.71261) QuantErr: 13.71261 batch_time=0.39083 
Train Epoch: 43 [232/250 29696/32000 (93%)] Loss: 5.62758 (QuantReg: 13.30117) QuantErr: 13.30117 batch_time=0.42404 
Train Epoch: 43 [243/250 31104/32000 (97%)] Loss: 3.60545 (QuantReg: 13.27975) QuantErr: 13.27975 batch_time=0.66576 
Train Epoch: 43 codebook_update_time=0.43225
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch43.pth ...
Done in 4.160s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch43.pth ...
Done in 8.349s
removing stale ckpt [epoch 42] [took 0.00s]
 epoch          : 43
 loss           : 3.85903840637207
 quant_reg      : 13.50298504638672
 quant_err      : 13.50298504638672
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 10750
 MSRVTT_full_val/t2v_metrics/R1: 36.41851106639839
 MSRVTT_full_val/t2v_metrics/R5: 70.62374245472837
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.997987927565393
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.644004451797514
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.702213279678069
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.45164069142922
 MSRVTT_full_test/t2v_metrics/R1: 14.31438127090301
 MSRVTT_full_test/t2v_metrics/R5: 38.62876254180602
 MSRVTT_full_test/t2v_metrics/R10: 52.240802675585286
 MSRVTT_full_test/t2v_metrics/R50: 80.93645484949833
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.34615384615385
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.682994291680586
 MSRVTT_full_test/v2t_metrics/R1: 17.32441471571906
 MSRVTT_full_test/v2t_metrics/R5: 44.98327759197324
 MSRVTT_full_test/v2t_metrics/R10: 59.59866220735786
 MSRVTT_full_test/v2t_metrics/R50: 86.88963210702342
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.442140468227425
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.94584739933
 mnt_best       : 30.682994291680586
 not_improved_count: 0
Train Epoch: 44 [1/250 128/32000 (0%)] Loss: 3.55295 (QuantReg: 13.72175) QuantErr: 13.72175 batch_time=34.21737 
Train Epoch: 44 [12/250 1536/32000 (5%)] Loss: 3.86212 (QuantReg: 13.56909) QuantErr: 13.56909 batch_time=0.49085 
Train Epoch: 44 [23/250 2944/32000 (9%)] Loss: 4.44558 (QuantReg: 13.22950) QuantErr: 13.22950 batch_time=0.38936 
Train Epoch: 44 [34/250 4352/32000 (14%)] Loss: 4.11139 (QuantReg: 13.63168) QuantErr: 13.63168 batch_time=0.42784 
Train Epoch: 44 [45/250 5760/32000 (18%)] Loss: 3.00849 (QuantReg: 13.63074) QuantErr: 13.63074 batch_time=0.56678 
Train Epoch: 44 [56/250 7168/32000 (22%)] Loss: 3.33277 (QuantReg: 13.58767) QuantErr: 13.58767 batch_time=0.38561 
Train Epoch: 44 [67/250 8576/32000 (27%)] Loss: 4.86093 (QuantReg: 13.65597) QuantErr: 13.65597 batch_time=3.84988 
Train Epoch: 44 [78/250 9984/32000 (31%)] Loss: 3.49510 (QuantReg: 13.38740) QuantErr: 13.38740 batch_time=1.37554 
Train Epoch: 44 [89/250 11392/32000 (36%)] Loss: 4.32068 (QuantReg: 13.53648) QuantErr: 13.53648 batch_time=0.40455 
Train Epoch: 44 [100/250 12800/32000 (40%)] Loss: 3.98993 (QuantReg: 13.49972) QuantErr: 13.49972 batch_time=0.39863 
Train Epoch: 44 [111/250 14208/32000 (44%)] Loss: 3.41539 (QuantReg: 13.67728) QuantErr: 13.67728 batch_time=0.40299 
Train Epoch: 44 [122/250 15616/32000 (49%)] Loss: 3.21420 (QuantReg: 13.69487) QuantErr: 13.69487 batch_time=0.38993 
Train Epoch: 44 [133/250 17024/32000 (53%)] Loss: 3.18538 (QuantReg: 13.49806) QuantErr: 13.49806 batch_time=0.40013 
Train Epoch: 44 [144/250 18432/32000 (58%)] Loss: 3.36950 (QuantReg: 13.70476) QuantErr: 13.70476 batch_time=0.42633 
Train Epoch: 44 [155/250 19840/32000 (62%)] Loss: 5.27996 (QuantReg: 13.58924) QuantErr: 13.58924 batch_time=0.40186 
Train Epoch: 44 [166/250 21248/32000 (66%)] Loss: 4.09896 (QuantReg: 13.44404) QuantErr: 13.44404 batch_time=0.40807 
Train Epoch: 44 [177/250 22656/32000 (71%)] Loss: 3.78286 (QuantReg: 13.63809) QuantErr: 13.63809 batch_time=0.39296 
Train Epoch: 44 [188/250 24064/32000 (75%)] Loss: 4.22677 (QuantReg: 13.58103) QuantErr: 13.58103 batch_time=0.38833 
Train Epoch: 44 [199/250 25472/32000 (80%)] Loss: 3.24458 (QuantReg: 13.33457) QuantErr: 13.33457 batch_time=0.43527 
Train Epoch: 44 [210/250 26880/32000 (84%)] Loss: 3.39966 (QuantReg: 13.47529) QuantErr: 13.47529 batch_time=0.40833 
Train Epoch: 44 [221/250 28288/32000 (88%)] Loss: 4.43286 (QuantReg: 13.61156) QuantErr: 13.61156 batch_time=0.40826 
Train Epoch: 44 [232/250 29696/32000 (93%)] Loss: 4.38423 (QuantReg: 13.34858) QuantErr: 13.34858 batch_time=0.40766 
Train Epoch: 44 [243/250 31104/32000 (97%)] Loss: 4.80306 (QuantReg: 13.18858) QuantErr: 13.18858 batch_time=0.39068 
Train Epoch: 44 codebook_update_time=0.47822
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch44.pth ...
Done in 11.016s
removing stale ckpt [epoch 43] [took 0.02s]
 epoch          : 44
 loss           : 3.8753486042022707
 quant_reg      : 13.518858753204345
 quant_err      : 13.518858753204345
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 36.41851106639839
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.33400402414487
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.27954961900475
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 85.71428571428571
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.79476861167002
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.35946860074623
 MSRVTT_full_test/t2v_metrics/R1: 13.478260869565217
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 50.36789297658863
 MSRVTT_full_test/t2v_metrics/R50: 79.86622073578596
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.58311036789298
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.432833236105946
 MSRVTT_full_test/v2t_metrics/R1: 17.792642140468228
 MSRVTT_full_test/v2t_metrics/R5: 44.381270903010034
 MSRVTT_full_test/v2t_metrics/R10: 59.4314381270903
 MSRVTT_full_test/v2t_metrics/R50: 86.05351170568562
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.032775919732444
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.07049808074991
 mnt_best       : 30.682994291680586
 not_improved_count: 1
Train Epoch: 45 [1/250 128/32000 (0%)] Loss: 3.08048 (QuantReg: 13.65714) QuantErr: 13.65714 batch_time=44.58337 
Train Epoch: 45 [12/250 1536/32000 (5%)] Loss: 4.26989 (QuantReg: 13.56465) QuantErr: 13.56465 batch_time=0.42439 
Train Epoch: 45 [23/250 2944/32000 (9%)] Loss: 4.17978 (QuantReg: 13.74233) QuantErr: 13.74233 batch_time=0.38556 
Train Epoch: 45 [34/250 4352/32000 (14%)] Loss: 3.69717 (QuantReg: 13.56516) QuantErr: 13.56516 batch_time=0.38133 
Train Epoch: 45 [45/250 5760/32000 (18%)] Loss: 4.91914 (QuantReg: 13.48693) QuantErr: 13.48693 batch_time=0.38899 
Train Epoch: 45 [56/250 7168/32000 (22%)] Loss: 4.31924 (QuantReg: 13.25866) QuantErr: 13.25866 batch_time=0.41247 
Train Epoch: 45 [67/250 8576/32000 (27%)] Loss: 4.34521 (QuantReg: 13.54787) QuantErr: 13.54787 batch_time=0.39735 
Train Epoch: 45 [78/250 9984/32000 (31%)] Loss: 4.84700 (QuantReg: 13.56708) QuantErr: 13.56708 batch_time=0.38863 
Train Epoch: 45 [89/250 11392/32000 (36%)] Loss: 3.35381 (QuantReg: 13.66943) QuantErr: 13.66943 batch_time=0.69951 
Train Epoch: 45 [100/250 12800/32000 (40%)] Loss: 4.32221 (QuantReg: 13.67546) QuantErr: 13.67546 batch_time=0.38036 
Train Epoch: 45 [111/250 14208/32000 (44%)] Loss: 3.73805 (QuantReg: 13.65051) QuantErr: 13.65051 batch_time=0.38026 
Train Epoch: 45 [122/250 15616/32000 (49%)] Loss: 3.61613 (QuantReg: 13.61621) QuantErr: 13.61621 batch_time=0.38333 
Train Epoch: 45 [133/250 17024/32000 (53%)] Loss: 4.46127 (QuantReg: 13.57311) QuantErr: 13.57311 batch_time=0.40265 
Train Epoch: 45 [144/250 18432/32000 (58%)] Loss: 3.40224 (QuantReg: 13.60927) QuantErr: 13.60927 batch_time=0.39299 
Train Epoch: 45 [155/250 19840/32000 (62%)] Loss: 4.83819 (QuantReg: 13.36787) QuantErr: 13.36787 batch_time=0.47097 
Train Epoch: 45 [166/250 21248/32000 (66%)] Loss: 3.68794 (QuantReg: 13.54829) QuantErr: 13.54829 batch_time=0.39051 
Train Epoch: 45 [177/250 22656/32000 (71%)] Loss: 4.09836 (QuantReg: 13.72725) QuantErr: 13.72725 batch_time=0.37902 
Train Epoch: 45 [188/250 24064/32000 (75%)] Loss: 3.04212 (QuantReg: 13.64400) QuantErr: 13.64400 batch_time=0.38462 
Train Epoch: 45 [199/250 25472/32000 (80%)] Loss: 3.69917 (QuantReg: 13.67804) QuantErr: 13.67804 batch_time=0.40327 
Train Epoch: 45 [210/250 26880/32000 (84%)] Loss: 4.19983 (QuantReg: 13.66471) QuantErr: 13.66471 batch_time=0.38251 
Train Epoch: 45 [221/250 28288/32000 (88%)] Loss: 5.76311 (QuantReg: 13.56708) QuantErr: 13.56708 batch_time=0.42183 
Train Epoch: 45 [232/250 29696/32000 (93%)] Loss: 4.61454 (QuantReg: 13.58303) QuantErr: 13.58303 batch_time=0.39515 
Train Epoch: 45 [243/250 31104/32000 (97%)] Loss: 3.34467 (QuantReg: 13.75665) QuantErr: 13.75665 batch_time=0.39311 
Train Epoch: 45 codebook_update_time=0.49084
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch45.pth ...
Done in 4.130s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 3.837029941558838
 quant_reg      : 13.542341865539552
 quant_err      : 13.542341865539552
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 11250
 MSRVTT_full_val/t2v_metrics/R1: 37.223340040241446
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.38430583501005
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.070422535211268
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.77019521010277
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.154929577464789
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.43488015599031
 MSRVTT_full_test/t2v_metrics/R1: 12.976588628762542
 MSRVTT_full_test/t2v_metrics/R5: 37.65886287625418
 MSRVTT_full_test/t2v_metrics/R10: 50.869565217391305
 MSRVTT_full_test/t2v_metrics/R50: 80.50167224080268
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.22508361204013
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.18514946090241
 MSRVTT_full_test/v2t_metrics/R1: 17.4247491638796
 MSRVTT_full_test/v2t_metrics/R5: 44.214046822742475
 MSRVTT_full_test/v2t_metrics/R10: 59.4314381270903
 MSRVTT_full_test/v2t_metrics/R50: 86.12040133779264
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.49966555183946
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.775112963344384
 mnt_best       : 30.682994291680586
 not_improved_count: 2
Train Epoch: 46 [1/250 128/32000 (0%)] Loss: 3.98178 (QuantReg: 13.46210) QuantErr: 13.46210 batch_time=34.36960 
Train Epoch: 46 [12/250 1536/32000 (5%)] Loss: 3.66841 (QuantReg: 13.68742) QuantErr: 13.68742 batch_time=0.40501 
Train Epoch: 46 [23/250 2944/32000 (9%)] Loss: 3.71245 (QuantReg: 13.55492) QuantErr: 13.55492 batch_time=0.39483 
Train Epoch: 46 [34/250 4352/32000 (14%)] Loss: 4.38016 (QuantReg: 13.37756) QuantErr: 13.37756 batch_time=0.39935 
Train Epoch: 46 [45/250 5760/32000 (18%)] Loss: 4.16158 (QuantReg: 13.52914) QuantErr: 13.52914 batch_time=0.38123 
Train Epoch: 46 [56/250 7168/32000 (22%)] Loss: 3.17486 (QuantReg: 13.45764) QuantErr: 13.45764 batch_time=0.40247 
Train Epoch: 46 [67/250 8576/32000 (27%)] Loss: 4.47598 (QuantReg: 13.81736) QuantErr: 13.81736 batch_time=0.40655 
Train Epoch: 46 [78/250 9984/32000 (31%)] Loss: 3.64293 (QuantReg: 13.59717) QuantErr: 13.59717 batch_time=0.38571 
Train Epoch: 46 [89/250 11392/32000 (36%)] Loss: 3.91714 (QuantReg: 13.69514) QuantErr: 13.69514 batch_time=0.39233 
Train Epoch: 46 [100/250 12800/32000 (40%)] Loss: 4.13223 (QuantReg: 13.33043) QuantErr: 13.33043 batch_time=0.39030 
Train Epoch: 46 [111/250 14208/32000 (44%)] Loss: 3.42884 (QuantReg: 13.66276) QuantErr: 13.66276 batch_time=0.42865 
Train Epoch: 46 [122/250 15616/32000 (49%)] Loss: 3.74690 (QuantReg: 13.59581) QuantErr: 13.59581 batch_time=0.38987 
Train Epoch: 46 [133/250 17024/32000 (53%)] Loss: 4.14880 (QuantReg: 13.57761) QuantErr: 13.57761 batch_time=6.67255 
Train Epoch: 46 [144/250 18432/32000 (58%)] Loss: 4.13254 (QuantReg: 13.57537) QuantErr: 13.57537 batch_time=0.38727 
Train Epoch: 46 [155/250 19840/32000 (62%)] Loss: 3.08052 (QuantReg: 13.74649) QuantErr: 13.74649 batch_time=0.40001 
Train Epoch: 46 [166/250 21248/32000 (66%)] Loss: 4.09465 (QuantReg: 13.44551) QuantErr: 13.44551 batch_time=0.44950 
Train Epoch: 46 [177/250 22656/32000 (71%)] Loss: 3.83857 (QuantReg: 13.54482) QuantErr: 13.54482 batch_time=0.39910 
Train Epoch: 46 [188/250 24064/32000 (75%)] Loss: 3.44175 (QuantReg: 13.56847) QuantErr: 13.56847 batch_time=0.41610 
Train Epoch: 46 [199/250 25472/32000 (80%)] Loss: 3.97477 (QuantReg: 13.58573) QuantErr: 13.58573 batch_time=0.39038 
Train Epoch: 46 [210/250 26880/32000 (84%)] Loss: 3.40382 (QuantReg: 13.73173) QuantErr: 13.73173 batch_time=0.40070 
Train Epoch: 46 [221/250 28288/32000 (88%)] Loss: 3.93649 (QuantReg: 13.78589) QuantErr: 13.78589 batch_time=0.38887 
Train Epoch: 46 [232/250 29696/32000 (93%)] Loss: 4.67416 (QuantReg: 13.53469) QuantErr: 13.53469 batch_time=0.38478 
Train Epoch: 46 [243/250 31104/32000 (97%)] Loss: 3.43881 (QuantReg: 13.45243) QuantErr: 13.45243 batch_time=0.38714 
Train Epoch: 46 codebook_update_time=0.47589
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch46.pth ...
Done in 4.377s
removing stale ckpt [epoch 45] [took 0.00s]
 epoch          : 46
 loss           : 3.8508779335021974
 quant_reg      : 13.562023101806641
 quant_err      : 13.562023101806641
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 33.80281690140845
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 96.98189134808852
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.818913480885312
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.404564595306795
 MSRVTT_full_val/v2t_metrics/R1: 38.6317907444668
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.084507042253521
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.78570412911538
 MSRVTT_full_test/t2v_metrics/R1: 13.076923076923077
 MSRVTT_full_test/t2v_metrics/R5: 36.95652173913044
 MSRVTT_full_test/t2v_metrics/R10: 50.635451505016725
 MSRVTT_full_test/t2v_metrics/R50: 80.3010033444816
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.71103678929766
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.032456357714565
 MSRVTT_full_test/v2t_metrics/R1: 16.421404682274247
 MSRVTT_full_test/v2t_metrics/R5: 44.147157190635454
 MSRVTT_full_test/v2t_metrics/R10: 59.79933110367893
 MSRVTT_full_test/v2t_metrics/R50: 85.88628762541806
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.48327759197325
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.12932386039532
 mnt_best       : 30.682994291680586
 not_improved_count: 3
Train Epoch: 47 [1/250 128/32000 (0%)] Loss: 3.26347 (QuantReg: 13.60033) QuantErr: 13.60033 batch_time=36.81595 
Train Epoch: 47 [12/250 1536/32000 (5%)] Loss: 4.38448 (QuantReg: 13.63186) QuantErr: 13.63186 batch_time=0.44220 
Train Epoch: 47 [23/250 2944/32000 (9%)] Loss: 4.58226 (QuantReg: 13.32922) QuantErr: 13.32922 batch_time=0.41321 
Train Epoch: 47 [34/250 4352/32000 (14%)] Loss: 4.28515 (QuantReg: 13.53401) QuantErr: 13.53401 batch_time=0.43219 
Train Epoch: 47 [45/250 5760/32000 (18%)] Loss: 5.39354 (QuantReg: 13.56734) QuantErr: 13.56734 batch_time=0.43553 
Train Epoch: 47 [56/250 7168/32000 (22%)] Loss: 3.87692 (QuantReg: 13.47215) QuantErr: 13.47215 batch_time=0.41017 
Train Epoch: 47 [67/250 8576/32000 (27%)] Loss: 4.21485 (QuantReg: 13.58775) QuantErr: 13.58775 batch_time=0.41516 
Train Epoch: 47 [78/250 9984/32000 (31%)] Loss: 3.28367 (QuantReg: 13.79142) QuantErr: 13.79142 batch_time=0.44723 
Train Epoch: 47 [89/250 11392/32000 (36%)] Loss: 3.66236 (QuantReg: 13.72430) QuantErr: 13.72430 batch_time=2.49018 
Train Epoch: 47 [100/250 12800/32000 (40%)] Loss: 3.75175 (QuantReg: 13.75473) QuantErr: 13.75473 batch_time=0.41457 
Train Epoch: 47 [111/250 14208/32000 (44%)] Loss: 4.31309 (QuantReg: 13.62244) QuantErr: 13.62244 batch_time=0.43949 
Train Epoch: 47 [122/250 15616/32000 (49%)] Loss: 4.34068 (QuantReg: 13.65166) QuantErr: 13.65166 batch_time=0.40687 
Train Epoch: 47 [133/250 17024/32000 (53%)] Loss: 4.22406 (QuantReg: 13.28377) QuantErr: 13.28377 batch_time=0.39099 
Train Epoch: 47 [144/250 18432/32000 (58%)] Loss: 4.05616 (QuantReg: 13.50923) QuantErr: 13.50923 batch_time=0.40154 
Train Epoch: 47 [155/250 19840/32000 (62%)] Loss: 4.00911 (QuantReg: 13.72040) QuantErr: 13.72040 batch_time=0.42000 
Train Epoch: 47 [166/250 21248/32000 (66%)] Loss: 2.93886 (QuantReg: 13.73885) QuantErr: 13.73885 batch_time=0.40616 
Train Epoch: 47 [177/250 22656/32000 (71%)] Loss: 4.19398 (QuantReg: 13.48906) QuantErr: 13.48906 batch_time=0.40355 
Train Epoch: 47 [188/250 24064/32000 (75%)] Loss: 3.79466 (QuantReg: 13.61929) QuantErr: 13.61929 batch_time=0.42002 
Train Epoch: 47 [199/250 25472/32000 (80%)] Loss: 3.63025 (QuantReg: 13.62380) QuantErr: 13.62380 batch_time=2.00142 
Train Epoch: 47 [210/250 26880/32000 (84%)] Loss: 2.99004 (QuantReg: 13.43394) QuantErr: 13.43394 batch_time=0.39981 
Train Epoch: 47 [221/250 28288/32000 (88%)] Loss: 3.14956 (QuantReg: 13.33409) QuantErr: 13.33409 batch_time=1.07122 
Train Epoch: 47 [232/250 29696/32000 (93%)] Loss: 3.69955 (QuantReg: 13.55080) QuantErr: 13.55080 batch_time=0.41003 
Train Epoch: 47 [243/250 31104/32000 (97%)] Loss: 3.65981 (QuantReg: 13.63138) QuantErr: 13.63138 batch_time=0.41633 
Train Epoch: 47 codebook_update_time=0.46180
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch47.pth ...
Done in 7.480s
removing stale ckpt [epoch 46] [took 0.00s]
 epoch          : 47
 loss           : 3.8606281719207765
 quant_reg      : 13.557267036437988
 quant_err      : 13.557267036437988
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 11750
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.3943661971831
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.102718668098156
 MSRVTT_full_val/v2t_metrics/R1: 38.83299798792756
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.219315895372233
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.34536084570892
 MSRVTT_full_test/t2v_metrics/R1: 13.511705685618729
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 50.735785953177256
 MSRVTT_full_test/t2v_metrics/R50: 80.16722408026756
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.19364548494983
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.528703499939816
 MSRVTT_full_test/v2t_metrics/R1: 16.889632107023413
 MSRVTT_full_test/v2t_metrics/R5: 45.08361204013378
 MSRVTT_full_test/v2t_metrics/R10: 59.49832775919732
 MSRVTT_full_test/v2t_metrics/R50: 86.2876254180602
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.29431438127091
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.64904372109556
 mnt_best       : 30.682994291680586
 not_improved_count: 4
Train Epoch: 48 [1/250 128/32000 (0%)] Loss: 5.23135 (QuantReg: 13.46296) QuantErr: 13.46296 batch_time=37.02235 
Train Epoch: 48 [12/250 1536/32000 (5%)] Loss: 2.82338 (QuantReg: 13.66798) QuantErr: 13.66798 batch_time=0.39006 
Train Epoch: 48 [23/250 2944/32000 (9%)] Loss: 3.11431 (QuantReg: 13.67779) QuantErr: 13.67779 batch_time=0.56131 
Train Epoch: 48 [34/250 4352/32000 (14%)] Loss: 3.67277 (QuantReg: 13.55887) QuantErr: 13.55887 batch_time=0.39410 
Train Epoch: 48 [45/250 5760/32000 (18%)] Loss: 3.82754 (QuantReg: 13.75688) QuantErr: 13.75688 batch_time=0.38488 
Train Epoch: 48 [56/250 7168/32000 (22%)] Loss: 3.14718 (QuantReg: 13.36827) QuantErr: 13.36827 batch_time=0.64808 
Train Epoch: 48 [67/250 8576/32000 (27%)] Loss: 3.73726 (QuantReg: 13.72132) QuantErr: 13.72132 batch_time=0.40942 
Train Epoch: 48 [78/250 9984/32000 (31%)] Loss: 4.59414 (QuantReg: 13.67357) QuantErr: 13.67357 batch_time=0.42496 
Train Epoch: 48 [89/250 11392/32000 (36%)] Loss: 3.63455 (QuantReg: 13.54323) QuantErr: 13.54323 batch_time=0.42525 
Train Epoch: 48 [100/250 12800/32000 (40%)] Loss: 4.97793 (QuantReg: 13.30298) QuantErr: 13.30298 batch_time=0.39733 
Train Epoch: 48 [111/250 14208/32000 (44%)] Loss: 3.22762 (QuantReg: 13.52749) QuantErr: 13.52749 batch_time=0.40676 
Train Epoch: 48 [122/250 15616/32000 (49%)] Loss: 4.45817 (QuantReg: 13.79306) QuantErr: 13.79306 batch_time=0.54040 
Train Epoch: 48 [133/250 17024/32000 (53%)] Loss: 4.04818 (QuantReg: 13.62106) QuantErr: 13.62106 batch_time=0.41309 
Train Epoch: 48 [144/250 18432/32000 (58%)] Loss: 4.34008 (QuantReg: 13.70940) QuantErr: 13.70940 batch_time=1.60671 
Train Epoch: 48 [155/250 19840/32000 (62%)] Loss: 2.96808 (QuantReg: 13.47134) QuantErr: 13.47134 batch_time=0.41199 
Train Epoch: 48 [166/250 21248/32000 (66%)] Loss: 4.18657 (QuantReg: 13.45283) QuantErr: 13.45283 batch_time=0.40104 
Train Epoch: 48 [177/250 22656/32000 (71%)] Loss: 4.06301 (QuantReg: 13.28464) QuantErr: 13.28464 batch_time=0.40589 
Train Epoch: 48 [188/250 24064/32000 (75%)] Loss: 3.54969 (QuantReg: 13.54987) QuantErr: 13.54987 batch_time=0.39745 
Train Epoch: 48 [199/250 25472/32000 (80%)] Loss: 3.33016 (QuantReg: 13.46323) QuantErr: 13.46323 batch_time=0.41497 
Train Epoch: 48 [210/250 26880/32000 (84%)] Loss: 4.25271 (QuantReg: 13.80118) QuantErr: 13.80118 batch_time=0.40633 
Train Epoch: 48 [221/250 28288/32000 (88%)] Loss: 4.81353 (QuantReg: 13.11952) QuantErr: 13.11952 batch_time=0.38708 
Train Epoch: 48 [232/250 29696/32000 (93%)] Loss: 4.24808 (QuantReg: 13.46517) QuantErr: 13.46517 batch_time=0.41068 
Train Epoch: 48 [243/250 31104/32000 (97%)] Loss: 4.39800 (QuantReg: 13.63739) QuantErr: 13.63739 batch_time=0.39258 
Train Epoch: 48 codebook_update_time=0.48297
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch48.pth ...
Done in 21.971s
removing stale ckpt [epoch 47] [took 0.00s]
 epoch          : 48
 loss           : 3.9161433057785033
 quant_reg      : 13.548756420135499
 quant_err      : 13.548756420135499
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 34.20523138832998
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.454728370221329
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.61422430983236
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.955734406438632
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.952880770325386
 MSRVTT_full_test/t2v_metrics/R1: 13.277591973244148
 MSRVTT_full_test/t2v_metrics/R5: 37.458193979933114
 MSRVTT_full_test/t2v_metrics/R10: 51.17056856187291
 MSRVTT_full_test/t2v_metrics/R50: 80.3010033444816
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.20200668896321
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.414544788980038
 MSRVTT_full_test/v2t_metrics/R1: 16.45484949832776
 MSRVTT_full_test/v2t_metrics/R5: 45.35117056856188
 MSRVTT_full_test/v2t_metrics/R10: 59.93311036789298
 MSRVTT_full_test/v2t_metrics/R50: 86.25418060200668
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.50769230769231
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.496299292977
 mnt_best       : 30.682994291680586
 not_improved_count: 5
Train Epoch: 49 [1/250 128/32000 (0%)] Loss: 4.25812 (QuantReg: 13.25015) QuantErr: 13.25015 batch_time=34.30469 
Train Epoch: 49 [12/250 1536/32000 (5%)] Loss: 2.68561 (QuantReg: 13.46741) QuantErr: 13.46741 batch_time=0.43059 
Train Epoch: 49 [23/250 2944/32000 (9%)] Loss: 3.48018 (QuantReg: 13.61723) QuantErr: 13.61723 batch_time=0.47148 
Train Epoch: 49 [34/250 4352/32000 (14%)] Loss: 3.78463 (QuantReg: 13.50661) QuantErr: 13.50661 batch_time=0.43832 
Train Epoch: 49 [45/250 5760/32000 (18%)] Loss: 4.23310 (QuantReg: 13.62030) QuantErr: 13.62030 batch_time=0.40508 
Train Epoch: 49 [56/250 7168/32000 (22%)] Loss: 3.19461 (QuantReg: 13.75492) QuantErr: 13.75492 batch_time=0.40754 
Train Epoch: 49 [67/250 8576/32000 (27%)] Loss: 4.37190 (QuantReg: 13.74058) QuantErr: 13.74058 batch_time=0.43735 
Train Epoch: 49 [78/250 9984/32000 (31%)] Loss: 4.05269 (QuantReg: 13.58825) QuantErr: 13.58825 batch_time=0.67212 
Train Epoch: 49 [89/250 11392/32000 (36%)] Loss: 4.21831 (QuantReg: 13.66571) QuantErr: 13.66571 batch_time=0.43010 
Train Epoch: 49 [100/250 12800/32000 (40%)] Loss: 3.09246 (QuantReg: 13.59324) QuantErr: 13.59324 batch_time=0.40251 
Train Epoch: 49 [111/250 14208/32000 (44%)] Loss: 4.58477 (QuantReg: 13.37304) QuantErr: 13.37304 batch_time=0.40689 
Train Epoch: 49 [122/250 15616/32000 (49%)] Loss: 3.23213 (QuantReg: 13.52478) QuantErr: 13.52478 batch_time=0.40139 
Train Epoch: 49 [133/250 17024/32000 (53%)] Loss: 4.10473 (QuantReg: 13.56849) QuantErr: 13.56849 batch_time=0.40086 
Train Epoch: 49 [144/250 18432/32000 (58%)] Loss: 3.50172 (QuantReg: 13.69057) QuantErr: 13.69057 batch_time=0.72297 
Train Epoch: 49 [155/250 19840/32000 (62%)] Loss: 3.05013 (QuantReg: 13.68950) QuantErr: 13.68950 batch_time=0.42773 
Train Epoch: 49 [166/250 21248/32000 (66%)] Loss: 4.13940 (QuantReg: 13.41360) QuantErr: 13.41360 batch_time=0.40666 
Train Epoch: 49 [177/250 22656/32000 (71%)] Loss: 2.96135 (QuantReg: 13.64415) QuantErr: 13.64415 batch_time=0.39222 
Train Epoch: 49 [188/250 24064/32000 (75%)] Loss: 3.78657 (QuantReg: 13.65965) QuantErr: 13.65965 batch_time=0.39233 
Train Epoch: 49 [199/250 25472/32000 (80%)] Loss: 4.37783 (QuantReg: 13.37797) QuantErr: 13.37797 batch_time=0.40587 
Train Epoch: 49 [210/250 26880/32000 (84%)] Loss: 4.86072 (QuantReg: 13.47196) QuantErr: 13.47196 batch_time=0.40588 
Train Epoch: 49 [221/250 28288/32000 (88%)] Loss: 4.03199 (QuantReg: 13.37045) QuantErr: 13.37045 batch_time=0.39587 
Train Epoch: 49 [232/250 29696/32000 (93%)] Loss: 4.79087 (QuantReg: 13.36511) QuantErr: 13.36511 batch_time=0.41063 
Train Epoch: 49 [243/250 31104/32000 (97%)] Loss: 3.37471 (QuantReg: 13.56956) QuantErr: 13.56956 batch_time=0.63146 
Train Epoch: 49 codebook_update_time=0.42206
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch49.pth ...
Done in 5.971s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 3.8363252849578857
 quant_reg      : 13.560941192626952
 quant_err      : 13.560941192626952
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 12250
 MSRVTT_full_val/t2v_metrics/R1: 34.60764587525151
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.746478873239436
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.91275913159801
 MSRVTT_full_val/v2t_metrics/R1: 40.44265593561368
 MSRVTT_full_val/v2t_metrics/R5: 76.45875251509054
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.18913480885311
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.00804828973843
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.88211564386025
 MSRVTT_full_test/t2v_metrics/R1: 13.277591973244148
 MSRVTT_full_test/t2v_metrics/R5: 37.290969899665555
 MSRVTT_full_test/t2v_metrics/R10: 51.137123745819395
 MSRVTT_full_test/t2v_metrics/R50: 80.13377926421404
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 48.5433110367893
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.364307604926722
 MSRVTT_full_test/v2t_metrics/R1: 17.49163879598662
 MSRVTT_full_test/v2t_metrics/R5: 44.8494983277592
 MSRVTT_full_test/v2t_metrics/R10: 59.63210702341137
 MSRVTT_full_test/v2t_metrics/R50: 86.2876254180602
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.46220735785953
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.032086794804606
 mnt_best       : 30.682994291680586
 not_improved_count: 6
Train Epoch: 50 [1/250 128/32000 (0%)] Loss: 4.22493 (QuantReg: 13.50648) QuantErr: 13.50648 batch_time=36.18326 
Train Epoch: 50 [12/250 1536/32000 (5%)] Loss: 3.84190 (QuantReg: 13.66882) QuantErr: 13.66882 batch_time=2.89786 
Train Epoch: 50 [23/250 2944/32000 (9%)] Loss: 4.32854 (QuantReg: 13.61453) QuantErr: 13.61453 batch_time=0.41453 
Train Epoch: 50 [34/250 4352/32000 (14%)] Loss: 3.91501 (QuantReg: 13.51361) QuantErr: 13.51361 batch_time=0.42038 
Train Epoch: 50 [45/250 5760/32000 (18%)] Loss: 3.02701 (QuantReg: 13.69030) QuantErr: 13.69030 batch_time=0.42658 
Train Epoch: 50 [56/250 7168/32000 (22%)] Loss: 3.53427 (QuantReg: 13.25654) QuantErr: 13.25654 batch_time=0.42900 
Train Epoch: 50 [67/250 8576/32000 (27%)] Loss: 4.30004 (QuantReg: 13.57532) QuantErr: 13.57532 batch_time=0.39897 
Train Epoch: 50 [78/250 9984/32000 (31%)] Loss: 4.38168 (QuantReg: 13.39910) QuantErr: 13.39910 batch_time=0.41379 
Train Epoch: 50 [89/250 11392/32000 (36%)] Loss: 3.69965 (QuantReg: 13.58605) QuantErr: 13.58605 batch_time=0.44867 
Train Epoch: 50 [100/250 12800/32000 (40%)] Loss: 3.02415 (QuantReg: 13.48964) QuantErr: 13.48964 batch_time=0.39930 
Train Epoch: 50 [111/250 14208/32000 (44%)] Loss: 4.09103 (QuantReg: 13.40837) QuantErr: 13.40837 batch_time=0.41505 
Train Epoch: 50 [122/250 15616/32000 (49%)] Loss: 2.89488 (QuantReg: 13.80686) QuantErr: 13.80686 batch_time=0.41833 
Train Epoch: 50 [133/250 17024/32000 (53%)] Loss: 4.29735 (QuantReg: 13.66112) QuantErr: 13.66112 batch_time=0.40647 
Train Epoch: 50 [144/250 18432/32000 (58%)] Loss: 4.85097 (QuantReg: 13.26201) QuantErr: 13.26201 batch_time=0.38732 
Train Epoch: 50 [155/250 19840/32000 (62%)] Loss: 3.62573 (QuantReg: 13.68658) QuantErr: 13.68658 batch_time=0.42400 
Train Epoch: 50 [166/250 21248/32000 (66%)] Loss: 4.77400 (QuantReg: 13.30309) QuantErr: 13.30309 batch_time=0.41774 
Train Epoch: 50 [177/250 22656/32000 (71%)] Loss: 3.36020 (QuantReg: 13.58409) QuantErr: 13.58409 batch_time=0.40403 
Train Epoch: 50 [188/250 24064/32000 (75%)] Loss: 4.11872 (QuantReg: 13.50552) QuantErr: 13.50552 batch_time=0.44678 
Train Epoch: 50 [199/250 25472/32000 (80%)] Loss: 3.79904 (QuantReg: 13.63559) QuantErr: 13.63559 batch_time=0.40638 
Train Epoch: 50 [210/250 26880/32000 (84%)] Loss: 4.10201 (QuantReg: 13.64031) QuantErr: 13.64031 batch_time=0.40145 
Train Epoch: 50 [221/250 28288/32000 (88%)] Loss: 3.99191 (QuantReg: 13.48556) QuantErr: 13.48556 batch_time=0.40859 
Train Epoch: 50 [232/250 29696/32000 (93%)] Loss: 4.44317 (QuantReg: 13.45275) QuantErr: 13.45275 batch_time=0.68235 
Train Epoch: 50 [243/250 31104/32000 (97%)] Loss: 2.98208 (QuantReg: 13.49459) QuantErr: 13.49459 batch_time=0.41009 
Train Epoch: 50 codebook_update_time=0.59659
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/checkpoint-epoch50.pth ...
Done in 4.302s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 3.859032640457153
 quant_reg      : 13.554841854095459
 quant_err      : 13.554841854095459
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 36.61971830985915
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 97.1830985915493
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.354124748490946
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 59.542802347699556
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 78.26961770623743
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.921529175050302
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.04792091609986
 MSRVTT_full_test/t2v_metrics/R1: 13.411371237458194
 MSRVTT_full_test/t2v_metrics/R5: 37.725752508361204
 MSRVTT_full_test/t2v_metrics/R10: 52.0066889632107
 MSRVTT_full_test/t2v_metrics/R50: 80.50167224080268
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.47692307692308
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.74336497089892
 MSRVTT_full_test/v2t_metrics/R1: 17.725752508361204
 MSRVTT_full_test/v2t_metrics/R5: 45.719063545150505
 MSRVTT_full_test/v2t_metrics/R10: 59.49832775919732
 MSRVTT_full_test/v2t_metrics/R50: 86.0200668896321
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.75484949832776
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.39727939360117
 mnt_best       : 30.682994291680586
 not_improved_count: 7
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/trained_model.pth ...
Ckpt loaded at epoch 43.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 14.31438127090301
 t2v_metrics/R5/final_eval: 38.62876254180602
 t2v_metrics/R10/final_eval: 52.240802675585286
 t2v_metrics/R50/final_eval: 80.93645484949833
 t2v_metrics/MedR/final_eval: 10.0
 t2v_metrics/MeanR/final_eval: 44.34615384615385
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 30.682994291680586
 v2t_metrics/R1/final_eval: 17.32441471571906
 v2t_metrics/R5/final_eval: 44.98327759197324
 v2t_metrics/R10/final_eval: 59.59866220735786
 v2t_metrics/R50/final_eval: 86.88963210702342
 v2t_metrics/MedR/final_eval: 7.0
 v2t_metrics/MeanR/final_eval: 31.442140468227425
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 35.94584739933
Best epoch for the monitored metric: 43
Script took 03h59m25s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L1/trained_model.pth
