Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64
Preparing the dataloaders ...
Loading dataset MSRVTT_miech_trainval in ram ...
Finish loading dataset MSRVTT_miech_trainval in ram, taking 603.3520195484161 s.
Loading dataset MSRVTT_miech_test in ram ...
Finish loading dataset MSRVTT_miech_test in ram, taking 91.26318216323853 s.
Loading dataset MSRVTT_miech_test in ram ...
Finish loading dataset MSRVTT_miech_test in ram, taking 46.25491547584534 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch0.pth ...
Done in 2.260s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch0.pth ...
Done in 4.333s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_miech_test/t2v_metrics/R1: 0.1
 MSRVTT_miech_test/t2v_metrics/R5: 0.6
 MSRVTT_miech_test/t2v_metrics/R10: 1.0
 MSRVTT_miech_test/t2v_metrics/R50: 5.0
 MSRVTT_miech_test/t2v_metrics/MedR: 503.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 505.179
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.3914867641168864
 MSRVTT_miech_test/v2t_metrics/R1: 0.1
 MSRVTT_miech_test/v2t_metrics/R5: 0.4
 MSRVTT_miech_test/v2t_metrics/R10: 1.0
 MSRVTT_miech_test/v2t_metrics/R50: 5.4
 MSRVTT_miech_test/v2t_metrics/MedR: 511.5
 MSRVTT_miech_test/v2t_metrics/MeanR: 499.893
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.3419951893353394
 mnt_best       : 0.3914867641168864
 not_improved_count: 0
Train Epoch: 1 [1/500 64/32000 (0%)] Loss: 8.43814 (QuantReg: 22.47124) QuantErr: 22.47124 batch_time=23.61913 
Train Epoch: 1 [9/500 576/32000 (2%)] Loss: 8.07294 (QuantReg: 22.43234) QuantErr: 22.43234 batch_time=0.42483 
Train Epoch: 1 [17/500 1088/32000 (3%)] Loss: 6.92733 (QuantReg: 22.50832) QuantErr: 22.50832 batch_time=0.42285 
Train Epoch: 1 [25/500 1600/32000 (5%)] Loss: 6.19994 (QuantReg: 22.49500) QuantErr: 22.49500 batch_time=0.56379 
Train Epoch: 1 [33/500 2112/32000 (7%)] Loss: 6.23030 (QuantReg: 22.50699) QuantErr: 22.50699 batch_time=0.51311 
Train Epoch: 1 [41/500 2624/32000 (8%)] Loss: 6.19945 (QuantReg: 22.61296) QuantErr: 22.61296 batch_time=0.43473 
Train Epoch: 1 [49/500 3136/32000 (10%)] Loss: 4.92869 (QuantReg: 22.56521) QuantErr: 22.56521 batch_time=0.48633 
Train Epoch: 1 [57/500 3648/32000 (11%)] Loss: 5.11551 (QuantReg: 22.60281) QuantErr: 22.60281 batch_time=0.46246 
Train Epoch: 1 [65/500 4160/32000 (13%)] Loss: 4.76426 (QuantReg: 22.58537) QuantErr: 22.58537 batch_time=0.55391 
Train Epoch: 1 [73/500 4672/32000 (15%)] Loss: 5.52754 (QuantReg: 22.56047) QuantErr: 22.56047 batch_time=0.48567 
Train Epoch: 1 [81/500 5184/32000 (16%)] Loss: 5.04083 (QuantReg: 22.61699) QuantErr: 22.61699 batch_time=0.47121 
Train Epoch: 1 [89/500 5696/32000 (18%)] Loss: 4.18837 (QuantReg: 22.62926) QuantErr: 22.62926 batch_time=0.41079 
Train Epoch: 1 [97/500 6208/32000 (19%)] Loss: 4.79785 (QuantReg: 22.60438) QuantErr: 22.60438 batch_time=0.42248 
Train Epoch: 1 [105/500 6720/32000 (21%)] Loss: 4.74828 (QuantReg: 22.61328) QuantErr: 22.61328 batch_time=0.47407 
Train Epoch: 1 [113/500 7232/32000 (23%)] Loss: 4.74092 (QuantReg: 22.52281) QuantErr: 22.52281 batch_time=0.45388 
Train Epoch: 1 [121/500 7744/32000 (24%)] Loss: 4.77593 (QuantReg: 22.55562) QuantErr: 22.55562 batch_time=0.41391 
Train Epoch: 1 [129/500 8256/32000 (26%)] Loss: 4.39460 (QuantReg: 22.60296) QuantErr: 22.60296 batch_time=0.47530 
Train Epoch: 1 [137/500 8768/32000 (27%)] Loss: 4.47458 (QuantReg: 22.57417) QuantErr: 22.57417 batch_time=0.48999 
Train Epoch: 1 [145/500 9280/32000 (29%)] Loss: 4.24649 (QuantReg: 22.63674) QuantErr: 22.63674 batch_time=0.44756 
Train Epoch: 1 [153/500 9792/32000 (31%)] Loss: 4.77954 (QuantReg: 22.60246) QuantErr: 22.60246 batch_time=0.41413 
Train Epoch: 1 [161/500 10304/32000 (32%)] Loss: 3.95147 (QuantReg: 22.63867) QuantErr: 22.63867 batch_time=0.39644 
Train Epoch: 1 [169/500 10816/32000 (34%)] Loss: 3.60523 (QuantReg: 22.63819) QuantErr: 22.63819 batch_time=0.44636 
Train Epoch: 1 [177/500 11328/32000 (35%)] Loss: 3.81490 (QuantReg: 22.64024) QuantErr: 22.64024 batch_time=0.48835 
Train Epoch: 1 [185/500 11840/32000 (37%)] Loss: 3.79137 (QuantReg: 22.57215) QuantErr: 22.57215 batch_time=0.45684 
Train Epoch: 1 [193/500 12352/32000 (39%)] Loss: 4.49014 (QuantReg: 22.61815) QuantErr: 22.61815 batch_time=0.52773 
Train Epoch: 1 [201/500 12864/32000 (40%)] Loss: 3.40249 (QuantReg: 22.59383) QuantErr: 22.59383 batch_time=0.41370 
Train Epoch: 1 [209/500 13376/32000 (42%)] Loss: 3.84287 (QuantReg: 22.64277) QuantErr: 22.64277 batch_time=0.46871 
Train Epoch: 1 [217/500 13888/32000 (43%)] Loss: 3.58844 (QuantReg: 22.63635) QuantErr: 22.63635 batch_time=0.43487 
Train Epoch: 1 [225/500 14400/32000 (45%)] Loss: 3.16189 (QuantReg: 22.70997) QuantErr: 22.70997 batch_time=0.52648 
Train Epoch: 1 [233/500 14912/32000 (47%)] Loss: 3.27441 (QuantReg: 22.63987) QuantErr: 22.63987 batch_time=0.51021 
Train Epoch: 1 [241/500 15424/32000 (48%)] Loss: 3.54390 (QuantReg: 22.65001) QuantErr: 22.65001 batch_time=0.39796 
Train Epoch: 1 [249/500 15936/32000 (50%)] Loss: 3.20771 (QuantReg: 22.64298) QuantErr: 22.64298 batch_time=0.46186 
Train Epoch: 1 [257/500 16448/32000 (51%)] Loss: 4.03505 (QuantReg: 22.68443) QuantErr: 22.68443 batch_time=0.51778 
Train Epoch: 1 [265/500 16960/32000 (53%)] Loss: 3.58372 (QuantReg: 22.69003) QuantErr: 22.69003 batch_time=0.46286 
Train Epoch: 1 [273/500 17472/32000 (55%)] Loss: 3.34735 (QuantReg: 22.62654) QuantErr: 22.62654 batch_time=0.44499 
Train Epoch: 1 [281/500 17984/32000 (56%)] Loss: 3.53118 (QuantReg: 22.67187) QuantErr: 22.67187 batch_time=0.43744 
Train Epoch: 1 [289/500 18496/32000 (58%)] Loss: 3.76725 (QuantReg: 22.66370) QuantErr: 22.66370 batch_time=0.41000 
Train Epoch: 1 [297/500 19008/32000 (59%)] Loss: 2.86490 (QuantReg: 22.65937) QuantErr: 22.65937 batch_time=0.44484 
Train Epoch: 1 [305/500 19520/32000 (61%)] Loss: 3.57860 (QuantReg: 22.71281) QuantErr: 22.71281 batch_time=0.48664 
Train Epoch: 1 [313/500 20032/32000 (63%)] Loss: 3.84359 (QuantReg: 22.68862) QuantErr: 22.68862 batch_time=0.47469 
Train Epoch: 1 [321/500 20544/32000 (64%)] Loss: 2.88834 (QuantReg: 22.67020) QuantErr: 22.67020 batch_time=0.63129 
Train Epoch: 1 [329/500 21056/32000 (66%)] Loss: 3.57420 (QuantReg: 22.69869) QuantErr: 22.69869 batch_time=0.53389 
Train Epoch: 1 [337/500 21568/32000 (67%)] Loss: 3.79530 (QuantReg: 22.71920) QuantErr: 22.71920 batch_time=0.47161 
Train Epoch: 1 [345/500 22080/32000 (69%)] Loss: 3.73685 (QuantReg: 22.71589) QuantErr: 22.71589 batch_time=0.42942 
Train Epoch: 1 [353/500 22592/32000 (71%)] Loss: 3.14037 (QuantReg: 22.68034) QuantErr: 22.68034 batch_time=0.46035 
Train Epoch: 1 [361/500 23104/32000 (72%)] Loss: 3.90545 (QuantReg: 22.69583) QuantErr: 22.69583 batch_time=0.50070 
Train Epoch: 1 [369/500 23616/32000 (74%)] Loss: 3.15793 (QuantReg: 22.64673) QuantErr: 22.64673 batch_time=0.50159 
Train Epoch: 1 [377/500 24128/32000 (75%)] Loss: 3.25415 (QuantReg: 22.64655) QuantErr: 22.64655 batch_time=0.49335 
Train Epoch: 1 [385/500 24640/32000 (77%)] Loss: 3.10594 (QuantReg: 22.67885) QuantErr: 22.67885 batch_time=0.58397 
Train Epoch: 1 [393/500 25152/32000 (79%)] Loss: 3.41504 (QuantReg: 22.68661) QuantErr: 22.68661 batch_time=0.41897 
Train Epoch: 1 [401/500 25664/32000 (80%)] Loss: 4.05284 (QuantReg: 22.69730) QuantErr: 22.69730 batch_time=0.45376 
Train Epoch: 1 [409/500 26176/32000 (82%)] Loss: 2.82250 (QuantReg: 22.65941) QuantErr: 22.65941 batch_time=0.51459 
Train Epoch: 1 [417/500 26688/32000 (83%)] Loss: 3.50118 (QuantReg: 22.70216) QuantErr: 22.70216 batch_time=0.49859 
Train Epoch: 1 [425/500 27200/32000 (85%)] Loss: 2.85913 (QuantReg: 22.68780) QuantErr: 22.68780 batch_time=0.48100 
Train Epoch: 1 [433/500 27712/32000 (87%)] Loss: 3.22243 (QuantReg: 22.71450) QuantErr: 22.71450 batch_time=0.49737 
Train Epoch: 1 [441/500 28224/32000 (88%)] Loss: 3.82724 (QuantReg: 22.69940) QuantErr: 22.69940 batch_time=0.48921 
Train Epoch: 1 [449/500 28736/32000 (90%)] Loss: 3.13193 (QuantReg: 22.67572) QuantErr: 22.67572 batch_time=0.60816 
Train Epoch: 1 [457/500 29248/32000 (91%)] Loss: 2.70542 (QuantReg: 22.64740) QuantErr: 22.64740 batch_time=0.43575 
Train Epoch: 1 [465/500 29760/32000 (93%)] Loss: 2.77277 (QuantReg: 22.65420) QuantErr: 22.65420 batch_time=0.47388 
Train Epoch: 1 [473/500 30272/32000 (95%)] Loss: 3.08022 (QuantReg: 22.69294) QuantErr: 22.69294 batch_time=0.47355 
Train Epoch: 1 [481/500 30784/32000 (96%)] Loss: 2.87616 (QuantReg: 22.66028) QuantErr: 22.66028 batch_time=0.54771 
Train Epoch: 1 [489/500 31296/32000 (98%)] Loss: 2.76735 (QuantReg: 22.66916) QuantErr: 22.66916 batch_time=0.50221 
Train Epoch: 1 [497/500 31808/32000 (99%)] Loss: 2.39162 (QuantReg: 22.68764) QuantErr: 22.68764 batch_time=0.49712 
Train Epoch: 1 codebook_update_time=3.28826
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch1.pth ...
Done in 12.086s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch1.pth ...
Done in 28.456s
 epoch          : 1
 loss           : 3.980151246547699
 quant_reg      : 22.637884368896483
 quant_err      : 22.637884368896483
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 500
 MSRVTT_miech_test/t2v_metrics/R1: 11.1
 MSRVTT_miech_test/t2v_metrics/R5: 32.9
 MSRVTT_miech_test/t2v_metrics/R10: 46.5
 MSRVTT_miech_test/t2v_metrics/R50: 79.9
 MSRVTT_miech_test/t2v_metrics/MedR: 12.5
 MSRVTT_miech_test/t2v_metrics/MeanR: 44.989
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.7034020740142
 MSRVTT_miech_test/v2t_metrics/R1: 11.2
 MSRVTT_miech_test/v2t_metrics/R5: 33.3
 MSRVTT_miech_test/v2t_metrics/R10: 46.1
 MSRVTT_miech_test/v2t_metrics/R50: 78.5
 MSRVTT_miech_test/v2t_metrics/MedR: 12.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 43.741
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 25.809983516865874
 mnt_best       : 25.7034020740142
 not_improved_count: 0
Train Epoch: 2 [1/500 64/32000 (0%)] Loss: 2.66995 (QuantReg: 11.55571) QuantErr: 11.55571 batch_time=26.83050 
Train Epoch: 2 [9/500 576/32000 (2%)] Loss: 2.40881 (QuantReg: 11.62492) QuantErr: 11.62492 batch_time=0.42582 
Train Epoch: 2 [17/500 1088/32000 (3%)] Loss: 3.17483 (QuantReg: 11.77660) QuantErr: 11.77660 batch_time=0.44437 
Train Epoch: 2 [25/500 1600/32000 (5%)] Loss: 2.65678 (QuantReg: 11.74711) QuantErr: 11.74711 batch_time=0.43581 
Train Epoch: 2 [33/500 2112/32000 (7%)] Loss: 2.56971 (QuantReg: 12.14401) QuantErr: 12.14401 batch_time=0.43113 
Train Epoch: 2 [41/500 2624/32000 (8%)] Loss: 3.12301 (QuantReg: 11.91295) QuantErr: 11.91295 batch_time=0.41209 
Train Epoch: 2 [49/500 3136/32000 (10%)] Loss: 2.96589 (QuantReg: 12.40466) QuantErr: 12.40466 batch_time=0.44555 
Train Epoch: 2 [57/500 3648/32000 (11%)] Loss: 2.79995 (QuantReg: 12.56196) QuantErr: 12.56196 batch_time=0.44725 
Train Epoch: 2 [65/500 4160/32000 (13%)] Loss: 2.07827 (QuantReg: 12.54146) QuantErr: 12.54146 batch_time=0.83357 
Train Epoch: 2 [73/500 4672/32000 (15%)] Loss: 2.06579 (QuantReg: 12.12918) QuantErr: 12.12918 batch_time=0.54152 
Train Epoch: 2 [81/500 5184/32000 (16%)] Loss: 2.28785 (QuantReg: 12.56490) QuantErr: 12.56490 batch_time=0.45306 
Train Epoch: 2 [89/500 5696/32000 (18%)] Loss: 2.52368 (QuantReg: 12.51778) QuantErr: 12.51778 batch_time=0.44593 
Train Epoch: 2 [97/500 6208/32000 (19%)] Loss: 2.42394 (QuantReg: 12.59426) QuantErr: 12.59426 batch_time=0.41848 
Train Epoch: 2 [105/500 6720/32000 (21%)] Loss: 2.34612 (QuantReg: 12.67617) QuantErr: 12.67617 batch_time=0.48786 
Train Epoch: 2 [113/500 7232/32000 (23%)] Loss: 2.41511 (QuantReg: 12.36383) QuantErr: 12.36383 batch_time=0.48893 
Train Epoch: 2 [121/500 7744/32000 (24%)] Loss: 3.12779 (QuantReg: 12.49131) QuantErr: 12.49131 batch_time=0.47809 
Train Epoch: 2 [129/500 8256/32000 (26%)] Loss: 2.46386 (QuantReg: 12.30723) QuantErr: 12.30723 batch_time=0.90786 
Train Epoch: 2 [137/500 8768/32000 (27%)] Loss: 2.99875 (QuantReg: 12.92780) QuantErr: 12.92780 batch_time=0.45929 
Train Epoch: 2 [145/500 9280/32000 (29%)] Loss: 2.33295 (QuantReg: 12.68370) QuantErr: 12.68370 batch_time=0.41837 
Train Epoch: 2 [153/500 9792/32000 (31%)] Loss: 3.16634 (QuantReg: 12.92526) QuantErr: 12.92526 batch_time=0.45036 
Train Epoch: 2 [161/500 10304/32000 (32%)] Loss: 2.83237 (QuantReg: 12.87321) QuantErr: 12.87321 batch_time=0.44175 
Train Epoch: 2 [169/500 10816/32000 (34%)] Loss: 2.50749 (QuantReg: 12.73324) QuantErr: 12.73324 batch_time=0.44705 
Train Epoch: 2 [177/500 11328/32000 (35%)] Loss: 2.46704 (QuantReg: 12.79665) QuantErr: 12.79665 batch_time=0.43157 
Train Epoch: 2 [185/500 11840/32000 (37%)] Loss: 2.79930 (QuantReg: 12.73149) QuantErr: 12.73149 batch_time=0.49979 
Train Epoch: 2 [193/500 12352/32000 (39%)] Loss: 2.47420 (QuantReg: 12.73126) QuantErr: 12.73126 batch_time=0.96094 
Train Epoch: 2 [201/500 12864/32000 (40%)] Loss: 2.26586 (QuantReg: 12.87775) QuantErr: 12.87775 batch_time=0.44500 
Train Epoch: 2 [209/500 13376/32000 (42%)] Loss: 3.46138 (QuantReg: 13.07528) QuantErr: 13.07528 batch_time=0.46282 
Train Epoch: 2 [217/500 13888/32000 (43%)] Loss: 2.15036 (QuantReg: 13.34962) QuantErr: 13.34962 batch_time=0.42728 
Train Epoch: 2 [225/500 14400/32000 (45%)] Loss: 2.88753 (QuantReg: 13.19498) QuantErr: 13.19498 batch_time=0.44054 
Train Epoch: 2 [233/500 14912/32000 (47%)] Loss: 2.42430 (QuantReg: 13.25283) QuantErr: 13.25283 batch_time=0.44627 
Train Epoch: 2 [241/500 15424/32000 (48%)] Loss: 2.67366 (QuantReg: 13.28589) QuantErr: 13.28589 batch_time=0.48545 
Train Epoch: 2 [249/500 15936/32000 (50%)] Loss: 3.04484 (QuantReg: 13.29069) QuantErr: 13.29069 batch_time=0.46336 
Train Epoch: 2 [257/500 16448/32000 (51%)] Loss: 2.73075 (QuantReg: 13.05627) QuantErr: 13.05627 batch_time=0.90437 
Train Epoch: 2 [265/500 16960/32000 (53%)] Loss: 2.47153 (QuantReg: 13.72828) QuantErr: 13.72828 batch_time=0.47332 
Train Epoch: 2 [273/500 17472/32000 (55%)] Loss: 3.63847 (QuantReg: 13.24408) QuantErr: 13.24408 batch_time=0.41175 
Train Epoch: 2 [281/500 17984/32000 (56%)] Loss: 2.27098 (QuantReg: 12.93545) QuantErr: 12.93545 batch_time=0.46006 
Train Epoch: 2 [289/500 18496/32000 (58%)] Loss: 2.44629 (QuantReg: 13.40579) QuantErr: 13.40579 batch_time=0.44720 
Train Epoch: 2 [297/500 19008/32000 (59%)] Loss: 3.05747 (QuantReg: 13.54981) QuantErr: 13.54981 batch_time=0.49605 
Train Epoch: 2 [305/500 19520/32000 (61%)] Loss: 2.59397 (QuantReg: 13.66596) QuantErr: 13.66596 batch_time=0.45154 
Train Epoch: 2 [313/500 20032/32000 (63%)] Loss: 3.07523 (QuantReg: 13.67981) QuantErr: 13.67981 batch_time=0.45021 
Train Epoch: 2 [321/500 20544/32000 (64%)] Loss: 2.87630 (QuantReg: 13.89714) QuantErr: 13.89714 batch_time=0.98594 
Train Epoch: 2 [329/500 21056/32000 (66%)] Loss: 1.81512 (QuantReg: 13.85850) QuantErr: 13.85850 batch_time=0.44815 
Train Epoch: 2 [337/500 21568/32000 (67%)] Loss: 1.92257 (QuantReg: 13.81502) QuantErr: 13.81502 batch_time=0.46580 
Train Epoch: 2 [345/500 22080/32000 (69%)] Loss: 2.89609 (QuantReg: 13.77586) QuantErr: 13.77586 batch_time=0.45155 
Train Epoch: 2 [353/500 22592/32000 (71%)] Loss: 2.56913 (QuantReg: 13.82472) QuantErr: 13.82472 batch_time=0.47432 
Train Epoch: 2 [361/500 23104/32000 (72%)] Loss: 2.42609 (QuantReg: 13.84679) QuantErr: 13.84679 batch_time=0.45069 
Train Epoch: 2 [369/500 23616/32000 (74%)] Loss: 2.75916 (QuantReg: 13.63808) QuantErr: 13.63808 batch_time=0.45060 
Train Epoch: 2 [377/500 24128/32000 (75%)] Loss: 2.87178 (QuantReg: 13.43409) QuantErr: 13.43409 batch_time=0.50236 
Train Epoch: 2 [385/500 24640/32000 (77%)] Loss: 1.93589 (QuantReg: 14.05791) QuantErr: 14.05791 batch_time=0.97736 
Train Epoch: 2 [393/500 25152/32000 (79%)] Loss: 2.80028 (QuantReg: 13.79401) QuantErr: 13.79401 batch_time=0.45209 
Train Epoch: 2 [401/500 25664/32000 (80%)] Loss: 2.24260 (QuantReg: 13.61337) QuantErr: 13.61337 batch_time=0.46196 
Train Epoch: 2 [409/500 26176/32000 (82%)] Loss: 1.99017 (QuantReg: 14.35624) QuantErr: 14.35624 batch_time=0.51352 
Train Epoch: 2 [417/500 26688/32000 (83%)] Loss: 2.50725 (QuantReg: 13.69607) QuantErr: 13.69607 batch_time=0.49081 
Train Epoch: 2 [425/500 27200/32000 (85%)] Loss: 2.28266 (QuantReg: 13.82867) QuantErr: 13.82867 batch_time=0.44456 
Train Epoch: 2 [433/500 27712/32000 (87%)] Loss: 2.74086 (QuantReg: 14.00528) QuantErr: 14.00528 batch_time=0.41262 
Train Epoch: 2 [441/500 28224/32000 (88%)] Loss: 2.83342 (QuantReg: 13.86763) QuantErr: 13.86763 batch_time=0.43291 
Train Epoch: 2 [449/500 28736/32000 (90%)] Loss: 1.92974 (QuantReg: 13.90391) QuantErr: 13.90391 batch_time=0.97424 
Train Epoch: 2 [457/500 29248/32000 (91%)] Loss: 2.30065 (QuantReg: 14.34379) QuantErr: 14.34379 batch_time=0.43963 
Train Epoch: 2 [465/500 29760/32000 (93%)] Loss: 2.32413 (QuantReg: 13.79689) QuantErr: 13.79689 batch_time=0.50842 
Train Epoch: 2 [473/500 30272/32000 (95%)] Loss: 2.88024 (QuantReg: 14.18608) QuantErr: 14.18608 batch_time=0.49813 
Train Epoch: 2 [481/500 30784/32000 (96%)] Loss: 2.40285 (QuantReg: 14.30106) QuantErr: 14.30106 batch_time=0.43867 
Train Epoch: 2 [489/500 31296/32000 (98%)] Loss: 2.18404 (QuantReg: 14.25579) QuantErr: 14.25579 batch_time=0.43897 
Train Epoch: 2 [497/500 31808/32000 (99%)] Loss: 2.17708 (QuantReg: 14.26103) QuantErr: 14.26103 batch_time=0.50595 
Train Epoch: 2 codebook_update_time=2.89804
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch2.pth ...
Done in 4.849s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch2.pth ...
Done in 10.258s
removing stale ckpt [epoch 1] [took 0.01s]
removing stale ckpt [epoch 0] [took 0.01s]
 epoch          : 2
 loss           : 2.6039750611782075
 quant_reg      : 13.16470530128479
 quant_err      : 13.16470530128479
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 1000
 MSRVTT_miech_test/t2v_metrics/R1: 14.3
 MSRVTT_miech_test/t2v_metrics/R5: 36.9
 MSRVTT_miech_test/t2v_metrics/R10: 54.6
 MSRVTT_miech_test/t2v_metrics/R50: 83.5
 MSRVTT_miech_test/t2v_metrics/MedR: 9.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 39.201
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.65620197974316
 MSRVTT_miech_test/v2t_metrics/R1: 14.9
 MSRVTT_miech_test/v2t_metrics/R5: 39.9
 MSRVTT_miech_test/v2t_metrics/R10: 53.9
 MSRVTT_miech_test/v2t_metrics/R50: 84.0
 MSRVTT_miech_test/v2t_metrics/MedR: 9.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 37.628
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.762594957558992
 mnt_best       : 30.65620197974316
 not_improved_count: 0
Train Epoch: 3 [1/500 64/32000 (0%)] Loss: 2.18030 (QuantReg: 11.80213) QuantErr: 11.80213 batch_time=36.10986 
Train Epoch: 3 [9/500 576/32000 (2%)] Loss: 2.10700 (QuantReg: 11.79395) QuantErr: 11.79395 batch_time=0.52540 
Train Epoch: 3 [17/500 1088/32000 (3%)] Loss: 1.99392 (QuantReg: 11.43971) QuantErr: 11.43971 batch_time=0.48002 
Train Epoch: 3 [25/500 1600/32000 (5%)] Loss: 2.55489 (QuantReg: 11.87774) QuantErr: 11.87774 batch_time=0.48931 
Train Epoch: 3 [33/500 2112/32000 (7%)] Loss: 2.30214 (QuantReg: 12.18901) QuantErr: 12.18901 batch_time=0.55480 
Train Epoch: 3 [41/500 2624/32000 (8%)] Loss: 2.67283 (QuantReg: 11.72664) QuantErr: 11.72664 batch_time=0.49767 
Train Epoch: 3 [49/500 3136/32000 (10%)] Loss: 2.67267 (QuantReg: 11.72926) QuantErr: 11.72926 batch_time=0.42271 
Train Epoch: 3 [57/500 3648/32000 (11%)] Loss: 2.61369 (QuantReg: 11.22631) QuantErr: 11.22631 batch_time=0.40284 
Train Epoch: 3 [65/500 4160/32000 (13%)] Loss: 2.42297 (QuantReg: 11.57442) QuantErr: 11.57442 batch_time=2.30504 
Train Epoch: 3 [73/500 4672/32000 (15%)] Loss: 1.95861 (QuantReg: 11.78656) QuantErr: 11.78656 batch_time=0.42070 
Train Epoch: 3 [81/500 5184/32000 (16%)] Loss: 2.52319 (QuantReg: 12.32985) QuantErr: 12.32985 batch_time=0.39801 
Train Epoch: 3 [89/500 5696/32000 (18%)] Loss: 2.02544 (QuantReg: 12.19769) QuantErr: 12.19769 batch_time=0.43538 
Train Epoch: 3 [97/500 6208/32000 (19%)] Loss: 2.80291 (QuantReg: 11.82364) QuantErr: 11.82364 batch_time=0.48269 
Train Epoch: 3 [105/500 6720/32000 (21%)] Loss: 2.49499 (QuantReg: 12.33361) QuantErr: 12.33361 batch_time=0.41027 
Train Epoch: 3 [113/500 7232/32000 (23%)] Loss: 1.83366 (QuantReg: 12.14582) QuantErr: 12.14582 batch_time=0.58142 
Train Epoch: 3 [121/500 7744/32000 (24%)] Loss: 1.97037 (QuantReg: 12.46274) QuantErr: 12.46274 batch_time=0.43835 
Train Epoch: 3 [129/500 8256/32000 (26%)] Loss: 2.25651 (QuantReg: 12.83375) QuantErr: 12.83375 batch_time=2.53212 
Train Epoch: 3 [137/500 8768/32000 (27%)] Loss: 1.89999 (QuantReg: 12.49448) QuantErr: 12.49448 batch_time=0.41047 
Train Epoch: 3 [145/500 9280/32000 (29%)] Loss: 2.01861 (QuantReg: 12.33278) QuantErr: 12.33278 batch_time=0.45622 
Train Epoch: 3 [153/500 9792/32000 (31%)] Loss: 2.99276 (QuantReg: 12.47216) QuantErr: 12.47216 batch_time=0.43462 
Train Epoch: 3 [161/500 10304/32000 (32%)] Loss: 2.01008 (QuantReg: 12.56074) QuantErr: 12.56074 batch_time=0.46984 
Train Epoch: 3 [169/500 10816/32000 (34%)] Loss: 2.23035 (QuantReg: 12.04363) QuantErr: 12.04363 batch_time=0.43167 
Train Epoch: 3 [177/500 11328/32000 (35%)] Loss: 2.33641 (QuantReg: 12.29197) QuantErr: 12.29197 batch_time=0.49025 
Train Epoch: 3 [185/500 11840/32000 (37%)] Loss: 2.56330 (QuantReg: 12.35677) QuantErr: 12.35677 batch_time=0.48074 
Train Epoch: 3 [193/500 12352/32000 (39%)] Loss: 2.58356 (QuantReg: 12.61258) QuantErr: 12.61258 batch_time=2.67454 
Train Epoch: 3 [201/500 12864/32000 (40%)] Loss: 2.14092 (QuantReg: 12.24232) QuantErr: 12.24232 batch_time=0.47277 
Train Epoch: 3 [209/500 13376/32000 (42%)] Loss: 1.94027 (QuantReg: 12.41714) QuantErr: 12.41714 batch_time=0.60404 
Train Epoch: 3 [217/500 13888/32000 (43%)] Loss: 2.25864 (QuantReg: 12.56966) QuantErr: 12.56966 batch_time=0.46298 
Train Epoch: 3 [225/500 14400/32000 (45%)] Loss: 2.07370 (QuantReg: 12.42604) QuantErr: 12.42604 batch_time=0.52091 
Train Epoch: 3 [233/500 14912/32000 (47%)] Loss: 2.23376 (QuantReg: 12.78770) QuantErr: 12.78770 batch_time=0.46056 
Train Epoch: 3 [241/500 15424/32000 (48%)] Loss: 2.14863 (QuantReg: 12.94302) QuantErr: 12.94302 batch_time=0.50759 
Train Epoch: 3 [249/500 15936/32000 (50%)] Loss: 2.20012 (QuantReg: 12.37574) QuantErr: 12.37574 batch_time=0.47140 
Train Epoch: 3 [257/500 16448/32000 (51%)] Loss: 1.65446 (QuantReg: 12.53732) QuantErr: 12.53732 batch_time=2.73439 
Train Epoch: 3 [265/500 16960/32000 (53%)] Loss: 3.07125 (QuantReg: 12.88729) QuantErr: 12.88729 batch_time=0.40687 
Train Epoch: 3 [273/500 17472/32000 (55%)] Loss: 2.06571 (QuantReg: 12.53778) QuantErr: 12.53778 batch_time=0.40406 
Train Epoch: 3 [281/500 17984/32000 (56%)] Loss: 2.07359 (QuantReg: 12.58630) QuantErr: 12.58630 batch_time=0.39971 
Train Epoch: 3 [289/500 18496/32000 (58%)] Loss: 2.07516 (QuantReg: 12.48426) QuantErr: 12.48426 batch_time=0.49957 
Train Epoch: 3 [297/500 19008/32000 (59%)] Loss: 1.85982 (QuantReg: 12.10082) QuantErr: 12.10082 batch_time=0.40229 
Train Epoch: 3 [305/500 19520/32000 (61%)] Loss: 2.01447 (QuantReg: 12.41943) QuantErr: 12.41943 batch_time=0.40840 
Train Epoch: 3 [313/500 20032/32000 (63%)] Loss: 2.26052 (QuantReg: 12.88373) QuantErr: 12.88373 batch_time=0.44886 
Train Epoch: 3 [321/500 20544/32000 (64%)] Loss: 2.82974 (QuantReg: 12.47017) QuantErr: 12.47017 batch_time=2.63279 
Train Epoch: 3 [329/500 21056/32000 (66%)] Loss: 1.99766 (QuantReg: 12.90596) QuantErr: 12.90596 batch_time=0.44874 
Train Epoch: 3 [337/500 21568/32000 (67%)] Loss: 1.67316 (QuantReg: 12.75562) QuantErr: 12.75562 batch_time=0.43531 
Train Epoch: 3 [345/500 22080/32000 (69%)] Loss: 2.19226 (QuantReg: 13.08959) QuantErr: 13.08959 batch_time=0.41990 
Train Epoch: 3 [353/500 22592/32000 (71%)] Loss: 2.25768 (QuantReg: 12.66493) QuantErr: 12.66493 batch_time=0.46517 
Train Epoch: 3 [361/500 23104/32000 (72%)] Loss: 2.63788 (QuantReg: 12.72449) QuantErr: 12.72449 batch_time=0.47353 
Train Epoch: 3 [369/500 23616/32000 (74%)] Loss: 2.30565 (QuantReg: 12.65969) QuantErr: 12.65969 batch_time=0.40789 
Train Epoch: 3 [377/500 24128/32000 (75%)] Loss: 1.75709 (QuantReg: 12.61146) QuantErr: 12.61146 batch_time=0.39690 
Train Epoch: 3 [385/500 24640/32000 (77%)] Loss: 1.98541 (QuantReg: 12.97916) QuantErr: 12.97916 batch_time=3.20633 
Train Epoch: 3 [393/500 25152/32000 (79%)] Loss: 1.93858 (QuantReg: 12.64315) QuantErr: 12.64315 batch_time=0.46780 
Train Epoch: 3 [401/500 25664/32000 (80%)] Loss: 1.82696 (QuantReg: 12.81874) QuantErr: 12.81874 batch_time=0.45033 
Train Epoch: 3 [409/500 26176/32000 (82%)] Loss: 2.37164 (QuantReg: 12.55046) QuantErr: 12.55046 batch_time=0.41812 
Train Epoch: 3 [417/500 26688/32000 (83%)] Loss: 1.74740 (QuantReg: 13.29182) QuantErr: 13.29182 batch_time=0.43832 
Train Epoch: 3 [425/500 27200/32000 (85%)] Loss: 2.22175 (QuantReg: 12.79917) QuantErr: 12.79917 batch_time=0.46188 
Train Epoch: 3 [433/500 27712/32000 (87%)] Loss: 1.94500 (QuantReg: 13.55361) QuantErr: 13.55361 batch_time=0.46997 
Train Epoch: 3 [441/500 28224/32000 (88%)] Loss: 1.78179 (QuantReg: 12.98005) QuantErr: 12.98005 batch_time=0.46422 
Train Epoch: 3 [449/500 28736/32000 (90%)] Loss: 1.90222 (QuantReg: 12.48379) QuantErr: 12.48379 batch_time=2.67340 
Train Epoch: 3 [457/500 29248/32000 (91%)] Loss: 2.06475 (QuantReg: 12.83208) QuantErr: 12.83208 batch_time=0.50311 
Train Epoch: 3 [465/500 29760/32000 (93%)] Loss: 1.80476 (QuantReg: 12.71628) QuantErr: 12.71628 batch_time=0.49811 
Train Epoch: 3 [473/500 30272/32000 (95%)] Loss: 2.49712 (QuantReg: 12.93897) QuantErr: 12.93897 batch_time=0.55178 
Train Epoch: 3 [481/500 30784/32000 (96%)] Loss: 1.48182 (QuantReg: 13.04478) QuantErr: 13.04478 batch_time=0.51242 
Train Epoch: 3 [489/500 31296/32000 (98%)] Loss: 2.08169 (QuantReg: 12.88307) QuantErr: 12.88307 batch_time=0.40999 
Train Epoch: 3 [497/500 31808/32000 (99%)] Loss: 2.13722 (QuantReg: 12.75874) QuantErr: 12.75874 batch_time=0.45935 
Train Epoch: 3 codebook_update_time=2.26390
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch3.pth ...
Done in 4.973s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch3.pth ...
Done in 10.013s
removing stale ckpt [epoch 2] [took 0.01s]
 epoch          : 3
 loss           : 2.184857651472092
 quant_reg      : 12.460440084457398
 quant_err      : 12.460440084457398
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 1500
 MSRVTT_miech_test/t2v_metrics/R1: 14.0
 MSRVTT_miech_test/t2v_metrics/R5: 40.5
 MSRVTT_miech_test/t2v_metrics/R10: 53.9
 MSRVTT_miech_test/t2v_metrics/R50: 85.2
 MSRVTT_miech_test/t2v_metrics/MedR: 9.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 35.019
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 31.264916612030362
 MSRVTT_miech_test/v2t_metrics/R1: 15.6
 MSRVTT_miech_test/v2t_metrics/R5: 40.5
 MSRVTT_miech_test/v2t_metrics/R10: 55.1
 MSRVTT_miech_test/v2t_metrics/R50: 85.5
 MSRVTT_miech_test/v2t_metrics/MedR: 8.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 33.6445
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.65204653739984
 mnt_best       : 31.264916612030362
 not_improved_count: 0
Train Epoch: 4 [1/500 64/32000 (0%)] Loss: 1.86584 (QuantReg: 11.76178) QuantErr: 11.76178 batch_time=30.29378 
Train Epoch: 4 [9/500 576/32000 (2%)] Loss: 1.88952 (QuantReg: 12.23775) QuantErr: 12.23775 batch_time=0.47551 
Train Epoch: 4 [17/500 1088/32000 (3%)] Loss: 2.63090 (QuantReg: 11.62045) QuantErr: 11.62045 batch_time=2.07593 
Train Epoch: 4 [25/500 1600/32000 (5%)] Loss: 1.63397 (QuantReg: 12.13112) QuantErr: 12.13112 batch_time=0.41854 
Train Epoch: 4 [33/500 2112/32000 (7%)] Loss: 1.89244 (QuantReg: 12.46095) QuantErr: 12.46095 batch_time=0.52430 
Train Epoch: 4 [41/500 2624/32000 (8%)] Loss: 2.49700 (QuantReg: 11.57185) QuantErr: 11.57185 batch_time=0.44880 
Train Epoch: 4 [49/500 3136/32000 (10%)] Loss: 1.73788 (QuantReg: 12.20028) QuantErr: 12.20028 batch_time=0.44950 
Train Epoch: 4 [57/500 3648/32000 (11%)] Loss: 2.00902 (QuantReg: 11.74708) QuantErr: 11.74708 batch_time=0.46049 
Train Epoch: 4 [65/500 4160/32000 (13%)] Loss: 2.30735 (QuantReg: 11.49040) QuantErr: 11.49040 batch_time=1.22625 
Train Epoch: 4 [73/500 4672/32000 (15%)] Loss: 1.75649 (QuantReg: 12.41536) QuantErr: 12.41536 batch_time=0.56900 
Train Epoch: 4 [81/500 5184/32000 (16%)] Loss: 1.94976 (QuantReg: 12.04239) QuantErr: 12.04239 batch_time=1.57968 
Train Epoch: 4 [89/500 5696/32000 (18%)] Loss: 2.09430 (QuantReg: 12.31594) QuantErr: 12.31594 batch_time=0.39509 
Train Epoch: 4 [97/500 6208/32000 (19%)] Loss: 1.99608 (QuantReg: 12.38807) QuantErr: 12.38807 batch_time=0.46186 
Train Epoch: 4 [105/500 6720/32000 (21%)] Loss: 1.89851 (QuantReg: 11.89798) QuantErr: 11.89798 batch_time=0.42675 
Train Epoch: 4 [113/500 7232/32000 (23%)] Loss: 2.16836 (QuantReg: 12.21844) QuantErr: 12.21844 batch_time=0.47317 
Train Epoch: 4 [121/500 7744/32000 (24%)] Loss: 1.56834 (QuantReg: 11.55428) QuantErr: 11.55428 batch_time=0.47400 
Train Epoch: 4 [129/500 8256/32000 (26%)] Loss: 1.63069 (QuantReg: 12.02200) QuantErr: 12.02200 batch_time=1.24508 
Train Epoch: 4 [137/500 8768/32000 (27%)] Loss: 2.10442 (QuantReg: 11.92870) QuantErr: 11.92870 batch_time=0.47405 
Train Epoch: 4 [145/500 9280/32000 (29%)] Loss: 1.63423 (QuantReg: 12.76367) QuantErr: 12.76367 batch_time=1.63136 
Train Epoch: 4 [153/500 9792/32000 (31%)] Loss: 1.43390 (QuantReg: 12.38485) QuantErr: 12.38485 batch_time=0.44703 
Train Epoch: 4 [161/500 10304/32000 (32%)] Loss: 2.02552 (QuantReg: 12.35194) QuantErr: 12.35194 batch_time=0.45841 
Train Epoch: 4 [169/500 10816/32000 (34%)] Loss: 1.74882 (QuantReg: 13.03497) QuantErr: 13.03497 batch_time=0.49160 
Train Epoch: 4 [177/500 11328/32000 (35%)] Loss: 2.05428 (QuantReg: 12.49060) QuantErr: 12.49060 batch_time=0.45284 
Train Epoch: 4 [185/500 11840/32000 (37%)] Loss: 1.47528 (QuantReg: 11.78984) QuantErr: 11.78984 batch_time=0.42459 
Train Epoch: 4 [193/500 12352/32000 (39%)] Loss: 1.83878 (QuantReg: 12.22366) QuantErr: 12.22366 batch_time=1.24129 
Train Epoch: 4 [201/500 12864/32000 (40%)] Loss: 1.89844 (QuantReg: 12.43092) QuantErr: 12.43092 batch_time=0.41933 
Train Epoch: 4 [209/500 13376/32000 (42%)] Loss: 1.52845 (QuantReg: 12.04218) QuantErr: 12.04218 batch_time=1.58456 
Train Epoch: 4 [217/500 13888/32000 (43%)] Loss: 1.97620 (QuantReg: 12.48612) QuantErr: 12.48612 batch_time=0.49803 
Train Epoch: 4 [225/500 14400/32000 (45%)] Loss: 2.37783 (QuantReg: 11.84620) QuantErr: 11.84620 batch_time=0.49161 
Train Epoch: 4 [233/500 14912/32000 (47%)] Loss: 1.96215 (QuantReg: 11.95651) QuantErr: 11.95651 batch_time=0.51404 
Train Epoch: 4 [241/500 15424/32000 (48%)] Loss: 2.15777 (QuantReg: 12.33015) QuantErr: 12.33015 batch_time=0.47570 
Train Epoch: 4 [249/500 15936/32000 (50%)] Loss: 1.80609 (QuantReg: 12.71112) QuantErr: 12.71112 batch_time=0.47505 
Train Epoch: 4 [257/500 16448/32000 (51%)] Loss: 1.57029 (QuantReg: 12.61343) QuantErr: 12.61343 batch_time=1.29386 
Train Epoch: 4 [265/500 16960/32000 (53%)] Loss: 1.95411 (QuantReg: 12.72124) QuantErr: 12.72124 batch_time=0.43622 
Train Epoch: 4 [273/500 17472/32000 (55%)] Loss: 2.36210 (QuantReg: 12.52159) QuantErr: 12.52159 batch_time=1.52009 
Train Epoch: 4 [281/500 17984/32000 (56%)] Loss: 1.63589 (QuantReg: 12.68240) QuantErr: 12.68240 batch_time=0.44307 
Train Epoch: 4 [289/500 18496/32000 (58%)] Loss: 1.27261 (QuantReg: 12.55503) QuantErr: 12.55503 batch_time=0.45454 
Train Epoch: 4 [297/500 19008/32000 (59%)] Loss: 1.43424 (QuantReg: 12.50386) QuantErr: 12.50386 batch_time=0.48864 
Train Epoch: 4 [305/500 19520/32000 (61%)] Loss: 1.58699 (QuantReg: 12.27264) QuantErr: 12.27264 batch_time=0.46939 
Train Epoch: 4 [313/500 20032/32000 (63%)] Loss: 1.50383 (QuantReg: 12.28135) QuantErr: 12.28135 batch_time=0.47338 
Train Epoch: 4 [321/500 20544/32000 (64%)] Loss: 1.87073 (QuantReg: 12.41397) QuantErr: 12.41397 batch_time=1.24737 
Train Epoch: 4 [329/500 21056/32000 (66%)] Loss: 1.38509 (QuantReg: 12.30655) QuantErr: 12.30655 batch_time=0.44180 
Train Epoch: 4 [337/500 21568/32000 (67%)] Loss: 1.49479 (QuantReg: 12.58740) QuantErr: 12.58740 batch_time=1.68239 
Train Epoch: 4 [345/500 22080/32000 (69%)] Loss: 1.58346 (QuantReg: 12.79800) QuantErr: 12.79800 batch_time=0.43218 
Train Epoch: 4 [353/500 22592/32000 (71%)] Loss: 1.83337 (QuantReg: 13.18153) QuantErr: 13.18153 batch_time=0.52009 
Train Epoch: 4 [361/500 23104/32000 (72%)] Loss: 1.86937 (QuantReg: 12.70987) QuantErr: 12.70987 batch_time=0.44501 
Train Epoch: 4 [369/500 23616/32000 (74%)] Loss: 1.99156 (QuantReg: 12.85652) QuantErr: 12.85652 batch_time=0.42973 
Train Epoch: 4 [377/500 24128/32000 (75%)] Loss: 1.57703 (QuantReg: 12.74110) QuantErr: 12.74110 batch_time=0.42272 
Train Epoch: 4 [385/500 24640/32000 (77%)] Loss: 2.10272 (QuantReg: 12.73159) QuantErr: 12.73159 batch_time=1.22171 
Train Epoch: 4 [393/500 25152/32000 (79%)] Loss: 1.47591 (QuantReg: 12.98123) QuantErr: 12.98123 batch_time=0.40978 
Train Epoch: 4 [401/500 25664/32000 (80%)] Loss: 1.72391 (QuantReg: 12.77159) QuantErr: 12.77159 batch_time=1.50124 
Train Epoch: 4 [409/500 26176/32000 (82%)] Loss: 1.81793 (QuantReg: 13.20210) QuantErr: 13.20210 batch_time=0.52696 
Train Epoch: 4 [417/500 26688/32000 (83%)] Loss: 2.04119 (QuantReg: 12.32269) QuantErr: 12.32269 batch_time=0.54574 
Train Epoch: 4 [425/500 27200/32000 (85%)] Loss: 1.70492 (QuantReg: 12.88768) QuantErr: 12.88768 batch_time=0.43555 
Train Epoch: 4 [433/500 27712/32000 (87%)] Loss: 1.67503 (QuantReg: 12.64933) QuantErr: 12.64933 batch_time=0.41528 
Train Epoch: 4 [441/500 28224/32000 (88%)] Loss: 1.32707 (QuantReg: 12.91637) QuantErr: 12.91637 batch_time=0.43660 
Train Epoch: 4 [449/500 28736/32000 (90%)] Loss: 1.98884 (QuantReg: 12.85951) QuantErr: 12.85951 batch_time=1.18093 
Train Epoch: 4 [457/500 29248/32000 (91%)] Loss: 1.62309 (QuantReg: 13.17012) QuantErr: 13.17012 batch_time=0.47114 
Train Epoch: 4 [465/500 29760/32000 (93%)] Loss: 1.75556 (QuantReg: 12.66971) QuantErr: 12.66971 batch_time=1.60788 
Train Epoch: 4 [473/500 30272/32000 (95%)] Loss: 1.63953 (QuantReg: 13.18196) QuantErr: 13.18196 batch_time=0.47337 
Train Epoch: 4 [481/500 30784/32000 (96%)] Loss: 1.95383 (QuantReg: 12.70278) QuantErr: 12.70278 batch_time=0.49608 
Train Epoch: 4 [489/500 31296/32000 (98%)] Loss: 1.65431 (QuantReg: 12.94776) QuantErr: 12.94776 batch_time=0.41680 
Train Epoch: 4 [497/500 31808/32000 (99%)] Loss: 1.86081 (QuantReg: 13.57233) QuantErr: 13.57233 batch_time=0.40584 
Train Epoch: 4 codebook_update_time=2.20275
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch4.pth ...
Done in 5.350s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch4.pth ...
Done in 10.271s
removing stale ckpt [epoch 3] [took 0.01s]
 epoch          : 4
 loss           : 1.8901634414196014
 quant_reg      : 12.394084913253785
 quant_err      : 12.394084913253785
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 2000
 MSRVTT_miech_test/t2v_metrics/R1: 16.6
 MSRVTT_miech_test/t2v_metrics/R5: 43.5
 MSRVTT_miech_test/t2v_metrics/R10: 57.4
 MSRVTT_miech_test/t2v_metrics/R50: 86.7
 MSRVTT_miech_test/t2v_metrics/MedR: 7.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.294
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 34.60746160926859
 MSRVTT_miech_test/v2t_metrics/R1: 16.8
 MSRVTT_miech_test/v2t_metrics/R5: 43.4
 MSRVTT_miech_test/v2t_metrics/R10: 58.6
 MSRVTT_miech_test/v2t_metrics/R50: 87.1
 MSRVTT_miech_test/v2t_metrics/MedR: 7.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 30.553
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.959526548509025
 mnt_best       : 34.60746160926859
 not_improved_count: 0
Train Epoch: 5 [1/500 64/32000 (0%)] Loss: 1.99368 (QuantReg: 12.17865) QuantErr: 12.17865 batch_time=32.30713 
Train Epoch: 5 [9/500 576/32000 (2%)] Loss: 2.32232 (QuantReg: 11.75036) QuantErr: 11.75036 batch_time=0.43179 
Train Epoch: 5 [17/500 1088/32000 (3%)] Loss: 1.73079 (QuantReg: 12.12050) QuantErr: 12.12050 batch_time=0.41441 
Train Epoch: 5 [25/500 1600/32000 (5%)] Loss: 1.35359 (QuantReg: 12.31075) QuantErr: 12.31075 batch_time=0.41369 
Train Epoch: 5 [33/500 2112/32000 (7%)] Loss: 2.32086 (QuantReg: 12.55247) QuantErr: 12.55247 batch_time=0.43794 
Train Epoch: 5 [41/500 2624/32000 (8%)] Loss: 1.60859 (QuantReg: 11.95379) QuantErr: 11.95379 batch_time=0.43884 
Train Epoch: 5 [49/500 3136/32000 (10%)] Loss: 1.26397 (QuantReg: 12.06956) QuantErr: 12.06956 batch_time=0.41759 
Train Epoch: 5 [57/500 3648/32000 (11%)] Loss: 1.66659 (QuantReg: 12.59511) QuantErr: 12.59511 batch_time=0.43995 
Train Epoch: 5 [65/500 4160/32000 (13%)] Loss: 1.74646 (QuantReg: 12.52991) QuantErr: 12.52991 batch_time=2.68180 
Train Epoch: 5 [73/500 4672/32000 (15%)] Loss: 1.83375 (QuantReg: 12.31959) QuantErr: 12.31959 batch_time=0.43906 
Train Epoch: 5 [81/500 5184/32000 (16%)] Loss: 1.78811 (QuantReg: 12.68943) QuantErr: 12.68943 batch_time=0.43194 
Train Epoch: 5 [89/500 5696/32000 (18%)] Loss: 2.22426 (QuantReg: 12.35760) QuantErr: 12.35760 batch_time=0.44899 
Train Epoch: 5 [97/500 6208/32000 (19%)] Loss: 1.77296 (QuantReg: 12.39280) QuantErr: 12.39280 batch_time=0.41020 
Train Epoch: 5 [105/500 6720/32000 (21%)] Loss: 1.70716 (QuantReg: 12.53420) QuantErr: 12.53420 batch_time=0.55884 
Train Epoch: 5 [113/500 7232/32000 (23%)] Loss: 2.02518 (QuantReg: 12.39881) QuantErr: 12.39881 batch_time=0.44290 
Train Epoch: 5 [121/500 7744/32000 (24%)] Loss: 1.85536 (QuantReg: 12.30526) QuantErr: 12.30526 batch_time=0.46215 
Train Epoch: 5 [129/500 8256/32000 (26%)] Loss: 1.59791 (QuantReg: 12.42286) QuantErr: 12.42286 batch_time=3.10540 
Train Epoch: 5 [137/500 8768/32000 (27%)] Loss: 1.74654 (QuantReg: 11.98316) QuantErr: 11.98316 batch_time=0.46474 
Train Epoch: 5 [145/500 9280/32000 (29%)] Loss: 1.77824 (QuantReg: 12.55652) QuantErr: 12.55652 batch_time=0.49738 
Train Epoch: 5 [153/500 9792/32000 (31%)] Loss: 1.61779 (QuantReg: 12.39413) QuantErr: 12.39413 batch_time=0.48256 
Train Epoch: 5 [161/500 10304/32000 (32%)] Loss: 1.36432 (QuantReg: 12.12751) QuantErr: 12.12751 batch_time=0.50880 
Train Epoch: 5 [169/500 10816/32000 (34%)] Loss: 1.83999 (QuantReg: 12.54591) QuantErr: 12.54591 batch_time=0.48266 
Train Epoch: 5 [177/500 11328/32000 (35%)] Loss: 1.74575 (QuantReg: 12.04678) QuantErr: 12.04678 batch_time=0.46421 
Train Epoch: 5 [185/500 11840/32000 (37%)] Loss: 1.78347 (QuantReg: 12.50024) QuantErr: 12.50024 batch_time=0.46817 
Train Epoch: 5 [193/500 12352/32000 (39%)] Loss: 2.04298 (QuantReg: 12.59157) QuantErr: 12.59157 batch_time=2.77731 
Train Epoch: 5 [201/500 12864/32000 (40%)] Loss: 2.17398 (QuantReg: 12.19317) QuantErr: 12.19317 batch_time=0.42790 
Train Epoch: 5 [209/500 13376/32000 (42%)] Loss: 1.60835 (QuantReg: 12.74063) QuantErr: 12.74063 batch_time=0.45238 
Train Epoch: 5 [217/500 13888/32000 (43%)] Loss: 1.78107 (QuantReg: 12.44697) QuantErr: 12.44697 batch_time=0.46429 
Train Epoch: 5 [225/500 14400/32000 (45%)] Loss: 2.01369 (QuantReg: 12.23605) QuantErr: 12.23605 batch_time=0.40904 
Train Epoch: 5 [233/500 14912/32000 (47%)] Loss: 1.67027 (QuantReg: 12.52401) QuantErr: 12.52401 batch_time=0.39865 
Train Epoch: 5 [241/500 15424/32000 (48%)] Loss: 1.91463 (QuantReg: 12.40037) QuantErr: 12.40037 batch_time=0.47188 
Train Epoch: 5 [249/500 15936/32000 (50%)] Loss: 2.32583 (QuantReg: 12.45362) QuantErr: 12.45362 batch_time=0.42985 
Train Epoch: 5 [257/500 16448/32000 (51%)] Loss: 2.08368 (QuantReg: 12.12322) QuantErr: 12.12322 batch_time=2.81410 
Train Epoch: 5 [265/500 16960/32000 (53%)] Loss: 2.04825 (QuantReg: 12.76051) QuantErr: 12.76051 batch_time=0.44393 
Train Epoch: 5 [273/500 17472/32000 (55%)] Loss: 1.45047 (QuantReg: 12.85554) QuantErr: 12.85554 batch_time=0.43518 
Train Epoch: 5 [281/500 17984/32000 (56%)] Loss: 1.82128 (QuantReg: 12.77593) QuantErr: 12.77593 batch_time=0.53529 
Train Epoch: 5 [289/500 18496/32000 (58%)] Loss: 1.61425 (QuantReg: 12.66634) QuantErr: 12.66634 batch_time=0.43264 
Train Epoch: 5 [297/500 19008/32000 (59%)] Loss: 1.95562 (QuantReg: 12.85970) QuantErr: 12.85970 batch_time=0.45887 
Train Epoch: 5 [305/500 19520/32000 (61%)] Loss: 1.41433 (QuantReg: 12.77836) QuantErr: 12.77836 batch_time=0.46652 
Train Epoch: 5 [313/500 20032/32000 (63%)] Loss: 1.67431 (QuantReg: 12.38724) QuantErr: 12.38724 batch_time=0.44699 
Train Epoch: 5 [321/500 20544/32000 (64%)] Loss: 1.89668 (QuantReg: 12.28319) QuantErr: 12.28319 batch_time=2.81426 
Train Epoch: 5 [329/500 21056/32000 (66%)] Loss: 1.91038 (QuantReg: 11.94040) QuantErr: 11.94040 batch_time=0.41989 
Train Epoch: 5 [337/500 21568/32000 (67%)] Loss: 1.67415 (QuantReg: 12.55987) QuantErr: 12.55987 batch_time=0.43652 
Train Epoch: 5 [345/500 22080/32000 (69%)] Loss: 1.78444 (QuantReg: 12.32649) QuantErr: 12.32649 batch_time=0.47666 
Train Epoch: 5 [353/500 22592/32000 (71%)] Loss: 1.65810 (QuantReg: 12.75825) QuantErr: 12.75825 batch_time=0.52411 
Train Epoch: 5 [361/500 23104/32000 (72%)] Loss: 1.61765 (QuantReg: 12.77230) QuantErr: 12.77230 batch_time=0.41849 
Train Epoch: 5 [369/500 23616/32000 (74%)] Loss: 1.70292 (QuantReg: 12.11658) QuantErr: 12.11658 batch_time=0.43351 
Train Epoch: 5 [377/500 24128/32000 (75%)] Loss: 1.41619 (QuantReg: 12.54065) QuantErr: 12.54065 batch_time=0.54449 
Train Epoch: 5 [385/500 24640/32000 (77%)] Loss: 1.54994 (QuantReg: 12.93802) QuantErr: 12.93802 batch_time=2.70139 
Train Epoch: 5 [393/500 25152/32000 (79%)] Loss: 1.66609 (QuantReg: 13.23559) QuantErr: 13.23559 batch_time=0.41241 
Train Epoch: 5 [401/500 25664/32000 (80%)] Loss: 2.42002 (QuantReg: 12.51219) QuantErr: 12.51219 batch_time=0.39997 
Train Epoch: 5 [409/500 26176/32000 (82%)] Loss: 1.26322 (QuantReg: 12.69090) QuantErr: 12.69090 batch_time=0.46918 
Train Epoch: 5 [417/500 26688/32000 (83%)] Loss: 1.80410 (QuantReg: 12.61777) QuantErr: 12.61777 batch_time=0.44721 
Train Epoch: 5 [425/500 27200/32000 (85%)] Loss: 1.88740 (QuantReg: 12.66142) QuantErr: 12.66142 batch_time=0.47094 
Train Epoch: 5 [433/500 27712/32000 (87%)] Loss: 1.24539 (QuantReg: 12.95887) QuantErr: 12.95887 batch_time=0.47901 
Train Epoch: 5 [441/500 28224/32000 (88%)] Loss: 1.60295 (QuantReg: 12.71714) QuantErr: 12.71714 batch_time=0.47854 
Train Epoch: 5 [449/500 28736/32000 (90%)] Loss: 2.00912 (QuantReg: 12.76694) QuantErr: 12.76694 batch_time=2.70566 
Train Epoch: 5 [457/500 29248/32000 (91%)] Loss: 1.37917 (QuantReg: 13.07587) QuantErr: 13.07587 batch_time=0.44471 
Train Epoch: 5 [465/500 29760/32000 (93%)] Loss: 1.56469 (QuantReg: 13.31014) QuantErr: 13.31014 batch_time=0.51873 
Train Epoch: 5 [473/500 30272/32000 (95%)] Loss: 1.64040 (QuantReg: 13.19507) QuantErr: 13.19507 batch_time=0.50773 
Train Epoch: 5 [481/500 30784/32000 (96%)] Loss: 1.60965 (QuantReg: 12.87023) QuantErr: 12.87023 batch_time=0.45586 
Train Epoch: 5 [489/500 31296/32000 (98%)] Loss: 1.98184 (QuantReg: 12.49057) QuantErr: 12.49057 batch_time=0.46319 
Train Epoch: 5 [497/500 31808/32000 (99%)] Loss: 1.72644 (QuantReg: 12.99829) QuantErr: 12.99829 batch_time=0.50652 
Train Epoch: 5 codebook_update_time=2.00601
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch5.pth ...
Done in 5.116s
removing stale ckpt [epoch 4] [took 0.00s]
 epoch          : 5
 loss           : 1.6862954934835435
 quant_reg      : 12.525859945297242
 quant_err      : 12.525859945297242
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 2500
 MSRVTT_miech_test/t2v_metrics/R1: 15.5
 MSRVTT_miech_test/t2v_metrics/R5: 43.4
 MSRVTT_miech_test/t2v_metrics/R10: 57.9
 MSRVTT_miech_test/t2v_metrics/R50: 86.5
 MSRVTT_miech_test/t2v_metrics/MedR: 7.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.751
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 33.897421510966666
 MSRVTT_miech_test/v2t_metrics/R1: 16.4
 MSRVTT_miech_test/v2t_metrics/R5: 45.0
 MSRVTT_miech_test/v2t_metrics/R10: 59.0
 MSRVTT_miech_test/v2t_metrics/R50: 86.1
 MSRVTT_miech_test/v2t_metrics/MedR: 7.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 30.629
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.180563477623394
 mnt_best       : 34.60746160926859
 not_improved_count: 1
Train Epoch: 6 [1/500 64/32000 (0%)] Loss: 1.41491 (QuantReg: 12.01762) QuantErr: 12.01762 batch_time=27.96566 
Train Epoch: 6 [9/500 576/32000 (2%)] Loss: 1.10708 (QuantReg: 12.07107) QuantErr: 12.07107 batch_time=0.45005 
Train Epoch: 6 [17/500 1088/32000 (3%)] Loss: 1.37160 (QuantReg: 11.99766) QuantErr: 11.99766 batch_time=0.52998 
Train Epoch: 6 [25/500 1600/32000 (5%)] Loss: 1.56911 (QuantReg: 11.78032) QuantErr: 11.78032 batch_time=0.41786 
Train Epoch: 6 [33/500 2112/32000 (7%)] Loss: 1.51327 (QuantReg: 12.12950) QuantErr: 12.12950 batch_time=0.45965 
Train Epoch: 6 [41/500 2624/32000 (8%)] Loss: 1.35228 (QuantReg: 12.39129) QuantErr: 12.39129 batch_time=0.44090 
Train Epoch: 6 [49/500 3136/32000 (10%)] Loss: 1.50194 (QuantReg: 12.74267) QuantErr: 12.74267 batch_time=0.49241 
Train Epoch: 6 [57/500 3648/32000 (11%)] Loss: 1.79286 (QuantReg: 12.73287) QuantErr: 12.73287 batch_time=0.47922 
Train Epoch: 6 [65/500 4160/32000 (13%)] Loss: 1.52155 (QuantReg: 13.20605) QuantErr: 13.20605 batch_time=0.48542 
Train Epoch: 6 [73/500 4672/32000 (15%)] Loss: 0.97426 (QuantReg: 11.81585) QuantErr: 11.81585 batch_time=0.45049 
Train Epoch: 6 [81/500 5184/32000 (16%)] Loss: 1.34691 (QuantReg: 11.88713) QuantErr: 11.88713 batch_time=0.50583 
Train Epoch: 6 [89/500 5696/32000 (18%)] Loss: 1.62898 (QuantReg: 11.76647) QuantErr: 11.76647 batch_time=0.48023 
Train Epoch: 6 [97/500 6208/32000 (19%)] Loss: 1.30553 (QuantReg: 12.31618) QuantErr: 12.31618 batch_time=0.49071 
Train Epoch: 6 [105/500 6720/32000 (21%)] Loss: 1.91576 (QuantReg: 12.46734) QuantErr: 12.46734 batch_time=0.45048 
Train Epoch: 6 [113/500 7232/32000 (23%)] Loss: 1.62162 (QuantReg: 12.54294) QuantErr: 12.54294 batch_time=0.46812 
Train Epoch: 6 [121/500 7744/32000 (24%)] Loss: 1.37731 (QuantReg: 12.69439) QuantErr: 12.69439 batch_time=0.40731 
Train Epoch: 6 [129/500 8256/32000 (26%)] Loss: 1.45499 (QuantReg: 13.13073) QuantErr: 13.13073 batch_time=0.46200 
Train Epoch: 6 [137/500 8768/32000 (27%)] Loss: 1.66541 (QuantReg: 12.25709) QuantErr: 12.25709 batch_time=0.51222 
Train Epoch: 6 [145/500 9280/32000 (29%)] Loss: 1.55348 (QuantReg: 13.02937) QuantErr: 13.02937 batch_time=0.39272 
Train Epoch: 6 [153/500 9792/32000 (31%)] Loss: 1.42355 (QuantReg: 12.25845) QuantErr: 12.25845 batch_time=0.48361 
Train Epoch: 6 [161/500 10304/32000 (32%)] Loss: 1.21097 (QuantReg: 12.55017) QuantErr: 12.55017 batch_time=0.42726 
Train Epoch: 6 [169/500 10816/32000 (34%)] Loss: 2.30217 (QuantReg: 12.30526) QuantErr: 12.30526 batch_time=0.40697 
Train Epoch: 6 [177/500 11328/32000 (35%)] Loss: 1.39703 (QuantReg: 12.17224) QuantErr: 12.17224 batch_time=0.49766 
Train Epoch: 6 [185/500 11840/32000 (37%)] Loss: 1.22261 (QuantReg: 12.75738) QuantErr: 12.75738 batch_time=0.45405 
Train Epoch: 6 [193/500 12352/32000 (39%)] Loss: 1.03570 (QuantReg: 12.36463) QuantErr: 12.36463 batch_time=0.39287 
Train Epoch: 6 [201/500 12864/32000 (40%)] Loss: 1.50764 (QuantReg: 12.60363) QuantErr: 12.60363 batch_time=0.46481 
Train Epoch: 6 [209/500 13376/32000 (42%)] Loss: 1.72636 (QuantReg: 12.70906) QuantErr: 12.70906 batch_time=0.44973 
Train Epoch: 6 [217/500 13888/32000 (43%)] Loss: 2.32504 (QuantReg: 12.16002) QuantErr: 12.16002 batch_time=0.45646 
Train Epoch: 6 [225/500 14400/32000 (45%)] Loss: 1.30522 (QuantReg: 12.65286) QuantErr: 12.65286 batch_time=0.43194 
Train Epoch: 6 [233/500 14912/32000 (47%)] Loss: 1.38569 (QuantReg: 12.37758) QuantErr: 12.37758 batch_time=0.46986 
Train Epoch: 6 [241/500 15424/32000 (48%)] Loss: 1.47624 (QuantReg: 12.70391) QuantErr: 12.70391 batch_time=0.47627 
Train Epoch: 6 [249/500 15936/32000 (50%)] Loss: 1.23195 (QuantReg: 12.57061) QuantErr: 12.57061 batch_time=0.42167 
Train Epoch: 6 [257/500 16448/32000 (51%)] Loss: 1.83306 (QuantReg: 12.20422) QuantErr: 12.20422 batch_time=0.44920 
Train Epoch: 6 [265/500 16960/32000 (53%)] Loss: 2.06241 (QuantReg: 12.50087) QuantErr: 12.50087 batch_time=0.43858 
Train Epoch: 6 [273/500 17472/32000 (55%)] Loss: 1.23566 (QuantReg: 12.59134) QuantErr: 12.59134 batch_time=0.44537 
Train Epoch: 6 [281/500 17984/32000 (56%)] Loss: 1.12484 (QuantReg: 12.84098) QuantErr: 12.84098 batch_time=0.42478 
Train Epoch: 6 [289/500 18496/32000 (58%)] Loss: 1.21851 (QuantReg: 12.56406) QuantErr: 12.56406 batch_time=0.41588 
Train Epoch: 6 [297/500 19008/32000 (59%)] Loss: 1.47606 (QuantReg: 12.62532) QuantErr: 12.62532 batch_time=0.45338 
Train Epoch: 6 [305/500 19520/32000 (61%)] Loss: 1.38306 (QuantReg: 12.02523) QuantErr: 12.02523 batch_time=0.52726 
Train Epoch: 6 [313/500 20032/32000 (63%)] Loss: 1.59348 (QuantReg: 13.10393) QuantErr: 13.10393 batch_time=0.44647 
Train Epoch: 6 [321/500 20544/32000 (64%)] Loss: 1.74086 (QuantReg: 12.71668) QuantErr: 12.71668 batch_time=0.41108 
Train Epoch: 6 [329/500 21056/32000 (66%)] Loss: 1.70399 (QuantReg: 12.78121) QuantErr: 12.78121 batch_time=0.54405 
Train Epoch: 6 [337/500 21568/32000 (67%)] Loss: 1.28540 (QuantReg: 12.89859) QuantErr: 12.89859 batch_time=0.47120 
Train Epoch: 6 [345/500 22080/32000 (69%)] Loss: 1.15952 (QuantReg: 12.56947) QuantErr: 12.56947 batch_time=0.51518 
Train Epoch: 6 [353/500 22592/32000 (71%)] Loss: 1.39990 (QuantReg: 12.69602) QuantErr: 12.69602 batch_time=0.51566 
Train Epoch: 6 [361/500 23104/32000 (72%)] Loss: 1.22565 (QuantReg: 13.13126) QuantErr: 13.13126 batch_time=0.48039 
Train Epoch: 6 [369/500 23616/32000 (74%)] Loss: 0.77195 (QuantReg: 12.88772) QuantErr: 12.88772 batch_time=0.56890 
Train Epoch: 6 [377/500 24128/32000 (75%)] Loss: 1.34675 (QuantReg: 13.15860) QuantErr: 13.15860 batch_time=0.41767 
Train Epoch: 6 [385/500 24640/32000 (77%)] Loss: 1.55290 (QuantReg: 12.73950) QuantErr: 12.73950 batch_time=0.47182 
Train Epoch: 6 [393/500 25152/32000 (79%)] Loss: 1.65529 (QuantReg: 12.90111) QuantErr: 12.90111 batch_time=0.47808 
Train Epoch: 6 [401/500 25664/32000 (80%)] Loss: 1.39843 (QuantReg: 13.08328) QuantErr: 13.08328 batch_time=0.48557 
Train Epoch: 6 [409/500 26176/32000 (82%)] Loss: 1.17474 (QuantReg: 12.69515) QuantErr: 12.69515 batch_time=0.46850 
Train Epoch: 6 [417/500 26688/32000 (83%)] Loss: 1.35976 (QuantReg: 12.71531) QuantErr: 12.71531 batch_time=0.46516 
Train Epoch: 6 [425/500 27200/32000 (85%)] Loss: 1.02517 (QuantReg: 13.38121) QuantErr: 13.38121 batch_time=0.50119 
Train Epoch: 6 [433/500 27712/32000 (87%)] Loss: 1.20106 (QuantReg: 12.62858) QuantErr: 12.62858 batch_time=0.57569 
Train Epoch: 6 [441/500 28224/32000 (88%)] Loss: 1.22644 (QuantReg: 13.29923) QuantErr: 13.29923 batch_time=0.48009 
Train Epoch: 6 [449/500 28736/32000 (90%)] Loss: 0.80408 (QuantReg: 12.93303) QuantErr: 12.93303 batch_time=0.47712 
Train Epoch: 6 [457/500 29248/32000 (91%)] Loss: 1.59753 (QuantReg: 12.61256) QuantErr: 12.61256 batch_time=0.42350 
Train Epoch: 6 [465/500 29760/32000 (93%)] Loss: 1.88005 (QuantReg: 12.88532) QuantErr: 12.88532 batch_time=0.46254 
Train Epoch: 6 [473/500 30272/32000 (95%)] Loss: 1.31445 (QuantReg: 13.11265) QuantErr: 13.11265 batch_time=0.47220 
Train Epoch: 6 [481/500 30784/32000 (96%)] Loss: 1.86834 (QuantReg: 12.63626) QuantErr: 12.63626 batch_time=0.44321 
Train Epoch: 6 [489/500 31296/32000 (98%)] Loss: 1.85550 (QuantReg: 13.25086) QuantErr: 13.25086 batch_time=0.49524 
Train Epoch: 6 [497/500 31808/32000 (99%)] Loss: 1.74819 (QuantReg: 13.07341) QuantErr: 13.07341 batch_time=0.57702 
Train Epoch: 6 codebook_update_time=2.17075
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch6.pth ...
Done in 5.323s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch6.pth ...
Done in 10.455s
removing stale ckpt [epoch 5] [took 0.07s]
 epoch          : 6
 loss           : 1.5361189658641816
 quant_reg      : 12.581753173828124
 quant_err      : 12.581753173828124
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 3000
 MSRVTT_miech_test/t2v_metrics/R1: 15.8
 MSRVTT_miech_test/t2v_metrics/R5: 45.1
 MSRVTT_miech_test/t2v_metrics/R10: 59.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.0
 MSRVTT_miech_test/t2v_metrics/MedR: 7.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.959
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 34.86985955590018
 MSRVTT_miech_test/v2t_metrics/R1: 17.5
 MSRVTT_miech_test/v2t_metrics/R5: 44.4
 MSRVTT_miech_test/v2t_metrics/R10: 59.5
 MSRVTT_miech_test/v2t_metrics/R50: 86.7
 MSRVTT_miech_test/v2t_metrics/MedR: 7.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 30.4555
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.89048508582687
 mnt_best       : 34.86985955590018
 not_improved_count: 0
Train Epoch: 7 [1/500 64/32000 (0%)] Loss: 1.84174 (QuantReg: 12.22212) QuantErr: 12.22212 batch_time=28.92164 
Train Epoch: 7 [9/500 576/32000 (2%)] Loss: 1.50923 (QuantReg: 11.94333) QuantErr: 11.94333 batch_time=0.41042 
Train Epoch: 7 [17/500 1088/32000 (3%)] Loss: 1.70424 (QuantReg: 12.44126) QuantErr: 12.44126 batch_time=0.44596 
Train Epoch: 7 [25/500 1600/32000 (5%)] Loss: 1.03340 (QuantReg: 12.25613) QuantErr: 12.25613 batch_time=0.42272 
Train Epoch: 7 [33/500 2112/32000 (7%)] Loss: 1.65071 (QuantReg: 12.79188) QuantErr: 12.79188 batch_time=0.40773 
Train Epoch: 7 [41/500 2624/32000 (8%)] Loss: 1.29423 (QuantReg: 12.77496) QuantErr: 12.77496 batch_time=0.44099 
Train Epoch: 7 [49/500 3136/32000 (10%)] Loss: 1.40518 (QuantReg: 12.48885) QuantErr: 12.48885 batch_time=0.50287 
Train Epoch: 7 [57/500 3648/32000 (11%)] Loss: 1.47360 (QuantReg: 12.79632) QuantErr: 12.79632 batch_time=0.48715 
Train Epoch: 7 [65/500 4160/32000 (13%)] Loss: 1.34499 (QuantReg: 12.26890) QuantErr: 12.26890 batch_time=0.61057 
Train Epoch: 7 [73/500 4672/32000 (15%)] Loss: 1.85565 (QuantReg: 12.79506) QuantErr: 12.79506 batch_time=0.44466 
Train Epoch: 7 [81/500 5184/32000 (16%)] Loss: 1.67964 (QuantReg: 12.70883) QuantErr: 12.70883 batch_time=0.40309 
Train Epoch: 7 [89/500 5696/32000 (18%)] Loss: 1.24285 (QuantReg: 12.91287) QuantErr: 12.91287 batch_time=0.42767 
Train Epoch: 7 [97/500 6208/32000 (19%)] Loss: 1.33697 (QuantReg: 12.64962) QuantErr: 12.64962 batch_time=0.45423 
Train Epoch: 7 [105/500 6720/32000 (21%)] Loss: 1.18356 (QuantReg: 12.79130) QuantErr: 12.79130 batch_time=0.79074 
Train Epoch: 7 [113/500 7232/32000 (23%)] Loss: 1.28268 (QuantReg: 12.66916) QuantErr: 12.66916 batch_time=0.45826 
Train Epoch: 7 [121/500 7744/32000 (24%)] Loss: 1.92865 (QuantReg: 12.36657) QuantErr: 12.36657 batch_time=0.47017 
Train Epoch: 7 [129/500 8256/32000 (26%)] Loss: 1.23014 (QuantReg: 12.84466) QuantErr: 12.84466 batch_time=0.51090 
Train Epoch: 7 [137/500 8768/32000 (27%)] Loss: 1.44451 (QuantReg: 11.93519) QuantErr: 11.93519 batch_time=0.54503 
Train Epoch: 7 [145/500 9280/32000 (29%)] Loss: 1.35956 (QuantReg: 12.96636) QuantErr: 12.96636 batch_time=0.43185 
Train Epoch: 7 [153/500 9792/32000 (31%)] Loss: 1.21024 (QuantReg: 12.88296) QuantErr: 12.88296 batch_time=0.42858 
Train Epoch: 7 [161/500 10304/32000 (32%)] Loss: 0.82195 (QuantReg: 12.63825) QuantErr: 12.63825 batch_time=0.41167 
Train Epoch: 7 [169/500 10816/32000 (34%)] Loss: 1.57454 (QuantReg: 12.39977) QuantErr: 12.39977 batch_time=0.41096 
Train Epoch: 7 [177/500 11328/32000 (35%)] Loss: 1.61834 (QuantReg: 12.51348) QuantErr: 12.51348 batch_time=0.47555 
Train Epoch: 7 [185/500 11840/32000 (37%)] Loss: 1.46407 (QuantReg: 12.36407) QuantErr: 12.36407 batch_time=0.54754 
Train Epoch: 7 [193/500 12352/32000 (39%)] Loss: 1.72499 (QuantReg: 12.57921) QuantErr: 12.57921 batch_time=0.58233 
Train Epoch: 7 [201/500 12864/32000 (40%)] Loss: 1.56986 (QuantReg: 12.68047) QuantErr: 12.68047 batch_time=0.40738 
Train Epoch: 7 [209/500 13376/32000 (42%)] Loss: 1.25366 (QuantReg: 12.93775) QuantErr: 12.93775 batch_time=0.44609 
Train Epoch: 7 [217/500 13888/32000 (43%)] Loss: 1.24100 (QuantReg: 12.42547) QuantErr: 12.42547 batch_time=0.48896 
Train Epoch: 7 [225/500 14400/32000 (45%)] Loss: 1.70333 (QuantReg: 13.00524) QuantErr: 13.00524 batch_time=0.49467 
Train Epoch: 7 [233/500 14912/32000 (47%)] Loss: 1.03447 (QuantReg: 12.83596) QuantErr: 12.83596 batch_time=0.47803 
Train Epoch: 7 [241/500 15424/32000 (48%)] Loss: 2.20592 (QuantReg: 12.88484) QuantErr: 12.88484 batch_time=0.50560 
Train Epoch: 7 [249/500 15936/32000 (50%)] Loss: 1.32521 (QuantReg: 12.52742) QuantErr: 12.52742 batch_time=0.48977 
Train Epoch: 7 [257/500 16448/32000 (51%)] Loss: 1.29671 (QuantReg: 12.75150) QuantErr: 12.75150 batch_time=0.56117 
Train Epoch: 7 [265/500 16960/32000 (53%)] Loss: 1.42787 (QuantReg: 12.87114) QuantErr: 12.87114 batch_time=0.48289 
Train Epoch: 7 [273/500 17472/32000 (55%)] Loss: 2.03603 (QuantReg: 12.18441) QuantErr: 12.18441 batch_time=0.54128 
Train Epoch: 7 [281/500 17984/32000 (56%)] Loss: 1.71855 (QuantReg: 13.09393) QuantErr: 13.09393 batch_time=0.40970 
Train Epoch: 7 [289/500 18496/32000 (58%)] Loss: 1.41151 (QuantReg: 12.75095) QuantErr: 12.75095 batch_time=0.42288 
Train Epoch: 7 [297/500 19008/32000 (59%)] Loss: 2.02663 (QuantReg: 12.57560) QuantErr: 12.57560 batch_time=0.43870 
Train Epoch: 7 [305/500 19520/32000 (61%)] Loss: 1.17769 (QuantReg: 12.55620) QuantErr: 12.55620 batch_time=0.42499 
Train Epoch: 7 [313/500 20032/32000 (63%)] Loss: 1.52243 (QuantReg: 12.50719) QuantErr: 12.50719 batch_time=0.45033 
Train Epoch: 7 [321/500 20544/32000 (64%)] Loss: 1.27078 (QuantReg: 12.95559) QuantErr: 12.95559 batch_time=0.59275 
Train Epoch: 7 [329/500 21056/32000 (66%)] Loss: 1.36434 (QuantReg: 12.75642) QuantErr: 12.75642 batch_time=0.40432 
Train Epoch: 7 [337/500 21568/32000 (67%)] Loss: 1.69557 (QuantReg: 12.88067) QuantErr: 12.88067 batch_time=0.48328 
Train Epoch: 7 [345/500 22080/32000 (69%)] Loss: 1.64005 (QuantReg: 13.27255) QuantErr: 13.27255 batch_time=0.49841 
Train Epoch: 7 [353/500 22592/32000 (71%)] Loss: 1.79260 (QuantReg: 12.92255) QuantErr: 12.92255 batch_time=0.45933 
Train Epoch: 7 [361/500 23104/32000 (72%)] Loss: 1.71961 (QuantReg: 13.06326) QuantErr: 13.06326 batch_time=0.49284 
Train Epoch: 7 [369/500 23616/32000 (74%)] Loss: 1.12470 (QuantReg: 13.18389) QuantErr: 13.18389 batch_time=0.46082 
Train Epoch: 7 [377/500 24128/32000 (75%)] Loss: 1.29541 (QuantReg: 12.95416) QuantErr: 12.95416 batch_time=0.42109 
Train Epoch: 7 [385/500 24640/32000 (77%)] Loss: 1.32380 (QuantReg: 12.87965) QuantErr: 12.87965 batch_time=0.51867 
Train Epoch: 7 [393/500 25152/32000 (79%)] Loss: 1.08095 (QuantReg: 13.08936) QuantErr: 13.08936 batch_time=0.41924 
Train Epoch: 7 [401/500 25664/32000 (80%)] Loss: 1.31627 (QuantReg: 12.70989) QuantErr: 12.70989 batch_time=0.39551 
Train Epoch: 7 [409/500 26176/32000 (82%)] Loss: 1.39618 (QuantReg: 12.82360) QuantErr: 12.82360 batch_time=0.49688 
Train Epoch: 7 [417/500 26688/32000 (83%)] Loss: 1.43596 (QuantReg: 13.09965) QuantErr: 13.09965 batch_time=0.47929 
Train Epoch: 7 [425/500 27200/32000 (85%)] Loss: 1.27969 (QuantReg: 12.65185) QuantErr: 12.65185 batch_time=0.47893 
Train Epoch: 7 [433/500 27712/32000 (87%)] Loss: 1.53662 (QuantReg: 12.92426) QuantErr: 12.92426 batch_time=0.43099 
Train Epoch: 7 [441/500 28224/32000 (88%)] Loss: 1.32542 (QuantReg: 12.91008) QuantErr: 12.91008 batch_time=0.39961 
Train Epoch: 7 [449/500 28736/32000 (90%)] Loss: 1.04841 (QuantReg: 12.93786) QuantErr: 12.93786 batch_time=0.47377 
Train Epoch: 7 [457/500 29248/32000 (91%)] Loss: 0.92652 (QuantReg: 12.37111) QuantErr: 12.37111 batch_time=0.50152 
Train Epoch: 7 [465/500 29760/32000 (93%)] Loss: 1.17636 (QuantReg: 13.32080) QuantErr: 13.32080 batch_time=0.46729 
Train Epoch: 7 [473/500 30272/32000 (95%)] Loss: 1.25637 (QuantReg: 12.86776) QuantErr: 12.86776 batch_time=0.45400 
Train Epoch: 7 [481/500 30784/32000 (96%)] Loss: 1.41441 (QuantReg: 13.37978) QuantErr: 13.37978 batch_time=0.42054 
Train Epoch: 7 [489/500 31296/32000 (98%)] Loss: 1.34066 (QuantReg: 12.34151) QuantErr: 12.34151 batch_time=0.52410 
Train Epoch: 7 [497/500 31808/32000 (99%)] Loss: 1.00677 (QuantReg: 12.88277) QuantErr: 12.88277 batch_time=0.49080 
Train Epoch: 7 codebook_update_time=2.19061
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch7.pth ...
Done in 4.448s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch7.pth ...
Done in 9.528s
removing stale ckpt [epoch 6] [took 0.00s]
 epoch          : 7
 loss           : 1.4146579413414002
 quant_reg      : 12.6609709815979
 quant_err      : 12.6609709815979
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 3500
 MSRVTT_miech_test/t2v_metrics/R1: 16.1
 MSRVTT_miech_test/t2v_metrics/R5: 44.8
 MSRVTT_miech_test/t2v_metrics/R10: 59.7
 MSRVTT_miech_test/t2v_metrics/R50: 86.9
 MSRVTT_miech_test/t2v_metrics/MedR: 7.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.881
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 35.05038077788584
 MSRVTT_miech_test/v2t_metrics/R1: 17.2
 MSRVTT_miech_test/v2t_metrics/R5: 46.0
 MSRVTT_miech_test/v2t_metrics/R10: 60.3
 MSRVTT_miech_test/v2t_metrics/R50: 87.1
 MSRVTT_miech_test/v2t_metrics/MedR: 7.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 31.159
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.268912208373244
 mnt_best       : 35.05038077788584
 not_improved_count: 0
Train Epoch: 8 [1/500 64/32000 (0%)] Loss: 1.46265 (QuantReg: 12.50960) QuantErr: 12.50960 batch_time=29.82033 
Train Epoch: 8 [9/500 576/32000 (2%)] Loss: 1.42504 (QuantReg: 12.45017) QuantErr: 12.45017 batch_time=0.40276 
Train Epoch: 8 [17/500 1088/32000 (3%)] Loss: 1.13264 (QuantReg: 12.49066) QuantErr: 12.49066 batch_time=0.47727 
Train Epoch: 8 [25/500 1600/32000 (5%)] Loss: 0.92281 (QuantReg: 12.87460) QuantErr: 12.87460 batch_time=0.43093 
Train Epoch: 8 [33/500 2112/32000 (7%)] Loss: 1.73664 (QuantReg: 12.70941) QuantErr: 12.70941 batch_time=0.48393 
Train Epoch: 8 [41/500 2624/32000 (8%)] Loss: 1.31048 (QuantReg: 12.28110) QuantErr: 12.28110 batch_time=0.57011 
Train Epoch: 8 [49/500 3136/32000 (10%)] Loss: 1.41507 (QuantReg: 13.10825) QuantErr: 13.10825 batch_time=0.46146 
Train Epoch: 8 [57/500 3648/32000 (11%)] Loss: 1.28306 (QuantReg: 12.87189) QuantErr: 12.87189 batch_time=0.47694 
Train Epoch: 8 [65/500 4160/32000 (13%)] Loss: 1.04445 (QuantReg: 12.79856) QuantErr: 12.79856 batch_time=1.16682 
Train Epoch: 8 [73/500 4672/32000 (15%)] Loss: 1.52607 (QuantReg: 12.77103) QuantErr: 12.77103 batch_time=0.49567 
Train Epoch: 8 [81/500 5184/32000 (16%)] Loss: 1.32268 (QuantReg: 12.82366) QuantErr: 12.82366 batch_time=0.40479 
Train Epoch: 8 [89/500 5696/32000 (18%)] Loss: 0.78805 (QuantReg: 13.08159) QuantErr: 13.08159 batch_time=0.45932 
Train Epoch: 8 [97/500 6208/32000 (19%)] Loss: 1.38602 (QuantReg: 12.94444) QuantErr: 12.94444 batch_time=0.42659 
Train Epoch: 8 [105/500 6720/32000 (21%)] Loss: 1.38292 (QuantReg: 12.34405) QuantErr: 12.34405 batch_time=0.56514 
Train Epoch: 8 [113/500 7232/32000 (23%)] Loss: 1.02288 (QuantReg: 12.36835) QuantErr: 12.36835 batch_time=0.44705 
Train Epoch: 8 [121/500 7744/32000 (24%)] Loss: 1.14406 (QuantReg: 12.75089) QuantErr: 12.75089 batch_time=0.46011 
Train Epoch: 8 [129/500 8256/32000 (26%)] Loss: 1.28593 (QuantReg: 13.10087) QuantErr: 13.10087 batch_time=1.57934 
Train Epoch: 8 [137/500 8768/32000 (27%)] Loss: 1.48266 (QuantReg: 12.66252) QuantErr: 12.66252 batch_time=0.45555 
Train Epoch: 8 [145/500 9280/32000 (29%)] Loss: 1.53715 (QuantReg: 12.63384) QuantErr: 12.63384 batch_time=0.41479 
Train Epoch: 8 [153/500 9792/32000 (31%)] Loss: 1.24826 (QuantReg: 12.86876) QuantErr: 12.86876 batch_time=0.41632 
Train Epoch: 8 [161/500 10304/32000 (32%)] Loss: 1.66939 (QuantReg: 12.19662) QuantErr: 12.19662 batch_time=0.44409 
Train Epoch: 8 [169/500 10816/32000 (34%)] Loss: 1.17392 (QuantReg: 12.93545) QuantErr: 12.93545 batch_time=0.61230 
Train Epoch: 8 [177/500 11328/32000 (35%)] Loss: 1.73348 (QuantReg: 12.39663) QuantErr: 12.39663 batch_time=0.45806 
Train Epoch: 8 [185/500 11840/32000 (37%)] Loss: 1.55151 (QuantReg: 12.48335) QuantErr: 12.48335 batch_time=0.47496 
Train Epoch: 8 [193/500 12352/32000 (39%)] Loss: 1.48218 (QuantReg: 12.58381) QuantErr: 12.58381 batch_time=1.23871 
Train Epoch: 8 [201/500 12864/32000 (40%)] Loss: 1.46909 (QuantReg: 12.24983) QuantErr: 12.24983 batch_time=0.45363 
Train Epoch: 8 [209/500 13376/32000 (42%)] Loss: 1.46537 (QuantReg: 12.61434) QuantErr: 12.61434 batch_time=0.45791 
Train Epoch: 8 [217/500 13888/32000 (43%)] Loss: 1.45370 (QuantReg: 12.95172) QuantErr: 12.95172 batch_time=0.45096 
Train Epoch: 8 [225/500 14400/32000 (45%)] Loss: 1.15622 (QuantReg: 12.44202) QuantErr: 12.44202 batch_time=0.47436 
Train Epoch: 8 [233/500 14912/32000 (47%)] Loss: 1.10169 (QuantReg: 12.80095) QuantErr: 12.80095 batch_time=0.58655 
Train Epoch: 8 [241/500 15424/32000 (48%)] Loss: 1.35681 (QuantReg: 12.74862) QuantErr: 12.74862 batch_time=0.43692 
Train Epoch: 8 [249/500 15936/32000 (50%)] Loss: 0.96481 (QuantReg: 12.58073) QuantErr: 12.58073 batch_time=0.52861 
Train Epoch: 8 [257/500 16448/32000 (51%)] Loss: 0.90969 (QuantReg: 12.68723) QuantErr: 12.68723 batch_time=1.35414 
Train Epoch: 8 [265/500 16960/32000 (53%)] Loss: 1.09381 (QuantReg: 12.87638) QuantErr: 12.87638 batch_time=0.41703 
Train Epoch: 8 [273/500 17472/32000 (55%)] Loss: 1.35458 (QuantReg: 12.35079) QuantErr: 12.35079 batch_time=0.46253 
Train Epoch: 8 [281/500 17984/32000 (56%)] Loss: 1.16714 (QuantReg: 13.01597) QuantErr: 13.01597 batch_time=0.47566 
Train Epoch: 8 [289/500 18496/32000 (58%)] Loss: 1.38788 (QuantReg: 12.64725) QuantErr: 12.64725 batch_time=0.40647 
Train Epoch: 8 [297/500 19008/32000 (59%)] Loss: 1.67470 (QuantReg: 12.35454) QuantErr: 12.35454 batch_time=0.57407 
Train Epoch: 8 [305/500 19520/32000 (61%)] Loss: 0.97308 (QuantReg: 13.10870) QuantErr: 13.10870 batch_time=0.47481 
Train Epoch: 8 [313/500 20032/32000 (63%)] Loss: 1.22634 (QuantReg: 12.65942) QuantErr: 12.65942 batch_time=0.44489 
Train Epoch: 8 [321/500 20544/32000 (64%)] Loss: 1.14302 (QuantReg: 12.84880) QuantErr: 12.84880 batch_time=1.26971 
Train Epoch: 8 [329/500 21056/32000 (66%)] Loss: 1.03649 (QuantReg: 12.81328) QuantErr: 12.81328 batch_time=0.51073 
Train Epoch: 8 [337/500 21568/32000 (67%)] Loss: 1.03090 (QuantReg: 12.85404) QuantErr: 12.85404 batch_time=0.44624 
Train Epoch: 8 [345/500 22080/32000 (69%)] Loss: 1.12595 (QuantReg: 12.89426) QuantErr: 12.89426 batch_time=0.51494 
Train Epoch: 8 [353/500 22592/32000 (71%)] Loss: 0.92864 (QuantReg: 13.05548) QuantErr: 13.05548 batch_time=0.40778 
Train Epoch: 8 [361/500 23104/32000 (72%)] Loss: 0.97847 (QuantReg: 12.76788) QuantErr: 12.76788 batch_time=0.56356 
Train Epoch: 8 [369/500 23616/32000 (74%)] Loss: 1.17733 (QuantReg: 12.64118) QuantErr: 12.64118 batch_time=0.51670 
Train Epoch: 8 [377/500 24128/32000 (75%)] Loss: 1.25237 (QuantReg: 13.17153) QuantErr: 13.17153 batch_time=0.39948 
Train Epoch: 8 [385/500 24640/32000 (77%)] Loss: 1.00481 (QuantReg: 12.83464) QuantErr: 12.83464 batch_time=1.14324 
Train Epoch: 8 [393/500 25152/32000 (79%)] Loss: 1.27557 (QuantReg: 13.20222) QuantErr: 13.20222 batch_time=0.45522 
Train Epoch: 8 [401/500 25664/32000 (80%)] Loss: 1.31552 (QuantReg: 13.02286) QuantErr: 13.02286 batch_time=0.53962 
Train Epoch: 8 [409/500 26176/32000 (82%)] Loss: 1.18111 (QuantReg: 13.25836) QuantErr: 13.25836 batch_time=0.44204 
Train Epoch: 8 [417/500 26688/32000 (83%)] Loss: 1.72153 (QuantReg: 12.82008) QuantErr: 12.82008 batch_time=0.50065 
Train Epoch: 8 [425/500 27200/32000 (85%)] Loss: 1.32765 (QuantReg: 13.09061) QuantErr: 13.09061 batch_time=0.62485 
Train Epoch: 8 [433/500 27712/32000 (87%)] Loss: 1.64968 (QuantReg: 12.61699) QuantErr: 12.61699 batch_time=0.52873 
Train Epoch: 8 [441/500 28224/32000 (88%)] Loss: 1.07906 (QuantReg: 12.49747) QuantErr: 12.49747 batch_time=0.39073 
Train Epoch: 8 [449/500 28736/32000 (90%)] Loss: 1.22741 (QuantReg: 12.85380) QuantErr: 12.85380 batch_time=1.15526 
Train Epoch: 8 [457/500 29248/32000 (91%)] Loss: 1.11324 (QuantReg: 13.28852) QuantErr: 13.28852 batch_time=0.43687 
Train Epoch: 8 [465/500 29760/32000 (93%)] Loss: 1.25603 (QuantReg: 12.72138) QuantErr: 12.72138 batch_time=0.43707 
Train Epoch: 8 [473/500 30272/32000 (95%)] Loss: 1.32612 (QuantReg: 12.80540) QuantErr: 12.80540 batch_time=0.42675 
Train Epoch: 8 [481/500 30784/32000 (96%)] Loss: 1.07021 (QuantReg: 12.72726) QuantErr: 12.72726 batch_time=0.47683 
Train Epoch: 8 [489/500 31296/32000 (98%)] Loss: 0.76001 (QuantReg: 12.78538) QuantErr: 12.78538 batch_time=0.55677 
Train Epoch: 8 [497/500 31808/32000 (99%)] Loss: 0.98679 (QuantReg: 13.00345) QuantErr: 13.00345 batch_time=0.47854 
Train Epoch: 8 codebook_update_time=2.99445
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch8.pth ...
Done in 5.349s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch8.pth ...
Done in 10.562s
removing stale ckpt [epoch 7] [took 0.01s]
 epoch          : 8
 loss           : 1.3069131968021392
 quant_reg      : 12.75444584274292
 quant_err      : 12.75444584274292
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 4000
 MSRVTT_miech_test/t2v_metrics/R1: 16.8
 MSRVTT_miech_test/t2v_metrics/R5: 44.8
 MSRVTT_miech_test/t2v_metrics/R10: 60.9
 MSRVTT_miech_test/t2v_metrics/R50: 87.6
 MSRVTT_miech_test/t2v_metrics/MedR: 7.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.358
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 35.78778855903613
 MSRVTT_miech_test/v2t_metrics/R1: 17.0
 MSRVTT_miech_test/v2t_metrics/R5: 45.4
 MSRVTT_miech_test/v2t_metrics/R10: 60.5
 MSRVTT_miech_test/v2t_metrics/R50: 86.8
 MSRVTT_miech_test/v2t_metrics/MedR: 7.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.729
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.0097453040668
 mnt_best       : 35.78778855903613
 not_improved_count: 0
Train Epoch: 9 [1/500 64/32000 (0%)] Loss: 1.73989 (QuantReg: 12.00029) QuantErr: 12.00029 batch_time=28.61478 
Train Epoch: 9 [9/500 576/32000 (2%)] Loss: 1.10469 (QuantReg: 12.62416) QuantErr: 12.62416 batch_time=0.42006 
Train Epoch: 9 [17/500 1088/32000 (3%)] Loss: 0.67825 (QuantReg: 12.93050) QuantErr: 12.93050 batch_time=0.60426 
Train Epoch: 9 [25/500 1600/32000 (5%)] Loss: 1.12579 (QuantReg: 12.73076) QuantErr: 12.73076 batch_time=0.48670 
Train Epoch: 9 [33/500 2112/32000 (7%)] Loss: 1.62132 (QuantReg: 12.51073) QuantErr: 12.51073 batch_time=0.44526 
Train Epoch: 9 [41/500 2624/32000 (8%)] Loss: 1.13172 (QuantReg: 12.99414) QuantErr: 12.99414 batch_time=0.54601 
Train Epoch: 9 [49/500 3136/32000 (10%)] Loss: 1.54660 (QuantReg: 12.65222) QuantErr: 12.65222 batch_time=0.53942 
Train Epoch: 9 [57/500 3648/32000 (11%)] Loss: 1.02708 (QuantReg: 12.44658) QuantErr: 12.44658 batch_time=0.49246 
Train Epoch: 9 [65/500 4160/32000 (13%)] Loss: 1.05674 (QuantReg: 12.19165) QuantErr: 12.19165 batch_time=0.79063 
Train Epoch: 9 [73/500 4672/32000 (15%)] Loss: 1.09752 (QuantReg: 12.71539) QuantErr: 12.71539 batch_time=0.48916 
Train Epoch: 9 [81/500 5184/32000 (16%)] Loss: 1.10397 (QuantReg: 12.71904) QuantErr: 12.71904 batch_time=0.53280 
Train Epoch: 9 [89/500 5696/32000 (18%)] Loss: 1.35187 (QuantReg: 12.61161) QuantErr: 12.61161 batch_time=0.49316 
Train Epoch: 9 [97/500 6208/32000 (19%)] Loss: 1.24342 (QuantReg: 12.42277) QuantErr: 12.42277 batch_time=0.50165 
Train Epoch: 9 [105/500 6720/32000 (21%)] Loss: 1.06921 (QuantReg: 13.21412) QuantErr: 13.21412 batch_time=0.52919 
Train Epoch: 9 [113/500 7232/32000 (23%)] Loss: 1.49903 (QuantReg: 12.51637) QuantErr: 12.51637 batch_time=0.45237 
Train Epoch: 9 [121/500 7744/32000 (24%)] Loss: 1.06987 (QuantReg: 12.42058) QuantErr: 12.42058 batch_time=0.45112 
Train Epoch: 9 [129/500 8256/32000 (26%)] Loss: 1.12568 (QuantReg: 12.39576) QuantErr: 12.39576 batch_time=0.73970 
Train Epoch: 9 [137/500 8768/32000 (27%)] Loss: 1.09008 (QuantReg: 12.35178) QuantErr: 12.35178 batch_time=0.48934 
Train Epoch: 9 [145/500 9280/32000 (29%)] Loss: 1.29231 (QuantReg: 12.77280) QuantErr: 12.77280 batch_time=0.53065 
Train Epoch: 9 [153/500 9792/32000 (31%)] Loss: 0.79700 (QuantReg: 12.88759) QuantErr: 12.88759 batch_time=0.52790 
Train Epoch: 9 [161/500 10304/32000 (32%)] Loss: 1.31297 (QuantReg: 13.27272) QuantErr: 13.27272 batch_time=0.47464 
Train Epoch: 9 [169/500 10816/32000 (34%)] Loss: 1.10108 (QuantReg: 12.38882) QuantErr: 12.38882 batch_time=0.50997 
Train Epoch: 9 [177/500 11328/32000 (35%)] Loss: 1.12527 (QuantReg: 12.52718) QuantErr: 12.52718 batch_time=0.56803 
Train Epoch: 9 [185/500 11840/32000 (37%)] Loss: 0.91916 (QuantReg: 13.06045) QuantErr: 13.06045 batch_time=0.46490 
Train Epoch: 9 [193/500 12352/32000 (39%)] Loss: 0.84320 (QuantReg: 13.09797) QuantErr: 13.09797 batch_time=0.78684 
Train Epoch: 9 [201/500 12864/32000 (40%)] Loss: 1.16535 (QuantReg: 13.13492) QuantErr: 13.13492 batch_time=0.49857 
Train Epoch: 9 [209/500 13376/32000 (42%)] Loss: 1.73442 (QuantReg: 12.39948) QuantErr: 12.39948 batch_time=0.42474 
Train Epoch: 9 [217/500 13888/32000 (43%)] Loss: 1.08697 (QuantReg: 12.88025) QuantErr: 12.88025 batch_time=0.47821 
Train Epoch: 9 [225/500 14400/32000 (45%)] Loss: 1.00041 (QuantReg: 12.77651) QuantErr: 12.77651 batch_time=0.47124 
Train Epoch: 9 [233/500 14912/32000 (47%)] Loss: 1.08141 (QuantReg: 12.73603) QuantErr: 12.73603 batch_time=0.44112 
Train Epoch: 9 [241/500 15424/32000 (48%)] Loss: 1.30000 (QuantReg: 12.85983) QuantErr: 12.85983 batch_time=0.42288 
Train Epoch: 9 [249/500 15936/32000 (50%)] Loss: 1.46060 (QuantReg: 12.58682) QuantErr: 12.58682 batch_time=0.46921 
Train Epoch: 9 [257/500 16448/32000 (51%)] Loss: 1.29269 (QuantReg: 12.99455) QuantErr: 12.99455 batch_time=0.74779 
Train Epoch: 9 [265/500 16960/32000 (53%)] Loss: 1.35084 (QuantReg: 12.92393) QuantErr: 12.92393 batch_time=0.44663 
Train Epoch: 9 [273/500 17472/32000 (55%)] Loss: 1.05659 (QuantReg: 13.64208) QuantErr: 13.64208 batch_time=0.47832 
Train Epoch: 9 [281/500 17984/32000 (56%)] Loss: 1.26570 (QuantReg: 12.97506) QuantErr: 12.97506 batch_time=0.46765 
Train Epoch: 9 [289/500 18496/32000 (58%)] Loss: 1.00566 (QuantReg: 12.52721) QuantErr: 12.52721 batch_time=0.50190 
Train Epoch: 9 [297/500 19008/32000 (59%)] Loss: 1.63458 (QuantReg: 12.62184) QuantErr: 12.62184 batch_time=0.46341 
Train Epoch: 9 [305/500 19520/32000 (61%)] Loss: 1.20612 (QuantReg: 12.74989) QuantErr: 12.74989 batch_time=0.48713 
Train Epoch: 9 [313/500 20032/32000 (63%)] Loss: 1.26984 (QuantReg: 12.97959) QuantErr: 12.97959 batch_time=0.46958 
Train Epoch: 9 [321/500 20544/32000 (64%)] Loss: 1.71112 (QuantReg: 13.08664) QuantErr: 13.08664 batch_time=0.80422 
Train Epoch: 9 [329/500 21056/32000 (66%)] Loss: 1.23190 (QuantReg: 12.57864) QuantErr: 12.57864 batch_time=0.47850 
Train Epoch: 9 [337/500 21568/32000 (67%)] Loss: 1.86541 (QuantReg: 12.61082) QuantErr: 12.61082 batch_time=0.48256 
Train Epoch: 9 [345/500 22080/32000 (69%)] Loss: 1.07864 (QuantReg: 13.27171) QuantErr: 13.27171 batch_time=0.43799 
Train Epoch: 9 [353/500 22592/32000 (71%)] Loss: 1.00452 (QuantReg: 12.97715) QuantErr: 12.97715 batch_time=0.41169 
Train Epoch: 9 [361/500 23104/32000 (72%)] Loss: 0.83664 (QuantReg: 12.93672) QuantErr: 12.93672 batch_time=0.55113 
Train Epoch: 9 [369/500 23616/32000 (74%)] Loss: 1.63726 (QuantReg: 12.67108) QuantErr: 12.67108 batch_time=0.47311 
Train Epoch: 9 [377/500 24128/32000 (75%)] Loss: 1.54560 (QuantReg: 13.13623) QuantErr: 13.13623 batch_time=0.44195 
Train Epoch: 9 [385/500 24640/32000 (77%)] Loss: 1.24819 (QuantReg: 13.02949) QuantErr: 13.02949 batch_time=0.85228 
Train Epoch: 9 [393/500 25152/32000 (79%)] Loss: 1.27654 (QuantReg: 12.89377) QuantErr: 12.89377 batch_time=0.49282 
Train Epoch: 9 [401/500 25664/32000 (80%)] Loss: 1.30709 (QuantReg: 13.52410) QuantErr: 13.52410 batch_time=0.47019 
Train Epoch: 9 [409/500 26176/32000 (82%)] Loss: 1.19235 (QuantReg: 12.81387) QuantErr: 12.81387 batch_time=0.56629 
Train Epoch: 9 [417/500 26688/32000 (83%)] Loss: 1.21030 (QuantReg: 12.64149) QuantErr: 12.64149 batch_time=0.46756 
Train Epoch: 9 [425/500 27200/32000 (85%)] Loss: 1.46531 (QuantReg: 12.99912) QuantErr: 12.99912 batch_time=0.47737 
Train Epoch: 9 [433/500 27712/32000 (87%)] Loss: 1.59437 (QuantReg: 13.50458) QuantErr: 13.50458 batch_time=0.49735 
Train Epoch: 9 [441/500 28224/32000 (88%)] Loss: 1.15819 (QuantReg: 12.90855) QuantErr: 12.90855 batch_time=0.46161 
Train Epoch: 9 [449/500 28736/32000 (90%)] Loss: 1.39257 (QuantReg: 13.28507) QuantErr: 13.28507 batch_time=0.87359 
Train Epoch: 9 [457/500 29248/32000 (91%)] Loss: 1.32424 (QuantReg: 12.91557) QuantErr: 12.91557 batch_time=0.41697 
Train Epoch: 9 [465/500 29760/32000 (93%)] Loss: 1.26922 (QuantReg: 12.96212) QuantErr: 12.96212 batch_time=0.44336 
Train Epoch: 9 [473/500 30272/32000 (95%)] Loss: 1.99016 (QuantReg: 12.55994) QuantErr: 12.55994 batch_time=0.48766 
Train Epoch: 9 [481/500 30784/32000 (96%)] Loss: 0.93038 (QuantReg: 13.17656) QuantErr: 13.17656 batch_time=0.46382 
Train Epoch: 9 [489/500 31296/32000 (98%)] Loss: 0.82096 (QuantReg: 13.23530) QuantErr: 13.23530 batch_time=0.44893 
Train Epoch: 9 [497/500 31808/32000 (99%)] Loss: 1.13659 (QuantReg: 12.92505) QuantErr: 12.92505 batch_time=0.47295 
Train Epoch: 9 codebook_update_time=2.59755
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch9.pth ...
Done in 6.709s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch9.pth ...
Done in 12.442s
removing stale ckpt [epoch 8] [took 0.01s]
 epoch          : 9
 loss           : 1.2265772086381912
 quant_reg      : 12.8299009475708
 quant_err      : 12.8299009475708
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 4500
 MSRVTT_miech_test/t2v_metrics/R1: 16.5
 MSRVTT_miech_test/t2v_metrics/R5: 45.9
 MSRVTT_miech_test/t2v_metrics/R10: 60.6
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 7.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.472
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 35.8033022348432
 MSRVTT_miech_test/v2t_metrics/R1: 18.9
 MSRVTT_miech_test/v2t_metrics/R5: 47.8
 MSRVTT_miech_test/v2t_metrics/R10: 61.7
 MSRVTT_miech_test/v2t_metrics/R50: 88.2
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.41
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.19955364371588
 mnt_best       : 35.8033022348432
 not_improved_count: 0
Train Epoch: 10 [1/500 64/32000 (0%)] Loss: 1.60630 (QuantReg: 12.41196) QuantErr: 12.41196 batch_time=28.18276 
Train Epoch: 10 [9/500 576/32000 (2%)] Loss: 1.13399 (QuantReg: 12.67072) QuantErr: 12.67072 batch_time=2.44042 
Train Epoch: 10 [17/500 1088/32000 (3%)] Loss: 0.88370 (QuantReg: 13.02428) QuantErr: 13.02428 batch_time=0.43629 
Train Epoch: 10 [25/500 1600/32000 (5%)] Loss: 0.76213 (QuantReg: 12.85063) QuantErr: 12.85063 batch_time=0.43911 
Train Epoch: 10 [33/500 2112/32000 (7%)] Loss: 1.47959 (QuantReg: 12.79949) QuantErr: 12.79949 batch_time=0.47826 
Train Epoch: 10 [41/500 2624/32000 (8%)] Loss: 0.79894 (QuantReg: 12.98528) QuantErr: 12.98528 batch_time=0.48188 
Train Epoch: 10 [49/500 3136/32000 (10%)] Loss: 1.19100 (QuantReg: 12.72130) QuantErr: 12.72130 batch_time=0.42822 
Train Epoch: 10 [57/500 3648/32000 (11%)] Loss: 1.08630 (QuantReg: 12.24261) QuantErr: 12.24261 batch_time=0.40117 
Train Epoch: 10 [65/500 4160/32000 (13%)] Loss: 1.16720 (QuantReg: 12.74789) QuantErr: 12.74789 batch_time=0.45166 
Train Epoch: 10 [73/500 4672/32000 (15%)] Loss: 0.89070 (QuantReg: 13.05535) QuantErr: 13.05535 batch_time=1.99346 
Train Epoch: 10 [81/500 5184/32000 (16%)] Loss: 1.50137 (QuantReg: 12.77930) QuantErr: 12.77930 batch_time=0.44093 
Train Epoch: 10 [89/500 5696/32000 (18%)] Loss: 0.88854 (QuantReg: 12.82435) QuantErr: 12.82435 batch_time=0.39034 
Train Epoch: 10 [97/500 6208/32000 (19%)] Loss: 0.85108 (QuantReg: 12.73342) QuantErr: 12.73342 batch_time=0.52830 
Train Epoch: 10 [105/500 6720/32000 (21%)] Loss: 1.02140 (QuantReg: 12.43796) QuantErr: 12.43796 batch_time=0.47960 
Train Epoch: 10 [113/500 7232/32000 (23%)] Loss: 1.22220 (QuantReg: 12.57121) QuantErr: 12.57121 batch_time=0.45079 
Train Epoch: 10 [121/500 7744/32000 (24%)] Loss: 1.12316 (QuantReg: 12.88692) QuantErr: 12.88692 batch_time=0.45017 
Train Epoch: 10 [129/500 8256/32000 (26%)] Loss: 1.97229 (QuantReg: 12.32979) QuantErr: 12.32979 batch_time=0.44959 
Train Epoch: 10 [137/500 8768/32000 (27%)] Loss: 0.96638 (QuantReg: 13.42104) QuantErr: 13.42104 batch_time=1.97287 
Train Epoch: 10 [145/500 9280/32000 (29%)] Loss: 1.37695 (QuantReg: 12.38757) QuantErr: 12.38757 batch_time=0.42063 
Train Epoch: 10 [153/500 9792/32000 (31%)] Loss: 1.00211 (QuantReg: 13.00617) QuantErr: 13.00617 batch_time=0.47993 
Train Epoch: 10 [161/500 10304/32000 (32%)] Loss: 0.79739 (QuantReg: 13.06471) QuantErr: 13.06471 batch_time=0.41271 
Train Epoch: 10 [169/500 10816/32000 (34%)] Loss: 0.96452 (QuantReg: 12.72461) QuantErr: 12.72461 batch_time=0.44240 
Train Epoch: 10 [177/500 11328/32000 (35%)] Loss: 1.14208 (QuantReg: 12.59007) QuantErr: 12.59007 batch_time=0.46979 
Train Epoch: 10 [185/500 11840/32000 (37%)] Loss: 1.02417 (QuantReg: 12.23666) QuantErr: 12.23666 batch_time=0.45022 
Train Epoch: 10 [193/500 12352/32000 (39%)] Loss: 0.86885 (QuantReg: 13.22657) QuantErr: 13.22657 batch_time=0.47656 
Train Epoch: 10 [201/500 12864/32000 (40%)] Loss: 1.24488 (QuantReg: 12.40308) QuantErr: 12.40308 batch_time=1.91235 
Train Epoch: 10 [209/500 13376/32000 (42%)] Loss: 1.19388 (QuantReg: 13.22376) QuantErr: 13.22376 batch_time=0.60138 
Train Epoch: 10 [217/500 13888/32000 (43%)] Loss: 1.49593 (QuantReg: 13.02934) QuantErr: 13.02934 batch_time=0.43985 
Train Epoch: 10 [225/500 14400/32000 (45%)] Loss: 1.15115 (QuantReg: 12.52764) QuantErr: 12.52764 batch_time=0.46901 
Train Epoch: 10 [233/500 14912/32000 (47%)] Loss: 1.17078 (QuantReg: 12.78234) QuantErr: 12.78234 batch_time=0.42358 
Train Epoch: 10 [241/500 15424/32000 (48%)] Loss: 1.12853 (QuantReg: 12.96617) QuantErr: 12.96617 batch_time=0.45155 
Train Epoch: 10 [249/500 15936/32000 (50%)] Loss: 0.64248 (QuantReg: 13.21779) QuantErr: 13.21779 batch_time=0.45248 
Train Epoch: 10 [257/500 16448/32000 (51%)] Loss: 1.18192 (QuantReg: 13.02199) QuantErr: 13.02199 batch_time=0.45520 
Train Epoch: 10 [265/500 16960/32000 (53%)] Loss: 1.27388 (QuantReg: 13.19846) QuantErr: 13.19846 batch_time=1.91122 
Train Epoch: 10 [273/500 17472/32000 (55%)] Loss: 0.81130 (QuantReg: 12.98177) QuantErr: 12.98177 batch_time=0.51897 
Train Epoch: 10 [281/500 17984/32000 (56%)] Loss: 1.39044 (QuantReg: 12.95994) QuantErr: 12.95994 batch_time=0.51733 
Train Epoch: 10 [289/500 18496/32000 (58%)] Loss: 1.86589 (QuantReg: 12.91997) QuantErr: 12.91997 batch_time=0.50740 
Train Epoch: 10 [297/500 19008/32000 (59%)] Loss: 1.29507 (QuantReg: 12.81686) QuantErr: 12.81686 batch_time=0.46352 
Train Epoch: 10 [305/500 19520/32000 (61%)] Loss: 1.48617 (QuantReg: 12.89285) QuantErr: 12.89285 batch_time=0.42399 
Train Epoch: 10 [313/500 20032/32000 (63%)] Loss: 1.46487 (QuantReg: 12.98212) QuantErr: 12.98212 batch_time=0.43289 
Train Epoch: 10 [321/500 20544/32000 (64%)] Loss: 1.29570 (QuantReg: 12.92833) QuantErr: 12.92833 batch_time=0.42364 
Train Epoch: 10 [329/500 21056/32000 (66%)] Loss: 0.89882 (QuantReg: 12.80382) QuantErr: 12.80382 batch_time=1.77419 
Train Epoch: 10 [337/500 21568/32000 (67%)] Loss: 1.05701 (QuantReg: 12.64648) QuantErr: 12.64648 batch_time=0.39952 
Train Epoch: 10 [345/500 22080/32000 (69%)] Loss: 1.06273 (QuantReg: 12.69319) QuantErr: 12.69319 batch_time=0.43247 
Train Epoch: 10 [353/500 22592/32000 (71%)] Loss: 1.25381 (QuantReg: 12.47947) QuantErr: 12.47947 batch_time=0.46269 
Train Epoch: 10 [361/500 23104/32000 (72%)] Loss: 0.90111 (QuantReg: 13.38481) QuantErr: 13.38481 batch_time=0.40718 
Train Epoch: 10 [369/500 23616/32000 (74%)] Loss: 0.87566 (QuantReg: 12.85132) QuantErr: 12.85132 batch_time=0.43459 
Train Epoch: 10 [377/500 24128/32000 (75%)] Loss: 1.30428 (QuantReg: 13.06152) QuantErr: 13.06152 batch_time=0.45306 
Train Epoch: 10 [385/500 24640/32000 (77%)] Loss: 1.40174 (QuantReg: 12.97473) QuantErr: 12.97473 batch_time=0.42016 
Train Epoch: 10 [393/500 25152/32000 (79%)] Loss: 1.32369 (QuantReg: 12.48600) QuantErr: 12.48600 batch_time=1.96187 
Train Epoch: 10 [401/500 25664/32000 (80%)] Loss: 1.03992 (QuantReg: 13.11001) QuantErr: 13.11001 batch_time=0.54278 
Train Epoch: 10 [409/500 26176/32000 (82%)] Loss: 0.99865 (QuantReg: 13.13980) QuantErr: 13.13980 batch_time=0.47400 
Train Epoch: 10 [417/500 26688/32000 (83%)] Loss: 1.05910 (QuantReg: 13.12758) QuantErr: 13.12758 batch_time=0.48309 
Train Epoch: 10 [425/500 27200/32000 (85%)] Loss: 0.93752 (QuantReg: 13.12325) QuantErr: 13.12325 batch_time=0.51325 
Train Epoch: 10 [433/500 27712/32000 (87%)] Loss: 0.85934 (QuantReg: 12.99709) QuantErr: 12.99709 batch_time=0.45832 
Train Epoch: 10 [441/500 28224/32000 (88%)] Loss: 1.18547 (QuantReg: 13.39048) QuantErr: 13.39048 batch_time=0.53189 
Train Epoch: 10 [449/500 28736/32000 (90%)] Loss: 1.07809 (QuantReg: 12.77365) QuantErr: 12.77365 batch_time=0.53805 
Train Epoch: 10 [457/500 29248/32000 (91%)] Loss: 0.77969 (QuantReg: 13.07327) QuantErr: 13.07327 batch_time=1.90789 
Train Epoch: 10 [465/500 29760/32000 (93%)] Loss: 1.28313 (QuantReg: 12.44077) QuantErr: 12.44077 batch_time=0.45804 
Train Epoch: 10 [473/500 30272/32000 (95%)] Loss: 0.62572 (QuantReg: 13.51319) QuantErr: 13.51319 batch_time=0.48537 
Train Epoch: 10 [481/500 30784/32000 (96%)] Loss: 1.11259 (QuantReg: 12.81067) QuantErr: 12.81067 batch_time=0.47454 
Train Epoch: 10 [489/500 31296/32000 (98%)] Loss: 0.78369 (QuantReg: 13.41077) QuantErr: 13.41077 batch_time=0.46758 
Train Epoch: 10 [497/500 31808/32000 (99%)] Loss: 1.01867 (QuantReg: 12.59945) QuantErr: 12.59945 batch_time=0.41519 
Train Epoch: 10 codebook_update_time=2.24088
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch10.pth ...
Done in 6.061s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch10.pth ...
Done in 13.861s
removing stale ckpt [epoch 9] [took 0.05s]
 epoch          : 10
 loss           : 1.1500453941822053
 quant_reg      : 12.85799836730957
 quant_err      : 12.85799836730957
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 5000
 MSRVTT_miech_test/t2v_metrics/R1: 18.0
 MSRVTT_miech_test/t2v_metrics/R5: 45.7
 MSRVTT_miech_test/t2v_metrics/R10: 59.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.3
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.161
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 36.57928595878166
 MSRVTT_miech_test/v2t_metrics/R1: 18.0
 MSRVTT_miech_test/v2t_metrics/R5: 47.9
 MSRVTT_miech_test/v2t_metrics/R10: 61.7
 MSRVTT_miech_test/v2t_metrics/R50: 87.4
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.771
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.6095145304656
 mnt_best       : 36.57928595878166
 not_improved_count: 0
Train Epoch: 11 [1/500 64/32000 (0%)] Loss: 1.28619 (QuantReg: 13.09749) QuantErr: 13.09749 batch_time=28.51529 
Train Epoch: 11 [9/500 576/32000 (2%)] Loss: 1.07991 (QuantReg: 12.31726) QuantErr: 12.31726 batch_time=0.45342 
Train Epoch: 11 [17/500 1088/32000 (3%)] Loss: 1.42388 (QuantReg: 12.29814) QuantErr: 12.29814 batch_time=0.47245 
Train Epoch: 11 [25/500 1600/32000 (5%)] Loss: 1.07878 (QuantReg: 13.19767) QuantErr: 13.19767 batch_time=1.07484 
Train Epoch: 11 [33/500 2112/32000 (7%)] Loss: 1.59925 (QuantReg: 12.64885) QuantErr: 12.64885 batch_time=0.46330 
Train Epoch: 11 [41/500 2624/32000 (8%)] Loss: 1.05409 (QuantReg: 12.36735) QuantErr: 12.36735 batch_time=0.46893 
Train Epoch: 11 [49/500 3136/32000 (10%)] Loss: 1.34143 (QuantReg: 12.75987) QuantErr: 12.75987 batch_time=0.42930 
Train Epoch: 11 [57/500 3648/32000 (11%)] Loss: 1.55401 (QuantReg: 12.53874) QuantErr: 12.53874 batch_time=0.45360 
Train Epoch: 11 [65/500 4160/32000 (13%)] Loss: 1.65510 (QuantReg: 12.89469) QuantErr: 12.89469 batch_time=0.46322 
Train Epoch: 11 [73/500 4672/32000 (15%)] Loss: 1.15992 (QuantReg: 12.73244) QuantErr: 12.73244 batch_time=0.44743 
Train Epoch: 11 [81/500 5184/32000 (16%)] Loss: 1.19693 (QuantReg: 12.35847) QuantErr: 12.35847 batch_time=0.56409 
Train Epoch: 11 [89/500 5696/32000 (18%)] Loss: 0.85517 (QuantReg: 12.87137) QuantErr: 12.87137 batch_time=1.04123 
Train Epoch: 11 [97/500 6208/32000 (19%)] Loss: 1.16097 (QuantReg: 12.43211) QuantErr: 12.43211 batch_time=0.44812 
Train Epoch: 11 [105/500 6720/32000 (21%)] Loss: 1.25122 (QuantReg: 12.47066) QuantErr: 12.47066 batch_time=0.45274 
Train Epoch: 11 [113/500 7232/32000 (23%)] Loss: 1.12341 (QuantReg: 12.23228) QuantErr: 12.23228 batch_time=0.41768 
Train Epoch: 11 [121/500 7744/32000 (24%)] Loss: 0.75510 (QuantReg: 12.54999) QuantErr: 12.54999 batch_time=0.44395 
Train Epoch: 11 [129/500 8256/32000 (26%)] Loss: 0.98455 (QuantReg: 12.96374) QuantErr: 12.96374 batch_time=0.46652 
Train Epoch: 11 [137/500 8768/32000 (27%)] Loss: 1.20713 (QuantReg: 12.88494) QuantErr: 12.88494 batch_time=0.54908 
Train Epoch: 11 [145/500 9280/32000 (29%)] Loss: 1.50936 (QuantReg: 12.91210) QuantErr: 12.91210 batch_time=0.51132 
Train Epoch: 11 [153/500 9792/32000 (31%)] Loss: 1.17898 (QuantReg: 12.87853) QuantErr: 12.87853 batch_time=0.89281 
Train Epoch: 11 [161/500 10304/32000 (32%)] Loss: 1.27087 (QuantReg: 12.87614) QuantErr: 12.87614 batch_time=0.44433 
Train Epoch: 11 [169/500 10816/32000 (34%)] Loss: 1.69138 (QuantReg: 12.64311) QuantErr: 12.64311 batch_time=0.41738 
Train Epoch: 11 [177/500 11328/32000 (35%)] Loss: 1.31639 (QuantReg: 13.00309) QuantErr: 13.00309 batch_time=0.43673 
Train Epoch: 11 [185/500 11840/32000 (37%)] Loss: 1.25071 (QuantReg: 13.32796) QuantErr: 13.32796 batch_time=0.44411 
Train Epoch: 11 [193/500 12352/32000 (39%)] Loss: 1.30558 (QuantReg: 12.25272) QuantErr: 12.25272 batch_time=0.43649 
Train Epoch: 11 [201/500 12864/32000 (40%)] Loss: 0.75123 (QuantReg: 12.95832) QuantErr: 12.95832 batch_time=0.46602 
Train Epoch: 11 [209/500 13376/32000 (42%)] Loss: 1.30700 (QuantReg: 12.74451) QuantErr: 12.74451 batch_time=0.51310 
Train Epoch: 11 [217/500 13888/32000 (43%)] Loss: 0.82211 (QuantReg: 12.57428) QuantErr: 12.57428 batch_time=0.93148 
Train Epoch: 11 [225/500 14400/32000 (45%)] Loss: 0.86084 (QuantReg: 13.16245) QuantErr: 13.16245 batch_time=0.42304 
Train Epoch: 11 [233/500 14912/32000 (47%)] Loss: 1.00617 (QuantReg: 12.72408) QuantErr: 12.72408 batch_time=0.42199 
Train Epoch: 11 [241/500 15424/32000 (48%)] Loss: 1.27930 (QuantReg: 12.78797) QuantErr: 12.78797 batch_time=0.43166 
Train Epoch: 11 [249/500 15936/32000 (50%)] Loss: 0.97629 (QuantReg: 12.66047) QuantErr: 12.66047 batch_time=0.41405 
Train Epoch: 11 [257/500 16448/32000 (51%)] Loss: 1.13012 (QuantReg: 12.93499) QuantErr: 12.93499 batch_time=0.42134 
Train Epoch: 11 [265/500 16960/32000 (53%)] Loss: 1.09737 (QuantReg: 13.07603) QuantErr: 13.07603 batch_time=0.43896 
Train Epoch: 11 [273/500 17472/32000 (55%)] Loss: 1.04557 (QuantReg: 13.41565) QuantErr: 13.41565 batch_time=0.43499 
Train Epoch: 11 [281/500 17984/32000 (56%)] Loss: 1.08659 (QuantReg: 12.82671) QuantErr: 12.82671 batch_time=0.99436 
Train Epoch: 11 [289/500 18496/32000 (58%)] Loss: 1.03933 (QuantReg: 13.25818) QuantErr: 13.25818 batch_time=0.51292 
Train Epoch: 11 [297/500 19008/32000 (59%)] Loss: 0.95554 (QuantReg: 13.11172) QuantErr: 13.11172 batch_time=0.44982 
Train Epoch: 11 [305/500 19520/32000 (61%)] Loss: 1.37873 (QuantReg: 13.10417) QuantErr: 13.10417 batch_time=0.44753 
Train Epoch: 11 [313/500 20032/32000 (63%)] Loss: 1.35598 (QuantReg: 13.13944) QuantErr: 13.13944 batch_time=0.42179 
Train Epoch: 11 [321/500 20544/32000 (64%)] Loss: 0.94170 (QuantReg: 12.72989) QuantErr: 12.72989 batch_time=0.50396 
Train Epoch: 11 [329/500 21056/32000 (66%)] Loss: 0.84422 (QuantReg: 13.61640) QuantErr: 13.61640 batch_time=0.39554 
Train Epoch: 11 [337/500 21568/32000 (67%)] Loss: 0.98709 (QuantReg: 12.78237) QuantErr: 12.78237 batch_time=0.44011 
Train Epoch: 11 [345/500 22080/32000 (69%)] Loss: 1.08060 (QuantReg: 13.07524) QuantErr: 13.07524 batch_time=1.01755 
Train Epoch: 11 [353/500 22592/32000 (71%)] Loss: 1.44050 (QuantReg: 12.62722) QuantErr: 12.62722 batch_time=0.51546 
Train Epoch: 11 [361/500 23104/32000 (72%)] Loss: 1.18608 (QuantReg: 13.07934) QuantErr: 13.07934 batch_time=0.46843 
Train Epoch: 11 [369/500 23616/32000 (74%)] Loss: 1.03668 (QuantReg: 12.89354) QuantErr: 12.89354 batch_time=0.41325 
Train Epoch: 11 [377/500 24128/32000 (75%)] Loss: 0.93328 (QuantReg: 13.27618) QuantErr: 13.27618 batch_time=0.40860 
Train Epoch: 11 [385/500 24640/32000 (77%)] Loss: 1.21765 (QuantReg: 13.61658) QuantErr: 13.61658 batch_time=0.40692 
Train Epoch: 11 [393/500 25152/32000 (79%)] Loss: 0.73708 (QuantReg: 13.49705) QuantErr: 13.49705 batch_time=0.42069 
Train Epoch: 11 [401/500 25664/32000 (80%)] Loss: 0.86846 (QuantReg: 13.00858) QuantErr: 13.00858 batch_time=0.45568 
Train Epoch: 11 [409/500 26176/32000 (82%)] Loss: 0.78562 (QuantReg: 13.31164) QuantErr: 13.31164 batch_time=0.95502 
Train Epoch: 11 [417/500 26688/32000 (83%)] Loss: 1.01030 (QuantReg: 13.28611) QuantErr: 13.28611 batch_time=0.41217 
Train Epoch: 11 [425/500 27200/32000 (85%)] Loss: 1.37911 (QuantReg: 12.89245) QuantErr: 12.89245 batch_time=0.42979 
Train Epoch: 11 [433/500 27712/32000 (87%)] Loss: 1.33019 (QuantReg: 12.98512) QuantErr: 12.98512 batch_time=0.49923 
Train Epoch: 11 [441/500 28224/32000 (88%)] Loss: 0.72956 (QuantReg: 13.19493) QuantErr: 13.19493 batch_time=0.47080 
Train Epoch: 11 [449/500 28736/32000 (90%)] Loss: 1.05965 (QuantReg: 13.20649) QuantErr: 13.20649 batch_time=0.45856 
Train Epoch: 11 [457/500 29248/32000 (91%)] Loss: 0.74713 (QuantReg: 12.94671) QuantErr: 12.94671 batch_time=0.44407 
Train Epoch: 11 [465/500 29760/32000 (93%)] Loss: 0.76375 (QuantReg: 13.00963) QuantErr: 13.00963 batch_time=0.44827 
Train Epoch: 11 [473/500 30272/32000 (95%)] Loss: 1.34529 (QuantReg: 13.23400) QuantErr: 13.23400 batch_time=1.03656 
Train Epoch: 11 [481/500 30784/32000 (96%)] Loss: 0.80709 (QuantReg: 13.24707) QuantErr: 13.24707 batch_time=0.46427 
Train Epoch: 11 [489/500 31296/32000 (98%)] Loss: 1.29685 (QuantReg: 12.76005) QuantErr: 12.76005 batch_time=0.42657 
Train Epoch: 11 [497/500 31808/32000 (99%)] Loss: 1.12667 (QuantReg: 13.53999) QuantErr: 13.53999 batch_time=0.41625 
Train Epoch: 11 codebook_update_time=3.43452
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch11.pth ...
Done in 21.569s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch11.pth ...
Done in 27.140s
removing stale ckpt [epoch 10] [took 0.01s]
 epoch          : 11
 loss           : 1.0974702370166778
 quant_reg      : 12.922286697387696
 quant_err      : 12.922286697387696
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 5500
 MSRVTT_miech_test/t2v_metrics/R1: 18.9
 MSRVTT_miech_test/t2v_metrics/R5: 46.7
 MSRVTT_miech_test/t2v_metrics/R10: 60.7
 MSRVTT_miech_test/t2v_metrics/R50: 87.2
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.929
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 37.69836010381393
 MSRVTT_miech_test/v2t_metrics/R1: 18.3
 MSRVTT_miech_test/v2t_metrics/R5: 48.8
 MSRVTT_miech_test/v2t_metrics/R10: 62.8
 MSRVTT_miech_test/v2t_metrics/R50: 87.6
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.8145
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.27749588630824
 mnt_best       : 37.69836010381393
 not_improved_count: 0
Train Epoch: 12 [1/500 64/32000 (0%)] Loss: 0.78411 (QuantReg: 12.52631) QuantErr: 12.52631 batch_time=28.56503 
Train Epoch: 12 [9/500 576/32000 (2%)] Loss: 1.04062 (QuantReg: 12.85791) QuantErr: 12.85791 batch_time=0.42899 
Train Epoch: 12 [17/500 1088/32000 (3%)] Loss: 1.02669 (QuantReg: 12.83319) QuantErr: 12.83319 batch_time=0.46796 
Train Epoch: 12 [25/500 1600/32000 (5%)] Loss: 1.07634 (QuantReg: 12.89542) QuantErr: 12.89542 batch_time=0.85235 
Train Epoch: 12 [33/500 2112/32000 (7%)] Loss: 0.86830 (QuantReg: 13.24447) QuantErr: 13.24447 batch_time=0.48044 
Train Epoch: 12 [41/500 2624/32000 (8%)] Loss: 1.02652 (QuantReg: 12.86072) QuantErr: 12.86072 batch_time=0.45905 
Train Epoch: 12 [49/500 3136/32000 (10%)] Loss: 1.19055 (QuantReg: 12.62224) QuantErr: 12.62224 batch_time=0.47184 
Train Epoch: 12 [57/500 3648/32000 (11%)] Loss: 1.33046 (QuantReg: 13.09250) QuantErr: 13.09250 batch_time=0.48664 
Train Epoch: 12 [65/500 4160/32000 (13%)] Loss: 1.03046 (QuantReg: 12.61606) QuantErr: 12.61606 batch_time=0.71674 
Train Epoch: 12 [73/500 4672/32000 (15%)] Loss: 1.17412 (QuantReg: 13.11053) QuantErr: 13.11053 batch_time=0.51268 
Train Epoch: 12 [81/500 5184/32000 (16%)] Loss: 0.78724 (QuantReg: 12.99450) QuantErr: 12.99450 batch_time=0.46992 
Train Epoch: 12 [89/500 5696/32000 (18%)] Loss: 0.82989 (QuantReg: 12.45945) QuantErr: 12.45945 batch_time=0.96755 
Train Epoch: 12 [97/500 6208/32000 (19%)] Loss: 0.91186 (QuantReg: 12.54729) QuantErr: 12.54729 batch_time=0.51631 
Train Epoch: 12 [105/500 6720/32000 (21%)] Loss: 1.12051 (QuantReg: 13.39340) QuantErr: 13.39340 batch_time=0.44334 
Train Epoch: 12 [113/500 7232/32000 (23%)] Loss: 0.75535 (QuantReg: 12.77652) QuantErr: 12.77652 batch_time=0.47254 
Train Epoch: 12 [121/500 7744/32000 (24%)] Loss: 1.33297 (QuantReg: 12.51439) QuantErr: 12.51439 batch_time=0.47698 
Train Epoch: 12 [129/500 8256/32000 (26%)] Loss: 0.88040 (QuantReg: 12.55916) QuantErr: 12.55916 batch_time=0.68465 
Train Epoch: 12 [137/500 8768/32000 (27%)] Loss: 0.93542 (QuantReg: 12.68211) QuantErr: 12.68211 batch_time=0.45592 
Train Epoch: 12 [145/500 9280/32000 (29%)] Loss: 1.09660 (QuantReg: 12.70806) QuantErr: 12.70806 batch_time=0.50018 
Train Epoch: 12 [153/500 9792/32000 (31%)] Loss: 0.97582 (QuantReg: 13.18090) QuantErr: 13.18090 batch_time=0.80533 
Train Epoch: 12 [161/500 10304/32000 (32%)] Loss: 1.03692 (QuantReg: 12.62965) QuantErr: 12.62965 batch_time=0.44835 
Train Epoch: 12 [169/500 10816/32000 (34%)] Loss: 0.54726 (QuantReg: 13.06338) QuantErr: 13.06338 batch_time=0.50360 
Train Epoch: 12 [177/500 11328/32000 (35%)] Loss: 1.26944 (QuantReg: 12.11904) QuantErr: 12.11904 batch_time=0.44448 
Train Epoch: 12 [185/500 11840/32000 (37%)] Loss: 1.05496 (QuantReg: 13.21985) QuantErr: 13.21985 batch_time=0.42076 
Train Epoch: 12 [193/500 12352/32000 (39%)] Loss: 1.57523 (QuantReg: 12.60093) QuantErr: 12.60093 batch_time=0.69361 
Train Epoch: 12 [201/500 12864/32000 (40%)] Loss: 0.81699 (QuantReg: 12.90173) QuantErr: 12.90173 batch_time=0.48359 
Train Epoch: 12 [209/500 13376/32000 (42%)] Loss: 0.77560 (QuantReg: 12.98570) QuantErr: 12.98570 batch_time=0.42469 
Train Epoch: 12 [217/500 13888/32000 (43%)] Loss: 1.40105 (QuantReg: 12.80144) QuantErr: 12.80144 batch_time=0.84102 
Train Epoch: 12 [225/500 14400/32000 (45%)] Loss: 1.10045 (QuantReg: 12.32767) QuantErr: 12.32767 batch_time=0.46067 
Train Epoch: 12 [233/500 14912/32000 (47%)] Loss: 1.48370 (QuantReg: 12.81328) QuantErr: 12.81328 batch_time=0.45080 
Train Epoch: 12 [241/500 15424/32000 (48%)] Loss: 1.16026 (QuantReg: 13.81624) QuantErr: 13.81624 batch_time=0.42115 
Train Epoch: 12 [249/500 15936/32000 (50%)] Loss: 1.18521 (QuantReg: 13.07582) QuantErr: 13.07582 batch_time=0.40224 
Train Epoch: 12 [257/500 16448/32000 (51%)] Loss: 1.03425 (QuantReg: 13.18439) QuantErr: 13.18439 batch_time=0.67501 
Train Epoch: 12 [265/500 16960/32000 (53%)] Loss: 1.08165 (QuantReg: 12.27418) QuantErr: 12.27418 batch_time=0.47116 
Train Epoch: 12 [273/500 17472/32000 (55%)] Loss: 0.92145 (QuantReg: 12.99715) QuantErr: 12.99715 batch_time=0.41703 
Train Epoch: 12 [281/500 17984/32000 (56%)] Loss: 0.99489 (QuantReg: 12.89995) QuantErr: 12.89995 batch_time=0.81320 
Train Epoch: 12 [289/500 18496/32000 (58%)] Loss: 1.11315 (QuantReg: 12.72027) QuantErr: 12.72027 batch_time=0.42291 
Train Epoch: 12 [297/500 19008/32000 (59%)] Loss: 1.06697 (QuantReg: 13.18307) QuantErr: 13.18307 batch_time=0.40057 
Train Epoch: 12 [305/500 19520/32000 (61%)] Loss: 0.94991 (QuantReg: 13.46874) QuantErr: 13.46874 batch_time=0.47447 
Train Epoch: 12 [313/500 20032/32000 (63%)] Loss: 1.37157 (QuantReg: 13.09261) QuantErr: 13.09261 batch_time=0.42127 
Train Epoch: 12 [321/500 20544/32000 (64%)] Loss: 0.75012 (QuantReg: 13.22356) QuantErr: 13.22356 batch_time=0.66567 
Train Epoch: 12 [329/500 21056/32000 (66%)] Loss: 1.76461 (QuantReg: 12.93567) QuantErr: 12.93567 batch_time=0.48402 
Train Epoch: 12 [337/500 21568/32000 (67%)] Loss: 1.29384 (QuantReg: 13.13990) QuantErr: 13.13990 batch_time=0.44066 
Train Epoch: 12 [345/500 22080/32000 (69%)] Loss: 1.19229 (QuantReg: 13.02576) QuantErr: 13.02576 batch_time=0.94980 
Train Epoch: 12 [353/500 22592/32000 (71%)] Loss: 1.21733 (QuantReg: 13.15136) QuantErr: 13.15136 batch_time=0.47918 
Train Epoch: 12 [361/500 23104/32000 (72%)] Loss: 0.93258 (QuantReg: 12.90008) QuantErr: 12.90008 batch_time=0.47096 
Train Epoch: 12 [369/500 23616/32000 (74%)] Loss: 1.52956 (QuantReg: 12.71964) QuantErr: 12.71964 batch_time=0.41124 
Train Epoch: 12 [377/500 24128/32000 (75%)] Loss: 0.92094 (QuantReg: 12.74104) QuantErr: 12.74104 batch_time=0.43412 
Train Epoch: 12 [385/500 24640/32000 (77%)] Loss: 1.22441 (QuantReg: 12.74169) QuantErr: 12.74169 batch_time=0.62699 
Train Epoch: 12 [393/500 25152/32000 (79%)] Loss: 0.65226 (QuantReg: 12.35873) QuantErr: 12.35873 batch_time=0.46980 
Train Epoch: 12 [401/500 25664/32000 (80%)] Loss: 1.09689 (QuantReg: 13.46878) QuantErr: 13.46878 batch_time=0.42073 
Train Epoch: 12 [409/500 26176/32000 (82%)] Loss: 1.22272 (QuantReg: 12.78900) QuantErr: 12.78900 batch_time=0.84469 
Train Epoch: 12 [417/500 26688/32000 (83%)] Loss: 1.04380 (QuantReg: 12.73388) QuantErr: 12.73388 batch_time=0.43108 
Train Epoch: 12 [425/500 27200/32000 (85%)] Loss: 0.88470 (QuantReg: 13.43841) QuantErr: 13.43841 batch_time=0.41491 
Train Epoch: 12 [433/500 27712/32000 (87%)] Loss: 0.86612 (QuantReg: 13.24415) QuantErr: 13.24415 batch_time=0.46679 
Train Epoch: 12 [441/500 28224/32000 (88%)] Loss: 1.31918 (QuantReg: 13.01263) QuantErr: 13.01263 batch_time=0.45755 
Train Epoch: 12 [449/500 28736/32000 (90%)] Loss: 1.05858 (QuantReg: 13.31709) QuantErr: 13.31709 batch_time=0.81141 
Train Epoch: 12 [457/500 29248/32000 (91%)] Loss: 0.88737 (QuantReg: 12.99443) QuantErr: 12.99443 batch_time=0.48324 
Train Epoch: 12 [465/500 29760/32000 (93%)] Loss: 0.96689 (QuantReg: 13.21270) QuantErr: 13.21270 batch_time=0.48303 
Train Epoch: 12 [473/500 30272/32000 (95%)] Loss: 1.00107 (QuantReg: 12.93638) QuantErr: 12.93638 batch_time=0.92154 
Train Epoch: 12 [481/500 30784/32000 (96%)] Loss: 1.12837 (QuantReg: 12.97361) QuantErr: 12.97361 batch_time=0.43017 
Train Epoch: 12 [489/500 31296/32000 (98%)] Loss: 1.00935 (QuantReg: 13.06995) QuantErr: 13.06995 batch_time=0.45877 
Train Epoch: 12 [497/500 31808/32000 (99%)] Loss: 0.97922 (QuantReg: 13.76042) QuantErr: 13.76042 batch_time=0.52497 
Train Epoch: 12 codebook_update_time=3.42912
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch12.pth ...
Done in 16.202s
removing stale ckpt [epoch 11] [took 0.02s]
 epoch          : 12
 loss           : 1.0597783931493758
 quant_reg      : 12.964982166290284
 quant_err      : 12.964982166290284
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 6000
 MSRVTT_miech_test/t2v_metrics/R1: 18.8
 MSRVTT_miech_test/t2v_metrics/R5: 46.8
 MSRVTT_miech_test/t2v_metrics/R10: 60.6
 MSRVTT_miech_test/t2v_metrics/R50: 88.1
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.777
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 37.63790503702182
 MSRVTT_miech_test/v2t_metrics/R1: 18.3
 MSRVTT_miech_test/v2t_metrics/R5: 47.7
 MSRVTT_miech_test/v2t_metrics/R10: 62.4
 MSRVTT_miech_test/v2t_metrics/R50: 88.6
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.143
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.9068781709527
 mnt_best       : 37.69836010381393
 not_improved_count: 1
Train Epoch: 13 [1/500 64/32000 (0%)] Loss: 0.94529 (QuantReg: 12.94989) QuantErr: 12.94989 batch_time=27.21714 
Train Epoch: 13 [9/500 576/32000 (2%)] Loss: 0.95696 (QuantReg: 12.78443) QuantErr: 12.78443 batch_time=0.48929 
Train Epoch: 13 [17/500 1088/32000 (3%)] Loss: 1.08856 (QuantReg: 13.17888) QuantErr: 13.17888 batch_time=0.48898 
Train Epoch: 13 [25/500 1600/32000 (5%)] Loss: 0.98251 (QuantReg: 12.94625) QuantErr: 12.94625 batch_time=0.47989 
Train Epoch: 13 [33/500 2112/32000 (7%)] Loss: 1.05446 (QuantReg: 13.11724) QuantErr: 13.11724 batch_time=0.39206 
Train Epoch: 13 [41/500 2624/32000 (8%)] Loss: 0.86431 (QuantReg: 12.82433) QuantErr: 12.82433 batch_time=0.45713 
Train Epoch: 13 [49/500 3136/32000 (10%)] Loss: 1.01005 (QuantReg: 12.24400) QuantErr: 12.24400 batch_time=0.47833 
Train Epoch: 13 [57/500 3648/32000 (11%)] Loss: 0.70627 (QuantReg: 13.03203) QuantErr: 13.03203 batch_time=0.49242 
Train Epoch: 13 [65/500 4160/32000 (13%)] Loss: 0.96401 (QuantReg: 13.07303) QuantErr: 13.07303 batch_time=0.55613 
Train Epoch: 13 [73/500 4672/32000 (15%)] Loss: 0.66742 (QuantReg: 13.07680) QuantErr: 13.07680 batch_time=0.48918 
Train Epoch: 13 [81/500 5184/32000 (16%)] Loss: 1.25625 (QuantReg: 12.99358) QuantErr: 12.99358 batch_time=0.47007 
Train Epoch: 13 [89/500 5696/32000 (18%)] Loss: 1.06085 (QuantReg: 12.78004) QuantErr: 12.78004 batch_time=0.43625 
Train Epoch: 13 [97/500 6208/32000 (19%)] Loss: 0.56537 (QuantReg: 13.20787) QuantErr: 13.20787 batch_time=0.43992 
Train Epoch: 13 [105/500 6720/32000 (21%)] Loss: 1.16136 (QuantReg: 13.10752) QuantErr: 13.10752 batch_time=0.49825 
Train Epoch: 13 [113/500 7232/32000 (23%)] Loss: 1.03369 (QuantReg: 12.87058) QuantErr: 12.87058 batch_time=0.48336 
Train Epoch: 13 [121/500 7744/32000 (24%)] Loss: 1.09471 (QuantReg: 13.04721) QuantErr: 13.04721 batch_time=0.45979 
Train Epoch: 13 [129/500 8256/32000 (26%)] Loss: 1.05819 (QuantReg: 13.23025) QuantErr: 13.23025 batch_time=0.42258 
Train Epoch: 13 [137/500 8768/32000 (27%)] Loss: 1.08976 (QuantReg: 12.72305) QuantErr: 12.72305 batch_time=0.46990 
Train Epoch: 13 [145/500 9280/32000 (29%)] Loss: 1.11289 (QuantReg: 12.70124) QuantErr: 12.70124 batch_time=0.43852 
Train Epoch: 13 [153/500 9792/32000 (31%)] Loss: 1.05416 (QuantReg: 12.70237) QuantErr: 12.70237 batch_time=0.42064 
Train Epoch: 13 [161/500 10304/32000 (32%)] Loss: 1.04011 (QuantReg: 13.22764) QuantErr: 13.22764 batch_time=0.42836 
Train Epoch: 13 [169/500 10816/32000 (34%)] Loss: 0.93751 (QuantReg: 12.91431) QuantErr: 12.91431 batch_time=0.44019 
Train Epoch: 13 [177/500 11328/32000 (35%)] Loss: 0.56473 (QuantReg: 12.84623) QuantErr: 12.84623 batch_time=0.50579 
Train Epoch: 13 [185/500 11840/32000 (37%)] Loss: 1.64359 (QuantReg: 12.67304) QuantErr: 12.67304 batch_time=0.47545 
Train Epoch: 13 [193/500 12352/32000 (39%)] Loss: 0.88697 (QuantReg: 13.25885) QuantErr: 13.25885 batch_time=0.47409 
Train Epoch: 13 [201/500 12864/32000 (40%)] Loss: 0.88905 (QuantReg: 13.09867) QuantErr: 13.09867 batch_time=0.43345 
Train Epoch: 13 [209/500 13376/32000 (42%)] Loss: 0.93241 (QuantReg: 13.09340) QuantErr: 13.09340 batch_time=0.44307 
Train Epoch: 13 [217/500 13888/32000 (43%)] Loss: 1.23599 (QuantReg: 12.94531) QuantErr: 12.94531 batch_time=0.49581 
Train Epoch: 13 [225/500 14400/32000 (45%)] Loss: 1.02084 (QuantReg: 12.98151) QuantErr: 12.98151 batch_time=0.47853 
Train Epoch: 13 [233/500 14912/32000 (47%)] Loss: 1.18194 (QuantReg: 12.76179) QuantErr: 12.76179 batch_time=0.45824 
Train Epoch: 13 [241/500 15424/32000 (48%)] Loss: 0.99606 (QuantReg: 13.23770) QuantErr: 13.23770 batch_time=0.41450 
Train Epoch: 13 [249/500 15936/32000 (50%)] Loss: 0.75967 (QuantReg: 12.82416) QuantErr: 12.82416 batch_time=0.47954 
Train Epoch: 13 [257/500 16448/32000 (51%)] Loss: 1.31304 (QuantReg: 12.95381) QuantErr: 12.95381 batch_time=0.43060 
Train Epoch: 13 [265/500 16960/32000 (53%)] Loss: 0.95190 (QuantReg: 12.68193) QuantErr: 12.68193 batch_time=0.42229 
Train Epoch: 13 [273/500 17472/32000 (55%)] Loss: 1.16226 (QuantReg: 13.44605) QuantErr: 13.44605 batch_time=0.44649 
Train Epoch: 13 [281/500 17984/32000 (56%)] Loss: 0.96492 (QuantReg: 13.44039) QuantErr: 13.44039 batch_time=0.43950 
Train Epoch: 13 [289/500 18496/32000 (58%)] Loss: 0.44959 (QuantReg: 13.39247) QuantErr: 13.39247 batch_time=0.42557 
Train Epoch: 13 [297/500 19008/32000 (59%)] Loss: 1.10111 (QuantReg: 12.96728) QuantErr: 12.96728 batch_time=0.40396 
Train Epoch: 13 [305/500 19520/32000 (61%)] Loss: 1.20601 (QuantReg: 12.51505) QuantErr: 12.51505 batch_time=0.41992 
Train Epoch: 13 [313/500 20032/32000 (63%)] Loss: 1.12153 (QuantReg: 13.18474) QuantErr: 13.18474 batch_time=0.44815 
Train Epoch: 13 [321/500 20544/32000 (64%)] Loss: 1.31893 (QuantReg: 12.62011) QuantErr: 12.62011 batch_time=0.40570 
Train Epoch: 13 [329/500 21056/32000 (66%)] Loss: 0.96420 (QuantReg: 13.06768) QuantErr: 13.06768 batch_time=0.42433 
Train Epoch: 13 [337/500 21568/32000 (67%)] Loss: 0.83418 (QuantReg: 13.19680) QuantErr: 13.19680 batch_time=0.49637 
Train Epoch: 13 [345/500 22080/32000 (69%)] Loss: 0.79711 (QuantReg: 13.20159) QuantErr: 13.20159 batch_time=0.42167 
Train Epoch: 13 [353/500 22592/32000 (71%)] Loss: 0.86864 (QuantReg: 13.21949) QuantErr: 13.21949 batch_time=0.44623 
Train Epoch: 13 [361/500 23104/32000 (72%)] Loss: 1.10461 (QuantReg: 13.35943) QuantErr: 13.35943 batch_time=0.44645 
Train Epoch: 13 [369/500 23616/32000 (74%)] Loss: 1.17230 (QuantReg: 12.78669) QuantErr: 12.78669 batch_time=0.43003 
Train Epoch: 13 [377/500 24128/32000 (75%)] Loss: 0.68475 (QuantReg: 12.99491) QuantErr: 12.99491 batch_time=0.40273 
Train Epoch: 13 [385/500 24640/32000 (77%)] Loss: 0.75084 (QuantReg: 13.15538) QuantErr: 13.15538 batch_time=0.45528 
Train Epoch: 13 [393/500 25152/32000 (79%)] Loss: 0.91288 (QuantReg: 13.27574) QuantErr: 13.27574 batch_time=0.46666 
Train Epoch: 13 [401/500 25664/32000 (80%)] Loss: 0.78335 (QuantReg: 12.93260) QuantErr: 12.93260 batch_time=0.43633 
Train Epoch: 13 [409/500 26176/32000 (82%)] Loss: 1.00213 (QuantReg: 12.93556) QuantErr: 12.93556 batch_time=0.45844 
Train Epoch: 13 [417/500 26688/32000 (83%)] Loss: 0.82881 (QuantReg: 12.82056) QuantErr: 12.82056 batch_time=0.43258 
Train Epoch: 13 [425/500 27200/32000 (85%)] Loss: 0.74850 (QuantReg: 13.57847) QuantErr: 13.57847 batch_time=0.44708 
Train Epoch: 13 [433/500 27712/32000 (87%)] Loss: 0.86278 (QuantReg: 12.55347) QuantErr: 12.55347 batch_time=0.48590 
Train Epoch: 13 [441/500 28224/32000 (88%)] Loss: 0.92630 (QuantReg: 12.73909) QuantErr: 12.73909 batch_time=0.43966 
Train Epoch: 13 [449/500 28736/32000 (90%)] Loss: 0.95535 (QuantReg: 13.66553) QuantErr: 13.66553 batch_time=0.41196 
Train Epoch: 13 [457/500 29248/32000 (91%)] Loss: 1.09873 (QuantReg: 13.74827) QuantErr: 13.74827 batch_time=0.47457 
Train Epoch: 13 [465/500 29760/32000 (93%)] Loss: 0.71678 (QuantReg: 13.43684) QuantErr: 13.43684 batch_time=0.48807 
Train Epoch: 13 [473/500 30272/32000 (95%)] Loss: 1.05229 (QuantReg: 12.84658) QuantErr: 12.84658 batch_time=0.73497 
Train Epoch: 13 [481/500 30784/32000 (96%)] Loss: 1.05298 (QuantReg: 13.15375) QuantErr: 13.15375 batch_time=0.41387 
Train Epoch: 13 [489/500 31296/32000 (98%)] Loss: 0.67566 (QuantReg: 13.40538) QuantErr: 13.40538 batch_time=0.46992 
Train Epoch: 13 [497/500 31808/32000 (99%)] Loss: 1.20662 (QuantReg: 13.36541) QuantErr: 13.36541 batch_time=0.40427 
Train Epoch: 13 codebook_update_time=2.16176
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch13.pth ...
Done in 24.256s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch13.pth ...
Done in 30.295s
removing stale ckpt [epoch 12] [took 0.24s]
 epoch          : 13
 loss           : 0.991506151676178
 quant_reg      : 12.98829436302185
 quant_err      : 12.98829436302185
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 6500
 MSRVTT_miech_test/t2v_metrics/R1: 19.1
 MSRVTT_miech_test/t2v_metrics/R5: 47.6
 MSRVTT_miech_test/t2v_metrics/R10: 61.9
 MSRVTT_miech_test/t2v_metrics/R50: 88.5
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.598
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 38.32160202245027
 MSRVTT_miech_test/v2t_metrics/R1: 17.5
 MSRVTT_miech_test/v2t_metrics/R5: 46.6
 MSRVTT_miech_test/v2t_metrics/R10: 62.1
 MSRVTT_miech_test/v2t_metrics/R50: 88.4
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.4975
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.997455388674524
 mnt_best       : 38.32160202245027
 not_improved_count: 0
Train Epoch: 14 [1/500 64/32000 (0%)] Loss: 1.13509 (QuantReg: 12.45179) QuantErr: 12.45179 batch_time=30.61540 
Train Epoch: 14 [9/500 576/32000 (2%)] Loss: 0.82878 (QuantReg: 12.62903) QuantErr: 12.62903 batch_time=0.51328 
Train Epoch: 14 [17/500 1088/32000 (3%)] Loss: 0.79880 (QuantReg: 13.38036) QuantErr: 13.38036 batch_time=0.42697 
Train Epoch: 14 [25/500 1600/32000 (5%)] Loss: 0.61642 (QuantReg: 12.64861) QuantErr: 12.64861 batch_time=0.44125 
Train Epoch: 14 [33/500 2112/32000 (7%)] Loss: 0.76270 (QuantReg: 12.94065) QuantErr: 12.94065 batch_time=0.48261 
Train Epoch: 14 [41/500 2624/32000 (8%)] Loss: 0.95905 (QuantReg: 12.86038) QuantErr: 12.86038 batch_time=0.38925 
Train Epoch: 14 [49/500 3136/32000 (10%)] Loss: 0.94437 (QuantReg: 13.35889) QuantErr: 13.35889 batch_time=0.40448 
Train Epoch: 14 [57/500 3648/32000 (11%)] Loss: 0.69267 (QuantReg: 13.42398) QuantErr: 13.42398 batch_time=0.42862 
Train Epoch: 14 [65/500 4160/32000 (13%)] Loss: 0.83048 (QuantReg: 12.68103) QuantErr: 12.68103 batch_time=0.85517 
Train Epoch: 14 [73/500 4672/32000 (15%)] Loss: 1.04561 (QuantReg: 13.00197) QuantErr: 13.00197 batch_time=0.49296 
Train Epoch: 14 [81/500 5184/32000 (16%)] Loss: 0.84573 (QuantReg: 12.79597) QuantErr: 12.79597 batch_time=0.45721 
Train Epoch: 14 [89/500 5696/32000 (18%)] Loss: 1.00464 (QuantReg: 12.75159) QuantErr: 12.75159 batch_time=0.60491 
Train Epoch: 14 [97/500 6208/32000 (19%)] Loss: 1.01366 (QuantReg: 13.06486) QuantErr: 13.06486 batch_time=0.43119 
Train Epoch: 14 [105/500 6720/32000 (21%)] Loss: 0.69200 (QuantReg: 13.10846) QuantErr: 13.10846 batch_time=0.40211 
Train Epoch: 14 [113/500 7232/32000 (23%)] Loss: 1.47789 (QuantReg: 12.53551) QuantErr: 12.53551 batch_time=0.45142 
Train Epoch: 14 [121/500 7744/32000 (24%)] Loss: 0.80149 (QuantReg: 12.97725) QuantErr: 12.97725 batch_time=0.40320 
Train Epoch: 14 [129/500 8256/32000 (26%)] Loss: 0.85305 (QuantReg: 12.65252) QuantErr: 12.65252 batch_time=0.85403 
Train Epoch: 14 [137/500 8768/32000 (27%)] Loss: 0.77026 (QuantReg: 13.30214) QuantErr: 13.30214 batch_time=0.40691 
Train Epoch: 14 [145/500 9280/32000 (29%)] Loss: 0.77998 (QuantReg: 13.03293) QuantErr: 13.03293 batch_time=0.47735 
Train Epoch: 14 [153/500 9792/32000 (31%)] Loss: 0.89735 (QuantReg: 13.20582) QuantErr: 13.20582 batch_time=0.47014 
Train Epoch: 14 [161/500 10304/32000 (32%)] Loss: 0.88612 (QuantReg: 12.34569) QuantErr: 12.34569 batch_time=0.49171 
Train Epoch: 14 [169/500 10816/32000 (34%)] Loss: 0.74795 (QuantReg: 12.64977) QuantErr: 12.64977 batch_time=0.40849 
Train Epoch: 14 [177/500 11328/32000 (35%)] Loss: 0.68609 (QuantReg: 13.32665) QuantErr: 13.32665 batch_time=0.45039 
Train Epoch: 14 [185/500 11840/32000 (37%)] Loss: 1.23268 (QuantReg: 12.99198) QuantErr: 12.99198 batch_time=0.41556 
Train Epoch: 14 [193/500 12352/32000 (39%)] Loss: 0.69808 (QuantReg: 13.27784) QuantErr: 13.27784 batch_time=0.88238 
Train Epoch: 14 [201/500 12864/32000 (40%)] Loss: 1.05786 (QuantReg: 13.30802) QuantErr: 13.30802 batch_time=0.48792 
Train Epoch: 14 [209/500 13376/32000 (42%)] Loss: 0.82533 (QuantReg: 13.24717) QuantErr: 13.24717 batch_time=0.51030 
Train Epoch: 14 [217/500 13888/32000 (43%)] Loss: 0.89196 (QuantReg: 13.44516) QuantErr: 13.44516 batch_time=0.43708 
Train Epoch: 14 [225/500 14400/32000 (45%)] Loss: 0.67780 (QuantReg: 13.63457) QuantErr: 13.63457 batch_time=0.41875 
Train Epoch: 14 [233/500 14912/32000 (47%)] Loss: 0.79790 (QuantReg: 13.16987) QuantErr: 13.16987 batch_time=0.42962 
Train Epoch: 14 [241/500 15424/32000 (48%)] Loss: 0.65650 (QuantReg: 13.18373) QuantErr: 13.18373 batch_time=0.43215 
Train Epoch: 14 [249/500 15936/32000 (50%)] Loss: 0.65369 (QuantReg: 13.42452) QuantErr: 13.42452 batch_time=0.46882 
Train Epoch: 14 [257/500 16448/32000 (51%)] Loss: 1.32120 (QuantReg: 13.02849) QuantErr: 13.02849 batch_time=0.85599 
Train Epoch: 14 [265/500 16960/32000 (53%)] Loss: 1.05210 (QuantReg: 13.08924) QuantErr: 13.08924 batch_time=0.44672 
Train Epoch: 14 [273/500 17472/32000 (55%)] Loss: 0.59487 (QuantReg: 13.05129) QuantErr: 13.05129 batch_time=0.42817 
Train Epoch: 14 [281/500 17984/32000 (56%)] Loss: 0.86463 (QuantReg: 12.97997) QuantErr: 12.97997 batch_time=0.44693 
Train Epoch: 14 [289/500 18496/32000 (58%)] Loss: 0.63599 (QuantReg: 13.27282) QuantErr: 13.27282 batch_time=0.43573 
Train Epoch: 14 [297/500 19008/32000 (59%)] Loss: 0.94707 (QuantReg: 12.93930) QuantErr: 12.93930 batch_time=0.42606 
Train Epoch: 14 [305/500 19520/32000 (61%)] Loss: 0.99611 (QuantReg: 13.15728) QuantErr: 13.15728 batch_time=0.44882 
Train Epoch: 14 [313/500 20032/32000 (63%)] Loss: 1.24052 (QuantReg: 12.75265) QuantErr: 12.75265 batch_time=0.49718 
Train Epoch: 14 [321/500 20544/32000 (64%)] Loss: 1.34551 (QuantReg: 12.67743) QuantErr: 12.67743 batch_time=0.86039 
Train Epoch: 14 [329/500 21056/32000 (66%)] Loss: 0.79773 (QuantReg: 13.46748) QuantErr: 13.46748 batch_time=0.43973 
Train Epoch: 14 [337/500 21568/32000 (67%)] Loss: 0.54041 (QuantReg: 13.00132) QuantErr: 13.00132 batch_time=0.42233 
Train Epoch: 14 [345/500 22080/32000 (69%)] Loss: 0.87952 (QuantReg: 12.81566) QuantErr: 12.81566 batch_time=0.44893 
Train Epoch: 14 [353/500 22592/32000 (71%)] Loss: 0.94609 (QuantReg: 13.30657) QuantErr: 13.30657 batch_time=0.47610 
Train Epoch: 14 [361/500 23104/32000 (72%)] Loss: 0.91315 (QuantReg: 13.73209) QuantErr: 13.73209 batch_time=0.42412 
Train Epoch: 14 [369/500 23616/32000 (74%)] Loss: 0.88989 (QuantReg: 13.23096) QuantErr: 13.23096 batch_time=0.43613 
Train Epoch: 14 [377/500 24128/32000 (75%)] Loss: 0.70976 (QuantReg: 13.73255) QuantErr: 13.73255 batch_time=0.48936 
Train Epoch: 14 [385/500 24640/32000 (77%)] Loss: 0.86510 (QuantReg: 13.32057) QuantErr: 13.32057 batch_time=0.92825 
Train Epoch: 14 [393/500 25152/32000 (79%)] Loss: 0.86338 (QuantReg: 13.36403) QuantErr: 13.36403 batch_time=0.53634 
Train Epoch: 14 [401/500 25664/32000 (80%)] Loss: 0.66307 (QuantReg: 13.19650) QuantErr: 13.19650 batch_time=0.48040 
Train Epoch: 14 [409/500 26176/32000 (82%)] Loss: 0.90540 (QuantReg: 13.14703) QuantErr: 13.14703 batch_time=0.41180 
Train Epoch: 14 [417/500 26688/32000 (83%)] Loss: 0.58808 (QuantReg: 13.42396) QuantErr: 13.42396 batch_time=0.41432 
Train Epoch: 14 [425/500 27200/32000 (85%)] Loss: 1.14381 (QuantReg: 12.89818) QuantErr: 12.89818 batch_time=0.41881 
Train Epoch: 14 [433/500 27712/32000 (87%)] Loss: 0.90079 (QuantReg: 12.69640) QuantErr: 12.69640 batch_time=0.42779 
Train Epoch: 14 [441/500 28224/32000 (88%)] Loss: 1.08550 (QuantReg: 12.87374) QuantErr: 12.87374 batch_time=0.42966 
Train Epoch: 14 [449/500 28736/32000 (90%)] Loss: 1.20381 (QuantReg: 13.44963) QuantErr: 13.44963 batch_time=0.91362 
Train Epoch: 14 [457/500 29248/32000 (91%)] Loss: 1.08076 (QuantReg: 13.50385) QuantErr: 13.50385 batch_time=0.46556 
Train Epoch: 14 [465/500 29760/32000 (93%)] Loss: 0.87722 (QuantReg: 12.96721) QuantErr: 12.96721 batch_time=0.44425 
Train Epoch: 14 [473/500 30272/32000 (95%)] Loss: 0.70808 (QuantReg: 13.10705) QuantErr: 13.10705 batch_time=0.41783 
Train Epoch: 14 [481/500 30784/32000 (96%)] Loss: 0.59816 (QuantReg: 13.20847) QuantErr: 13.20847 batch_time=0.43062 
Train Epoch: 14 [489/500 31296/32000 (98%)] Loss: 0.87245 (QuantReg: 13.25690) QuantErr: 13.25690 batch_time=0.47124 
Train Epoch: 14 [497/500 31808/32000 (99%)] Loss: 0.97742 (QuantReg: 13.08076) QuantErr: 13.08076 batch_time=0.47710 
Train Epoch: 14 codebook_update_time=2.96373
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch14.pth ...
Done in 6.359s
removing stale ckpt [epoch 13] [took 0.00s]
 epoch          : 14
 loss           : 0.9439447093009948
 quant_reg      : 13.068302228927612
 quant_err      : 13.068302228927612
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 7000
 MSRVTT_miech_test/t2v_metrics/R1: 17.5
 MSRVTT_miech_test/t2v_metrics/R5: 46.8
 MSRVTT_miech_test/t2v_metrics/R10: 61.0
 MSRVTT_miech_test/t2v_metrics/R50: 87.8
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.176
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 36.83024254667216
 MSRVTT_miech_test/v2t_metrics/R1: 17.8
 MSRVTT_miech_test/v2t_metrics/R5: 47.5
 MSRVTT_miech_test/v2t_metrics/R10: 62.5
 MSRVTT_miech_test/v2t_metrics/R50: 88.7
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.753
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.525908022453756
 mnt_best       : 38.32160202245027
 not_improved_count: 1
Train Epoch: 15 [1/500 64/32000 (0%)] Loss: 0.80612 (QuantReg: 13.24601) QuantErr: 13.24601 batch_time=33.76439 
Train Epoch: 15 [9/500 576/32000 (2%)] Loss: 0.85233 (QuantReg: 13.12813) QuantErr: 13.12813 batch_time=0.47980 
Train Epoch: 15 [17/500 1088/32000 (3%)] Loss: 0.94957 (QuantReg: 12.99976) QuantErr: 12.99976 batch_time=0.44459 
Train Epoch: 15 [25/500 1600/32000 (5%)] Loss: 0.89294 (QuantReg: 13.55009) QuantErr: 13.55009 batch_time=0.45509 
Train Epoch: 15 [33/500 2112/32000 (7%)] Loss: 0.52375 (QuantReg: 13.10199) QuantErr: 13.10199 batch_time=0.48377 
Train Epoch: 15 [41/500 2624/32000 (8%)] Loss: 1.13982 (QuantReg: 13.12915) QuantErr: 13.12915 batch_time=0.46108 
Train Epoch: 15 [49/500 3136/32000 (10%)] Loss: 1.03114 (QuantReg: 12.10517) QuantErr: 12.10517 batch_time=0.47586 
Train Epoch: 15 [57/500 3648/32000 (11%)] Loss: 0.98760 (QuantReg: 13.10638) QuantErr: 13.10638 batch_time=0.43364 
Train Epoch: 15 [65/500 4160/32000 (13%)] Loss: 0.91376 (QuantReg: 13.10666) QuantErr: 13.10666 batch_time=2.70159 
Train Epoch: 15 [73/500 4672/32000 (15%)] Loss: 0.78342 (QuantReg: 13.21721) QuantErr: 13.21721 batch_time=0.44550 
Train Epoch: 15 [81/500 5184/32000 (16%)] Loss: 0.90733 (QuantReg: 12.77796) QuantErr: 12.77796 batch_time=0.46584 
Train Epoch: 15 [89/500 5696/32000 (18%)] Loss: 0.79414 (QuantReg: 12.82115) QuantErr: 12.82115 batch_time=0.48917 
Train Epoch: 15 [97/500 6208/32000 (19%)] Loss: 0.86043 (QuantReg: 12.93568) QuantErr: 12.93568 batch_time=0.43874 
Train Epoch: 15 [105/500 6720/32000 (21%)] Loss: 0.94609 (QuantReg: 13.22382) QuantErr: 13.22382 batch_time=0.43011 
Train Epoch: 15 [113/500 7232/32000 (23%)] Loss: 0.66268 (QuantReg: 12.60670) QuantErr: 12.60670 batch_time=0.45303 
Train Epoch: 15 [121/500 7744/32000 (24%)] Loss: 0.58088 (QuantReg: 13.51751) QuantErr: 13.51751 batch_time=0.47073 
Train Epoch: 15 [129/500 8256/32000 (26%)] Loss: 1.17443 (QuantReg: 12.90214) QuantErr: 12.90214 batch_time=2.73227 
Train Epoch: 15 [137/500 8768/32000 (27%)] Loss: 0.64613 (QuantReg: 13.24915) QuantErr: 13.24915 batch_time=0.49079 
Train Epoch: 15 [145/500 9280/32000 (29%)] Loss: 0.81210 (QuantReg: 12.84654) QuantErr: 12.84654 batch_time=0.48108 
Train Epoch: 15 [153/500 9792/32000 (31%)] Loss: 0.79425 (QuantReg: 13.20362) QuantErr: 13.20362 batch_time=0.43748 
Train Epoch: 15 [161/500 10304/32000 (32%)] Loss: 0.63512 (QuantReg: 12.98822) QuantErr: 12.98822 batch_time=0.46916 
Train Epoch: 15 [169/500 10816/32000 (34%)] Loss: 1.06942 (QuantReg: 12.93493) QuantErr: 12.93493 batch_time=0.48190 
Train Epoch: 15 [177/500 11328/32000 (35%)] Loss: 0.78211 (QuantReg: 12.87089) QuantErr: 12.87089 batch_time=0.45221 
Train Epoch: 15 [185/500 11840/32000 (37%)] Loss: 0.70572 (QuantReg: 12.79957) QuantErr: 12.79957 batch_time=0.49534 
Train Epoch: 15 [193/500 12352/32000 (39%)] Loss: 0.86860 (QuantReg: 13.24145) QuantErr: 13.24145 batch_time=2.80815 
Train Epoch: 15 [201/500 12864/32000 (40%)] Loss: 0.79912 (QuantReg: 13.46303) QuantErr: 13.46303 batch_time=0.46516 
Train Epoch: 15 [209/500 13376/32000 (42%)] Loss: 0.74323 (QuantReg: 12.76936) QuantErr: 12.76936 batch_time=0.45139 
Train Epoch: 15 [217/500 13888/32000 (43%)] Loss: 0.75292 (QuantReg: 13.03429) QuantErr: 13.03429 batch_time=0.44379 
Train Epoch: 15 [225/500 14400/32000 (45%)] Loss: 1.19713 (QuantReg: 13.22580) QuantErr: 13.22580 batch_time=0.47977 
Train Epoch: 15 [233/500 14912/32000 (47%)] Loss: 0.78373 (QuantReg: 12.95511) QuantErr: 12.95511 batch_time=0.44973 
Train Epoch: 15 [241/500 15424/32000 (48%)] Loss: 0.69395 (QuantReg: 13.12497) QuantErr: 13.12497 batch_time=0.42902 
Train Epoch: 15 [249/500 15936/32000 (50%)] Loss: 0.97229 (QuantReg: 13.12557) QuantErr: 13.12557 batch_time=0.46086 
Train Epoch: 15 [257/500 16448/32000 (51%)] Loss: 0.63160 (QuantReg: 13.28087) QuantErr: 13.28087 batch_time=2.70642 
Train Epoch: 15 [265/500 16960/32000 (53%)] Loss: 0.98105 (QuantReg: 13.12096) QuantErr: 13.12096 batch_time=0.45456 
Train Epoch: 15 [273/500 17472/32000 (55%)] Loss: 0.57207 (QuantReg: 13.18506) QuantErr: 13.18506 batch_time=0.44427 
Train Epoch: 15 [281/500 17984/32000 (56%)] Loss: 0.89972 (QuantReg: 13.27720) QuantErr: 13.27720 batch_time=0.46031 
Train Epoch: 15 [289/500 18496/32000 (58%)] Loss: 1.02340 (QuantReg: 12.83379) QuantErr: 12.83379 batch_time=0.46863 
Train Epoch: 15 [297/500 19008/32000 (59%)] Loss: 0.60037 (QuantReg: 13.69611) QuantErr: 13.69611 batch_time=0.47014 
Train Epoch: 15 [305/500 19520/32000 (61%)] Loss: 0.57142 (QuantReg: 13.23109) QuantErr: 13.23109 batch_time=0.43267 
Train Epoch: 15 [313/500 20032/32000 (63%)] Loss: 0.65307 (QuantReg: 12.85304) QuantErr: 12.85304 batch_time=0.44618 
Train Epoch: 15 [321/500 20544/32000 (64%)] Loss: 1.26905 (QuantReg: 12.75195) QuantErr: 12.75195 batch_time=2.77931 
Train Epoch: 15 [329/500 21056/32000 (66%)] Loss: 0.61730 (QuantReg: 13.39691) QuantErr: 13.39691 batch_time=0.48607 
Train Epoch: 15 [337/500 21568/32000 (67%)] Loss: 0.75273 (QuantReg: 13.27314) QuantErr: 13.27314 batch_time=0.48930 
Train Epoch: 15 [345/500 22080/32000 (69%)] Loss: 1.28593 (QuantReg: 13.30246) QuantErr: 13.30246 batch_time=0.45225 
Train Epoch: 15 [353/500 22592/32000 (71%)] Loss: 1.09282 (QuantReg: 13.34250) QuantErr: 13.34250 batch_time=0.41556 
Train Epoch: 15 [361/500 23104/32000 (72%)] Loss: 0.95232 (QuantReg: 13.52363) QuantErr: 13.52363 batch_time=0.46907 
Train Epoch: 15 [369/500 23616/32000 (74%)] Loss: 0.70672 (QuantReg: 12.97189) QuantErr: 12.97189 batch_time=0.43651 
Train Epoch: 15 [377/500 24128/32000 (75%)] Loss: 0.39030 (QuantReg: 13.63157) QuantErr: 13.63157 batch_time=0.54213 
Train Epoch: 15 [385/500 24640/32000 (77%)] Loss: 0.80330 (QuantReg: 13.21806) QuantErr: 13.21806 batch_time=2.68823 
Train Epoch: 15 [393/500 25152/32000 (79%)] Loss: 1.11649 (QuantReg: 13.02175) QuantErr: 13.02175 batch_time=0.47829 
Train Epoch: 15 [401/500 25664/32000 (80%)] Loss: 1.01635 (QuantReg: 12.91210) QuantErr: 12.91210 batch_time=0.44515 
Train Epoch: 15 [409/500 26176/32000 (82%)] Loss: 0.78236 (QuantReg: 13.16945) QuantErr: 13.16945 batch_time=0.45827 
Train Epoch: 15 [417/500 26688/32000 (83%)] Loss: 0.67422 (QuantReg: 13.70138) QuantErr: 13.70138 batch_time=0.45293 
Train Epoch: 15 [425/500 27200/32000 (85%)] Loss: 0.72151 (QuantReg: 13.14009) QuantErr: 13.14009 batch_time=0.42456 
Train Epoch: 15 [433/500 27712/32000 (87%)] Loss: 1.03523 (QuantReg: 13.60340) QuantErr: 13.60340 batch_time=0.46754 
Train Epoch: 15 [441/500 28224/32000 (88%)] Loss: 0.78727 (QuantReg: 13.41782) QuantErr: 13.41782 batch_time=0.40218 
Train Epoch: 15 [449/500 28736/32000 (90%)] Loss: 0.94239 (QuantReg: 13.25877) QuantErr: 13.25877 batch_time=2.61268 
Train Epoch: 15 [457/500 29248/32000 (91%)] Loss: 1.06168 (QuantReg: 12.79374) QuantErr: 12.79374 batch_time=0.46954 
Train Epoch: 15 [465/500 29760/32000 (93%)] Loss: 0.70786 (QuantReg: 13.45196) QuantErr: 13.45196 batch_time=0.42897 
Train Epoch: 15 [473/500 30272/32000 (95%)] Loss: 1.14588 (QuantReg: 13.38036) QuantErr: 13.38036 batch_time=0.45431 
Train Epoch: 15 [481/500 30784/32000 (96%)] Loss: 0.67993 (QuantReg: 13.29033) QuantErr: 13.29033 batch_time=0.45130 
Train Epoch: 15 [489/500 31296/32000 (98%)] Loss: 0.85816 (QuantReg: 12.83290) QuantErr: 12.83290 batch_time=0.47630 
Train Epoch: 15 [497/500 31808/32000 (99%)] Loss: 1.32292 (QuantReg: 13.01019) QuantErr: 13.01019 batch_time=0.44894 
Train Epoch: 15 codebook_update_time=2.46577
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch15.pth ...
Done in 6.017s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch15.pth ...
Done in 13.557s
removing stale ckpt [epoch 14] [took 0.15s]
 epoch          : 15
 loss           : 0.8980007053613662
 quant_reg      : 13.083024652481079
 quant_err      : 13.083024652481079
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 7500
 MSRVTT_miech_test/t2v_metrics/R1: 18.7
 MSRVTT_miech_test/t2v_metrics/R5: 49.2
 MSRVTT_miech_test/t2v_metrics/R10: 62.9
 MSRVTT_miech_test/t2v_metrics/R50: 88.4
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.851
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 38.679939392483355
 MSRVTT_miech_test/v2t_metrics/R1: 19.3
 MSRVTT_miech_test/v2t_metrics/R5: 48.7
 MSRVTT_miech_test/v2t_metrics/R10: 63.4
 MSRVTT_miech_test/v2t_metrics/R50: 88.7
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.6665
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.05936477364783
 mnt_best       : 38.679939392483355
 not_improved_count: 0
Train Epoch: 16 [1/500 64/32000 (0%)] Loss: 0.89860 (QuantReg: 12.64575) QuantErr: 12.64575 batch_time=33.47264 
Train Epoch: 16 [9/500 576/32000 (2%)] Loss: 1.00038 (QuantReg: 12.99668) QuantErr: 12.99668 batch_time=0.45263 
Train Epoch: 16 [17/500 1088/32000 (3%)] Loss: 0.97247 (QuantReg: 13.52849) QuantErr: 13.52849 batch_time=0.42426 
Train Epoch: 16 [25/500 1600/32000 (5%)] Loss: 0.93998 (QuantReg: 12.65086) QuantErr: 12.65086 batch_time=0.41068 
Train Epoch: 16 [33/500 2112/32000 (7%)] Loss: 0.44293 (QuantReg: 13.37012) QuantErr: 13.37012 batch_time=0.43585 
Train Epoch: 16 [41/500 2624/32000 (8%)] Loss: 0.80341 (QuantReg: 12.88857) QuantErr: 12.88857 batch_time=0.48672 
Train Epoch: 16 [49/500 3136/32000 (10%)] Loss: 1.04160 (QuantReg: 12.85053) QuantErr: 12.85053 batch_time=0.69556 
Train Epoch: 16 [57/500 3648/32000 (11%)] Loss: 0.70562 (QuantReg: 12.90823) QuantErr: 12.90823 batch_time=0.42104 
Train Epoch: 16 [65/500 4160/32000 (13%)] Loss: 1.12869 (QuantReg: 13.47315) QuantErr: 13.47315 batch_time=2.58736 
Train Epoch: 16 [73/500 4672/32000 (15%)] Loss: 0.60124 (QuantReg: 13.34459) QuantErr: 13.34459 batch_time=0.48283 
Train Epoch: 16 [81/500 5184/32000 (16%)] Loss: 1.09156 (QuantReg: 12.92468) QuantErr: 12.92468 batch_time=0.43299 
Train Epoch: 16 [89/500 5696/32000 (18%)] Loss: 0.88237 (QuantReg: 13.11733) QuantErr: 13.11733 batch_time=0.51906 
Train Epoch: 16 [97/500 6208/32000 (19%)] Loss: 0.84269 (QuantReg: 13.65426) QuantErr: 13.65426 batch_time=0.42289 
Train Epoch: 16 [105/500 6720/32000 (21%)] Loss: 1.14712 (QuantReg: 12.90546) QuantErr: 12.90546 batch_time=0.40996 
Train Epoch: 16 [113/500 7232/32000 (23%)] Loss: 0.81982 (QuantReg: 13.41194) QuantErr: 13.41194 batch_time=0.56752 
Train Epoch: 16 [121/500 7744/32000 (24%)] Loss: 0.80603 (QuantReg: 12.70198) QuantErr: 12.70198 batch_time=0.43332 
Train Epoch: 16 [129/500 8256/32000 (26%)] Loss: 1.05236 (QuantReg: 12.89282) QuantErr: 12.89282 batch_time=3.02953 
Train Epoch: 16 [137/500 8768/32000 (27%)] Loss: 0.94261 (QuantReg: 13.25672) QuantErr: 13.25672 batch_time=0.42109 
Train Epoch: 16 [145/500 9280/32000 (29%)] Loss: 1.21498 (QuantReg: 13.29375) QuantErr: 13.29375 batch_time=0.40149 
Train Epoch: 16 [153/500 9792/32000 (31%)] Loss: 1.13789 (QuantReg: 12.99316) QuantErr: 12.99316 batch_time=0.50895 
Train Epoch: 16 [161/500 10304/32000 (32%)] Loss: 0.88591 (QuantReg: 12.76293) QuantErr: 12.76293 batch_time=0.50187 
Train Epoch: 16 [169/500 10816/32000 (34%)] Loss: 0.90230 (QuantReg: 13.28878) QuantErr: 13.28878 batch_time=0.44861 
Train Epoch: 16 [177/500 11328/32000 (35%)] Loss: 0.99585 (QuantReg: 12.74897) QuantErr: 12.74897 batch_time=0.57547 
Train Epoch: 16 [185/500 11840/32000 (37%)] Loss: 1.10360 (QuantReg: 12.87703) QuantErr: 12.87703 batch_time=0.52569 
Train Epoch: 16 [193/500 12352/32000 (39%)] Loss: 0.68871 (QuantReg: 12.91237) QuantErr: 12.91237 batch_time=2.76165 
Train Epoch: 16 [201/500 12864/32000 (40%)] Loss: 0.67954 (QuantReg: 12.91023) QuantErr: 12.91023 batch_time=0.49268 
Train Epoch: 16 [209/500 13376/32000 (42%)] Loss: 0.88110 (QuantReg: 13.06530) QuantErr: 13.06530 batch_time=0.40850 
Train Epoch: 16 [217/500 13888/32000 (43%)] Loss: 1.02239 (QuantReg: 12.81669) QuantErr: 12.81669 batch_time=0.48914 
Train Epoch: 16 [225/500 14400/32000 (45%)] Loss: 1.02367 (QuantReg: 13.33784) QuantErr: 13.33784 batch_time=0.51081 
Train Epoch: 16 [233/500 14912/32000 (47%)] Loss: 0.61417 (QuantReg: 13.26457) QuantErr: 13.26457 batch_time=0.50775 
Train Epoch: 16 [241/500 15424/32000 (48%)] Loss: 0.77409 (QuantReg: 13.19187) QuantErr: 13.19187 batch_time=0.61246 
Train Epoch: 16 [249/500 15936/32000 (50%)] Loss: 0.98301 (QuantReg: 12.84190) QuantErr: 12.84190 batch_time=0.42298 
Train Epoch: 16 [257/500 16448/32000 (51%)] Loss: 1.02758 (QuantReg: 12.35991) QuantErr: 12.35991 batch_time=2.59668 
Train Epoch: 16 [265/500 16960/32000 (53%)] Loss: 1.10393 (QuantReg: 12.95922) QuantErr: 12.95922 batch_time=0.51378 
Train Epoch: 16 [273/500 17472/32000 (55%)] Loss: 0.66659 (QuantReg: 13.02361) QuantErr: 13.02361 batch_time=0.54288 
Train Epoch: 16 [281/500 17984/32000 (56%)] Loss: 0.51888 (QuantReg: 12.83852) QuantErr: 12.83852 batch_time=0.49766 
Train Epoch: 16 [289/500 18496/32000 (58%)] Loss: 0.92044 (QuantReg: 12.75034) QuantErr: 12.75034 batch_time=0.45961 
Train Epoch: 16 [297/500 19008/32000 (59%)] Loss: 0.75376 (QuantReg: 13.24139) QuantErr: 13.24139 batch_time=0.47116 
Train Epoch: 16 [305/500 19520/32000 (61%)] Loss: 0.70170 (QuantReg: 13.23041) QuantErr: 13.23041 batch_time=0.60685 
Train Epoch: 16 [313/500 20032/32000 (63%)] Loss: 0.91458 (QuantReg: 12.83715) QuantErr: 12.83715 batch_time=0.44528 
Train Epoch: 16 [321/500 20544/32000 (64%)] Loss: 0.65864 (QuantReg: 13.32902) QuantErr: 13.32902 batch_time=2.67239 
Train Epoch: 16 [329/500 21056/32000 (66%)] Loss: 0.99577 (QuantReg: 13.20921) QuantErr: 13.20921 batch_time=0.43523 
Train Epoch: 16 [337/500 21568/32000 (67%)] Loss: 0.87163 (QuantReg: 13.20536) QuantErr: 13.20536 batch_time=0.45581 
Train Epoch: 16 [345/500 22080/32000 (69%)] Loss: 1.13809 (QuantReg: 12.97138) QuantErr: 12.97138 batch_time=0.49071 
Train Epoch: 16 [353/500 22592/32000 (71%)] Loss: 0.65174 (QuantReg: 13.56782) QuantErr: 13.56782 batch_time=0.47991 
Train Epoch: 16 [361/500 23104/32000 (72%)] Loss: 0.78154 (QuantReg: 13.23812) QuantErr: 13.23812 batch_time=0.46160 
Train Epoch: 16 [369/500 23616/32000 (74%)] Loss: 0.84857 (QuantReg: 12.50941) QuantErr: 12.50941 batch_time=0.61320 
Train Epoch: 16 [377/500 24128/32000 (75%)] Loss: 0.93273 (QuantReg: 12.95117) QuantErr: 12.95117 batch_time=0.41727 
Train Epoch: 16 [385/500 24640/32000 (77%)] Loss: 0.75101 (QuantReg: 13.03803) QuantErr: 13.03803 batch_time=2.55631 
Train Epoch: 16 [393/500 25152/32000 (79%)] Loss: 1.00082 (QuantReg: 13.14654) QuantErr: 13.14654 batch_time=0.49610 
Train Epoch: 16 [401/500 25664/32000 (80%)] Loss: 0.85493 (QuantReg: 12.67389) QuantErr: 12.67389 batch_time=0.50597 
Train Epoch: 16 [409/500 26176/32000 (82%)] Loss: 0.95044 (QuantReg: 13.10405) QuantErr: 13.10405 batch_time=0.40891 
Train Epoch: 16 [417/500 26688/32000 (83%)] Loss: 0.68459 (QuantReg: 13.23144) QuantErr: 13.23144 batch_time=0.40142 
Train Epoch: 16 [425/500 27200/32000 (85%)] Loss: 0.66045 (QuantReg: 13.31787) QuantErr: 13.31787 batch_time=0.39196 
Train Epoch: 16 [433/500 27712/32000 (87%)] Loss: 0.51151 (QuantReg: 13.50995) QuantErr: 13.50995 batch_time=0.55025 
Train Epoch: 16 [441/500 28224/32000 (88%)] Loss: 0.72828 (QuantReg: 12.89717) QuantErr: 12.89717 batch_time=0.54117 
Train Epoch: 16 [449/500 28736/32000 (90%)] Loss: 0.74349 (QuantReg: 13.30242) QuantErr: 13.30242 batch_time=2.66228 
Train Epoch: 16 [457/500 29248/32000 (91%)] Loss: 0.52792 (QuantReg: 13.44454) QuantErr: 13.44454 batch_time=0.48223 
Train Epoch: 16 [465/500 29760/32000 (93%)] Loss: 0.55441 (QuantReg: 13.16803) QuantErr: 13.16803 batch_time=0.46946 
Train Epoch: 16 [473/500 30272/32000 (95%)] Loss: 0.62358 (QuantReg: 12.97784) QuantErr: 12.97784 batch_time=0.44120 
Train Epoch: 16 [481/500 30784/32000 (96%)] Loss: 0.42771 (QuantReg: 13.08080) QuantErr: 13.08080 batch_time=0.43803 
Train Epoch: 16 [489/500 31296/32000 (98%)] Loss: 0.59923 (QuantReg: 13.31944) QuantErr: 13.31944 batch_time=0.45091 
Train Epoch: 16 [497/500 31808/32000 (99%)] Loss: 0.46857 (QuantReg: 13.30824) QuantErr: 13.30824 batch_time=0.62318 
Train Epoch: 16 codebook_update_time=2.36793
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch16.pth ...
Done in 5.330s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch16.pth ...
Done in 11.705s
removing stale ckpt [epoch 15] [took 0.01s]
 epoch          : 16
 loss           : 0.8700474122166634
 quant_reg      : 13.058731184005737
 quant_err      : 13.058731184005737
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 8000
 MSRVTT_miech_test/t2v_metrics/R1: 19.7
 MSRVTT_miech_test/t2v_metrics/R5: 48.5
 MSRVTT_miech_test/t2v_metrics/R10: 61.0
 MSRVTT_miech_test/t2v_metrics/R50: 87.1
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.547
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 38.7714996889472
 MSRVTT_miech_test/v2t_metrics/R1: 19.3
 MSRVTT_miech_test/v2t_metrics/R5: 48.4
 MSRVTT_miech_test/v2t_metrics/R10: 63.0
 MSRVTT_miech_test/v2t_metrics/R50: 88.9
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.482
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.89684772556416
 mnt_best       : 38.7714996889472
 not_improved_count: 0
Train Epoch: 17 [1/500 64/32000 (0%)] Loss: 0.90590 (QuantReg: 12.77310) QuantErr: 12.77310 batch_time=30.79632 
Train Epoch: 17 [9/500 576/32000 (2%)] Loss: 0.87590 (QuantReg: 13.58001) QuantErr: 13.58001 batch_time=0.48542 
Train Epoch: 17 [17/500 1088/32000 (3%)] Loss: 0.97943 (QuantReg: 13.27260) QuantErr: 13.27260 batch_time=0.53964 
Train Epoch: 17 [25/500 1600/32000 (5%)] Loss: 0.59885 (QuantReg: 12.58565) QuantErr: 12.58565 batch_time=0.89120 
Train Epoch: 17 [33/500 2112/32000 (7%)] Loss: 0.77119 (QuantReg: 12.97705) QuantErr: 12.97705 batch_time=0.47664 
Train Epoch: 17 [41/500 2624/32000 (8%)] Loss: 0.92147 (QuantReg: 12.73737) QuantErr: 12.73737 batch_time=0.46522 
Train Epoch: 17 [49/500 3136/32000 (10%)] Loss: 0.51969 (QuantReg: 13.71320) QuantErr: 13.71320 batch_time=0.46475 
Train Epoch: 17 [57/500 3648/32000 (11%)] Loss: 0.75933 (QuantReg: 12.81779) QuantErr: 12.81779 batch_time=0.49861 
Train Epoch: 17 [65/500 4160/32000 (13%)] Loss: 0.90475 (QuantReg: 13.19545) QuantErr: 13.19545 batch_time=0.91603 
Train Epoch: 17 [73/500 4672/32000 (15%)] Loss: 0.60027 (QuantReg: 13.17269) QuantErr: 13.17269 batch_time=0.44668 
Train Epoch: 17 [81/500 5184/32000 (16%)] Loss: 0.65218 (QuantReg: 13.27295) QuantErr: 13.27295 batch_time=0.54754 
Train Epoch: 17 [89/500 5696/32000 (18%)] Loss: 0.99404 (QuantReg: 12.76319) QuantErr: 12.76319 batch_time=0.81484 
Train Epoch: 17 [97/500 6208/32000 (19%)] Loss: 0.65832 (QuantReg: 12.96885) QuantErr: 12.96885 batch_time=0.41637 
Train Epoch: 17 [105/500 6720/32000 (21%)] Loss: 0.48097 (QuantReg: 13.38439) QuantErr: 13.38439 batch_time=0.40581 
Train Epoch: 17 [113/500 7232/32000 (23%)] Loss: 1.17783 (QuantReg: 13.06449) QuantErr: 13.06449 batch_time=0.42464 
Train Epoch: 17 [121/500 7744/32000 (24%)] Loss: 1.14111 (QuantReg: 12.38529) QuantErr: 12.38529 batch_time=0.44587 
Train Epoch: 17 [129/500 8256/32000 (26%)] Loss: 0.64136 (QuantReg: 13.50764) QuantErr: 13.50764 batch_time=0.85427 
Train Epoch: 17 [137/500 8768/32000 (27%)] Loss: 0.77437 (QuantReg: 13.59636) QuantErr: 13.59636 batch_time=0.50919 
Train Epoch: 17 [145/500 9280/32000 (29%)] Loss: 0.93891 (QuantReg: 13.10449) QuantErr: 13.10449 batch_time=0.54035 
Train Epoch: 17 [153/500 9792/32000 (31%)] Loss: 0.94062 (QuantReg: 12.77714) QuantErr: 12.77714 batch_time=0.89133 
Train Epoch: 17 [161/500 10304/32000 (32%)] Loss: 0.93723 (QuantReg: 12.71705) QuantErr: 12.71705 batch_time=0.46199 
Train Epoch: 17 [169/500 10816/32000 (34%)] Loss: 1.53512 (QuantReg: 13.24524) QuantErr: 13.24524 batch_time=0.53727 
Train Epoch: 17 [177/500 11328/32000 (35%)] Loss: 0.84010 (QuantReg: 12.94001) QuantErr: 12.94001 batch_time=0.51251 
Train Epoch: 17 [185/500 11840/32000 (37%)] Loss: 0.74708 (QuantReg: 13.18734) QuantErr: 13.18734 batch_time=0.47767 
Train Epoch: 17 [193/500 12352/32000 (39%)] Loss: 0.85160 (QuantReg: 13.15342) QuantErr: 13.15342 batch_time=1.01485 
Train Epoch: 17 [201/500 12864/32000 (40%)] Loss: 0.94299 (QuantReg: 13.11184) QuantErr: 13.11184 batch_time=0.45989 
Train Epoch: 17 [209/500 13376/32000 (42%)] Loss: 0.80053 (QuantReg: 13.03396) QuantErr: 13.03396 batch_time=0.50691 
Train Epoch: 17 [217/500 13888/32000 (43%)] Loss: 0.51708 (QuantReg: 13.15468) QuantErr: 13.15468 batch_time=0.85849 
Train Epoch: 17 [225/500 14400/32000 (45%)] Loss: 0.80375 (QuantReg: 13.51626) QuantErr: 13.51626 batch_time=0.47895 
Train Epoch: 17 [233/500 14912/32000 (47%)] Loss: 0.71328 (QuantReg: 13.05875) QuantErr: 13.05875 batch_time=0.45134 
Train Epoch: 17 [241/500 15424/32000 (48%)] Loss: 1.00402 (QuantReg: 13.14157) QuantErr: 13.14157 batch_time=0.45902 
Train Epoch: 17 [249/500 15936/32000 (50%)] Loss: 0.78315 (QuantReg: 13.09212) QuantErr: 13.09212 batch_time=0.49250 
Train Epoch: 17 [257/500 16448/32000 (51%)] Loss: 0.64999 (QuantReg: 13.32256) QuantErr: 13.32256 batch_time=0.83595 
Train Epoch: 17 [265/500 16960/32000 (53%)] Loss: 0.86008 (QuantReg: 13.02359) QuantErr: 13.02359 batch_time=0.49790 
Train Epoch: 17 [273/500 17472/32000 (55%)] Loss: 0.78879 (QuantReg: 13.29045) QuantErr: 13.29045 batch_time=0.52931 
Train Epoch: 17 [281/500 17984/32000 (56%)] Loss: 0.76943 (QuantReg: 13.57016) QuantErr: 13.57016 batch_time=0.91444 
Train Epoch: 17 [289/500 18496/32000 (58%)] Loss: 0.85199 (QuantReg: 12.98308) QuantErr: 12.98308 batch_time=0.49644 
Train Epoch: 17 [297/500 19008/32000 (59%)] Loss: 1.06985 (QuantReg: 13.39838) QuantErr: 13.39838 batch_time=0.49878 
Train Epoch: 17 [305/500 19520/32000 (61%)] Loss: 0.81345 (QuantReg: 13.13957) QuantErr: 13.13957 batch_time=0.45616 
Train Epoch: 17 [313/500 20032/32000 (63%)] Loss: 0.69216 (QuantReg: 13.24508) QuantErr: 13.24508 batch_time=0.47991 
Train Epoch: 17 [321/500 20544/32000 (64%)] Loss: 0.89789 (QuantReg: 13.27712) QuantErr: 13.27712 batch_time=0.94574 
Train Epoch: 17 [329/500 21056/32000 (66%)] Loss: 0.59686 (QuantReg: 13.07845) QuantErr: 13.07845 batch_time=0.48944 
Train Epoch: 17 [337/500 21568/32000 (67%)] Loss: 0.79597 (QuantReg: 13.77013) QuantErr: 13.77013 batch_time=0.50333 
Train Epoch: 17 [345/500 22080/32000 (69%)] Loss: 0.97962 (QuantReg: 12.73368) QuantErr: 12.73368 batch_time=0.74986 
Train Epoch: 17 [353/500 22592/32000 (71%)] Loss: 0.74142 (QuantReg: 13.10645) QuantErr: 13.10645 batch_time=0.44865 
Train Epoch: 17 [361/500 23104/32000 (72%)] Loss: 0.60635 (QuantReg: 13.18105) QuantErr: 13.18105 batch_time=0.46882 
Train Epoch: 17 [369/500 23616/32000 (74%)] Loss: 0.40070 (QuantReg: 13.39053) QuantErr: 13.39053 batch_time=0.50179 
Train Epoch: 17 [377/500 24128/32000 (75%)] Loss: 0.70114 (QuantReg: 13.42231) QuantErr: 13.42231 batch_time=0.46580 
Train Epoch: 17 [385/500 24640/32000 (77%)] Loss: 0.73405 (QuantReg: 13.06259) QuantErr: 13.06259 batch_time=0.94220 
Train Epoch: 17 [393/500 25152/32000 (79%)] Loss: 0.96233 (QuantReg: 13.31560) QuantErr: 13.31560 batch_time=0.54847 
Train Epoch: 17 [401/500 25664/32000 (80%)] Loss: 0.39970 (QuantReg: 13.51686) QuantErr: 13.51686 batch_time=0.60077 
Train Epoch: 17 [409/500 26176/32000 (82%)] Loss: 1.19844 (QuantReg: 13.13029) QuantErr: 13.13029 batch_time=0.83415 
Train Epoch: 17 [417/500 26688/32000 (83%)] Loss: 0.67545 (QuantReg: 13.34500) QuantErr: 13.34500 batch_time=0.41064 
Train Epoch: 17 [425/500 27200/32000 (85%)] Loss: 1.05139 (QuantReg: 13.30334) QuantErr: 13.30334 batch_time=0.42284 
Train Epoch: 17 [433/500 27712/32000 (87%)] Loss: 0.67104 (QuantReg: 13.35859) QuantErr: 13.35859 batch_time=0.41440 
Train Epoch: 17 [441/500 28224/32000 (88%)] Loss: 1.00376 (QuantReg: 13.06744) QuantErr: 13.06744 batch_time=0.44787 
Train Epoch: 17 [449/500 28736/32000 (90%)] Loss: 0.64761 (QuantReg: 13.10907) QuantErr: 13.10907 batch_time=0.85844 
Train Epoch: 17 [457/500 29248/32000 (91%)] Loss: 0.68584 (QuantReg: 13.57132) QuantErr: 13.57132 batch_time=0.41433 
Train Epoch: 17 [465/500 29760/32000 (93%)] Loss: 0.77664 (QuantReg: 12.94170) QuantErr: 12.94170 batch_time=0.51737 
Train Epoch: 17 [473/500 30272/32000 (95%)] Loss: 0.55071 (QuantReg: 13.35476) QuantErr: 13.35476 batch_time=0.77751 
Train Epoch: 17 [481/500 30784/32000 (96%)] Loss: 0.73505 (QuantReg: 13.55037) QuantErr: 13.55037 batch_time=0.44547 
Train Epoch: 17 [489/500 31296/32000 (98%)] Loss: 0.79790 (QuantReg: 13.33349) QuantErr: 13.33349 batch_time=0.50210 
Train Epoch: 17 [497/500 31808/32000 (99%)] Loss: 0.93763 (QuantReg: 13.30964) QuantErr: 13.30964 batch_time=0.50547 
Train Epoch: 17 codebook_update_time=2.64999
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch17.pth ...
Done in 5.503s
removing stale ckpt [epoch 16] [took 0.01s]
 epoch          : 17
 loss           : 0.8431238940358162
 quant_reg      : 13.128494577407837
 quant_err      : 13.128494577407837
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 8500
 MSRVTT_miech_test/t2v_metrics/R1: 19.8
 MSRVTT_miech_test/t2v_metrics/R5: 48.1
 MSRVTT_miech_test/t2v_metrics/R10: 61.1
 MSRVTT_miech_test/t2v_metrics/R50: 86.9
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.271
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 38.75108131564602
 MSRVTT_miech_test/v2t_metrics/R1: 20.3
 MSRVTT_miech_test/v2t_metrics/R5: 49.9
 MSRVTT_miech_test/v2t_metrics/R10: 63.1
 MSRVTT_miech_test/v2t_metrics/R50: 88.9
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.5615
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.9829942294521
 mnt_best       : 38.7714996889472
 not_improved_count: 1
Train Epoch: 18 [1/500 64/32000 (0%)] Loss: 0.91517 (QuantReg: 12.47212) QuantErr: 12.47212 batch_time=30.46303 
Train Epoch: 18 [9/500 576/32000 (2%)] Loss: 0.62636 (QuantReg: 12.85372) QuantErr: 12.85372 batch_time=0.42476 
Train Epoch: 18 [17/500 1088/32000 (3%)] Loss: 0.97570 (QuantReg: 13.25797) QuantErr: 13.25797 batch_time=0.51131 
Train Epoch: 18 [25/500 1600/32000 (5%)] Loss: 0.88318 (QuantReg: 13.40717) QuantErr: 13.40717 batch_time=0.56848 
Train Epoch: 18 [33/500 2112/32000 (7%)] Loss: 0.56566 (QuantReg: 13.22968) QuantErr: 13.22968 batch_time=0.40388 
Train Epoch: 18 [41/500 2624/32000 (8%)] Loss: 0.68778 (QuantReg: 13.36404) QuantErr: 13.36404 batch_time=0.41072 
Train Epoch: 18 [49/500 3136/32000 (10%)] Loss: 1.09323 (QuantReg: 12.95541) QuantErr: 12.95541 batch_time=0.46921 
Train Epoch: 18 [57/500 3648/32000 (11%)] Loss: 0.52170 (QuantReg: 13.49966) QuantErr: 13.49966 batch_time=0.46384 
Train Epoch: 18 [65/500 4160/32000 (13%)] Loss: 1.08121 (QuantReg: 12.74383) QuantErr: 12.74383 batch_time=0.64896 
Train Epoch: 18 [73/500 4672/32000 (15%)] Loss: 0.68424 (QuantReg: 13.29302) QuantErr: 13.29302 batch_time=0.43406 
Train Epoch: 18 [81/500 5184/32000 (16%)] Loss: 1.12578 (QuantReg: 13.00060) QuantErr: 13.00060 batch_time=0.48198 
Train Epoch: 18 [89/500 5696/32000 (18%)] Loss: 0.93780 (QuantReg: 13.52600) QuantErr: 13.52600 batch_time=0.45948 
Train Epoch: 18 [97/500 6208/32000 (19%)] Loss: 0.85848 (QuantReg: 13.19880) QuantErr: 13.19880 batch_time=0.43392 
Train Epoch: 18 [105/500 6720/32000 (21%)] Loss: 0.92971 (QuantReg: 13.09319) QuantErr: 13.09319 batch_time=0.50954 
Train Epoch: 18 [113/500 7232/32000 (23%)] Loss: 0.77396 (QuantReg: 13.02355) QuantErr: 13.02355 batch_time=0.45863 
Train Epoch: 18 [121/500 7744/32000 (24%)] Loss: 0.85203 (QuantReg: 12.77597) QuantErr: 12.77597 batch_time=0.47857 
Train Epoch: 18 [129/500 8256/32000 (26%)] Loss: 0.97272 (QuantReg: 13.51207) QuantErr: 13.51207 batch_time=0.67872 
Train Epoch: 18 [137/500 8768/32000 (27%)] Loss: 0.80549 (QuantReg: 13.23816) QuantErr: 13.23816 batch_time=0.46079 
Train Epoch: 18 [145/500 9280/32000 (29%)] Loss: 0.80252 (QuantReg: 13.57228) QuantErr: 13.57228 batch_time=0.46862 
Train Epoch: 18 [153/500 9792/32000 (31%)] Loss: 0.65490 (QuantReg: 12.81802) QuantErr: 12.81802 batch_time=0.42242 
Train Epoch: 18 [161/500 10304/32000 (32%)] Loss: 0.82940 (QuantReg: 12.57314) QuantErr: 12.57314 batch_time=0.41821 
Train Epoch: 18 [169/500 10816/32000 (34%)] Loss: 0.58107 (QuantReg: 13.18650) QuantErr: 13.18650 batch_time=0.42484 
Train Epoch: 18 [177/500 11328/32000 (35%)] Loss: 1.09117 (QuantReg: 13.51698) QuantErr: 13.51698 batch_time=0.44541 
Train Epoch: 18 [185/500 11840/32000 (37%)] Loss: 0.61151 (QuantReg: 13.13000) QuantErr: 13.13000 batch_time=0.43318 
Train Epoch: 18 [193/500 12352/32000 (39%)] Loss: 0.60349 (QuantReg: 13.63006) QuantErr: 13.63006 batch_time=0.62369 
Train Epoch: 18 [201/500 12864/32000 (40%)] Loss: 0.84304 (QuantReg: 13.05233) QuantErr: 13.05233 batch_time=0.48323 
Train Epoch: 18 [209/500 13376/32000 (42%)] Loss: 0.87394 (QuantReg: 12.79184) QuantErr: 12.79184 batch_time=0.45542 
Train Epoch: 18 [217/500 13888/32000 (43%)] Loss: 0.55506 (QuantReg: 13.10740) QuantErr: 13.10740 batch_time=0.45503 
Train Epoch: 18 [225/500 14400/32000 (45%)] Loss: 0.76335 (QuantReg: 12.89220) QuantErr: 12.89220 batch_time=0.43897 
Train Epoch: 18 [233/500 14912/32000 (47%)] Loss: 0.64449 (QuantReg: 13.51891) QuantErr: 13.51891 batch_time=0.48918 
Train Epoch: 18 [241/500 15424/32000 (48%)] Loss: 0.83252 (QuantReg: 12.96540) QuantErr: 12.96540 batch_time=0.47125 
Train Epoch: 18 [249/500 15936/32000 (50%)] Loss: 0.69590 (QuantReg: 13.22929) QuantErr: 13.22929 batch_time=0.46917 
Train Epoch: 18 [257/500 16448/32000 (51%)] Loss: 0.62825 (QuantReg: 13.34142) QuantErr: 13.34142 batch_time=0.59584 
Train Epoch: 18 [265/500 16960/32000 (53%)] Loss: 0.67787 (QuantReg: 13.32274) QuantErr: 13.32274 batch_time=0.44704 
Train Epoch: 18 [273/500 17472/32000 (55%)] Loss: 1.04003 (QuantReg: 12.81571) QuantErr: 12.81571 batch_time=0.45614 
Train Epoch: 18 [281/500 17984/32000 (56%)] Loss: 0.75777 (QuantReg: 13.37198) QuantErr: 13.37198 batch_time=0.50268 
Train Epoch: 18 [289/500 18496/32000 (58%)] Loss: 0.84743 (QuantReg: 13.35645) QuantErr: 13.35645 batch_time=0.44974 
Train Epoch: 18 [297/500 19008/32000 (59%)] Loss: 0.80801 (QuantReg: 13.75308) QuantErr: 13.75308 batch_time=0.47982 
Train Epoch: 18 [305/500 19520/32000 (61%)] Loss: 0.59614 (QuantReg: 13.73725) QuantErr: 13.73725 batch_time=0.48857 
Train Epoch: 18 [313/500 20032/32000 (63%)] Loss: 0.75963 (QuantReg: 13.33710) QuantErr: 13.33710 batch_time=0.54065 
Train Epoch: 18 [321/500 20544/32000 (64%)] Loss: 0.71903 (QuantReg: 13.43658) QuantErr: 13.43658 batch_time=0.67732 
Train Epoch: 18 [329/500 21056/32000 (66%)] Loss: 0.88374 (QuantReg: 13.26371) QuantErr: 13.26371 batch_time=0.46104 
Train Epoch: 18 [337/500 21568/32000 (67%)] Loss: 0.50107 (QuantReg: 13.43468) QuantErr: 13.43468 batch_time=0.44157 
Train Epoch: 18 [345/500 22080/32000 (69%)] Loss: 0.81565 (QuantReg: 13.73755) QuantErr: 13.73755 batch_time=0.52953 
Train Epoch: 18 [353/500 22592/32000 (71%)] Loss: 0.42062 (QuantReg: 13.35958) QuantErr: 13.35958 batch_time=0.46103 
Train Epoch: 18 [361/500 23104/32000 (72%)] Loss: 0.73223 (QuantReg: 12.80624) QuantErr: 12.80624 batch_time=0.47662 
Train Epoch: 18 [369/500 23616/32000 (74%)] Loss: 0.65888 (QuantReg: 13.04177) QuantErr: 13.04177 batch_time=0.50733 
Train Epoch: 18 [377/500 24128/32000 (75%)] Loss: 1.59637 (QuantReg: 13.07261) QuantErr: 13.07261 batch_time=0.44174 
Train Epoch: 18 [385/500 24640/32000 (77%)] Loss: 0.83017 (QuantReg: 13.49435) QuantErr: 13.49435 batch_time=0.68134 
Train Epoch: 18 [393/500 25152/32000 (79%)] Loss: 0.68059 (QuantReg: 13.25393) QuantErr: 13.25393 batch_time=0.41564 
Train Epoch: 18 [401/500 25664/32000 (80%)] Loss: 0.80314 (QuantReg: 13.14653) QuantErr: 13.14653 batch_time=0.40441 
Train Epoch: 18 [409/500 26176/32000 (82%)] Loss: 1.02962 (QuantReg: 13.70469) QuantErr: 13.70469 batch_time=0.50189 
Train Epoch: 18 [417/500 26688/32000 (83%)] Loss: 0.73361 (QuantReg: 13.22208) QuantErr: 13.22208 batch_time=0.45807 
Train Epoch: 18 [425/500 27200/32000 (85%)] Loss: 0.94310 (QuantReg: 13.51870) QuantErr: 13.51870 batch_time=0.45522 
Train Epoch: 18 [433/500 27712/32000 (87%)] Loss: 0.81135 (QuantReg: 13.52539) QuantErr: 13.52539 batch_time=0.54104 
Train Epoch: 18 [441/500 28224/32000 (88%)] Loss: 0.56405 (QuantReg: 13.37399) QuantErr: 13.37399 batch_time=0.48558 
Train Epoch: 18 [449/500 28736/32000 (90%)] Loss: 0.88926 (QuantReg: 13.78507) QuantErr: 13.78507 batch_time=0.77871 
Train Epoch: 18 [457/500 29248/32000 (91%)] Loss: 1.15025 (QuantReg: 13.32253) QuantErr: 13.32253 batch_time=0.41318 
Train Epoch: 18 [465/500 29760/32000 (93%)] Loss: 0.62514 (QuantReg: 13.93472) QuantErr: 13.93472 batch_time=0.41286 
Train Epoch: 18 [473/500 30272/32000 (95%)] Loss: 0.67761 (QuantReg: 13.49186) QuantErr: 13.49186 batch_time=0.39854 
Train Epoch: 18 [481/500 30784/32000 (96%)] Loss: 0.83631 (QuantReg: 13.29907) QuantErr: 13.29907 batch_time=0.41456 
Train Epoch: 18 [489/500 31296/32000 (98%)] Loss: 1.10654 (QuantReg: 12.86980) QuantErr: 12.86980 batch_time=0.42454 
Train Epoch: 18 [497/500 31808/32000 (99%)] Loss: 0.82053 (QuantReg: 13.10168) QuantErr: 13.10168 batch_time=0.45047 
Train Epoch: 18 codebook_update_time=2.85790
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch18.pth ...
Done in 5.734s
removing stale ckpt [epoch 17] [took 0.36s]
 epoch          : 18
 loss           : 0.825077929675579
 quant_reg      : 13.174016910552979
 quant_err      : 13.174016910552979
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 9000
 MSRVTT_miech_test/t2v_metrics/R1: 19.0
 MSRVTT_miech_test/t2v_metrics/R5: 48.8
 MSRVTT_miech_test/t2v_metrics/R10: 62.8
 MSRVTT_miech_test/t2v_metrics/R50: 88.2
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.062
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 38.75945742105909
 MSRVTT_miech_test/v2t_metrics/R1: 20.4
 MSRVTT_miech_test/v2t_metrics/R5: 49.3
 MSRVTT_miech_test/v2t_metrics/R10: 62.4
 MSRVTT_miech_test/v2t_metrics/R50: 89.9
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.027
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.739331657017644
 mnt_best       : 38.7714996889472
 not_improved_count: 2
Train Epoch: 19 [1/500 64/32000 (0%)] Loss: 0.95112 (QuantReg: 12.51599) QuantErr: 12.51599 batch_time=33.77118 
Train Epoch: 19 [9/500 576/32000 (2%)] Loss: 0.80894 (QuantReg: 12.98112) QuantErr: 12.98112 batch_time=0.44617 
Train Epoch: 19 [17/500 1088/32000 (3%)] Loss: 0.59791 (QuantReg: 13.14462) QuantErr: 13.14462 batch_time=0.44310 
Train Epoch: 19 [25/500 1600/32000 (5%)] Loss: 0.59038 (QuantReg: 13.18132) QuantErr: 13.18132 batch_time=0.45336 
Train Epoch: 19 [33/500 2112/32000 (7%)] Loss: 0.73666 (QuantReg: 13.30569) QuantErr: 13.30569 batch_time=0.50045 
Train Epoch: 19 [41/500 2624/32000 (8%)] Loss: 0.87220 (QuantReg: 12.74417) QuantErr: 12.74417 batch_time=0.48685 
Train Epoch: 19 [49/500 3136/32000 (10%)] Loss: 0.62244 (QuantReg: 13.13406) QuantErr: 13.13406 batch_time=0.47494 
Train Epoch: 19 [57/500 3648/32000 (11%)] Loss: 0.94433 (QuantReg: 13.18622) QuantErr: 13.18622 batch_time=0.47214 
Train Epoch: 19 [65/500 4160/32000 (13%)] Loss: 1.14432 (QuantReg: 13.17899) QuantErr: 13.17899 batch_time=1.88331 
Train Epoch: 19 [73/500 4672/32000 (15%)] Loss: 1.14039 (QuantReg: 13.06836) QuantErr: 13.06836 batch_time=0.47072 
Train Epoch: 19 [81/500 5184/32000 (16%)] Loss: 0.93386 (QuantReg: 12.91275) QuantErr: 12.91275 batch_time=0.46871 
Train Epoch: 19 [89/500 5696/32000 (18%)] Loss: 1.05988 (QuantReg: 13.13169) QuantErr: 13.13169 batch_time=0.43290 
Train Epoch: 19 [97/500 6208/32000 (19%)] Loss: 0.82558 (QuantReg: 12.99182) QuantErr: 12.99182 batch_time=0.53607 
Train Epoch: 19 [105/500 6720/32000 (21%)] Loss: 0.59137 (QuantReg: 13.50264) QuantErr: 13.50264 batch_time=0.44329 
Train Epoch: 19 [113/500 7232/32000 (23%)] Loss: 0.81850 (QuantReg: 13.36909) QuantErr: 13.36909 batch_time=0.45707 
Train Epoch: 19 [121/500 7744/32000 (24%)] Loss: 0.52458 (QuantReg: 13.34728) QuantErr: 13.34728 batch_time=0.46234 
Train Epoch: 19 [129/500 8256/32000 (26%)] Loss: 0.62408 (QuantReg: 13.13247) QuantErr: 13.13247 batch_time=1.85089 
Train Epoch: 19 [137/500 8768/32000 (27%)] Loss: 1.02764 (QuantReg: 13.17858) QuantErr: 13.17858 batch_time=0.46812 
Train Epoch: 19 [145/500 9280/32000 (29%)] Loss: 0.59256 (QuantReg: 13.12125) QuantErr: 13.12125 batch_time=0.56768 
Train Epoch: 19 [153/500 9792/32000 (31%)] Loss: 0.97236 (QuantReg: 13.57150) QuantErr: 13.57150 batch_time=0.46560 
Train Epoch: 19 [161/500 10304/32000 (32%)] Loss: 0.58878 (QuantReg: 13.25176) QuantErr: 13.25176 batch_time=0.55990 
Train Epoch: 19 [169/500 10816/32000 (34%)] Loss: 1.02869 (QuantReg: 12.68027) QuantErr: 12.68027 batch_time=0.47376 
Train Epoch: 19 [177/500 11328/32000 (35%)] Loss: 0.95914 (QuantReg: 13.29790) QuantErr: 13.29790 batch_time=0.42900 
Train Epoch: 19 [185/500 11840/32000 (37%)] Loss: 0.51508 (QuantReg: 13.12745) QuantErr: 13.12745 batch_time=0.48285 
Train Epoch: 19 [193/500 12352/32000 (39%)] Loss: 0.62225 (QuantReg: 13.15013) QuantErr: 13.15013 batch_time=2.01947 
Train Epoch: 19 [201/500 12864/32000 (40%)] Loss: 0.44548 (QuantReg: 13.26494) QuantErr: 13.26494 batch_time=0.49790 
Train Epoch: 19 [209/500 13376/32000 (42%)] Loss: 1.01611 (QuantReg: 12.84813) QuantErr: 12.84813 batch_time=0.51875 
Train Epoch: 19 [217/500 13888/32000 (43%)] Loss: 0.63846 (QuantReg: 13.13022) QuantErr: 13.13022 batch_time=0.49983 
Train Epoch: 19 [225/500 14400/32000 (45%)] Loss: 0.75697 (QuantReg: 13.26463) QuantErr: 13.26463 batch_time=0.46395 
Train Epoch: 19 [233/500 14912/32000 (47%)] Loss: 1.10197 (QuantReg: 12.63560) QuantErr: 12.63560 batch_time=0.50170 
Train Epoch: 19 [241/500 15424/32000 (48%)] Loss: 0.79247 (QuantReg: 13.05972) QuantErr: 13.05972 batch_time=0.45329 
Train Epoch: 19 [249/500 15936/32000 (50%)] Loss: 0.81883 (QuantReg: 12.93692) QuantErr: 12.93692 batch_time=0.50463 
Train Epoch: 19 [257/500 16448/32000 (51%)] Loss: 0.41570 (QuantReg: 12.86084) QuantErr: 12.86084 batch_time=1.96543 
Train Epoch: 19 [265/500 16960/32000 (53%)] Loss: 0.75138 (QuantReg: 12.40140) QuantErr: 12.40140 batch_time=0.47589 
Train Epoch: 19 [273/500 17472/32000 (55%)] Loss: 0.72163 (QuantReg: 13.55357) QuantErr: 13.55357 batch_time=0.46688 
Train Epoch: 19 [281/500 17984/32000 (56%)] Loss: 1.19186 (QuantReg: 12.64063) QuantErr: 12.64063 batch_time=0.48834 
Train Epoch: 19 [289/500 18496/32000 (58%)] Loss: 0.83637 (QuantReg: 13.27712) QuantErr: 13.27712 batch_time=0.60664 
Train Epoch: 19 [297/500 19008/32000 (59%)] Loss: 0.81002 (QuantReg: 12.96529) QuantErr: 12.96529 batch_time=0.47592 
Train Epoch: 19 [305/500 19520/32000 (61%)] Loss: 0.66811 (QuantReg: 13.27149) QuantErr: 13.27149 batch_time=0.50782 
Train Epoch: 19 [313/500 20032/32000 (63%)] Loss: 0.50976 (QuantReg: 13.47378) QuantErr: 13.47378 batch_time=0.54672 
Train Epoch: 19 [321/500 20544/32000 (64%)] Loss: 0.67153 (QuantReg: 13.37935) QuantErr: 13.37935 batch_time=2.04057 
Train Epoch: 19 [329/500 21056/32000 (66%)] Loss: 0.45600 (QuantReg: 13.07632) QuantErr: 13.07632 batch_time=0.44892 
Train Epoch: 19 [337/500 21568/32000 (67%)] Loss: 0.69695 (QuantReg: 13.50847) QuantErr: 13.50847 batch_time=0.47138 
Train Epoch: 19 [345/500 22080/32000 (69%)] Loss: 0.81790 (QuantReg: 13.34944) QuantErr: 13.34944 batch_time=0.53952 
Train Epoch: 19 [353/500 22592/32000 (71%)] Loss: 0.83770 (QuantReg: 13.28549) QuantErr: 13.28549 batch_time=0.47149 
Train Epoch: 19 [361/500 23104/32000 (72%)] Loss: 0.51884 (QuantReg: 13.05086) QuantErr: 13.05086 batch_time=0.39907 
Train Epoch: 19 [369/500 23616/32000 (74%)] Loss: 0.88339 (QuantReg: 13.48679) QuantErr: 13.48679 batch_time=0.47539 
Train Epoch: 19 [377/500 24128/32000 (75%)] Loss: 0.54353 (QuantReg: 12.84965) QuantErr: 12.84965 batch_time=0.44614 
Train Epoch: 19 [385/500 24640/32000 (77%)] Loss: 1.07893 (QuantReg: 12.69859) QuantErr: 12.69859 batch_time=1.96860 
Train Epoch: 19 [393/500 25152/32000 (79%)] Loss: 0.67703 (QuantReg: 12.68939) QuantErr: 12.68939 batch_time=0.46119 
Train Epoch: 19 [401/500 25664/32000 (80%)] Loss: 0.60048 (QuantReg: 13.31748) QuantErr: 13.31748 batch_time=0.46336 
Train Epoch: 19 [409/500 26176/32000 (82%)] Loss: 0.91719 (QuantReg: 13.40669) QuantErr: 13.40669 batch_time=0.42735 
Train Epoch: 19 [417/500 26688/32000 (83%)] Loss: 0.52029 (QuantReg: 13.22269) QuantErr: 13.22269 batch_time=0.51671 
Train Epoch: 19 [425/500 27200/32000 (85%)] Loss: 0.72479 (QuantReg: 12.97582) QuantErr: 12.97582 batch_time=0.57119 
Train Epoch: 19 [433/500 27712/32000 (87%)] Loss: 0.84169 (QuantReg: 13.18301) QuantErr: 13.18301 batch_time=0.45785 
Train Epoch: 19 [441/500 28224/32000 (88%)] Loss: 1.05227 (QuantReg: 13.16158) QuantErr: 13.16158 batch_time=0.44738 
Train Epoch: 19 [449/500 28736/32000 (90%)] Loss: 0.67174 (QuantReg: 13.64399) QuantErr: 13.64399 batch_time=2.15000 
Train Epoch: 19 [457/500 29248/32000 (91%)] Loss: 0.61896 (QuantReg: 13.29659) QuantErr: 13.29659 batch_time=0.49841 
Train Epoch: 19 [465/500 29760/32000 (93%)] Loss: 0.33777 (QuantReg: 13.42057) QuantErr: 13.42057 batch_time=0.48832 
Train Epoch: 19 [473/500 30272/32000 (95%)] Loss: 0.67741 (QuantReg: 13.41856) QuantErr: 13.41856 batch_time=0.47172 
Train Epoch: 19 [481/500 30784/32000 (96%)] Loss: 0.68282 (QuantReg: 13.21574) QuantErr: 13.21574 batch_time=0.60372 
Train Epoch: 19 [489/500 31296/32000 (98%)] Loss: 0.81717 (QuantReg: 13.49049) QuantErr: 13.49049 batch_time=0.43648 
Train Epoch: 19 [497/500 31808/32000 (99%)] Loss: 1.04019 (QuantReg: 13.02746) QuantErr: 13.02746 batch_time=0.42774 
Train Epoch: 19 codebook_update_time=2.19930
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch19.pth ...
Done in 5.331s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch19.pth ...
Done in 10.628s
removing stale ckpt [epoch 18] [took 0.01s]
 epoch          : 19
 loss           : 0.7837800707817077
 quant_reg      : 13.187568353652955
 quant_err      : 13.187568353652955
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 9500
 MSRVTT_miech_test/t2v_metrics/R1: 19.9
 MSRVTT_miech_test/t2v_metrics/R5: 48.5
 MSRVTT_miech_test/t2v_metrics/R10: 62.1
 MSRVTT_miech_test/t2v_metrics/R50: 88.2
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.381
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 39.134711665378
 MSRVTT_miech_test/v2t_metrics/R1: 18.7
 MSRVTT_miech_test/v2t_metrics/R5: 49.1
 MSRVTT_miech_test/v2t_metrics/R10: 64.0
 MSRVTT_miech_test/v2t_metrics/R50: 89.5
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.609
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 38.87774117966003
 mnt_best       : 39.134711665378
 not_improved_count: 0
Train Epoch: 20 [1/500 64/32000 (0%)] Loss: 1.22110 (QuantReg: 13.00401) QuantErr: 13.00401 batch_time=31.53545 
Train Epoch: 20 [9/500 576/32000 (2%)] Loss: 0.68341 (QuantReg: 13.11998) QuantErr: 13.11998 batch_time=0.48299 
Train Epoch: 20 [17/500 1088/32000 (3%)] Loss: 1.19447 (QuantReg: 12.79301) QuantErr: 12.79301 batch_time=0.44177 
Train Epoch: 20 [25/500 1600/32000 (5%)] Loss: 1.04284 (QuantReg: 12.44764) QuantErr: 12.44764 batch_time=0.46681 
Train Epoch: 20 [33/500 2112/32000 (7%)] Loss: 0.69692 (QuantReg: 13.31805) QuantErr: 13.31805 batch_time=0.46887 
Train Epoch: 20 [41/500 2624/32000 (8%)] Loss: 1.00548 (QuantReg: 12.88877) QuantErr: 12.88877 batch_time=0.41392 
Train Epoch: 20 [49/500 3136/32000 (10%)] Loss: 0.67620 (QuantReg: 12.86414) QuantErr: 12.86414 batch_time=0.43676 
Train Epoch: 20 [57/500 3648/32000 (11%)] Loss: 1.16991 (QuantReg: 13.14612) QuantErr: 13.14612 batch_time=0.42521 
Train Epoch: 20 [65/500 4160/32000 (13%)] Loss: 0.49617 (QuantReg: 13.36590) QuantErr: 13.36590 batch_time=0.64249 
Train Epoch: 20 [73/500 4672/32000 (15%)] Loss: 0.82949 (QuantReg: 12.96232) QuantErr: 12.96232 batch_time=0.42698 
Train Epoch: 20 [81/500 5184/32000 (16%)] Loss: 0.74160 (QuantReg: 12.90159) QuantErr: 12.90159 batch_time=0.47920 
Train Epoch: 20 [89/500 5696/32000 (18%)] Loss: 0.58726 (QuantReg: 12.91912) QuantErr: 12.91912 batch_time=0.47776 
Train Epoch: 20 [97/500 6208/32000 (19%)] Loss: 0.47376 (QuantReg: 12.94895) QuantErr: 12.94895 batch_time=0.48655 
Train Epoch: 20 [105/500 6720/32000 (21%)] Loss: 0.59260 (QuantReg: 13.17319) QuantErr: 13.17319 batch_time=0.48777 
Train Epoch: 20 [113/500 7232/32000 (23%)] Loss: 0.44896 (QuantReg: 13.08392) QuantErr: 13.08392 batch_time=0.46577 
Train Epoch: 20 [121/500 7744/32000 (24%)] Loss: 0.75096 (QuantReg: 13.76099) QuantErr: 13.76099 batch_time=0.43127 
Train Epoch: 20 [129/500 8256/32000 (26%)] Loss: 0.68677 (QuantReg: 13.03344) QuantErr: 13.03344 batch_time=0.66679 
Train Epoch: 20 [137/500 8768/32000 (27%)] Loss: 0.67910 (QuantReg: 12.91001) QuantErr: 12.91001 batch_time=0.47376 
Train Epoch: 20 [145/500 9280/32000 (29%)] Loss: 0.39229 (QuantReg: 13.65944) QuantErr: 13.65944 batch_time=0.45163 
Train Epoch: 20 [153/500 9792/32000 (31%)] Loss: 0.72726 (QuantReg: 12.88808) QuantErr: 12.88808 batch_time=0.42469 
Train Epoch: 20 [161/500 10304/32000 (32%)] Loss: 0.71469 (QuantReg: 13.53848) QuantErr: 13.53848 batch_time=0.43031 
Train Epoch: 20 [169/500 10816/32000 (34%)] Loss: 0.52714 (QuantReg: 12.83454) QuantErr: 12.83454 batch_time=0.48758 
Train Epoch: 20 [177/500 11328/32000 (35%)] Loss: 0.80963 (QuantReg: 13.16715) QuantErr: 13.16715 batch_time=0.44815 
Train Epoch: 20 [185/500 11840/32000 (37%)] Loss: 0.67862 (QuantReg: 13.15430) QuantErr: 13.15430 batch_time=0.45454 
Train Epoch: 20 [193/500 12352/32000 (39%)] Loss: 0.86710 (QuantReg: 13.38621) QuantErr: 13.38621 batch_time=0.74919 
Train Epoch: 20 [201/500 12864/32000 (40%)] Loss: 0.67347 (QuantReg: 13.29687) QuantErr: 13.29687 batch_time=0.47846 
Train Epoch: 20 [209/500 13376/32000 (42%)] Loss: 0.68082 (QuantReg: 13.33680) QuantErr: 13.33680 batch_time=0.53685 
Train Epoch: 20 [217/500 13888/32000 (43%)] Loss: 0.88916 (QuantReg: 12.93489) QuantErr: 12.93489 batch_time=0.43348 
Train Epoch: 20 [225/500 14400/32000 (45%)] Loss: 0.82194 (QuantReg: 13.05234) QuantErr: 13.05234 batch_time=0.44713 
Train Epoch: 20 [233/500 14912/32000 (47%)] Loss: 0.67563 (QuantReg: 13.10890) QuantErr: 13.10890 batch_time=0.48129 
Train Epoch: 20 [241/500 15424/32000 (48%)] Loss: 0.53104 (QuantReg: 13.26480) QuantErr: 13.26480 batch_time=0.53369 
Train Epoch: 20 [249/500 15936/32000 (50%)] Loss: 0.85280 (QuantReg: 13.18621) QuantErr: 13.18621 batch_time=0.47770 
Train Epoch: 20 [257/500 16448/32000 (51%)] Loss: 0.82481 (QuantReg: 13.47759) QuantErr: 13.47759 batch_time=0.74075 
Train Epoch: 20 [265/500 16960/32000 (53%)] Loss: 0.55330 (QuantReg: 13.15635) QuantErr: 13.15635 batch_time=0.48805 
Train Epoch: 20 [273/500 17472/32000 (55%)] Loss: 0.98441 (QuantReg: 13.27589) QuantErr: 13.27589 batch_time=0.50457 
Train Epoch: 20 [281/500 17984/32000 (56%)] Loss: 0.53484 (QuantReg: 13.32656) QuantErr: 13.32656 batch_time=0.54254 
Train Epoch: 20 [289/500 18496/32000 (58%)] Loss: 0.97004 (QuantReg: 13.12062) QuantErr: 13.12062 batch_time=0.55681 
Train Epoch: 20 [297/500 19008/32000 (59%)] Loss: 0.76102 (QuantReg: 13.23079) QuantErr: 13.23079 batch_time=0.43949 
Train Epoch: 20 [305/500 19520/32000 (61%)] Loss: 0.45334 (QuantReg: 13.72899) QuantErr: 13.72899 batch_time=0.48366 
Train Epoch: 20 [313/500 20032/32000 (63%)] Loss: 1.04967 (QuantReg: 13.35307) QuantErr: 13.35307 batch_time=0.49126 
Train Epoch: 20 [321/500 20544/32000 (64%)] Loss: 0.73661 (QuantReg: 13.34878) QuantErr: 13.34878 batch_time=0.66549 
Train Epoch: 20 [329/500 21056/32000 (66%)] Loss: 0.90074 (QuantReg: 13.70665) QuantErr: 13.70665 batch_time=0.43350 
Train Epoch: 20 [337/500 21568/32000 (67%)] Loss: 0.72941 (QuantReg: 13.80416) QuantErr: 13.80416 batch_time=0.51137 
Train Epoch: 20 [345/500 22080/32000 (69%)] Loss: 0.52743 (QuantReg: 13.21091) QuantErr: 13.21091 batch_time=0.47487 
Train Epoch: 20 [353/500 22592/32000 (71%)] Loss: 0.83936 (QuantReg: 13.37056) QuantErr: 13.37056 batch_time=0.45707 
Train Epoch: 20 [361/500 23104/32000 (72%)] Loss: 0.52922 (QuantReg: 13.38560) QuantErr: 13.38560 batch_time=0.47311 
Train Epoch: 20 [369/500 23616/32000 (74%)] Loss: 0.45812 (QuantReg: 13.26131) QuantErr: 13.26131 batch_time=0.46712 
Train Epoch: 20 [377/500 24128/32000 (75%)] Loss: 0.79449 (QuantReg: 13.65150) QuantErr: 13.65150 batch_time=0.51065 
Train Epoch: 20 [385/500 24640/32000 (77%)] Loss: 0.49310 (QuantReg: 13.19565) QuantErr: 13.19565 batch_time=0.74458 
Train Epoch: 20 [393/500 25152/32000 (79%)] Loss: 0.65960 (QuantReg: 13.14245) QuantErr: 13.14245 batch_time=0.40432 
Train Epoch: 20 [401/500 25664/32000 (80%)] Loss: 0.78612 (QuantReg: 13.08075) QuantErr: 13.08075 batch_time=0.41043 
Train Epoch: 20 [409/500 26176/32000 (82%)] Loss: 0.79436 (QuantReg: 13.23326) QuantErr: 13.23326 batch_time=0.41068 
Train Epoch: 20 [417/500 26688/32000 (83%)] Loss: 0.56358 (QuantReg: 13.04573) QuantErr: 13.04573 batch_time=0.50715 
Train Epoch: 20 [425/500 27200/32000 (85%)] Loss: 0.67607 (QuantReg: 13.23044) QuantErr: 13.23044 batch_time=0.44576 
Train Epoch: 20 [433/500 27712/32000 (87%)] Loss: 0.64315 (QuantReg: 13.00749) QuantErr: 13.00749 batch_time=0.44767 
Train Epoch: 20 [441/500 28224/32000 (88%)] Loss: 0.78162 (QuantReg: 13.22532) QuantErr: 13.22532 batch_time=0.44246 
Train Epoch: 20 [449/500 28736/32000 (90%)] Loss: 0.33361 (QuantReg: 13.36498) QuantErr: 13.36498 batch_time=0.67280 
Train Epoch: 20 [457/500 29248/32000 (91%)] Loss: 0.73235 (QuantReg: 13.47076) QuantErr: 13.47076 batch_time=0.43465 
Train Epoch: 20 [465/500 29760/32000 (93%)] Loss: 0.71486 (QuantReg: 13.66569) QuantErr: 13.66569 batch_time=0.48067 
Train Epoch: 20 [473/500 30272/32000 (95%)] Loss: 0.84954 (QuantReg: 13.48724) QuantErr: 13.48724 batch_time=0.40200 
Train Epoch: 20 [481/500 30784/32000 (96%)] Loss: 0.54550 (QuantReg: 13.00831) QuantErr: 13.00831 batch_time=0.40540 
Train Epoch: 20 [489/500 31296/32000 (98%)] Loss: 0.83901 (QuantReg: 13.47205) QuantErr: 13.47205 batch_time=0.41063 
Train Epoch: 20 [497/500 31808/32000 (99%)] Loss: 0.45714 (QuantReg: 12.96661) QuantErr: 12.96661 batch_time=0.43840 
Train Epoch: 20 codebook_update_time=2.71543
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch20.pth ...
Done in 6.872s
removing stale ckpt [epoch 19] [took 0.01s]
 epoch          : 20
 loss           : 0.7589555230140687
 quant_reg      : 13.216080871582031
 quant_err      : 13.216080871582031
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 10000
 MSRVTT_miech_test/t2v_metrics/R1: 19.9
 MSRVTT_miech_test/t2v_metrics/R5: 48.3
 MSRVTT_miech_test/t2v_metrics/R10: 61.7
 MSRVTT_miech_test/t2v_metrics/R50: 88.3
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.54
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 38.99675383895235
 MSRVTT_miech_test/v2t_metrics/R1: 19.2
 MSRVTT_miech_test/v2t_metrics/R5: 50.1
 MSRVTT_miech_test/v2t_metrics/R10: 62.8
 MSRVTT_miech_test/v2t_metrics/R50: 89.3
 MSRVTT_miech_test/v2t_metrics/MedR: 5.25
 MSRVTT_miech_test/v2t_metrics/MeanR: 25.935
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.23733774142971
 mnt_best       : 39.134711665378
 not_improved_count: 1
Train Epoch: 21 [1/500 64/32000 (0%)] Loss: 0.71802 (QuantReg: 12.83988) QuantErr: 12.83988 batch_time=30.99707 
Train Epoch: 21 [9/500 576/32000 (2%)] Loss: 0.89239 (QuantReg: 13.09352) QuantErr: 13.09352 batch_time=0.48750 
Train Epoch: 21 [17/500 1088/32000 (3%)] Loss: 0.63977 (QuantReg: 13.28831) QuantErr: 13.28831 batch_time=0.40948 
Train Epoch: 21 [25/500 1600/32000 (5%)] Loss: 0.58927 (QuantReg: 13.41014) QuantErr: 13.41014 batch_time=0.42625 
Train Epoch: 21 [33/500 2112/32000 (7%)] Loss: 1.13355 (QuantReg: 13.05097) QuantErr: 13.05097 batch_time=0.42329 
Train Epoch: 21 [41/500 2624/32000 (8%)] Loss: 0.61051 (QuantReg: 13.46866) QuantErr: 13.46866 batch_time=0.43263 
Train Epoch: 21 [49/500 3136/32000 (10%)] Loss: 1.00776 (QuantReg: 13.34822) QuantErr: 13.34822 batch_time=0.45535 
Train Epoch: 21 [57/500 3648/32000 (11%)] Loss: 0.85071 (QuantReg: 13.30314) QuantErr: 13.30314 batch_time=0.55442 
Train Epoch: 21 [65/500 4160/32000 (13%)] Loss: 0.58215 (QuantReg: 13.19497) QuantErr: 13.19497 batch_time=1.06590 
Train Epoch: 21 [73/500 4672/32000 (15%)] Loss: 0.71095 (QuantReg: 12.73354) QuantErr: 12.73354 batch_time=0.48215 
Train Epoch: 21 [81/500 5184/32000 (16%)] Loss: 0.54929 (QuantReg: 13.12951) QuantErr: 13.12951 batch_time=0.46803 
Train Epoch: 21 [89/500 5696/32000 (18%)] Loss: 0.87401 (QuantReg: 13.28324) QuantErr: 13.28324 batch_time=0.50818 
Train Epoch: 21 [97/500 6208/32000 (19%)] Loss: 0.82561 (QuantReg: 13.39397) QuantErr: 13.39397 batch_time=0.42905 
Train Epoch: 21 [105/500 6720/32000 (21%)] Loss: 0.76988 (QuantReg: 13.59409) QuantErr: 13.59409 batch_time=0.41237 
Train Epoch: 21 [113/500 7232/32000 (23%)] Loss: 0.77820 (QuantReg: 13.27368) QuantErr: 13.27368 batch_time=0.45892 
Train Epoch: 21 [121/500 7744/32000 (24%)] Loss: 0.49711 (QuantReg: 13.18046) QuantErr: 13.18046 batch_time=0.44368 
Train Epoch: 21 [129/500 8256/32000 (26%)] Loss: 0.95170 (QuantReg: 12.66827) QuantErr: 12.66827 batch_time=1.06298 
Train Epoch: 21 [137/500 8768/32000 (27%)] Loss: 0.60415 (QuantReg: 13.27291) QuantErr: 13.27291 batch_time=0.43529 
Train Epoch: 21 [145/500 9280/32000 (29%)] Loss: 0.65992 (QuantReg: 13.53024) QuantErr: 13.53024 batch_time=0.41570 
Train Epoch: 21 [153/500 9792/32000 (31%)] Loss: 0.85787 (QuantReg: 12.81991) QuantErr: 12.81991 batch_time=0.44510 
Train Epoch: 21 [161/500 10304/32000 (32%)] Loss: 0.56390 (QuantReg: 13.12828) QuantErr: 13.12828 batch_time=0.52639 
Train Epoch: 21 [169/500 10816/32000 (34%)] Loss: 0.53562 (QuantReg: 13.36669) QuantErr: 13.36669 batch_time=0.49460 
Train Epoch: 21 [177/500 11328/32000 (35%)] Loss: 0.87053 (QuantReg: 13.12268) QuantErr: 13.12268 batch_time=0.49486 
Train Epoch: 21 [185/500 11840/32000 (37%)] Loss: 0.71902 (QuantReg: 13.12391) QuantErr: 13.12391 batch_time=0.45267 
Train Epoch: 21 [193/500 12352/32000 (39%)] Loss: 0.85020 (QuantReg: 13.00449) QuantErr: 13.00449 batch_time=1.04436 
Train Epoch: 21 [201/500 12864/32000 (40%)] Loss: 0.64796 (QuantReg: 13.22629) QuantErr: 13.22629 batch_time=0.42702 
Train Epoch: 21 [209/500 13376/32000 (42%)] Loss: 1.17037 (QuantReg: 13.30247) QuantErr: 13.30247 batch_time=0.43962 
Train Epoch: 21 [217/500 13888/32000 (43%)] Loss: 0.52970 (QuantReg: 13.89739) QuantErr: 13.89739 batch_time=0.45728 
Train Epoch: 21 [225/500 14400/32000 (45%)] Loss: 0.75335 (QuantReg: 12.94183) QuantErr: 12.94183 batch_time=0.44620 
Train Epoch: 21 [233/500 14912/32000 (47%)] Loss: 0.66477 (QuantReg: 13.31079) QuantErr: 13.31079 batch_time=0.42908 
Train Epoch: 21 [241/500 15424/32000 (48%)] Loss: 0.82130 (QuantReg: 13.14280) QuantErr: 13.14280 batch_time=0.45040 
Train Epoch: 21 [249/500 15936/32000 (50%)] Loss: 0.91122 (QuantReg: 13.53475) QuantErr: 13.53475 batch_time=0.45946 
Train Epoch: 21 [257/500 16448/32000 (51%)] Loss: 1.01862 (QuantReg: 12.91652) QuantErr: 12.91652 batch_time=1.13401 
Train Epoch: 21 [265/500 16960/32000 (53%)] Loss: 0.52711 (QuantReg: 13.03754) QuantErr: 13.03754 batch_time=0.49000 
Train Epoch: 21 [273/500 17472/32000 (55%)] Loss: 0.84747 (QuantReg: 13.42516) QuantErr: 13.42516 batch_time=0.46399 
Train Epoch: 21 [281/500 17984/32000 (56%)] Loss: 0.66411 (QuantReg: 13.15564) QuantErr: 13.15564 batch_time=0.45313 
Train Epoch: 21 [289/500 18496/32000 (58%)] Loss: 0.64030 (QuantReg: 13.38013) QuantErr: 13.38013 batch_time=0.47334 
Train Epoch: 21 [297/500 19008/32000 (59%)] Loss: 0.72599 (QuantReg: 12.97003) QuantErr: 12.97003 batch_time=0.43320 
Train Epoch: 21 [305/500 19520/32000 (61%)] Loss: 0.59366 (QuantReg: 13.70513) QuantErr: 13.70513 batch_time=0.50105 
Train Epoch: 21 [313/500 20032/32000 (63%)] Loss: 0.87510 (QuantReg: 13.38735) QuantErr: 13.38735 batch_time=0.44175 
Train Epoch: 21 [321/500 20544/32000 (64%)] Loss: 0.60760 (QuantReg: 13.33934) QuantErr: 13.33934 batch_time=1.09370 
Train Epoch: 21 [329/500 21056/32000 (66%)] Loss: 0.86598 (QuantReg: 13.62935) QuantErr: 13.62935 batch_time=0.52925 
Train Epoch: 21 [337/500 21568/32000 (67%)] Loss: 0.87643 (QuantReg: 13.35957) QuantErr: 13.35957 batch_time=0.46671 
Train Epoch: 21 [345/500 22080/32000 (69%)] Loss: 0.74724 (QuantReg: 13.55430) QuantErr: 13.55430 batch_time=0.49733 
Train Epoch: 21 [353/500 22592/32000 (71%)] Loss: 0.93206 (QuantReg: 13.29237) QuantErr: 13.29237 batch_time=0.41690 
Train Epoch: 21 [361/500 23104/32000 (72%)] Loss: 0.68781 (QuantReg: 13.59593) QuantErr: 13.59593 batch_time=0.44469 
Train Epoch: 21 [369/500 23616/32000 (74%)] Loss: 0.94025 (QuantReg: 13.10372) QuantErr: 13.10372 batch_time=0.45468 
Train Epoch: 21 [377/500 24128/32000 (75%)] Loss: 1.14345 (QuantReg: 13.50021) QuantErr: 13.50021 batch_time=0.45024 
Train Epoch: 21 [385/500 24640/32000 (77%)] Loss: 0.56622 (QuantReg: 12.79245) QuantErr: 12.79245 batch_time=1.15960 
Train Epoch: 21 [393/500 25152/32000 (79%)] Loss: 0.95635 (QuantReg: 13.78424) QuantErr: 13.78424 batch_time=0.46625 
Train Epoch: 21 [401/500 25664/32000 (80%)] Loss: 0.67262 (QuantReg: 13.83825) QuantErr: 13.83825 batch_time=0.48614 
Train Epoch: 21 [409/500 26176/32000 (82%)] Loss: 0.62261 (QuantReg: 13.11872) QuantErr: 13.11872 batch_time=0.49792 
Train Epoch: 21 [417/500 26688/32000 (83%)] Loss: 0.62768 (QuantReg: 13.35377) QuantErr: 13.35377 batch_time=0.45338 
Train Epoch: 21 [425/500 27200/32000 (85%)] Loss: 0.58233 (QuantReg: 13.31798) QuantErr: 13.31798 batch_time=0.49744 
Train Epoch: 21 [433/500 27712/32000 (87%)] Loss: 0.64396 (QuantReg: 12.81916) QuantErr: 12.81916 batch_time=0.47901 
Train Epoch: 21 [441/500 28224/32000 (88%)] Loss: 0.47108 (QuantReg: 13.49626) QuantErr: 13.49626 batch_time=0.43251 
Train Epoch: 21 [449/500 28736/32000 (90%)] Loss: 0.50358 (QuantReg: 13.45351) QuantErr: 13.45351 batch_time=1.12575 
Train Epoch: 21 [457/500 29248/32000 (91%)] Loss: 0.64963 (QuantReg: 13.50180) QuantErr: 13.50180 batch_time=0.46075 
Train Epoch: 21 [465/500 29760/32000 (93%)] Loss: 0.91670 (QuantReg: 13.81356) QuantErr: 13.81356 batch_time=0.44960 
Train Epoch: 21 [473/500 30272/32000 (95%)] Loss: 0.80365 (QuantReg: 13.45256) QuantErr: 13.45256 batch_time=0.44076 
Train Epoch: 21 [481/500 30784/32000 (96%)] Loss: 0.95864 (QuantReg: 13.62419) QuantErr: 13.62419 batch_time=0.44998 
Train Epoch: 21 [489/500 31296/32000 (98%)] Loss: 0.97019 (QuantReg: 13.36937) QuantErr: 13.36937 batch_time=0.41295 
Train Epoch: 21 [497/500 31808/32000 (99%)] Loss: 0.70368 (QuantReg: 13.33421) QuantErr: 13.33421 batch_time=0.40064 
Train Epoch: 21 codebook_update_time=3.15813
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch21.pth ...
Done in 7.129s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch21.pth ...
Done in 12.507s
removing stale ckpt [epoch 20] [took 0.01s]
 epoch          : 21
 loss           : 0.753491450548172
 quant_reg      : 13.31885880279541
 quant_err      : 13.31885880279541
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 10500
 MSRVTT_miech_test/t2v_metrics/R1: 20.6
 MSRVTT_miech_test/t2v_metrics/R5: 48.7
 MSRVTT_miech_test/t2v_metrics/R10: 63.0
 MSRVTT_miech_test/t2v_metrics/R50: 87.2
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.352
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 39.833234867649125
 MSRVTT_miech_test/v2t_metrics/R1: 20.3
 MSRVTT_miech_test/v2t_metrics/R5: 49.1
 MSRVTT_miech_test/v2t_metrics/R10: 63.0
 MSRVTT_miech_test/v2t_metrics/R50: 89.9
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 25.9185
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.74715299414824
 mnt_best       : 39.833234867649125
 not_improved_count: 0
Train Epoch: 22 [1/500 64/32000 (0%)] Loss: 0.53797 (QuantReg: 13.44258) QuantErr: 13.44258 batch_time=32.71099 
Train Epoch: 22 [9/500 576/32000 (2%)] Loss: 0.77307 (QuantReg: 12.53801) QuantErr: 12.53801 batch_time=0.59395 
Train Epoch: 22 [17/500 1088/32000 (3%)] Loss: 0.71981 (QuantReg: 13.12417) QuantErr: 13.12417 batch_time=2.68021 
Train Epoch: 22 [25/500 1600/32000 (5%)] Loss: 0.67704 (QuantReg: 13.38107) QuantErr: 13.38107 batch_time=0.52388 
Train Epoch: 22 [33/500 2112/32000 (7%)] Loss: 0.52834 (QuantReg: 13.11247) QuantErr: 13.11247 batch_time=0.47730 
Train Epoch: 22 [41/500 2624/32000 (8%)] Loss: 0.90084 (QuantReg: 13.63589) QuantErr: 13.63589 batch_time=0.47766 
Train Epoch: 22 [49/500 3136/32000 (10%)] Loss: 0.83352 (QuantReg: 13.03197) QuantErr: 13.03197 batch_time=0.41361 
Train Epoch: 22 [57/500 3648/32000 (11%)] Loss: 0.49781 (QuantReg: 13.40939) QuantErr: 13.40939 batch_time=0.49619 
Train Epoch: 22 [65/500 4160/32000 (13%)] Loss: 1.26743 (QuantReg: 13.01425) QuantErr: 13.01425 batch_time=1.31100 
Train Epoch: 22 [73/500 4672/32000 (15%)] Loss: 0.76923 (QuantReg: 13.24515) QuantErr: 13.24515 batch_time=0.64055 
Train Epoch: 22 [81/500 5184/32000 (16%)] Loss: 0.64927 (QuantReg: 13.06185) QuantErr: 13.06185 batch_time=1.95797 
Train Epoch: 22 [89/500 5696/32000 (18%)] Loss: 0.89576 (QuantReg: 13.39522) QuantErr: 13.39522 batch_time=0.46575 
Train Epoch: 22 [97/500 6208/32000 (19%)] Loss: 0.53967 (QuantReg: 13.11070) QuantErr: 13.11070 batch_time=0.43539 
Train Epoch: 22 [105/500 6720/32000 (21%)] Loss: 1.18118 (QuantReg: 13.35235) QuantErr: 13.35235 batch_time=0.42608 
Train Epoch: 22 [113/500 7232/32000 (23%)] Loss: 0.85306 (QuantReg: 13.34992) QuantErr: 13.34992 batch_time=0.46368 
Train Epoch: 22 [121/500 7744/32000 (24%)] Loss: 0.93803 (QuantReg: 13.19250) QuantErr: 13.19250 batch_time=0.48467 
Train Epoch: 22 [129/500 8256/32000 (26%)] Loss: 0.46754 (QuantReg: 13.38388) QuantErr: 13.38388 batch_time=1.14625 
Train Epoch: 22 [137/500 8768/32000 (27%)] Loss: 1.09851 (QuantReg: 13.20376) QuantErr: 13.20376 batch_time=0.58272 
Train Epoch: 22 [145/500 9280/32000 (29%)] Loss: 0.84772 (QuantReg: 12.96115) QuantErr: 12.96115 batch_time=1.96936 
Train Epoch: 22 [153/500 9792/32000 (31%)] Loss: 0.82302 (QuantReg: 12.90590) QuantErr: 12.90590 batch_time=0.43484 
Train Epoch: 22 [161/500 10304/32000 (32%)] Loss: 0.61603 (QuantReg: 13.46996) QuantErr: 13.46996 batch_time=0.47380 
Train Epoch: 22 [169/500 10816/32000 (34%)] Loss: 0.50988 (QuantReg: 13.86471) QuantErr: 13.86471 batch_time=0.45913 
Train Epoch: 22 [177/500 11328/32000 (35%)] Loss: 0.70745 (QuantReg: 13.29372) QuantErr: 13.29372 batch_time=0.42228 
Train Epoch: 22 [185/500 11840/32000 (37%)] Loss: 0.76258 (QuantReg: 13.32274) QuantErr: 13.32274 batch_time=0.43667 
Train Epoch: 22 [193/500 12352/32000 (39%)] Loss: 0.77424 (QuantReg: 12.88044) QuantErr: 12.88044 batch_time=1.20174 
Train Epoch: 22 [201/500 12864/32000 (40%)] Loss: 0.88315 (QuantReg: 13.70977) QuantErr: 13.70977 batch_time=0.57079 
Train Epoch: 22 [209/500 13376/32000 (42%)] Loss: 0.80040 (QuantReg: 13.26838) QuantErr: 13.26838 batch_time=1.81918 
Train Epoch: 22 [217/500 13888/32000 (43%)] Loss: 1.08490 (QuantReg: 13.37786) QuantErr: 13.37786 batch_time=0.49089 
Train Epoch: 22 [225/500 14400/32000 (45%)] Loss: 0.75113 (QuantReg: 13.66199) QuantErr: 13.66199 batch_time=0.44328 
Train Epoch: 22 [233/500 14912/32000 (47%)] Loss: 0.43837 (QuantReg: 13.52575) QuantErr: 13.52575 batch_time=0.41970 
Train Epoch: 22 [241/500 15424/32000 (48%)] Loss: 0.56434 (QuantReg: 13.52306) QuantErr: 13.52306 batch_time=0.45577 
Train Epoch: 22 [249/500 15936/32000 (50%)] Loss: 1.14004 (QuantReg: 13.08604) QuantErr: 13.08604 batch_time=0.44785 
Train Epoch: 22 [257/500 16448/32000 (51%)] Loss: 1.41416 (QuantReg: 13.25529) QuantErr: 13.25529 batch_time=1.22186 
Train Epoch: 22 [265/500 16960/32000 (53%)] Loss: 0.42947 (QuantReg: 13.31207) QuantErr: 13.31207 batch_time=0.61456 
Train Epoch: 22 [273/500 17472/32000 (55%)] Loss: 0.33613 (QuantReg: 13.14905) QuantErr: 13.14905 batch_time=2.06854 
Train Epoch: 22 [281/500 17984/32000 (56%)] Loss: 0.73981 (QuantReg: 13.35730) QuantErr: 13.35730 batch_time=0.45271 
Train Epoch: 22 [289/500 18496/32000 (58%)] Loss: 0.47259 (QuantReg: 13.01212) QuantErr: 13.01212 batch_time=0.45471 
Train Epoch: 22 [297/500 19008/32000 (59%)] Loss: 0.60162 (QuantReg: 13.33046) QuantErr: 13.33046 batch_time=0.46612 
Train Epoch: 22 [305/500 19520/32000 (61%)] Loss: 0.97598 (QuantReg: 13.51850) QuantErr: 13.51850 batch_time=0.49699 
Train Epoch: 22 [313/500 20032/32000 (63%)] Loss: 0.60311 (QuantReg: 13.10781) QuantErr: 13.10781 batch_time=0.51341 
Train Epoch: 22 [321/500 20544/32000 (64%)] Loss: 1.11824 (QuantReg: 13.22406) QuantErr: 13.22406 batch_time=1.25965 
Train Epoch: 22 [329/500 21056/32000 (66%)] Loss: 0.66617 (QuantReg: 13.48547) QuantErr: 13.48547 batch_time=0.60520 
Train Epoch: 22 [337/500 21568/32000 (67%)] Loss: 1.26264 (QuantReg: 13.40107) QuantErr: 13.40107 batch_time=1.84767 
Train Epoch: 22 [345/500 22080/32000 (69%)] Loss: 0.60468 (QuantReg: 13.49242) QuantErr: 13.49242 batch_time=0.42236 
Train Epoch: 22 [353/500 22592/32000 (71%)] Loss: 1.03586 (QuantReg: 13.01264) QuantErr: 13.01264 batch_time=0.40115 
Train Epoch: 22 [361/500 23104/32000 (72%)] Loss: 0.56357 (QuantReg: 13.08008) QuantErr: 13.08008 batch_time=0.39892 
Train Epoch: 22 [369/500 23616/32000 (74%)] Loss: 0.68131 (QuantReg: 13.53803) QuantErr: 13.53803 batch_time=0.42581 
Train Epoch: 22 [377/500 24128/32000 (75%)] Loss: 1.06413 (QuantReg: 12.92756) QuantErr: 12.92756 batch_time=0.43367 
Train Epoch: 22 [385/500 24640/32000 (77%)] Loss: 0.84343 (QuantReg: 13.39272) QuantErr: 13.39272 batch_time=1.29595 
Train Epoch: 22 [393/500 25152/32000 (79%)] Loss: 0.58729 (QuantReg: 13.44358) QuantErr: 13.44358 batch_time=0.54342 
Train Epoch: 22 [401/500 25664/32000 (80%)] Loss: 0.61926 (QuantReg: 13.40428) QuantErr: 13.40428 batch_time=1.93110 
Train Epoch: 22 [409/500 26176/32000 (82%)] Loss: 0.69279 (QuantReg: 13.42782) QuantErr: 13.42782 batch_time=0.43326 
Train Epoch: 22 [417/500 26688/32000 (83%)] Loss: 1.14809 (QuantReg: 12.73182) QuantErr: 12.73182 batch_time=0.45179 
Train Epoch: 22 [425/500 27200/32000 (85%)] Loss: 0.63958 (QuantReg: 13.25102) QuantErr: 13.25102 batch_time=0.44486 
Train Epoch: 22 [433/500 27712/32000 (87%)] Loss: 0.81516 (QuantReg: 13.53427) QuantErr: 13.53427 batch_time=0.45742 
Train Epoch: 22 [441/500 28224/32000 (88%)] Loss: 0.58017 (QuantReg: 13.75855) QuantErr: 13.75855 batch_time=0.53588 
Train Epoch: 22 [449/500 28736/32000 (90%)] Loss: 0.73802 (QuantReg: 13.16868) QuantErr: 13.16868 batch_time=1.23388 
Train Epoch: 22 [457/500 29248/32000 (91%)] Loss: 0.78587 (QuantReg: 13.27419) QuantErr: 13.27419 batch_time=0.64966 
Train Epoch: 22 [465/500 29760/32000 (93%)] Loss: 0.56118 (QuantReg: 13.71028) QuantErr: 13.71028 batch_time=1.95372 
Train Epoch: 22 [473/500 30272/32000 (95%)] Loss: 0.58012 (QuantReg: 13.28767) QuantErr: 13.28767 batch_time=0.50686 
Train Epoch: 22 [481/500 30784/32000 (96%)] Loss: 0.70696 (QuantReg: 13.21762) QuantErr: 13.21762 batch_time=0.49982 
Train Epoch: 22 [489/500 31296/32000 (98%)] Loss: 0.61348 (QuantReg: 13.27322) QuantErr: 13.27322 batch_time=0.48464 
Train Epoch: 22 [497/500 31808/32000 (99%)] Loss: 0.75825 (QuantReg: 13.60333) QuantErr: 13.60333 batch_time=0.46757 
Train Epoch: 22 codebook_update_time=2.10131
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch22.pth ...
Done in 5.917s
removing stale ckpt [epoch 21] [took 0.02s]
 epoch          : 22
 loss           : 0.7152740589380264
 quant_reg      : 13.288992477416992
 quant_err      : 13.288992477416992
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 11000
 MSRVTT_miech_test/t2v_metrics/R1: 20.6
 MSRVTT_miech_test/t2v_metrics/R5: 48.9
 MSRVTT_miech_test/t2v_metrics/R10: 62.1
 MSRVTT_miech_test/t2v_metrics/R50: 88.1
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.106
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 39.696836011425454
 MSRVTT_miech_test/v2t_metrics/R1: 19.4
 MSRVTT_miech_test/v2t_metrics/R5: 50.7
 MSRVTT_miech_test/v2t_metrics/R10: 65.3
 MSRVTT_miech_test/v2t_metrics/R50: 88.9
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.452
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.04739673322648
 mnt_best       : 39.833234867649125
 not_improved_count: 1
Train Epoch: 23 [1/500 64/32000 (0%)] Loss: 0.89712 (QuantReg: 13.25212) QuantErr: 13.25212 batch_time=33.74386 
Train Epoch: 23 [9/500 576/32000 (2%)] Loss: 0.86496 (QuantReg: 13.46050) QuantErr: 13.46050 batch_time=0.39704 
Train Epoch: 23 [17/500 1088/32000 (3%)] Loss: 0.82304 (QuantReg: 12.83368) QuantErr: 12.83368 batch_time=0.40986 
Train Epoch: 23 [25/500 1600/32000 (5%)] Loss: 0.81352 (QuantReg: 12.94758) QuantErr: 12.94758 batch_time=0.41697 
Train Epoch: 23 [33/500 2112/32000 (7%)] Loss: 0.48950 (QuantReg: 13.67602) QuantErr: 13.67602 batch_time=0.43843 
Train Epoch: 23 [41/500 2624/32000 (8%)] Loss: 0.76288 (QuantReg: 13.14784) QuantErr: 13.14784 batch_time=0.54742 
Train Epoch: 23 [49/500 3136/32000 (10%)] Loss: 0.65529 (QuantReg: 13.54901) QuantErr: 13.54901 batch_time=0.42133 
Train Epoch: 23 [57/500 3648/32000 (11%)] Loss: 0.54979 (QuantReg: 13.49089) QuantErr: 13.49089 batch_time=0.44094 
Train Epoch: 23 [65/500 4160/32000 (13%)] Loss: 1.31515 (QuantReg: 12.80392) QuantErr: 12.80392 batch_time=1.37358 
Train Epoch: 23 [73/500 4672/32000 (15%)] Loss: 0.60387 (QuantReg: 13.36186) QuantErr: 13.36186 batch_time=0.48156 
Train Epoch: 23 [81/500 5184/32000 (16%)] Loss: 0.82018 (QuantReg: 13.09226) QuantErr: 13.09226 batch_time=0.49016 
Train Epoch: 23 [89/500 5696/32000 (18%)] Loss: 0.52165 (QuantReg: 13.58411) QuantErr: 13.58411 batch_time=0.49036 
Train Epoch: 23 [97/500 6208/32000 (19%)] Loss: 0.86947 (QuantReg: 13.14171) QuantErr: 13.14171 batch_time=0.48847 
Train Epoch: 23 [105/500 6720/32000 (21%)] Loss: 0.63830 (QuantReg: 13.22438) QuantErr: 13.22438 batch_time=0.50881 
Train Epoch: 23 [113/500 7232/32000 (23%)] Loss: 0.62747 (QuantReg: 13.20118) QuantErr: 13.20118 batch_time=0.41846 
Train Epoch: 23 [121/500 7744/32000 (24%)] Loss: 0.62028 (QuantReg: 13.13139) QuantErr: 13.13139 batch_time=0.40961 
Train Epoch: 23 [129/500 8256/32000 (26%)] Loss: 0.93822 (QuantReg: 13.15798) QuantErr: 13.15798 batch_time=1.32932 
Train Epoch: 23 [137/500 8768/32000 (27%)] Loss: 0.41993 (QuantReg: 13.53744) QuantErr: 13.53744 batch_time=0.49925 
Train Epoch: 23 [145/500 9280/32000 (29%)] Loss: 1.04393 (QuantReg: 13.36926) QuantErr: 13.36926 batch_time=0.41718 
Train Epoch: 23 [153/500 9792/32000 (31%)] Loss: 0.58904 (QuantReg: 12.78280) QuantErr: 12.78280 batch_time=0.40891 
Train Epoch: 23 [161/500 10304/32000 (32%)] Loss: 0.42592 (QuantReg: 13.56763) QuantErr: 13.56763 batch_time=0.59244 
Train Epoch: 23 [169/500 10816/32000 (34%)] Loss: 0.72806 (QuantReg: 13.04634) QuantErr: 13.04634 batch_time=0.55778 
Train Epoch: 23 [177/500 11328/32000 (35%)] Loss: 0.62646 (QuantReg: 13.39639) QuantErr: 13.39639 batch_time=0.40442 
Train Epoch: 23 [185/500 11840/32000 (37%)] Loss: 1.15232 (QuantReg: 13.50661) QuantErr: 13.50661 batch_time=0.53073 
Train Epoch: 23 [193/500 12352/32000 (39%)] Loss: 0.85282 (QuantReg: 13.20185) QuantErr: 13.20185 batch_time=1.22514 
Train Epoch: 23 [201/500 12864/32000 (40%)] Loss: 0.65479 (QuantReg: 13.22734) QuantErr: 13.22734 batch_time=0.51557 
Train Epoch: 23 [209/500 13376/32000 (42%)] Loss: 0.93481 (QuantReg: 13.35616) QuantErr: 13.35616 batch_time=0.40470 
Train Epoch: 23 [217/500 13888/32000 (43%)] Loss: 0.56696 (QuantReg: 13.74113) QuantErr: 13.74113 batch_time=0.52108 
Train Epoch: 23 [225/500 14400/32000 (45%)] Loss: 0.50420 (QuantReg: 13.66042) QuantErr: 13.66042 batch_time=0.54945 
Train Epoch: 23 [233/500 14912/32000 (47%)] Loss: 0.74952 (QuantReg: 13.06195) QuantErr: 13.06195 batch_time=0.48225 
Train Epoch: 23 [241/500 15424/32000 (48%)] Loss: 0.84875 (QuantReg: 13.29188) QuantErr: 13.29188 batch_time=0.44556 
Train Epoch: 23 [249/500 15936/32000 (50%)] Loss: 0.69164 (QuantReg: 13.56822) QuantErr: 13.56822 batch_time=0.44597 
Train Epoch: 23 [257/500 16448/32000 (51%)] Loss: 0.98332 (QuantReg: 13.34440) QuantErr: 13.34440 batch_time=1.40575 
Train Epoch: 23 [265/500 16960/32000 (53%)] Loss: 0.87115 (QuantReg: 13.19483) QuantErr: 13.19483 batch_time=0.46373 
Train Epoch: 23 [273/500 17472/32000 (55%)] Loss: 1.01621 (QuantReg: 13.36734) QuantErr: 13.36734 batch_time=0.51376 
Train Epoch: 23 [281/500 17984/32000 (56%)] Loss: 0.92897 (QuantReg: 13.15800) QuantErr: 13.15800 batch_time=0.43831 
Train Epoch: 23 [289/500 18496/32000 (58%)] Loss: 0.57501 (QuantReg: 13.22000) QuantErr: 13.22000 batch_time=0.50557 
Train Epoch: 23 [297/500 19008/32000 (59%)] Loss: 0.64838 (QuantReg: 13.09394) QuantErr: 13.09394 batch_time=0.49244 
Train Epoch: 23 [305/500 19520/32000 (61%)] Loss: 0.43504 (QuantReg: 13.70983) QuantErr: 13.70983 batch_time=0.43422 
Train Epoch: 23 [313/500 20032/32000 (63%)] Loss: 0.67826 (QuantReg: 13.72451) QuantErr: 13.72451 batch_time=0.48729 
Train Epoch: 23 [321/500 20544/32000 (64%)] Loss: 0.82726 (QuantReg: 13.25983) QuantErr: 13.25983 batch_time=1.35614 
Train Epoch: 23 [329/500 21056/32000 (66%)] Loss: 1.06854 (QuantReg: 12.98600) QuantErr: 12.98600 batch_time=0.47929 
Train Epoch: 23 [337/500 21568/32000 (67%)] Loss: 0.82610 (QuantReg: 13.40944) QuantErr: 13.40944 batch_time=0.48664 
Train Epoch: 23 [345/500 22080/32000 (69%)] Loss: 0.54081 (QuantReg: 13.12713) QuantErr: 13.12713 batch_time=0.46524 
Train Epoch: 23 [353/500 22592/32000 (71%)] Loss: 0.65286 (QuantReg: 13.27641) QuantErr: 13.27641 batch_time=0.51144 
Train Epoch: 23 [361/500 23104/32000 (72%)] Loss: 0.40838 (QuantReg: 13.62187) QuantErr: 13.62187 batch_time=0.41239 
Train Epoch: 23 [369/500 23616/32000 (74%)] Loss: 1.12103 (QuantReg: 13.56621) QuantErr: 13.56621 batch_time=0.43713 
Train Epoch: 23 [377/500 24128/32000 (75%)] Loss: 0.84668 (QuantReg: 13.23113) QuantErr: 13.23113 batch_time=0.42923 
Train Epoch: 23 [385/500 24640/32000 (77%)] Loss: 0.65320 (QuantReg: 13.32652) QuantErr: 13.32652 batch_time=1.34823 
Train Epoch: 23 [393/500 25152/32000 (79%)] Loss: 0.85291 (QuantReg: 13.27197) QuantErr: 13.27197 batch_time=0.44443 
Train Epoch: 23 [401/500 25664/32000 (80%)] Loss: 0.79543 (QuantReg: 13.03238) QuantErr: 13.03238 batch_time=0.44113 
Train Epoch: 23 [409/500 26176/32000 (82%)] Loss: 0.46800 (QuantReg: 13.20533) QuantErr: 13.20533 batch_time=0.45973 
Train Epoch: 23 [417/500 26688/32000 (83%)] Loss: 0.41803 (QuantReg: 13.58048) QuantErr: 13.58048 batch_time=0.44409 
Train Epoch: 23 [425/500 27200/32000 (85%)] Loss: 0.62406 (QuantReg: 13.44532) QuantErr: 13.44532 batch_time=0.42202 
Train Epoch: 23 [433/500 27712/32000 (87%)] Loss: 0.61540 (QuantReg: 13.65553) QuantErr: 13.65553 batch_time=0.43085 
Train Epoch: 23 [441/500 28224/32000 (88%)] Loss: 0.73557 (QuantReg: 12.93092) QuantErr: 12.93092 batch_time=0.47611 
Train Epoch: 23 [449/500 28736/32000 (90%)] Loss: 0.72902 (QuantReg: 13.81638) QuantErr: 13.81638 batch_time=1.39162 
Train Epoch: 23 [457/500 29248/32000 (91%)] Loss: 0.91172 (QuantReg: 13.56160) QuantErr: 13.56160 batch_time=0.47329 
Train Epoch: 23 [465/500 29760/32000 (93%)] Loss: 0.58346 (QuantReg: 13.33079) QuantErr: 13.33079 batch_time=0.47822 
Train Epoch: 23 [473/500 30272/32000 (95%)] Loss: 0.84072 (QuantReg: 13.07423) QuantErr: 13.07423 batch_time=0.47563 
Train Epoch: 23 [481/500 30784/32000 (96%)] Loss: 0.73785 (QuantReg: 13.35757) QuantErr: 13.35757 batch_time=0.43135 
Train Epoch: 23 [489/500 31296/32000 (98%)] Loss: 0.86436 (QuantReg: 12.84366) QuantErr: 12.84366 batch_time=0.41867 
Train Epoch: 23 [497/500 31808/32000 (99%)] Loss: 0.60007 (QuantReg: 13.15424) QuantErr: 13.15424 batch_time=0.42196 
Train Epoch: 23 codebook_update_time=2.72372
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch23.pth ...
Done in 5.447s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch23.pth ...
Done in 10.560s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 0.6988111621737481
 quant_reg      : 13.301399318695069
 quant_err      : 13.301399318695069
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 11500
 MSRVTT_miech_test/t2v_metrics/R1: 21.7
 MSRVTT_miech_test/t2v_metrics/R5: 50.2
 MSRVTT_miech_test/t2v_metrics/R10: 61.6
 MSRVTT_miech_test/t2v_metrics/R50: 87.8
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.656
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.63635269621589
 MSRVTT_miech_test/v2t_metrics/R1: 20.2
 MSRVTT_miech_test/v2t_metrics/R5: 49.9
 MSRVTT_miech_test/v2t_metrics/R10: 64.1
 MSRVTT_miech_test/v2t_metrics/R50: 89.6
 MSRVTT_miech_test/v2t_metrics/MedR: 6.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.011
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.12699595729838
 mnt_best       : 40.63635269621589
 not_improved_count: 0
Train Epoch: 24 [1/500 64/32000 (0%)] Loss: 0.73979 (QuantReg: 13.22586) QuantErr: 13.22586 batch_time=30.71284 
Train Epoch: 24 [9/500 576/32000 (2%)] Loss: 0.55040 (QuantReg: 13.27195) QuantErr: 13.27195 batch_time=2.19537 
Train Epoch: 24 [17/500 1088/32000 (3%)] Loss: 0.81980 (QuantReg: 13.01748) QuantErr: 13.01748 batch_time=3.57535 
Train Epoch: 24 [25/500 1600/32000 (5%)] Loss: 0.90116 (QuantReg: 13.47794) QuantErr: 13.47794 batch_time=0.43010 
Train Epoch: 24 [33/500 2112/32000 (7%)] Loss: 0.71170 (QuantReg: 13.07119) QuantErr: 13.07119 batch_time=0.40616 
Train Epoch: 24 [41/500 2624/32000 (8%)] Loss: 0.82547 (QuantReg: 12.88602) QuantErr: 12.88602 batch_time=0.51953 
Train Epoch: 24 [49/500 3136/32000 (10%)] Loss: 0.61368 (QuantReg: 13.41121) QuantErr: 13.41121 batch_time=0.49294 
Train Epoch: 24 [57/500 3648/32000 (11%)] Loss: 1.03352 (QuantReg: 13.73298) QuantErr: 13.73298 batch_time=0.44796 
Train Epoch: 24 [65/500 4160/32000 (13%)] Loss: 1.24444 (QuantReg: 13.37832) QuantErr: 13.37832 batch_time=0.82673 
Train Epoch: 24 [73/500 4672/32000 (15%)] Loss: 0.46511 (QuantReg: 13.52770) QuantErr: 13.52770 batch_time=1.93418 
Train Epoch: 24 [81/500 5184/32000 (16%)] Loss: 0.37738 (QuantReg: 13.40091) QuantErr: 13.40091 batch_time=2.75160 
Train Epoch: 24 [89/500 5696/32000 (18%)] Loss: 0.96892 (QuantReg: 13.11115) QuantErr: 13.11115 batch_time=0.42811 
Train Epoch: 24 [97/500 6208/32000 (19%)] Loss: 0.88484 (QuantReg: 13.15169) QuantErr: 13.15169 batch_time=0.49775 
Train Epoch: 24 [105/500 6720/32000 (21%)] Loss: 0.35417 (QuantReg: 13.42340) QuantErr: 13.42340 batch_time=0.40973 
Train Epoch: 24 [113/500 7232/32000 (23%)] Loss: 0.92803 (QuantReg: 13.30716) QuantErr: 13.30716 batch_time=0.46937 
Train Epoch: 24 [121/500 7744/32000 (24%)] Loss: 0.81406 (QuantReg: 13.47896) QuantErr: 13.47896 batch_time=0.42705 
Train Epoch: 24 [129/500 8256/32000 (26%)] Loss: 0.73944 (QuantReg: 13.26971) QuantErr: 13.26971 batch_time=0.80090 
Train Epoch: 24 [137/500 8768/32000 (27%)] Loss: 0.67159 (QuantReg: 13.02382) QuantErr: 13.02382 batch_time=1.85355 
Train Epoch: 24 [145/500 9280/32000 (29%)] Loss: 0.70169 (QuantReg: 13.77700) QuantErr: 13.77700 batch_time=2.95907 
Train Epoch: 24 [153/500 9792/32000 (31%)] Loss: 0.78537 (QuantReg: 13.57352) QuantErr: 13.57352 batch_time=0.49630 
Train Epoch: 24 [161/500 10304/32000 (32%)] Loss: 0.66266 (QuantReg: 12.97945) QuantErr: 12.97945 batch_time=0.51183 
Train Epoch: 24 [169/500 10816/32000 (34%)] Loss: 0.46095 (QuantReg: 13.46932) QuantErr: 13.46932 batch_time=0.48311 
Train Epoch: 24 [177/500 11328/32000 (35%)] Loss: 0.87902 (QuantReg: 13.12843) QuantErr: 13.12843 batch_time=0.49796 
Train Epoch: 24 [185/500 11840/32000 (37%)] Loss: 0.90534 (QuantReg: 13.46297) QuantErr: 13.46297 batch_time=0.46881 
Train Epoch: 24 [193/500 12352/32000 (39%)] Loss: 0.57777 (QuantReg: 13.75378) QuantErr: 13.75378 batch_time=0.82586 
Train Epoch: 24 [201/500 12864/32000 (40%)] Loss: 0.59374 (QuantReg: 13.38864) QuantErr: 13.38864 batch_time=1.86343 
Train Epoch: 24 [209/500 13376/32000 (42%)] Loss: 0.92543 (QuantReg: 13.45513) QuantErr: 13.45513 batch_time=3.26740 
Train Epoch: 24 [217/500 13888/32000 (43%)] Loss: 0.68552 (QuantReg: 13.36381) QuantErr: 13.36381 batch_time=0.43536 
Train Epoch: 24 [225/500 14400/32000 (45%)] Loss: 0.33722 (QuantReg: 13.57562) QuantErr: 13.57562 batch_time=0.41452 
Train Epoch: 24 [233/500 14912/32000 (47%)] Loss: 1.00549 (QuantReg: 12.74180) QuantErr: 12.74180 batch_time=0.46027 
Train Epoch: 24 [241/500 15424/32000 (48%)] Loss: 0.50692 (QuantReg: 13.45311) QuantErr: 13.45311 batch_time=0.47909 
Train Epoch: 24 [249/500 15936/32000 (50%)] Loss: 0.86526 (QuantReg: 12.86071) QuantErr: 12.86071 batch_time=0.52214 
Train Epoch: 24 [257/500 16448/32000 (51%)] Loss: 0.63221 (QuantReg: 13.74886) QuantErr: 13.74886 batch_time=0.81287 
Train Epoch: 24 [265/500 16960/32000 (53%)] Loss: 0.68467 (QuantReg: 14.00173) QuantErr: 14.00173 batch_time=1.80136 
Train Epoch: 24 [273/500 17472/32000 (55%)] Loss: 0.60208 (QuantReg: 13.28804) QuantErr: 13.28804 batch_time=2.81801 
Train Epoch: 24 [281/500 17984/32000 (56%)] Loss: 0.85529 (QuantReg: 13.56215) QuantErr: 13.56215 batch_time=0.45208 
Train Epoch: 24 [289/500 18496/32000 (58%)] Loss: 1.03494 (QuantReg: 13.30427) QuantErr: 13.30427 batch_time=0.45091 
Train Epoch: 24 [297/500 19008/32000 (59%)] Loss: 1.08085 (QuantReg: 13.77374) QuantErr: 13.77374 batch_time=0.44944 
Train Epoch: 24 [305/500 19520/32000 (61%)] Loss: 0.84276 (QuantReg: 13.01661) QuantErr: 13.01661 batch_time=0.43325 
Train Epoch: 24 [313/500 20032/32000 (63%)] Loss: 0.62739 (QuantReg: 13.20413) QuantErr: 13.20413 batch_time=0.44419 
Train Epoch: 24 [321/500 20544/32000 (64%)] Loss: 0.51479 (QuantReg: 13.23312) QuantErr: 13.23312 batch_time=0.83362 
Train Epoch: 24 [329/500 21056/32000 (66%)] Loss: 0.36800 (QuantReg: 13.63311) QuantErr: 13.63311 batch_time=1.96471 
Train Epoch: 24 [337/500 21568/32000 (67%)] Loss: 0.56281 (QuantReg: 13.59825) QuantErr: 13.59825 batch_time=2.80216 
Train Epoch: 24 [345/500 22080/32000 (69%)] Loss: 0.65613 (QuantReg: 13.16691) QuantErr: 13.16691 batch_time=0.44929 
Train Epoch: 24 [353/500 22592/32000 (71%)] Loss: 0.68618 (QuantReg: 13.44649) QuantErr: 13.44649 batch_time=0.41905 
Train Epoch: 24 [361/500 23104/32000 (72%)] Loss: 0.74198 (QuantReg: 13.18019) QuantErr: 13.18019 batch_time=0.40270 
Train Epoch: 24 [369/500 23616/32000 (74%)] Loss: 0.30190 (QuantReg: 13.49960) QuantErr: 13.49960 batch_time=0.44151 
Train Epoch: 24 [377/500 24128/32000 (75%)] Loss: 0.50748 (QuantReg: 13.94067) QuantErr: 13.94067 batch_time=0.44664 
Train Epoch: 24 [385/500 24640/32000 (77%)] Loss: 0.61622 (QuantReg: 13.15110) QuantErr: 13.15110 batch_time=0.87806 
Train Epoch: 24 [393/500 25152/32000 (79%)] Loss: 0.88395 (QuantReg: 12.82265) QuantErr: 12.82265 batch_time=1.88552 
Train Epoch: 24 [401/500 25664/32000 (80%)] Loss: 0.66636 (QuantReg: 13.64963) QuantErr: 13.64963 batch_time=2.85027 
Train Epoch: 24 [409/500 26176/32000 (82%)] Loss: 0.82961 (QuantReg: 13.24422) QuantErr: 13.24422 batch_time=0.45278 
Train Epoch: 24 [417/500 26688/32000 (83%)] Loss: 0.34777 (QuantReg: 13.24073) QuantErr: 13.24073 batch_time=0.40807 
Train Epoch: 24 [425/500 27200/32000 (85%)] Loss: 0.74505 (QuantReg: 13.58752) QuantErr: 13.58752 batch_time=0.44003 
Train Epoch: 24 [433/500 27712/32000 (87%)] Loss: 0.68465 (QuantReg: 13.85551) QuantErr: 13.85551 batch_time=0.43799 
Train Epoch: 24 [441/500 28224/32000 (88%)] Loss: 0.76300 (QuantReg: 13.26994) QuantErr: 13.26994 batch_time=0.41638 
Train Epoch: 24 [449/500 28736/32000 (90%)] Loss: 0.68752 (QuantReg: 13.21895) QuantErr: 13.21895 batch_time=0.73648 
Train Epoch: 24 [457/500 29248/32000 (91%)] Loss: 0.38051 (QuantReg: 13.18534) QuantErr: 13.18534 batch_time=1.67382 
Train Epoch: 24 [465/500 29760/32000 (93%)] Loss: 0.78949 (QuantReg: 13.38183) QuantErr: 13.38183 batch_time=2.73555 
Train Epoch: 24 [473/500 30272/32000 (95%)] Loss: 0.76311 (QuantReg: 12.66131) QuantErr: 12.66131 batch_time=0.46468 
Train Epoch: 24 [481/500 30784/32000 (96%)] Loss: 0.73832 (QuantReg: 13.49314) QuantErr: 13.49314 batch_time=0.41776 
Train Epoch: 24 [489/500 31296/32000 (98%)] Loss: 0.72329 (QuantReg: 12.50946) QuantErr: 12.50946 batch_time=0.48562 
Train Epoch: 24 [497/500 31808/32000 (99%)] Loss: 0.82588 (QuantReg: 13.41394) QuantErr: 13.41394 batch_time=0.42096 
Train Epoch: 24 codebook_update_time=2.95590
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch24.pth ...
Done in 5.165s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 0.7063756468892097
 quant_reg      : 13.339495834350586
 quant_err      : 13.339495834350586
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 12000
 MSRVTT_miech_test/t2v_metrics/R1: 20.0
 MSRVTT_miech_test/t2v_metrics/R5: 48.4
 MSRVTT_miech_test/t2v_metrics/R10: 63.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.0
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.996
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 39.465386544389226
 MSRVTT_miech_test/v2t_metrics/R1: 18.9
 MSRVTT_miech_test/v2t_metrics/R5: 51.7
 MSRVTT_miech_test/v2t_metrics/R10: 64.2
 MSRVTT_miech_test/v2t_metrics/R50: 88.9
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.107
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 39.73401564511037
 mnt_best       : 40.63635269621589
 not_improved_count: 1
Train Epoch: 25 [1/500 64/32000 (0%)] Loss: 0.52810 (QuantReg: 13.39203) QuantErr: 13.39203 batch_time=30.57357 
Train Epoch: 25 [9/500 576/32000 (2%)] Loss: 1.07579 (QuantReg: 13.16174) QuantErr: 13.16174 batch_time=0.41331 
Train Epoch: 25 [17/500 1088/32000 (3%)] Loss: 0.36045 (QuantReg: 13.57792) QuantErr: 13.57792 batch_time=1.68338 
Train Epoch: 25 [25/500 1600/32000 (5%)] Loss: 0.56825 (QuantReg: 12.88113) QuantErr: 12.88113 batch_time=0.42606 
Train Epoch: 25 [33/500 2112/32000 (7%)] Loss: 0.75090 (QuantReg: 13.27646) QuantErr: 13.27646 batch_time=0.52111 
Train Epoch: 25 [41/500 2624/32000 (8%)] Loss: 0.50313 (QuantReg: 13.21367) QuantErr: 13.21367 batch_time=0.48767 
Train Epoch: 25 [49/500 3136/32000 (10%)] Loss: 0.89084 (QuantReg: 13.26914) QuantErr: 13.26914 batch_time=0.48265 
Train Epoch: 25 [57/500 3648/32000 (11%)] Loss: 0.50163 (QuantReg: 13.37976) QuantErr: 13.37976 batch_time=0.46185 
Train Epoch: 25 [65/500 4160/32000 (13%)] Loss: 0.84467 (QuantReg: 13.62049) QuantErr: 13.62049 batch_time=0.53191 
Train Epoch: 25 [73/500 4672/32000 (15%)] Loss: 0.89583 (QuantReg: 13.07209) QuantErr: 13.07209 batch_time=0.39945 
Train Epoch: 25 [81/500 5184/32000 (16%)] Loss: 0.44362 (QuantReg: 13.55662) QuantErr: 13.55662 batch_time=1.26217 
Train Epoch: 25 [89/500 5696/32000 (18%)] Loss: 0.57926 (QuantReg: 13.32858) QuantErr: 13.32858 batch_time=0.41733 
Train Epoch: 25 [97/500 6208/32000 (19%)] Loss: 0.57869 (QuantReg: 13.56275) QuantErr: 13.56275 batch_time=0.48677 
Train Epoch: 25 [105/500 6720/32000 (21%)] Loss: 0.36295 (QuantReg: 13.43739) QuantErr: 13.43739 batch_time=0.45826 
Train Epoch: 25 [113/500 7232/32000 (23%)] Loss: 0.90029 (QuantReg: 13.46888) QuantErr: 13.46888 batch_time=0.41905 
Train Epoch: 25 [121/500 7744/32000 (24%)] Loss: 0.71333 (QuantReg: 13.60291) QuantErr: 13.60291 batch_time=0.43681 
Train Epoch: 25 [129/500 8256/32000 (26%)] Loss: 0.81954 (QuantReg: 13.96942) QuantErr: 13.96942 batch_time=0.39933 
Train Epoch: 25 [137/500 8768/32000 (27%)] Loss: 0.70246 (QuantReg: 13.39556) QuantErr: 13.39556 batch_time=0.48754 
Train Epoch: 25 [145/500 9280/32000 (29%)] Loss: 0.50618 (QuantReg: 13.91413) QuantErr: 13.91413 batch_time=1.22627 
Train Epoch: 25 [153/500 9792/32000 (31%)] Loss: 0.95177 (QuantReg: 13.01408) QuantErr: 13.01408 batch_time=0.43072 
Train Epoch: 25 [161/500 10304/32000 (32%)] Loss: 0.62759 (QuantReg: 13.53800) QuantErr: 13.53800 batch_time=0.41817 
Train Epoch: 25 [169/500 10816/32000 (34%)] Loss: 0.37427 (QuantReg: 13.00279) QuantErr: 13.00279 batch_time=0.41577 
Train Epoch: 25 [177/500 11328/32000 (35%)] Loss: 0.76538 (QuantReg: 13.33641) QuantErr: 13.33641 batch_time=0.40270 
Train Epoch: 25 [185/500 11840/32000 (37%)] Loss: 0.82569 (QuantReg: 13.29855) QuantErr: 13.29855 batch_time=0.43233 
Train Epoch: 25 [193/500 12352/32000 (39%)] Loss: 0.71429 (QuantReg: 13.51723) QuantErr: 13.51723 batch_time=0.46222 
Train Epoch: 25 [201/500 12864/32000 (40%)] Loss: 0.59591 (QuantReg: 13.10399) QuantErr: 13.10399 batch_time=0.51189 
Train Epoch: 25 [209/500 13376/32000 (42%)] Loss: 0.54859 (QuantReg: 13.28625) QuantErr: 13.28625 batch_time=1.19144 
Train Epoch: 25 [217/500 13888/32000 (43%)] Loss: 0.78000 (QuantReg: 13.55454) QuantErr: 13.55454 batch_time=0.48341 
Train Epoch: 25 [225/500 14400/32000 (45%)] Loss: 0.78854 (QuantReg: 13.74381) QuantErr: 13.74381 batch_time=0.41048 
Train Epoch: 25 [233/500 14912/32000 (47%)] Loss: 0.84239 (QuantReg: 13.09358) QuantErr: 13.09358 batch_time=0.39672 
Train Epoch: 25 [241/500 15424/32000 (48%)] Loss: 0.70002 (QuantReg: 13.42739) QuantErr: 13.42739 batch_time=0.40723 
Train Epoch: 25 [249/500 15936/32000 (50%)] Loss: 0.55405 (QuantReg: 13.72151) QuantErr: 13.72151 batch_time=0.44541 
Train Epoch: 25 [257/500 16448/32000 (51%)] Loss: 0.89386 (QuantReg: 13.67220) QuantErr: 13.67220 batch_time=0.46603 
Train Epoch: 25 [265/500 16960/32000 (53%)] Loss: 0.71713 (QuantReg: 13.39457) QuantErr: 13.39457 batch_time=0.43178 
Train Epoch: 25 [273/500 17472/32000 (55%)] Loss: 0.66241 (QuantReg: 13.49169) QuantErr: 13.49169 batch_time=1.18108 
Train Epoch: 25 [281/500 17984/32000 (56%)] Loss: 0.94040 (QuantReg: 13.47982) QuantErr: 13.47982 batch_time=0.39759 
Train Epoch: 25 [289/500 18496/32000 (58%)] Loss: 0.68147 (QuantReg: 13.57186) QuantErr: 13.57186 batch_time=0.46804 
Train Epoch: 25 [297/500 19008/32000 (59%)] Loss: 0.78625 (QuantReg: 13.12657) QuantErr: 13.12657 batch_time=0.45243 
Train Epoch: 25 [305/500 19520/32000 (61%)] Loss: 0.70540 (QuantReg: 13.28534) QuantErr: 13.28534 batch_time=0.52646 
Train Epoch: 25 [313/500 20032/32000 (63%)] Loss: 0.60117 (QuantReg: 13.80717) QuantErr: 13.80717 batch_time=0.48855 
Train Epoch: 25 [321/500 20544/32000 (64%)] Loss: 0.60913 (QuantReg: 13.50293) QuantErr: 13.50293 batch_time=0.58154 
Train Epoch: 25 [329/500 21056/32000 (66%)] Loss: 0.54654 (QuantReg: 13.60431) QuantErr: 13.60431 batch_time=0.45771 
Train Epoch: 25 [337/500 21568/32000 (67%)] Loss: 0.70065 (QuantReg: 13.29010) QuantErr: 13.29010 batch_time=1.10177 
Train Epoch: 25 [345/500 22080/32000 (69%)] Loss: 0.71259 (QuantReg: 13.59880) QuantErr: 13.59880 batch_time=0.46735 
Train Epoch: 25 [353/500 22592/32000 (71%)] Loss: 0.76489 (QuantReg: 13.06832) QuantErr: 13.06832 batch_time=0.51382 
Train Epoch: 25 [361/500 23104/32000 (72%)] Loss: 0.77440 (QuantReg: 13.56318) QuantErr: 13.56318 batch_time=0.48940 
Train Epoch: 25 [369/500 23616/32000 (74%)] Loss: 0.51427 (QuantReg: 13.44963) QuantErr: 13.44963 batch_time=0.57823 
Train Epoch: 25 [377/500 24128/32000 (75%)] Loss: 0.54438 (QuantReg: 13.71114) QuantErr: 13.71114 batch_time=0.53226 
Train Epoch: 25 [385/500 24640/32000 (77%)] Loss: 0.67570 (QuantReg: 13.52472) QuantErr: 13.52472 batch_time=0.43192 
Train Epoch: 25 [393/500 25152/32000 (79%)] Loss: 0.73527 (QuantReg: 13.35890) QuantErr: 13.35890 batch_time=0.41979 
Train Epoch: 25 [401/500 25664/32000 (80%)] Loss: 0.57671 (QuantReg: 13.62108) QuantErr: 13.62108 batch_time=1.11892 
Train Epoch: 25 [409/500 26176/32000 (82%)] Loss: 0.68405 (QuantReg: 14.03256) QuantErr: 14.03256 batch_time=0.46547 
Train Epoch: 25 [417/500 26688/32000 (83%)] Loss: 0.45450 (QuantReg: 13.49887) QuantErr: 13.49887 batch_time=0.41328 
Train Epoch: 25 [425/500 27200/32000 (85%)] Loss: 0.43227 (QuantReg: 13.70208) QuantErr: 13.70208 batch_time=0.44357 
Train Epoch: 25 [433/500 27712/32000 (87%)] Loss: 0.72287 (QuantReg: 13.28148) QuantErr: 13.28148 batch_time=0.42085 
Train Epoch: 25 [441/500 28224/32000 (88%)] Loss: 0.65437 (QuantReg: 13.51911) QuantErr: 13.51911 batch_time=0.46793 
Train Epoch: 25 [449/500 28736/32000 (90%)] Loss: 1.06052 (QuantReg: 13.52341) QuantErr: 13.52341 batch_time=0.49650 
Train Epoch: 25 [457/500 29248/32000 (91%)] Loss: 0.25145 (QuantReg: 13.80611) QuantErr: 13.80611 batch_time=0.45051 
Train Epoch: 25 [465/500 29760/32000 (93%)] Loss: 1.06372 (QuantReg: 13.27857) QuantErr: 13.27857 batch_time=1.31475 
Train Epoch: 25 [473/500 30272/32000 (95%)] Loss: 0.68828 (QuantReg: 13.70173) QuantErr: 13.70173 batch_time=0.55571 
Train Epoch: 25 [481/500 30784/32000 (96%)] Loss: 0.39322 (QuantReg: 13.67638) QuantErr: 13.67638 batch_time=0.48102 
Train Epoch: 25 [489/500 31296/32000 (98%)] Loss: 0.50771 (QuantReg: 13.74028) QuantErr: 13.74028 batch_time=0.48416 
Train Epoch: 25 [497/500 31808/32000 (99%)] Loss: 0.79531 (QuantReg: 13.73401) QuantErr: 13.73401 batch_time=0.47177 
Train Epoch: 25 codebook_update_time=2.75103
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch25.pth ...
Done in 5.187s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch25.pth ...
Done in 10.265s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 0.6830437286496163
 quant_reg      : 13.399744441986083
 quant_err      : 13.399744441986083
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 12500
 MSRVTT_miech_test/t2v_metrics/R1: 21.7
 MSRVTT_miech_test/t2v_metrics/R5: 48.9
 MSRVTT_miech_test/t2v_metrics/R10: 63.3
 MSRVTT_miech_test/t2v_metrics/R50: 87.1
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.145
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.64970838060064
 MSRVTT_miech_test/v2t_metrics/R1: 20.3
 MSRVTT_miech_test/v2t_metrics/R5: 51.1
 MSRVTT_miech_test/v2t_metrics/R10: 64.4
 MSRVTT_miech_test/v2t_metrics/R50: 88.7
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.2275
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.575847703996814
 mnt_best       : 40.64970838060064
 not_improved_count: 0
Train Epoch: 26 [1/500 64/32000 (0%)] Loss: 0.62628 (QuantReg: 13.49817) QuantErr: 13.49817 batch_time=30.19379 
Train Epoch: 26 [9/500 576/32000 (2%)] Loss: 0.58555 (QuantReg: 13.23278) QuantErr: 13.23278 batch_time=0.44499 
Train Epoch: 26 [17/500 1088/32000 (3%)] Loss: 0.60253 (QuantReg: 13.40176) QuantErr: 13.40176 batch_time=0.55959 
Train Epoch: 26 [25/500 1600/32000 (5%)] Loss: 0.95323 (QuantReg: 13.34647) QuantErr: 13.34647 batch_time=0.48298 
Train Epoch: 26 [33/500 2112/32000 (7%)] Loss: 0.79909 (QuantReg: 13.12561) QuantErr: 13.12561 batch_time=0.48170 
Train Epoch: 26 [41/500 2624/32000 (8%)] Loss: 0.60764 (QuantReg: 13.49002) QuantErr: 13.49002 batch_time=0.39405 
Train Epoch: 26 [49/500 3136/32000 (10%)] Loss: 0.87591 (QuantReg: 13.19910) QuantErr: 13.19910 batch_time=0.41126 
Train Epoch: 26 [57/500 3648/32000 (11%)] Loss: 0.60848 (QuantReg: 13.16029) QuantErr: 13.16029 batch_time=0.46553 
Train Epoch: 26 [65/500 4160/32000 (13%)] Loss: 0.60084 (QuantReg: 13.84473) QuantErr: 13.84473 batch_time=0.95591 
Train Epoch: 26 [73/500 4672/32000 (15%)] Loss: 0.88503 (QuantReg: 12.95675) QuantErr: 12.95675 batch_time=0.47307 
Train Epoch: 26 [81/500 5184/32000 (16%)] Loss: 0.55925 (QuantReg: 13.30164) QuantErr: 13.30164 batch_time=0.48840 
Train Epoch: 26 [89/500 5696/32000 (18%)] Loss: 0.55131 (QuantReg: 13.26203) QuantErr: 13.26203 batch_time=0.55592 
Train Epoch: 26 [97/500 6208/32000 (19%)] Loss: 0.65982 (QuantReg: 13.37020) QuantErr: 13.37020 batch_time=0.50833 
Train Epoch: 26 [105/500 6720/32000 (21%)] Loss: 0.37213 (QuantReg: 13.72361) QuantErr: 13.72361 batch_time=0.41314 
Train Epoch: 26 [113/500 7232/32000 (23%)] Loss: 0.59327 (QuantReg: 13.49727) QuantErr: 13.49727 batch_time=0.53390 
Train Epoch: 26 [121/500 7744/32000 (24%)] Loss: 0.53578 (QuantReg: 13.51529) QuantErr: 13.51529 batch_time=0.49016 
Train Epoch: 26 [129/500 8256/32000 (26%)] Loss: 0.73294 (QuantReg: 14.08800) QuantErr: 14.08800 batch_time=0.96766 
Train Epoch: 26 [137/500 8768/32000 (27%)] Loss: 0.65728 (QuantReg: 13.08296) QuantErr: 13.08296 batch_time=0.45068 
Train Epoch: 26 [145/500 9280/32000 (29%)] Loss: 0.45994 (QuantReg: 13.84877) QuantErr: 13.84877 batch_time=0.40868 
Train Epoch: 26 [153/500 9792/32000 (31%)] Loss: 0.93377 (QuantReg: 13.28422) QuantErr: 13.28422 batch_time=0.50462 
Train Epoch: 26 [161/500 10304/32000 (32%)] Loss: 0.49569 (QuantReg: 13.99241) QuantErr: 13.99241 batch_time=0.48611 
Train Epoch: 26 [169/500 10816/32000 (34%)] Loss: 0.59519 (QuantReg: 13.79861) QuantErr: 13.79861 batch_time=0.39693 
Train Epoch: 26 [177/500 11328/32000 (35%)] Loss: 0.43355 (QuantReg: 13.87437) QuantErr: 13.87437 batch_time=0.45662 
Train Epoch: 26 [185/500 11840/32000 (37%)] Loss: 1.00281 (QuantReg: 13.10678) QuantErr: 13.10678 batch_time=0.41766 
Train Epoch: 26 [193/500 12352/32000 (39%)] Loss: 0.52586 (QuantReg: 13.79223) QuantErr: 13.79223 batch_time=0.91001 
Train Epoch: 26 [201/500 12864/32000 (40%)] Loss: 0.77151 (QuantReg: 13.43658) QuantErr: 13.43658 batch_time=0.40436 
Train Epoch: 26 [209/500 13376/32000 (42%)] Loss: 0.61596 (QuantReg: 13.67394) QuantErr: 13.67394 batch_time=0.42000 
Train Epoch: 26 [217/500 13888/32000 (43%)] Loss: 0.61902 (QuantReg: 13.40679) QuantErr: 13.40679 batch_time=0.45179 
Train Epoch: 26 [225/500 14400/32000 (45%)] Loss: 0.68639 (QuantReg: 13.57854) QuantErr: 13.57854 batch_time=0.46346 
Train Epoch: 26 [233/500 14912/32000 (47%)] Loss: 0.83164 (QuantReg: 13.00635) QuantErr: 13.00635 batch_time=0.49935 
Train Epoch: 26 [241/500 15424/32000 (48%)] Loss: 0.57736 (QuantReg: 13.27718) QuantErr: 13.27718 batch_time=0.43705 
Train Epoch: 26 [249/500 15936/32000 (50%)] Loss: 0.62167 (QuantReg: 13.74407) QuantErr: 13.74407 batch_time=0.45530 
Train Epoch: 26 [257/500 16448/32000 (51%)] Loss: 0.61065 (QuantReg: 13.58030) QuantErr: 13.58030 batch_time=0.81522 
Train Epoch: 26 [265/500 16960/32000 (53%)] Loss: 0.60031 (QuantReg: 13.56256) QuantErr: 13.56256 batch_time=0.44701 
Train Epoch: 26 [273/500 17472/32000 (55%)] Loss: 0.57102 (QuantReg: 13.17892) QuantErr: 13.17892 batch_time=0.48894 
Train Epoch: 26 [281/500 17984/32000 (56%)] Loss: 1.14819 (QuantReg: 13.32734) QuantErr: 13.32734 batch_time=0.57247 
Train Epoch: 26 [289/500 18496/32000 (58%)] Loss: 0.70414 (QuantReg: 13.76618) QuantErr: 13.76618 batch_time=0.44744 
Train Epoch: 26 [297/500 19008/32000 (59%)] Loss: 0.73244 (QuantReg: 13.24239) QuantErr: 13.24239 batch_time=0.46709 
Train Epoch: 26 [305/500 19520/32000 (61%)] Loss: 0.47903 (QuantReg: 13.66756) QuantErr: 13.66756 batch_time=0.42462 
Train Epoch: 26 [313/500 20032/32000 (63%)] Loss: 1.06201 (QuantReg: 13.50159) QuantErr: 13.50159 batch_time=0.42752 
Train Epoch: 26 [321/500 20544/32000 (64%)] Loss: 0.66926 (QuantReg: 13.68311) QuantErr: 13.68311 batch_time=0.92397 
Train Epoch: 26 [329/500 21056/32000 (66%)] Loss: 0.58982 (QuantReg: 12.78869) QuantErr: 12.78869 batch_time=0.40257 
Train Epoch: 26 [337/500 21568/32000 (67%)] Loss: 0.91814 (QuantReg: 13.14395) QuantErr: 13.14395 batch_time=0.41103 
Train Epoch: 26 [345/500 22080/32000 (69%)] Loss: 0.51776 (QuantReg: 13.43258) QuantErr: 13.43258 batch_time=0.48204 
Train Epoch: 26 [353/500 22592/32000 (71%)] Loss: 0.50193 (QuantReg: 13.51844) QuantErr: 13.51844 batch_time=0.50501 
Train Epoch: 26 [361/500 23104/32000 (72%)] Loss: 0.47577 (QuantReg: 13.30837) QuantErr: 13.30837 batch_time=0.39961 
Train Epoch: 26 [369/500 23616/32000 (74%)] Loss: 0.99849 (QuantReg: 13.20101) QuantErr: 13.20101 batch_time=0.45905 
Train Epoch: 26 [377/500 24128/32000 (75%)] Loss: 0.50265 (QuantReg: 13.60572) QuantErr: 13.60572 batch_time=0.53446 
Train Epoch: 26 [385/500 24640/32000 (77%)] Loss: 0.62136 (QuantReg: 13.52812) QuantErr: 13.52812 batch_time=0.94394 
Train Epoch: 26 [393/500 25152/32000 (79%)] Loss: 1.02064 (QuantReg: 13.57939) QuantErr: 13.57939 batch_time=0.48844 
Train Epoch: 26 [401/500 25664/32000 (80%)] Loss: 0.77441 (QuantReg: 13.48896) QuantErr: 13.48896 batch_time=0.44374 
Train Epoch: 26 [409/500 26176/32000 (82%)] Loss: 0.70888 (QuantReg: 13.48080) QuantErr: 13.48080 batch_time=0.42114 
Train Epoch: 26 [417/500 26688/32000 (83%)] Loss: 0.59127 (QuantReg: 13.90234) QuantErr: 13.90234 batch_time=0.43739 
Train Epoch: 26 [425/500 27200/32000 (85%)] Loss: 0.79910 (QuantReg: 13.86082) QuantErr: 13.86082 batch_time=0.43189 
Train Epoch: 26 [433/500 27712/32000 (87%)] Loss: 0.48993 (QuantReg: 13.80400) QuantErr: 13.80400 batch_time=0.50674 
Train Epoch: 26 [441/500 28224/32000 (88%)] Loss: 0.58628 (QuantReg: 13.50684) QuantErr: 13.50684 batch_time=0.41454 
Train Epoch: 26 [449/500 28736/32000 (90%)] Loss: 0.93503 (QuantReg: 13.35023) QuantErr: 13.35023 batch_time=1.03731 
Train Epoch: 26 [457/500 29248/32000 (91%)] Loss: 0.52637 (QuantReg: 13.42029) QuantErr: 13.42029 batch_time=0.55038 
Train Epoch: 26 [465/500 29760/32000 (93%)] Loss: 0.84014 (QuantReg: 14.00562) QuantErr: 14.00562 batch_time=0.44068 
Train Epoch: 26 [473/500 30272/32000 (95%)] Loss: 0.93939 (QuantReg: 13.85771) QuantErr: 13.85771 batch_time=0.44059 
Train Epoch: 26 [481/500 30784/32000 (96%)] Loss: 0.59357 (QuantReg: 13.63622) QuantErr: 13.63622 batch_time=0.48169 
Train Epoch: 26 [489/500 31296/32000 (98%)] Loss: 0.56103 (QuantReg: 13.63135) QuantErr: 13.63135 batch_time=0.43473 
Train Epoch: 26 [497/500 31808/32000 (99%)] Loss: 0.64098 (QuantReg: 13.45266) QuantErr: 13.45266 batch_time=0.43410 
Train Epoch: 26 codebook_update_time=2.08862
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch26.pth ...
Done in 5.193s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 0.6626473046541214
 quant_reg      : 13.455798307418823
 quant_err      : 13.455798307418823
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 13000
 MSRVTT_miech_test/t2v_metrics/R1: 20.1
 MSRVTT_miech_test/t2v_metrics/R5: 50.3
 MSRVTT_miech_test/t2v_metrics/R10: 63.1
 MSRVTT_miech_test/t2v_metrics/R50: 88.2
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.352
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 39.957453302174905
 MSRVTT_miech_test/v2t_metrics/R1: 22.0
 MSRVTT_miech_test/v2t_metrics/R5: 50.4
 MSRVTT_miech_test/v2t_metrics/R10: 64.0
 MSRVTT_miech_test/v2t_metrics/R50: 89.5
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.6045
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.401022168979246
 mnt_best       : 40.64970838060064
 not_improved_count: 1
Train Epoch: 27 [1/500 64/32000 (0%)] Loss: 0.59506 (QuantReg: 13.42163) QuantErr: 13.42163 batch_time=30.69422 
Train Epoch: 27 [9/500 576/32000 (2%)] Loss: 0.73323 (QuantReg: 13.41047) QuantErr: 13.41047 batch_time=0.50708 
Train Epoch: 27 [17/500 1088/32000 (3%)] Loss: 0.46756 (QuantReg: 13.43230) QuantErr: 13.43230 batch_time=0.44358 
Train Epoch: 27 [25/500 1600/32000 (5%)] Loss: 0.44262 (QuantReg: 13.76493) QuantErr: 13.76493 batch_time=0.43737 
Train Epoch: 27 [33/500 2112/32000 (7%)] Loss: 0.30544 (QuantReg: 13.59144) QuantErr: 13.59144 batch_time=0.49431 
Train Epoch: 27 [41/500 2624/32000 (8%)] Loss: 1.13879 (QuantReg: 12.45085) QuantErr: 12.45085 batch_time=0.48045 
Train Epoch: 27 [49/500 3136/32000 (10%)] Loss: 0.74007 (QuantReg: 12.96748) QuantErr: 12.96748 batch_time=0.54357 
Train Epoch: 27 [57/500 3648/32000 (11%)] Loss: 0.52814 (QuantReg: 13.41355) QuantErr: 13.41355 batch_time=0.46576 
Train Epoch: 27 [65/500 4160/32000 (13%)] Loss: 1.00058 (QuantReg: 13.03926) QuantErr: 13.03926 batch_time=0.45970 
Train Epoch: 27 [73/500 4672/32000 (15%)] Loss: 0.51376 (QuantReg: 13.26501) QuantErr: 13.26501 batch_time=0.45200 
Train Epoch: 27 [81/500 5184/32000 (16%)] Loss: 0.40009 (QuantReg: 13.49133) QuantErr: 13.49133 batch_time=0.47331 
Train Epoch: 27 [89/500 5696/32000 (18%)] Loss: 0.90586 (QuantReg: 13.28231) QuantErr: 13.28231 batch_time=0.46188 
Train Epoch: 27 [97/500 6208/32000 (19%)] Loss: 0.68923 (QuantReg: 13.17407) QuantErr: 13.17407 batch_time=0.42228 
Train Epoch: 27 [105/500 6720/32000 (21%)] Loss: 0.48903 (QuantReg: 13.82222) QuantErr: 13.82222 batch_time=0.46674 
Train Epoch: 27 [113/500 7232/32000 (23%)] Loss: 1.00390 (QuantReg: 13.74786) QuantErr: 13.74786 batch_time=0.47318 
Train Epoch: 27 [121/500 7744/32000 (24%)] Loss: 0.68185 (QuantReg: 13.57851) QuantErr: 13.57851 batch_time=0.43988 
Train Epoch: 27 [129/500 8256/32000 (26%)] Loss: 0.57300 (QuantReg: 13.59989) QuantErr: 13.59989 batch_time=0.41181 
Train Epoch: 27 [137/500 8768/32000 (27%)] Loss: 1.03890 (QuantReg: 13.27136) QuantErr: 13.27136 batch_time=0.44020 
Train Epoch: 27 [145/500 9280/32000 (29%)] Loss: 0.60709 (QuantReg: 13.36226) QuantErr: 13.36226 batch_time=0.53374 
Train Epoch: 27 [153/500 9792/32000 (31%)] Loss: 0.65078 (QuantReg: 12.75107) QuantErr: 12.75107 batch_time=0.55310 
Train Epoch: 27 [161/500 10304/32000 (32%)] Loss: 0.70310 (QuantReg: 13.27384) QuantErr: 13.27384 batch_time=0.43306 
Train Epoch: 27 [169/500 10816/32000 (34%)] Loss: 0.61596 (QuantReg: 13.25205) QuantErr: 13.25205 batch_time=0.52628 
Train Epoch: 27 [177/500 11328/32000 (35%)] Loss: 0.75988 (QuantReg: 13.40716) QuantErr: 13.40716 batch_time=0.45353 
Train Epoch: 27 [185/500 11840/32000 (37%)] Loss: 0.59107 (QuantReg: 13.59188) QuantErr: 13.59188 batch_time=0.46654 
Train Epoch: 27 [193/500 12352/32000 (39%)] Loss: 0.62723 (QuantReg: 13.19909) QuantErr: 13.19909 batch_time=0.47384 
Train Epoch: 27 [201/500 12864/32000 (40%)] Loss: 0.64594 (QuantReg: 13.58199) QuantErr: 13.58199 batch_time=0.51572 
Train Epoch: 27 [209/500 13376/32000 (42%)] Loss: 0.44465 (QuantReg: 13.49251) QuantErr: 13.49251 batch_time=0.46946 
Train Epoch: 27 [217/500 13888/32000 (43%)] Loss: 0.44694 (QuantReg: 13.57642) QuantErr: 13.57642 batch_time=0.46330 
Train Epoch: 27 [225/500 14400/32000 (45%)] Loss: 0.77790 (QuantReg: 13.69375) QuantErr: 13.69375 batch_time=0.46583 
Train Epoch: 27 [233/500 14912/32000 (47%)] Loss: 0.48822 (QuantReg: 13.57186) QuantErr: 13.57186 batch_time=0.44803 
Train Epoch: 27 [241/500 15424/32000 (48%)] Loss: 0.51650 (QuantReg: 13.57022) QuantErr: 13.57022 batch_time=0.51968 
Train Epoch: 27 [249/500 15936/32000 (50%)] Loss: 0.51017 (QuantReg: 13.32077) QuantErr: 13.32077 batch_time=0.49222 
Train Epoch: 27 [257/500 16448/32000 (51%)] Loss: 0.35784 (QuantReg: 13.83268) QuantErr: 13.83268 batch_time=0.44788 
Train Epoch: 27 [265/500 16960/32000 (53%)] Loss: 0.37975 (QuantReg: 13.92359) QuantErr: 13.92359 batch_time=0.46196 
Train Epoch: 27 [273/500 17472/32000 (55%)] Loss: 0.43215 (QuantReg: 13.62172) QuantErr: 13.62172 batch_time=0.40114 
Train Epoch: 27 [281/500 17984/32000 (56%)] Loss: 0.59775 (QuantReg: 13.59305) QuantErr: 13.59305 batch_time=0.42156 
Train Epoch: 27 [289/500 18496/32000 (58%)] Loss: 0.68048 (QuantReg: 13.52176) QuantErr: 13.52176 batch_time=0.41094 
Train Epoch: 27 [297/500 19008/32000 (59%)] Loss: 0.69500 (QuantReg: 13.04073) QuantErr: 13.04073 batch_time=0.44807 
Train Epoch: 27 [305/500 19520/32000 (61%)] Loss: 1.07419 (QuantReg: 13.05695) QuantErr: 13.05695 batch_time=0.47686 
Train Epoch: 27 [313/500 20032/32000 (63%)] Loss: 0.59175 (QuantReg: 13.70017) QuantErr: 13.70017 batch_time=0.43132 
Train Epoch: 27 [321/500 20544/32000 (64%)] Loss: 0.46403 (QuantReg: 13.42167) QuantErr: 13.42167 batch_time=0.48629 
Train Epoch: 27 [329/500 21056/32000 (66%)] Loss: 0.62788 (QuantReg: 13.25878) QuantErr: 13.25878 batch_time=0.43501 
Train Epoch: 27 [337/500 21568/32000 (67%)] Loss: 0.71241 (QuantReg: 13.69313) QuantErr: 13.69313 batch_time=0.43920 
Train Epoch: 27 [345/500 22080/32000 (69%)] Loss: 0.39779 (QuantReg: 13.51170) QuantErr: 13.51170 batch_time=0.45486 
Train Epoch: 27 [353/500 22592/32000 (71%)] Loss: 0.85228 (QuantReg: 13.49013) QuantErr: 13.49013 batch_time=0.44959 
Train Epoch: 27 [361/500 23104/32000 (72%)] Loss: 0.65667 (QuantReg: 13.52162) QuantErr: 13.52162 batch_time=0.49168 
Train Epoch: 27 [369/500 23616/32000 (74%)] Loss: 0.51929 (QuantReg: 13.46531) QuantErr: 13.46531 batch_time=0.41863 
Train Epoch: 27 [377/500 24128/32000 (75%)] Loss: 0.85617 (QuantReg: 13.43730) QuantErr: 13.43730 batch_time=0.42119 
Train Epoch: 27 [385/500 24640/32000 (77%)] Loss: 0.64384 (QuantReg: 13.52688) QuantErr: 13.52688 batch_time=0.43864 
Train Epoch: 27 [393/500 25152/32000 (79%)] Loss: 0.98339 (QuantReg: 13.76579) QuantErr: 13.76579 batch_time=0.45565 
Train Epoch: 27 [401/500 25664/32000 (80%)] Loss: 0.56818 (QuantReg: 13.12011) QuantErr: 13.12011 batch_time=0.47921 
Train Epoch: 27 [409/500 26176/32000 (82%)] Loss: 0.78087 (QuantReg: 13.97700) QuantErr: 13.97700 batch_time=0.46572 
Train Epoch: 27 [417/500 26688/32000 (83%)] Loss: 0.55083 (QuantReg: 13.96964) QuantErr: 13.96964 batch_time=0.47461 
Train Epoch: 27 [425/500 27200/32000 (85%)] Loss: 0.84363 (QuantReg: 13.77075) QuantErr: 13.77075 batch_time=0.49443 
Train Epoch: 27 [433/500 27712/32000 (87%)] Loss: 0.39046 (QuantReg: 13.84057) QuantErr: 13.84057 batch_time=0.48944 
Train Epoch: 27 [441/500 28224/32000 (88%)] Loss: 0.49779 (QuantReg: 13.79931) QuantErr: 13.79931 batch_time=0.41695 
Train Epoch: 27 [449/500 28736/32000 (90%)] Loss: 0.48270 (QuantReg: 13.29895) QuantErr: 13.29895 batch_time=0.40046 
Train Epoch: 27 [457/500 29248/32000 (91%)] Loss: 0.55477 (QuantReg: 13.24952) QuantErr: 13.24952 batch_time=0.42635 
Train Epoch: 27 [465/500 29760/32000 (93%)] Loss: 0.63893 (QuantReg: 13.50871) QuantErr: 13.50871 batch_time=0.44076 
Train Epoch: 27 [473/500 30272/32000 (95%)] Loss: 0.67718 (QuantReg: 13.41881) QuantErr: 13.41881 batch_time=0.40221 
Train Epoch: 27 [481/500 30784/32000 (96%)] Loss: 0.55927 (QuantReg: 13.35120) QuantErr: 13.35120 batch_time=0.43425 
Train Epoch: 27 [489/500 31296/32000 (98%)] Loss: 0.74252 (QuantReg: 13.26252) QuantErr: 13.26252 batch_time=0.45944 
Train Epoch: 27 [497/500 31808/32000 (99%)] Loss: 0.46891 (QuantReg: 13.79951) QuantErr: 13.79951 batch_time=0.44531 
Train Epoch: 27 codebook_update_time=2.13669
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch27.pth ...
Done in 5.287s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch27.pth ...
Done in 10.688s
removing stale ckpt [epoch 26] [took 0.01s]
 epoch          : 27
 loss           : 0.6546289388537407
 quant_reg      : 13.476578966140748
 quant_err      : 13.476578966140748
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 13500
 MSRVTT_miech_test/t2v_metrics/R1: 22.3
 MSRVTT_miech_test/t2v_metrics/R5: 50.4
 MSRVTT_miech_test/t2v_metrics/R10: 64.2
 MSRVTT_miech_test/t2v_metrics/R50: 87.4
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.692
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.631635822190006
 MSRVTT_miech_test/v2t_metrics/R1: 21.6
 MSRVTT_miech_test/v2t_metrics/R5: 51.2
 MSRVTT_miech_test/v2t_metrics/R10: 64.2
 MSRVTT_miech_test/v2t_metrics/R50: 88.9
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.406
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.408189936118525
 mnt_best       : 41.631635822190006
 not_improved_count: 0
Train Epoch: 28 [1/500 64/32000 (0%)] Loss: 0.53989 (QuantReg: 13.03804) QuantErr: 13.03804 batch_time=31.31385 
Train Epoch: 28 [9/500 576/32000 (2%)] Loss: 0.58669 (QuantReg: 13.26717) QuantErr: 13.26717 batch_time=0.44418 
Train Epoch: 28 [17/500 1088/32000 (3%)] Loss: 0.70028 (QuantReg: 13.16644) QuantErr: 13.16644 batch_time=0.85029 
Train Epoch: 28 [25/500 1600/32000 (5%)] Loss: 0.70261 (QuantReg: 13.31306) QuantErr: 13.31306 batch_time=0.46422 
Train Epoch: 28 [33/500 2112/32000 (7%)] Loss: 0.92349 (QuantReg: 12.77568) QuantErr: 12.77568 batch_time=0.46511 
Train Epoch: 28 [41/500 2624/32000 (8%)] Loss: 0.70115 (QuantReg: 13.13148) QuantErr: 13.13148 batch_time=0.46676 
Train Epoch: 28 [49/500 3136/32000 (10%)] Loss: 0.51863 (QuantReg: 13.33929) QuantErr: 13.33929 batch_time=0.53886 
Train Epoch: 28 [57/500 3648/32000 (11%)] Loss: 0.39493 (QuantReg: 13.77576) QuantErr: 13.77576 batch_time=0.47924 
Train Epoch: 28 [65/500 4160/32000 (13%)] Loss: 1.14188 (QuantReg: 13.40773) QuantErr: 13.40773 batch_time=0.84221 
Train Epoch: 28 [73/500 4672/32000 (15%)] Loss: 0.54276 (QuantReg: 13.48980) QuantErr: 13.48980 batch_time=0.54460 
Train Epoch: 28 [81/500 5184/32000 (16%)] Loss: 0.93393 (QuantReg: 13.43654) QuantErr: 13.43654 batch_time=1.00717 
Train Epoch: 28 [89/500 5696/32000 (18%)] Loss: 0.94189 (QuantReg: 13.50697) QuantErr: 13.50697 batch_time=0.48448 
Train Epoch: 28 [97/500 6208/32000 (19%)] Loss: 0.98422 (QuantReg: 13.30147) QuantErr: 13.30147 batch_time=0.42584 
Train Epoch: 28 [105/500 6720/32000 (21%)] Loss: 0.84197 (QuantReg: 13.53480) QuantErr: 13.53480 batch_time=0.41051 
Train Epoch: 28 [113/500 7232/32000 (23%)] Loss: 0.47086 (QuantReg: 13.42045) QuantErr: 13.42045 batch_time=0.44871 
Train Epoch: 28 [121/500 7744/32000 (24%)] Loss: 0.69701 (QuantReg: 13.73111) QuantErr: 13.73111 batch_time=0.42891 
Train Epoch: 28 [129/500 8256/32000 (26%)] Loss: 0.88674 (QuantReg: 13.11574) QuantErr: 13.11574 batch_time=0.73697 
Train Epoch: 28 [137/500 8768/32000 (27%)] Loss: 0.62539 (QuantReg: 13.21683) QuantErr: 13.21683 batch_time=0.48746 
Train Epoch: 28 [145/500 9280/32000 (29%)] Loss: 0.53062 (QuantReg: 13.28970) QuantErr: 13.28970 batch_time=0.82485 
Train Epoch: 28 [153/500 9792/32000 (31%)] Loss: 0.49473 (QuantReg: 13.87013) QuantErr: 13.87013 batch_time=0.49084 
Train Epoch: 28 [161/500 10304/32000 (32%)] Loss: 0.69270 (QuantReg: 13.58417) QuantErr: 13.58417 batch_time=0.41097 
Train Epoch: 28 [169/500 10816/32000 (34%)] Loss: 0.40316 (QuantReg: 13.59081) QuantErr: 13.59081 batch_time=0.41071 
Train Epoch: 28 [177/500 11328/32000 (35%)] Loss: 0.70275 (QuantReg: 13.40836) QuantErr: 13.40836 batch_time=0.41097 
Train Epoch: 28 [185/500 11840/32000 (37%)] Loss: 0.42838 (QuantReg: 13.62186) QuantErr: 13.62186 batch_time=0.54542 
Train Epoch: 28 [193/500 12352/32000 (39%)] Loss: 0.48628 (QuantReg: 13.75867) QuantErr: 13.75867 batch_time=0.82969 
Train Epoch: 28 [201/500 12864/32000 (40%)] Loss: 0.47290 (QuantReg: 13.56962) QuantErr: 13.56962 batch_time=0.45256 
Train Epoch: 28 [209/500 13376/32000 (42%)] Loss: 0.68359 (QuantReg: 13.67458) QuantErr: 13.67458 batch_time=0.89147 
Train Epoch: 28 [217/500 13888/32000 (43%)] Loss: 0.62651 (QuantReg: 13.40618) QuantErr: 13.40618 batch_time=0.43143 
Train Epoch: 28 [225/500 14400/32000 (45%)] Loss: 0.94068 (QuantReg: 13.30487) QuantErr: 13.30487 batch_time=0.48001 
Train Epoch: 28 [233/500 14912/32000 (47%)] Loss: 0.79312 (QuantReg: 13.47919) QuantErr: 13.47919 batch_time=0.42822 
Train Epoch: 28 [241/500 15424/32000 (48%)] Loss: 0.82230 (QuantReg: 13.50934) QuantErr: 13.50934 batch_time=0.47248 
Train Epoch: 28 [249/500 15936/32000 (50%)] Loss: 0.48370 (QuantReg: 13.63625) QuantErr: 13.63625 batch_time=0.46989 
Train Epoch: 28 [257/500 16448/32000 (51%)] Loss: 0.67791 (QuantReg: 13.80901) QuantErr: 13.80901 batch_time=0.81798 
Train Epoch: 28 [265/500 16960/32000 (53%)] Loss: 0.44622 (QuantReg: 13.53253) QuantErr: 13.53253 batch_time=0.42508 
Train Epoch: 28 [273/500 17472/32000 (55%)] Loss: 0.69952 (QuantReg: 13.52829) QuantErr: 13.52829 batch_time=0.82043 
Train Epoch: 28 [281/500 17984/32000 (56%)] Loss: 0.60429 (QuantReg: 13.47907) QuantErr: 13.47907 batch_time=0.42391 
Train Epoch: 28 [289/500 18496/32000 (58%)] Loss: 0.66157 (QuantReg: 13.48997) QuantErr: 13.48997 batch_time=0.44104 
Train Epoch: 28 [297/500 19008/32000 (59%)] Loss: 0.91528 (QuantReg: 13.54942) QuantErr: 13.54942 batch_time=0.42879 
Train Epoch: 28 [305/500 19520/32000 (61%)] Loss: 0.64799 (QuantReg: 13.18824) QuantErr: 13.18824 batch_time=0.46153 
Train Epoch: 28 [313/500 20032/32000 (63%)] Loss: 0.69044 (QuantReg: 13.15074) QuantErr: 13.15074 batch_time=0.45825 
Train Epoch: 28 [321/500 20544/32000 (64%)] Loss: 0.60885 (QuantReg: 13.29231) QuantErr: 13.29231 batch_time=0.71625 
Train Epoch: 28 [329/500 21056/32000 (66%)] Loss: 0.34720 (QuantReg: 13.65082) QuantErr: 13.65082 batch_time=0.44894 
Train Epoch: 28 [337/500 21568/32000 (67%)] Loss: 0.93975 (QuantReg: 13.44195) QuantErr: 13.44195 batch_time=0.89321 
Train Epoch: 28 [345/500 22080/32000 (69%)] Loss: 0.48432 (QuantReg: 13.27854) QuantErr: 13.27854 batch_time=0.45772 
Train Epoch: 28 [353/500 22592/32000 (71%)] Loss: 0.95204 (QuantReg: 13.51574) QuantErr: 13.51574 batch_time=0.45140 
Train Epoch: 28 [361/500 23104/32000 (72%)] Loss: 0.87069 (QuantReg: 13.41220) QuantErr: 13.41220 batch_time=0.45050 
Train Epoch: 28 [369/500 23616/32000 (74%)] Loss: 0.75892 (QuantReg: 13.32963) QuantErr: 13.32963 batch_time=0.45355 
Train Epoch: 28 [377/500 24128/32000 (75%)] Loss: 0.48238 (QuantReg: 13.34930) QuantErr: 13.34930 batch_time=0.43593 
Train Epoch: 28 [385/500 24640/32000 (77%)] Loss: 0.50661 (QuantReg: 13.40849) QuantErr: 13.40849 batch_time=0.80236 
Train Epoch: 28 [393/500 25152/32000 (79%)] Loss: 0.86703 (QuantReg: 13.61208) QuantErr: 13.61208 batch_time=0.49335 
Train Epoch: 28 [401/500 25664/32000 (80%)] Loss: 1.12519 (QuantReg: 13.48307) QuantErr: 13.48307 batch_time=0.85097 
Train Epoch: 28 [409/500 26176/32000 (82%)] Loss: 0.66687 (QuantReg: 13.50278) QuantErr: 13.50278 batch_time=0.46385 
Train Epoch: 28 [417/500 26688/32000 (83%)] Loss: 0.37348 (QuantReg: 13.37680) QuantErr: 13.37680 batch_time=0.43928 
Train Epoch: 28 [425/500 27200/32000 (85%)] Loss: 0.62121 (QuantReg: 13.57025) QuantErr: 13.57025 batch_time=0.45161 
Train Epoch: 28 [433/500 27712/32000 (87%)] Loss: 0.67605 (QuantReg: 13.80147) QuantErr: 13.80147 batch_time=0.44330 
Train Epoch: 28 [441/500 28224/32000 (88%)] Loss: 1.36268 (QuantReg: 13.55769) QuantErr: 13.55769 batch_time=0.41413 
Train Epoch: 28 [449/500 28736/32000 (90%)] Loss: 0.55303 (QuantReg: 13.42517) QuantErr: 13.42517 batch_time=0.75616 
Train Epoch: 28 [457/500 29248/32000 (91%)] Loss: 0.78804 (QuantReg: 12.77467) QuantErr: 12.77467 batch_time=0.46433 
Train Epoch: 28 [465/500 29760/32000 (93%)] Loss: 0.59894 (QuantReg: 13.23877) QuantErr: 13.23877 batch_time=0.88776 
Train Epoch: 28 [473/500 30272/32000 (95%)] Loss: 0.72188 (QuantReg: 13.53313) QuantErr: 13.53313 batch_time=0.41496 
Train Epoch: 28 [481/500 30784/32000 (96%)] Loss: 0.84895 (QuantReg: 13.00129) QuantErr: 13.00129 batch_time=0.43307 
Train Epoch: 28 [489/500 31296/32000 (98%)] Loss: 0.43341 (QuantReg: 13.80784) QuantErr: 13.80784 batch_time=0.41481 
Train Epoch: 28 [497/500 31808/32000 (99%)] Loss: 0.67255 (QuantReg: 13.85398) QuantErr: 13.85398 batch_time=0.51035 
Train Epoch: 28 codebook_update_time=2.21639
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch28.pth ...
Done in 5.250s
removing stale ckpt [epoch 27] [took 0.00s]
 epoch          : 28
 loss           : 0.6533163934350014
 quant_reg      : 13.454847764968871
 quant_err      : 13.454847764968871
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 14000
 MSRVTT_miech_test/t2v_metrics/R1: 21.0
 MSRVTT_miech_test/t2v_metrics/R5: 49.8
 MSRVTT_miech_test/t2v_metrics/R10: 63.6
 MSRVTT_miech_test/t2v_metrics/R50: 87.3
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.683
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.51681057966474
 MSRVTT_miech_test/v2t_metrics/R1: 22.2
 MSRVTT_miech_test/v2t_metrics/R5: 50.3
 MSRVTT_miech_test/v2t_metrics/R10: 64.8
 MSRVTT_miech_test/v2t_metrics/R50: 89.2
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.609
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.670814420871295
 mnt_best       : 41.631635822190006
 not_improved_count: 1
Train Epoch: 29 [1/500 64/32000 (0%)] Loss: 0.74893 (QuantReg: 13.15711) QuantErr: 13.15711 batch_time=31.13069 
Train Epoch: 29 [9/500 576/32000 (2%)] Loss: 0.70210 (QuantReg: 13.48120) QuantErr: 13.48120 batch_time=0.41039 
Train Epoch: 29 [17/500 1088/32000 (3%)] Loss: 0.64113 (QuantReg: 13.52426) QuantErr: 13.52426 batch_time=0.46299 
Train Epoch: 29 [25/500 1600/32000 (5%)] Loss: 0.84586 (QuantReg: 13.84667) QuantErr: 13.84667 batch_time=0.46139 
Train Epoch: 29 [33/500 2112/32000 (7%)] Loss: 0.50182 (QuantReg: 13.36015) QuantErr: 13.36015 batch_time=0.43563 
Train Epoch: 29 [41/500 2624/32000 (8%)] Loss: 0.53031 (QuantReg: 13.35217) QuantErr: 13.35217 batch_time=0.48981 
Train Epoch: 29 [49/500 3136/32000 (10%)] Loss: 0.83174 (QuantReg: 13.25850) QuantErr: 13.25850 batch_time=0.44448 
Train Epoch: 29 [57/500 3648/32000 (11%)] Loss: 0.69016 (QuantReg: 13.70156) QuantErr: 13.70156 batch_time=0.46032 
Train Epoch: 29 [65/500 4160/32000 (13%)] Loss: 0.42162 (QuantReg: 13.72357) QuantErr: 13.72357 batch_time=0.77348 
Train Epoch: 29 [73/500 4672/32000 (15%)] Loss: 0.58835 (QuantReg: 13.81471) QuantErr: 13.81471 batch_time=0.48131 
Train Epoch: 29 [81/500 5184/32000 (16%)] Loss: 0.66400 (QuantReg: 13.77785) QuantErr: 13.77785 batch_time=0.44451 
Train Epoch: 29 [89/500 5696/32000 (18%)] Loss: 1.00751 (QuantReg: 13.36306) QuantErr: 13.36306 batch_time=0.47664 
Train Epoch: 29 [97/500 6208/32000 (19%)] Loss: 0.59570 (QuantReg: 13.36494) QuantErr: 13.36494 batch_time=0.42144 
Train Epoch: 29 [105/500 6720/32000 (21%)] Loss: 0.71255 (QuantReg: 13.30996) QuantErr: 13.30996 batch_time=0.49730 
Train Epoch: 29 [113/500 7232/32000 (23%)] Loss: 0.43124 (QuantReg: 13.08017) QuantErr: 13.08017 batch_time=0.44195 
Train Epoch: 29 [121/500 7744/32000 (24%)] Loss: 0.50503 (QuantReg: 13.60115) QuantErr: 13.60115 batch_time=0.40187 
Train Epoch: 29 [129/500 8256/32000 (26%)] Loss: 0.68324 (QuantReg: 13.57003) QuantErr: 13.57003 batch_time=0.69435 
Train Epoch: 29 [137/500 8768/32000 (27%)] Loss: 0.83608 (QuantReg: 13.78370) QuantErr: 13.78370 batch_time=0.44082 
Train Epoch: 29 [145/500 9280/32000 (29%)] Loss: 0.40098 (QuantReg: 13.31677) QuantErr: 13.31677 batch_time=0.48814 
Train Epoch: 29 [153/500 9792/32000 (31%)] Loss: 0.92398 (QuantReg: 13.74762) QuantErr: 13.74762 batch_time=0.46808 
Train Epoch: 29 [161/500 10304/32000 (32%)] Loss: 0.50683 (QuantReg: 13.60342) QuantErr: 13.60342 batch_time=0.44456 
Train Epoch: 29 [169/500 10816/32000 (34%)] Loss: 0.78321 (QuantReg: 13.87345) QuantErr: 13.87345 batch_time=0.52297 
Train Epoch: 29 [177/500 11328/32000 (35%)] Loss: 0.24027 (QuantReg: 13.32545) QuantErr: 13.32545 batch_time=0.50086 
Train Epoch: 29 [185/500 11840/32000 (37%)] Loss: 0.62662 (QuantReg: 13.69946) QuantErr: 13.69946 batch_time=0.46986 
Train Epoch: 29 [193/500 12352/32000 (39%)] Loss: 0.65300 (QuantReg: 13.41246) QuantErr: 13.41246 batch_time=0.75378 
Train Epoch: 29 [201/500 12864/32000 (40%)] Loss: 0.63891 (QuantReg: 13.97172) QuantErr: 13.97172 batch_time=0.46003 
Train Epoch: 29 [209/500 13376/32000 (42%)] Loss: 0.44189 (QuantReg: 13.31375) QuantErr: 13.31375 batch_time=0.42919 
Train Epoch: 29 [217/500 13888/32000 (43%)] Loss: 0.65880 (QuantReg: 13.53412) QuantErr: 13.53412 batch_time=0.46783 
Train Epoch: 29 [225/500 14400/32000 (45%)] Loss: 0.49093 (QuantReg: 13.41224) QuantErr: 13.41224 batch_time=0.47778 
Train Epoch: 29 [233/500 14912/32000 (47%)] Loss: 0.61994 (QuantReg: 13.36393) QuantErr: 13.36393 batch_time=0.49835 
Train Epoch: 29 [241/500 15424/32000 (48%)] Loss: 1.02519 (QuantReg: 13.67877) QuantErr: 13.67877 batch_time=0.43628 
Train Epoch: 29 [249/500 15936/32000 (50%)] Loss: 0.46951 (QuantReg: 13.56008) QuantErr: 13.56008 batch_time=0.45387 
Train Epoch: 29 [257/500 16448/32000 (51%)] Loss: 0.59364 (QuantReg: 13.82786) QuantErr: 13.82786 batch_time=0.73579 
Train Epoch: 29 [265/500 16960/32000 (53%)] Loss: 0.70441 (QuantReg: 13.76625) QuantErr: 13.76625 batch_time=0.44971 
Train Epoch: 29 [273/500 17472/32000 (55%)] Loss: 0.97290 (QuantReg: 13.60342) QuantErr: 13.60342 batch_time=0.40772 
Train Epoch: 29 [281/500 17984/32000 (56%)] Loss: 0.66838 (QuantReg: 13.33087) QuantErr: 13.33087 batch_time=0.47159 
Train Epoch: 29 [289/500 18496/32000 (58%)] Loss: 0.39677 (QuantReg: 13.56517) QuantErr: 13.56517 batch_time=0.47812 
Train Epoch: 29 [297/500 19008/32000 (59%)] Loss: 0.60998 (QuantReg: 14.06894) QuantErr: 14.06894 batch_time=0.57343 
Train Epoch: 29 [305/500 19520/32000 (61%)] Loss: 0.66635 (QuantReg: 13.71599) QuantErr: 13.71599 batch_time=0.51685 
Train Epoch: 29 [313/500 20032/32000 (63%)] Loss: 0.70173 (QuantReg: 13.61204) QuantErr: 13.61204 batch_time=0.45718 
Train Epoch: 29 [321/500 20544/32000 (64%)] Loss: 0.78477 (QuantReg: 13.49333) QuantErr: 13.49333 batch_time=0.77212 
Train Epoch: 29 [329/500 21056/32000 (66%)] Loss: 0.79842 (QuantReg: 13.28743) QuantErr: 13.28743 batch_time=0.48227 
Train Epoch: 29 [337/500 21568/32000 (67%)] Loss: 0.73794 (QuantReg: 13.35870) QuantErr: 13.35870 batch_time=0.42129 
Train Epoch: 29 [345/500 22080/32000 (69%)] Loss: 0.98689 (QuantReg: 13.49541) QuantErr: 13.49541 batch_time=0.47374 
Train Epoch: 29 [353/500 22592/32000 (71%)] Loss: 0.57753 (QuantReg: 13.58552) QuantErr: 13.58552 batch_time=0.43367 
Train Epoch: 29 [361/500 23104/32000 (72%)] Loss: 0.73993 (QuantReg: 13.33091) QuantErr: 13.33091 batch_time=0.54384 
Train Epoch: 29 [369/500 23616/32000 (74%)] Loss: 0.48027 (QuantReg: 13.56533) QuantErr: 13.56533 batch_time=0.42765 
Train Epoch: 29 [377/500 24128/32000 (75%)] Loss: 0.45715 (QuantReg: 13.26894) QuantErr: 13.26894 batch_time=0.49652 
Train Epoch: 29 [385/500 24640/32000 (77%)] Loss: 0.62394 (QuantReg: 13.47212) QuantErr: 13.47212 batch_time=0.83063 
Train Epoch: 29 [393/500 25152/32000 (79%)] Loss: 0.69835 (QuantReg: 13.65718) QuantErr: 13.65718 batch_time=0.43032 
Train Epoch: 29 [401/500 25664/32000 (80%)] Loss: 0.78846 (QuantReg: 13.75857) QuantErr: 13.75857 batch_time=0.47314 
Train Epoch: 29 [409/500 26176/32000 (82%)] Loss: 0.65104 (QuantReg: 13.40142) QuantErr: 13.40142 batch_time=0.45041 
Train Epoch: 29 [417/500 26688/32000 (83%)] Loss: 0.69415 (QuantReg: 13.58347) QuantErr: 13.58347 batch_time=0.44119 
Train Epoch: 29 [425/500 27200/32000 (85%)] Loss: 0.59071 (QuantReg: 13.62083) QuantErr: 13.62083 batch_time=0.54854 
Train Epoch: 29 [433/500 27712/32000 (87%)] Loss: 0.57688 (QuantReg: 13.48448) QuantErr: 13.48448 batch_time=0.53395 
Train Epoch: 29 [441/500 28224/32000 (88%)] Loss: 0.52894 (QuantReg: 13.49590) QuantErr: 13.49590 batch_time=0.44438 
Train Epoch: 29 [449/500 28736/32000 (90%)] Loss: 0.35747 (QuantReg: 13.31823) QuantErr: 13.31823 batch_time=0.85410 
Train Epoch: 29 [457/500 29248/32000 (91%)] Loss: 0.63482 (QuantReg: 13.36565) QuantErr: 13.36565 batch_time=0.45016 
Train Epoch: 29 [465/500 29760/32000 (93%)] Loss: 0.90186 (QuantReg: 13.53601) QuantErr: 13.53601 batch_time=0.44071 
Train Epoch: 29 [473/500 30272/32000 (95%)] Loss: 0.93275 (QuantReg: 13.55422) QuantErr: 13.55422 batch_time=0.46631 
Train Epoch: 29 [481/500 30784/32000 (96%)] Loss: 0.64908 (QuantReg: 13.33822) QuantErr: 13.33822 batch_time=0.44393 
Train Epoch: 29 [489/500 31296/32000 (98%)] Loss: 0.75936 (QuantReg: 13.48922) QuantErr: 13.48922 batch_time=0.54025 
Train Epoch: 29 [497/500 31808/32000 (99%)] Loss: 0.49628 (QuantReg: 13.84411) QuantErr: 13.84411 batch_time=0.45003 
Train Epoch: 29 codebook_update_time=2.56783
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch29.pth ...
Done in 5.320s
removing stale ckpt [epoch 28] [took 0.10s]
 epoch          : 29
 loss           : 0.6451452783346177
 quant_reg      : 13.498127119064332
 quant_err      : 13.498127119064332
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 14500
 MSRVTT_miech_test/t2v_metrics/R1: 21.5
 MSRVTT_miech_test/t2v_metrics/R5: 50.2
 MSRVTT_miech_test/t2v_metrics/R10: 63.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.2
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.589
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.92342438997972
 MSRVTT_miech_test/v2t_metrics/R1: 20.9
 MSRVTT_miech_test/v2t_metrics/R5: 50.5
 MSRVTT_miech_test/v2t_metrics/R10: 63.0
 MSRVTT_miech_test/v2t_metrics/R50: 88.8
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.3095
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.51284457703136
 mnt_best       : 41.631635822190006
 not_improved_count: 2
Train Epoch: 30 [1/500 64/32000 (0%)] Loss: 0.60014 (QuantReg: 13.69747) QuantErr: 13.69747 batch_time=30.92624 
Train Epoch: 30 [9/500 576/32000 (2%)] Loss: 0.76138 (QuantReg: 13.58926) QuantErr: 13.58926 batch_time=0.42952 
Train Epoch: 30 [17/500 1088/32000 (3%)] Loss: 0.45506 (QuantReg: 13.37150) QuantErr: 13.37150 batch_time=2.89634 
Train Epoch: 30 [25/500 1600/32000 (5%)] Loss: 0.38354 (QuantReg: 13.93707) QuantErr: 13.93707 batch_time=0.42870 
Train Epoch: 30 [33/500 2112/32000 (7%)] Loss: 0.61756 (QuantReg: 13.65911) QuantErr: 13.65911 batch_time=0.51612 
Train Epoch: 30 [41/500 2624/32000 (8%)] Loss: 0.87443 (QuantReg: 13.30510) QuantErr: 13.30510 batch_time=0.39575 
Train Epoch: 30 [49/500 3136/32000 (10%)] Loss: 0.75676 (QuantReg: 13.13439) QuantErr: 13.13439 batch_time=0.45842 
Train Epoch: 30 [57/500 3648/32000 (11%)] Loss: 0.90400 (QuantReg: 13.38662) QuantErr: 13.38662 batch_time=0.50322 
Train Epoch: 30 [65/500 4160/32000 (13%)] Loss: 0.48933 (QuantReg: 13.37865) QuantErr: 13.37865 batch_time=1.12697 
Train Epoch: 30 [73/500 4672/32000 (15%)] Loss: 0.73279 (QuantReg: 13.10931) QuantErr: 13.10931 batch_time=0.49716 
Train Epoch: 30 [81/500 5184/32000 (16%)] Loss: 0.46517 (QuantReg: 13.49797) QuantErr: 13.49797 batch_time=1.97309 
Train Epoch: 30 [89/500 5696/32000 (18%)] Loss: 0.62701 (QuantReg: 13.45090) QuantErr: 13.45090 batch_time=0.45646 
Train Epoch: 30 [97/500 6208/32000 (19%)] Loss: 0.72175 (QuantReg: 13.05633) QuantErr: 13.05633 batch_time=0.53079 
Train Epoch: 30 [105/500 6720/32000 (21%)] Loss: 0.50102 (QuantReg: 13.57323) QuantErr: 13.57323 batch_time=0.46143 
Train Epoch: 30 [113/500 7232/32000 (23%)] Loss: 0.68617 (QuantReg: 13.44773) QuantErr: 13.44773 batch_time=0.46693 
Train Epoch: 30 [121/500 7744/32000 (24%)] Loss: 0.96170 (QuantReg: 13.44760) QuantErr: 13.44760 batch_time=0.46508 
Train Epoch: 30 [129/500 8256/32000 (26%)] Loss: 0.50284 (QuantReg: 13.87693) QuantErr: 13.87693 batch_time=1.03554 
Train Epoch: 30 [137/500 8768/32000 (27%)] Loss: 0.53825 (QuantReg: 13.45649) QuantErr: 13.45649 batch_time=0.47376 
Train Epoch: 30 [145/500 9280/32000 (29%)] Loss: 0.33584 (QuantReg: 13.57086) QuantErr: 13.57086 batch_time=2.00270 
Train Epoch: 30 [153/500 9792/32000 (31%)] Loss: 0.53241 (QuantReg: 13.62072) QuantErr: 13.62072 batch_time=0.49963 
Train Epoch: 30 [161/500 10304/32000 (32%)] Loss: 0.69124 (QuantReg: 12.82794) QuantErr: 12.82794 batch_time=0.56216 
Train Epoch: 30 [169/500 10816/32000 (34%)] Loss: 0.57476 (QuantReg: 13.26427) QuantErr: 13.26427 batch_time=0.48715 
Train Epoch: 30 [177/500 11328/32000 (35%)] Loss: 0.89026 (QuantReg: 13.35204) QuantErr: 13.35204 batch_time=0.47967 
Train Epoch: 30 [185/500 11840/32000 (37%)] Loss: 0.71247 (QuantReg: 13.55155) QuantErr: 13.55155 batch_time=0.49047 
Train Epoch: 30 [193/500 12352/32000 (39%)] Loss: 0.44370 (QuantReg: 13.73689) QuantErr: 13.73689 batch_time=1.08441 
Train Epoch: 30 [201/500 12864/32000 (40%)] Loss: 0.57975 (QuantReg: 13.73807) QuantErr: 13.73807 batch_time=0.48218 
Train Epoch: 30 [209/500 13376/32000 (42%)] Loss: 0.47950 (QuantReg: 13.71286) QuantErr: 13.71286 batch_time=2.03722 
Train Epoch: 30 [217/500 13888/32000 (43%)] Loss: 0.51485 (QuantReg: 13.74000) QuantErr: 13.74000 batch_time=0.42848 
Train Epoch: 30 [225/500 14400/32000 (45%)] Loss: 0.67745 (QuantReg: 13.56082) QuantErr: 13.56082 batch_time=0.49270 
Train Epoch: 30 [233/500 14912/32000 (47%)] Loss: 0.69249 (QuantReg: 13.05147) QuantErr: 13.05147 batch_time=0.45980 
Train Epoch: 30 [241/500 15424/32000 (48%)] Loss: 0.46543 (QuantReg: 13.69612) QuantErr: 13.69612 batch_time=0.45522 
Train Epoch: 30 [249/500 15936/32000 (50%)] Loss: 0.91359 (QuantReg: 13.24645) QuantErr: 13.24645 batch_time=0.45321 
Train Epoch: 30 [257/500 16448/32000 (51%)] Loss: 0.55781 (QuantReg: 13.10797) QuantErr: 13.10797 batch_time=1.06035 
Train Epoch: 30 [265/500 16960/32000 (53%)] Loss: 0.84701 (QuantReg: 13.55936) QuantErr: 13.55936 batch_time=0.48275 
Train Epoch: 30 [273/500 17472/32000 (55%)] Loss: 0.62033 (QuantReg: 13.05723) QuantErr: 13.05723 batch_time=1.89073 
Train Epoch: 30 [281/500 17984/32000 (56%)] Loss: 0.49674 (QuantReg: 13.60838) QuantErr: 13.60838 batch_time=0.44702 
Train Epoch: 30 [289/500 18496/32000 (58%)] Loss: 0.74694 (QuantReg: 13.59698) QuantErr: 13.59698 batch_time=0.55609 
Train Epoch: 30 [297/500 19008/32000 (59%)] Loss: 0.49273 (QuantReg: 13.43070) QuantErr: 13.43070 batch_time=0.48240 
Train Epoch: 30 [305/500 19520/32000 (61%)] Loss: 0.55551 (QuantReg: 13.53225) QuantErr: 13.53225 batch_time=0.51465 
Train Epoch: 30 [313/500 20032/32000 (63%)] Loss: 0.73746 (QuantReg: 13.61950) QuantErr: 13.61950 batch_time=0.46351 
Train Epoch: 30 [321/500 20544/32000 (64%)] Loss: 0.71881 (QuantReg: 13.22123) QuantErr: 13.22123 batch_time=1.08739 
Train Epoch: 30 [329/500 21056/32000 (66%)] Loss: 1.14172 (QuantReg: 13.06916) QuantErr: 13.06916 batch_time=0.47968 
Train Epoch: 30 [337/500 21568/32000 (67%)] Loss: 0.67334 (QuantReg: 13.52828) QuantErr: 13.52828 batch_time=1.91470 
Train Epoch: 30 [345/500 22080/32000 (69%)] Loss: 0.70769 (QuantReg: 13.89085) QuantErr: 13.89085 batch_time=0.43512 
Train Epoch: 30 [353/500 22592/32000 (71%)] Loss: 0.66336 (QuantReg: 13.60072) QuantErr: 13.60072 batch_time=0.52255 
Train Epoch: 30 [361/500 23104/32000 (72%)] Loss: 0.80844 (QuantReg: 13.51420) QuantErr: 13.51420 batch_time=0.45759 
Train Epoch: 30 [369/500 23616/32000 (74%)] Loss: 0.55076 (QuantReg: 13.67466) QuantErr: 13.67466 batch_time=0.42054 
Train Epoch: 30 [377/500 24128/32000 (75%)] Loss: 0.66462 (QuantReg: 14.03345) QuantErr: 14.03345 batch_time=0.41318 
Train Epoch: 30 [385/500 24640/32000 (77%)] Loss: 0.56418 (QuantReg: 13.26809) QuantErr: 13.26809 batch_time=1.17214 
Train Epoch: 30 [393/500 25152/32000 (79%)] Loss: 0.47285 (QuantReg: 13.34569) QuantErr: 13.34569 batch_time=0.46560 
Train Epoch: 30 [401/500 25664/32000 (80%)] Loss: 0.58795 (QuantReg: 13.71246) QuantErr: 13.71246 batch_time=1.86758 
Train Epoch: 30 [409/500 26176/32000 (82%)] Loss: 0.62477 (QuantReg: 13.84863) QuantErr: 13.84863 batch_time=0.45839 
Train Epoch: 30 [417/500 26688/32000 (83%)] Loss: 0.52463 (QuantReg: 13.35846) QuantErr: 13.35846 batch_time=0.55230 
Train Epoch: 30 [425/500 27200/32000 (85%)] Loss: 0.55088 (QuantReg: 13.74654) QuantErr: 13.74654 batch_time=0.48487 
Train Epoch: 30 [433/500 27712/32000 (87%)] Loss: 0.82824 (QuantReg: 13.37236) QuantErr: 13.37236 batch_time=0.46363 
Train Epoch: 30 [441/500 28224/32000 (88%)] Loss: 0.92679 (QuantReg: 13.07096) QuantErr: 13.07096 batch_time=0.45033 
Train Epoch: 30 [449/500 28736/32000 (90%)] Loss: 0.42858 (QuantReg: 13.47507) QuantErr: 13.47507 batch_time=0.97536 
Train Epoch: 30 [457/500 29248/32000 (91%)] Loss: 0.60670 (QuantReg: 13.87326) QuantErr: 13.87326 batch_time=0.44062 
Train Epoch: 30 [465/500 29760/32000 (93%)] Loss: 0.78451 (QuantReg: 13.77652) QuantErr: 13.77652 batch_time=1.88614 
Train Epoch: 30 [473/500 30272/32000 (95%)] Loss: 0.77468 (QuantReg: 13.83373) QuantErr: 13.83373 batch_time=0.45908 
Train Epoch: 30 [481/500 30784/32000 (96%)] Loss: 0.65062 (QuantReg: 13.38821) QuantErr: 13.38821 batch_time=0.51230 
Train Epoch: 30 [489/500 31296/32000 (98%)] Loss: 0.53968 (QuantReg: 13.36573) QuantErr: 13.36573 batch_time=0.45089 
Train Epoch: 30 [497/500 31808/32000 (99%)] Loss: 0.68464 (QuantReg: 13.44690) QuantErr: 13.44690 batch_time=0.43096 
Train Epoch: 30 codebook_update_time=2.58289
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch30.pth ...
Done in 6.524s
removing stale ckpt [epoch 29] [took 0.09s]
 epoch          : 30
 loss           : 0.6196623111963272
 quant_reg      : 13.483601837158202
 quant_err      : 13.483601837158202
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 15000
 MSRVTT_miech_test/t2v_metrics/R1: 21.7
 MSRVTT_miech_test/t2v_metrics/R5: 49.7
 MSRVTT_miech_test/t2v_metrics/R10: 63.4
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.917
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.891696315433926
 MSRVTT_miech_test/v2t_metrics/R1: 20.7
 MSRVTT_miech_test/v2t_metrics/R5: 51.6
 MSRVTT_miech_test/v2t_metrics/R10: 64.7
 MSRVTT_miech_test/v2t_metrics/R50: 89.2
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.471
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.03692172800833
 mnt_best       : 41.631635822190006
 not_improved_count: 3
Train Epoch: 31 [1/500 64/32000 (0%)] Loss: 0.48210 (QuantReg: 13.87441) QuantErr: 13.87441 batch_time=29.73847 
Train Epoch: 31 [9/500 576/32000 (2%)] Loss: 0.50445 (QuantReg: 13.68404) QuantErr: 13.68404 batch_time=0.42445 
Train Epoch: 31 [17/500 1088/32000 (3%)] Loss: 0.83283 (QuantReg: 12.87980) QuantErr: 12.87980 batch_time=0.45473 
Train Epoch: 31 [25/500 1600/32000 (5%)] Loss: 0.50394 (QuantReg: 13.56330) QuantErr: 13.56330 batch_time=0.46769 
Train Epoch: 31 [33/500 2112/32000 (7%)] Loss: 0.34623 (QuantReg: 13.50090) QuantErr: 13.50090 batch_time=0.44389 
Train Epoch: 31 [41/500 2624/32000 (8%)] Loss: 0.78168 (QuantReg: 13.16044) QuantErr: 13.16044 batch_time=0.43899 
Train Epoch: 31 [49/500 3136/32000 (10%)] Loss: 0.60322 (QuantReg: 13.67425) QuantErr: 13.67425 batch_time=0.41446 
Train Epoch: 31 [57/500 3648/32000 (11%)] Loss: 0.54197 (QuantReg: 13.55565) QuantErr: 13.55565 batch_time=0.46004 
Train Epoch: 31 [65/500 4160/32000 (13%)] Loss: 0.69629 (QuantReg: 13.62823) QuantErr: 13.62823 batch_time=0.78076 
Train Epoch: 31 [73/500 4672/32000 (15%)] Loss: 0.61420 (QuantReg: 13.31221) QuantErr: 13.31221 batch_time=0.46863 
Train Epoch: 31 [81/500 5184/32000 (16%)] Loss: 0.79374 (QuantReg: 13.14273) QuantErr: 13.14273 batch_time=0.45137 
Train Epoch: 31 [89/500 5696/32000 (18%)] Loss: 0.55275 (QuantReg: 13.64551) QuantErr: 13.64551 batch_time=0.50000 
Train Epoch: 31 [97/500 6208/32000 (19%)] Loss: 0.64822 (QuantReg: 13.73785) QuantErr: 13.73785 batch_time=0.51034 
Train Epoch: 31 [105/500 6720/32000 (21%)] Loss: 0.83509 (QuantReg: 13.65337) QuantErr: 13.65337 batch_time=0.47990 
Train Epoch: 31 [113/500 7232/32000 (23%)] Loss: 0.86636 (QuantReg: 13.24617) QuantErr: 13.24617 batch_time=0.47089 
Train Epoch: 31 [121/500 7744/32000 (24%)] Loss: 0.94413 (QuantReg: 13.32129) QuantErr: 13.32129 batch_time=0.47739 
Train Epoch: 31 [129/500 8256/32000 (26%)] Loss: 0.58228 (QuantReg: 13.32888) QuantErr: 13.32888 batch_time=0.81545 
Train Epoch: 31 [137/500 8768/32000 (27%)] Loss: 1.11834 (QuantReg: 13.68413) QuantErr: 13.68413 batch_time=0.46058 
Train Epoch: 31 [145/500 9280/32000 (29%)] Loss: 0.23970 (QuantReg: 14.04789) QuantErr: 14.04789 batch_time=0.47132 
Train Epoch: 31 [153/500 9792/32000 (31%)] Loss: 0.47166 (QuantReg: 13.32874) QuantErr: 13.32874 batch_time=0.47771 
Train Epoch: 31 [161/500 10304/32000 (32%)] Loss: 0.47101 (QuantReg: 13.43622) QuantErr: 13.43622 batch_time=0.42717 
Train Epoch: 31 [169/500 10816/32000 (34%)] Loss: 0.47251 (QuantReg: 13.88233) QuantErr: 13.88233 batch_time=0.44552 
Train Epoch: 31 [177/500 11328/32000 (35%)] Loss: 0.58009 (QuantReg: 13.59162) QuantErr: 13.59162 batch_time=0.41712 
Train Epoch: 31 [185/500 11840/32000 (37%)] Loss: 0.54965 (QuantReg: 13.79627) QuantErr: 13.79627 batch_time=0.42470 
Train Epoch: 31 [193/500 12352/32000 (39%)] Loss: 0.41056 (QuantReg: 13.49101) QuantErr: 13.49101 batch_time=0.87972 
Train Epoch: 31 [201/500 12864/32000 (40%)] Loss: 0.42900 (QuantReg: 13.46751) QuantErr: 13.46751 batch_time=0.53053 
Train Epoch: 31 [209/500 13376/32000 (42%)] Loss: 0.75519 (QuantReg: 13.19325) QuantErr: 13.19325 batch_time=0.42933 
Train Epoch: 31 [217/500 13888/32000 (43%)] Loss: 0.69522 (QuantReg: 13.51412) QuantErr: 13.51412 batch_time=0.49181 
Train Epoch: 31 [225/500 14400/32000 (45%)] Loss: 0.55024 (QuantReg: 13.83181) QuantErr: 13.83181 batch_time=0.46655 
Train Epoch: 31 [233/500 14912/32000 (47%)] Loss: 0.66516 (QuantReg: 13.81771) QuantErr: 13.81771 batch_time=0.53753 
Train Epoch: 31 [241/500 15424/32000 (48%)] Loss: 0.59216 (QuantReg: 13.74837) QuantErr: 13.74837 batch_time=0.42261 
Train Epoch: 31 [249/500 15936/32000 (50%)] Loss: 0.48860 (QuantReg: 13.54428) QuantErr: 13.54428 batch_time=0.49634 
Train Epoch: 31 [257/500 16448/32000 (51%)] Loss: 0.55997 (QuantReg: 13.76613) QuantErr: 13.76613 batch_time=0.91452 
Train Epoch: 31 [265/500 16960/32000 (53%)] Loss: 0.84035 (QuantReg: 13.12336) QuantErr: 13.12336 batch_time=0.50603 
Train Epoch: 31 [273/500 17472/32000 (55%)] Loss: 0.57680 (QuantReg: 13.70725) QuantErr: 13.70725 batch_time=0.42187 
Train Epoch: 31 [281/500 17984/32000 (56%)] Loss: 0.43729 (QuantReg: 13.40656) QuantErr: 13.40656 batch_time=0.49977 
Train Epoch: 31 [289/500 18496/32000 (58%)] Loss: 0.60050 (QuantReg: 13.46562) QuantErr: 13.46562 batch_time=0.46185 
Train Epoch: 31 [297/500 19008/32000 (59%)] Loss: 0.77138 (QuantReg: 13.39195) QuantErr: 13.39195 batch_time=0.45805 
Train Epoch: 31 [305/500 19520/32000 (61%)] Loss: 0.70982 (QuantReg: 13.45952) QuantErr: 13.45952 batch_time=0.41565 
Train Epoch: 31 [313/500 20032/32000 (63%)] Loss: 0.64528 (QuantReg: 13.79597) QuantErr: 13.79597 batch_time=0.43112 
Train Epoch: 31 [321/500 20544/32000 (64%)] Loss: 0.49129 (QuantReg: 13.47560) QuantErr: 13.47560 batch_time=0.84044 
Train Epoch: 31 [329/500 21056/32000 (66%)] Loss: 0.73164 (QuantReg: 13.26786) QuantErr: 13.26786 batch_time=0.41937 
Train Epoch: 31 [337/500 21568/32000 (67%)] Loss: 0.90832 (QuantReg: 13.41777) QuantErr: 13.41777 batch_time=0.45827 
Train Epoch: 31 [345/500 22080/32000 (69%)] Loss: 0.80914 (QuantReg: 13.28461) QuantErr: 13.28461 batch_time=0.45347 
Train Epoch: 31 [353/500 22592/32000 (71%)] Loss: 0.71031 (QuantReg: 13.35421) QuantErr: 13.35421 batch_time=0.41514 
Train Epoch: 31 [361/500 23104/32000 (72%)] Loss: 0.50971 (QuantReg: 13.72081) QuantErr: 13.72081 batch_time=0.40209 
Train Epoch: 31 [369/500 23616/32000 (74%)] Loss: 1.07670 (QuantReg: 13.25344) QuantErr: 13.25344 batch_time=0.53309 
Train Epoch: 31 [377/500 24128/32000 (75%)] Loss: 0.47112 (QuantReg: 13.79292) QuantErr: 13.79292 batch_time=0.50142 
Train Epoch: 31 [385/500 24640/32000 (77%)] Loss: 0.55929 (QuantReg: 13.28528) QuantErr: 13.28528 batch_time=0.95106 
Train Epoch: 31 [393/500 25152/32000 (79%)] Loss: 0.66190 (QuantReg: 13.78619) QuantErr: 13.78619 batch_time=0.48018 
Train Epoch: 31 [401/500 25664/32000 (80%)] Loss: 0.79013 (QuantReg: 13.57126) QuantErr: 13.57126 batch_time=0.42465 
Train Epoch: 31 [409/500 26176/32000 (82%)] Loss: 0.60843 (QuantReg: 13.68728) QuantErr: 13.68728 batch_time=0.46411 
Train Epoch: 31 [417/500 26688/32000 (83%)] Loss: 0.61351 (QuantReg: 13.84686) QuantErr: 13.84686 batch_time=0.44548 
Train Epoch: 31 [425/500 27200/32000 (85%)] Loss: 1.09891 (QuantReg: 13.87748) QuantErr: 13.87748 batch_time=0.41007 
Train Epoch: 31 [433/500 27712/32000 (87%)] Loss: 0.90725 (QuantReg: 13.24911) QuantErr: 13.24911 batch_time=0.41278 
Train Epoch: 31 [441/500 28224/32000 (88%)] Loss: 0.86700 (QuantReg: 13.26902) QuantErr: 13.26902 batch_time=0.42002 
Train Epoch: 31 [449/500 28736/32000 (90%)] Loss: 0.36739 (QuantReg: 13.82214) QuantErr: 13.82214 batch_time=0.90031 
Train Epoch: 31 [457/500 29248/32000 (91%)] Loss: 0.40579 (QuantReg: 13.53314) QuantErr: 13.53314 batch_time=0.41426 
Train Epoch: 31 [465/500 29760/32000 (93%)] Loss: 0.59699 (QuantReg: 13.61189) QuantErr: 13.61189 batch_time=0.44126 
Train Epoch: 31 [473/500 30272/32000 (95%)] Loss: 0.40386 (QuantReg: 13.79910) QuantErr: 13.79910 batch_time=0.43484 
Train Epoch: 31 [481/500 30784/32000 (96%)] Loss: 0.43717 (QuantReg: 13.54510) QuantErr: 13.54510 batch_time=0.43603 
Train Epoch: 31 [489/500 31296/32000 (98%)] Loss: 0.56173 (QuantReg: 13.45891) QuantErr: 13.45891 batch_time=0.40092 
Train Epoch: 31 [497/500 31808/32000 (99%)] Loss: 0.65907 (QuantReg: 13.60402) QuantErr: 13.60402 batch_time=0.56888 
Train Epoch: 31 codebook_update_time=2.66560
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch31.pth ...
Done in 5.393s
removing stale ckpt [epoch 30] [took 0.02s]
 epoch          : 31
 loss           : 0.6201443158090114
 quant_reg      : 13.503263271331788
 quant_err      : 13.503263271331788
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 15500
 MSRVTT_miech_test/t2v_metrics/R1: 21.1
 MSRVTT_miech_test/t2v_metrics/R5: 48.9
 MSRVTT_miech_test/t2v_metrics/R10: 62.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.564
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.101176160509155
 MSRVTT_miech_test/v2t_metrics/R1: 20.5
 MSRVTT_miech_test/v2t_metrics/R5: 51.6
 MSRVTT_miech_test/v2t_metrics/R10: 64.2
 MSRVTT_miech_test/v2t_metrics/R50: 88.8
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.725
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.79868796242185
 mnt_best       : 41.631635822190006
 not_improved_count: 4
Train Epoch: 32 [1/500 64/32000 (0%)] Loss: 0.44663 (QuantReg: 13.68632) QuantErr: 13.68632 batch_time=30.18966 
Train Epoch: 32 [9/500 576/32000 (2%)] Loss: 0.59455 (QuantReg: 13.37737) QuantErr: 13.37737 batch_time=0.43627 
Train Epoch: 32 [17/500 1088/32000 (3%)] Loss: 0.39416 (QuantReg: 13.37171) QuantErr: 13.37171 batch_time=2.34554 
Train Epoch: 32 [25/500 1600/32000 (5%)] Loss: 0.52329 (QuantReg: 13.02265) QuantErr: 13.02265 batch_time=0.48104 
Train Epoch: 32 [33/500 2112/32000 (7%)] Loss: 0.45067 (QuantReg: 13.26838) QuantErr: 13.26838 batch_time=0.43844 
Train Epoch: 32 [41/500 2624/32000 (8%)] Loss: 0.50583 (QuantReg: 13.47793) QuantErr: 13.47793 batch_time=0.48037 
Train Epoch: 32 [49/500 3136/32000 (10%)] Loss: 0.56984 (QuantReg: 13.66908) QuantErr: 13.66908 batch_time=0.55974 
Train Epoch: 32 [57/500 3648/32000 (11%)] Loss: 0.68578 (QuantReg: 13.68672) QuantErr: 13.68672 batch_time=0.53015 
Train Epoch: 32 [65/500 4160/32000 (13%)] Loss: 0.94801 (QuantReg: 13.26927) QuantErr: 13.26927 batch_time=0.45586 
Train Epoch: 32 [73/500 4672/32000 (15%)] Loss: 0.63510 (QuantReg: 13.24582) QuantErr: 13.24582 batch_time=0.50787 
Train Epoch: 32 [81/500 5184/32000 (16%)] Loss: 0.80411 (QuantReg: 13.61962) QuantErr: 13.61962 batch_time=1.61385 
Train Epoch: 32 [89/500 5696/32000 (18%)] Loss: 0.60988 (QuantReg: 13.21096) QuantErr: 13.21096 batch_time=0.52160 
Train Epoch: 32 [97/500 6208/32000 (19%)] Loss: 0.34425 (QuantReg: 13.68008) QuantErr: 13.68008 batch_time=0.50159 
Train Epoch: 32 [105/500 6720/32000 (21%)] Loss: 0.59341 (QuantReg: 13.63652) QuantErr: 13.63652 batch_time=0.46371 
Train Epoch: 32 [113/500 7232/32000 (23%)] Loss: 0.48032 (QuantReg: 13.47153) QuantErr: 13.47153 batch_time=0.53228 
Train Epoch: 32 [121/500 7744/32000 (24%)] Loss: 0.71253 (QuantReg: 13.28505) QuantErr: 13.28505 batch_time=0.44257 
Train Epoch: 32 [129/500 8256/32000 (26%)] Loss: 0.61713 (QuantReg: 13.62719) QuantErr: 13.62719 batch_time=0.52646 
Train Epoch: 32 [137/500 8768/32000 (27%)] Loss: 0.67289 (QuantReg: 13.63238) QuantErr: 13.63238 batch_time=0.44834 
Train Epoch: 32 [145/500 9280/32000 (29%)] Loss: 0.73973 (QuantReg: 13.54133) QuantErr: 13.54133 batch_time=1.52798 
Train Epoch: 32 [153/500 9792/32000 (31%)] Loss: 0.66397 (QuantReg: 13.58768) QuantErr: 13.58768 batch_time=0.45274 
Train Epoch: 32 [161/500 10304/32000 (32%)] Loss: 0.64346 (QuantReg: 13.70718) QuantErr: 13.70718 batch_time=0.46857 
Train Epoch: 32 [169/500 10816/32000 (34%)] Loss: 0.48533 (QuantReg: 13.88072) QuantErr: 13.88072 batch_time=0.42304 
Train Epoch: 32 [177/500 11328/32000 (35%)] Loss: 0.63362 (QuantReg: 13.71870) QuantErr: 13.71870 batch_time=0.47286 
Train Epoch: 32 [185/500 11840/32000 (37%)] Loss: 0.73895 (QuantReg: 13.63562) QuantErr: 13.63562 batch_time=0.42279 
Train Epoch: 32 [193/500 12352/32000 (39%)] Loss: 0.54652 (QuantReg: 13.04737) QuantErr: 13.04737 batch_time=0.43985 
Train Epoch: 32 [201/500 12864/32000 (40%)] Loss: 0.42821 (QuantReg: 14.24498) QuantErr: 14.24498 batch_time=0.46233 
Train Epoch: 32 [209/500 13376/32000 (42%)] Loss: 0.64450 (QuantReg: 13.18582) QuantErr: 13.18582 batch_time=1.56832 
Train Epoch: 32 [217/500 13888/32000 (43%)] Loss: 0.37008 (QuantReg: 13.67514) QuantErr: 13.67514 batch_time=0.52015 
Train Epoch: 32 [225/500 14400/32000 (45%)] Loss: 0.63283 (QuantReg: 13.75394) QuantErr: 13.75394 batch_time=0.44141 
Train Epoch: 32 [233/500 14912/32000 (47%)] Loss: 0.75230 (QuantReg: 13.09974) QuantErr: 13.09974 batch_time=0.46905 
Train Epoch: 32 [241/500 15424/32000 (48%)] Loss: 0.67681 (QuantReg: 13.23375) QuantErr: 13.23375 batch_time=0.50112 
Train Epoch: 32 [249/500 15936/32000 (50%)] Loss: 0.73705 (QuantReg: 13.56352) QuantErr: 13.56352 batch_time=0.43482 
Train Epoch: 32 [257/500 16448/32000 (51%)] Loss: 0.37310 (QuantReg: 13.46412) QuantErr: 13.46412 batch_time=0.42610 
Train Epoch: 32 [265/500 16960/32000 (53%)] Loss: 0.67291 (QuantReg: 13.62932) QuantErr: 13.62932 batch_time=0.42072 
Train Epoch: 32 [273/500 17472/32000 (55%)] Loss: 0.55984 (QuantReg: 13.08381) QuantErr: 13.08381 batch_time=1.89860 
Train Epoch: 32 [281/500 17984/32000 (56%)] Loss: 0.92584 (QuantReg: 12.97196) QuantErr: 12.97196 batch_time=0.45246 
Train Epoch: 32 [289/500 18496/32000 (58%)] Loss: 0.99677 (QuantReg: 13.61679) QuantErr: 13.61679 batch_time=0.51170 
Train Epoch: 32 [297/500 19008/32000 (59%)] Loss: 0.53672 (QuantReg: 13.72067) QuantErr: 13.72067 batch_time=0.45261 
Train Epoch: 32 [305/500 19520/32000 (61%)] Loss: 0.45279 (QuantReg: 13.52317) QuantErr: 13.52317 batch_time=0.53682 
Train Epoch: 32 [313/500 20032/32000 (63%)] Loss: 0.57139 (QuantReg: 13.44476) QuantErr: 13.44476 batch_time=0.43944 
Train Epoch: 32 [321/500 20544/32000 (64%)] Loss: 0.48010 (QuantReg: 13.79525) QuantErr: 13.79525 batch_time=0.45725 
Train Epoch: 32 [329/500 21056/32000 (66%)] Loss: 0.62799 (QuantReg: 13.56528) QuantErr: 13.56528 batch_time=0.44056 
Train Epoch: 32 [337/500 21568/32000 (67%)] Loss: 0.50279 (QuantReg: 13.89347) QuantErr: 13.89347 batch_time=1.63239 
Train Epoch: 32 [345/500 22080/32000 (69%)] Loss: 0.69015 (QuantReg: 13.18861) QuantErr: 13.18861 batch_time=0.45862 
Train Epoch: 32 [353/500 22592/32000 (71%)] Loss: 0.55887 (QuantReg: 13.57190) QuantErr: 13.57190 batch_time=0.45590 
Train Epoch: 32 [361/500 23104/32000 (72%)] Loss: 0.86352 (QuantReg: 14.01017) QuantErr: 14.01017 batch_time=0.41640 
Train Epoch: 32 [369/500 23616/32000 (74%)] Loss: 0.53290 (QuantReg: 14.04014) QuantErr: 14.04014 batch_time=0.49511 
Train Epoch: 32 [377/500 24128/32000 (75%)] Loss: 0.72549 (QuantReg: 13.78508) QuantErr: 13.78508 batch_time=0.43451 
Train Epoch: 32 [385/500 24640/32000 (77%)] Loss: 0.68909 (QuantReg: 13.94733) QuantErr: 13.94733 batch_time=0.45820 
Train Epoch: 32 [393/500 25152/32000 (79%)] Loss: 0.38692 (QuantReg: 13.78413) QuantErr: 13.78413 batch_time=0.40546 
Train Epoch: 32 [401/500 25664/32000 (80%)] Loss: 0.57098 (QuantReg: 13.59002) QuantErr: 13.59002 batch_time=1.62947 
Train Epoch: 32 [409/500 26176/32000 (82%)] Loss: 0.63060 (QuantReg: 13.49530) QuantErr: 13.49530 batch_time=0.45584 
Train Epoch: 32 [417/500 26688/32000 (83%)] Loss: 0.67434 (QuantReg: 13.75359) QuantErr: 13.75359 batch_time=0.45395 
Train Epoch: 32 [425/500 27200/32000 (85%)] Loss: 0.80270 (QuantReg: 13.47598) QuantErr: 13.47598 batch_time=0.47323 
Train Epoch: 32 [433/500 27712/32000 (87%)] Loss: 0.42523 (QuantReg: 13.79155) QuantErr: 13.79155 batch_time=0.53069 
Train Epoch: 32 [441/500 28224/32000 (88%)] Loss: 0.53847 (QuantReg: 13.58983) QuantErr: 13.58983 batch_time=0.49061 
Train Epoch: 32 [449/500 28736/32000 (90%)] Loss: 0.60403 (QuantReg: 13.44258) QuantErr: 13.44258 batch_time=0.42253 
Train Epoch: 32 [457/500 29248/32000 (91%)] Loss: 0.36074 (QuantReg: 13.69347) QuantErr: 13.69347 batch_time=0.42842 
Train Epoch: 32 [465/500 29760/32000 (93%)] Loss: 0.65633 (QuantReg: 13.43428) QuantErr: 13.43428 batch_time=1.47687 
Train Epoch: 32 [473/500 30272/32000 (95%)] Loss: 0.73965 (QuantReg: 13.53837) QuantErr: 13.53837 batch_time=0.44957 
Train Epoch: 32 [481/500 30784/32000 (96%)] Loss: 0.45620 (QuantReg: 14.00436) QuantErr: 14.00436 batch_time=0.46425 
Train Epoch: 32 [489/500 31296/32000 (98%)] Loss: 0.51219 (QuantReg: 13.63972) QuantErr: 13.63972 batch_time=0.45550 
Train Epoch: 32 [497/500 31808/32000 (99%)] Loss: 0.32852 (QuantReg: 13.62107) QuantErr: 13.62107 batch_time=0.55027 
Train Epoch: 32 codebook_update_time=2.56004
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch32.pth ...
Done in 5.670s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 0.6061488111019134
 quant_reg      : 13.533598302841186
 quant_err      : 13.533598302841186
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 16000
 MSRVTT_miech_test/t2v_metrics/R1: 21.0
 MSRVTT_miech_test/t2v_metrics/R5: 49.5
 MSRVTT_miech_test/t2v_metrics/R10: 62.7
 MSRVTT_miech_test/t2v_metrics/R50: 87.7
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.996
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.24364829107793
 MSRVTT_miech_test/v2t_metrics/R1: 21.2
 MSRVTT_miech_test/v2t_metrics/R5: 50.3
 MSRVTT_miech_test/v2t_metrics/R10: 64.2
 MSRVTT_miech_test/v2t_metrics/R50: 89.7
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.2465
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.90844372668642
 mnt_best       : 41.631635822190006
 not_improved_count: 5
Train Epoch: 33 [1/500 64/32000 (0%)] Loss: 0.69486 (QuantReg: 13.51672) QuantErr: 13.51672 batch_time=30.67211 
Train Epoch: 33 [9/500 576/32000 (2%)] Loss: 0.43897 (QuantReg: 13.66472) QuantErr: 13.66472 batch_time=0.56287 
Train Epoch: 33 [17/500 1088/32000 (3%)] Loss: 0.44597 (QuantReg: 13.42040) QuantErr: 13.42040 batch_time=0.43014 
Train Epoch: 33 [25/500 1600/32000 (5%)] Loss: 0.49333 (QuantReg: 13.49858) QuantErr: 13.49858 batch_time=0.41887 
Train Epoch: 33 [33/500 2112/32000 (7%)] Loss: 0.34569 (QuantReg: 13.58798) QuantErr: 13.58798 batch_time=0.43192 
Train Epoch: 33 [41/500 2624/32000 (8%)] Loss: 0.56748 (QuantReg: 13.39415) QuantErr: 13.39415 batch_time=0.41323 
Train Epoch: 33 [49/500 3136/32000 (10%)] Loss: 1.07883 (QuantReg: 13.69979) QuantErr: 13.69979 batch_time=0.41153 
Train Epoch: 33 [57/500 3648/32000 (11%)] Loss: 0.39952 (QuantReg: 13.86840) QuantErr: 13.86840 batch_time=0.50907 
Train Epoch: 33 [65/500 4160/32000 (13%)] Loss: 0.58344 (QuantReg: 13.70723) QuantErr: 13.70723 batch_time=0.57547 
Train Epoch: 33 [73/500 4672/32000 (15%)] Loss: 0.76910 (QuantReg: 13.18447) QuantErr: 13.18447 batch_time=0.58280 
Train Epoch: 33 [81/500 5184/32000 (16%)] Loss: 0.63347 (QuantReg: 13.72274) QuantErr: 13.72274 batch_time=0.46826 
Train Epoch: 33 [89/500 5696/32000 (18%)] Loss: 0.48205 (QuantReg: 13.67620) QuantErr: 13.67620 batch_time=0.49002 
Train Epoch: 33 [97/500 6208/32000 (19%)] Loss: 0.46440 (QuantReg: 13.30412) QuantErr: 13.30412 batch_time=0.51708 
Train Epoch: 33 [105/500 6720/32000 (21%)] Loss: 0.25605 (QuantReg: 13.67280) QuantErr: 13.67280 batch_time=0.46676 
Train Epoch: 33 [113/500 7232/32000 (23%)] Loss: 0.52228 (QuantReg: 13.58370) QuantErr: 13.58370 batch_time=0.47049 
Train Epoch: 33 [121/500 7744/32000 (24%)] Loss: 0.54280 (QuantReg: 13.80599) QuantErr: 13.80599 batch_time=0.53506 
Train Epoch: 33 [129/500 8256/32000 (26%)] Loss: 0.56319 (QuantReg: 14.00017) QuantErr: 14.00017 batch_time=0.61807 
Train Epoch: 33 [137/500 8768/32000 (27%)] Loss: 0.62618 (QuantReg: 13.51736) QuantErr: 13.51736 batch_time=0.66382 
Train Epoch: 33 [145/500 9280/32000 (29%)] Loss: 0.62573 (QuantReg: 13.89833) QuantErr: 13.89833 batch_time=0.49954 
Train Epoch: 33 [153/500 9792/32000 (31%)] Loss: 0.41105 (QuantReg: 13.65844) QuantErr: 13.65844 batch_time=0.50259 
Train Epoch: 33 [161/500 10304/32000 (32%)] Loss: 0.35207 (QuantReg: 13.65163) QuantErr: 13.65163 batch_time=0.52567 
Train Epoch: 33 [169/500 10816/32000 (34%)] Loss: 0.42537 (QuantReg: 13.72590) QuantErr: 13.72590 batch_time=0.47503 
Train Epoch: 33 [177/500 11328/32000 (35%)] Loss: 0.65004 (QuantReg: 13.35504) QuantErr: 13.35504 batch_time=0.42672 
Train Epoch: 33 [185/500 11840/32000 (37%)] Loss: 0.85648 (QuantReg: 13.31238) QuantErr: 13.31238 batch_time=0.47991 
Train Epoch: 33 [193/500 12352/32000 (39%)] Loss: 0.71440 (QuantReg: 13.74625) QuantErr: 13.74625 batch_time=0.55569 
Train Epoch: 33 [201/500 12864/32000 (40%)] Loss: 0.60900 (QuantReg: 13.36979) QuantErr: 13.36979 batch_time=0.64574 
Train Epoch: 33 [209/500 13376/32000 (42%)] Loss: 0.45560 (QuantReg: 13.79110) QuantErr: 13.79110 batch_time=0.40008 
Train Epoch: 33 [217/500 13888/32000 (43%)] Loss: 0.94754 (QuantReg: 13.63675) QuantErr: 13.63675 batch_time=0.45866 
Train Epoch: 33 [225/500 14400/32000 (45%)] Loss: 0.75904 (QuantReg: 12.84721) QuantErr: 12.84721 batch_time=0.44091 
Train Epoch: 33 [233/500 14912/32000 (47%)] Loss: 0.67216 (QuantReg: 13.63865) QuantErr: 13.63865 batch_time=0.46465 
Train Epoch: 33 [241/500 15424/32000 (48%)] Loss: 0.38397 (QuantReg: 13.74554) QuantErr: 13.74554 batch_time=0.40288 
Train Epoch: 33 [249/500 15936/32000 (50%)] Loss: 0.68511 (QuantReg: 13.62073) QuantErr: 13.62073 batch_time=0.43601 
Train Epoch: 33 [257/500 16448/32000 (51%)] Loss: 0.69797 (QuantReg: 13.46023) QuantErr: 13.46023 batch_time=0.60258 
Train Epoch: 33 [265/500 16960/32000 (53%)] Loss: 0.39169 (QuantReg: 13.79262) QuantErr: 13.79262 batch_time=0.54173 
Train Epoch: 33 [273/500 17472/32000 (55%)] Loss: 0.48781 (QuantReg: 13.60315) QuantErr: 13.60315 batch_time=0.46021 
Train Epoch: 33 [281/500 17984/32000 (56%)] Loss: 0.57635 (QuantReg: 13.45057) QuantErr: 13.45057 batch_time=0.51572 
Train Epoch: 33 [289/500 18496/32000 (58%)] Loss: 0.46858 (QuantReg: 13.77488) QuantErr: 13.77488 batch_time=0.55501 
Train Epoch: 33 [297/500 19008/32000 (59%)] Loss: 0.48268 (QuantReg: 13.28654) QuantErr: 13.28654 batch_time=0.49860 
Train Epoch: 33 [305/500 19520/32000 (61%)] Loss: 0.65938 (QuantReg: 13.70391) QuantErr: 13.70391 batch_time=0.43883 
Train Epoch: 33 [313/500 20032/32000 (63%)] Loss: 0.41697 (QuantReg: 13.67541) QuantErr: 13.67541 batch_time=0.40660 
Train Epoch: 33 [321/500 20544/32000 (64%)] Loss: 0.63951 (QuantReg: 13.75727) QuantErr: 13.75727 batch_time=0.56619 
Train Epoch: 33 [329/500 21056/32000 (66%)] Loss: 0.44520 (QuantReg: 13.54470) QuantErr: 13.54470 batch_time=0.72501 
Train Epoch: 33 [337/500 21568/32000 (67%)] Loss: 0.58006 (QuantReg: 13.66544) QuantErr: 13.66544 batch_time=0.43284 
Train Epoch: 33 [345/500 22080/32000 (69%)] Loss: 0.60835 (QuantReg: 13.52596) QuantErr: 13.52596 batch_time=0.44948 
Train Epoch: 33 [353/500 22592/32000 (71%)] Loss: 0.38292 (QuantReg: 13.38105) QuantErr: 13.38105 batch_time=0.53797 
Train Epoch: 33 [361/500 23104/32000 (72%)] Loss: 0.82690 (QuantReg: 13.78469) QuantErr: 13.78469 batch_time=0.50582 
Train Epoch: 33 [369/500 23616/32000 (74%)] Loss: 0.61481 (QuantReg: 13.79795) QuantErr: 13.79795 batch_time=0.47682 
Train Epoch: 33 [377/500 24128/32000 (75%)] Loss: 0.61518 (QuantReg: 13.76897) QuantErr: 13.76897 batch_time=0.48078 
Train Epoch: 33 [385/500 24640/32000 (77%)] Loss: 0.85625 (QuantReg: 13.61069) QuantErr: 13.61069 batch_time=0.58937 
Train Epoch: 33 [393/500 25152/32000 (79%)] Loss: 0.57463 (QuantReg: 13.46012) QuantErr: 13.46012 batch_time=0.55394 
Train Epoch: 33 [401/500 25664/32000 (80%)] Loss: 1.02388 (QuantReg: 13.59651) QuantErr: 13.59651 batch_time=0.49025 
Train Epoch: 33 [409/500 26176/32000 (82%)] Loss: 0.37441 (QuantReg: 13.57245) QuantErr: 13.57245 batch_time=0.44702 
Train Epoch: 33 [417/500 26688/32000 (83%)] Loss: 0.49395 (QuantReg: 13.61969) QuantErr: 13.61969 batch_time=0.46745 
Train Epoch: 33 [425/500 27200/32000 (85%)] Loss: 0.55495 (QuantReg: 13.84109) QuantErr: 13.84109 batch_time=0.47147 
Train Epoch: 33 [433/500 27712/32000 (87%)] Loss: 0.54573 (QuantReg: 13.23436) QuantErr: 13.23436 batch_time=0.48745 
Train Epoch: 33 [441/500 28224/32000 (88%)] Loss: 0.46781 (QuantReg: 13.54155) QuantErr: 13.54155 batch_time=0.45092 
Train Epoch: 33 [449/500 28736/32000 (90%)] Loss: 0.90133 (QuantReg: 13.71665) QuantErr: 13.71665 batch_time=0.61581 
Train Epoch: 33 [457/500 29248/32000 (91%)] Loss: 0.61160 (QuantReg: 13.37322) QuantErr: 13.37322 batch_time=0.71977 
Train Epoch: 33 [465/500 29760/32000 (93%)] Loss: 0.58799 (QuantReg: 13.65950) QuantErr: 13.65950 batch_time=0.49900 
Train Epoch: 33 [473/500 30272/32000 (95%)] Loss: 0.83903 (QuantReg: 13.31137) QuantErr: 13.31137 batch_time=0.41164 
Train Epoch: 33 [481/500 30784/32000 (96%)] Loss: 0.75593 (QuantReg: 13.81171) QuantErr: 13.81171 batch_time=0.39923 
Train Epoch: 33 [489/500 31296/32000 (98%)] Loss: 0.67417 (QuantReg: 13.22133) QuantErr: 13.22133 batch_time=0.40219 
Train Epoch: 33 [497/500 31808/32000 (99%)] Loss: 0.63369 (QuantReg: 13.38240) QuantErr: 13.38240 batch_time=0.46444 
Train Epoch: 33 codebook_update_time=2.80430
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch33.pth ...
Done in 6.150s
removing stale ckpt [epoch 32] [took 0.01s]
 epoch          : 33
 loss           : 0.5977609250247479
 quant_reg      : 13.561485605239868
 quant_err      : 13.561485605239868
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 16500
 MSRVTT_miech_test/t2v_metrics/R1: 21.7
 MSRVTT_miech_test/t2v_metrics/R5: 50.7
 MSRVTT_miech_test/t2v_metrics/R10: 63.2
 MSRVTT_miech_test/t2v_metrics/R50: 87.6
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.507
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.12080333989501
 MSRVTT_miech_test/v2t_metrics/R1: 21.9
 MSRVTT_miech_test/v2t_metrics/R5: 52.2
 MSRVTT_miech_test/v2t_metrics/R10: 65.1
 MSRVTT_miech_test/v2t_metrics/R50: 89.6
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.6295
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 42.062834520336914
 mnt_best       : 41.631635822190006
 not_improved_count: 6
Train Epoch: 34 [1/500 64/32000 (0%)] Loss: 0.47652 (QuantReg: 13.92345) QuantErr: 13.92345 batch_time=29.12649 
Train Epoch: 34 [9/500 576/32000 (2%)] Loss: 0.66612 (QuantReg: 13.22414) QuantErr: 13.22414 batch_time=0.45677 
Train Epoch: 34 [17/500 1088/32000 (3%)] Loss: 0.69047 (QuantReg: 13.56174) QuantErr: 13.56174 batch_time=0.45494 
Train Epoch: 34 [25/500 1600/32000 (5%)] Loss: 0.64519 (QuantReg: 13.38714) QuantErr: 13.38714 batch_time=0.86669 
Train Epoch: 34 [33/500 2112/32000 (7%)] Loss: 0.65977 (QuantReg: 13.20978) QuantErr: 13.20978 batch_time=1.08945 
Train Epoch: 34 [41/500 2624/32000 (8%)] Loss: 0.27129 (QuantReg: 13.61863) QuantErr: 13.61863 batch_time=0.67538 
Train Epoch: 34 [49/500 3136/32000 (10%)] Loss: 0.58025 (QuantReg: 13.91988) QuantErr: 13.91988 batch_time=0.48077 
Train Epoch: 34 [57/500 3648/32000 (11%)] Loss: 0.66511 (QuantReg: 13.28717) QuantErr: 13.28717 batch_time=0.47809 
Train Epoch: 34 [65/500 4160/32000 (13%)] Loss: 0.52598 (QuantReg: 13.43695) QuantErr: 13.43695 batch_time=0.51864 
Train Epoch: 34 [73/500 4672/32000 (15%)] Loss: 0.50125 (QuantReg: 13.35185) QuantErr: 13.35185 batch_time=0.53614 
Train Epoch: 34 [81/500 5184/32000 (16%)] Loss: 0.59527 (QuantReg: 13.37275) QuantErr: 13.37275 batch_time=0.43180 
Train Epoch: 34 [89/500 5696/32000 (18%)] Loss: 0.59557 (QuantReg: 13.35942) QuantErr: 13.35942 batch_time=0.77932 
Train Epoch: 34 [97/500 6208/32000 (19%)] Loss: 0.81077 (QuantReg: 13.61086) QuantErr: 13.61086 batch_time=1.08991 
Train Epoch: 34 [105/500 6720/32000 (21%)] Loss: 0.72816 (QuantReg: 13.72942) QuantErr: 13.72942 batch_time=0.66689 
Train Epoch: 34 [113/500 7232/32000 (23%)] Loss: 0.65802 (QuantReg: 13.90610) QuantErr: 13.90610 batch_time=0.43267 
Train Epoch: 34 [121/500 7744/32000 (24%)] Loss: 0.73051 (QuantReg: 13.81060) QuantErr: 13.81060 batch_time=0.44571 
Train Epoch: 34 [129/500 8256/32000 (26%)] Loss: 0.52261 (QuantReg: 13.95181) QuantErr: 13.95181 batch_time=0.42254 
Train Epoch: 34 [137/500 8768/32000 (27%)] Loss: 0.68882 (QuantReg: 13.96621) QuantErr: 13.96621 batch_time=0.39734 
Train Epoch: 34 [145/500 9280/32000 (29%)] Loss: 0.66095 (QuantReg: 13.82072) QuantErr: 13.82072 batch_time=0.58147 
Train Epoch: 34 [153/500 9792/32000 (31%)] Loss: 0.41122 (QuantReg: 13.59412) QuantErr: 13.59412 batch_time=0.75535 
Train Epoch: 34 [161/500 10304/32000 (32%)] Loss: 0.64824 (QuantReg: 13.36764) QuantErr: 13.36764 batch_time=1.10954 
Train Epoch: 34 [169/500 10816/32000 (34%)] Loss: 0.63168 (QuantReg: 13.14718) QuantErr: 13.14718 batch_time=0.69184 
Train Epoch: 34 [177/500 11328/32000 (35%)] Loss: 0.76652 (QuantReg: 13.07638) QuantErr: 13.07638 batch_time=0.46008 
Train Epoch: 34 [185/500 11840/32000 (37%)] Loss: 0.61209 (QuantReg: 13.94913) QuantErr: 13.94913 batch_time=0.42856 
Train Epoch: 34 [193/500 12352/32000 (39%)] Loss: 0.76586 (QuantReg: 13.43556) QuantErr: 13.43556 batch_time=0.43397 
Train Epoch: 34 [201/500 12864/32000 (40%)] Loss: 0.46528 (QuantReg: 13.82185) QuantErr: 13.82185 batch_time=0.39593 
Train Epoch: 34 [209/500 13376/32000 (42%)] Loss: 0.57398 (QuantReg: 13.09988) QuantErr: 13.09988 batch_time=0.49628 
Train Epoch: 34 [217/500 13888/32000 (43%)] Loss: 0.61015 (QuantReg: 13.53078) QuantErr: 13.53078 batch_time=0.81895 
Train Epoch: 34 [225/500 14400/32000 (45%)] Loss: 0.52033 (QuantReg: 13.62348) QuantErr: 13.62348 batch_time=1.08775 
Train Epoch: 34 [233/500 14912/32000 (47%)] Loss: 0.48962 (QuantReg: 13.61825) QuantErr: 13.61825 batch_time=0.71899 
Train Epoch: 34 [241/500 15424/32000 (48%)] Loss: 0.76838 (QuantReg: 13.44345) QuantErr: 13.44345 batch_time=0.49099 
Train Epoch: 34 [249/500 15936/32000 (50%)] Loss: 0.71585 (QuantReg: 13.54637) QuantErr: 13.54637 batch_time=0.48650 
Train Epoch: 34 [257/500 16448/32000 (51%)] Loss: 0.52493 (QuantReg: 14.02377) QuantErr: 14.02377 batch_time=0.47124 
Train Epoch: 34 [265/500 16960/32000 (53%)] Loss: 0.53288 (QuantReg: 13.68353) QuantErr: 13.68353 batch_time=0.38791 
Train Epoch: 34 [273/500 17472/32000 (55%)] Loss: 0.51694 (QuantReg: 13.37944) QuantErr: 13.37944 batch_time=0.45894 
Train Epoch: 34 [281/500 17984/32000 (56%)] Loss: 0.55979 (QuantReg: 14.15048) QuantErr: 14.15048 batch_time=0.78300 
Train Epoch: 34 [289/500 18496/32000 (58%)] Loss: 0.43036 (QuantReg: 13.55153) QuantErr: 13.55153 batch_time=1.03942 
Train Epoch: 34 [297/500 19008/32000 (59%)] Loss: 0.63991 (QuantReg: 13.54472) QuantErr: 13.54472 batch_time=0.65720 
Train Epoch: 34 [305/500 19520/32000 (61%)] Loss: 0.74212 (QuantReg: 13.29385) QuantErr: 13.29385 batch_time=0.55525 
Train Epoch: 34 [313/500 20032/32000 (63%)] Loss: 0.78191 (QuantReg: 13.68658) QuantErr: 13.68658 batch_time=0.42918 
Train Epoch: 34 [321/500 20544/32000 (64%)] Loss: 0.60356 (QuantReg: 13.29620) QuantErr: 13.29620 batch_time=0.57301 
Train Epoch: 34 [329/500 21056/32000 (66%)] Loss: 0.50782 (QuantReg: 13.80984) QuantErr: 13.80984 batch_time=0.39593 
Train Epoch: 34 [337/500 21568/32000 (67%)] Loss: 0.70274 (QuantReg: 13.43377) QuantErr: 13.43377 batch_time=0.50876 
Train Epoch: 34 [345/500 22080/32000 (69%)] Loss: 0.55467 (QuantReg: 13.81091) QuantErr: 13.81091 batch_time=0.89692 
Train Epoch: 34 [353/500 22592/32000 (71%)] Loss: 0.67159 (QuantReg: 13.78104) QuantErr: 13.78104 batch_time=0.96981 
Train Epoch: 34 [361/500 23104/32000 (72%)] Loss: 0.59415 (QuantReg: 13.47862) QuantErr: 13.47862 batch_time=0.70051 
Train Epoch: 34 [369/500 23616/32000 (74%)] Loss: 0.52444 (QuantReg: 13.77128) QuantErr: 13.77128 batch_time=0.49269 
Train Epoch: 34 [377/500 24128/32000 (75%)] Loss: 0.56046 (QuantReg: 14.00280) QuantErr: 14.00280 batch_time=0.42775 
Train Epoch: 34 [385/500 24640/32000 (77%)] Loss: 0.52091 (QuantReg: 13.45496) QuantErr: 13.45496 batch_time=0.49715 
Train Epoch: 34 [393/500 25152/32000 (79%)] Loss: 0.75474 (QuantReg: 14.23082) QuantErr: 14.23082 batch_time=0.54018 
Train Epoch: 34 [401/500 25664/32000 (80%)] Loss: 0.93129 (QuantReg: 13.37315) QuantErr: 13.37315 batch_time=0.47715 
Train Epoch: 34 [409/500 26176/32000 (82%)] Loss: 0.44795 (QuantReg: 13.72755) QuantErr: 13.72755 batch_time=0.83783 
Train Epoch: 34 [417/500 26688/32000 (83%)] Loss: 0.59627 (QuantReg: 13.57058) QuantErr: 13.57058 batch_time=1.03790 
Train Epoch: 34 [425/500 27200/32000 (85%)] Loss: 0.74868 (QuantReg: 13.34838) QuantErr: 13.34838 batch_time=0.55337 
Train Epoch: 34 [433/500 27712/32000 (87%)] Loss: 0.45148 (QuantReg: 13.91459) QuantErr: 13.91459 batch_time=0.46824 
Train Epoch: 34 [441/500 28224/32000 (88%)] Loss: 0.56390 (QuantReg: 13.95698) QuantErr: 13.95698 batch_time=0.46840 
Train Epoch: 34 [449/500 28736/32000 (90%)] Loss: 0.51472 (QuantReg: 13.68731) QuantErr: 13.68731 batch_time=0.45615 
Train Epoch: 34 [457/500 29248/32000 (91%)] Loss: 0.52746 (QuantReg: 13.91912) QuantErr: 13.91912 batch_time=0.52480 
Train Epoch: 34 [465/500 29760/32000 (93%)] Loss: 0.83924 (QuantReg: 13.14453) QuantErr: 13.14453 batch_time=0.43536 
Train Epoch: 34 [473/500 30272/32000 (95%)] Loss: 0.80212 (QuantReg: 13.35929) QuantErr: 13.35929 batch_time=0.71644 
Train Epoch: 34 [481/500 30784/32000 (96%)] Loss: 0.63680 (QuantReg: 13.38413) QuantErr: 13.38413 batch_time=1.04221 
Train Epoch: 34 [489/500 31296/32000 (98%)] Loss: 0.44071 (QuantReg: 13.70722) QuantErr: 13.70722 batch_time=0.63144 
Train Epoch: 34 [497/500 31808/32000 (99%)] Loss: 0.87782 (QuantReg: 13.14877) QuantErr: 13.14877 batch_time=0.45919 
Train Epoch: 34 codebook_update_time=2.24153
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch34.pth ...
Done in 6.475s
removing stale ckpt [epoch 33] [took 0.01s]
 epoch          : 34
 loss           : 0.60067178606987
 quant_reg      : 13.579952869415283
 quant_err      : 13.579952869415283
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 17000
 MSRVTT_miech_test/t2v_metrics/R1: 21.5
 MSRVTT_miech_test/t2v_metrics/R5: 50.9
 MSRVTT_miech_test/t2v_metrics/R10: 63.9
 MSRVTT_miech_test/t2v_metrics/R50: 87.4
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.111000000000004
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.19890754164877
 MSRVTT_miech_test/v2t_metrics/R1: 21.3
 MSRVTT_miech_test/v2t_metrics/R5: 52.1
 MSRVTT_miech_test/v2t_metrics/R10: 65.4
 MSRVTT_miech_test/v2t_metrics/R50: 88.8
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.836
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.712385258877994
 mnt_best       : 41.631635822190006
 not_improved_count: 7
Train Epoch: 35 [1/500 64/32000 (0%)] Loss: 0.47494 (QuantReg: 13.70151) QuantErr: 13.70151 batch_time=30.91799 
Train Epoch: 35 [9/500 576/32000 (2%)] Loss: 0.56614 (QuantReg: 13.66935) QuantErr: 13.66935 batch_time=0.53506 
Train Epoch: 35 [17/500 1088/32000 (3%)] Loss: 0.60803 (QuantReg: 13.65156) QuantErr: 13.65156 batch_time=1.97903 
Train Epoch: 35 [25/500 1600/32000 (5%)] Loss: 0.75274 (QuantReg: 13.80401) QuantErr: 13.80401 batch_time=0.46192 
Train Epoch: 35 [33/500 2112/32000 (7%)] Loss: 0.63596 (QuantReg: 13.63240) QuantErr: 13.63240 batch_time=0.45103 
Train Epoch: 35 [41/500 2624/32000 (8%)] Loss: 0.46905 (QuantReg: 13.54773) QuantErr: 13.54773 batch_time=0.41266 
Train Epoch: 35 [49/500 3136/32000 (10%)] Loss: 0.43031 (QuantReg: 13.64130) QuantErr: 13.64130 batch_time=0.42317 
Train Epoch: 35 [57/500 3648/32000 (11%)] Loss: 0.70948 (QuantReg: 13.73224) QuantErr: 13.73224 batch_time=0.41408 
Train Epoch: 35 [65/500 4160/32000 (13%)] Loss: 0.90420 (QuantReg: 13.44009) QuantErr: 13.44009 batch_time=0.98715 
Train Epoch: 35 [73/500 4672/32000 (15%)] Loss: 0.52214 (QuantReg: 13.46922) QuantErr: 13.46922 batch_time=0.40810 
Train Epoch: 35 [81/500 5184/32000 (16%)] Loss: 0.60567 (QuantReg: 13.29604) QuantErr: 13.29604 batch_time=1.60046 
Train Epoch: 35 [89/500 5696/32000 (18%)] Loss: 0.65285 (QuantReg: 13.56965) QuantErr: 13.56965 batch_time=0.47483 
Train Epoch: 35 [97/500 6208/32000 (19%)] Loss: 0.88788 (QuantReg: 13.26528) QuantErr: 13.26528 batch_time=0.48541 
Train Epoch: 35 [105/500 6720/32000 (21%)] Loss: 0.36879 (QuantReg: 13.52874) QuantErr: 13.52874 batch_time=0.47725 
Train Epoch: 35 [113/500 7232/32000 (23%)] Loss: 0.47876 (QuantReg: 13.68717) QuantErr: 13.68717 batch_time=0.46437 
Train Epoch: 35 [121/500 7744/32000 (24%)] Loss: 0.44006 (QuantReg: 13.88915) QuantErr: 13.88915 batch_time=0.50404 
Train Epoch: 35 [129/500 8256/32000 (26%)] Loss: 0.66140 (QuantReg: 13.79241) QuantErr: 13.79241 batch_time=1.01257 
Train Epoch: 35 [137/500 8768/32000 (27%)] Loss: 0.39284 (QuantReg: 13.34755) QuantErr: 13.34755 batch_time=0.42228 
Train Epoch: 35 [145/500 9280/32000 (29%)] Loss: 0.41174 (QuantReg: 13.30302) QuantErr: 13.30302 batch_time=1.42033 
Train Epoch: 35 [153/500 9792/32000 (31%)] Loss: 0.64286 (QuantReg: 13.76416) QuantErr: 13.76416 batch_time=0.42186 
Train Epoch: 35 [161/500 10304/32000 (32%)] Loss: 0.50099 (QuantReg: 13.34664) QuantErr: 13.34664 batch_time=0.44334 
Train Epoch: 35 [169/500 10816/32000 (34%)] Loss: 0.51748 (QuantReg: 13.80361) QuantErr: 13.80361 batch_time=0.44660 
Train Epoch: 35 [177/500 11328/32000 (35%)] Loss: 0.75296 (QuantReg: 13.79735) QuantErr: 13.79735 batch_time=0.53470 
Train Epoch: 35 [185/500 11840/32000 (37%)] Loss: 0.54567 (QuantReg: 13.56013) QuantErr: 13.56013 batch_time=0.45098 
Train Epoch: 35 [193/500 12352/32000 (39%)] Loss: 0.41570 (QuantReg: 13.48012) QuantErr: 13.48012 batch_time=1.04046 
Train Epoch: 35 [201/500 12864/32000 (40%)] Loss: 0.33280 (QuantReg: 13.57845) QuantErr: 13.57845 batch_time=0.47058 
Train Epoch: 35 [209/500 13376/32000 (42%)] Loss: 0.43196 (QuantReg: 13.36101) QuantErr: 13.36101 batch_time=1.53094 
Train Epoch: 35 [217/500 13888/32000 (43%)] Loss: 0.86047 (QuantReg: 13.60339) QuantErr: 13.60339 batch_time=0.46499 
Train Epoch: 35 [225/500 14400/32000 (45%)] Loss: 0.69191 (QuantReg: 13.41877) QuantErr: 13.41877 batch_time=0.49419 
Train Epoch: 35 [233/500 14912/32000 (47%)] Loss: 0.49720 (QuantReg: 13.51892) QuantErr: 13.51892 batch_time=0.52283 
Train Epoch: 35 [241/500 15424/32000 (48%)] Loss: 0.53476 (QuantReg: 13.75462) QuantErr: 13.75462 batch_time=0.51278 
Train Epoch: 35 [249/500 15936/32000 (50%)] Loss: 0.64678 (QuantReg: 13.57006) QuantErr: 13.57006 batch_time=0.48366 
Train Epoch: 35 [257/500 16448/32000 (51%)] Loss: 0.46556 (QuantReg: 13.37185) QuantErr: 13.37185 batch_time=1.10248 
Train Epoch: 35 [265/500 16960/32000 (53%)] Loss: 0.66222 (QuantReg: 13.38998) QuantErr: 13.38998 batch_time=0.43632 
Train Epoch: 35 [273/500 17472/32000 (55%)] Loss: 0.60041 (QuantReg: 13.59713) QuantErr: 13.59713 batch_time=1.61298 
Train Epoch: 35 [281/500 17984/32000 (56%)] Loss: 0.80499 (QuantReg: 13.56291) QuantErr: 13.56291 batch_time=0.51021 
Train Epoch: 35 [289/500 18496/32000 (58%)] Loss: 0.76510 (QuantReg: 13.48847) QuantErr: 13.48847 batch_time=0.44847 
Train Epoch: 35 [297/500 19008/32000 (59%)] Loss: 0.51424 (QuantReg: 13.70225) QuantErr: 13.70225 batch_time=0.44206 
Train Epoch: 35 [305/500 19520/32000 (61%)] Loss: 0.42972 (QuantReg: 13.53811) QuantErr: 13.53811 batch_time=0.45262 
Train Epoch: 35 [313/500 20032/32000 (63%)] Loss: 0.45149 (QuantReg: 13.57411) QuantErr: 13.57411 batch_time=0.45921 
Train Epoch: 35 [321/500 20544/32000 (64%)] Loss: 0.91843 (QuantReg: 13.60477) QuantErr: 13.60477 batch_time=1.03010 
Train Epoch: 35 [329/500 21056/32000 (66%)] Loss: 0.79962 (QuantReg: 13.52306) QuantErr: 13.52306 batch_time=0.43709 
Train Epoch: 35 [337/500 21568/32000 (67%)] Loss: 0.47211 (QuantReg: 13.66385) QuantErr: 13.66385 batch_time=1.43424 
Train Epoch: 35 [345/500 22080/32000 (69%)] Loss: 0.84975 (QuantReg: 13.59837) QuantErr: 13.59837 batch_time=0.46539 
Train Epoch: 35 [353/500 22592/32000 (71%)] Loss: 0.74368 (QuantReg: 13.19282) QuantErr: 13.19282 batch_time=0.49422 
Train Epoch: 35 [361/500 23104/32000 (72%)] Loss: 0.65164 (QuantReg: 13.55847) QuantErr: 13.55847 batch_time=0.45733 
Train Epoch: 35 [369/500 23616/32000 (74%)] Loss: 0.62980 (QuantReg: 13.43196) QuantErr: 13.43196 batch_time=0.43491 
Train Epoch: 35 [377/500 24128/32000 (75%)] Loss: 0.74647 (QuantReg: 13.57006) QuantErr: 13.57006 batch_time=0.41011 
Train Epoch: 35 [385/500 24640/32000 (77%)] Loss: 0.50115 (QuantReg: 13.74796) QuantErr: 13.74796 batch_time=0.99959 
Train Epoch: 35 [393/500 25152/32000 (79%)] Loss: 0.53162 (QuantReg: 13.87204) QuantErr: 13.87204 batch_time=0.44837 
Train Epoch: 35 [401/500 25664/32000 (80%)] Loss: 0.86842 (QuantReg: 13.65815) QuantErr: 13.65815 batch_time=1.48804 
Train Epoch: 35 [409/500 26176/32000 (82%)] Loss: 0.50996 (QuantReg: 13.84974) QuantErr: 13.84974 batch_time=0.40238 
Train Epoch: 35 [417/500 26688/32000 (83%)] Loss: 0.60536 (QuantReg: 13.72414) QuantErr: 13.72414 batch_time=0.39948 
Train Epoch: 35 [425/500 27200/32000 (85%)] Loss: 0.60315 (QuantReg: 13.32269) QuantErr: 13.32269 batch_time=0.42537 
Train Epoch: 35 [433/500 27712/32000 (87%)] Loss: 0.65159 (QuantReg: 13.41267) QuantErr: 13.41267 batch_time=0.47751 
Train Epoch: 35 [441/500 28224/32000 (88%)] Loss: 0.46486 (QuantReg: 13.47297) QuantErr: 13.47297 batch_time=0.49590 
Train Epoch: 35 [449/500 28736/32000 (90%)] Loss: 0.38628 (QuantReg: 13.54510) QuantErr: 13.54510 batch_time=1.01457 
Train Epoch: 35 [457/500 29248/32000 (91%)] Loss: 1.01763 (QuantReg: 13.64541) QuantErr: 13.64541 batch_time=0.49114 
Train Epoch: 35 [465/500 29760/32000 (93%)] Loss: 0.43242 (QuantReg: 14.14248) QuantErr: 14.14248 batch_time=1.50245 
Train Epoch: 35 [473/500 30272/32000 (95%)] Loss: 0.50597 (QuantReg: 14.26099) QuantErr: 14.26099 batch_time=0.47187 
Train Epoch: 35 [481/500 30784/32000 (96%)] Loss: 0.59197 (QuantReg: 13.36015) QuantErr: 13.36015 batch_time=0.46931 
Train Epoch: 35 [489/500 31296/32000 (98%)] Loss: 0.83271 (QuantReg: 13.57795) QuantErr: 13.57795 batch_time=0.47084 
Train Epoch: 35 [497/500 31808/32000 (99%)] Loss: 0.42297 (QuantReg: 13.56121) QuantErr: 13.56121 batch_time=0.45551 
Train Epoch: 35 codebook_update_time=2.51603
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch35.pth ...
Done in 6.062s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch35.pth ...
Done in 11.439s
removing stale ckpt [epoch 34] [took 0.00s]
 epoch          : 35
 loss           : 0.5962128313481808
 quant_reg      : 13.608450298309327
 quant_err      : 13.608450298309327
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 17500
 MSRVTT_miech_test/t2v_metrics/R1: 22.5
 MSRVTT_miech_test/t2v_metrics/R5: 51.1
 MSRVTT_miech_test/t2v_metrics/R10: 63.3
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.175
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.751207729175384
 MSRVTT_miech_test/v2t_metrics/R1: 21.7
 MSRVTT_miech_test/v2t_metrics/R5: 51.7
 MSRVTT_miech_test/v2t_metrics/R10: 64.0
 MSRVTT_miech_test/v2t_metrics/R50: 89.8
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.047
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.563305907074636
 mnt_best       : 41.751207729175384
 not_improved_count: 0
Train Epoch: 36 [1/500 64/32000 (0%)] Loss: 0.59022 (QuantReg: 13.66682) QuantErr: 13.66682 batch_time=29.95258 
Train Epoch: 36 [9/500 576/32000 (2%)] Loss: 0.58619 (QuantReg: 13.49644) QuantErr: 13.49644 batch_time=0.45370 
Train Epoch: 36 [17/500 1088/32000 (3%)] Loss: 0.52874 (QuantReg: 13.53294) QuantErr: 13.53294 batch_time=0.45814 
Train Epoch: 36 [25/500 1600/32000 (5%)] Loss: 0.60297 (QuantReg: 13.66929) QuantErr: 13.66929 batch_time=0.46212 
Train Epoch: 36 [33/500 2112/32000 (7%)] Loss: 0.34033 (QuantReg: 13.85974) QuantErr: 13.85974 batch_time=0.48659 
Train Epoch: 36 [41/500 2624/32000 (8%)] Loss: 0.49587 (QuantReg: 14.10365) QuantErr: 14.10365 batch_time=0.48238 
Train Epoch: 36 [49/500 3136/32000 (10%)] Loss: 0.48162 (QuantReg: 13.72097) QuantErr: 13.72097 batch_time=0.47076 
Train Epoch: 36 [57/500 3648/32000 (11%)] Loss: 0.64815 (QuantReg: 13.72585) QuantErr: 13.72585 batch_time=0.61533 
Train Epoch: 36 [65/500 4160/32000 (13%)] Loss: 0.70795 (QuantReg: 13.46822) QuantErr: 13.46822 batch_time=0.41942 
Train Epoch: 36 [73/500 4672/32000 (15%)] Loss: 0.46052 (QuantReg: 13.72503) QuantErr: 13.72503 batch_time=0.42309 
Train Epoch: 36 [81/500 5184/32000 (16%)] Loss: 0.57037 (QuantReg: 13.58253) QuantErr: 13.58253 batch_time=0.50349 
Train Epoch: 36 [89/500 5696/32000 (18%)] Loss: 0.39386 (QuantReg: 13.65452) QuantErr: 13.65452 batch_time=0.47627 
Train Epoch: 36 [97/500 6208/32000 (19%)] Loss: 0.64818 (QuantReg: 13.20057) QuantErr: 13.20057 batch_time=0.46572 
Train Epoch: 36 [105/500 6720/32000 (21%)] Loss: 0.63244 (QuantReg: 13.70183) QuantErr: 13.70183 batch_time=0.43117 
Train Epoch: 36 [113/500 7232/32000 (23%)] Loss: 0.76989 (QuantReg: 14.01542) QuantErr: 14.01542 batch_time=0.46605 
Train Epoch: 36 [121/500 7744/32000 (24%)] Loss: 0.52475 (QuantReg: 13.65179) QuantErr: 13.65179 batch_time=0.63524 
Train Epoch: 36 [129/500 8256/32000 (26%)] Loss: 0.72520 (QuantReg: 13.60022) QuantErr: 13.60022 batch_time=0.43478 
Train Epoch: 36 [137/500 8768/32000 (27%)] Loss: 0.63572 (QuantReg: 13.76132) QuantErr: 13.76132 batch_time=0.47432 
Train Epoch: 36 [145/500 9280/32000 (29%)] Loss: 0.63001 (QuantReg: 13.03099) QuantErr: 13.03099 batch_time=0.46351 
Train Epoch: 36 [153/500 9792/32000 (31%)] Loss: 0.67871 (QuantReg: 13.41935) QuantErr: 13.41935 batch_time=0.47694 
Train Epoch: 36 [161/500 10304/32000 (32%)] Loss: 0.59884 (QuantReg: 13.69539) QuantErr: 13.69539 batch_time=0.46587 
Train Epoch: 36 [169/500 10816/32000 (34%)] Loss: 0.53856 (QuantReg: 13.81926) QuantErr: 13.81926 batch_time=0.49836 
Train Epoch: 36 [177/500 11328/32000 (35%)] Loss: 0.60797 (QuantReg: 13.64087) QuantErr: 13.64087 batch_time=0.45623 
Train Epoch: 36 [185/500 11840/32000 (37%)] Loss: 0.76214 (QuantReg: 13.80397) QuantErr: 13.80397 batch_time=0.66997 
Train Epoch: 36 [193/500 12352/32000 (39%)] Loss: 0.53736 (QuantReg: 13.97348) QuantErr: 13.97348 batch_time=0.45186 
Train Epoch: 36 [201/500 12864/32000 (40%)] Loss: 0.79899 (QuantReg: 13.61104) QuantErr: 13.61104 batch_time=0.48548 
Train Epoch: 36 [209/500 13376/32000 (42%)] Loss: 0.41463 (QuantReg: 13.27935) QuantErr: 13.27935 batch_time=0.49030 
Train Epoch: 36 [217/500 13888/32000 (43%)] Loss: 0.74244 (QuantReg: 13.56184) QuantErr: 13.56184 batch_time=0.44984 
Train Epoch: 36 [225/500 14400/32000 (45%)] Loss: 0.76748 (QuantReg: 13.61506) QuantErr: 13.61506 batch_time=0.47553 
Train Epoch: 36 [233/500 14912/32000 (47%)] Loss: 0.82897 (QuantReg: 13.39603) QuantErr: 13.39603 batch_time=0.45436 
Train Epoch: 36 [241/500 15424/32000 (48%)] Loss: 0.48171 (QuantReg: 14.05151) QuantErr: 14.05151 batch_time=0.48607 
Train Epoch: 36 [249/500 15936/32000 (50%)] Loss: 0.67513 (QuantReg: 13.87947) QuantErr: 13.87947 batch_time=0.66666 
Train Epoch: 36 [257/500 16448/32000 (51%)] Loss: 0.41201 (QuantReg: 13.85148) QuantErr: 13.85148 batch_time=0.45965 
Train Epoch: 36 [265/500 16960/32000 (53%)] Loss: 0.44377 (QuantReg: 13.65024) QuantErr: 13.65024 batch_time=0.42538 
Train Epoch: 36 [273/500 17472/32000 (55%)] Loss: 0.38946 (QuantReg: 13.84281) QuantErr: 13.84281 batch_time=0.48608 
Train Epoch: 36 [281/500 17984/32000 (56%)] Loss: 0.45010 (QuantReg: 13.75233) QuantErr: 13.75233 batch_time=0.50848 
Train Epoch: 36 [289/500 18496/32000 (58%)] Loss: 0.45334 (QuantReg: 13.77254) QuantErr: 13.77254 batch_time=0.41374 
Train Epoch: 36 [297/500 19008/32000 (59%)] Loss: 0.88432 (QuantReg: 13.63113) QuantErr: 13.63113 batch_time=0.41276 
Train Epoch: 36 [305/500 19520/32000 (61%)] Loss: 0.65563 (QuantReg: 13.73443) QuantErr: 13.73443 batch_time=0.42436 
Train Epoch: 36 [313/500 20032/32000 (63%)] Loss: 0.35711 (QuantReg: 13.63075) QuantErr: 13.63075 batch_time=0.72732 
Train Epoch: 36 [321/500 20544/32000 (64%)] Loss: 0.36923 (QuantReg: 14.11450) QuantErr: 14.11450 batch_time=0.40908 
Train Epoch: 36 [329/500 21056/32000 (66%)] Loss: 0.60092 (QuantReg: 13.88787) QuantErr: 13.88787 batch_time=0.51213 
Train Epoch: 36 [337/500 21568/32000 (67%)] Loss: 0.51767 (QuantReg: 13.59923) QuantErr: 13.59923 batch_time=0.48840 
Train Epoch: 36 [345/500 22080/32000 (69%)] Loss: 0.60204 (QuantReg: 13.81120) QuantErr: 13.81120 batch_time=0.44073 
Train Epoch: 36 [353/500 22592/32000 (71%)] Loss: 0.73331 (QuantReg: 13.84257) QuantErr: 13.84257 batch_time=0.51263 
Train Epoch: 36 [361/500 23104/32000 (72%)] Loss: 0.54232 (QuantReg: 13.67199) QuantErr: 13.67199 batch_time=0.49123 
Train Epoch: 36 [369/500 23616/32000 (74%)] Loss: 0.55787 (QuantReg: 14.17770) QuantErr: 14.17770 batch_time=0.42708 
Train Epoch: 36 [377/500 24128/32000 (75%)] Loss: 0.52356 (QuantReg: 13.50632) QuantErr: 13.50632 batch_time=0.67233 
Train Epoch: 36 [385/500 24640/32000 (77%)] Loss: 0.65479 (QuantReg: 13.73079) QuantErr: 13.73079 batch_time=0.46217 
Train Epoch: 36 [393/500 25152/32000 (79%)] Loss: 0.58062 (QuantReg: 13.75336) QuantErr: 13.75336 batch_time=0.42655 
Train Epoch: 36 [401/500 25664/32000 (80%)] Loss: 0.46383 (QuantReg: 13.81046) QuantErr: 13.81046 batch_time=0.45085 
Train Epoch: 36 [409/500 26176/32000 (82%)] Loss: 0.49823 (QuantReg: 13.30113) QuantErr: 13.30113 batch_time=0.46448 
Train Epoch: 36 [417/500 26688/32000 (83%)] Loss: 0.59898 (QuantReg: 13.57738) QuantErr: 13.57738 batch_time=0.43032 
Train Epoch: 36 [425/500 27200/32000 (85%)] Loss: 0.67033 (QuantReg: 13.93550) QuantErr: 13.93550 batch_time=0.48611 
Train Epoch: 36 [433/500 27712/32000 (87%)] Loss: 0.55081 (QuantReg: 13.82141) QuantErr: 13.82141 batch_time=0.45118 
Train Epoch: 36 [441/500 28224/32000 (88%)] Loss: 0.60614 (QuantReg: 13.64068) QuantErr: 13.64068 batch_time=0.64895 
Train Epoch: 36 [449/500 28736/32000 (90%)] Loss: 0.50207 (QuantReg: 13.28653) QuantErr: 13.28653 batch_time=0.47222 
Train Epoch: 36 [457/500 29248/32000 (91%)] Loss: 0.61150 (QuantReg: 13.08556) QuantErr: 13.08556 batch_time=0.42474 
Train Epoch: 36 [465/500 29760/32000 (93%)] Loss: 0.44697 (QuantReg: 13.73576) QuantErr: 13.73576 batch_time=0.42940 
Train Epoch: 36 [473/500 30272/32000 (95%)] Loss: 0.60573 (QuantReg: 13.56749) QuantErr: 13.56749 batch_time=0.42559 
Train Epoch: 36 [481/500 30784/32000 (96%)] Loss: 0.41306 (QuantReg: 13.66628) QuantErr: 13.66628 batch_time=0.49131 
Train Epoch: 36 [489/500 31296/32000 (98%)] Loss: 0.65759 (QuantReg: 13.02846) QuantErr: 13.02846 batch_time=0.46390 
Train Epoch: 36 [497/500 31808/32000 (99%)] Loss: 0.65903 (QuantReg: 13.62898) QuantErr: 13.62898 batch_time=0.56204 
Train Epoch: 36 codebook_update_time=2.36856
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch36.pth ...
Done in 7.342s
removing stale ckpt [epoch 35] [took 0.11s]
 epoch          : 36
 loss           : 0.5846549600362778
 quant_reg      : 13.649128360748291
 quant_err      : 13.649128360748291
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 18000
 MSRVTT_miech_test/t2v_metrics/R1: 21.9
 MSRVTT_miech_test/t2v_metrics/R5: 50.1
 MSRVTT_miech_test/t2v_metrics/R10: 64.4
 MSRVTT_miech_test/t2v_metrics/R50: 87.2
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.681
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.34178613690506
 MSRVTT_miech_test/v2t_metrics/R1: 21.4
 MSRVTT_miech_test/v2t_metrics/R5: 52.5
 MSRVTT_miech_test/v2t_metrics/R10: 64.8
 MSRVTT_miech_test/v2t_metrics/R50: 89.2
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.851
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.75572488934927
 mnt_best       : 41.751207729175384
 not_improved_count: 1
Train Epoch: 37 [1/500 64/32000 (0%)] Loss: 0.65965 (QuantReg: 13.06426) QuantErr: 13.06426 batch_time=32.89660 
Train Epoch: 37 [9/500 576/32000 (2%)] Loss: 0.57620 (QuantReg: 13.57505) QuantErr: 13.57505 batch_time=0.41679 
Train Epoch: 37 [17/500 1088/32000 (3%)] Loss: 0.92134 (QuantReg: 13.39444) QuantErr: 13.39444 batch_time=0.47565 
Train Epoch: 37 [25/500 1600/32000 (5%)] Loss: 0.51067 (QuantReg: 13.55445) QuantErr: 13.55445 batch_time=0.49531 
Train Epoch: 37 [33/500 2112/32000 (7%)] Loss: 0.28819 (QuantReg: 13.32207) QuantErr: 13.32207 batch_time=0.47180 
Train Epoch: 37 [41/500 2624/32000 (8%)] Loss: 0.63930 (QuantReg: 13.80165) QuantErr: 13.80165 batch_time=0.39811 
Train Epoch: 37 [49/500 3136/32000 (10%)] Loss: 0.52042 (QuantReg: 13.72852) QuantErr: 13.72852 batch_time=0.41380 
Train Epoch: 37 [57/500 3648/32000 (11%)] Loss: 0.61893 (QuantReg: 13.18042) QuantErr: 13.18042 batch_time=0.42545 
Train Epoch: 37 [65/500 4160/32000 (13%)] Loss: 0.56999 (QuantReg: 13.67594) QuantErr: 13.67594 batch_time=1.91497 
Train Epoch: 37 [73/500 4672/32000 (15%)] Loss: 0.53947 (QuantReg: 13.75181) QuantErr: 13.75181 batch_time=0.48355 
Train Epoch: 37 [81/500 5184/32000 (16%)] Loss: 0.66967 (QuantReg: 13.27833) QuantErr: 13.27833 batch_time=0.41230 
Train Epoch: 37 [89/500 5696/32000 (18%)] Loss: 0.80376 (QuantReg: 13.47658) QuantErr: 13.47658 batch_time=0.47564 
Train Epoch: 37 [97/500 6208/32000 (19%)] Loss: 0.46637 (QuantReg: 13.43169) QuantErr: 13.43169 batch_time=0.50389 
Train Epoch: 37 [105/500 6720/32000 (21%)] Loss: 0.79530 (QuantReg: 13.52971) QuantErr: 13.52971 batch_time=0.48195 
Train Epoch: 37 [113/500 7232/32000 (23%)] Loss: 0.48007 (QuantReg: 13.60597) QuantErr: 13.60597 batch_time=0.44090 
Train Epoch: 37 [121/500 7744/32000 (24%)] Loss: 0.70201 (QuantReg: 13.46878) QuantErr: 13.46878 batch_time=0.42333 
Train Epoch: 37 [129/500 8256/32000 (26%)] Loss: 0.59209 (QuantReg: 13.49069) QuantErr: 13.49069 batch_time=1.95230 
Train Epoch: 37 [137/500 8768/32000 (27%)] Loss: 0.61856 (QuantReg: 14.15833) QuantErr: 14.15833 batch_time=0.53044 
Train Epoch: 37 [145/500 9280/32000 (29%)] Loss: 0.33894 (QuantReg: 13.57399) QuantErr: 13.57399 batch_time=0.43140 
Train Epoch: 37 [153/500 9792/32000 (31%)] Loss: 0.86167 (QuantReg: 13.52865) QuantErr: 13.52865 batch_time=0.41287 
Train Epoch: 37 [161/500 10304/32000 (32%)] Loss: 0.63743 (QuantReg: 13.35945) QuantErr: 13.35945 batch_time=0.48281 
Train Epoch: 37 [169/500 10816/32000 (34%)] Loss: 0.59842 (QuantReg: 13.57783) QuantErr: 13.57783 batch_time=0.44342 
Train Epoch: 37 [177/500 11328/32000 (35%)] Loss: 0.37664 (QuantReg: 13.58532) QuantErr: 13.58532 batch_time=0.50294 
Train Epoch: 37 [185/500 11840/32000 (37%)] Loss: 0.51494 (QuantReg: 13.51125) QuantErr: 13.51125 batch_time=0.45595 
Train Epoch: 37 [193/500 12352/32000 (39%)] Loss: 0.82631 (QuantReg: 13.67758) QuantErr: 13.67758 batch_time=1.94460 
Train Epoch: 37 [201/500 12864/32000 (40%)] Loss: 0.87012 (QuantReg: 13.88910) QuantErr: 13.88910 batch_time=0.50058 
Train Epoch: 37 [209/500 13376/32000 (42%)] Loss: 0.59339 (QuantReg: 13.51564) QuantErr: 13.51564 batch_time=0.55873 
Train Epoch: 37 [217/500 13888/32000 (43%)] Loss: 0.78355 (QuantReg: 13.22403) QuantErr: 13.22403 batch_time=0.41907 
Train Epoch: 37 [225/500 14400/32000 (45%)] Loss: 0.65921 (QuantReg: 14.02324) QuantErr: 14.02324 batch_time=0.47247 
Train Epoch: 37 [233/500 14912/32000 (47%)] Loss: 0.47797 (QuantReg: 13.83978) QuantErr: 13.83978 batch_time=0.46035 
Train Epoch: 37 [241/500 15424/32000 (48%)] Loss: 0.53136 (QuantReg: 13.44675) QuantErr: 13.44675 batch_time=0.43972 
Train Epoch: 37 [249/500 15936/32000 (50%)] Loss: 0.61912 (QuantReg: 13.35805) QuantErr: 13.35805 batch_time=0.40723 
Train Epoch: 37 [257/500 16448/32000 (51%)] Loss: 0.51318 (QuantReg: 13.74076) QuantErr: 13.74076 batch_time=1.84894 
Train Epoch: 37 [265/500 16960/32000 (53%)] Loss: 0.71804 (QuantReg: 13.39482) QuantErr: 13.39482 batch_time=0.43645 
Train Epoch: 37 [273/500 17472/32000 (55%)] Loss: 1.02740 (QuantReg: 13.40686) QuantErr: 13.40686 batch_time=0.40691 
Train Epoch: 37 [281/500 17984/32000 (56%)] Loss: 0.51340 (QuantReg: 13.39535) QuantErr: 13.39535 batch_time=0.40083 
Train Epoch: 37 [289/500 18496/32000 (58%)] Loss: 0.73651 (QuantReg: 13.35508) QuantErr: 13.35508 batch_time=0.46011 
Train Epoch: 37 [297/500 19008/32000 (59%)] Loss: 0.60477 (QuantReg: 13.65090) QuantErr: 13.65090 batch_time=0.46120 
Train Epoch: 37 [305/500 19520/32000 (61%)] Loss: 0.68013 (QuantReg: 13.65410) QuantErr: 13.65410 batch_time=0.42925 
Train Epoch: 37 [313/500 20032/32000 (63%)] Loss: 0.73062 (QuantReg: 13.56044) QuantErr: 13.56044 batch_time=0.43998 
Train Epoch: 37 [321/500 20544/32000 (64%)] Loss: 0.55883 (QuantReg: 13.51768) QuantErr: 13.51768 batch_time=1.93537 
Train Epoch: 37 [329/500 21056/32000 (66%)] Loss: 0.62147 (QuantReg: 13.36734) QuantErr: 13.36734 batch_time=0.42476 
Train Epoch: 37 [337/500 21568/32000 (67%)] Loss: 0.45755 (QuantReg: 13.55301) QuantErr: 13.55301 batch_time=0.45494 
Train Epoch: 37 [345/500 22080/32000 (69%)] Loss: 0.70891 (QuantReg: 13.44021) QuantErr: 13.44021 batch_time=0.46971 
Train Epoch: 37 [353/500 22592/32000 (71%)] Loss: 0.76240 (QuantReg: 13.71387) QuantErr: 13.71387 batch_time=0.42931 
Train Epoch: 37 [361/500 23104/32000 (72%)] Loss: 0.49310 (QuantReg: 13.86680) QuantErr: 13.86680 batch_time=0.45879 
Train Epoch: 37 [369/500 23616/32000 (74%)] Loss: 0.42474 (QuantReg: 13.47730) QuantErr: 13.47730 batch_time=0.48647 
Train Epoch: 37 [377/500 24128/32000 (75%)] Loss: 0.41762 (QuantReg: 13.80628) QuantErr: 13.80628 batch_time=0.51045 
Train Epoch: 37 [385/500 24640/32000 (77%)] Loss: 0.49864 (QuantReg: 13.95180) QuantErr: 13.95180 batch_time=2.01568 
Train Epoch: 37 [393/500 25152/32000 (79%)] Loss: 0.32036 (QuantReg: 13.40337) QuantErr: 13.40337 batch_time=0.45345 
Train Epoch: 37 [401/500 25664/32000 (80%)] Loss: 0.64454 (QuantReg: 13.69298) QuantErr: 13.69298 batch_time=0.45764 
Train Epoch: 37 [409/500 26176/32000 (82%)] Loss: 0.74014 (QuantReg: 13.49597) QuantErr: 13.49597 batch_time=0.44822 
Train Epoch: 37 [417/500 26688/32000 (83%)] Loss: 0.62642 (QuantReg: 13.91977) QuantErr: 13.91977 batch_time=0.48268 
Train Epoch: 37 [425/500 27200/32000 (85%)] Loss: 0.48116 (QuantReg: 13.98707) QuantErr: 13.98707 batch_time=0.45090 
Train Epoch: 37 [433/500 27712/32000 (87%)] Loss: 0.71794 (QuantReg: 13.54507) QuantErr: 13.54507 batch_time=0.42508 
Train Epoch: 37 [441/500 28224/32000 (88%)] Loss: 0.53475 (QuantReg: 13.46333) QuantErr: 13.46333 batch_time=0.46526 
Train Epoch: 37 [449/500 28736/32000 (90%)] Loss: 0.76302 (QuantReg: 13.23443) QuantErr: 13.23443 batch_time=1.91216 
Train Epoch: 37 [457/500 29248/32000 (91%)] Loss: 0.58173 (QuantReg: 13.85695) QuantErr: 13.85695 batch_time=0.49265 
Train Epoch: 37 [465/500 29760/32000 (93%)] Loss: 0.61595 (QuantReg: 13.84796) QuantErr: 13.84796 batch_time=0.45123 
Train Epoch: 37 [473/500 30272/32000 (95%)] Loss: 0.47873 (QuantReg: 14.18939) QuantErr: 14.18939 batch_time=0.46873 
Train Epoch: 37 [481/500 30784/32000 (96%)] Loss: 0.92494 (QuantReg: 13.72565) QuantErr: 13.72565 batch_time=0.49710 
Train Epoch: 37 [489/500 31296/32000 (98%)] Loss: 0.65145 (QuantReg: 13.64754) QuantErr: 13.64754 batch_time=0.49512 
Train Epoch: 37 [497/500 31808/32000 (99%)] Loss: 0.53961 (QuantReg: 13.76959) QuantErr: 13.76959 batch_time=0.49738 
Train Epoch: 37 codebook_update_time=2.34934
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch37.pth ...
Done in 6.321s
removing stale ckpt [epoch 36] [took 0.00s]
 epoch          : 37
 loss           : 0.5922995463609696
 quant_reg      : 13.62654109954834
 quant_err      : 13.62654109954834
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 18500
 MSRVTT_miech_test/t2v_metrics/R1: 20.7
 MSRVTT_miech_test/t2v_metrics/R5: 51.0
 MSRVTT_miech_test/t2v_metrics/R10: 64.0
 MSRVTT_miech_test/t2v_metrics/R50: 87.6
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.746
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.72928928636001
 MSRVTT_miech_test/v2t_metrics/R1: 20.9
 MSRVTT_miech_test/v2t_metrics/R5: 50.9
 MSRVTT_miech_test/v2t_metrics/R10: 65.3
 MSRVTT_miech_test/v2t_metrics/R50: 89.1
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 26.9625
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.10794340146405
 mnt_best       : 41.751207729175384
 not_improved_count: 2
Train Epoch: 38 [1/500 64/32000 (0%)] Loss: 0.40830 (QuantReg: 13.44527) QuantErr: 13.44527 batch_time=31.60288 
Train Epoch: 38 [9/500 576/32000 (2%)] Loss: 0.44415 (QuantReg: 13.61547) QuantErr: 13.61547 batch_time=0.52299 
Train Epoch: 38 [17/500 1088/32000 (3%)] Loss: 0.63923 (QuantReg: 13.82316) QuantErr: 13.82316 batch_time=0.48513 
Train Epoch: 38 [25/500 1600/32000 (5%)] Loss: 0.50200 (QuantReg: 13.60494) QuantErr: 13.60494 batch_time=0.49012 
Train Epoch: 38 [33/500 2112/32000 (7%)] Loss: 0.62019 (QuantReg: 13.42303) QuantErr: 13.42303 batch_time=0.45635 
Train Epoch: 38 [41/500 2624/32000 (8%)] Loss: 0.56383 (QuantReg: 13.61872) QuantErr: 13.61872 batch_time=0.45735 
Train Epoch: 38 [49/500 3136/32000 (10%)] Loss: 0.55744 (QuantReg: 13.54326) QuantErr: 13.54326 batch_time=0.42635 
Train Epoch: 38 [57/500 3648/32000 (11%)] Loss: 0.32495 (QuantReg: 13.66961) QuantErr: 13.66961 batch_time=0.44506 
Train Epoch: 38 [65/500 4160/32000 (13%)] Loss: 0.52260 (QuantReg: 13.83681) QuantErr: 13.83681 batch_time=1.06981 
Train Epoch: 38 [73/500 4672/32000 (15%)] Loss: 0.49538 (QuantReg: 14.05803) QuantErr: 14.05803 batch_time=0.83444 
Train Epoch: 38 [81/500 5184/32000 (16%)] Loss: 0.63778 (QuantReg: 13.87067) QuantErr: 13.87067 batch_time=0.40142 
Train Epoch: 38 [89/500 5696/32000 (18%)] Loss: 0.60290 (QuantReg: 13.44444) QuantErr: 13.44444 batch_time=0.43242 
Train Epoch: 38 [97/500 6208/32000 (19%)] Loss: 0.57633 (QuantReg: 13.31817) QuantErr: 13.31817 batch_time=0.46622 
Train Epoch: 38 [105/500 6720/32000 (21%)] Loss: 0.56809 (QuantReg: 13.95916) QuantErr: 13.95916 batch_time=0.44120 
Train Epoch: 38 [113/500 7232/32000 (23%)] Loss: 0.48975 (QuantReg: 13.46587) QuantErr: 13.46587 batch_time=0.43422 
Train Epoch: 38 [121/500 7744/32000 (24%)] Loss: 0.81507 (QuantReg: 13.18170) QuantErr: 13.18170 batch_time=0.43679 
Train Epoch: 38 [129/500 8256/32000 (26%)] Loss: 0.40186 (QuantReg: 13.58877) QuantErr: 13.58877 batch_time=0.94636 
Train Epoch: 38 [137/500 8768/32000 (27%)] Loss: 0.67130 (QuantReg: 13.23726) QuantErr: 13.23726 batch_time=0.48339 
Train Epoch: 38 [145/500 9280/32000 (29%)] Loss: 0.68214 (QuantReg: 13.19929) QuantErr: 13.19929 batch_time=0.46658 
Train Epoch: 38 [153/500 9792/32000 (31%)] Loss: 0.86988 (QuantReg: 13.50753) QuantErr: 13.50753 batch_time=0.46978 
Train Epoch: 38 [161/500 10304/32000 (32%)] Loss: 0.49143 (QuantReg: 13.35142) QuantErr: 13.35142 batch_time=0.40743 
Train Epoch: 38 [169/500 10816/32000 (34%)] Loss: 0.70271 (QuantReg: 13.43593) QuantErr: 13.43593 batch_time=0.43836 
Train Epoch: 38 [177/500 11328/32000 (35%)] Loss: 0.24404 (QuantReg: 14.01362) QuantErr: 14.01362 batch_time=0.41910 
Train Epoch: 38 [185/500 11840/32000 (37%)] Loss: 0.49870 (QuantReg: 13.75716) QuantErr: 13.75716 batch_time=0.40330 
Train Epoch: 38 [193/500 12352/32000 (39%)] Loss: 0.56428 (QuantReg: 13.91808) QuantErr: 13.91808 batch_time=0.93476 
Train Epoch: 38 [201/500 12864/32000 (40%)] Loss: 0.61217 (QuantReg: 13.80032) QuantErr: 13.80032 batch_time=0.44705 
Train Epoch: 38 [209/500 13376/32000 (42%)] Loss: 0.60161 (QuantReg: 13.42861) QuantErr: 13.42861 batch_time=0.45362 
Train Epoch: 38 [217/500 13888/32000 (43%)] Loss: 0.57136 (QuantReg: 13.84535) QuantErr: 13.84535 batch_time=0.50637 
Train Epoch: 38 [225/500 14400/32000 (45%)] Loss: 0.71349 (QuantReg: 13.58926) QuantErr: 13.58926 batch_time=0.42708 
Train Epoch: 38 [233/500 14912/32000 (47%)] Loss: 0.46781 (QuantReg: 13.81205) QuantErr: 13.81205 batch_time=0.49929 
Train Epoch: 38 [241/500 15424/32000 (48%)] Loss: 0.41358 (QuantReg: 13.99000) QuantErr: 13.99000 batch_time=0.50689 
Train Epoch: 38 [249/500 15936/32000 (50%)] Loss: 0.71951 (QuantReg: 14.04343) QuantErr: 14.04343 batch_time=0.43002 
Train Epoch: 38 [257/500 16448/32000 (51%)] Loss: 0.58600 (QuantReg: 13.73492) QuantErr: 13.73492 batch_time=1.05473 
Train Epoch: 38 [265/500 16960/32000 (53%)] Loss: 0.86523 (QuantReg: 13.07426) QuantErr: 13.07426 batch_time=0.48606 
Train Epoch: 38 [273/500 17472/32000 (55%)] Loss: 0.67831 (QuantReg: 13.89440) QuantErr: 13.89440 batch_time=0.46336 
Train Epoch: 38 [281/500 17984/32000 (56%)] Loss: 0.45826 (QuantReg: 13.40082) QuantErr: 13.40082 batch_time=0.42585 
Train Epoch: 38 [289/500 18496/32000 (58%)] Loss: 0.32561 (QuantReg: 13.95163) QuantErr: 13.95163 batch_time=0.54067 
Train Epoch: 38 [297/500 19008/32000 (59%)] Loss: 0.39261 (QuantReg: 13.90425) QuantErr: 13.90425 batch_time=0.50614 
Train Epoch: 38 [305/500 19520/32000 (61%)] Loss: 0.62931 (QuantReg: 14.00086) QuantErr: 14.00086 batch_time=0.46634 
Train Epoch: 38 [313/500 20032/32000 (63%)] Loss: 0.29972 (QuantReg: 13.95147) QuantErr: 13.95147 batch_time=0.50529 
Train Epoch: 38 [321/500 20544/32000 (64%)] Loss: 0.57018 (QuantReg: 14.07163) QuantErr: 14.07163 batch_time=1.05698 
Train Epoch: 38 [329/500 21056/32000 (66%)] Loss: 0.42434 (QuantReg: 13.41177) QuantErr: 13.41177 batch_time=0.45071 
Train Epoch: 38 [337/500 21568/32000 (67%)] Loss: 0.64826 (QuantReg: 13.99204) QuantErr: 13.99204 batch_time=0.42408 
Train Epoch: 38 [345/500 22080/32000 (69%)] Loss: 0.59921 (QuantReg: 13.84425) QuantErr: 13.84425 batch_time=0.45749 
Train Epoch: 38 [353/500 22592/32000 (71%)] Loss: 0.54461 (QuantReg: 13.49085) QuantErr: 13.49085 batch_time=0.41904 
Train Epoch: 38 [361/500 23104/32000 (72%)] Loss: 0.54505 (QuantReg: 13.92693) QuantErr: 13.92693 batch_time=0.42801 
Train Epoch: 38 [369/500 23616/32000 (74%)] Loss: 0.77356 (QuantReg: 13.56147) QuantErr: 13.56147 batch_time=0.51591 
Train Epoch: 38 [377/500 24128/32000 (75%)] Loss: 0.44557 (QuantReg: 13.76079) QuantErr: 13.76079 batch_time=0.43787 
Train Epoch: 38 [385/500 24640/32000 (77%)] Loss: 0.73792 (QuantReg: 13.47673) QuantErr: 13.47673 batch_time=1.08787 
Train Epoch: 38 [393/500 25152/32000 (79%)] Loss: 0.57052 (QuantReg: 14.08029) QuantErr: 14.08029 batch_time=0.39664 
Train Epoch: 38 [401/500 25664/32000 (80%)] Loss: 0.45252 (QuantReg: 14.04134) QuantErr: 14.04134 batch_time=0.41251 
Train Epoch: 38 [409/500 26176/32000 (82%)] Loss: 0.52878 (QuantReg: 13.53515) QuantErr: 13.53515 batch_time=0.48886 
Train Epoch: 38 [417/500 26688/32000 (83%)] Loss: 0.37742 (QuantReg: 13.62814) QuantErr: 13.62814 batch_time=0.49413 
Train Epoch: 38 [425/500 27200/32000 (85%)] Loss: 0.58653 (QuantReg: 13.75985) QuantErr: 13.75985 batch_time=0.48513 
Train Epoch: 38 [433/500 27712/32000 (87%)] Loss: 0.66329 (QuantReg: 13.24073) QuantErr: 13.24073 batch_time=0.46233 
Train Epoch: 38 [441/500 28224/32000 (88%)] Loss: 0.38619 (QuantReg: 13.86725) QuantErr: 13.86725 batch_time=0.46118 
Train Epoch: 38 [449/500 28736/32000 (90%)] Loss: 0.32758 (QuantReg: 13.60958) QuantErr: 13.60958 batch_time=1.10171 
Train Epoch: 38 [457/500 29248/32000 (91%)] Loss: 0.64645 (QuantReg: 13.78276) QuantErr: 13.78276 batch_time=0.46646 
Train Epoch: 38 [465/500 29760/32000 (93%)] Loss: 0.30256 (QuantReg: 13.78639) QuantErr: 13.78639 batch_time=0.48555 
Train Epoch: 38 [473/500 30272/32000 (95%)] Loss: 0.71708 (QuantReg: 13.51920) QuantErr: 13.51920 batch_time=0.42231 
Train Epoch: 38 [481/500 30784/32000 (96%)] Loss: 0.72253 (QuantReg: 13.33008) QuantErr: 13.33008 batch_time=0.56780 
Train Epoch: 38 [489/500 31296/32000 (98%)] Loss: 0.47961 (QuantReg: 13.51327) QuantErr: 13.51327 batch_time=0.50289 
Train Epoch: 38 [497/500 31808/32000 (99%)] Loss: 0.37522 (QuantReg: 13.95464) QuantErr: 13.95464 batch_time=0.48392 
Train Epoch: 38 codebook_update_time=2.12833
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch38.pth ...
Done in 6.656s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 0.5746637088656426
 quant_reg      : 13.676754117965698
 quant_err      : 13.676754117965698
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 19000
 MSRVTT_miech_test/t2v_metrics/R1: 21.3
 MSRVTT_miech_test/t2v_metrics/R5: 49.6
 MSRVTT_miech_test/t2v_metrics/R10: 63.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 6.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.473
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.63294825153511
 MSRVTT_miech_test/v2t_metrics/R1: 20.9
 MSRVTT_miech_test/v2t_metrics/R5: 51.6
 MSRVTT_miech_test/v2t_metrics/R10: 65.4
 MSRVTT_miech_test/v2t_metrics/R50: 88.7
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.343
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.31660029124938
 mnt_best       : 41.751207729175384
 not_improved_count: 3
Train Epoch: 39 [1/500 64/32000 (0%)] Loss: 0.39405 (QuantReg: 13.85004) QuantErr: 13.85004 batch_time=31.50765 
Train Epoch: 39 [9/500 576/32000 (2%)] Loss: 0.36366 (QuantReg: 13.65688) QuantErr: 13.65688 batch_time=2.60051 
Train Epoch: 39 [17/500 1088/32000 (3%)] Loss: 0.62486 (QuantReg: 13.54530) QuantErr: 13.54530 batch_time=0.47090 
Train Epoch: 39 [25/500 1600/32000 (5%)] Loss: 0.24394 (QuantReg: 13.30390) QuantErr: 13.30390 batch_time=0.43958 
Train Epoch: 39 [33/500 2112/32000 (7%)] Loss: 0.46564 (QuantReg: 13.71055) QuantErr: 13.71055 batch_time=0.45283 
Train Epoch: 39 [41/500 2624/32000 (8%)] Loss: 0.80338 (QuantReg: 13.53985) QuantErr: 13.53985 batch_time=0.50586 
Train Epoch: 39 [49/500 3136/32000 (10%)] Loss: 0.46482 (QuantReg: 13.92350) QuantErr: 13.92350 batch_time=0.49523 
Train Epoch: 39 [57/500 3648/32000 (11%)] Loss: 0.36519 (QuantReg: 13.56726) QuantErr: 13.56726 batch_time=0.45936 
Train Epoch: 39 [65/500 4160/32000 (13%)] Loss: 0.32302 (QuantReg: 14.08535) QuantErr: 14.08535 batch_time=1.82571 
Train Epoch: 39 [73/500 4672/32000 (15%)] Loss: 0.61130 (QuantReg: 13.51612) QuantErr: 13.51612 batch_time=2.11659 
Train Epoch: 39 [81/500 5184/32000 (16%)] Loss: 0.41569 (QuantReg: 13.40464) QuantErr: 13.40464 batch_time=0.43817 
Train Epoch: 39 [89/500 5696/32000 (18%)] Loss: 0.45101 (QuantReg: 13.67969) QuantErr: 13.67969 batch_time=0.42101 
Train Epoch: 39 [97/500 6208/32000 (19%)] Loss: 0.71872 (QuantReg: 13.28896) QuantErr: 13.28896 batch_time=0.43705 
Train Epoch: 39 [105/500 6720/32000 (21%)] Loss: 0.55353 (QuantReg: 13.72950) QuantErr: 13.72950 batch_time=0.44850 
Train Epoch: 39 [113/500 7232/32000 (23%)] Loss: 0.50673 (QuantReg: 13.89817) QuantErr: 13.89817 batch_time=0.60206 
Train Epoch: 39 [121/500 7744/32000 (24%)] Loss: 0.47139 (QuantReg: 13.81799) QuantErr: 13.81799 batch_time=0.41932 
Train Epoch: 39 [129/500 8256/32000 (26%)] Loss: 0.64944 (QuantReg: 13.46106) QuantErr: 13.46106 batch_time=1.89557 
Train Epoch: 39 [137/500 8768/32000 (27%)] Loss: 0.68750 (QuantReg: 13.40440) QuantErr: 13.40440 batch_time=2.03542 
Train Epoch: 39 [145/500 9280/32000 (29%)] Loss: 0.32087 (QuantReg: 13.63443) QuantErr: 13.63443 batch_time=0.49266 
Train Epoch: 39 [153/500 9792/32000 (31%)] Loss: 0.48611 (QuantReg: 13.78563) QuantErr: 13.78563 batch_time=0.53425 
Train Epoch: 39 [161/500 10304/32000 (32%)] Loss: 0.34048 (QuantReg: 13.37475) QuantErr: 13.37475 batch_time=0.41909 
Train Epoch: 39 [169/500 10816/32000 (34%)] Loss: 0.57879 (QuantReg: 13.50353) QuantErr: 13.50353 batch_time=0.43865 
Train Epoch: 39 [177/500 11328/32000 (35%)] Loss: 0.61787 (QuantReg: 13.36259) QuantErr: 13.36259 batch_time=0.43850 
Train Epoch: 39 [185/500 11840/32000 (37%)] Loss: 0.70438 (QuantReg: 13.28809) QuantErr: 13.28809 batch_time=0.47489 
Train Epoch: 39 [193/500 12352/32000 (39%)] Loss: 0.51395 (QuantReg: 13.86662) QuantErr: 13.86662 batch_time=1.86233 
Train Epoch: 39 [201/500 12864/32000 (40%)] Loss: 0.44394 (QuantReg: 13.51551) QuantErr: 13.51551 batch_time=2.10115 
Train Epoch: 39 [209/500 13376/32000 (42%)] Loss: 0.80420 (QuantReg: 14.00028) QuantErr: 14.00028 batch_time=0.42991 
Train Epoch: 39 [217/500 13888/32000 (43%)] Loss: 0.57250 (QuantReg: 13.66564) QuantErr: 13.66564 batch_time=0.42606 
Train Epoch: 39 [225/500 14400/32000 (45%)] Loss: 0.64411 (QuantReg: 14.30926) QuantErr: 14.30926 batch_time=0.43112 
Train Epoch: 39 [233/500 14912/32000 (47%)] Loss: 0.54172 (QuantReg: 13.70028) QuantErr: 13.70028 batch_time=0.40798 
Train Epoch: 39 [241/500 15424/32000 (48%)] Loss: 0.55516 (QuantReg: 13.36451) QuantErr: 13.36451 batch_time=0.41686 
Train Epoch: 39 [249/500 15936/32000 (50%)] Loss: 0.41257 (QuantReg: 13.49346) QuantErr: 13.49346 batch_time=0.41142 
Train Epoch: 39 [257/500 16448/32000 (51%)] Loss: 0.77053 (QuantReg: 13.60936) QuantErr: 13.60936 batch_time=1.80023 
Train Epoch: 39 [265/500 16960/32000 (53%)] Loss: 0.61316 (QuantReg: 13.33163) QuantErr: 13.33163 batch_time=2.14678 
Train Epoch: 39 [273/500 17472/32000 (55%)] Loss: 0.63454 (QuantReg: 13.56263) QuantErr: 13.56263 batch_time=0.44099 
Train Epoch: 39 [281/500 17984/32000 (56%)] Loss: 0.47873 (QuantReg: 13.62798) QuantErr: 13.62798 batch_time=0.53385 
Train Epoch: 39 [289/500 18496/32000 (58%)] Loss: 0.88306 (QuantReg: 13.04625) QuantErr: 13.04625 batch_time=0.48973 
Train Epoch: 39 [297/500 19008/32000 (59%)] Loss: 0.62163 (QuantReg: 13.44465) QuantErr: 13.44465 batch_time=0.48130 
Train Epoch: 39 [305/500 19520/32000 (61%)] Loss: 0.70902 (QuantReg: 13.26689) QuantErr: 13.26689 batch_time=0.49750 
Train Epoch: 39 [313/500 20032/32000 (63%)] Loss: 0.53473 (QuantReg: 13.52942) QuantErr: 13.52942 batch_time=0.52187 
Train Epoch: 39 [321/500 20544/32000 (64%)] Loss: 0.53619 (QuantReg: 13.76443) QuantErr: 13.76443 batch_time=1.66756 
Train Epoch: 39 [329/500 21056/32000 (66%)] Loss: 0.23556 (QuantReg: 13.44605) QuantErr: 13.44605 batch_time=2.08503 
Train Epoch: 39 [337/500 21568/32000 (67%)] Loss: 0.62994 (QuantReg: 13.71877) QuantErr: 13.71877 batch_time=0.45823 
Train Epoch: 39 [345/500 22080/32000 (69%)] Loss: 0.43431 (QuantReg: 13.93696) QuantErr: 13.93696 batch_time=0.44046 
Train Epoch: 39 [353/500 22592/32000 (71%)] Loss: 0.63301 (QuantReg: 13.29892) QuantErr: 13.29892 batch_time=0.45447 
Train Epoch: 39 [361/500 23104/32000 (72%)] Loss: 0.87637 (QuantReg: 13.50962) QuantErr: 13.50962 batch_time=0.52924 
Train Epoch: 39 [369/500 23616/32000 (74%)] Loss: 0.52626 (QuantReg: 13.84059) QuantErr: 13.84059 batch_time=0.45959 
Train Epoch: 39 [377/500 24128/32000 (75%)] Loss: 0.58143 (QuantReg: 13.73405) QuantErr: 13.73405 batch_time=0.42772 
Train Epoch: 39 [385/500 24640/32000 (77%)] Loss: 0.55255 (QuantReg: 13.97832) QuantErr: 13.97832 batch_time=1.65367 
Train Epoch: 39 [393/500 25152/32000 (79%)] Loss: 0.42583 (QuantReg: 13.58052) QuantErr: 13.58052 batch_time=2.16658 
Train Epoch: 39 [401/500 25664/32000 (80%)] Loss: 0.58007 (QuantReg: 13.64768) QuantErr: 13.64768 batch_time=0.49550 
Train Epoch: 39 [409/500 26176/32000 (82%)] Loss: 0.44223 (QuantReg: 14.02511) QuantErr: 14.02511 batch_time=0.43733 
Train Epoch: 39 [417/500 26688/32000 (83%)] Loss: 0.73302 (QuantReg: 13.87930) QuantErr: 13.87930 batch_time=0.44724 
Train Epoch: 39 [425/500 27200/32000 (85%)] Loss: 0.68573 (QuantReg: 13.73101) QuantErr: 13.73101 batch_time=0.51790 
Train Epoch: 39 [433/500 27712/32000 (87%)] Loss: 0.53476 (QuantReg: 13.98372) QuantErr: 13.98372 batch_time=0.42636 
Train Epoch: 39 [441/500 28224/32000 (88%)] Loss: 0.49296 (QuantReg: 13.38247) QuantErr: 13.38247 batch_time=0.42377 
Train Epoch: 39 [449/500 28736/32000 (90%)] Loss: 0.60040 (QuantReg: 13.73246) QuantErr: 13.73246 batch_time=1.99060 
Train Epoch: 39 [457/500 29248/32000 (91%)] Loss: 0.46308 (QuantReg: 14.12499) QuantErr: 14.12499 batch_time=2.07489 
Train Epoch: 39 [465/500 29760/32000 (93%)] Loss: 0.46773 (QuantReg: 13.82352) QuantErr: 13.82352 batch_time=0.44625 
Train Epoch: 39 [473/500 30272/32000 (95%)] Loss: 1.03876 (QuantReg: 13.56753) QuantErr: 13.56753 batch_time=0.45738 
Train Epoch: 39 [481/500 30784/32000 (96%)] Loss: 0.55042 (QuantReg: 13.56581) QuantErr: 13.56581 batch_time=0.46569 
Train Epoch: 39 [489/500 31296/32000 (98%)] Loss: 0.51808 (QuantReg: 13.92431) QuantErr: 13.92431 batch_time=0.49190 
Train Epoch: 39 [497/500 31808/32000 (99%)] Loss: 0.31593 (QuantReg: 14.26957) QuantErr: 14.26957 batch_time=0.43913 
Train Epoch: 39 codebook_update_time=2.34055
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch39.pth ...
Done in 5.944s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 0.5533300204873085
 quant_reg      : 13.692652673721314
 quant_err      : 13.692652673721314
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 19500
 MSRVTT_miech_test/t2v_metrics/R1: 22.4
 MSRVTT_miech_test/t2v_metrics/R5: 50.5
 MSRVTT_miech_test/t2v_metrics/R10: 63.7
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.96
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.61273648474521
 MSRVTT_miech_test/v2t_metrics/R1: 21.1
 MSRVTT_miech_test/v2t_metrics/R5: 51.4
 MSRVTT_miech_test/v2t_metrics/R10: 65.1
 MSRVTT_miech_test/v2t_metrics/R50: 88.6
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.081
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.33096267765474
 mnt_best       : 41.751207729175384
 not_improved_count: 4
Train Epoch: 40 [1/500 64/32000 (0%)] Loss: 0.40854 (QuantReg: 13.56889) QuantErr: 13.56889 batch_time=30.47267 
Train Epoch: 40 [9/500 576/32000 (2%)] Loss: 0.61886 (QuantReg: 13.67413) QuantErr: 13.67413 batch_time=1.18988 
Train Epoch: 40 [17/500 1088/32000 (3%)] Loss: 0.58561 (QuantReg: 13.73606) QuantErr: 13.73606 batch_time=0.52749 
Train Epoch: 40 [25/500 1600/32000 (5%)] Loss: 0.38841 (QuantReg: 13.52516) QuantErr: 13.52516 batch_time=0.43138 
Train Epoch: 40 [33/500 2112/32000 (7%)] Loss: 0.53142 (QuantReg: 13.94771) QuantErr: 13.94771 batch_time=0.46024 
Train Epoch: 40 [41/500 2624/32000 (8%)] Loss: 0.40577 (QuantReg: 14.01521) QuantErr: 14.01521 batch_time=0.50358 
Train Epoch: 40 [49/500 3136/32000 (10%)] Loss: 0.91702 (QuantReg: 13.74182) QuantErr: 13.74182 batch_time=0.50137 
Train Epoch: 40 [57/500 3648/32000 (11%)] Loss: 0.47073 (QuantReg: 13.69442) QuantErr: 13.69442 batch_time=0.47325 
Train Epoch: 40 [65/500 4160/32000 (13%)] Loss: 0.57706 (QuantReg: 13.75129) QuantErr: 13.75129 batch_time=0.90090 
Train Epoch: 40 [73/500 4672/32000 (15%)] Loss: 0.75109 (QuantReg: 13.34444) QuantErr: 13.34444 batch_time=1.11283 
Train Epoch: 40 [81/500 5184/32000 (16%)] Loss: 0.46397 (QuantReg: 13.74548) QuantErr: 13.74548 batch_time=0.40679 
Train Epoch: 40 [89/500 5696/32000 (18%)] Loss: 0.24063 (QuantReg: 13.66010) QuantErr: 13.66010 batch_time=0.43075 
Train Epoch: 40 [97/500 6208/32000 (19%)] Loss: 0.58141 (QuantReg: 13.55326) QuantErr: 13.55326 batch_time=0.49174 
Train Epoch: 40 [105/500 6720/32000 (21%)] Loss: 0.33446 (QuantReg: 13.92245) QuantErr: 13.92245 batch_time=0.44912 
Train Epoch: 40 [113/500 7232/32000 (23%)] Loss: 0.35425 (QuantReg: 14.07722) QuantErr: 14.07722 batch_time=0.46675 
Train Epoch: 40 [121/500 7744/32000 (24%)] Loss: 0.28260 (QuantReg: 13.66588) QuantErr: 13.66588 batch_time=0.47170 
Train Epoch: 40 [129/500 8256/32000 (26%)] Loss: 0.52370 (QuantReg: 13.88401) QuantErr: 13.88401 batch_time=0.76721 
Train Epoch: 40 [137/500 8768/32000 (27%)] Loss: 0.35820 (QuantReg: 14.14132) QuantErr: 14.14132 batch_time=1.05125 
Train Epoch: 40 [145/500 9280/32000 (29%)] Loss: 0.43725 (QuantReg: 13.82534) QuantErr: 13.82534 batch_time=0.46297 
Train Epoch: 40 [153/500 9792/32000 (31%)] Loss: 0.61881 (QuantReg: 13.77075) QuantErr: 13.77075 batch_time=0.47435 
Train Epoch: 40 [161/500 10304/32000 (32%)] Loss: 0.58515 (QuantReg: 13.76855) QuantErr: 13.76855 batch_time=0.41875 
Train Epoch: 40 [169/500 10816/32000 (34%)] Loss: 0.73602 (QuantReg: 13.77254) QuantErr: 13.77254 batch_time=0.43411 
Train Epoch: 40 [177/500 11328/32000 (35%)] Loss: 0.45123 (QuantReg: 14.10403) QuantErr: 14.10403 batch_time=0.43683 
Train Epoch: 40 [185/500 11840/32000 (37%)] Loss: 0.42939 (QuantReg: 13.95994) QuantErr: 13.95994 batch_time=0.46012 
Train Epoch: 40 [193/500 12352/32000 (39%)] Loss: 0.70929 (QuantReg: 13.53423) QuantErr: 13.53423 batch_time=0.80894 
Train Epoch: 40 [201/500 12864/32000 (40%)] Loss: 0.56016 (QuantReg: 13.67027) QuantErr: 13.67027 batch_time=1.01071 
Train Epoch: 40 [209/500 13376/32000 (42%)] Loss: 0.46180 (QuantReg: 13.74246) QuantErr: 13.74246 batch_time=0.52325 
Train Epoch: 40 [217/500 13888/32000 (43%)] Loss: 0.45885 (QuantReg: 13.87024) QuantErr: 13.87024 batch_time=0.49654 
Train Epoch: 40 [225/500 14400/32000 (45%)] Loss: 0.47527 (QuantReg: 14.11262) QuantErr: 14.11262 batch_time=0.52301 
Train Epoch: 40 [233/500 14912/32000 (47%)] Loss: 0.32848 (QuantReg: 13.52893) QuantErr: 13.52893 batch_time=0.46549 
Train Epoch: 40 [241/500 15424/32000 (48%)] Loss: 0.54327 (QuantReg: 13.35761) QuantErr: 13.35761 batch_time=0.42487 
Train Epoch: 40 [249/500 15936/32000 (50%)] Loss: 0.59269 (QuantReg: 13.77184) QuantErr: 13.77184 batch_time=0.50319 
Train Epoch: 40 [257/500 16448/32000 (51%)] Loss: 0.47870 (QuantReg: 13.86430) QuantErr: 13.86430 batch_time=0.84774 
Train Epoch: 40 [265/500 16960/32000 (53%)] Loss: 0.58306 (QuantReg: 13.40469) QuantErr: 13.40469 batch_time=1.14618 
Train Epoch: 40 [273/500 17472/32000 (55%)] Loss: 0.39679 (QuantReg: 13.87984) QuantErr: 13.87984 batch_time=0.45874 
Train Epoch: 40 [281/500 17984/32000 (56%)] Loss: 0.52622 (QuantReg: 13.71700) QuantErr: 13.71700 batch_time=0.47777 
Train Epoch: 40 [289/500 18496/32000 (58%)] Loss: 0.43543 (QuantReg: 13.50897) QuantErr: 13.50897 batch_time=0.52648 
Train Epoch: 40 [297/500 19008/32000 (59%)] Loss: 0.66444 (QuantReg: 13.55485) QuantErr: 13.55485 batch_time=0.45218 
Train Epoch: 40 [305/500 19520/32000 (61%)] Loss: 0.79802 (QuantReg: 13.36140) QuantErr: 13.36140 batch_time=0.44029 
Train Epoch: 40 [313/500 20032/32000 (63%)] Loss: 0.34339 (QuantReg: 13.64879) QuantErr: 13.64879 batch_time=0.42435 
Train Epoch: 40 [321/500 20544/32000 (64%)] Loss: 0.39985 (QuantReg: 14.16059) QuantErr: 14.16059 batch_time=0.88464 
Train Epoch: 40 [329/500 21056/32000 (66%)] Loss: 0.45818 (QuantReg: 14.00692) QuantErr: 14.00692 batch_time=0.95929 
Train Epoch: 40 [337/500 21568/32000 (67%)] Loss: 0.48318 (QuantReg: 13.64615) QuantErr: 13.64615 batch_time=0.45629 
Train Epoch: 40 [345/500 22080/32000 (69%)] Loss: 0.53447 (QuantReg: 13.55849) QuantErr: 13.55849 batch_time=0.53557 
Train Epoch: 40 [353/500 22592/32000 (71%)] Loss: 0.36352 (QuantReg: 14.07471) QuantErr: 14.07471 batch_time=0.49137 
Train Epoch: 40 [361/500 23104/32000 (72%)] Loss: 0.61761 (QuantReg: 14.28791) QuantErr: 14.28791 batch_time=0.45226 
Train Epoch: 40 [369/500 23616/32000 (74%)] Loss: 0.60331 (QuantReg: 13.96801) QuantErr: 13.96801 batch_time=0.47973 
Train Epoch: 40 [377/500 24128/32000 (75%)] Loss: 0.90093 (QuantReg: 13.41615) QuantErr: 13.41615 batch_time=0.45216 
Train Epoch: 40 [385/500 24640/32000 (77%)] Loss: 0.83140 (QuantReg: 13.47670) QuantErr: 13.47670 batch_time=0.44090 
Train Epoch: 40 [393/500 25152/32000 (79%)] Loss: 0.27260 (QuantReg: 13.82328) QuantErr: 13.82328 batch_time=0.44476 
Train Epoch: 40 [401/500 25664/32000 (80%)] Loss: 0.57783 (QuantReg: 13.43390) QuantErr: 13.43390 batch_time=0.47129 
Train Epoch: 40 [409/500 26176/32000 (82%)] Loss: 0.50527 (QuantReg: 13.53320) QuantErr: 13.53320 batch_time=0.46773 
Train Epoch: 40 [417/500 26688/32000 (83%)] Loss: 0.39948 (QuantReg: 13.83983) QuantErr: 13.83983 batch_time=0.51193 
Train Epoch: 40 [425/500 27200/32000 (85%)] Loss: 0.47922 (QuantReg: 13.46167) QuantErr: 13.46167 batch_time=0.46899 
Train Epoch: 40 [433/500 27712/32000 (87%)] Loss: 0.44200 (QuantReg: 13.92721) QuantErr: 13.92721 batch_time=0.49450 
Train Epoch: 40 [441/500 28224/32000 (88%)] Loss: 0.31094 (QuantReg: 14.07887) QuantErr: 14.07887 batch_time=0.47568 
Train Epoch: 40 [449/500 28736/32000 (90%)] Loss: 0.39766 (QuantReg: 14.14348) QuantErr: 14.14348 batch_time=0.40721 
Train Epoch: 40 [457/500 29248/32000 (91%)] Loss: 0.34718 (QuantReg: 13.95033) QuantErr: 13.95033 batch_time=0.39655 
Train Epoch: 40 [465/500 29760/32000 (93%)] Loss: 0.70349 (QuantReg: 14.14274) QuantErr: 14.14274 batch_time=0.51392 
Train Epoch: 40 [473/500 30272/32000 (95%)] Loss: 0.55282 (QuantReg: 13.71910) QuantErr: 13.71910 batch_time=0.51939 
Train Epoch: 40 [481/500 30784/32000 (96%)] Loss: 0.47434 (QuantReg: 13.85474) QuantErr: 13.85474 batch_time=0.52118 
Train Epoch: 40 [489/500 31296/32000 (98%)] Loss: 0.36813 (QuantReg: 13.95825) QuantErr: 13.95825 batch_time=0.48642 
Train Epoch: 40 [497/500 31808/32000 (99%)] Loss: 0.47797 (QuantReg: 13.58383) QuantErr: 13.58383 batch_time=0.50000 
Train Epoch: 40 codebook_update_time=2.43101
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch40.pth ...
Done in 24.676s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 0.5608577890396118
 quant_reg      : 13.718166625976563
 quant_err      : 13.718166625976563
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 20000
 MSRVTT_miech_test/t2v_metrics/R1: 21.9
 MSRVTT_miech_test/t2v_metrics/R5: 50.5
 MSRVTT_miech_test/t2v_metrics/R10: 63.8
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.644
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.32238603306577
 MSRVTT_miech_test/v2t_metrics/R1: 21.1
 MSRVTT_miech_test/v2t_metrics/R5: 50.0
 MSRVTT_miech_test/v2t_metrics/R10: 64.6
 MSRVTT_miech_test/v2t_metrics/R50: 88.9
 MSRVTT_miech_test/v2t_metrics/MedR: 5.5
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.033
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 40.84714050178408
 mnt_best       : 41.751207729175384
 not_improved_count: 5
Train Epoch: 41 [1/500 64/32000 (0%)] Loss: 0.51212 (QuantReg: 13.60125) QuantErr: 13.60125 batch_time=32.49844 
Train Epoch: 41 [9/500 576/32000 (2%)] Loss: 0.51505 (QuantReg: 13.80444) QuantErr: 13.80444 batch_time=1.26331 
Train Epoch: 41 [17/500 1088/32000 (3%)] Loss: 0.51920 (QuantReg: 13.96744) QuantErr: 13.96744 batch_time=0.43064 
Train Epoch: 41 [25/500 1600/32000 (5%)] Loss: 0.47645 (QuantReg: 13.59454) QuantErr: 13.59454 batch_time=0.49548 
Train Epoch: 41 [33/500 2112/32000 (7%)] Loss: 0.55415 (QuantReg: 14.17182) QuantErr: 14.17182 batch_time=0.42336 
Train Epoch: 41 [41/500 2624/32000 (8%)] Loss: 0.64806 (QuantReg: 13.67691) QuantErr: 13.67691 batch_time=0.40029 
Train Epoch: 41 [49/500 3136/32000 (10%)] Loss: 0.52546 (QuantReg: 13.66169) QuantErr: 13.66169 batch_time=0.45288 
Train Epoch: 41 [57/500 3648/32000 (11%)] Loss: 0.51785 (QuantReg: 13.37052) QuantErr: 13.37052 batch_time=0.42108 
Train Epoch: 41 [65/500 4160/32000 (13%)] Loss: 0.76674 (QuantReg: 13.42457) QuantErr: 13.42457 batch_time=1.07341 
Train Epoch: 41 [73/500 4672/32000 (15%)] Loss: 0.32676 (QuantReg: 13.94604) QuantErr: 13.94604 batch_time=1.04835 
Train Epoch: 41 [81/500 5184/32000 (16%)] Loss: 0.73435 (QuantReg: 14.18095) QuantErr: 14.18095 batch_time=0.47014 
Train Epoch: 41 [89/500 5696/32000 (18%)] Loss: 0.39231 (QuantReg: 14.26513) QuantErr: 14.26513 batch_time=0.48910 
Train Epoch: 41 [97/500 6208/32000 (19%)] Loss: 0.50016 (QuantReg: 13.80575) QuantErr: 13.80575 batch_time=0.48433 
Train Epoch: 41 [105/500 6720/32000 (21%)] Loss: 0.62001 (QuantReg: 13.84184) QuantErr: 13.84184 batch_time=0.41940 
Train Epoch: 41 [113/500 7232/32000 (23%)] Loss: 0.41245 (QuantReg: 13.34746) QuantErr: 13.34746 batch_time=0.48702 
Train Epoch: 41 [121/500 7744/32000 (24%)] Loss: 0.51839 (QuantReg: 13.97647) QuantErr: 13.97647 batch_time=0.46671 
Train Epoch: 41 [129/500 8256/32000 (26%)] Loss: 0.35591 (QuantReg: 13.82827) QuantErr: 13.82827 batch_time=1.15856 
Train Epoch: 41 [137/500 8768/32000 (27%)] Loss: 0.82746 (QuantReg: 13.83366) QuantErr: 13.83366 batch_time=1.15268 
Train Epoch: 41 [145/500 9280/32000 (29%)] Loss: 0.61510 (QuantReg: 13.58557) QuantErr: 13.58557 batch_time=0.41225 
Train Epoch: 41 [153/500 9792/32000 (31%)] Loss: 0.38864 (QuantReg: 13.95931) QuantErr: 13.95931 batch_time=0.41379 
Train Epoch: 41 [161/500 10304/32000 (32%)] Loss: 0.53950 (QuantReg: 13.68493) QuantErr: 13.68493 batch_time=0.44160 
Train Epoch: 41 [169/500 10816/32000 (34%)] Loss: 0.67040 (QuantReg: 13.53837) QuantErr: 13.53837 batch_time=0.40416 
Train Epoch: 41 [177/500 11328/32000 (35%)] Loss: 0.44716 (QuantReg: 13.59897) QuantErr: 13.59897 batch_time=0.48142 
Train Epoch: 41 [185/500 11840/32000 (37%)] Loss: 0.44841 (QuantReg: 13.76010) QuantErr: 13.76010 batch_time=0.48500 
Train Epoch: 41 [193/500 12352/32000 (39%)] Loss: 0.73299 (QuantReg: 14.04657) QuantErr: 14.04657 batch_time=1.15696 
Train Epoch: 41 [201/500 12864/32000 (40%)] Loss: 0.64982 (QuantReg: 13.82178) QuantErr: 13.82178 batch_time=1.19324 
Train Epoch: 41 [209/500 13376/32000 (42%)] Loss: 0.41490 (QuantReg: 14.04889) QuantErr: 14.04889 batch_time=0.51433 
Train Epoch: 41 [217/500 13888/32000 (43%)] Loss: 0.54479 (QuantReg: 14.09157) QuantErr: 14.09157 batch_time=0.41542 
Train Epoch: 41 [225/500 14400/32000 (45%)] Loss: 0.28437 (QuantReg: 13.61834) QuantErr: 13.61834 batch_time=0.46513 
Train Epoch: 41 [233/500 14912/32000 (47%)] Loss: 0.38541 (QuantReg: 13.69876) QuantErr: 13.69876 batch_time=0.43950 
Train Epoch: 41 [241/500 15424/32000 (48%)] Loss: 0.66756 (QuantReg: 13.50262) QuantErr: 13.50262 batch_time=0.46183 
Train Epoch: 41 [249/500 15936/32000 (50%)] Loss: 0.44150 (QuantReg: 13.81493) QuantErr: 13.81493 batch_time=0.47861 
Train Epoch: 41 [257/500 16448/32000 (51%)] Loss: 0.62425 (QuantReg: 13.46761) QuantErr: 13.46761 batch_time=1.09532 
Train Epoch: 41 [265/500 16960/32000 (53%)] Loss: 0.64398 (QuantReg: 13.54958) QuantErr: 13.54958 batch_time=1.18244 
Train Epoch: 41 [273/500 17472/32000 (55%)] Loss: 0.56238 (QuantReg: 13.94893) QuantErr: 13.94893 batch_time=0.44361 
Train Epoch: 41 [281/500 17984/32000 (56%)] Loss: 0.50537 (QuantReg: 13.11345) QuantErr: 13.11345 batch_time=0.47474 
Train Epoch: 41 [289/500 18496/32000 (58%)] Loss: 0.59399 (QuantReg: 13.95076) QuantErr: 13.95076 batch_time=0.49891 
Train Epoch: 41 [297/500 19008/32000 (59%)] Loss: 0.48547 (QuantReg: 13.83953) QuantErr: 13.83953 batch_time=0.42665 
Train Epoch: 41 [305/500 19520/32000 (61%)] Loss: 0.69483 (QuantReg: 13.65504) QuantErr: 13.65504 batch_time=0.45379 
Train Epoch: 41 [313/500 20032/32000 (63%)] Loss: 0.75360 (QuantReg: 13.50605) QuantErr: 13.50605 batch_time=0.51383 
Train Epoch: 41 [321/500 20544/32000 (64%)] Loss: 0.33968 (QuantReg: 13.76653) QuantErr: 13.76653 batch_time=1.11512 
Train Epoch: 41 [329/500 21056/32000 (66%)] Loss: 0.28104 (QuantReg: 14.17728) QuantErr: 14.17728 batch_time=1.16235 
Train Epoch: 41 [337/500 21568/32000 (67%)] Loss: 0.80307 (QuantReg: 13.77990) QuantErr: 13.77990 batch_time=0.44757 
Train Epoch: 41 [345/500 22080/32000 (69%)] Loss: 0.73171 (QuantReg: 13.43918) QuantErr: 13.43918 batch_time=0.48018 
Train Epoch: 41 [353/500 22592/32000 (71%)] Loss: 0.49383 (QuantReg: 14.04750) QuantErr: 14.04750 batch_time=0.41788 
Train Epoch: 41 [361/500 23104/32000 (72%)] Loss: 0.51136 (QuantReg: 13.55191) QuantErr: 13.55191 batch_time=0.45522 
Train Epoch: 41 [369/500 23616/32000 (74%)] Loss: 0.54318 (QuantReg: 13.66629) QuantErr: 13.66629 batch_time=0.48835 
Train Epoch: 41 [377/500 24128/32000 (75%)] Loss: 0.62169 (QuantReg: 13.57082) QuantErr: 13.57082 batch_time=0.45737 
Train Epoch: 41 [385/500 24640/32000 (77%)] Loss: 0.50561 (QuantReg: 13.28108) QuantErr: 13.28108 batch_time=1.09159 
Train Epoch: 41 [393/500 25152/32000 (79%)] Loss: 0.62016 (QuantReg: 13.90464) QuantErr: 13.90464 batch_time=1.12221 
Train Epoch: 41 [401/500 25664/32000 (80%)] Loss: 0.52140 (QuantReg: 13.68996) QuantErr: 13.68996 batch_time=0.42815 
Train Epoch: 41 [409/500 26176/32000 (82%)] Loss: 0.62692 (QuantReg: 13.88241) QuantErr: 13.88241 batch_time=0.45679 
Train Epoch: 41 [417/500 26688/32000 (83%)] Loss: 0.45479 (QuantReg: 13.52549) QuantErr: 13.52549 batch_time=0.47445 
Train Epoch: 41 [425/500 27200/32000 (85%)] Loss: 0.70182 (QuantReg: 13.87909) QuantErr: 13.87909 batch_time=0.50100 
Train Epoch: 41 [433/500 27712/32000 (87%)] Loss: 0.40923 (QuantReg: 13.82240) QuantErr: 13.82240 batch_time=0.43491 
Train Epoch: 41 [441/500 28224/32000 (88%)] Loss: 0.76323 (QuantReg: 13.67354) QuantErr: 13.67354 batch_time=0.46098 
Train Epoch: 41 [449/500 28736/32000 (90%)] Loss: 0.65776 (QuantReg: 14.13953) QuantErr: 14.13953 batch_time=1.14832 
Train Epoch: 41 [457/500 29248/32000 (91%)] Loss: 0.45871 (QuantReg: 13.88616) QuantErr: 13.88616 batch_time=1.18788 
Train Epoch: 41 [465/500 29760/32000 (93%)] Loss: 0.60251 (QuantReg: 13.77450) QuantErr: 13.77450 batch_time=0.41926 
Train Epoch: 41 [473/500 30272/32000 (95%)] Loss: 0.72368 (QuantReg: 13.56031) QuantErr: 13.56031 batch_time=0.43019 
Train Epoch: 41 [481/500 30784/32000 (96%)] Loss: 0.36540 (QuantReg: 13.86729) QuantErr: 13.86729 batch_time=0.44949 
Train Epoch: 41 [489/500 31296/32000 (98%)] Loss: 0.48513 (QuantReg: 13.52932) QuantErr: 13.52932 batch_time=0.43523 
Train Epoch: 41 [497/500 31808/32000 (99%)] Loss: 0.74459 (QuantReg: 13.65628) QuantErr: 13.65628 batch_time=0.44452 
Train Epoch: 41 codebook_update_time=2.13706
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch41.pth ...
Done in 6.458s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch41.pth ...
Done in 11.621s
removing stale ckpt [epoch 40] [took 0.01s]
 epoch          : 41
 loss           : 0.5632061537504196
 quant_reg      : 13.755587738037109
 quant_err      : 13.755587738037109
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 20500
 MSRVTT_miech_test/t2v_metrics/R1: 23.6
 MSRVTT_miech_test/t2v_metrics/R5: 50.7
 MSRVTT_miech_test/t2v_metrics/R10: 64.6
 MSRVTT_miech_test/t2v_metrics/R50: 86.6
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.261
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 42.597504758076916
 MSRVTT_miech_test/v2t_metrics/R1: 21.1
 MSRVTT_miech_test/v2t_metrics/R5: 51.6
 MSRVTT_miech_test/v2t_metrics/R10: 64.6
 MSRVTT_miech_test/v2t_metrics/R50: 89.0
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.997
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.27827673684767
 mnt_best       : 42.597504758076916
 not_improved_count: 0
Train Epoch: 42 [1/500 64/32000 (0%)] Loss: 0.81897 (QuantReg: 13.66500) QuantErr: 13.66500 batch_time=30.15992 
Train Epoch: 42 [9/500 576/32000 (2%)] Loss: 0.66537 (QuantReg: 13.75973) QuantErr: 13.75973 batch_time=0.43396 
Train Epoch: 42 [17/500 1088/32000 (3%)] Loss: 0.77788 (QuantReg: 13.36505) QuantErr: 13.36505 batch_time=0.49745 
Train Epoch: 42 [25/500 1600/32000 (5%)] Loss: 0.57645 (QuantReg: 13.92012) QuantErr: 13.92012 batch_time=0.44028 
Train Epoch: 42 [33/500 2112/32000 (7%)] Loss: 0.62848 (QuantReg: 13.74028) QuantErr: 13.74028 batch_time=0.50278 
Train Epoch: 42 [41/500 2624/32000 (8%)] Loss: 0.51767 (QuantReg: 13.24117) QuantErr: 13.24117 batch_time=0.45728 
Train Epoch: 42 [49/500 3136/32000 (10%)] Loss: 0.58978 (QuantReg: 13.53346) QuantErr: 13.53346 batch_time=0.54441 
Train Epoch: 42 [57/500 3648/32000 (11%)] Loss: 0.29648 (QuantReg: 14.10100) QuantErr: 14.10100 batch_time=0.48156 
Train Epoch: 42 [65/500 4160/32000 (13%)] Loss: 0.69654 (QuantReg: 13.60954) QuantErr: 13.60954 batch_time=0.41506 
Train Epoch: 42 [73/500 4672/32000 (15%)] Loss: 0.28884 (QuantReg: 13.79518) QuantErr: 13.79518 batch_time=0.40652 
Train Epoch: 42 [81/500 5184/32000 (16%)] Loss: 0.50573 (QuantReg: 13.74280) QuantErr: 13.74280 batch_time=0.43162 
Train Epoch: 42 [89/500 5696/32000 (18%)] Loss: 0.53422 (QuantReg: 13.54304) QuantErr: 13.54304 batch_time=0.41262 
Train Epoch: 42 [97/500 6208/32000 (19%)] Loss: 0.51093 (QuantReg: 13.71294) QuantErr: 13.71294 batch_time=0.43514 
Train Epoch: 42 [105/500 6720/32000 (21%)] Loss: 0.68103 (QuantReg: 13.42291) QuantErr: 13.42291 batch_time=0.41405 
Train Epoch: 42 [113/500 7232/32000 (23%)] Loss: 0.84723 (QuantReg: 13.97469) QuantErr: 13.97469 batch_time=0.45457 
Train Epoch: 42 [121/500 7744/32000 (24%)] Loss: 0.54754 (QuantReg: 13.47023) QuantErr: 13.47023 batch_time=0.43182 
Train Epoch: 42 [129/500 8256/32000 (26%)] Loss: 0.52306 (QuantReg: 13.91280) QuantErr: 13.91280 batch_time=0.44080 
Train Epoch: 42 [137/500 8768/32000 (27%)] Loss: 0.46249 (QuantReg: 13.50137) QuantErr: 13.50137 batch_time=0.41014 
Train Epoch: 42 [145/500 9280/32000 (29%)] Loss: 0.47500 (QuantReg: 13.63442) QuantErr: 13.63442 batch_time=0.47476 
Train Epoch: 42 [153/500 9792/32000 (31%)] Loss: 0.54013 (QuantReg: 13.79824) QuantErr: 13.79824 batch_time=0.42630 
Train Epoch: 42 [161/500 10304/32000 (32%)] Loss: 0.52990 (QuantReg: 13.87369) QuantErr: 13.87369 batch_time=0.47490 
Train Epoch: 42 [169/500 10816/32000 (34%)] Loss: 0.44387 (QuantReg: 14.05431) QuantErr: 14.05431 batch_time=0.52998 
Train Epoch: 42 [177/500 11328/32000 (35%)] Loss: 0.52892 (QuantReg: 14.10458) QuantErr: 14.10458 batch_time=0.51977 
Train Epoch: 42 [185/500 11840/32000 (37%)] Loss: 0.53334 (QuantReg: 13.66870) QuantErr: 13.66870 batch_time=0.52720 
Train Epoch: 42 [193/500 12352/32000 (39%)] Loss: 0.72077 (QuantReg: 13.97538) QuantErr: 13.97538 batch_time=0.48845 
Train Epoch: 42 [201/500 12864/32000 (40%)] Loss: 0.76541 (QuantReg: 14.02897) QuantErr: 14.02897 batch_time=0.43531 
Train Epoch: 42 [209/500 13376/32000 (42%)] Loss: 0.80534 (QuantReg: 13.64871) QuantErr: 13.64871 batch_time=0.42609 
Train Epoch: 42 [217/500 13888/32000 (43%)] Loss: 0.70048 (QuantReg: 13.81557) QuantErr: 13.81557 batch_time=0.49781 
Train Epoch: 42 [225/500 14400/32000 (45%)] Loss: 0.38346 (QuantReg: 13.68796) QuantErr: 13.68796 batch_time=0.45118 
Train Epoch: 42 [233/500 14912/32000 (47%)] Loss: 0.62775 (QuantReg: 13.78960) QuantErr: 13.78960 batch_time=0.42680 
Train Epoch: 42 [241/500 15424/32000 (48%)] Loss: 0.63286 (QuantReg: 13.71106) QuantErr: 13.71106 batch_time=0.45026 
Train Epoch: 42 [249/500 15936/32000 (50%)] Loss: 0.39769 (QuantReg: 13.64466) QuantErr: 13.64466 batch_time=0.49460 
Train Epoch: 42 [257/500 16448/32000 (51%)] Loss: 0.77575 (QuantReg: 13.92361) QuantErr: 13.92361 batch_time=0.49575 
Train Epoch: 42 [265/500 16960/32000 (53%)] Loss: 0.48763 (QuantReg: 13.67602) QuantErr: 13.67602 batch_time=0.41550 
Train Epoch: 42 [273/500 17472/32000 (55%)] Loss: 0.55185 (QuantReg: 13.64085) QuantErr: 13.64085 batch_time=0.51360 
Train Epoch: 42 [281/500 17984/32000 (56%)] Loss: 0.49597 (QuantReg: 14.00539) QuantErr: 14.00539 batch_time=0.44122 
Train Epoch: 42 [289/500 18496/32000 (58%)] Loss: 0.60382 (QuantReg: 13.80906) QuantErr: 13.80906 batch_time=0.43845 
Train Epoch: 42 [297/500 19008/32000 (59%)] Loss: 0.56616 (QuantReg: 13.72635) QuantErr: 13.72635 batch_time=0.41301 
Train Epoch: 42 [305/500 19520/32000 (61%)] Loss: 0.64517 (QuantReg: 13.81282) QuantErr: 13.81282 batch_time=0.43032 
Train Epoch: 42 [313/500 20032/32000 (63%)] Loss: 0.49200 (QuantReg: 13.87573) QuantErr: 13.87573 batch_time=0.41871 
Train Epoch: 42 [321/500 20544/32000 (64%)] Loss: 0.36983 (QuantReg: 13.47174) QuantErr: 13.47174 batch_time=0.43708 
Train Epoch: 42 [329/500 21056/32000 (66%)] Loss: 0.41223 (QuantReg: 13.96373) QuantErr: 13.96373 batch_time=0.50040 
Train Epoch: 42 [337/500 21568/32000 (67%)] Loss: 0.56492 (QuantReg: 13.04860) QuantErr: 13.04860 batch_time=0.51557 
Train Epoch: 42 [345/500 22080/32000 (69%)] Loss: 0.55391 (QuantReg: 13.79761) QuantErr: 13.79761 batch_time=0.40572 
Train Epoch: 42 [353/500 22592/32000 (71%)] Loss: 0.48876 (QuantReg: 14.19112) QuantErr: 14.19112 batch_time=0.43594 
Train Epoch: 42 [361/500 23104/32000 (72%)] Loss: 0.78818 (QuantReg: 13.39699) QuantErr: 13.39699 batch_time=0.42233 
Train Epoch: 42 [369/500 23616/32000 (74%)] Loss: 0.64405 (QuantReg: 13.84305) QuantErr: 13.84305 batch_time=0.44380 
Train Epoch: 42 [377/500 24128/32000 (75%)] Loss: 0.28136 (QuantReg: 13.83949) QuantErr: 13.83949 batch_time=0.43246 
Train Epoch: 42 [385/500 24640/32000 (77%)] Loss: 0.42890 (QuantReg: 13.77094) QuantErr: 13.77094 batch_time=0.49201 
Train Epoch: 42 [393/500 25152/32000 (79%)] Loss: 0.55084 (QuantReg: 13.64273) QuantErr: 13.64273 batch_time=0.48837 
Train Epoch: 42 [401/500 25664/32000 (80%)] Loss: 0.77109 (QuantReg: 13.57952) QuantErr: 13.57952 batch_time=0.45815 
Train Epoch: 42 [409/500 26176/32000 (82%)] Loss: 0.54770 (QuantReg: 13.65190) QuantErr: 13.65190 batch_time=0.42525 
Train Epoch: 42 [417/500 26688/32000 (83%)] Loss: 0.57075 (QuantReg: 13.49973) QuantErr: 13.49973 batch_time=0.47049 
Train Epoch: 42 [425/500 27200/32000 (85%)] Loss: 0.33962 (QuantReg: 13.97203) QuantErr: 13.97203 batch_time=0.50455 
Train Epoch: 42 [433/500 27712/32000 (87%)] Loss: 0.45253 (QuantReg: 14.17420) QuantErr: 14.17420 batch_time=0.49180 
Train Epoch: 42 [441/500 28224/32000 (88%)] Loss: 0.45804 (QuantReg: 13.47828) QuantErr: 13.47828 batch_time=0.50517 
Train Epoch: 42 [449/500 28736/32000 (90%)] Loss: 0.94094 (QuantReg: 13.62407) QuantErr: 13.62407 batch_time=0.47560 
Train Epoch: 42 [457/500 29248/32000 (91%)] Loss: 0.52543 (QuantReg: 13.74389) QuantErr: 13.74389 batch_time=0.41452 
Train Epoch: 42 [465/500 29760/32000 (93%)] Loss: 0.34763 (QuantReg: 14.26471) QuantErr: 14.26471 batch_time=0.44266 
Train Epoch: 42 [473/500 30272/32000 (95%)] Loss: 0.73138 (QuantReg: 13.95888) QuantErr: 13.95888 batch_time=0.45747 
Train Epoch: 42 [481/500 30784/32000 (96%)] Loss: 0.79964 (QuantReg: 13.70460) QuantErr: 13.70460 batch_time=0.46081 
Train Epoch: 42 [489/500 31296/32000 (98%)] Loss: 0.46560 (QuantReg: 14.01228) QuantErr: 14.01228 batch_time=0.42116 
Train Epoch: 42 [497/500 31808/32000 (99%)] Loss: 0.67237 (QuantReg: 13.64480) QuantErr: 13.64480 batch_time=0.49613 
Train Epoch: 42 codebook_update_time=2.44199
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch42.pth ...
Done in 5.152s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 0.5756373047232628
 quant_reg      : 13.73302275276184
 quant_err      : 13.73302275276184
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 21000
 MSRVTT_miech_test/t2v_metrics/R1: 22.0
 MSRVTT_miech_test/t2v_metrics/R5: 50.2
 MSRVTT_miech_test/t2v_metrics/R10: 62.8
 MSRVTT_miech_test/t2v_metrics/R50: 87.2
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.826
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.08614052694901
 MSRVTT_miech_test/v2t_metrics/R1: 21.5
 MSRVTT_miech_test/v2t_metrics/R5: 52.3
 MSRVTT_miech_test/v2t_metrics/R10: 64.2
 MSRVTT_miech_test/v2t_metrics/R50: 88.5
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.98
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.638178784790796
 mnt_best       : 42.597504758076916
 not_improved_count: 1
Train Epoch: 43 [1/500 64/32000 (0%)] Loss: 0.38834 (QuantReg: 14.04369) QuantErr: 14.04369 batch_time=33.24378 
Train Epoch: 43 [9/500 576/32000 (2%)] Loss: 0.60870 (QuantReg: 13.81805) QuantErr: 13.81805 batch_time=0.47488 
Train Epoch: 43 [17/500 1088/32000 (3%)] Loss: 0.66688 (QuantReg: 13.65445) QuantErr: 13.65445 batch_time=0.44796 
Train Epoch: 43 [25/500 1600/32000 (5%)] Loss: 0.67443 (QuantReg: 13.38150) QuantErr: 13.38150 batch_time=0.44809 
Train Epoch: 43 [33/500 2112/32000 (7%)] Loss: 0.49745 (QuantReg: 13.99335) QuantErr: 13.99335 batch_time=0.45159 
Train Epoch: 43 [41/500 2624/32000 (8%)] Loss: 0.79942 (QuantReg: 13.51781) QuantErr: 13.51781 batch_time=0.46187 
Train Epoch: 43 [49/500 3136/32000 (10%)] Loss: 0.62816 (QuantReg: 13.94176) QuantErr: 13.94176 batch_time=0.45068 
Train Epoch: 43 [57/500 3648/32000 (11%)] Loss: 0.76821 (QuantReg: 13.67089) QuantErr: 13.67089 batch_time=0.48482 
Train Epoch: 43 [65/500 4160/32000 (13%)] Loss: 0.45971 (QuantReg: 13.57539) QuantErr: 13.57539 batch_time=1.71617 
Train Epoch: 43 [73/500 4672/32000 (15%)] Loss: 0.52872 (QuantReg: 13.64083) QuantErr: 13.64083 batch_time=0.46759 
Train Epoch: 43 [81/500 5184/32000 (16%)] Loss: 0.79561 (QuantReg: 13.31550) QuantErr: 13.31550 batch_time=0.41545 
Train Epoch: 43 [89/500 5696/32000 (18%)] Loss: 0.54151 (QuantReg: 13.61966) QuantErr: 13.61966 batch_time=0.42981 
Train Epoch: 43 [97/500 6208/32000 (19%)] Loss: 0.73303 (QuantReg: 13.49523) QuantErr: 13.49523 batch_time=0.54067 
Train Epoch: 43 [105/500 6720/32000 (21%)] Loss: 0.32664 (QuantReg: 13.91778) QuantErr: 13.91778 batch_time=0.49094 
Train Epoch: 43 [113/500 7232/32000 (23%)] Loss: 0.53317 (QuantReg: 13.66241) QuantErr: 13.66241 batch_time=0.45891 
Train Epoch: 43 [121/500 7744/32000 (24%)] Loss: 0.69399 (QuantReg: 13.88649) QuantErr: 13.88649 batch_time=0.49081 
Train Epoch: 43 [129/500 8256/32000 (26%)] Loss: 0.51205 (QuantReg: 13.79641) QuantErr: 13.79641 batch_time=1.90269 
Train Epoch: 43 [137/500 8768/32000 (27%)] Loss: 0.49128 (QuantReg: 13.66473) QuantErr: 13.66473 batch_time=0.42153 
Train Epoch: 43 [145/500 9280/32000 (29%)] Loss: 0.59668 (QuantReg: 13.85394) QuantErr: 13.85394 batch_time=0.47127 
Train Epoch: 43 [153/500 9792/32000 (31%)] Loss: 0.41884 (QuantReg: 13.43418) QuantErr: 13.43418 batch_time=0.45123 
Train Epoch: 43 [161/500 10304/32000 (32%)] Loss: 0.66507 (QuantReg: 13.53061) QuantErr: 13.53061 batch_time=0.47900 
Train Epoch: 43 [169/500 10816/32000 (34%)] Loss: 0.46146 (QuantReg: 13.51198) QuantErr: 13.51198 batch_time=0.58875 
Train Epoch: 43 [177/500 11328/32000 (35%)] Loss: 0.49228 (QuantReg: 13.53912) QuantErr: 13.53912 batch_time=0.45182 
Train Epoch: 43 [185/500 11840/32000 (37%)] Loss: 0.37030 (QuantReg: 13.35157) QuantErr: 13.35157 batch_time=0.46567 
Train Epoch: 43 [193/500 12352/32000 (39%)] Loss: 0.40293 (QuantReg: 14.13427) QuantErr: 14.13427 batch_time=1.81047 
Train Epoch: 43 [201/500 12864/32000 (40%)] Loss: 0.84031 (QuantReg: 13.89709) QuantErr: 13.89709 batch_time=0.46988 
Train Epoch: 43 [209/500 13376/32000 (42%)] Loss: 0.48886 (QuantReg: 13.82650) QuantErr: 13.82650 batch_time=0.45251 
Train Epoch: 43 [217/500 13888/32000 (43%)] Loss: 0.48562 (QuantReg: 13.92487) QuantErr: 13.92487 batch_time=0.46038 
Train Epoch: 43 [225/500 14400/32000 (45%)] Loss: 0.61123 (QuantReg: 14.18413) QuantErr: 14.18413 batch_time=0.49828 
Train Epoch: 43 [233/500 14912/32000 (47%)] Loss: 0.61001 (QuantReg: 13.60985) QuantErr: 13.60985 batch_time=0.47341 
Train Epoch: 43 [241/500 15424/32000 (48%)] Loss: 0.43310 (QuantReg: 13.90648) QuantErr: 13.90648 batch_time=0.52548 
Train Epoch: 43 [249/500 15936/32000 (50%)] Loss: 0.91839 (QuantReg: 12.80532) QuantErr: 12.80532 batch_time=0.59977 
Train Epoch: 43 [257/500 16448/32000 (51%)] Loss: 0.24931 (QuantReg: 13.78445) QuantErr: 13.78445 batch_time=1.84642 
Train Epoch: 43 [265/500 16960/32000 (53%)] Loss: 0.67088 (QuantReg: 13.66677) QuantErr: 13.66677 batch_time=0.43250 
Train Epoch: 43 [273/500 17472/32000 (55%)] Loss: 0.58190 (QuantReg: 13.58957) QuantErr: 13.58957 batch_time=0.40702 
Train Epoch: 43 [281/500 17984/32000 (56%)] Loss: 0.50153 (QuantReg: 13.90553) QuantErr: 13.90553 batch_time=0.48667 
Train Epoch: 43 [289/500 18496/32000 (58%)] Loss: 0.66832 (QuantReg: 13.48641) QuantErr: 13.48641 batch_time=0.41724 
Train Epoch: 43 [297/500 19008/32000 (59%)] Loss: 0.48837 (QuantReg: 13.97407) QuantErr: 13.97407 batch_time=0.53822 
Train Epoch: 43 [305/500 19520/32000 (61%)] Loss: 0.50489 (QuantReg: 13.52276) QuantErr: 13.52276 batch_time=0.49868 
Train Epoch: 43 [313/500 20032/32000 (63%)] Loss: 0.67226 (QuantReg: 13.70250) QuantErr: 13.70250 batch_time=0.45627 
Train Epoch: 43 [321/500 20544/32000 (64%)] Loss: 0.70644 (QuantReg: 13.47610) QuantErr: 13.47610 batch_time=1.79547 
Train Epoch: 43 [329/500 21056/32000 (66%)] Loss: 0.92981 (QuantReg: 13.78351) QuantErr: 13.78351 batch_time=0.42732 
Train Epoch: 43 [337/500 21568/32000 (67%)] Loss: 0.65709 (QuantReg: 13.61731) QuantErr: 13.61731 batch_time=0.46291 
Train Epoch: 43 [345/500 22080/32000 (69%)] Loss: 0.76013 (QuantReg: 13.77842) QuantErr: 13.77842 batch_time=0.42942 
Train Epoch: 43 [353/500 22592/32000 (71%)] Loss: 0.37665 (QuantReg: 14.00058) QuantErr: 14.00058 batch_time=0.40447 
Train Epoch: 43 [361/500 23104/32000 (72%)] Loss: 0.65023 (QuantReg: 13.46086) QuantErr: 13.46086 batch_time=0.43482 
Train Epoch: 43 [369/500 23616/32000 (74%)] Loss: 0.38199 (QuantReg: 13.75831) QuantErr: 13.75831 batch_time=0.42718 
Train Epoch: 43 [377/500 24128/32000 (75%)] Loss: 0.49440 (QuantReg: 13.83297) QuantErr: 13.83297 batch_time=0.41534 
Train Epoch: 43 [385/500 24640/32000 (77%)] Loss: 0.76075 (QuantReg: 13.73098) QuantErr: 13.73098 batch_time=1.90374 
Train Epoch: 43 [393/500 25152/32000 (79%)] Loss: 0.62679 (QuantReg: 14.14997) QuantErr: 14.14997 batch_time=0.48049 
Train Epoch: 43 [401/500 25664/32000 (80%)] Loss: 0.44905 (QuantReg: 14.08444) QuantErr: 14.08444 batch_time=0.47421 
Train Epoch: 43 [409/500 26176/32000 (82%)] Loss: 0.56428 (QuantReg: 14.25332) QuantErr: 14.25332 batch_time=0.51303 
Train Epoch: 43 [417/500 26688/32000 (83%)] Loss: 0.45891 (QuantReg: 13.87276) QuantErr: 13.87276 batch_time=0.48311 
Train Epoch: 43 [425/500 27200/32000 (85%)] Loss: 0.51468 (QuantReg: 13.79474) QuantErr: 13.79474 batch_time=0.54310 
Train Epoch: 43 [433/500 27712/32000 (87%)] Loss: 0.68180 (QuantReg: 13.77022) QuantErr: 13.77022 batch_time=0.48196 
Train Epoch: 43 [441/500 28224/32000 (88%)] Loss: 0.81799 (QuantReg: 13.31192) QuantErr: 13.31192 batch_time=0.57610 
Train Epoch: 43 [449/500 28736/32000 (90%)] Loss: 0.87767 (QuantReg: 13.49934) QuantErr: 13.49934 batch_time=1.86943 
Train Epoch: 43 [457/500 29248/32000 (91%)] Loss: 0.61720 (QuantReg: 13.38215) QuantErr: 13.38215 batch_time=0.49443 
Train Epoch: 43 [465/500 29760/32000 (93%)] Loss: 0.71218 (QuantReg: 13.67086) QuantErr: 13.67086 batch_time=0.44244 
Train Epoch: 43 [473/500 30272/32000 (95%)] Loss: 0.46261 (QuantReg: 13.74452) QuantErr: 13.74452 batch_time=0.44165 
Train Epoch: 43 [481/500 30784/32000 (96%)] Loss: 0.75174 (QuantReg: 13.52997) QuantErr: 13.52997 batch_time=0.41326 
Train Epoch: 43 [489/500 31296/32000 (98%)] Loss: 0.50656 (QuantReg: 14.27207) QuantErr: 14.27207 batch_time=0.48902 
Train Epoch: 43 [497/500 31808/32000 (99%)] Loss: 0.74008 (QuantReg: 13.62073) QuantErr: 13.62073 batch_time=0.46594 
Train Epoch: 43 codebook_update_time=2.22680
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch43.pth ...
Done in 5.815s
removing stale ckpt [epoch 42] [took 0.16s]
 epoch          : 43
 loss           : 0.5616635988652706
 quant_reg      : 13.756662649154663
 quant_err      : 13.756662649154663
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 21500
 MSRVTT_miech_test/t2v_metrics/R1: 21.6
 MSRVTT_miech_test/t2v_metrics/R5: 50.2
 MSRVTT_miech_test/t2v_metrics/R10: 63.5
 MSRVTT_miech_test/t2v_metrics/R50: 87.0
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 33.224
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.98677344526642
 MSRVTT_miech_test/v2t_metrics/R1: 21.4
 MSRVTT_miech_test/v2t_metrics/R5: 51.6
 MSRVTT_miech_test/v2t_metrics/R10: 64.2
 MSRVTT_miech_test/v2t_metrics/R50: 88.6
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.498
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.38721162106002
 mnt_best       : 42.597504758076916
 not_improved_count: 2
Train Epoch: 44 [1/500 64/32000 (0%)] Loss: 0.56287 (QuantReg: 14.06627) QuantErr: 14.06627 batch_time=31.93392 
Train Epoch: 44 [9/500 576/32000 (2%)] Loss: 0.32334 (QuantReg: 13.87524) QuantErr: 13.87524 batch_time=0.43897 
Train Epoch: 44 [17/500 1088/32000 (3%)] Loss: 0.52326 (QuantReg: 13.71174) QuantErr: 13.71174 batch_time=1.01501 
Train Epoch: 44 [25/500 1600/32000 (5%)] Loss: 0.30432 (QuantReg: 13.64729) QuantErr: 13.64729 batch_time=0.42066 
Train Epoch: 44 [33/500 2112/32000 (7%)] Loss: 0.44046 (QuantReg: 14.11037) QuantErr: 14.11037 batch_time=0.41757 
Train Epoch: 44 [41/500 2624/32000 (8%)] Loss: 0.44711 (QuantReg: 13.38806) QuantErr: 13.38806 batch_time=0.46041 
Train Epoch: 44 [49/500 3136/32000 (10%)] Loss: 0.59110 (QuantReg: 13.67918) QuantErr: 13.67918 batch_time=0.50674 
Train Epoch: 44 [57/500 3648/32000 (11%)] Loss: 0.43936 (QuantReg: 14.06574) QuantErr: 14.06574 batch_time=0.44289 
Train Epoch: 44 [65/500 4160/32000 (13%)] Loss: 0.46432 (QuantReg: 13.93047) QuantErr: 13.93047 batch_time=1.36776 
Train Epoch: 44 [73/500 4672/32000 (15%)] Loss: 0.54746 (QuantReg: 13.78203) QuantErr: 13.78203 batch_time=0.48183 
Train Epoch: 44 [81/500 5184/32000 (16%)] Loss: 0.69901 (QuantReg: 13.31880) QuantErr: 13.31880 batch_time=0.95384 
Train Epoch: 44 [89/500 5696/32000 (18%)] Loss: 0.52100 (QuantReg: 13.73309) QuantErr: 13.73309 batch_time=0.46055 
Train Epoch: 44 [97/500 6208/32000 (19%)] Loss: 0.42043 (QuantReg: 13.80899) QuantErr: 13.80899 batch_time=0.49920 
Train Epoch: 44 [105/500 6720/32000 (21%)] Loss: 0.51089 (QuantReg: 14.14901) QuantErr: 14.14901 batch_time=0.49896 
Train Epoch: 44 [113/500 7232/32000 (23%)] Loss: 0.54319 (QuantReg: 13.74793) QuantErr: 13.74793 batch_time=0.47927 
Train Epoch: 44 [121/500 7744/32000 (24%)] Loss: 0.43213 (QuantReg: 13.77054) QuantErr: 13.77054 batch_time=0.46675 
Train Epoch: 44 [129/500 8256/32000 (26%)] Loss: 0.67943 (QuantReg: 13.47201) QuantErr: 13.47201 batch_time=1.40671 
Train Epoch: 44 [137/500 8768/32000 (27%)] Loss: 0.67937 (QuantReg: 13.46440) QuantErr: 13.46440 batch_time=0.51024 
Train Epoch: 44 [145/500 9280/32000 (29%)] Loss: 0.95305 (QuantReg: 13.85156) QuantErr: 13.85156 batch_time=0.90605 
Train Epoch: 44 [153/500 9792/32000 (31%)] Loss: 0.67242 (QuantReg: 13.67585) QuantErr: 13.67585 batch_time=0.45444 
Train Epoch: 44 [161/500 10304/32000 (32%)] Loss: 0.48270 (QuantReg: 14.17856) QuantErr: 14.17856 batch_time=0.40209 
Train Epoch: 44 [169/500 10816/32000 (34%)] Loss: 0.63642 (QuantReg: 14.07627) QuantErr: 14.07627 batch_time=0.42228 
Train Epoch: 44 [177/500 11328/32000 (35%)] Loss: 0.50120 (QuantReg: 13.67076) QuantErr: 13.67076 batch_time=0.41302 
Train Epoch: 44 [185/500 11840/32000 (37%)] Loss: 0.62912 (QuantReg: 13.28029) QuantErr: 13.28029 batch_time=0.43318 
Train Epoch: 44 [193/500 12352/32000 (39%)] Loss: 0.50169 (QuantReg: 13.51888) QuantErr: 13.51888 batch_time=1.26659 
Train Epoch: 44 [201/500 12864/32000 (40%)] Loss: 0.55232 (QuantReg: 13.79592) QuantErr: 13.79592 batch_time=0.43605 
Train Epoch: 44 [209/500 13376/32000 (42%)] Loss: 0.67949 (QuantReg: 13.77953) QuantErr: 13.77953 batch_time=0.86502 
Train Epoch: 44 [217/500 13888/32000 (43%)] Loss: 0.91901 (QuantReg: 13.63431) QuantErr: 13.63431 batch_time=0.45421 
Train Epoch: 44 [225/500 14400/32000 (45%)] Loss: 0.51327 (QuantReg: 13.68525) QuantErr: 13.68525 batch_time=0.43140 
Train Epoch: 44 [233/500 14912/32000 (47%)] Loss: 0.49542 (QuantReg: 13.76442) QuantErr: 13.76442 batch_time=0.41158 
Train Epoch: 44 [241/500 15424/32000 (48%)] Loss: 0.85001 (QuantReg: 13.81924) QuantErr: 13.81924 batch_time=0.40868 
Train Epoch: 44 [249/500 15936/32000 (50%)] Loss: 0.57308 (QuantReg: 13.80020) QuantErr: 13.80020 batch_time=0.43558 
Train Epoch: 44 [257/500 16448/32000 (51%)] Loss: 0.53243 (QuantReg: 13.73833) QuantErr: 13.73833 batch_time=1.34106 
Train Epoch: 44 [265/500 16960/32000 (53%)] Loss: 0.58518 (QuantReg: 13.79540) QuantErr: 13.79540 batch_time=0.45677 
Train Epoch: 44 [273/500 17472/32000 (55%)] Loss: 0.51466 (QuantReg: 13.52717) QuantErr: 13.52717 batch_time=0.89289 
Train Epoch: 44 [281/500 17984/32000 (56%)] Loss: 0.37557 (QuantReg: 13.67655) QuantErr: 13.67655 batch_time=0.48224 
Train Epoch: 44 [289/500 18496/32000 (58%)] Loss: 0.42171 (QuantReg: 13.91213) QuantErr: 13.91213 batch_time=0.44636 
Train Epoch: 44 [297/500 19008/32000 (59%)] Loss: 0.59433 (QuantReg: 13.73521) QuantErr: 13.73521 batch_time=0.43896 
Train Epoch: 44 [305/500 19520/32000 (61%)] Loss: 0.36341 (QuantReg: 13.83804) QuantErr: 13.83804 batch_time=0.44018 
Train Epoch: 44 [313/500 20032/32000 (63%)] Loss: 0.56852 (QuantReg: 13.96774) QuantErr: 13.96774 batch_time=0.44202 
Train Epoch: 44 [321/500 20544/32000 (64%)] Loss: 0.38818 (QuantReg: 13.99789) QuantErr: 13.99789 batch_time=1.23541 
Train Epoch: 44 [329/500 21056/32000 (66%)] Loss: 0.57172 (QuantReg: 13.60943) QuantErr: 13.60943 batch_time=0.40438 
Train Epoch: 44 [337/500 21568/32000 (67%)] Loss: 0.73901 (QuantReg: 13.83815) QuantErr: 13.83815 batch_time=0.83996 
Train Epoch: 44 [345/500 22080/32000 (69%)] Loss: 0.41892 (QuantReg: 13.83198) QuantErr: 13.83198 batch_time=0.47684 
Train Epoch: 44 [353/500 22592/32000 (71%)] Loss: 0.74439 (QuantReg: 13.58564) QuantErr: 13.58564 batch_time=0.40721 
Train Epoch: 44 [361/500 23104/32000 (72%)] Loss: 0.52550 (QuantReg: 13.56125) QuantErr: 13.56125 batch_time=0.48045 
Train Epoch: 44 [369/500 23616/32000 (74%)] Loss: 0.53648 (QuantReg: 13.35920) QuantErr: 13.35920 batch_time=0.48008 
Train Epoch: 44 [377/500 24128/32000 (75%)] Loss: 0.47238 (QuantReg: 13.35964) QuantErr: 13.35964 batch_time=0.43595 
Train Epoch: 44 [385/500 24640/32000 (77%)] Loss: 0.66061 (QuantReg: 13.82135) QuantErr: 13.82135 batch_time=1.41640 
Train Epoch: 44 [393/500 25152/32000 (79%)] Loss: 0.43507 (QuantReg: 13.66399) QuantErr: 13.66399 batch_time=0.46390 
Train Epoch: 44 [401/500 25664/32000 (80%)] Loss: 0.54172 (QuantReg: 13.87074) QuantErr: 13.87074 batch_time=0.83197 
Train Epoch: 44 [409/500 26176/32000 (82%)] Loss: 0.73532 (QuantReg: 13.82386) QuantErr: 13.82386 batch_time=0.45226 
Train Epoch: 44 [417/500 26688/32000 (83%)] Loss: 0.52870 (QuantReg: 13.72978) QuantErr: 13.72978 batch_time=0.44415 
Train Epoch: 44 [425/500 27200/32000 (85%)] Loss: 0.36358 (QuantReg: 13.71974) QuantErr: 13.71974 batch_time=0.45979 
Train Epoch: 44 [433/500 27712/32000 (87%)] Loss: 0.62631 (QuantReg: 13.86491) QuantErr: 13.86491 batch_time=0.45696 
Train Epoch: 44 [441/500 28224/32000 (88%)] Loss: 0.46837 (QuantReg: 13.90385) QuantErr: 13.90385 batch_time=0.44201 
Train Epoch: 44 [449/500 28736/32000 (90%)] Loss: 0.58869 (QuantReg: 13.80187) QuantErr: 13.80187 batch_time=1.50325 
Train Epoch: 44 [457/500 29248/32000 (91%)] Loss: 0.68899 (QuantReg: 13.88371) QuantErr: 13.88371 batch_time=0.45051 
Train Epoch: 44 [465/500 29760/32000 (93%)] Loss: 0.67157 (QuantReg: 13.66146) QuantErr: 13.66146 batch_time=0.94811 
Train Epoch: 44 [473/500 30272/32000 (95%)] Loss: 0.42025 (QuantReg: 13.94205) QuantErr: 13.94205 batch_time=0.43349 
Train Epoch: 44 [481/500 30784/32000 (96%)] Loss: 0.37674 (QuantReg: 13.88982) QuantErr: 13.88982 batch_time=0.47377 
Train Epoch: 44 [489/500 31296/32000 (98%)] Loss: 0.67053 (QuantReg: 14.18214) QuantErr: 14.18214 batch_time=0.48649 
Train Epoch: 44 [497/500 31808/32000 (99%)] Loss: 0.71106 (QuantReg: 14.13847) QuantErr: 14.13847 batch_time=0.49157 
Train Epoch: 44 codebook_update_time=2.09820
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch44.pth ...
Done in 5.237s
removing stale ckpt [epoch 43] [took 0.00s]
 epoch          : 44
 loss           : 0.5581974461078644
 quant_reg      : 13.741636972427369
 quant_err      : 13.741636972427369
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 22000
 MSRVTT_miech_test/t2v_metrics/R1: 21.9
 MSRVTT_miech_test/t2v_metrics/R5: 50.9
 MSRVTT_miech_test/t2v_metrics/R10: 64.0
 MSRVTT_miech_test/t2v_metrics/R50: 87.5
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 31.965
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.47444887707473
 MSRVTT_miech_test/v2t_metrics/R1: 21.3
 MSRVTT_miech_test/v2t_metrics/R5: 51.3
 MSRVTT_miech_test/v2t_metrics/R10: 64.0
 MSRVTT_miech_test/v2t_metrics/R50: 89.0
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 27.523
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.19953498076957
 mnt_best       : 42.597504758076916
 not_improved_count: 3
Train Epoch: 45 [1/500 64/32000 (0%)] Loss: 0.53358 (QuantReg: 13.79455) QuantErr: 13.79455 batch_time=29.49860 
Train Epoch: 45 [9/500 576/32000 (2%)] Loss: 0.31488 (QuantReg: 13.38054) QuantErr: 13.38054 batch_time=0.47442 
Train Epoch: 45 [17/500 1088/32000 (3%)] Loss: 0.52841 (QuantReg: 13.78459) QuantErr: 13.78459 batch_time=0.43455 
Train Epoch: 45 [25/500 1600/32000 (5%)] Loss: 0.28850 (QuantReg: 13.83396) QuantErr: 13.83396 batch_time=0.39292 
Train Epoch: 45 [33/500 2112/32000 (7%)] Loss: 0.64827 (QuantReg: 13.68602) QuantErr: 13.68602 batch_time=0.41709 
Train Epoch: 45 [41/500 2624/32000 (8%)] Loss: 0.81549 (QuantReg: 13.83289) QuantErr: 13.83289 batch_time=0.64928 
Train Epoch: 45 [49/500 3136/32000 (10%)] Loss: 0.62803 (QuantReg: 13.47148) QuantErr: 13.47148 batch_time=0.49442 
Train Epoch: 45 [57/500 3648/32000 (11%)] Loss: 0.43017 (QuantReg: 14.12937) QuantErr: 14.12937 batch_time=0.53742 
Train Epoch: 45 [65/500 4160/32000 (13%)] Loss: 0.64233 (QuantReg: 13.51379) QuantErr: 13.51379 batch_time=0.54503 
Train Epoch: 45 [73/500 4672/32000 (15%)] Loss: 0.61601 (QuantReg: 13.83273) QuantErr: 13.83273 batch_time=0.43077 
Train Epoch: 45 [81/500 5184/32000 (16%)] Loss: 0.48566 (QuantReg: 13.54849) QuantErr: 13.54849 batch_time=0.40520 
Train Epoch: 45 [89/500 5696/32000 (18%)] Loss: 0.47251 (QuantReg: 14.08402) QuantErr: 14.08402 batch_time=0.41129 
Train Epoch: 45 [97/500 6208/32000 (19%)] Loss: 0.52022 (QuantReg: 13.66236) QuantErr: 13.66236 batch_time=0.40986 
Train Epoch: 45 [105/500 6720/32000 (21%)] Loss: 0.49218 (QuantReg: 13.42139) QuantErr: 13.42139 batch_time=0.60604 
Train Epoch: 45 [113/500 7232/32000 (23%)] Loss: 0.65340 (QuantReg: 13.54867) QuantErr: 13.54867 batch_time=0.44132 
Train Epoch: 45 [121/500 7744/32000 (24%)] Loss: 0.56927 (QuantReg: 13.72712) QuantErr: 13.72712 batch_time=0.45277 
Train Epoch: 45 [129/500 8256/32000 (26%)] Loss: 0.61670 (QuantReg: 13.81984) QuantErr: 13.81984 batch_time=0.43077 
Train Epoch: 45 [137/500 8768/32000 (27%)] Loss: 0.70732 (QuantReg: 13.63986) QuantErr: 13.63986 batch_time=0.50286 
Train Epoch: 45 [145/500 9280/32000 (29%)] Loss: 0.43499 (QuantReg: 14.05285) QuantErr: 14.05285 batch_time=0.48655 
Train Epoch: 45 [153/500 9792/32000 (31%)] Loss: 0.71621 (QuantReg: 13.47421) QuantErr: 13.47421 batch_time=0.49918 
Train Epoch: 45 [161/500 10304/32000 (32%)] Loss: 0.58058 (QuantReg: 13.47622) QuantErr: 13.47622 batch_time=0.49053 
Train Epoch: 45 [169/500 10816/32000 (34%)] Loss: 0.66537 (QuantReg: 13.83541) QuantErr: 13.83541 batch_time=0.70382 
Train Epoch: 45 [177/500 11328/32000 (35%)] Loss: 0.48333 (QuantReg: 13.78897) QuantErr: 13.78897 batch_time=0.44851 
Train Epoch: 45 [185/500 11840/32000 (37%)] Loss: 0.68401 (QuantReg: 13.55702) QuantErr: 13.55702 batch_time=0.44422 
Train Epoch: 45 [193/500 12352/32000 (39%)] Loss: 0.48205 (QuantReg: 14.10544) QuantErr: 14.10544 batch_time=0.48794 
Train Epoch: 45 [201/500 12864/32000 (40%)] Loss: 0.54776 (QuantReg: 13.78958) QuantErr: 13.78958 batch_time=0.48936 
Train Epoch: 45 [209/500 13376/32000 (42%)] Loss: 0.25966 (QuantReg: 14.28096) QuantErr: 14.28096 batch_time=0.46936 
Train Epoch: 45 [217/500 13888/32000 (43%)] Loss: 0.63665 (QuantReg: 14.01127) QuantErr: 14.01127 batch_time=0.52137 
Train Epoch: 45 [225/500 14400/32000 (45%)] Loss: 0.43588 (QuantReg: 13.77606) QuantErr: 13.77606 batch_time=0.47553 
Train Epoch: 45 [233/500 14912/32000 (47%)] Loss: 0.33345 (QuantReg: 13.68317) QuantErr: 13.68317 batch_time=0.63864 
Train Epoch: 45 [241/500 15424/32000 (48%)] Loss: 0.40697 (QuantReg: 13.89422) QuantErr: 13.89422 batch_time=0.50000 
Train Epoch: 45 [249/500 15936/32000 (50%)] Loss: 0.44206 (QuantReg: 13.77621) QuantErr: 13.77621 batch_time=0.46109 
Train Epoch: 45 [257/500 16448/32000 (51%)] Loss: 0.53620 (QuantReg: 13.71250) QuantErr: 13.71250 batch_time=0.46687 
Train Epoch: 45 [265/500 16960/32000 (53%)] Loss: 0.41831 (QuantReg: 13.75983) QuantErr: 13.75983 batch_time=0.43459 
Train Epoch: 45 [273/500 17472/32000 (55%)] Loss: 0.42072 (QuantReg: 13.83112) QuantErr: 13.83112 batch_time=0.43194 
Train Epoch: 45 [281/500 17984/32000 (56%)] Loss: 0.43468 (QuantReg: 13.48155) QuantErr: 13.48155 batch_time=0.45178 
Train Epoch: 45 [289/500 18496/32000 (58%)] Loss: 0.33279 (QuantReg: 13.85468) QuantErr: 13.85468 batch_time=0.47938 
Train Epoch: 45 [297/500 19008/32000 (59%)] Loss: 0.53451 (QuantReg: 13.45674) QuantErr: 13.45674 batch_time=0.65373 
Train Epoch: 45 [305/500 19520/32000 (61%)] Loss: 0.45370 (QuantReg: 13.75965) QuantErr: 13.75965 batch_time=0.52741 
Train Epoch: 45 [313/500 20032/32000 (63%)] Loss: 0.47583 (QuantReg: 13.71465) QuantErr: 13.71465 batch_time=0.50106 
Train Epoch: 45 [321/500 20544/32000 (64%)] Loss: 0.62313 (QuantReg: 13.84735) QuantErr: 13.84735 batch_time=0.47163 
Train Epoch: 45 [329/500 21056/32000 (66%)] Loss: 0.45525 (QuantReg: 13.80686) QuantErr: 13.80686 batch_time=0.45081 
Train Epoch: 45 [337/500 21568/32000 (67%)] Loss: 0.74210 (QuantReg: 13.83881) QuantErr: 13.83881 batch_time=0.49974 
Train Epoch: 45 [345/500 22080/32000 (69%)] Loss: 0.80762 (QuantReg: 13.92702) QuantErr: 13.92702 batch_time=0.43028 
Train Epoch: 45 [353/500 22592/32000 (71%)] Loss: 0.35592 (QuantReg: 14.03181) QuantErr: 14.03181 batch_time=0.44692 
Train Epoch: 45 [361/500 23104/32000 (72%)] Loss: 0.57248 (QuantReg: 13.64392) QuantErr: 13.64392 batch_time=0.60229 
Train Epoch: 45 [369/500 23616/32000 (74%)] Loss: 0.55785 (QuantReg: 13.42541) QuantErr: 13.42541 batch_time=0.51524 
Train Epoch: 45 [377/500 24128/32000 (75%)] Loss: 0.29570 (QuantReg: 13.75827) QuantErr: 13.75827 batch_time=0.42376 
Train Epoch: 45 [385/500 24640/32000 (77%)] Loss: 0.61925 (QuantReg: 13.68455) QuantErr: 13.68455 batch_time=0.38875 
Train Epoch: 45 [393/500 25152/32000 (79%)] Loss: 0.58403 (QuantReg: 13.88222) QuantErr: 13.88222 batch_time=0.51114 
Train Epoch: 45 [401/500 25664/32000 (80%)] Loss: 0.44501 (QuantReg: 14.07786) QuantErr: 14.07786 batch_time=0.49353 
Train Epoch: 45 [409/500 26176/32000 (82%)] Loss: 0.47972 (QuantReg: 13.76887) QuantErr: 13.76887 batch_time=0.48281 
Train Epoch: 45 [417/500 26688/32000 (83%)] Loss: 0.43365 (QuantReg: 13.80414) QuantErr: 13.80414 batch_time=0.45220 
Train Epoch: 45 [425/500 27200/32000 (85%)] Loss: 0.40185 (QuantReg: 13.71480) QuantErr: 13.71480 batch_time=0.65361 
Train Epoch: 45 [433/500 27712/32000 (87%)] Loss: 0.49314 (QuantReg: 13.77130) QuantErr: 13.77130 batch_time=0.44756 
Train Epoch: 45 [441/500 28224/32000 (88%)] Loss: 0.77537 (QuantReg: 13.69153) QuantErr: 13.69153 batch_time=0.44046 
Train Epoch: 45 [449/500 28736/32000 (90%)] Loss: 0.65432 (QuantReg: 13.34383) QuantErr: 13.34383 batch_time=0.49007 
Train Epoch: 45 [457/500 29248/32000 (91%)] Loss: 0.57255 (QuantReg: 13.45872) QuantErr: 13.45872 batch_time=0.41487 
Train Epoch: 45 [465/500 29760/32000 (93%)] Loss: 0.81756 (QuantReg: 13.75904) QuantErr: 13.75904 batch_time=0.43073 
Train Epoch: 45 [473/500 30272/32000 (95%)] Loss: 0.77182 (QuantReg: 13.89459) QuantErr: 13.89459 batch_time=0.47202 
Train Epoch: 45 [481/500 30784/32000 (96%)] Loss: 0.39566 (QuantReg: 13.79261) QuantErr: 13.79261 batch_time=0.53989 
Train Epoch: 45 [489/500 31296/32000 (98%)] Loss: 0.57140 (QuantReg: 13.95049) QuantErr: 13.95049 batch_time=0.68584 
Train Epoch: 45 [497/500 31808/32000 (99%)] Loss: 0.65096 (QuantReg: 13.69475) QuantErr: 13.69475 batch_time=0.51020 
Train Epoch: 45 codebook_update_time=2.79481
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch45.pth ...
Done in 5.809s
removing stale ckpt [epoch 44] [took 0.01s]
 epoch          : 45
 loss           : 0.5588022000193595
 quant_reg      : 13.753930128097535
 quant_err      : 13.753930128097535
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 22500
 MSRVTT_miech_test/t2v_metrics/R1: 23.0
 MSRVTT_miech_test/t2v_metrics/R5: 50.4
 MSRVTT_miech_test/t2v_metrics/R10: 64.6
 MSRVTT_miech_test/t2v_metrics/R50: 87.7
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.653999999999996
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 42.14994026578499
 MSRVTT_miech_test/v2t_metrics/R1: 22.1
 MSRVTT_miech_test/v2t_metrics/R5: 51.9
 MSRVTT_miech_test/v2t_metrics/R10: 64.5
 MSRVTT_miech_test/v2t_metrics/R50: 89.1
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 29.328
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.97974363339809
 mnt_best       : 42.597504758076916
 not_improved_count: 4
Train Epoch: 46 [1/500 64/32000 (0%)] Loss: 0.42057 (QuantReg: 13.87467) QuantErr: 13.87467 batch_time=30.62427 
Train Epoch: 46 [9/500 576/32000 (2%)] Loss: 0.55439 (QuantReg: 14.04447) QuantErr: 14.04447 batch_time=0.45203 
Train Epoch: 46 [17/500 1088/32000 (3%)] Loss: 0.55585 (QuantReg: 13.79056) QuantErr: 13.79056 batch_time=2.99915 
Train Epoch: 46 [25/500 1600/32000 (5%)] Loss: 0.42544 (QuantReg: 13.87163) QuantErr: 13.87163 batch_time=0.68534 
Train Epoch: 46 [33/500 2112/32000 (7%)] Loss: 0.42097 (QuantReg: 13.79285) QuantErr: 13.79285 batch_time=0.42689 
Train Epoch: 46 [41/500 2624/32000 (8%)] Loss: 0.42003 (QuantReg: 13.53455) QuantErr: 13.53455 batch_time=0.43017 
Train Epoch: 46 [49/500 3136/32000 (10%)] Loss: 0.55549 (QuantReg: 13.67646) QuantErr: 13.67646 batch_time=0.46637 
Train Epoch: 46 [57/500 3648/32000 (11%)] Loss: 0.67846 (QuantReg: 13.91143) QuantErr: 13.91143 batch_time=0.42531 
Train Epoch: 46 [65/500 4160/32000 (13%)] Loss: 0.59708 (QuantReg: 13.76615) QuantErr: 13.76615 batch_time=0.48732 
Train Epoch: 46 [73/500 4672/32000 (15%)] Loss: 0.73377 (QuantReg: 13.30174) QuantErr: 13.30174 batch_time=0.46750 
Train Epoch: 46 [81/500 5184/32000 (16%)] Loss: 0.41353 (QuantReg: 13.89370) QuantErr: 13.89370 batch_time=2.14052 
Train Epoch: 46 [89/500 5696/32000 (18%)] Loss: 0.37729 (QuantReg: 13.43647) QuantErr: 13.43647 batch_time=0.72044 
Train Epoch: 46 [97/500 6208/32000 (19%)] Loss: 0.64426 (QuantReg: 13.39959) QuantErr: 13.39959 batch_time=0.46062 
Train Epoch: 46 [105/500 6720/32000 (21%)] Loss: 0.88199 (QuantReg: 13.89216) QuantErr: 13.89216 batch_time=0.43436 
Train Epoch: 46 [113/500 7232/32000 (23%)] Loss: 0.50799 (QuantReg: 13.62408) QuantErr: 13.62408 batch_time=0.44612 
Train Epoch: 46 [121/500 7744/32000 (24%)] Loss: 0.48026 (QuantReg: 13.90356) QuantErr: 13.90356 batch_time=0.58425 
Train Epoch: 46 [129/500 8256/32000 (26%)] Loss: 0.32212 (QuantReg: 13.86418) QuantErr: 13.86418 batch_time=0.50405 
Train Epoch: 46 [137/500 8768/32000 (27%)] Loss: 0.34665 (QuantReg: 14.05237) QuantErr: 14.05237 batch_time=0.46265 
Train Epoch: 46 [145/500 9280/32000 (29%)] Loss: 0.60195 (QuantReg: 13.77306) QuantErr: 13.77306 batch_time=2.05609 
Train Epoch: 46 [153/500 9792/32000 (31%)] Loss: 0.63887 (QuantReg: 13.81965) QuantErr: 13.81965 batch_time=0.66051 
Train Epoch: 46 [161/500 10304/32000 (32%)] Loss: 0.44444 (QuantReg: 13.62977) QuantErr: 13.62977 batch_time=0.48810 
Train Epoch: 46 [169/500 10816/32000 (34%)] Loss: 0.46440 (QuantReg: 14.17000) QuantErr: 14.17000 batch_time=0.45572 
Train Epoch: 46 [177/500 11328/32000 (35%)] Loss: 0.53518 (QuantReg: 14.00119) QuantErr: 14.00119 batch_time=0.44834 
Train Epoch: 46 [185/500 11840/32000 (37%)] Loss: 0.32568 (QuantReg: 14.08867) QuantErr: 14.08867 batch_time=0.41658 
Train Epoch: 46 [193/500 12352/32000 (39%)] Loss: 0.53291 (QuantReg: 13.92542) QuantErr: 13.92542 batch_time=0.44228 
Train Epoch: 46 [201/500 12864/32000 (40%)] Loss: 0.57369 (QuantReg: 13.62677) QuantErr: 13.62677 batch_time=0.45443 
Train Epoch: 46 [209/500 13376/32000 (42%)] Loss: 0.51933 (QuantReg: 13.85135) QuantErr: 13.85135 batch_time=2.07660 
Train Epoch: 46 [217/500 13888/32000 (43%)] Loss: 0.44332 (QuantReg: 13.61270) QuantErr: 13.61270 batch_time=0.66194 
Train Epoch: 46 [225/500 14400/32000 (45%)] Loss: 0.67196 (QuantReg: 13.74330) QuantErr: 13.74330 batch_time=0.45213 
Train Epoch: 46 [233/500 14912/32000 (47%)] Loss: 0.62765 (QuantReg: 13.74516) QuantErr: 13.74516 batch_time=0.39182 
Train Epoch: 46 [241/500 15424/32000 (48%)] Loss: 0.58519 (QuantReg: 13.84605) QuantErr: 13.84605 batch_time=0.47781 
Train Epoch: 46 [249/500 15936/32000 (50%)] Loss: 0.39647 (QuantReg: 14.14480) QuantErr: 14.14480 batch_time=0.41942 
Train Epoch: 46 [257/500 16448/32000 (51%)] Loss: 0.74862 (QuantReg: 13.41170) QuantErr: 13.41170 batch_time=0.41051 
Train Epoch: 46 [265/500 16960/32000 (53%)] Loss: 0.95917 (QuantReg: 13.82038) QuantErr: 13.82038 batch_time=0.44064 
Train Epoch: 46 [273/500 17472/32000 (55%)] Loss: 0.71553 (QuantReg: 13.80507) QuantErr: 13.80507 batch_time=2.03482 
Train Epoch: 46 [281/500 17984/32000 (56%)] Loss: 0.71867 (QuantReg: 13.70431) QuantErr: 13.70431 batch_time=0.71848 
Train Epoch: 46 [289/500 18496/32000 (58%)] Loss: 0.50632 (QuantReg: 13.87100) QuantErr: 13.87100 batch_time=0.43535 
Train Epoch: 46 [297/500 19008/32000 (59%)] Loss: 0.36741 (QuantReg: 13.84926) QuantErr: 13.84926 batch_time=0.54345 
Train Epoch: 46 [305/500 19520/32000 (61%)] Loss: 0.43670 (QuantReg: 13.94838) QuantErr: 13.94838 batch_time=0.52271 
Train Epoch: 46 [313/500 20032/32000 (63%)] Loss: 0.54525 (QuantReg: 13.76088) QuantErr: 13.76088 batch_time=0.51201 
Train Epoch: 46 [321/500 20544/32000 (64%)] Loss: 0.72135 (QuantReg: 13.71529) QuantErr: 13.71529 batch_time=0.48330 
Train Epoch: 46 [329/500 21056/32000 (66%)] Loss: 0.42367 (QuantReg: 14.15084) QuantErr: 14.15084 batch_time=0.43979 
Train Epoch: 46 [337/500 21568/32000 (67%)] Loss: 0.64506 (QuantReg: 13.82570) QuantErr: 13.82570 batch_time=2.14031 
Train Epoch: 46 [345/500 22080/32000 (69%)] Loss: 0.53029 (QuantReg: 13.73400) QuantErr: 13.73400 batch_time=0.76957 
Train Epoch: 46 [353/500 22592/32000 (71%)] Loss: 0.37913 (QuantReg: 13.80207) QuantErr: 13.80207 batch_time=0.41231 
Train Epoch: 46 [361/500 23104/32000 (72%)] Loss: 0.66708 (QuantReg: 13.56587) QuantErr: 13.56587 batch_time=0.48563 
Train Epoch: 46 [369/500 23616/32000 (74%)] Loss: 0.51228 (QuantReg: 13.93822) QuantErr: 13.93822 batch_time=0.44756 
Train Epoch: 46 [377/500 24128/32000 (75%)] Loss: 0.70074 (QuantReg: 14.06915) QuantErr: 14.06915 batch_time=0.41073 
Train Epoch: 46 [385/500 24640/32000 (77%)] Loss: 0.70138 (QuantReg: 13.82658) QuantErr: 13.82658 batch_time=0.43449 
Train Epoch: 46 [393/500 25152/32000 (79%)] Loss: 0.56899 (QuantReg: 13.74065) QuantErr: 13.74065 batch_time=0.43745 
Train Epoch: 46 [401/500 25664/32000 (80%)] Loss: 0.43353 (QuantReg: 13.70067) QuantErr: 13.70067 batch_time=2.19092 
Train Epoch: 46 [409/500 26176/32000 (82%)] Loss: 0.65170 (QuantReg: 13.71685) QuantErr: 13.71685 batch_time=0.94174 
Train Epoch: 46 [417/500 26688/32000 (83%)] Loss: 0.50977 (QuantReg: 13.59025) QuantErr: 13.59025 batch_time=0.47790 
Train Epoch: 46 [425/500 27200/32000 (85%)] Loss: 0.61921 (QuantReg: 13.63346) QuantErr: 13.63346 batch_time=0.51152 
Train Epoch: 46 [433/500 27712/32000 (87%)] Loss: 0.75302 (QuantReg: 13.48664) QuantErr: 13.48664 batch_time=0.46166 
Train Epoch: 46 [441/500 28224/32000 (88%)] Loss: 0.56752 (QuantReg: 13.70160) QuantErr: 13.70160 batch_time=0.43294 
Train Epoch: 46 [449/500 28736/32000 (90%)] Loss: 0.47191 (QuantReg: 13.84429) QuantErr: 13.84429 batch_time=0.39307 
Train Epoch: 46 [457/500 29248/32000 (91%)] Loss: 0.70674 (QuantReg: 13.29100) QuantErr: 13.29100 batch_time=0.48711 
Train Epoch: 46 [465/500 29760/32000 (93%)] Loss: 0.64345 (QuantReg: 13.56844) QuantErr: 13.56844 batch_time=2.08946 
Train Epoch: 46 [473/500 30272/32000 (95%)] Loss: 0.64866 (QuantReg: 13.72636) QuantErr: 13.72636 batch_time=0.68474 
Train Epoch: 46 [481/500 30784/32000 (96%)] Loss: 0.46810 (QuantReg: 13.59079) QuantErr: 13.59079 batch_time=0.47134 
Train Epoch: 46 [489/500 31296/32000 (98%)] Loss: 0.43875 (QuantReg: 13.66891) QuantErr: 13.66891 batch_time=0.42500 
Train Epoch: 46 [497/500 31808/32000 (99%)] Loss: 0.66102 (QuantReg: 13.80419) QuantErr: 13.80419 batch_time=0.41307 
Train Epoch: 46 codebook_update_time=2.76611
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch46.pth ...
Done in 5.226s
removing stale ckpt [epoch 45] [took 0.00s]
 epoch          : 46
 loss           : 0.5611341086924077
 quant_reg      : 13.786634365081786
 quant_err      : 13.786634365081786
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 23000
 MSRVTT_miech_test/t2v_metrics/R1: 21.9
 MSRVTT_miech_test/t2v_metrics/R5: 50.9
 MSRVTT_miech_test/t2v_metrics/R10: 64.9
 MSRVTT_miech_test/t2v_metrics/R50: 87.1
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.225
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.66795610587369
 MSRVTT_miech_test/v2t_metrics/R1: 21.2
 MSRVTT_miech_test/v2t_metrics/R5: 51.7
 MSRVTT_miech_test/v2t_metrics/R10: 64.9
 MSRVTT_miech_test/v2t_metrics/R50: 88.7
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 29.085
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.43401640001278
 mnt_best       : 42.597504758076916
 not_improved_count: 5
Train Epoch: 47 [1/500 64/32000 (0%)] Loss: 0.47995 (QuantReg: 13.61383) QuantErr: 13.61383 batch_time=30.28292 
Train Epoch: 47 [9/500 576/32000 (2%)] Loss: 0.66262 (QuantReg: 13.10866) QuantErr: 13.10866 batch_time=0.43992 
Train Epoch: 47 [17/500 1088/32000 (3%)] Loss: 0.51825 (QuantReg: 13.47711) QuantErr: 13.47711 batch_time=0.47233 
Train Epoch: 47 [25/500 1600/32000 (5%)] Loss: 0.62607 (QuantReg: 13.71985) QuantErr: 13.71985 batch_time=0.47601 
Train Epoch: 47 [33/500 2112/32000 (7%)] Loss: 0.29272 (QuantReg: 13.56351) QuantErr: 13.56351 batch_time=0.50151 
Train Epoch: 47 [41/500 2624/32000 (8%)] Loss: 0.44311 (QuantReg: 13.50012) QuantErr: 13.50012 batch_time=0.49848 
Train Epoch: 47 [49/500 3136/32000 (10%)] Loss: 0.52992 (QuantReg: 13.75503) QuantErr: 13.75503 batch_time=0.67000 
Train Epoch: 47 [57/500 3648/32000 (11%)] Loss: 0.53773 (QuantReg: 13.89956) QuantErr: 13.89956 batch_time=0.43594 
Train Epoch: 47 [65/500 4160/32000 (13%)] Loss: 0.49593 (QuantReg: 13.60112) QuantErr: 13.60112 batch_time=0.43546 
Train Epoch: 47 [73/500 4672/32000 (15%)] Loss: 0.73845 (QuantReg: 13.23501) QuantErr: 13.23501 batch_time=0.45378 
Train Epoch: 47 [81/500 5184/32000 (16%)] Loss: 0.58334 (QuantReg: 14.07959) QuantErr: 14.07959 batch_time=0.45739 
Train Epoch: 47 [89/500 5696/32000 (18%)] Loss: 0.44231 (QuantReg: 13.76850) QuantErr: 13.76850 batch_time=0.44270 
Train Epoch: 47 [97/500 6208/32000 (19%)] Loss: 0.47938 (QuantReg: 13.91187) QuantErr: 13.91187 batch_time=0.44581 
Train Epoch: 47 [105/500 6720/32000 (21%)] Loss: 0.34490 (QuantReg: 13.93976) QuantErr: 13.93976 batch_time=0.42969 
Train Epoch: 47 [113/500 7232/32000 (23%)] Loss: 0.61644 (QuantReg: 13.89233) QuantErr: 13.89233 batch_time=0.57452 
Train Epoch: 47 [121/500 7744/32000 (24%)] Loss: 0.64571 (QuantReg: 13.86629) QuantErr: 13.86629 batch_time=0.43067 
Train Epoch: 47 [129/500 8256/32000 (26%)] Loss: 0.72757 (QuantReg: 13.77064) QuantErr: 13.77064 batch_time=0.46201 
Train Epoch: 47 [137/500 8768/32000 (27%)] Loss: 0.60647 (QuantReg: 13.56443) QuantErr: 13.56443 batch_time=0.47642 
Train Epoch: 47 [145/500 9280/32000 (29%)] Loss: 0.38300 (QuantReg: 13.66765) QuantErr: 13.66765 batch_time=0.47713 
Train Epoch: 47 [153/500 9792/32000 (31%)] Loss: 0.53758 (QuantReg: 13.77689) QuantErr: 13.77689 batch_time=0.43988 
Train Epoch: 47 [161/500 10304/32000 (32%)] Loss: 0.47192 (QuantReg: 13.66698) QuantErr: 13.66698 batch_time=0.42953 
Train Epoch: 47 [169/500 10816/32000 (34%)] Loss: 0.56923 (QuantReg: 13.87207) QuantErr: 13.87207 batch_time=0.43740 
Train Epoch: 47 [177/500 11328/32000 (35%)] Loss: 0.28810 (QuantReg: 13.96636) QuantErr: 13.96636 batch_time=0.64670 
Train Epoch: 47 [185/500 11840/32000 (37%)] Loss: 0.64385 (QuantReg: 13.63949) QuantErr: 13.63949 batch_time=0.45396 
Train Epoch: 47 [193/500 12352/32000 (39%)] Loss: 0.56660 (QuantReg: 13.86322) QuantErr: 13.86322 batch_time=0.48590 
Train Epoch: 47 [201/500 12864/32000 (40%)] Loss: 0.43769 (QuantReg: 13.74683) QuantErr: 13.74683 batch_time=0.43329 
Train Epoch: 47 [209/500 13376/32000 (42%)] Loss: 0.51890 (QuantReg: 13.85842) QuantErr: 13.85842 batch_time=0.44230 
Train Epoch: 47 [217/500 13888/32000 (43%)] Loss: 0.65282 (QuantReg: 13.65093) QuantErr: 13.65093 batch_time=0.47407 
Train Epoch: 47 [225/500 14400/32000 (45%)] Loss: 0.40198 (QuantReg: 14.11422) QuantErr: 14.11422 batch_time=0.48749 
Train Epoch: 47 [233/500 14912/32000 (47%)] Loss: 0.75355 (QuantReg: 13.87124) QuantErr: 13.87124 batch_time=0.50198 
Train Epoch: 47 [241/500 15424/32000 (48%)] Loss: 0.60501 (QuantReg: 13.95661) QuantErr: 13.95661 batch_time=0.61137 
Train Epoch: 47 [249/500 15936/32000 (50%)] Loss: 0.54126 (QuantReg: 13.94361) QuantErr: 13.94361 batch_time=0.40983 
Train Epoch: 47 [257/500 16448/32000 (51%)] Loss: 0.39740 (QuantReg: 13.45967) QuantErr: 13.45967 batch_time=0.42543 
Train Epoch: 47 [265/500 16960/32000 (53%)] Loss: 0.63501 (QuantReg: 13.69928) QuantErr: 13.69928 batch_time=0.51304 
Train Epoch: 47 [273/500 17472/32000 (55%)] Loss: 0.42208 (QuantReg: 14.03678) QuantErr: 14.03678 batch_time=0.49429 
Train Epoch: 47 [281/500 17984/32000 (56%)] Loss: 0.54528 (QuantReg: 13.55606) QuantErr: 13.55606 batch_time=0.55701 
Train Epoch: 47 [289/500 18496/32000 (58%)] Loss: 0.49910 (QuantReg: 13.83498) QuantErr: 13.83498 batch_time=0.46416 
Train Epoch: 47 [297/500 19008/32000 (59%)] Loss: 0.50216 (QuantReg: 13.51290) QuantErr: 13.51290 batch_time=0.46289 
Train Epoch: 47 [305/500 19520/32000 (61%)] Loss: 0.50014 (QuantReg: 13.76997) QuantErr: 13.76997 batch_time=0.72967 
Train Epoch: 47 [313/500 20032/32000 (63%)] Loss: 0.76333 (QuantReg: 13.70563) QuantErr: 13.70563 batch_time=0.50034 
Train Epoch: 47 [321/500 20544/32000 (64%)] Loss: 0.37391 (QuantReg: 13.78954) QuantErr: 13.78954 batch_time=0.57861 
Train Epoch: 47 [329/500 21056/32000 (66%)] Loss: 0.62309 (QuantReg: 13.69515) QuantErr: 13.69515 batch_time=0.42812 
Train Epoch: 47 [337/500 21568/32000 (67%)] Loss: 0.66201 (QuantReg: 13.93086) QuantErr: 13.93086 batch_time=0.42647 
Train Epoch: 47 [345/500 22080/32000 (69%)] Loss: 0.62435 (QuantReg: 13.77322) QuantErr: 13.77322 batch_time=0.47592 
Train Epoch: 47 [353/500 22592/32000 (71%)] Loss: 0.58462 (QuantReg: 13.51321) QuantErr: 13.51321 batch_time=0.46925 
Train Epoch: 47 [361/500 23104/32000 (72%)] Loss: 0.51617 (QuantReg: 13.95935) QuantErr: 13.95935 batch_time=0.45127 
Train Epoch: 47 [369/500 23616/32000 (74%)] Loss: 0.26976 (QuantReg: 13.82355) QuantErr: 13.82355 batch_time=0.58235 
Train Epoch: 47 [377/500 24128/32000 (75%)] Loss: 0.48098 (QuantReg: 13.96101) QuantErr: 13.96101 batch_time=0.55367 
Train Epoch: 47 [385/500 24640/32000 (77%)] Loss: 0.79943 (QuantReg: 13.59679) QuantErr: 13.59679 batch_time=0.48853 
Train Epoch: 47 [393/500 25152/32000 (79%)] Loss: 0.50375 (QuantReg: 13.54262) QuantErr: 13.54262 batch_time=0.48862 
Train Epoch: 47 [401/500 25664/32000 (80%)] Loss: 0.60670 (QuantReg: 14.15660) QuantErr: 14.15660 batch_time=0.46237 
Train Epoch: 47 [409/500 26176/32000 (82%)] Loss: 0.59330 (QuantReg: 13.67421) QuantErr: 13.67421 batch_time=0.43182 
Train Epoch: 47 [417/500 26688/32000 (83%)] Loss: 0.48114 (QuantReg: 14.09927) QuantErr: 14.09927 batch_time=0.49584 
Train Epoch: 47 [425/500 27200/32000 (85%)] Loss: 0.45971 (QuantReg: 14.11149) QuantErr: 14.11149 batch_time=0.45961 
Train Epoch: 47 [433/500 27712/32000 (87%)] Loss: 0.90564 (QuantReg: 14.13253) QuantErr: 14.13253 batch_time=0.57244 
Train Epoch: 47 [441/500 28224/32000 (88%)] Loss: 0.32865 (QuantReg: 14.24404) QuantErr: 14.24404 batch_time=0.50684 
Train Epoch: 47 [449/500 28736/32000 (90%)] Loss: 0.47407 (QuantReg: 14.00044) QuantErr: 14.00044 batch_time=0.49423 
Train Epoch: 47 [457/500 29248/32000 (91%)] Loss: 0.51832 (QuantReg: 14.05412) QuantErr: 14.05412 batch_time=0.47370 
Train Epoch: 47 [465/500 29760/32000 (93%)] Loss: 0.74495 (QuantReg: 13.58279) QuantErr: 13.58279 batch_time=0.42901 
Train Epoch: 47 [473/500 30272/32000 (95%)] Loss: 0.46312 (QuantReg: 14.20246) QuantErr: 14.20246 batch_time=0.49674 
Train Epoch: 47 [481/500 30784/32000 (96%)] Loss: 0.47307 (QuantReg: 13.34795) QuantErr: 13.34795 batch_time=0.53305 
Train Epoch: 47 [489/500 31296/32000 (98%)] Loss: 0.92572 (QuantReg: 14.20600) QuantErr: 14.20600 batch_time=0.49127 
Train Epoch: 47 [497/500 31808/32000 (99%)] Loss: 0.38238 (QuantReg: 13.98442) QuantErr: 13.98442 batch_time=0.62653 
Train Epoch: 47 codebook_update_time=2.04256
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch47.pth ...
Done in 5.294s
removing stale ckpt [epoch 46] [took 0.01s]
 epoch          : 47
 loss           : 0.5381700395345688
 quant_reg      : 13.833400722503661
 quant_err      : 13.833400722503661
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 23500
 MSRVTT_miech_test/t2v_metrics/R1: 21.0
 MSRVTT_miech_test/t2v_metrics/R5: 50.7
 MSRVTT_miech_test/t2v_metrics/R10: 64.6
 MSRVTT_miech_test/t2v_metrics/R50: 88.0
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.694
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 40.97194590861354
 MSRVTT_miech_test/v2t_metrics/R1: 20.7
 MSRVTT_miech_test/v2t_metrics/R5: 52.4
 MSRVTT_miech_test/v2t_metrics/R10: 65.3
 MSRVTT_miech_test/v2t_metrics/R50: 89.1
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.802
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.37502519447297
 mnt_best       : 42.597504758076916
 not_improved_count: 6
Train Epoch: 48 [1/500 64/32000 (0%)] Loss: 0.43328 (QuantReg: 13.97640) QuantErr: 13.97640 batch_time=32.24369 
Train Epoch: 48 [9/500 576/32000 (2%)] Loss: 0.56031 (QuantReg: 13.82811) QuantErr: 13.82811 batch_time=0.47157 
Train Epoch: 48 [17/500 1088/32000 (3%)] Loss: 0.75303 (QuantReg: 13.82609) QuantErr: 13.82609 batch_time=0.59464 
Train Epoch: 48 [25/500 1600/32000 (5%)] Loss: 0.65203 (QuantReg: 13.96888) QuantErr: 13.96888 batch_time=0.41824 
Train Epoch: 48 [33/500 2112/32000 (7%)] Loss: 0.29830 (QuantReg: 14.11282) QuantErr: 14.11282 batch_time=0.42140 
Train Epoch: 48 [41/500 2624/32000 (8%)] Loss: 0.59285 (QuantReg: 14.00909) QuantErr: 14.00909 batch_time=0.45341 
Train Epoch: 48 [49/500 3136/32000 (10%)] Loss: 0.55165 (QuantReg: 13.72782) QuantErr: 13.72782 batch_time=0.43166 
Train Epoch: 48 [57/500 3648/32000 (11%)] Loss: 0.44314 (QuantReg: 13.94483) QuantErr: 13.94483 batch_time=0.44670 
Train Epoch: 48 [65/500 4160/32000 (13%)] Loss: 0.49479 (QuantReg: 13.64714) QuantErr: 13.64714 batch_time=1.21232 
Train Epoch: 48 [73/500 4672/32000 (15%)] Loss: 0.72043 (QuantReg: 13.96391) QuantErr: 13.96391 batch_time=0.49709 
Train Epoch: 48 [81/500 5184/32000 (16%)] Loss: 0.90480 (QuantReg: 13.43717) QuantErr: 13.43717 batch_time=0.50654 
Train Epoch: 48 [89/500 5696/32000 (18%)] Loss: 0.56264 (QuantReg: 14.05733) QuantErr: 14.05733 batch_time=0.48530 
Train Epoch: 48 [97/500 6208/32000 (19%)] Loss: 1.14444 (QuantReg: 13.59661) QuantErr: 13.59661 batch_time=0.48541 
Train Epoch: 48 [105/500 6720/32000 (21%)] Loss: 0.55421 (QuantReg: 13.87794) QuantErr: 13.87794 batch_time=0.50173 
Train Epoch: 48 [113/500 7232/32000 (23%)] Loss: 0.49144 (QuantReg: 13.85532) QuantErr: 13.85532 batch_time=0.50852 
Train Epoch: 48 [121/500 7744/32000 (24%)] Loss: 0.40868 (QuantReg: 14.08188) QuantErr: 14.08188 batch_time=0.45947 
Train Epoch: 48 [129/500 8256/32000 (26%)] Loss: 0.59283 (QuantReg: 13.57427) QuantErr: 13.57427 batch_time=1.14355 
Train Epoch: 48 [137/500 8768/32000 (27%)] Loss: 0.46982 (QuantReg: 13.60742) QuantErr: 13.60742 batch_time=0.49478 
Train Epoch: 48 [145/500 9280/32000 (29%)] Loss: 0.78393 (QuantReg: 14.00458) QuantErr: 14.00458 batch_time=0.56820 
Train Epoch: 48 [153/500 9792/32000 (31%)] Loss: 0.52300 (QuantReg: 13.81865) QuantErr: 13.81865 batch_time=0.44539 
Train Epoch: 48 [161/500 10304/32000 (32%)] Loss: 0.57889 (QuantReg: 13.60914) QuantErr: 13.60914 batch_time=0.44366 
Train Epoch: 48 [169/500 10816/32000 (34%)] Loss: 0.34220 (QuantReg: 13.88375) QuantErr: 13.88375 batch_time=0.44822 
Train Epoch: 48 [177/500 11328/32000 (35%)] Loss: 0.68375 (QuantReg: 13.89127) QuantErr: 13.89127 batch_time=0.51419 
Train Epoch: 48 [185/500 11840/32000 (37%)] Loss: 0.68801 (QuantReg: 13.70530) QuantErr: 13.70530 batch_time=0.44919 
Train Epoch: 48 [193/500 12352/32000 (39%)] Loss: 0.48414 (QuantReg: 13.89440) QuantErr: 13.89440 batch_time=1.18925 
Train Epoch: 48 [201/500 12864/32000 (40%)] Loss: 0.47570 (QuantReg: 13.49092) QuantErr: 13.49092 batch_time=0.51603 
Train Epoch: 48 [209/500 13376/32000 (42%)] Loss: 0.43773 (QuantReg: 13.67475) QuantErr: 13.67475 batch_time=0.60097 
Train Epoch: 48 [217/500 13888/32000 (43%)] Loss: 0.56651 (QuantReg: 13.41898) QuantErr: 13.41898 batch_time=0.47894 
Train Epoch: 48 [225/500 14400/32000 (45%)] Loss: 0.41871 (QuantReg: 14.04361) QuantErr: 14.04361 batch_time=0.47454 
Train Epoch: 48 [233/500 14912/32000 (47%)] Loss: 0.41009 (QuantReg: 14.19512) QuantErr: 14.19512 batch_time=0.44344 
Train Epoch: 48 [241/500 15424/32000 (48%)] Loss: 0.61940 (QuantReg: 14.07031) QuantErr: 14.07031 batch_time=0.42529 
Train Epoch: 48 [249/500 15936/32000 (50%)] Loss: 0.58634 (QuantReg: 13.58155) QuantErr: 13.58155 batch_time=0.52427 
Train Epoch: 48 [257/500 16448/32000 (51%)] Loss: 0.70468 (QuantReg: 13.80354) QuantErr: 13.80354 batch_time=1.19203 
Train Epoch: 48 [265/500 16960/32000 (53%)] Loss: 0.41996 (QuantReg: 13.87061) QuantErr: 13.87061 batch_time=0.49954 
Train Epoch: 48 [273/500 17472/32000 (55%)] Loss: 0.72021 (QuantReg: 13.92422) QuantErr: 13.92422 batch_time=0.55226 
Train Epoch: 48 [281/500 17984/32000 (56%)] Loss: 0.55243 (QuantReg: 14.19351) QuantErr: 14.19351 batch_time=0.49025 
Train Epoch: 48 [289/500 18496/32000 (58%)] Loss: 0.45872 (QuantReg: 13.81496) QuantErr: 13.81496 batch_time=0.58506 
Train Epoch: 48 [297/500 19008/32000 (59%)] Loss: 0.58366 (QuantReg: 13.77504) QuantErr: 13.77504 batch_time=0.48208 
Train Epoch: 48 [305/500 19520/32000 (61%)] Loss: 0.41299 (QuantReg: 14.13429) QuantErr: 14.13429 batch_time=0.43978 
Train Epoch: 48 [313/500 20032/32000 (63%)] Loss: 0.40032 (QuantReg: 13.78944) QuantErr: 13.78944 batch_time=0.58653 
Train Epoch: 48 [321/500 20544/32000 (64%)] Loss: 0.92296 (QuantReg: 13.55954) QuantErr: 13.55954 batch_time=1.27824 
Train Epoch: 48 [329/500 21056/32000 (66%)] Loss: 0.59694 (QuantReg: 13.55743) QuantErr: 13.55743 batch_time=0.41560 
Train Epoch: 48 [337/500 21568/32000 (67%)] Loss: 0.78643 (QuantReg: 13.91867) QuantErr: 13.91867 batch_time=0.50803 
Train Epoch: 48 [345/500 22080/32000 (69%)] Loss: 0.58905 (QuantReg: 14.23679) QuantErr: 14.23679 batch_time=0.53632 
Train Epoch: 48 [353/500 22592/32000 (71%)] Loss: 0.65395 (QuantReg: 13.84063) QuantErr: 13.84063 batch_time=0.48399 
Train Epoch: 48 [361/500 23104/32000 (72%)] Loss: 0.56855 (QuantReg: 13.66930) QuantErr: 13.66930 batch_time=0.47299 
Train Epoch: 48 [369/500 23616/32000 (74%)] Loss: 0.67987 (QuantReg: 14.08383) QuantErr: 14.08383 batch_time=0.42658 
Train Epoch: 48 [377/500 24128/32000 (75%)] Loss: 0.42127 (QuantReg: 13.99327) QuantErr: 13.99327 batch_time=0.46448 
Train Epoch: 48 [385/500 24640/32000 (77%)] Loss: 0.57053 (QuantReg: 13.87336) QuantErr: 13.87336 batch_time=1.15244 
Train Epoch: 48 [393/500 25152/32000 (79%)] Loss: 0.60958 (QuantReg: 14.31979) QuantErr: 14.31979 batch_time=0.51639 
Train Epoch: 48 [401/500 25664/32000 (80%)] Loss: 0.39690 (QuantReg: 13.93322) QuantErr: 13.93322 batch_time=0.55548 
Train Epoch: 48 [409/500 26176/32000 (82%)] Loss: 0.47539 (QuantReg: 13.74730) QuantErr: 13.74730 batch_time=0.43332 
Train Epoch: 48 [417/500 26688/32000 (83%)] Loss: 0.66178 (QuantReg: 13.37243) QuantErr: 13.37243 batch_time=0.45018 
Train Epoch: 48 [425/500 27200/32000 (85%)] Loss: 0.64013 (QuantReg: 13.88736) QuantErr: 13.88736 batch_time=0.44184 
Train Epoch: 48 [433/500 27712/32000 (87%)] Loss: 0.63789 (QuantReg: 13.73881) QuantErr: 13.73881 batch_time=0.42083 
Train Epoch: 48 [441/500 28224/32000 (88%)] Loss: 0.60783 (QuantReg: 13.89331) QuantErr: 13.89331 batch_time=0.41522 
Train Epoch: 48 [449/500 28736/32000 (90%)] Loss: 0.49664 (QuantReg: 13.83570) QuantErr: 13.83570 batch_time=1.09548 
Train Epoch: 48 [457/500 29248/32000 (91%)] Loss: 0.80001 (QuantReg: 13.88000) QuantErr: 13.88000 batch_time=0.43600 
Train Epoch: 48 [465/500 29760/32000 (93%)] Loss: 0.35813 (QuantReg: 13.87929) QuantErr: 13.87929 batch_time=0.52327 
Train Epoch: 48 [473/500 30272/32000 (95%)] Loss: 0.42533 (QuantReg: 13.55730) QuantErr: 13.55730 batch_time=0.42938 
Train Epoch: 48 [481/500 30784/32000 (96%)] Loss: 0.72307 (QuantReg: 13.62172) QuantErr: 13.62172 batch_time=0.42438 
Train Epoch: 48 [489/500 31296/32000 (98%)] Loss: 0.67750 (QuantReg: 13.84625) QuantErr: 13.84625 batch_time=0.43859 
Train Epoch: 48 [497/500 31808/32000 (99%)] Loss: 0.44702 (QuantReg: 13.89569) QuantErr: 13.89569 batch_time=0.42340 
Train Epoch: 48 codebook_update_time=2.39762
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch48.pth ...
Done in 22.155s
removing stale ckpt [epoch 47] [took 0.00s]
 epoch          : 48
 loss           : 0.5695838991999627
 quant_reg      : 13.84050642967224
 quant_err      : 13.84050642967224
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 24000
 MSRVTT_miech_test/t2v_metrics/R1: 22.0
 MSRVTT_miech_test/t2v_metrics/R5: 50.8
 MSRVTT_miech_test/t2v_metrics/R10: 63.4
 MSRVTT_miech_test/t2v_metrics/R50: 87.4
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.585
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.38013313945025
 MSRVTT_miech_test/v2t_metrics/R1: 22.8
 MSRVTT_miech_test/v2t_metrics/R5: 51.4
 MSRVTT_miech_test/v2t_metrics/R10: 64.5
 MSRVTT_miech_test/v2t_metrics/R50: 89.6
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.093
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 42.281711658946485
 mnt_best       : 42.597504758076916
 not_improved_count: 7
Train Epoch: 49 [1/500 64/32000 (0%)] Loss: 0.36854 (QuantReg: 14.05482) QuantErr: 14.05482 batch_time=29.73994 
Train Epoch: 49 [9/500 576/32000 (2%)] Loss: 0.55916 (QuantReg: 13.72610) QuantErr: 13.72610 batch_time=0.47523 
Train Epoch: 49 [17/500 1088/32000 (3%)] Loss: 0.59071 (QuantReg: 13.60842) QuantErr: 13.60842 batch_time=0.56530 
Train Epoch: 49 [25/500 1600/32000 (5%)] Loss: 0.47391 (QuantReg: 14.09110) QuantErr: 14.09110 batch_time=0.49694 
Train Epoch: 49 [33/500 2112/32000 (7%)] Loss: 0.60139 (QuantReg: 13.50803) QuantErr: 13.50803 batch_time=0.44077 
Train Epoch: 49 [41/500 2624/32000 (8%)] Loss: 0.52865 (QuantReg: 13.75683) QuantErr: 13.75683 batch_time=0.41235 
Train Epoch: 49 [49/500 3136/32000 (10%)] Loss: 0.72060 (QuantReg: 13.99042) QuantErr: 13.99042 batch_time=0.45273 
Train Epoch: 49 [57/500 3648/32000 (11%)] Loss: 0.48520 (QuantReg: 13.61255) QuantErr: 13.61255 batch_time=0.47592 
Train Epoch: 49 [65/500 4160/32000 (13%)] Loss: 0.45945 (QuantReg: 14.22901) QuantErr: 14.22901 batch_time=0.47665 
Train Epoch: 49 [73/500 4672/32000 (15%)] Loss: 0.43096 (QuantReg: 13.99842) QuantErr: 13.99842 batch_time=0.47370 
Train Epoch: 49 [81/500 5184/32000 (16%)] Loss: 0.28411 (QuantReg: 13.79265) QuantErr: 13.79265 batch_time=0.58262 
Train Epoch: 49 [89/500 5696/32000 (18%)] Loss: 0.30098 (QuantReg: 14.16207) QuantErr: 14.16207 batch_time=0.51003 
Train Epoch: 49 [97/500 6208/32000 (19%)] Loss: 0.83212 (QuantReg: 13.56207) QuantErr: 13.56207 batch_time=0.46499 
Train Epoch: 49 [105/500 6720/32000 (21%)] Loss: 0.58313 (QuantReg: 13.28070) QuantErr: 13.28070 batch_time=0.48450 
Train Epoch: 49 [113/500 7232/32000 (23%)] Loss: 0.63639 (QuantReg: 13.96543) QuantErr: 13.96543 batch_time=0.49729 
Train Epoch: 49 [121/500 7744/32000 (24%)] Loss: 0.54674 (QuantReg: 13.93793) QuantErr: 13.93793 batch_time=0.47414 
Train Epoch: 49 [129/500 8256/32000 (26%)] Loss: 0.62771 (QuantReg: 13.81284) QuantErr: 13.81284 batch_time=0.46912 
Train Epoch: 49 [137/500 8768/32000 (27%)] Loss: 0.46474 (QuantReg: 13.59583) QuantErr: 13.59583 batch_time=0.44173 
Train Epoch: 49 [145/500 9280/32000 (29%)] Loss: 0.50832 (QuantReg: 13.74458) QuantErr: 13.74458 batch_time=0.50665 
Train Epoch: 49 [153/500 9792/32000 (31%)] Loss: 0.52990 (QuantReg: 14.10609) QuantErr: 14.10609 batch_time=0.50773 
Train Epoch: 49 [161/500 10304/32000 (32%)] Loss: 0.37770 (QuantReg: 13.88098) QuantErr: 13.88098 batch_time=0.40789 
Train Epoch: 49 [169/500 10816/32000 (34%)] Loss: 0.62304 (QuantReg: 13.43835) QuantErr: 13.43835 batch_time=0.40300 
Train Epoch: 49 [177/500 11328/32000 (35%)] Loss: 0.59870 (QuantReg: 14.10374) QuantErr: 14.10374 batch_time=0.39839 
Train Epoch: 49 [185/500 11840/32000 (37%)] Loss: 0.55032 (QuantReg: 13.42348) QuantErr: 13.42348 batch_time=0.43136 
Train Epoch: 49 [193/500 12352/32000 (39%)] Loss: 0.48480 (QuantReg: 13.54354) QuantErr: 13.54354 batch_time=0.48240 
Train Epoch: 49 [201/500 12864/32000 (40%)] Loss: 0.50541 (QuantReg: 14.19323) QuantErr: 14.19323 batch_time=0.42687 
Train Epoch: 49 [209/500 13376/32000 (42%)] Loss: 0.49522 (QuantReg: 14.29509) QuantErr: 14.29509 batch_time=0.51758 
Train Epoch: 49 [217/500 13888/32000 (43%)] Loss: 0.63674 (QuantReg: 13.78374) QuantErr: 13.78374 batch_time=0.45954 
Train Epoch: 49 [225/500 14400/32000 (45%)] Loss: 0.54040 (QuantReg: 13.99907) QuantErr: 13.99907 batch_time=0.45978 
Train Epoch: 49 [233/500 14912/32000 (47%)] Loss: 0.59495 (QuantReg: 14.05612) QuantErr: 14.05612 batch_time=0.45033 
Train Epoch: 49 [241/500 15424/32000 (48%)] Loss: 0.76076 (QuantReg: 13.08227) QuantErr: 13.08227 batch_time=0.46327 
Train Epoch: 49 [249/500 15936/32000 (50%)] Loss: 0.46085 (QuantReg: 13.83268) QuantErr: 13.83268 batch_time=0.45054 
Train Epoch: 49 [257/500 16448/32000 (51%)] Loss: 0.38738 (QuantReg: 13.88499) QuantErr: 13.88499 batch_time=0.45934 
Train Epoch: 49 [265/500 16960/32000 (53%)] Loss: 0.40632 (QuantReg: 13.90743) QuantErr: 13.90743 batch_time=0.46908 
Train Epoch: 49 [273/500 17472/32000 (55%)] Loss: 0.61530 (QuantReg: 13.71134) QuantErr: 13.71134 batch_time=0.54515 
Train Epoch: 49 [281/500 17984/32000 (56%)] Loss: 0.72663 (QuantReg: 13.81317) QuantErr: 13.81317 batch_time=0.47730 
Train Epoch: 49 [289/500 18496/32000 (58%)] Loss: 0.79537 (QuantReg: 13.84482) QuantErr: 13.84482 batch_time=0.48355 
Train Epoch: 49 [297/500 19008/32000 (59%)] Loss: 0.55619 (QuantReg: 13.87489) QuantErr: 13.87489 batch_time=0.46066 
Train Epoch: 49 [305/500 19520/32000 (61%)] Loss: 0.81589 (QuantReg: 14.23310) QuantErr: 14.23310 batch_time=0.50956 
Train Epoch: 49 [313/500 20032/32000 (63%)] Loss: 0.51275 (QuantReg: 13.95622) QuantErr: 13.95622 batch_time=0.48036 
Train Epoch: 49 [321/500 20544/32000 (64%)] Loss: 0.49473 (QuantReg: 14.09955) QuantErr: 14.09955 batch_time=0.50489 
Train Epoch: 49 [329/500 21056/32000 (66%)] Loss: 0.59360 (QuantReg: 13.92108) QuantErr: 13.92108 batch_time=0.46810 
Train Epoch: 49 [337/500 21568/32000 (67%)] Loss: 0.39955 (QuantReg: 14.16750) QuantErr: 14.16750 batch_time=0.47503 
Train Epoch: 49 [345/500 22080/32000 (69%)] Loss: 0.60117 (QuantReg: 13.69617) QuantErr: 13.69617 batch_time=0.50235 
Train Epoch: 49 [353/500 22592/32000 (71%)] Loss: 0.61056 (QuantReg: 13.99109) QuantErr: 13.99109 batch_time=0.47579 
Train Epoch: 49 [361/500 23104/32000 (72%)] Loss: 0.50055 (QuantReg: 14.03436) QuantErr: 14.03436 batch_time=0.48463 
Train Epoch: 49 [369/500 23616/32000 (74%)] Loss: 0.88019 (QuantReg: 13.81000) QuantErr: 13.81000 batch_time=0.43924 
Train Epoch: 49 [377/500 24128/32000 (75%)] Loss: 0.50767 (QuantReg: 14.11534) QuantErr: 14.11534 batch_time=0.43611 
Train Epoch: 49 [385/500 24640/32000 (77%)] Loss: 0.56999 (QuantReg: 13.35985) QuantErr: 13.35985 batch_time=0.50052 
Train Epoch: 49 [393/500 25152/32000 (79%)] Loss: 0.66784 (QuantReg: 13.51795) QuantErr: 13.51795 batch_time=0.51130 
Train Epoch: 49 [401/500 25664/32000 (80%)] Loss: 0.54713 (QuantReg: 13.78294) QuantErr: 13.78294 batch_time=0.51961 
Train Epoch: 49 [409/500 26176/32000 (82%)] Loss: 0.48727 (QuantReg: 13.90153) QuantErr: 13.90153 batch_time=0.44040 
Train Epoch: 49 [417/500 26688/32000 (83%)] Loss: 0.42273 (QuantReg: 14.11425) QuantErr: 14.11425 batch_time=0.42864 
Train Epoch: 49 [425/500 27200/32000 (85%)] Loss: 0.71478 (QuantReg: 13.87918) QuantErr: 13.87918 batch_time=0.44274 
Train Epoch: 49 [433/500 27712/32000 (87%)] Loss: 0.35764 (QuantReg: 13.52067) QuantErr: 13.52067 batch_time=0.45314 
Train Epoch: 49 [441/500 28224/32000 (88%)] Loss: 0.61215 (QuantReg: 13.87858) QuantErr: 13.87858 batch_time=0.42029 
Train Epoch: 49 [449/500 28736/32000 (90%)] Loss: 0.61659 (QuantReg: 13.78833) QuantErr: 13.78833 batch_time=0.42134 
Train Epoch: 49 [457/500 29248/32000 (91%)] Loss: 0.53101 (QuantReg: 13.65534) QuantErr: 13.65534 batch_time=0.40946 
Train Epoch: 49 [465/500 29760/32000 (93%)] Loss: 0.48082 (QuantReg: 13.57250) QuantErr: 13.57250 batch_time=0.52520 
Train Epoch: 49 [473/500 30272/32000 (95%)] Loss: 0.48384 (QuantReg: 14.01762) QuantErr: 14.01762 batch_time=0.50813 
Train Epoch: 49 [481/500 30784/32000 (96%)] Loss: 0.41231 (QuantReg: 14.28198) QuantErr: 14.28198 batch_time=0.49895 
Train Epoch: 49 [489/500 31296/32000 (98%)] Loss: 0.36044 (QuantReg: 13.92328) QuantErr: 13.92328 batch_time=0.42635 
Train Epoch: 49 [497/500 31808/32000 (99%)] Loss: 0.69961 (QuantReg: 13.98244) QuantErr: 13.98244 batch_time=0.43262 
Train Epoch: 49 codebook_update_time=2.17461
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch49.pth ...
Done in 5.215s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 0.5532183004021645
 quant_reg      : 13.85873295211792
 quant_err      : 13.85873295211792
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 24500
 MSRVTT_miech_test/t2v_metrics/R1: 22.2
 MSRVTT_miech_test/t2v_metrics/R5: 51.2
 MSRVTT_miech_test/t2v_metrics/R10: 64.2
 MSRVTT_miech_test/t2v_metrics/R50: 87.6
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.519999999999996
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.788102808271006
 MSRVTT_miech_test/v2t_metrics/R1: 21.3
 MSRVTT_miech_test/v2t_metrics/R5: 52.0
 MSRVTT_miech_test/v2t_metrics/R10: 65.0
 MSRVTT_miech_test/v2t_metrics/R50: 89.4
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.428
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.60052082681264
 mnt_best       : 42.597504758076916
 not_improved_count: 8
Train Epoch: 50 [1/500 64/32000 (0%)] Loss: 0.50024 (QuantReg: 13.70993) QuantErr: 13.70993 batch_time=30.77232 
Train Epoch: 50 [9/500 576/32000 (2%)] Loss: 0.47077 (QuantReg: 13.78560) QuantErr: 13.78560 batch_time=0.47480 
Train Epoch: 50 [17/500 1088/32000 (3%)] Loss: 0.52086 (QuantReg: 13.99142) QuantErr: 13.99142 batch_time=2.31614 
Train Epoch: 50 [25/500 1600/32000 (5%)] Loss: 0.59083 (QuantReg: 13.72413) QuantErr: 13.72413 batch_time=0.44232 
Train Epoch: 50 [33/500 2112/32000 (7%)] Loss: 0.60052 (QuantReg: 13.60700) QuantErr: 13.60700 batch_time=0.47920 
Train Epoch: 50 [41/500 2624/32000 (8%)] Loss: 0.46508 (QuantReg: 13.96835) QuantErr: 13.96835 batch_time=0.48803 
Train Epoch: 50 [49/500 3136/32000 (10%)] Loss: 0.47726 (QuantReg: 13.89157) QuantErr: 13.89157 batch_time=0.44303 
Train Epoch: 50 [57/500 3648/32000 (11%)] Loss: 0.59839 (QuantReg: 13.81126) QuantErr: 13.81126 batch_time=0.43076 
Train Epoch: 50 [65/500 4160/32000 (13%)] Loss: 0.48461 (QuantReg: 13.99265) QuantErr: 13.99265 batch_time=0.74527 
Train Epoch: 50 [73/500 4672/32000 (15%)] Loss: 0.44130 (QuantReg: 13.70437) QuantErr: 13.70437 batch_time=0.43974 
Train Epoch: 50 [81/500 5184/32000 (16%)] Loss: 0.52231 (QuantReg: 13.87623) QuantErr: 13.87623 batch_time=1.82774 
Train Epoch: 50 [89/500 5696/32000 (18%)] Loss: 0.52746 (QuantReg: 13.55818) QuantErr: 13.55818 batch_time=0.43319 
Train Epoch: 50 [97/500 6208/32000 (19%)] Loss: 0.54751 (QuantReg: 14.06425) QuantErr: 14.06425 batch_time=0.43902 
Train Epoch: 50 [105/500 6720/32000 (21%)] Loss: 0.53134 (QuantReg: 13.79830) QuantErr: 13.79830 batch_time=0.43996 
Train Epoch: 50 [113/500 7232/32000 (23%)] Loss: 0.67465 (QuantReg: 13.61105) QuantErr: 13.61105 batch_time=0.48944 
Train Epoch: 50 [121/500 7744/32000 (24%)] Loss: 0.46503 (QuantReg: 13.91966) QuantErr: 13.91966 batch_time=0.47402 
Train Epoch: 50 [129/500 8256/32000 (26%)] Loss: 0.39699 (QuantReg: 13.83004) QuantErr: 13.83004 batch_time=0.79513 
Train Epoch: 50 [137/500 8768/32000 (27%)] Loss: 0.65969 (QuantReg: 13.61569) QuantErr: 13.61569 batch_time=0.47099 
Train Epoch: 50 [145/500 9280/32000 (29%)] Loss: 0.41023 (QuantReg: 13.76861) QuantErr: 13.76861 batch_time=1.85233 
Train Epoch: 50 [153/500 9792/32000 (31%)] Loss: 0.53640 (QuantReg: 13.69193) QuantErr: 13.69193 batch_time=0.44278 
Train Epoch: 50 [161/500 10304/32000 (32%)] Loss: 0.54270 (QuantReg: 14.05886) QuantErr: 14.05886 batch_time=0.43614 
Train Epoch: 50 [169/500 10816/32000 (34%)] Loss: 0.82810 (QuantReg: 13.86364) QuantErr: 13.86364 batch_time=0.45083 
Train Epoch: 50 [177/500 11328/32000 (35%)] Loss: 0.71710 (QuantReg: 13.61064) QuantErr: 13.61064 batch_time=0.43037 
Train Epoch: 50 [185/500 11840/32000 (37%)] Loss: 0.41415 (QuantReg: 14.10320) QuantErr: 14.10320 batch_time=0.41845 
Train Epoch: 50 [193/500 12352/32000 (39%)] Loss: 0.84854 (QuantReg: 13.27251) QuantErr: 13.27251 batch_time=0.68766 
Train Epoch: 50 [201/500 12864/32000 (40%)] Loss: 0.46520 (QuantReg: 14.12099) QuantErr: 14.12099 batch_time=0.48036 
Train Epoch: 50 [209/500 13376/32000 (42%)] Loss: 0.59115 (QuantReg: 14.17120) QuantErr: 14.17120 batch_time=1.89266 
Train Epoch: 50 [217/500 13888/32000 (43%)] Loss: 0.85281 (QuantReg: 13.61495) QuantErr: 13.61495 batch_time=0.43604 
Train Epoch: 50 [225/500 14400/32000 (45%)] Loss: 0.51232 (QuantReg: 14.35917) QuantErr: 14.35917 batch_time=0.41311 
Train Epoch: 50 [233/500 14912/32000 (47%)] Loss: 0.41105 (QuantReg: 13.96085) QuantErr: 13.96085 batch_time=0.45228 
Train Epoch: 50 [241/500 15424/32000 (48%)] Loss: 0.52036 (QuantReg: 13.79851) QuantErr: 13.79851 batch_time=0.43002 
Train Epoch: 50 [249/500 15936/32000 (50%)] Loss: 0.46708 (QuantReg: 13.93969) QuantErr: 13.93969 batch_time=0.41062 
Train Epoch: 50 [257/500 16448/32000 (51%)] Loss: 0.55040 (QuantReg: 13.54142) QuantErr: 13.54142 batch_time=0.74734 
Train Epoch: 50 [265/500 16960/32000 (53%)] Loss: 0.42208 (QuantReg: 13.89513) QuantErr: 13.89513 batch_time=0.49797 
Train Epoch: 50 [273/500 17472/32000 (55%)] Loss: 0.62506 (QuantReg: 13.64484) QuantErr: 13.64484 batch_time=1.83382 
Train Epoch: 50 [281/500 17984/32000 (56%)] Loss: 0.53882 (QuantReg: 14.06386) QuantErr: 14.06386 batch_time=0.42920 
Train Epoch: 50 [289/500 18496/32000 (58%)] Loss: 0.59271 (QuantReg: 13.63105) QuantErr: 13.63105 batch_time=0.51543 
Train Epoch: 50 [297/500 19008/32000 (59%)] Loss: 0.59167 (QuantReg: 14.00860) QuantErr: 14.00860 batch_time=0.48488 
Train Epoch: 50 [305/500 19520/32000 (61%)] Loss: 0.54531 (QuantReg: 14.05149) QuantErr: 14.05149 batch_time=0.43028 
Train Epoch: 50 [313/500 20032/32000 (63%)] Loss: 0.34255 (QuantReg: 14.21136) QuantErr: 14.21136 batch_time=0.54921 
Train Epoch: 50 [321/500 20544/32000 (64%)] Loss: 0.62504 (QuantReg: 13.62454) QuantErr: 13.62454 batch_time=0.77679 
Train Epoch: 50 [329/500 21056/32000 (66%)] Loss: 0.63585 (QuantReg: 13.98415) QuantErr: 13.98415 batch_time=0.51324 
Train Epoch: 50 [337/500 21568/32000 (67%)] Loss: 0.85780 (QuantReg: 14.17240) QuantErr: 14.17240 batch_time=1.79702 
Train Epoch: 50 [345/500 22080/32000 (69%)] Loss: 0.68155 (QuantReg: 13.65426) QuantErr: 13.65426 batch_time=0.42269 
Train Epoch: 50 [353/500 22592/32000 (71%)] Loss: 0.50120 (QuantReg: 13.94481) QuantErr: 13.94481 batch_time=0.47814 
Train Epoch: 50 [361/500 23104/32000 (72%)] Loss: 0.51308 (QuantReg: 14.02524) QuantErr: 14.02524 batch_time=0.43615 
Train Epoch: 50 [369/500 23616/32000 (74%)] Loss: 0.46715 (QuantReg: 13.74718) QuantErr: 13.74718 batch_time=0.50771 
Train Epoch: 50 [377/500 24128/32000 (75%)] Loss: 0.78625 (QuantReg: 13.60680) QuantErr: 13.60680 batch_time=0.51258 
Train Epoch: 50 [385/500 24640/32000 (77%)] Loss: 0.58422 (QuantReg: 13.85127) QuantErr: 13.85127 batch_time=0.75355 
Train Epoch: 50 [393/500 25152/32000 (79%)] Loss: 0.42552 (QuantReg: 13.77918) QuantErr: 13.77918 batch_time=0.41508 
Train Epoch: 50 [401/500 25664/32000 (80%)] Loss: 0.73840 (QuantReg: 13.69183) QuantErr: 13.69183 batch_time=1.90239 
Train Epoch: 50 [409/500 26176/32000 (82%)] Loss: 0.79566 (QuantReg: 13.63065) QuantErr: 13.63065 batch_time=0.42336 
Train Epoch: 50 [417/500 26688/32000 (83%)] Loss: 0.45916 (QuantReg: 13.91125) QuantErr: 13.91125 batch_time=0.42534 
Train Epoch: 50 [425/500 27200/32000 (85%)] Loss: 0.62089 (QuantReg: 13.94321) QuantErr: 13.94321 batch_time=0.45322 
Train Epoch: 50 [433/500 27712/32000 (87%)] Loss: 0.42899 (QuantReg: 14.06731) QuantErr: 14.06731 batch_time=0.48134 
Train Epoch: 50 [441/500 28224/32000 (88%)] Loss: 0.37086 (QuantReg: 13.83522) QuantErr: 13.83522 batch_time=0.44924 
Train Epoch: 50 [449/500 28736/32000 (90%)] Loss: 0.61579 (QuantReg: 14.37918) QuantErr: 14.37918 batch_time=0.80433 
Train Epoch: 50 [457/500 29248/32000 (91%)] Loss: 0.56485 (QuantReg: 13.78483) QuantErr: 13.78483 batch_time=0.48894 
Train Epoch: 50 [465/500 29760/32000 (93%)] Loss: 0.35429 (QuantReg: 13.91847) QuantErr: 13.91847 batch_time=1.84819 
Train Epoch: 50 [473/500 30272/32000 (95%)] Loss: 0.52454 (QuantReg: 13.96677) QuantErr: 13.96677 batch_time=0.40135 
Train Epoch: 50 [481/500 30784/32000 (96%)] Loss: 0.71632 (QuantReg: 13.76952) QuantErr: 13.76952 batch_time=0.48035 
Train Epoch: 50 [489/500 31296/32000 (98%)] Loss: 0.62842 (QuantReg: 13.68382) QuantErr: 13.68382 batch_time=0.45714 
Train Epoch: 50 [497/500 31808/32000 (99%)] Loss: 0.64466 (QuantReg: 13.90880) QuantErr: 13.90880 batch_time=0.45694 
Train Epoch: 50 codebook_update_time=2.00392
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/checkpoint-epoch50.pth ...
Done in 5.346s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 0.5625267980098725
 quant_reg      : 13.874462577819823
 quant_err      : 13.874462577819823
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 25000
 MSRVTT_miech_test/t2v_metrics/R1: 22.4
 MSRVTT_miech_test/t2v_metrics/R5: 51.5
 MSRVTT_miech_test/t2v_metrics/R10: 63.4
 MSRVTT_miech_test/t2v_metrics/R50: 87.9
 MSRVTT_miech_test/t2v_metrics/MedR: 5.0
 MSRVTT_miech_test/t2v_metrics/MeanR: 32.935
 MSRVTT_miech_test/t2v_metrics/geometric_mean_R1-R5-R10: 41.81975669156304
 MSRVTT_miech_test/v2t_metrics/R1: 20.8
 MSRVTT_miech_test/v2t_metrics/R5: 52.4
 MSRVTT_miech_test/v2t_metrics/R10: 65.0
 MSRVTT_miech_test/v2t_metrics/R50: 88.6
 MSRVTT_miech_test/v2t_metrics/MedR: 5.0
 MSRVTT_miech_test/v2t_metrics/MeanR: 28.426
 MSRVTT_miech_test/v2t_metrics/geometric_mean_R1-R5-R10: 41.37798389106846
 mnt_best       : 42.597504758076916
 not_improved_count: 9
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/trained_model.pth ...
Ckpt loaded at epoch 41.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/MSRVTT-test-qt-sims.npy
MSRVTT_miech_test:
 t2v_metrics/R1/final_eval: 23.6
 t2v_metrics/R5/final_eval: 50.7
 t2v_metrics/R10/final_eval: 64.6
 t2v_metrics/R50/final_eval: 86.6
 t2v_metrics/MedR/final_eval: 5.0
 t2v_metrics/MeanR/final_eval: 33.261
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 42.597504758076916
 v2t_metrics/R1/final_eval: 21.1
 v2t_metrics/R5/final_eval: 51.6
 v2t_metrics/R10/final_eval: 64.6
 v2t_metrics/R50/final_eval: 89.0
 v2t_metrics/MedR/final_eval: 5.0
 v2t_metrics/MeanR/final_eval: 27.997
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 41.27827673684767
Best epoch for the monitored metric: 41
Script took 05h00m37s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_1kB_bs64/trained_model.pth
