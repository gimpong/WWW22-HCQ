Experiment directory: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31
Preparing the dataloaders ...
Loading dataset MSRVTT_full_train in ram ...
Finish loading dataset MSRVTT_full_train in ram, taking 783.7493462562561 s.
Loading dataset MSRVTT_full_val in ram ...
Finish loading dataset MSRVTT_full_val in ram, taking 40.293457984924316 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 234.79337000846863 s.
Loading dataset MSRVTT_full_test in ram ...
Finish loading dataset MSRVTT_full_test in ram, taking 189.60598349571228 s.
Training ...
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch0.pth ...
Done in 1.450s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch0.pth ...
Done in 3.214s
 epoch          : 0
 loss           : 0
 learning_rate  : 5e-05
 n_samples      : 0
 n_steps        : 0
 MSRVTT_full_val/t2v_metrics/R1: 0.0
 MSRVTT_full_val/t2v_metrics/R5: 0.6036217303822937
 MSRVTT_full_val/t2v_metrics/R10: 2.6156941649899395
 MSRVTT_full_val/t2v_metrics/R50: 11.267605633802816
 MSRVTT_full_val/t2v_metrics/MedR: 258.0
 MSRVTT_full_val/t2v_metrics/MeanR: 253.80080482897384
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_val/v2t_metrics/R1: 0.0
 MSRVTT_full_val/v2t_metrics/R5: 0.4024144869215292
 MSRVTT_full_val/v2t_metrics/R10: 1.0060362173038229
 MSRVTT_full_val/v2t_metrics/R50: 9.25553319919517
 MSRVTT_full_val/v2t_metrics/MedR: 249.0
 MSRVTT_full_val/v2t_metrics/MeanR: 251.30382293762577
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/t2v_metrics/R1: 0.0
 MSRVTT_full_test/t2v_metrics/R5: 0.13377926421404682
 MSRVTT_full_test/t2v_metrics/R10: 0.3010033444816054
 MSRVTT_full_test/t2v_metrics/R50: 1.37123745819398
 MSRVTT_full_test/t2v_metrics/MedR: 1515.5
 MSRVTT_full_test/t2v_metrics/MeanR: 1496.3177257525083
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 0.0
 MSRVTT_full_test/v2t_metrics/R1: 0.06688963210702341
 MSRVTT_full_test/v2t_metrics/R5: 0.23411371237458195
 MSRVTT_full_test/v2t_metrics/R10: 0.5016722408026756
 MSRVTT_full_test/v2t_metrics/R50: 1.806020066889632
 MSRVTT_full_test/v2t_metrics/MedR: 1530.5
 MSRVTT_full_test/v2t_metrics/MeanR: 1509.763712374582
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 0.198793376346593
 mnt_best       : 0.0
 not_improved_count: 0
Train Epoch: 1 [1/250 128/32000 (0%)] Loss: 29.85628 (QuantReg: 22.60394) QuantErr: 22.60394 batch_time=26.43361 
Train Epoch: 1 [12/250 1536/32000 (5%)] Loss: 28.16539 (QuantReg: 22.60820) QuantErr: 22.60820 batch_time=0.94055 
Train Epoch: 1 [23/250 2944/32000 (9%)] Loss: 23.53183 (QuantReg: 22.66299) QuantErr: 22.66299 batch_time=0.93835 
Train Epoch: 1 [34/250 4352/32000 (14%)] Loss: 21.27540 (QuantReg: 22.65042) QuantErr: 22.65042 batch_time=0.93985 
Train Epoch: 1 [45/250 5760/32000 (18%)] Loss: 20.58664 (QuantReg: 22.63933) QuantErr: 22.63933 batch_time=0.95708 
Train Epoch: 1 [56/250 7168/32000 (22%)] Loss: 18.01616 (QuantReg: 22.62373) QuantErr: 22.62373 batch_time=0.96874 
Train Epoch: 1 [67/250 8576/32000 (27%)] Loss: 18.96465 (QuantReg: 22.63382) QuantErr: 22.63382 batch_time=1.03448 
Train Epoch: 1 [78/250 9984/32000 (31%)] Loss: 16.99486 (QuantReg: 22.61813) QuantErr: 22.61813 batch_time=0.94911 
Train Epoch: 1 [89/250 11392/32000 (36%)] Loss: 17.24226 (QuantReg: 22.61182) QuantErr: 22.61182 batch_time=0.94107 
Train Epoch: 1 [100/250 12800/32000 (40%)] Loss: 16.54098 (QuantReg: 22.63662) QuantErr: 22.63662 batch_time=0.92796 
Train Epoch: 1 [111/250 14208/32000 (44%)] Loss: 15.84844 (QuantReg: 22.62155) QuantErr: 22.62155 batch_time=1.07047 
Train Epoch: 1 [122/250 15616/32000 (49%)] Loss: 16.30754 (QuantReg: 22.64636) QuantErr: 22.64636 batch_time=0.92533 
Train Epoch: 1 [133/250 17024/32000 (53%)] Loss: 15.51964 (QuantReg: 22.64624) QuantErr: 22.64624 batch_time=0.93021 
Train Epoch: 1 [144/250 18432/32000 (58%)] Loss: 14.98874 (QuantReg: 22.62999) QuantErr: 22.62999 batch_time=0.94066 
Train Epoch: 1 [155/250 19840/32000 (62%)] Loss: 16.24261 (QuantReg: 22.66182) QuantErr: 22.66182 batch_time=0.95924 
Train Epoch: 1 [166/250 21248/32000 (66%)] Loss: 14.04982 (QuantReg: 22.62665) QuantErr: 22.62665 batch_time=0.95225 
Train Epoch: 1 [177/250 22656/32000 (71%)] Loss: 13.17538 (QuantReg: 22.65325) QuantErr: 22.65325 batch_time=0.94503 
Train Epoch: 1 [188/250 24064/32000 (75%)] Loss: 12.82270 (QuantReg: 22.62968) QuantErr: 22.62968 batch_time=0.95267 
Train Epoch: 1 [199/250 25472/32000 (80%)] Loss: 14.28625 (QuantReg: 22.64149) QuantErr: 22.64149 batch_time=0.96047 
Train Epoch: 1 [210/250 26880/32000 (84%)] Loss: 12.91745 (QuantReg: 22.62531) QuantErr: 22.62531 batch_time=0.92921 
Train Epoch: 1 [221/250 28288/32000 (88%)] Loss: 12.32088 (QuantReg: 22.63708) QuantErr: 22.63708 batch_time=1.06591 
Train Epoch: 1 [232/250 29696/32000 (93%)] Loss: 13.50362 (QuantReg: 22.66206) QuantErr: 22.66206 batch_time=0.94850 
Train Epoch: 1 [243/250 31104/32000 (97%)] Loss: 13.10004 (QuantReg: 22.64015) QuantErr: 22.64015 batch_time=0.96977 
Train Epoch: 1 codebook_update_time=9.26384
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch1.pth ...
Done in 4.454s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch1.pth ...
Done in 8.464s
 epoch          : 1
 loss           : 16.80583275604248
 quant_reg      : 22.636447143554687
 quant_err      : 22.636447143554687
 learning_rate  : 5e-05
 n_samples      : 32000
 n_steps        : 250
 MSRVTT_full_val/t2v_metrics/R1: 19.517102615694164
 MSRVTT_full_val/t2v_metrics/R5: 52.51509054325956
 MSRVTT_full_val/t2v_metrics/R10: 66.39839034205231
 MSRVTT_full_val/t2v_metrics/R50: 94.36619718309859
 MSRVTT_full_val/t2v_metrics/MedR: 5.0
 MSRVTT_full_val/t2v_metrics/MeanR: 14.014084507042254
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 40.82745778513133
 MSRVTT_full_val/v2t_metrics/R1: 21.52917505030181
 MSRVTT_full_val/v2t_metrics/R5: 57.142857142857146
 MSRVTT_full_val/v2t_metrics/R10: 73.2394366197183
 MSRVTT_full_val/v2t_metrics/R50: 94.76861167002012
 MSRVTT_full_val/v2t_metrics/MedR: 4.0
 MSRVTT_full_val/v2t_metrics/MeanR: 12.167002012072434
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 44.83096752301555
 MSRVTT_full_test/t2v_metrics/R1: 6.321070234113712
 MSRVTT_full_test/t2v_metrics/R5: 20.20066889632107
 MSRVTT_full_test/t2v_metrics/R10: 31.103678929765888
 MSRVTT_full_test/t2v_metrics/R50: 65.28428093645485
 MSRVTT_full_test/t2v_metrics/MedR: 25.0
 MSRVTT_full_test/t2v_metrics/MeanR: 72.93361204013378
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 15.836384662273998
 MSRVTT_full_test/v2t_metrics/R1: 6.822742474916388
 MSRVTT_full_test/v2t_metrics/R5: 22.842809364548494
 MSRVTT_full_test/v2t_metrics/R10: 35.45150501672241
 MSRVTT_full_test/v2t_metrics/R50: 71.17056856187291
 MSRVTT_full_test/v2t_metrics/MedR: 20.0
 MSRVTT_full_test/v2t_metrics/MeanR: 64.68595317725752
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 17.678594069831338
 mnt_best       : 15.836384662273998
 not_improved_count: 0
Train Epoch: 2 [1/250 128/32000 (0%)] Loss: 12.46076 (QuantReg: 11.51471) QuantErr: 11.51471 batch_time=25.87999 
Train Epoch: 2 [12/250 1536/32000 (5%)] Loss: 11.80633 (QuantReg: 11.24625) QuantErr: 11.24625 batch_time=0.94133 
Train Epoch: 2 [23/250 2944/32000 (9%)] Loss: 12.41349 (QuantReg: 11.66208) QuantErr: 11.66208 batch_time=0.93808 
Train Epoch: 2 [34/250 4352/32000 (14%)] Loss: 12.18893 (QuantReg: 11.39221) QuantErr: 11.39221 batch_time=0.93809 
Train Epoch: 2 [45/250 5760/32000 (18%)] Loss: 13.85918 (QuantReg: 11.71934) QuantErr: 11.71934 batch_time=0.92404 
Train Epoch: 2 [56/250 7168/32000 (22%)] Loss: 12.90500 (QuantReg: 12.08940) QuantErr: 12.08940 batch_time=0.92647 
Train Epoch: 2 [67/250 8576/32000 (27%)] Loss: 11.54389 (QuantReg: 12.21020) QuantErr: 12.21020 batch_time=0.93617 
Train Epoch: 2 [78/250 9984/32000 (31%)] Loss: 10.63754 (QuantReg: 12.48762) QuantErr: 12.48762 batch_time=0.95914 
Train Epoch: 2 [89/250 11392/32000 (36%)] Loss: 10.86102 (QuantReg: 12.32217) QuantErr: 12.32217 batch_time=0.94296 
Train Epoch: 2 [100/250 12800/32000 (40%)] Loss: 11.03831 (QuantReg: 13.03038) QuantErr: 13.03038 batch_time=0.93096 
Train Epoch: 2 [111/250 14208/32000 (44%)] Loss: 11.46546 (QuantReg: 12.72777) QuantErr: 12.72777 batch_time=0.93808 
Train Epoch: 2 [122/250 15616/32000 (49%)] Loss: 11.22059 (QuantReg: 12.62041) QuantErr: 12.62041 batch_time=0.93250 
Train Epoch: 2 [133/250 17024/32000 (53%)] Loss: 11.68107 (QuantReg: 12.99370) QuantErr: 12.99370 batch_time=1.01178 
Train Epoch: 2 [144/250 18432/32000 (58%)] Loss: 11.23085 (QuantReg: 12.94661) QuantErr: 12.94661 batch_time=0.93151 
Train Epoch: 2 [155/250 19840/32000 (62%)] Loss: 11.86016 (QuantReg: 13.29474) QuantErr: 13.29474 batch_time=0.99936 
Train Epoch: 2 [166/250 21248/32000 (66%)] Loss: 11.08922 (QuantReg: 13.28110) QuantErr: 13.28110 batch_time=0.94287 
Train Epoch: 2 [177/250 22656/32000 (71%)] Loss: 11.48515 (QuantReg: 13.34982) QuantErr: 13.34982 batch_time=0.97396 
Train Epoch: 2 [188/250 24064/32000 (75%)] Loss: 10.84655 (QuantReg: 13.59734) QuantErr: 13.59734 batch_time=1.06479 
Train Epoch: 2 [199/250 25472/32000 (80%)] Loss: 11.15677 (QuantReg: 13.77226) QuantErr: 13.77226 batch_time=0.94178 
Train Epoch: 2 [210/250 26880/32000 (84%)] Loss: 11.69947 (QuantReg: 14.03492) QuantErr: 14.03492 batch_time=0.92739 
Train Epoch: 2 [221/250 28288/32000 (88%)] Loss: 9.41048 (QuantReg: 13.99015) QuantErr: 13.99015 batch_time=1.57939 
Train Epoch: 2 [232/250 29696/32000 (93%)] Loss: 10.12785 (QuantReg: 14.39501) QuantErr: 14.39501 batch_time=0.90378 
Train Epoch: 2 [243/250 31104/32000 (97%)] Loss: 9.48420 (QuantReg: 14.23674) QuantErr: 14.23674 batch_time=0.94150 
Train Epoch: 2 codebook_update_time=8.57093
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch2.pth ...
Done in 6.225s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch2.pth ...
Done in 11.264s
removing stale ckpt [epoch 1] [took 0.10s]
removing stale ckpt [epoch 0] [took 0.01s]
 epoch          : 2
 loss           : 11.15474493408203
 quant_reg      : 12.906782775878906
 quant_err      : 12.906782775878906
 learning_rate  : 4.75e-05
 n_samples      : 64000
 n_steps        : 500
 MSRVTT_full_val/t2v_metrics/R1: 20.925553319919516
 MSRVTT_full_val/t2v_metrics/R5: 58.14889336016097
 MSRVTT_full_val/t2v_metrics/R10: 73.03822937625755
 MSRVTT_full_val/t2v_metrics/R50: 96.17706237424547
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 11.048289738430583
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 44.626162955946256
 MSRVTT_full_val/v2t_metrics/R1: 23.74245472837022
 MSRVTT_full_val/v2t_metrics/R5: 62.374245472837025
 MSRVTT_full_val/v2t_metrics/R10: 78.87323943661971
 MSRVTT_full_val/v2t_metrics/R50: 97.58551307847083
 MSRVTT_full_val/v2t_metrics/MedR: 4.0
 MSRVTT_full_val/v2t_metrics/MeanR: 9.116700201207243
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 48.88251407416717
 MSRVTT_full_test/t2v_metrics/R1: 8.327759197324415
 MSRVTT_full_test/t2v_metrics/R5: 26.120401337792643
 MSRVTT_full_test/t2v_metrics/R10: 38.36120401337793
 MSRVTT_full_test/t2v_metrics/R50: 72.90969899665552
 MSRVTT_full_test/t2v_metrics/MedR: 18.0
 MSRVTT_full_test/t2v_metrics/MeanR: 56.48729096989967
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 20.28305700824993
 MSRVTT_full_test/v2t_metrics/R1: 9.531772575250836
 MSRVTT_full_test/v2t_metrics/R5: 29.565217391304348
 MSRVTT_full_test/v2t_metrics/R10: 42.474916387959865
 MSRVTT_full_test/v2t_metrics/R50: 77.25752508361204
 MSRVTT_full_test/v2t_metrics/MedR: 15.0
 MSRVTT_full_test/v2t_metrics/MeanR: 48.49464882943144
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 22.875069751198783
 mnt_best       : 20.28305700824993
 not_improved_count: 0
Train Epoch: 3 [1/250 128/32000 (0%)] Loss: 10.28485 (QuantReg: 11.36856) QuantErr: 11.36856 batch_time=38.44897 
Train Epoch: 3 [12/250 1536/32000 (5%)] Loss: 10.60340 (QuantReg: 11.19858) QuantErr: 11.19858 batch_time=0.93350 
Train Epoch: 3 [23/250 2944/32000 (9%)] Loss: 8.97968 (QuantReg: 11.64148) QuantErr: 11.64148 batch_time=0.93179 
Train Epoch: 3 [34/250 4352/32000 (14%)] Loss: 10.16430 (QuantReg: 11.74909) QuantErr: 11.74909 batch_time=0.92098 
Train Epoch: 3 [45/250 5760/32000 (18%)] Loss: 10.13159 (QuantReg: 11.41943) QuantErr: 11.41943 batch_time=0.94586 
Train Epoch: 3 [56/250 7168/32000 (22%)] Loss: 9.79254 (QuantReg: 11.69704) QuantErr: 11.69704 batch_time=0.95774 
Train Epoch: 3 [67/250 8576/32000 (27%)] Loss: 8.59840 (QuantReg: 11.80574) QuantErr: 11.80574 batch_time=4.42912 
Train Epoch: 3 [78/250 9984/32000 (31%)] Loss: 9.86317 (QuantReg: 11.60047) QuantErr: 11.60047 batch_time=1.00536 
Train Epoch: 3 [89/250 11392/32000 (36%)] Loss: 9.01305 (QuantReg: 11.77048) QuantErr: 11.77048 batch_time=0.93221 
Train Epoch: 3 [100/250 12800/32000 (40%)] Loss: 8.34818 (QuantReg: 11.95612) QuantErr: 11.95612 batch_time=0.92309 
Train Epoch: 3 [111/250 14208/32000 (44%)] Loss: 8.30414 (QuantReg: 12.14237) QuantErr: 12.14237 batch_time=0.96396 
Train Epoch: 3 [122/250 15616/32000 (49%)] Loss: 10.13243 (QuantReg: 12.40245) QuantErr: 12.40245 batch_time=0.93130 
Train Epoch: 3 [133/250 17024/32000 (53%)] Loss: 9.38241 (QuantReg: 12.28151) QuantErr: 12.28151 batch_time=1.05297 
Train Epoch: 3 [144/250 18432/32000 (58%)] Loss: 9.89315 (QuantReg: 12.33606) QuantErr: 12.33606 batch_time=0.93686 
Train Epoch: 3 [155/250 19840/32000 (62%)] Loss: 8.07359 (QuantReg: 11.77141) QuantErr: 11.77141 batch_time=1.41074 
Train Epoch: 3 [166/250 21248/32000 (66%)] Loss: 10.63847 (QuantReg: 12.19812) QuantErr: 12.19812 batch_time=0.95629 
Train Epoch: 3 [177/250 22656/32000 (71%)] Loss: 7.81556 (QuantReg: 12.55212) QuantErr: 12.55212 batch_time=0.97361 
Train Epoch: 3 [188/250 24064/32000 (75%)] Loss: 9.47619 (QuantReg: 12.28999) QuantErr: 12.28999 batch_time=0.92486 
Train Epoch: 3 [199/250 25472/32000 (80%)] Loss: 8.71000 (QuantReg: 12.39090) QuantErr: 12.39090 batch_time=2.37640 
Train Epoch: 3 [210/250 26880/32000 (84%)] Loss: 8.57723 (QuantReg: 12.05551) QuantErr: 12.05551 batch_time=0.94594 
Train Epoch: 3 [221/250 28288/32000 (88%)] Loss: 8.08948 (QuantReg: 12.93508) QuantErr: 12.93508 batch_time=1.27328 
Train Epoch: 3 [232/250 29696/32000 (93%)] Loss: 8.85210 (QuantReg: 13.09573) QuantErr: 13.09573 batch_time=0.93395 
Train Epoch: 3 [243/250 31104/32000 (97%)] Loss: 8.76218 (QuantReg: 12.56716) QuantErr: 12.56716 batch_time=1.01723 
Train Epoch: 3 codebook_update_time=8.20792
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch3.pth ...
Done in 5.737s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch3.pth ...
Done in 11.167s
removing stale ckpt [epoch 2] [took 0.00s]
 epoch          : 3
 loss           : 9.297818017959594
 quant_reg      : 12.058822063446044
 quant_err      : 12.058822063446044
 learning_rate  : 4.5125e-05
 n_samples      : 96000
 n_steps        : 750
 MSRVTT_full_val/t2v_metrics/R1: 24.748490945674043
 MSRVTT_full_val/t2v_metrics/R5: 61.56941649899397
 MSRVTT_full_val/t2v_metrics/R10: 74.84909456740442
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 10.245472837022133
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 48.49535064817711
 MSRVTT_full_val/v2t_metrics/R1: 28.37022132796781
 MSRVTT_full_val/v2t_metrics/R5: 66.80080482897384
 MSRVTT_full_val/v2t_metrics/R10: 80.88531187122736
 MSRVTT_full_val/v2t_metrics/R50: 96.98189134808852
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.82092555331992
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 53.51859387195801
 MSRVTT_full_test/t2v_metrics/R1: 8.762541806020067
 MSRVTT_full_test/t2v_metrics/R5: 27.090301003344482
 MSRVTT_full_test/t2v_metrics/R10: 39.79933110367893
 MSRVTT_full_test/t2v_metrics/R50: 74.44816053511705
 MSRVTT_full_test/t2v_metrics/MedR: 17.0
 MSRVTT_full_test/t2v_metrics/MeanR: 55.30836120401338
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 21.140077196493788
 MSRVTT_full_test/v2t_metrics/R1: 9.698996655518394
 MSRVTT_full_test/v2t_metrics/R5: 31.304347826086957
 MSRVTT_full_test/v2t_metrics/R10: 45.08361204013378
 MSRVTT_full_test/v2t_metrics/R50: 78.49498327759197
 MSRVTT_full_test/v2t_metrics/MedR: 13.0
 MSRVTT_full_test/v2t_metrics/MeanR: 45.15183946488294
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 23.921223638908884
 mnt_best       : 21.140077196493788
 not_improved_count: 0
Train Epoch: 4 [1/250 128/32000 (0%)] Loss: 8.88870 (QuantReg: 11.68915) QuantErr: 11.68915 batch_time=31.72590 
Train Epoch: 4 [12/250 1536/32000 (5%)] Loss: 9.08758 (QuantReg: 11.37098) QuantErr: 11.37098 batch_time=0.94924 
Train Epoch: 4 [23/250 2944/32000 (9%)] Loss: 9.50341 (QuantReg: 11.66935) QuantErr: 11.66935 batch_time=0.93257 
Train Epoch: 4 [34/250 4352/32000 (14%)] Loss: 7.92442 (QuantReg: 11.82254) QuantErr: 11.82254 batch_time=0.92035 
Train Epoch: 4 [45/250 5760/32000 (18%)] Loss: 7.74036 (QuantReg: 11.55809) QuantErr: 11.55809 batch_time=0.92694 
Train Epoch: 4 [56/250 7168/32000 (22%)] Loss: 8.43716 (QuantReg: 11.32563) QuantErr: 11.32563 batch_time=0.93502 
Train Epoch: 4 [67/250 8576/32000 (27%)] Loss: 8.83025 (QuantReg: 11.20307) QuantErr: 11.20307 batch_time=0.95206 
Train Epoch: 4 [78/250 9984/32000 (31%)] Loss: 7.75223 (QuantReg: 11.78610) QuantErr: 11.78610 batch_time=0.98903 
Train Epoch: 4 [89/250 11392/32000 (36%)] Loss: 8.74451 (QuantReg: 12.18289) QuantErr: 12.18289 batch_time=0.95016 
Train Epoch: 4 [100/250 12800/32000 (40%)] Loss: 9.02558 (QuantReg: 11.84477) QuantErr: 11.84477 batch_time=0.92359 
Train Epoch: 4 [111/250 14208/32000 (44%)] Loss: 7.74698 (QuantReg: 12.21038) QuantErr: 12.21038 batch_time=0.92752 
Train Epoch: 4 [122/250 15616/32000 (49%)] Loss: 8.66899 (QuantReg: 12.20769) QuantErr: 12.20769 batch_time=0.99492 
Train Epoch: 4 [133/250 17024/32000 (53%)] Loss: 8.08785 (QuantReg: 12.30983) QuantErr: 12.30983 batch_time=1.23424 
Train Epoch: 4 [144/250 18432/32000 (58%)] Loss: 7.31034 (QuantReg: 12.02400) QuantErr: 12.02400 batch_time=0.97920 
Train Epoch: 4 [155/250 19840/32000 (62%)] Loss: 8.29275 (QuantReg: 12.10734) QuantErr: 12.10734 batch_time=0.93319 
Train Epoch: 4 [166/250 21248/32000 (66%)] Loss: 7.79074 (QuantReg: 12.37785) QuantErr: 12.37785 batch_time=0.91813 
Train Epoch: 4 [177/250 22656/32000 (71%)] Loss: 8.98257 (QuantReg: 12.17898) QuantErr: 12.17898 batch_time=0.99331 
Train Epoch: 4 [188/250 24064/32000 (75%)] Loss: 7.51643 (QuantReg: 12.31481) QuantErr: 12.31481 batch_time=0.95921 
Train Epoch: 4 [199/250 25472/32000 (80%)] Loss: 7.32247 (QuantReg: 12.30629) QuantErr: 12.30629 batch_time=0.93463 
Train Epoch: 4 [210/250 26880/32000 (84%)] Loss: 7.19476 (QuantReg: 12.60331) QuantErr: 12.60331 batch_time=0.94371 
Train Epoch: 4 [221/250 28288/32000 (88%)] Loss: 7.58622 (QuantReg: 12.23652) QuantErr: 12.23652 batch_time=1.04023 
Train Epoch: 4 [232/250 29696/32000 (93%)] Loss: 7.82099 (QuantReg: 12.30073) QuantErr: 12.30073 batch_time=0.95645 
Train Epoch: 4 [243/250 31104/32000 (97%)] Loss: 6.56511 (QuantReg: 12.43386) QuantErr: 12.43386 batch_time=0.95388 
Train Epoch: 4 codebook_update_time=8.05347
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch4.pth ...
Done in 18.386s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch4.pth ...
Done in 23.706s
removing stale ckpt [epoch 3] [took 0.00s]
 epoch          : 4
 loss           : 8.197911178588868
 quant_reg      : 11.983840110778809
 quant_err      : 11.983840110778809
 learning_rate  : 4.2868749999999995e-05
 n_samples      : 128000
 n_steps        : 1000
 MSRVTT_full_val/t2v_metrics/R1: 28.571428571428573
 MSRVTT_full_val/t2v_metrics/R5: 59.758551307847085
 MSRVTT_full_val/t2v_metrics/R10: 75.85513078470825
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 4.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.845070422535212
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 50.594773874268064
 MSRVTT_full_val/v2t_metrics/R1: 27.96780684104628
 MSRVTT_full_val/v2t_metrics/R5: 69.01408450704226
 MSRVTT_full_val/v2t_metrics/R10: 82.09255533199195
 MSRVTT_full_val/v2t_metrics/R50: 96.579476861167
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 8.593561368209254
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 54.11279574493674
 MSRVTT_full_test/t2v_metrics/R1: 9.531772575250836
 MSRVTT_full_test/t2v_metrics/R5: 28.561872909698998
 MSRVTT_full_test/t2v_metrics/R10: 41.60535117056856
 MSRVTT_full_test/t2v_metrics/R50: 75.55183946488295
 MSRVTT_full_test/t2v_metrics/MedR: 15.0
 MSRVTT_full_test/t2v_metrics/MeanR: 51.29397993311037
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 22.457936456791245
 MSRVTT_full_test/v2t_metrics/R1: 11.33779264214047
 MSRVTT_full_test/v2t_metrics/R5: 33.01003344481605
 MSRVTT_full_test/v2t_metrics/R10: 47.290969899665555
 MSRVTT_full_test/v2t_metrics/R50: 80.5685618729097
 MSRVTT_full_test/v2t_metrics/MedR: 12.0
 MSRVTT_full_test/v2t_metrics/MeanR: 40.67725752508361
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 26.060589283986047
 mnt_best       : 22.457936456791245
 not_improved_count: 0
Train Epoch: 5 [1/250 128/32000 (0%)] Loss: 6.69148 (QuantReg: 11.78841) QuantErr: 11.78841 batch_time=40.91391 
Train Epoch: 5 [12/250 1536/32000 (5%)] Loss: 6.79195 (QuantReg: 12.02190) QuantErr: 12.02190 batch_time=0.95895 
Train Epoch: 5 [23/250 2944/32000 (9%)] Loss: 7.80327 (QuantReg: 11.90531) QuantErr: 11.90531 batch_time=0.98866 
Train Epoch: 5 [34/250 4352/32000 (14%)] Loss: 8.45246 (QuantReg: 11.65757) QuantErr: 11.65757 batch_time=0.95129 
Train Epoch: 5 [45/250 5760/32000 (18%)] Loss: 6.95036 (QuantReg: 11.89446) QuantErr: 11.89446 batch_time=0.97665 
Train Epoch: 5 [56/250 7168/32000 (22%)] Loss: 7.43941 (QuantReg: 11.76554) QuantErr: 11.76554 batch_time=0.98842 
Train Epoch: 5 [67/250 8576/32000 (27%)] Loss: 7.15383 (QuantReg: 12.09964) QuantErr: 12.09964 batch_time=0.93884 
Train Epoch: 5 [78/250 9984/32000 (31%)] Loss: 7.78507 (QuantReg: 11.91415) QuantErr: 11.91415 batch_time=0.95496 
Train Epoch: 5 [89/250 11392/32000 (36%)] Loss: 7.04285 (QuantReg: 12.00290) QuantErr: 12.00290 batch_time=0.96830 
Train Epoch: 5 [100/250 12800/32000 (40%)] Loss: 8.14923 (QuantReg: 11.57001) QuantErr: 11.57001 batch_time=0.95594 
Train Epoch: 5 [111/250 14208/32000 (44%)] Loss: 7.55481 (QuantReg: 11.99553) QuantErr: 11.99553 batch_time=0.95649 
Train Epoch: 5 [122/250 15616/32000 (49%)] Loss: 7.02070 (QuantReg: 11.92030) QuantErr: 11.92030 batch_time=0.94717 
Train Epoch: 5 [133/250 17024/32000 (53%)] Loss: 7.17545 (QuantReg: 12.18764) QuantErr: 12.18764 batch_time=1.01151 
Train Epoch: 5 [144/250 18432/32000 (58%)] Loss: 8.30066 (QuantReg: 12.05200) QuantErr: 12.05200 batch_time=0.96890 
Train Epoch: 5 [155/250 19840/32000 (62%)] Loss: 8.68805 (QuantReg: 11.97790) QuantErr: 11.97790 batch_time=0.96018 
Train Epoch: 5 [166/250 21248/32000 (66%)] Loss: 7.23069 (QuantReg: 12.02607) QuantErr: 12.02607 batch_time=0.94984 
Train Epoch: 5 [177/250 22656/32000 (71%)] Loss: 8.15121 (QuantReg: 12.30891) QuantErr: 12.30891 batch_time=1.76056 
Train Epoch: 5 [188/250 24064/32000 (75%)] Loss: 6.32168 (QuantReg: 12.11809) QuantErr: 12.11809 batch_time=1.38570 
Train Epoch: 5 [199/250 25472/32000 (80%)] Loss: 6.90049 (QuantReg: 12.36112) QuantErr: 12.36112 batch_time=0.94901 
Train Epoch: 5 [210/250 26880/32000 (84%)] Loss: 7.06618 (QuantReg: 11.96558) QuantErr: 11.96558 batch_time=0.94481 
Train Epoch: 5 [221/250 28288/32000 (88%)] Loss: 8.14231 (QuantReg: 12.46871) QuantErr: 12.46871 batch_time=0.96670 
Train Epoch: 5 [232/250 29696/32000 (93%)] Loss: 6.97863 (QuantReg: 12.67154) QuantErr: 12.67154 batch_time=0.94582 
Train Epoch: 5 [243/250 31104/32000 (97%)] Loss: 6.76935 (QuantReg: 12.34438) QuantErr: 12.34438 batch_time=0.96968 
Train Epoch: 5 codebook_update_time=9.05216
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch5.pth ...
Done in 5.025s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch5.pth ...
Done in 10.325s
removing stale ckpt [epoch 4] [took 0.01s]
 epoch          : 5
 loss           : 7.391795722961426
 quant_reg      : 12.089642528533936
 quant_err      : 12.089642528533936
 learning_rate  : 4.072531249999999e-05
 n_samples      : 160000
 n_steps        : 1250
 MSRVTT_full_val/t2v_metrics/R1: 29.175050301810867
 MSRVTT_full_val/t2v_metrics/R5: 63.38028169014085
 MSRVTT_full_val/t2v_metrics/R10: 77.66599597585513
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.138832997987928
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.36794897803871
 MSRVTT_full_val/v2t_metrics/R1: 33.40040241448692
 MSRVTT_full_val/v2t_metrics/R5: 71.42857142857143
 MSRVTT_full_val/v2t_metrics/R10: 82.49496981891348
 MSRVTT_full_val/v2t_metrics/R50: 97.38430583501005
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 7.559356136820925
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 58.167943599586756
 MSRVTT_full_test/t2v_metrics/R1: 10.936454849498327
 MSRVTT_full_test/t2v_metrics/R5: 31.40468227424749
 MSRVTT_full_test/t2v_metrics/R10: 44.94983277591973
 MSRVTT_full_test/t2v_metrics/R50: 78.69565217391305
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.936454849498325
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.900019252577064
 MSRVTT_full_test/v2t_metrics/R1: 13.043478260869565
 MSRVTT_full_test/v2t_metrics/R5: 36.92307692307692
 MSRVTT_full_test/v2t_metrics/R10: 52.274247491638796
 MSRVTT_full_test/v2t_metrics/R50: 83.47826086956522
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 35.111371237458194
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.308462154648804
 mnt_best       : 24.900019252577064
 not_improved_count: 0
Train Epoch: 6 [1/250 128/32000 (0%)] Loss: 6.98431 (QuantReg: 12.26950) QuantErr: 12.26950 batch_time=33.62255 
Train Epoch: 6 [12/250 1536/32000 (5%)] Loss: 7.03732 (QuantReg: 12.11269) QuantErr: 12.11269 batch_time=1.17675 
Train Epoch: 6 [23/250 2944/32000 (9%)] Loss: 7.43979 (QuantReg: 11.71992) QuantErr: 11.71992 batch_time=0.93180 
Train Epoch: 6 [34/250 4352/32000 (14%)] Loss: 7.02288 (QuantReg: 11.87834) QuantErr: 11.87834 batch_time=0.99703 
Train Epoch: 6 [45/250 5760/32000 (18%)] Loss: 6.32184 (QuantReg: 11.96925) QuantErr: 11.96925 batch_time=0.96652 
Train Epoch: 6 [56/250 7168/32000 (22%)] Loss: 6.89756 (QuantReg: 12.29637) QuantErr: 12.29637 batch_time=0.93994 
Train Epoch: 6 [67/250 8576/32000 (27%)] Loss: 7.15624 (QuantReg: 12.38030) QuantErr: 12.38030 batch_time=2.60803 
Train Epoch: 6 [78/250 9984/32000 (31%)] Loss: 7.46775 (QuantReg: 12.02514) QuantErr: 12.02514 batch_time=0.95497 
Train Epoch: 6 [89/250 11392/32000 (36%)] Loss: 6.19514 (QuantReg: 12.40714) QuantErr: 12.40714 batch_time=0.94792 
Train Epoch: 6 [100/250 12800/32000 (40%)] Loss: 6.66330 (QuantReg: 12.48373) QuantErr: 12.48373 batch_time=0.97355 
Train Epoch: 6 [111/250 14208/32000 (44%)] Loss: 7.10341 (QuantReg: 11.95303) QuantErr: 11.95303 batch_time=0.93951 
Train Epoch: 6 [122/250 15616/32000 (49%)] Loss: 6.34701 (QuantReg: 12.23911) QuantErr: 12.23911 batch_time=0.93256 
Train Epoch: 6 [133/250 17024/32000 (53%)] Loss: 6.84662 (QuantReg: 12.51592) QuantErr: 12.51592 batch_time=0.96033 
Train Epoch: 6 [144/250 18432/32000 (58%)] Loss: 6.62805 (QuantReg: 12.15021) QuantErr: 12.15021 batch_time=0.96319 
Train Epoch: 6 [155/250 19840/32000 (62%)] Loss: 6.57726 (QuantReg: 12.19938) QuantErr: 12.19938 batch_time=0.94145 
Train Epoch: 6 [166/250 21248/32000 (66%)] Loss: 6.17619 (QuantReg: 12.26457) QuantErr: 12.26457 batch_time=0.93852 
Train Epoch: 6 [177/250 22656/32000 (71%)] Loss: 6.96382 (QuantReg: 12.49274) QuantErr: 12.49274 batch_time=0.92538 
Train Epoch: 6 [188/250 24064/32000 (75%)] Loss: 7.93138 (QuantReg: 12.59462) QuantErr: 12.59462 batch_time=0.93914 
Train Epoch: 6 [199/250 25472/32000 (80%)] Loss: 6.34804 (QuantReg: 11.79365) QuantErr: 11.79365 batch_time=0.92880 
Train Epoch: 6 [210/250 26880/32000 (84%)] Loss: 6.27937 (QuantReg: 12.54109) QuantErr: 12.54109 batch_time=0.92200 
Train Epoch: 6 [221/250 28288/32000 (88%)] Loss: 7.12010 (QuantReg: 12.46006) QuantErr: 12.46006 batch_time=0.92743 
Train Epoch: 6 [232/250 29696/32000 (93%)] Loss: 6.52232 (QuantReg: 12.36808) QuantErr: 12.36808 batch_time=0.95839 
Train Epoch: 6 [243/250 31104/32000 (97%)] Loss: 5.44758 (QuantReg: 12.28151) QuantErr: 12.28151 batch_time=0.91302 
Train Epoch: 6 codebook_update_time=8.90493
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch6.pth ...
Done in 3.955s
removing stale ckpt [epoch 5] [took 0.01s]
 epoch          : 6
 loss           : 6.788179193496704
 quant_reg      : 12.183882175445557
 quant_err      : 12.183882175445557
 learning_rate  : 3.868904687499999e-05
 n_samples      : 192000
 n_steps        : 1500
 MSRVTT_full_val/t2v_metrics/R1: 27.364185110663986
 MSRVTT_full_val/t2v_metrics/R5: 62.57545271629779
 MSRVTT_full_val/t2v_metrics/R10: 75.45271629778672
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.82092555331992
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 50.55379926442329
 MSRVTT_full_val/v2t_metrics/R1: 31.388329979879277
 MSRVTT_full_val/v2t_metrics/R5: 69.21529175050301
 MSRVTT_full_val/v2t_metrics/R10: 84.10462776659959
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 3.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.99195171026157
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 56.74532035598913
 MSRVTT_full_test/t2v_metrics/R1: 9.899665551839465
 MSRVTT_full_test/t2v_metrics/R5: 30.80267558528428
 MSRVTT_full_test/t2v_metrics/R10: 44.81605351170568
 MSRVTT_full_test/t2v_metrics/R50: 77.85953177257525
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 46.67224080267559
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 23.90823549056372
 MSRVTT_full_test/v2t_metrics/R1: 12.307692307692308
 MSRVTT_full_test/v2t_metrics/R5: 36.35451505016722
 MSRVTT_full_test/v2t_metrics/R10: 50.50167224080268
 MSRVTT_full_test/v2t_metrics/R50: 83.87959866220736
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.003010033444816
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.271373944009415
 mnt_best       : 24.900019252577064
 not_improved_count: 1
Train Epoch: 7 [1/250 128/32000 (0%)] Loss: 5.33375 (QuantReg: 11.80667) QuantErr: 11.80667 batch_time=29.32580 
Train Epoch: 7 [12/250 1536/32000 (5%)] Loss: 6.61448 (QuantReg: 11.92832) QuantErr: 11.92832 batch_time=0.94240 
Train Epoch: 7 [23/250 2944/32000 (9%)] Loss: 7.18155 (QuantReg: 12.10066) QuantErr: 12.10066 batch_time=0.94497 
Train Epoch: 7 [34/250 4352/32000 (14%)] Loss: 6.88590 (QuantReg: 11.86663) QuantErr: 11.86663 batch_time=0.99366 
Train Epoch: 7 [45/250 5760/32000 (18%)] Loss: 7.13037 (QuantReg: 12.33940) QuantErr: 12.33940 batch_time=0.96476 
Train Epoch: 7 [56/250 7168/32000 (22%)] Loss: 6.62878 (QuantReg: 12.24736) QuantErr: 12.24736 batch_time=0.96031 
Train Epoch: 7 [67/250 8576/32000 (27%)] Loss: 7.65967 (QuantReg: 11.97242) QuantErr: 11.97242 batch_time=0.95470 
Train Epoch: 7 [78/250 9984/32000 (31%)] Loss: 6.47416 (QuantReg: 12.10569) QuantErr: 12.10569 batch_time=0.95234 
Train Epoch: 7 [89/250 11392/32000 (36%)] Loss: 7.68984 (QuantReg: 12.29870) QuantErr: 12.29870 batch_time=0.93227 
Train Epoch: 7 [100/250 12800/32000 (40%)] Loss: 7.38220 (QuantReg: 12.60205) QuantErr: 12.60205 batch_time=6.75758 
Train Epoch: 7 [111/250 14208/32000 (44%)] Loss: 5.93979 (QuantReg: 12.22334) QuantErr: 12.22334 batch_time=0.93303 
Train Epoch: 7 [122/250 15616/32000 (49%)] Loss: 6.24477 (QuantReg: 12.36218) QuantErr: 12.36218 batch_time=0.94394 
Train Epoch: 7 [133/250 17024/32000 (53%)] Loss: 5.77142 (QuantReg: 11.93115) QuantErr: 11.93115 batch_time=0.95102 
Train Epoch: 7 [144/250 18432/32000 (58%)] Loss: 5.73271 (QuantReg: 12.30020) QuantErr: 12.30020 batch_time=0.93977 
Train Epoch: 7 [155/250 19840/32000 (62%)] Loss: 5.24741 (QuantReg: 11.96067) QuantErr: 11.96067 batch_time=0.93523 
Train Epoch: 7 [166/250 21248/32000 (66%)] Loss: 6.44026 (QuantReg: 12.35112) QuantErr: 12.35112 batch_time=0.92330 
Train Epoch: 7 [177/250 22656/32000 (71%)] Loss: 5.85765 (QuantReg: 12.55864) QuantErr: 12.55864 batch_time=0.95583 
Train Epoch: 7 [188/250 24064/32000 (75%)] Loss: 7.53576 (QuantReg: 11.77634) QuantErr: 11.77634 batch_time=0.93860 
Train Epoch: 7 [199/250 25472/32000 (80%)] Loss: 6.79243 (QuantReg: 12.22569) QuantErr: 12.22569 batch_time=2.80854 
Train Epoch: 7 [210/250 26880/32000 (84%)] Loss: 7.55811 (QuantReg: 12.03611) QuantErr: 12.03611 batch_time=0.99369 
Train Epoch: 7 [221/250 28288/32000 (88%)] Loss: 6.29172 (QuantReg: 12.63498) QuantErr: 12.63498 batch_time=0.97472 
Train Epoch: 7 [232/250 29696/32000 (93%)] Loss: 5.16673 (QuantReg: 12.75867) QuantErr: 12.75867 batch_time=0.92837 
Train Epoch: 7 [243/250 31104/32000 (97%)] Loss: 6.93426 (QuantReg: 12.44558) QuantErr: 12.44558 batch_time=0.96636 
Train Epoch: 7 codebook_update_time=8.98615
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch7.pth ...
Done in 3.992s
removing stale ckpt [epoch 6] [took 0.01s]
 epoch          : 7
 loss           : 6.265350616455078
 quant_reg      : 12.233642261505127
 quant_err      : 12.233642261505127
 learning_rate  : 3.675459453124999e-05
 n_samples      : 224000
 n_steps        : 1750
 MSRVTT_full_val/t2v_metrics/R1: 28.973843058350102
 MSRVTT_full_val/t2v_metrics/R5: 62.374245472837025
 MSRVTT_full_val/t2v_metrics/R10: 78.47082494969818
 MSRVTT_full_val/t2v_metrics/R50: 96.78068410462777
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 9.112676056338028
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.14826641528122
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 71.62977867203219
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.9476861167002015
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.4054656263384
 MSRVTT_full_test/t2v_metrics/R1: 10.367892976588628
 MSRVTT_full_test/t2v_metrics/R5: 31.638795986622075
 MSRVTT_full_test/t2v_metrics/R10: 45.1505016722408
 MSRVTT_full_test/t2v_metrics/R50: 77.79264214046823
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 47.874581939799334
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 24.557887823885387
 MSRVTT_full_test/v2t_metrics/R1: 12.54180602006689
 MSRVTT_full_test/v2t_metrics/R5: 37.02341137123746
 MSRVTT_full_test/v2t_metrics/R10: 51.30434782608695
 MSRVTT_full_test/v2t_metrics/R50: 83.84615384615384
 MSRVTT_full_test/v2t_metrics/MedR: 10.0
 MSRVTT_full_test/v2t_metrics/MeanR: 36.93929765886288
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 28.773778388989758
 mnt_best       : 24.900019252577064
 not_improved_count: 2
Train Epoch: 8 [1/250 128/32000 (0%)] Loss: 6.72838 (QuantReg: 12.01827) QuantErr: 12.01827 batch_time=36.28811 
Train Epoch: 8 [12/250 1536/32000 (5%)] Loss: 6.12785 (QuantReg: 11.77076) QuantErr: 11.77076 batch_time=0.92809 
Train Epoch: 8 [23/250 2944/32000 (9%)] Loss: 6.63109 (QuantReg: 12.09980) QuantErr: 12.09980 batch_time=0.95764 
Train Epoch: 8 [34/250 4352/32000 (14%)] Loss: 5.91525 (QuantReg: 12.49012) QuantErr: 12.49012 batch_time=0.94888 
Train Epoch: 8 [45/250 5760/32000 (18%)] Loss: 6.42605 (QuantReg: 11.84849) QuantErr: 11.84849 batch_time=0.94603 
Train Epoch: 8 [56/250 7168/32000 (22%)] Loss: 6.38814 (QuantReg: 11.92345) QuantErr: 11.92345 batch_time=0.95619 
Train Epoch: 8 [67/250 8576/32000 (27%)] Loss: 7.12810 (QuantReg: 12.12666) QuantErr: 12.12666 batch_time=0.97749 
Train Epoch: 8 [78/250 9984/32000 (31%)] Loss: 5.44793 (QuantReg: 12.43743) QuantErr: 12.43743 batch_time=1.30343 
Train Epoch: 8 [89/250 11392/32000 (36%)] Loss: 5.88677 (QuantReg: 12.64684) QuantErr: 12.64684 batch_time=0.93011 
Train Epoch: 8 [100/250 12800/32000 (40%)] Loss: 6.55965 (QuantReg: 12.07725) QuantErr: 12.07725 batch_time=0.96066 
Train Epoch: 8 [111/250 14208/32000 (44%)] Loss: 5.44932 (QuantReg: 12.34081) QuantErr: 12.34081 batch_time=0.95450 
Train Epoch: 8 [122/250 15616/32000 (49%)] Loss: 6.19955 (QuantReg: 12.42908) QuantErr: 12.42908 batch_time=0.93954 
Train Epoch: 8 [133/250 17024/32000 (53%)] Loss: 6.41231 (QuantReg: 11.94412) QuantErr: 11.94412 batch_time=0.95676 
Train Epoch: 8 [144/250 18432/32000 (58%)] Loss: 5.50562 (QuantReg: 12.44926) QuantErr: 12.44926 batch_time=0.99441 
Train Epoch: 8 [155/250 19840/32000 (62%)] Loss: 5.37933 (QuantReg: 12.47451) QuantErr: 12.47451 batch_time=1.52615 
Train Epoch: 8 [166/250 21248/32000 (66%)] Loss: 5.12037 (QuantReg: 12.20220) QuantErr: 12.20220 batch_time=0.95090 
Train Epoch: 8 [177/250 22656/32000 (71%)] Loss: 5.33794 (QuantReg: 12.51379) QuantErr: 12.51379 batch_time=0.92645 
Train Epoch: 8 [188/250 24064/32000 (75%)] Loss: 4.70401 (QuantReg: 12.50134) QuantErr: 12.50134 batch_time=0.93906 
Train Epoch: 8 [199/250 25472/32000 (80%)] Loss: 6.41329 (QuantReg: 12.60028) QuantErr: 12.60028 batch_time=0.92115 
Train Epoch: 8 [210/250 26880/32000 (84%)] Loss: 4.97298 (QuantReg: 12.58084) QuantErr: 12.58084 batch_time=0.92233 
Train Epoch: 8 [221/250 28288/32000 (88%)] Loss: 4.86934 (QuantReg: 12.36290) QuantErr: 12.36290 batch_time=0.93068 
Train Epoch: 8 [232/250 29696/32000 (93%)] Loss: 6.80838 (QuantReg: 12.17968) QuantErr: 12.17968 batch_time=0.90596 
Train Epoch: 8 [243/250 31104/32000 (97%)] Loss: 5.19275 (QuantReg: 12.72093) QuantErr: 12.72093 batch_time=0.93623 
Train Epoch: 8 codebook_update_time=7.96803
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch8.pth ...
Done in 16.957s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch8.pth ...
Done in 20.736s
removing stale ckpt [epoch 7] [took 0.00s]
 epoch          : 8
 loss           : 5.833094860076904
 quant_reg      : 12.283239761352538
 quant_err      : 12.283239761352538
 learning_rate  : 3.4916864804687486e-05
 n_samples      : 256000
 n_steps        : 2000
 MSRVTT_full_val/t2v_metrics/R1: 30.985915492957748
 MSRVTT_full_val/t2v_metrics/R5: 65.99597585513078
 MSRVTT_full_val/t2v_metrics/R10: 78.67203219315896
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.943661971830986
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.38770316157045
 MSRVTT_full_val/v2t_metrics/R1: 34.40643863179074
 MSRVTT_full_val/v2t_metrics/R5: 73.44064386317908
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 97.78672032193158
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.933601609657948
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.10111944033106
 MSRVTT_full_test/t2v_metrics/R1: 11.839464882943144
 MSRVTT_full_test/t2v_metrics/R5: 32.97658862876254
 MSRVTT_full_test/t2v_metrics/R10: 46.32107023411371
 MSRVTT_full_test/t2v_metrics/R50: 78.8628762541806
 MSRVTT_full_test/t2v_metrics/MedR: 13.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.6056856187291
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.248558722550193
 MSRVTT_full_test/v2t_metrics/R1: 12.709030100334449
 MSRVTT_full_test/v2t_metrics/R5: 37.22408026755853
 MSRVTT_full_test/v2t_metrics/R10: 52.77591973244147
 MSRVTT_full_test/v2t_metrics/R50: 83.34448160535118
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 37.0066889632107
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 29.227436902916526
 mnt_best       : 26.248558722550193
 not_improved_count: 0
Train Epoch: 9 [1/250 128/32000 (0%)] Loss: 6.15022 (QuantReg: 11.91281) QuantErr: 11.91281 batch_time=37.44750 
Train Epoch: 9 [12/250 1536/32000 (5%)] Loss: 6.64332 (QuantReg: 12.06240) QuantErr: 12.06240 batch_time=0.92359 
Train Epoch: 9 [23/250 2944/32000 (9%)] Loss: 4.93222 (QuantReg: 11.87147) QuantErr: 11.87147 batch_time=0.92526 
Train Epoch: 9 [34/250 4352/32000 (14%)] Loss: 5.95843 (QuantReg: 12.63659) QuantErr: 12.63659 batch_time=0.92185 
Train Epoch: 9 [45/250 5760/32000 (18%)] Loss: 4.88875 (QuantReg: 12.67270) QuantErr: 12.67270 batch_time=0.93529 
Train Epoch: 9 [56/250 7168/32000 (22%)] Loss: 5.64185 (QuantReg: 12.50600) QuantErr: 12.50600 batch_time=0.91881 
Train Epoch: 9 [67/250 8576/32000 (27%)] Loss: 5.19340 (QuantReg: 12.03386) QuantErr: 12.03386 batch_time=0.95153 
Train Epoch: 9 [78/250 9984/32000 (31%)] Loss: 4.86604 (QuantReg: 12.35439) QuantErr: 12.35439 batch_time=0.92817 
Train Epoch: 9 [89/250 11392/32000 (36%)] Loss: 5.52142 (QuantReg: 12.39419) QuantErr: 12.39419 batch_time=1.02218 
Train Epoch: 9 [100/250 12800/32000 (40%)] Loss: 4.48837 (QuantReg: 12.43983) QuantErr: 12.43983 batch_time=0.92123 
Train Epoch: 9 [111/250 14208/32000 (44%)] Loss: 5.26939 (QuantReg: 12.33506) QuantErr: 12.33506 batch_time=1.04872 
Train Epoch: 9 [122/250 15616/32000 (49%)] Loss: 4.28921 (QuantReg: 12.47800) QuantErr: 12.47800 batch_time=1.17512 
Train Epoch: 9 [133/250 17024/32000 (53%)] Loss: 5.41368 (QuantReg: 12.79118) QuantErr: 12.79118 batch_time=0.97898 
Train Epoch: 9 [144/250 18432/32000 (58%)] Loss: 5.17302 (QuantReg: 12.36283) QuantErr: 12.36283 batch_time=0.91830 
Train Epoch: 9 [155/250 19840/32000 (62%)] Loss: 5.45759 (QuantReg: 12.26813) QuantErr: 12.26813 batch_time=0.94205 
Train Epoch: 9 [166/250 21248/32000 (66%)] Loss: 5.45694 (QuantReg: 12.25916) QuantErr: 12.25916 batch_time=0.94731 
Train Epoch: 9 [177/250 22656/32000 (71%)] Loss: 5.32852 (QuantReg: 12.65204) QuantErr: 12.65204 batch_time=0.94558 
Train Epoch: 9 [188/250 24064/32000 (75%)] Loss: 5.79780 (QuantReg: 12.57668) QuantErr: 12.57668 batch_time=1.28553 
Train Epoch: 9 [199/250 25472/32000 (80%)] Loss: 5.82396 (QuantReg: 12.65683) QuantErr: 12.65683 batch_time=2.86520 
Train Epoch: 9 [210/250 26880/32000 (84%)] Loss: 5.30407 (QuantReg: 12.31036) QuantErr: 12.31036 batch_time=1.14848 
Train Epoch: 9 [221/250 28288/32000 (88%)] Loss: 4.83579 (QuantReg: 12.51051) QuantErr: 12.51051 batch_time=0.94673 
Train Epoch: 9 [232/250 29696/32000 (93%)] Loss: 4.85341 (QuantReg: 12.86381) QuantErr: 12.86381 batch_time=0.94591 
Train Epoch: 9 [243/250 31104/32000 (97%)] Loss: 4.54832 (QuantReg: 12.47462) QuantErr: 12.47462 batch_time=0.93800 
Train Epoch: 9 codebook_update_time=8.64358
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch9.pth ...
Done in 4.166s
removing stale ckpt [epoch 8] [took 0.00s]
 epoch          : 9
 loss           : 5.491644438743592
 quant_reg      : 12.377650302886963
 quant_err      : 12.377650302886963
 learning_rate  : 3.317102156445311e-05
 n_samples      : 288000
 n_steps        : 2250
 MSRVTT_full_val/t2v_metrics/R1: 29.77867203219316
 MSRVTT_full_val/t2v_metrics/R5: 65.79476861167002
 MSRVTT_full_val/t2v_metrics/R10: 80.0804828973843
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.231388329979879
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.93546880753877
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 75.0503018108652
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.301810865191147
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.447703052216234
 MSRVTT_full_test/t2v_metrics/R1: 10.903010033444817
 MSRVTT_full_test/t2v_metrics/R5: 33.74581939799331
 MSRVTT_full_test/t2v_metrics/R10: 47.357859531772576
 MSRVTT_full_test/t2v_metrics/R50: 80.43478260869566
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.814046822742476
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 25.925042970181163
 MSRVTT_full_test/v2t_metrics/R1: 13.979933110367893
 MSRVTT_full_test/v2t_metrics/R5: 39.331103678929765
 MSRVTT_full_test/v2t_metrics/R10: 53.7123745819398
 MSRVTT_full_test/v2t_metrics/R50: 85.21739130434783
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 33.51120401337793
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.910440428064756
 mnt_best       : 26.248558722550193
 not_improved_count: 1
Train Epoch: 10 [1/250 128/32000 (0%)] Loss: 5.19620 (QuantReg: 12.17664) QuantErr: 12.17664 batch_time=36.28912 
Train Epoch: 10 [12/250 1536/32000 (5%)] Loss: 6.10183 (QuantReg: 12.13098) QuantErr: 12.13098 batch_time=1.00533 
Train Epoch: 10 [23/250 2944/32000 (9%)] Loss: 5.67020 (QuantReg: 12.18241) QuantErr: 12.18241 batch_time=0.98708 
Train Epoch: 10 [34/250 4352/32000 (14%)] Loss: 5.59008 (QuantReg: 11.99827) QuantErr: 11.99827 batch_time=0.93376 
Train Epoch: 10 [45/250 5760/32000 (18%)] Loss: 4.15243 (QuantReg: 12.42102) QuantErr: 12.42102 batch_time=0.96182 
Train Epoch: 10 [56/250 7168/32000 (22%)] Loss: 4.80762 (QuantReg: 12.11273) QuantErr: 12.11273 batch_time=0.97890 
Train Epoch: 10 [67/250 8576/32000 (27%)] Loss: 4.32431 (QuantReg: 12.45482) QuantErr: 12.45482 batch_time=0.92361 
Train Epoch: 10 [78/250 9984/32000 (31%)] Loss: 5.00669 (QuantReg: 12.48437) QuantErr: 12.48437 batch_time=0.91819 
Train Epoch: 10 [89/250 11392/32000 (36%)] Loss: 5.22699 (QuantReg: 12.00070) QuantErr: 12.00070 batch_time=0.92431 
Train Epoch: 10 [100/250 12800/32000 (40%)] Loss: 4.12731 (QuantReg: 12.57689) QuantErr: 12.57689 batch_time=0.92330 
Train Epoch: 10 [111/250 14208/32000 (44%)] Loss: 5.73116 (QuantReg: 12.45136) QuantErr: 12.45136 batch_time=0.93185 
Train Epoch: 10 [122/250 15616/32000 (49%)] Loss: 5.51769 (QuantReg: 12.61541) QuantErr: 12.61541 batch_time=0.92741 
Train Epoch: 10 [133/250 17024/32000 (53%)] Loss: 4.93486 (QuantReg: 12.42756) QuantErr: 12.42756 batch_time=0.95683 
Train Epoch: 10 [144/250 18432/32000 (58%)] Loss: 5.31265 (QuantReg: 12.53603) QuantErr: 12.53603 batch_time=0.93476 
Train Epoch: 10 [155/250 19840/32000 (62%)] Loss: 5.30275 (QuantReg: 12.79820) QuantErr: 12.79820 batch_time=0.92874 
Train Epoch: 10 [166/250 21248/32000 (66%)] Loss: 4.23334 (QuantReg: 12.36100) QuantErr: 12.36100 batch_time=0.93247 
Train Epoch: 10 [177/250 22656/32000 (71%)] Loss: 5.33364 (QuantReg: 12.69955) QuantErr: 12.69955 batch_time=0.94110 
Train Epoch: 10 [188/250 24064/32000 (75%)] Loss: 5.39591 (QuantReg: 12.41162) QuantErr: 12.41162 batch_time=0.94113 
Train Epoch: 10 [199/250 25472/32000 (80%)] Loss: 4.49475 (QuantReg: 12.32463) QuantErr: 12.32463 batch_time=0.93345 
Train Epoch: 10 [210/250 26880/32000 (84%)] Loss: 4.88830 (QuantReg: 12.72626) QuantErr: 12.72626 batch_time=0.99286 
Train Epoch: 10 [221/250 28288/32000 (88%)] Loss: 5.80755 (QuantReg: 12.74810) QuantErr: 12.74810 batch_time=0.93735 
Train Epoch: 10 [232/250 29696/32000 (93%)] Loss: 4.93204 (QuantReg: 12.45013) QuantErr: 12.45013 batch_time=0.95747 
Train Epoch: 10 [243/250 31104/32000 (97%)] Loss: 4.10438 (QuantReg: 12.51867) QuantErr: 12.51867 batch_time=0.96727 
Train Epoch: 10 codebook_update_time=8.75240
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch10.pth ...
Done in 4.024s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch10.pth ...
Done in 7.855s
removing stale ckpt [epoch 9] [took 0.01s]
 epoch          : 10
 loss           : 5.181815181732178
 quant_reg      : 12.444166889190674
 quant_err      : 12.444166889190674
 learning_rate  : 3.151247048623045e-05
 n_samples      : 320000
 n_steps        : 2500
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 65.19114688128772
 MSRVTT_full_val/t2v_metrics/R10: 78.87323943661971
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.400402414486923
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.256373398125135
 MSRVTT_full_val/v2t_metrics/R1: 33.80281690140845
 MSRVTT_full_val/v2t_metrics/R5: 72.83702213279678
 MSRVTT_full_val/v2t_metrics/R10: 84.90945674044265
 MSRVTT_full_val/v2t_metrics/R50: 97.98792756539235
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.798792756539235
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 59.349952950749255
 MSRVTT_full_test/t2v_metrics/R1: 11.638795986622073
 MSRVTT_full_test/t2v_metrics/R5: 34.046822742474916
 MSRVTT_full_test/t2v_metrics/R10: 47.15719063545151
 MSRVTT_full_test/t2v_metrics/R50: 79.96655518394648
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.80367892976589
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.536533503973864
 MSRVTT_full_test/v2t_metrics/R1: 14.080267558528428
 MSRVTT_full_test/v2t_metrics/R5: 39.063545150501675
 MSRVTT_full_test/v2t_metrics/R10: 52.97658862876254
 MSRVTT_full_test/v2t_metrics/R50: 84.74916387959867
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 34.872240802675584
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 30.77198534704316
 mnt_best       : 26.536533503973864
 not_improved_count: 0
Train Epoch: 11 [1/250 128/32000 (0%)] Loss: 5.06506 (QuantReg: 12.54698) QuantErr: 12.54698 batch_time=31.99147 
Train Epoch: 11 [12/250 1536/32000 (5%)] Loss: 4.14136 (QuantReg: 12.52534) QuantErr: 12.52534 batch_time=0.92633 
Train Epoch: 11 [23/250 2944/32000 (9%)] Loss: 4.61154 (QuantReg: 11.94664) QuantErr: 11.94664 batch_time=0.95680 
Train Epoch: 11 [34/250 4352/32000 (14%)] Loss: 4.45381 (QuantReg: 12.44482) QuantErr: 12.44482 batch_time=0.94580 
Train Epoch: 11 [45/250 5760/32000 (18%)] Loss: 4.92147 (QuantReg: 12.62867) QuantErr: 12.62867 batch_time=0.92703 
Train Epoch: 11 [56/250 7168/32000 (22%)] Loss: 5.45479 (QuantReg: 12.47040) QuantErr: 12.47040 batch_time=0.92578 
Train Epoch: 11 [67/250 8576/32000 (27%)] Loss: 4.66048 (QuantReg: 12.58807) QuantErr: 12.58807 batch_time=0.94934 
Train Epoch: 11 [78/250 9984/32000 (31%)] Loss: 5.04467 (QuantReg: 12.17999) QuantErr: 12.17999 batch_time=0.92321 
Train Epoch: 11 [89/250 11392/32000 (36%)] Loss: 5.81486 (QuantReg: 12.54550) QuantErr: 12.54550 batch_time=0.92154 
Train Epoch: 11 [100/250 12800/32000 (40%)] Loss: 6.33022 (QuantReg: 12.10997) QuantErr: 12.10997 batch_time=1.21835 
Train Epoch: 11 [111/250 14208/32000 (44%)] Loss: 4.31568 (QuantReg: 12.54102) QuantErr: 12.54102 batch_time=0.92760 
Train Epoch: 11 [122/250 15616/32000 (49%)] Loss: 5.34693 (QuantReg: 12.24563) QuantErr: 12.24563 batch_time=0.99530 
Train Epoch: 11 [133/250 17024/32000 (53%)] Loss: 4.94030 (QuantReg: 12.55965) QuantErr: 12.55965 batch_time=0.92083 
Train Epoch: 11 [144/250 18432/32000 (58%)] Loss: 4.77627 (QuantReg: 12.80532) QuantErr: 12.80532 batch_time=5.47978 
Train Epoch: 11 [155/250 19840/32000 (62%)] Loss: 4.66894 (QuantReg: 12.38932) QuantErr: 12.38932 batch_time=0.98063 
Train Epoch: 11 [166/250 21248/32000 (66%)] Loss: 4.47154 (QuantReg: 12.45611) QuantErr: 12.45611 batch_time=0.94879 
Train Epoch: 11 [177/250 22656/32000 (71%)] Loss: 4.52229 (QuantReg: 12.46845) QuantErr: 12.46845 batch_time=0.94548 
Train Epoch: 11 [188/250 24064/32000 (75%)] Loss: 5.13164 (QuantReg: 12.50118) QuantErr: 12.50118 batch_time=0.92276 
Train Epoch: 11 [199/250 25472/32000 (80%)] Loss: 3.83352 (QuantReg: 12.54675) QuantErr: 12.54675 batch_time=0.93243 
Train Epoch: 11 [210/250 26880/32000 (84%)] Loss: 4.68174 (QuantReg: 12.73378) QuantErr: 12.73378 batch_time=0.92741 
Train Epoch: 11 [221/250 28288/32000 (88%)] Loss: 4.26513 (QuantReg: 12.75307) QuantErr: 12.75307 batch_time=0.92906 
Train Epoch: 11 [232/250 29696/32000 (93%)] Loss: 4.07984 (QuantReg: 12.59661) QuantErr: 12.59661 batch_time=1.03894 
Train Epoch: 11 [243/250 31104/32000 (97%)] Loss: 4.47629 (QuantReg: 12.57062) QuantErr: 12.57062 batch_time=0.93030 
Train Epoch: 11 codebook_update_time=7.76841
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch11.pth ...
Done in 16.682s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch11.pth ...
Done in 20.571s
removing stale ckpt [epoch 10] [took 0.00s]
 epoch          : 11
 loss           : 4.943440024375915
 quant_reg      : 12.513592372894287
 quant_err      : 12.513592372894287
 learning_rate  : 2.993684696191893e-05
 n_samples      : 352000
 n_steps        : 2750
 MSRVTT_full_val/t2v_metrics/R1: 30.382293762575454
 MSRVTT_full_val/t2v_metrics/R5: 65.99597585513078
 MSRVTT_full_val/t2v_metrics/R10: 78.87323943661971
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.086519114688128
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.07824187804044
 MSRVTT_full_val/v2t_metrics/R1: 35.2112676056338
 MSRVTT_full_val/v2t_metrics/R5: 74.64788732394366
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.935613682092555
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.038485493583515
 MSRVTT_full_test/t2v_metrics/R1: 11.939799331103679
 MSRVTT_full_test/t2v_metrics/R5: 34.147157190635454
 MSRVTT_full_test/t2v_metrics/R10: 46.82274247491639
 MSRVTT_full_test/t2v_metrics/R50: 80.2675585284281
 MSRVTT_full_test/t2v_metrics/MedR: 12.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.276923076923076
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.726134087182814
 MSRVTT_full_test/v2t_metrics/R1: 14.31438127090301
 MSRVTT_full_test/v2t_metrics/R5: 39.63210702341137
 MSRVTT_full_test/v2t_metrics/R10: 55.11705685618729
 MSRVTT_full_test/v2t_metrics/R50: 85.38461538461539
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.558528428093645
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 31.504209531072686
 mnt_best       : 26.726134087182814
 not_improved_count: 0
Train Epoch: 12 [1/250 128/32000 (0%)] Loss: 4.08621 (QuantReg: 12.01544) QuantErr: 12.01544 batch_time=29.62167 
Train Epoch: 12 [12/250 1536/32000 (5%)] Loss: 5.72658 (QuantReg: 12.19113) QuantErr: 12.19113 batch_time=0.93791 
Train Epoch: 12 [23/250 2944/32000 (9%)] Loss: 5.28946 (QuantReg: 12.43170) QuantErr: 12.43170 batch_time=0.97593 
Train Epoch: 12 [34/250 4352/32000 (14%)] Loss: 4.80429 (QuantReg: 12.18436) QuantErr: 12.18436 batch_time=0.94529 
Train Epoch: 12 [45/250 5760/32000 (18%)] Loss: 5.68627 (QuantReg: 12.46093) QuantErr: 12.46093 batch_time=0.96160 
Train Epoch: 12 [56/250 7168/32000 (22%)] Loss: 4.36038 (QuantReg: 12.35120) QuantErr: 12.35120 batch_time=0.96165 
Train Epoch: 12 [67/250 8576/32000 (27%)] Loss: 5.34329 (QuantReg: 12.16811) QuantErr: 12.16811 batch_time=0.94186 
Train Epoch: 12 [78/250 9984/32000 (31%)] Loss: 4.11050 (QuantReg: 12.54319) QuantErr: 12.54319 batch_time=0.92453 
Train Epoch: 12 [89/250 11392/32000 (36%)] Loss: 4.00151 (QuantReg: 12.78749) QuantErr: 12.78749 batch_time=1.47454 
Train Epoch: 12 [100/250 12800/32000 (40%)] Loss: 6.06365 (QuantReg: 12.28859) QuantErr: 12.28859 batch_time=1.79561 
Train Epoch: 12 [111/250 14208/32000 (44%)] Loss: 4.25091 (QuantReg: 12.71080) QuantErr: 12.71080 batch_time=0.95116 
Train Epoch: 12 [122/250 15616/32000 (49%)] Loss: 4.90655 (QuantReg: 12.50045) QuantErr: 12.50045 batch_time=0.90217 
Train Epoch: 12 [133/250 17024/32000 (53%)] Loss: 5.93467 (QuantReg: 12.45353) QuantErr: 12.45353 batch_time=0.92585 
Train Epoch: 12 [144/250 18432/32000 (58%)] Loss: 5.25392 (QuantReg: 12.40184) QuantErr: 12.40184 batch_time=0.93846 
Train Epoch: 12 [155/250 19840/32000 (62%)] Loss: 4.91180 (QuantReg: 12.40241) QuantErr: 12.40241 batch_time=0.94946 
Train Epoch: 12 [166/250 21248/32000 (66%)] Loss: 5.69892 (QuantReg: 12.50576) QuantErr: 12.50576 batch_time=0.92320 
Train Epoch: 12 [177/250 22656/32000 (71%)] Loss: 4.14914 (QuantReg: 12.35705) QuantErr: 12.35705 batch_time=0.94245 
Train Epoch: 12 [188/250 24064/32000 (75%)] Loss: 5.05122 (QuantReg: 12.60361) QuantErr: 12.60361 batch_time=0.91746 
Train Epoch: 12 [199/250 25472/32000 (80%)] Loss: 4.06864 (QuantReg: 12.33344) QuantErr: 12.33344 batch_time=1.05627 
Train Epoch: 12 [210/250 26880/32000 (84%)] Loss: 3.36055 (QuantReg: 12.49888) QuantErr: 12.49888 batch_time=0.93849 
Train Epoch: 12 [221/250 28288/32000 (88%)] Loss: 4.97796 (QuantReg: 12.74389) QuantErr: 12.74389 batch_time=1.56788 
Train Epoch: 12 [232/250 29696/32000 (93%)] Loss: 4.30402 (QuantReg: 12.39863) QuantErr: 12.39863 batch_time=1.16268 
Train Epoch: 12 [243/250 31104/32000 (97%)] Loss: 5.13295 (QuantReg: 12.68499) QuantErr: 12.68499 batch_time=0.95409 
Train Epoch: 12 codebook_update_time=8.97935
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch12.pth ...
Done in 3.985s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch12.pth ...
Done in 8.010s
removing stale ckpt [epoch 11] [took 0.00s]
 epoch          : 12
 loss           : 4.766584445953369
 quant_reg      : 12.486056941986083
 quant_err      : 12.486056941986083
 learning_rate  : 2.844000461382298e-05
 n_samples      : 384000
 n_steps        : 3000
 MSRVTT_full_val/t2v_metrics/R1: 29.175050301810867
 MSRVTT_full_val/t2v_metrics/R5: 64.38631790744466
 MSRVTT_full_val/t2v_metrics/R10: 79.07444668008048
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.29979879275654
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.959895754905
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 74.64788732394366
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.078470824949698
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.527728319862916
 MSRVTT_full_test/t2v_metrics/R1: 11.806020066889632
 MSRVTT_full_test/t2v_metrics/R5: 34.34782608695652
 MSRVTT_full_test/t2v_metrics/R10: 48.22742474916388
 MSRVTT_full_test/t2v_metrics/R50: 79.29765886287625
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.96923076923077
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 26.942151968465247
 MSRVTT_full_test/v2t_metrics/R1: 15.351170568561873
 MSRVTT_full_test/v2t_metrics/R5: 39.197324414715716
 MSRVTT_full_test/v2t_metrics/R10: 54.51505016722408
 MSRVTT_full_test/v2t_metrics/R50: 85.35117056856187
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.206020066889636
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.01140816008145
 mnt_best       : 26.942151968465247
 not_improved_count: 0
Train Epoch: 13 [1/250 128/32000 (0%)] Loss: 5.53858 (QuantReg: 12.25043) QuantErr: 12.25043 batch_time=36.79826 
Train Epoch: 13 [12/250 1536/32000 (5%)] Loss: 5.57314 (QuantReg: 12.05701) QuantErr: 12.05701 batch_time=1.04553 
Train Epoch: 13 [23/250 2944/32000 (9%)] Loss: 4.74559 (QuantReg: 12.25715) QuantErr: 12.25715 batch_time=0.91552 
Train Epoch: 13 [34/250 4352/32000 (14%)] Loss: 5.04068 (QuantReg: 12.31306) QuantErr: 12.31306 batch_time=0.95057 
Train Epoch: 13 [45/250 5760/32000 (18%)] Loss: 6.43007 (QuantReg: 11.94934) QuantErr: 11.94934 batch_time=0.95062 
Train Epoch: 13 [56/250 7168/32000 (22%)] Loss: 5.74033 (QuantReg: 12.41300) QuantErr: 12.41300 batch_time=0.92066 
Train Epoch: 13 [67/250 8576/32000 (27%)] Loss: 4.29965 (QuantReg: 12.39179) QuantErr: 12.39179 batch_time=1.81990 
Train Epoch: 13 [78/250 9984/32000 (31%)] Loss: 5.57928 (QuantReg: 12.81143) QuantErr: 12.81143 batch_time=0.92856 
Train Epoch: 13 [89/250 11392/32000 (36%)] Loss: 4.56147 (QuantReg: 12.68671) QuantErr: 12.68671 batch_time=1.02574 
Train Epoch: 13 [100/250 12800/32000 (40%)] Loss: 4.63700 (QuantReg: 12.54486) QuantErr: 12.54486 batch_time=0.99597 
Train Epoch: 13 [111/250 14208/32000 (44%)] Loss: 6.18089 (QuantReg: 12.62291) QuantErr: 12.62291 batch_time=0.93095 
Train Epoch: 13 [122/250 15616/32000 (49%)] Loss: 5.07045 (QuantReg: 12.60911) QuantErr: 12.60911 batch_time=0.94468 
Train Epoch: 13 [133/250 17024/32000 (53%)] Loss: 3.87768 (QuantReg: 12.49783) QuantErr: 12.49783 batch_time=0.93994 
Train Epoch: 13 [144/250 18432/32000 (58%)] Loss: 5.22709 (QuantReg: 12.42730) QuantErr: 12.42730 batch_time=0.92912 
Train Epoch: 13 [155/250 19840/32000 (62%)] Loss: 3.85152 (QuantReg: 12.69192) QuantErr: 12.69192 batch_time=0.93936 
Train Epoch: 13 [166/250 21248/32000 (66%)] Loss: 4.80758 (QuantReg: 12.61007) QuantErr: 12.61007 batch_time=0.92154 
Train Epoch: 13 [177/250 22656/32000 (71%)] Loss: 4.34170 (QuantReg: 12.69626) QuantErr: 12.69626 batch_time=0.93024 
Train Epoch: 13 [188/250 24064/32000 (75%)] Loss: 3.64123 (QuantReg: 12.54328) QuantErr: 12.54328 batch_time=0.95060 
Train Epoch: 13 [199/250 25472/32000 (80%)] Loss: 3.75914 (QuantReg: 12.90935) QuantErr: 12.90935 batch_time=3.45386 
Train Epoch: 13 [210/250 26880/32000 (84%)] Loss: 5.67845 (QuantReg: 12.66538) QuantErr: 12.66538 batch_time=0.94843 
Train Epoch: 13 [221/250 28288/32000 (88%)] Loss: 4.94301 (QuantReg: 12.56732) QuantErr: 12.56732 batch_time=0.92391 
Train Epoch: 13 [232/250 29696/32000 (93%)] Loss: 4.32036 (QuantReg: 12.77960) QuantErr: 12.77960 batch_time=0.95530 
Train Epoch: 13 [243/250 31104/32000 (97%)] Loss: 4.40297 (QuantReg: 12.95953) QuantErr: 12.95953 batch_time=0.91891 
Train Epoch: 13 codebook_update_time=8.39343
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch13.pth ...
Done in 3.961s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch13.pth ...
Done in 7.969s
removing stale ckpt [epoch 12] [took 0.00s]
 epoch          : 13
 loss           : 4.597233952522278
 quant_reg      : 12.57221310043335
 quant_err      : 12.57221310043335
 learning_rate  : 2.7018004383131832e-05
 n_samples      : 416000
 n_steps        : 3250
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 66.19718309859155
 MSRVTT_full_val/t2v_metrics/R10: 79.67806841046277
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.3158953722334
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.71038405742207
 MSRVTT_full_val/v2t_metrics/R1: 35.010060362173036
 MSRVTT_full_val/v2t_metrics/R5: 74.44668008048289
 MSRVTT_full_val/v2t_metrics/R10: 86.9215291750503
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.217303822937626
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.961435393985035
 MSRVTT_full_test/t2v_metrics/R1: 12.073578595317725
 MSRVTT_full_test/t2v_metrics/R5: 34.280936454849495
 MSRVTT_full_test/t2v_metrics/R10: 48.16053511705686
 MSRVTT_full_test/t2v_metrics/R50: 80.2675585284281
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.71438127090301
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.113983752518088
 MSRVTT_full_test/v2t_metrics/R1: 14.949832775919733
 MSRVTT_full_test/v2t_metrics/R5: 40.936454849498325
 MSRVTT_full_test/v2t_metrics/R10: 54.74916387959866
 MSRVTT_full_test/v2t_metrics/R50: 85.88628762541806
 MSRVTT_full_test/v2t_metrics/MedR: 9.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.39397993311037
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.238489494147835
 mnt_best       : 27.113983752518088
 not_improved_count: 0
Train Epoch: 14 [1/250 128/32000 (0%)] Loss: 4.18321 (QuantReg: 12.61503) QuantErr: 12.61503 batch_time=30.70846 
Train Epoch: 14 [12/250 1536/32000 (5%)] Loss: 4.34374 (QuantReg: 12.55787) QuantErr: 12.55787 batch_time=0.93159 
Train Epoch: 14 [23/250 2944/32000 (9%)] Loss: 5.53234 (QuantReg: 12.57137) QuantErr: 12.57137 batch_time=0.96716 
Train Epoch: 14 [34/250 4352/32000 (14%)] Loss: 4.07511 (QuantReg: 12.52374) QuantErr: 12.52374 batch_time=0.94863 
Train Epoch: 14 [45/250 5760/32000 (18%)] Loss: 5.25944 (QuantReg: 12.53706) QuantErr: 12.53706 batch_time=0.93494 
Train Epoch: 14 [56/250 7168/32000 (22%)] Loss: 3.98499 (QuantReg: 12.85023) QuantErr: 12.85023 batch_time=0.98985 
Train Epoch: 14 [67/250 8576/32000 (27%)] Loss: 4.06028 (QuantReg: 12.60535) QuantErr: 12.60535 batch_time=0.92848 
Train Epoch: 14 [78/250 9984/32000 (31%)] Loss: 4.89611 (QuantReg: 12.53024) QuantErr: 12.53024 batch_time=0.95794 
Train Epoch: 14 [89/250 11392/32000 (36%)] Loss: 4.51865 (QuantReg: 12.58549) QuantErr: 12.58549 batch_time=0.95298 
Train Epoch: 14 [100/250 12800/32000 (40%)] Loss: 4.01629 (QuantReg: 12.55242) QuantErr: 12.55242 batch_time=0.95371 
Train Epoch: 14 [111/250 14208/32000 (44%)] Loss: 4.51318 (QuantReg: 12.91124) QuantErr: 12.91124 batch_time=0.96216 
Train Epoch: 14 [122/250 15616/32000 (49%)] Loss: 4.73008 (QuantReg: 12.79242) QuantErr: 12.79242 batch_time=0.91277 
Train Epoch: 14 [133/250 17024/32000 (53%)] Loss: 4.21684 (QuantReg: 12.79474) QuantErr: 12.79474 batch_time=0.93477 
Train Epoch: 14 [144/250 18432/32000 (58%)] Loss: 3.77348 (QuantReg: 12.72577) QuantErr: 12.72577 batch_time=1.29397 
Train Epoch: 14 [155/250 19840/32000 (62%)] Loss: 4.18338 (QuantReg: 12.60168) QuantErr: 12.60168 batch_time=0.92915 
Train Epoch: 14 [166/250 21248/32000 (66%)] Loss: 4.93646 (QuantReg: 12.55016) QuantErr: 12.55016 batch_time=0.95854 
Train Epoch: 14 [177/250 22656/32000 (71%)] Loss: 5.80845 (QuantReg: 12.64253) QuantErr: 12.64253 batch_time=0.94810 
Train Epoch: 14 [188/250 24064/32000 (75%)] Loss: 3.74870 (QuantReg: 12.69537) QuantErr: 12.69537 batch_time=0.94096 
Train Epoch: 14 [199/250 25472/32000 (80%)] Loss: 4.87714 (QuantReg: 12.90978) QuantErr: 12.90978 batch_time=0.95843 
Train Epoch: 14 [210/250 26880/32000 (84%)] Loss: 4.62157 (QuantReg: 13.14879) QuantErr: 13.14879 batch_time=1.05123 
Train Epoch: 14 [221/250 28288/32000 (88%)] Loss: 3.88547 (QuantReg: 12.69516) QuantErr: 12.69516 batch_time=0.99425 
Train Epoch: 14 [232/250 29696/32000 (93%)] Loss: 3.87122 (QuantReg: 12.85442) QuantErr: 12.85442 batch_time=1.07072 
Train Epoch: 14 [243/250 31104/32000 (97%)] Loss: 4.73973 (QuantReg: 12.64051) QuantErr: 12.64051 batch_time=0.98269 
Train Epoch: 14 codebook_update_time=8.55275
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch14.pth ...
Done in 4.946s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch14.pth ...
Done in 9.734s
removing stale ckpt [epoch 13] [took 0.01s]
 epoch          : 14
 loss           : 4.351657031059265
 quant_reg      : 12.674668968200683
 quant_err      : 12.674668968200683
 learning_rate  : 2.566710416397524e-05
 n_samples      : 448000
 n_steps        : 3500
 MSRVTT_full_val/t2v_metrics/R1: 29.979879275653925
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.501006036217304
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.97470934587136
 MSRVTT_full_val/v2t_metrics/R1: 35.010060362173036
 MSRVTT_full_val/v2t_metrics/R5: 75.25150905432595
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.0241448692152915
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.13308580383543
 MSRVTT_full_test/t2v_metrics/R1: 12.341137123745819
 MSRVTT_full_test/t2v_metrics/R5: 35.51839464882943
 MSRVTT_full_test/t2v_metrics/R10: 49.46488294314381
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.592976588628765
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.884861856553243
 MSRVTT_full_test/v2t_metrics/R1: 14.882943143812708
 MSRVTT_full_test/v2t_metrics/R5: 41.83946488294314
 MSRVTT_full_test/v2t_metrics/R10: 57.391304347826086
 MSRVTT_full_test/v2t_metrics/R50: 86.32107023411372
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.680602006688964
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 32.938742344533715
 mnt_best       : 27.884861856553243
 not_improved_count: 0
Train Epoch: 15 [1/250 128/32000 (0%)] Loss: 5.04878 (QuantReg: 12.50628) QuantErr: 12.50628 batch_time=31.98899 
Train Epoch: 15 [12/250 1536/32000 (5%)] Loss: 3.57446 (QuantReg: 12.54799) QuantErr: 12.54799 batch_time=0.97522 
Train Epoch: 15 [23/250 2944/32000 (9%)] Loss: 4.64760 (QuantReg: 11.79791) QuantErr: 11.79791 batch_time=0.95307 
Train Epoch: 15 [34/250 4352/32000 (14%)] Loss: 4.00087 (QuantReg: 12.48689) QuantErr: 12.48689 batch_time=0.98661 
Train Epoch: 15 [45/250 5760/32000 (18%)] Loss: 4.45568 (QuantReg: 12.49492) QuantErr: 12.49492 batch_time=1.90651 
Train Epoch: 15 [56/250 7168/32000 (22%)] Loss: 3.98762 (QuantReg: 12.49505) QuantErr: 12.49505 batch_time=0.95453 
Train Epoch: 15 [67/250 8576/32000 (27%)] Loss: 4.98318 (QuantReg: 12.32763) QuantErr: 12.32763 batch_time=1.91488 
Train Epoch: 15 [78/250 9984/32000 (31%)] Loss: 3.38377 (QuantReg: 12.49215) QuantErr: 12.49215 batch_time=0.93000 
Train Epoch: 15 [89/250 11392/32000 (36%)] Loss: 4.21686 (QuantReg: 12.72703) QuantErr: 12.72703 batch_time=0.99162 
Train Epoch: 15 [100/250 12800/32000 (40%)] Loss: 3.86768 (QuantReg: 12.75177) QuantErr: 12.75177 batch_time=1.29674 
Train Epoch: 15 [111/250 14208/32000 (44%)] Loss: 4.88497 (QuantReg: 12.40245) QuantErr: 12.40245 batch_time=1.00068 
Train Epoch: 15 [122/250 15616/32000 (49%)] Loss: 4.59677 (QuantReg: 12.58688) QuantErr: 12.58688 batch_time=0.92120 
Train Epoch: 15 [133/250 17024/32000 (53%)] Loss: 4.41302 (QuantReg: 12.33710) QuantErr: 12.33710 batch_time=0.92702 
Train Epoch: 15 [144/250 18432/32000 (58%)] Loss: 4.13455 (QuantReg: 12.83620) QuantErr: 12.83620 batch_time=1.04996 
Train Epoch: 15 [155/250 19840/32000 (62%)] Loss: 4.83016 (QuantReg: 12.63107) QuantErr: 12.63107 batch_time=0.94107 
Train Epoch: 15 [166/250 21248/32000 (66%)] Loss: 4.17596 (QuantReg: 12.89760) QuantErr: 12.89760 batch_time=0.91952 
Train Epoch: 15 [177/250 22656/32000 (71%)] Loss: 3.65632 (QuantReg: 12.65151) QuantErr: 12.65151 batch_time=0.95254 
Train Epoch: 15 [188/250 24064/32000 (75%)] Loss: 3.83211 (QuantReg: 12.45059) QuantErr: 12.45059 batch_time=0.93109 
Train Epoch: 15 [199/250 25472/32000 (80%)] Loss: 3.72594 (QuantReg: 12.68264) QuantErr: 12.68264 batch_time=1.01194 
Train Epoch: 15 [210/250 26880/32000 (84%)] Loss: 4.72612 (QuantReg: 12.62761) QuantErr: 12.62761 batch_time=0.95113 
Train Epoch: 15 [221/250 28288/32000 (88%)] Loss: 5.14468 (QuantReg: 12.77897) QuantErr: 12.77897 batch_time=0.95056 
Train Epoch: 15 [232/250 29696/32000 (93%)] Loss: 4.37039 (QuantReg: 12.59895) QuantErr: 12.59895 batch_time=0.92612 
Train Epoch: 15 [243/250 31104/32000 (97%)] Loss: 4.38240 (QuantReg: 12.56903) QuantErr: 12.56903 batch_time=0.92823 
Train Epoch: 15 codebook_update_time=9.23750
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch15.pth ...
Done in 15.236s
removing stale ckpt [epoch 14] [took 0.00s]
 epoch          : 15
 loss           : 4.252684841156006
 quant_reg      : 12.622312129974365
 quant_err      : 12.622312129974365
 learning_rate  : 2.4383748955776477e-05
 n_samples      : 480000
 n_steps        : 3750
 MSRVTT_full_val/t2v_metrics/R1: 27.96780684104628
 MSRVTT_full_val/t2v_metrics/R5: 66.59959758551308
 MSRVTT_full_val/t2v_metrics/R10: 79.27565392354124
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 8.096579476861166
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 52.85547132455175
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.993963782696177
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.45894035270576
 MSRVTT_full_test/t2v_metrics/R1: 11.906354515050166
 MSRVTT_full_test/t2v_metrics/R5: 34.214046822742475
 MSRVTT_full_test/t2v_metrics/R10: 48.59531772575251
 MSRVTT_full_test/t2v_metrics/R50: 80.03344481605352
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.044147157190636
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.05157528734823
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 42.14046822742475
 MSRVTT_full_test/v2t_metrics/R10: 57.02341137123746
 MSRVTT_full_test/v2t_metrics/R50: 86.5551839464883
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.485117056856186
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.694791400629946
 mnt_best       : 27.884861856553243
 not_improved_count: 1
Train Epoch: 16 [1/250 128/32000 (0%)] Loss: 4.38533 (QuantReg: 12.47542) QuantErr: 12.47542 batch_time=36.75075 
Train Epoch: 16 [12/250 1536/32000 (5%)] Loss: 4.23688 (QuantReg: 12.86983) QuantErr: 12.86983 batch_time=0.92853 
Train Epoch: 16 [23/250 2944/32000 (9%)] Loss: 3.85463 (QuantReg: 12.90968) QuantErr: 12.90968 batch_time=0.92891 
Train Epoch: 16 [34/250 4352/32000 (14%)] Loss: 5.24055 (QuantReg: 12.81469) QuantErr: 12.81469 batch_time=0.96439 
Train Epoch: 16 [45/250 5760/32000 (18%)] Loss: 3.94253 (QuantReg: 12.62079) QuantErr: 12.62079 batch_time=1.84470 
Train Epoch: 16 [56/250 7168/32000 (22%)] Loss: 3.63759 (QuantReg: 12.27432) QuantErr: 12.27432 batch_time=0.92137 
Train Epoch: 16 [67/250 8576/32000 (27%)] Loss: 4.14551 (QuantReg: 12.39750) QuantErr: 12.39750 batch_time=1.98149 
Train Epoch: 16 [78/250 9984/32000 (31%)] Loss: 4.51358 (QuantReg: 12.75402) QuantErr: 12.75402 batch_time=0.92083 
Train Epoch: 16 [89/250 11392/32000 (36%)] Loss: 4.58281 (QuantReg: 12.61043) QuantErr: 12.61043 batch_time=1.04444 
Train Epoch: 16 [100/250 12800/32000 (40%)] Loss: 4.32268 (QuantReg: 12.72257) QuantErr: 12.72257 batch_time=1.04154 
Train Epoch: 16 [111/250 14208/32000 (44%)] Loss: 3.62434 (QuantReg: 12.61290) QuantErr: 12.61290 batch_time=0.92715 
Train Epoch: 16 [122/250 15616/32000 (49%)] Loss: 3.55011 (QuantReg: 12.42358) QuantErr: 12.42358 batch_time=0.92967 
Train Epoch: 16 [133/250 17024/32000 (53%)] Loss: 3.75896 (QuantReg: 12.80694) QuantErr: 12.80694 batch_time=0.95547 
Train Epoch: 16 [144/250 18432/32000 (58%)] Loss: 5.14516 (QuantReg: 12.97779) QuantErr: 12.97779 batch_time=0.95320 
Train Epoch: 16 [155/250 19840/32000 (62%)] Loss: 4.06629 (QuantReg: 12.55417) QuantErr: 12.55417 batch_time=0.93212 
Train Epoch: 16 [166/250 21248/32000 (66%)] Loss: 4.41060 (QuantReg: 12.77167) QuantErr: 12.77167 batch_time=0.96939 
Train Epoch: 16 [177/250 22656/32000 (71%)] Loss: 4.54973 (QuantReg: 12.68207) QuantErr: 12.68207 batch_time=0.94033 
Train Epoch: 16 [188/250 24064/32000 (75%)] Loss: 3.15169 (QuantReg: 12.88434) QuantErr: 12.88434 batch_time=0.93124 
Train Epoch: 16 [199/250 25472/32000 (80%)] Loss: 4.43798 (QuantReg: 12.33115) QuantErr: 12.33115 batch_time=0.95049 
Train Epoch: 16 [210/250 26880/32000 (84%)] Loss: 4.37160 (QuantReg: 12.87648) QuantErr: 12.87648 batch_time=0.96055 
Train Epoch: 16 [221/250 28288/32000 (88%)] Loss: 4.16061 (QuantReg: 12.83267) QuantErr: 12.83267 batch_time=0.95193 
Train Epoch: 16 [232/250 29696/32000 (93%)] Loss: 4.60766 (QuantReg: 12.78283) QuantErr: 12.78283 batch_time=1.06864 
Train Epoch: 16 [243/250 31104/32000 (97%)] Loss: 4.33113 (QuantReg: 12.88875) QuantErr: 12.88875 batch_time=0.94088 
Train Epoch: 16 codebook_update_time=9.59690
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch16.pth ...
Done in 3.822s
removing stale ckpt [epoch 15] [took 0.00s]
 epoch          : 16
 loss           : 4.113813541412354
 quant_reg      : 12.70399532699585
 quant_err      : 12.70399532699585
 learning_rate  : 2.3164561507987653e-05
 n_samples      : 512000
 n_steps        : 4000
 MSRVTT_full_val/t2v_metrics/R1: 27.16297786720322
 MSRVTT_full_val/t2v_metrics/R5: 65.79476861167002
 MSRVTT_full_val/t2v_metrics/R10: 78.47082494969818
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.9959758551307845
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 51.95479720652131
 MSRVTT_full_val/v2t_metrics/R1: 34.40643863179074
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.3279678068410465
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.840729802105336
 MSRVTT_full_test/t2v_metrics/R1: 12.675585284280936
 MSRVTT_full_test/t2v_metrics/R5: 34.34782608695652
 MSRVTT_full_test/t2v_metrics/R10: 48.52842809364549
 MSRVTT_full_test/t2v_metrics/R50: 80.8361204013378
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.72675585284281
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.645291078829615
 MSRVTT_full_test/v2t_metrics/R1: 16.08695652173913
 MSRVTT_full_test/v2t_metrics/R5: 41.83946488294314
 MSRVTT_full_test/v2t_metrics/R10: 56.15384615384615
 MSRVTT_full_test/v2t_metrics/R50: 86.92307692307692
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.53026755852843
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.559321554130946
 mnt_best       : 27.884861856553243
 not_improved_count: 2
Train Epoch: 17 [1/250 128/32000 (0%)] Loss: 4.98982 (QuantReg: 12.91924) QuantErr: 12.91924 batch_time=33.42841 
Train Epoch: 17 [12/250 1536/32000 (5%)] Loss: 4.26381 (QuantReg: 13.02545) QuantErr: 13.02545 batch_time=0.98347 
Train Epoch: 17 [23/250 2944/32000 (9%)] Loss: 3.48799 (QuantReg: 12.89863) QuantErr: 12.89863 batch_time=0.92193 
Train Epoch: 17 [34/250 4352/32000 (14%)] Loss: 4.47218 (QuantReg: 12.86046) QuantErr: 12.86046 batch_time=0.91835 
Train Epoch: 17 [45/250 5760/32000 (18%)] Loss: 3.08608 (QuantReg: 12.93642) QuantErr: 12.93642 batch_time=0.94048 
Train Epoch: 17 [56/250 7168/32000 (22%)] Loss: 3.68380 (QuantReg: 12.46737) QuantErr: 12.46737 batch_time=1.01072 
Train Epoch: 17 [67/250 8576/32000 (27%)] Loss: 4.55132 (QuantReg: 13.03659) QuantErr: 13.03659 batch_time=0.95153 
Train Epoch: 17 [78/250 9984/32000 (31%)] Loss: 3.44238 (QuantReg: 12.88462) QuantErr: 12.88462 batch_time=0.99873 
Train Epoch: 17 [89/250 11392/32000 (36%)] Loss: 4.11481 (QuantReg: 12.96169) QuantErr: 12.96169 batch_time=0.93979 
Train Epoch: 17 [100/250 12800/32000 (40%)] Loss: 4.26921 (QuantReg: 12.49807) QuantErr: 12.49807 batch_time=0.97179 
Train Epoch: 17 [111/250 14208/32000 (44%)] Loss: 4.86104 (QuantReg: 12.82253) QuantErr: 12.82253 batch_time=0.94141 
Train Epoch: 17 [122/250 15616/32000 (49%)] Loss: 4.66301 (QuantReg: 12.45703) QuantErr: 12.45703 batch_time=0.93981 
Train Epoch: 17 [133/250 17024/32000 (53%)] Loss: 3.58271 (QuantReg: 12.70834) QuantErr: 12.70834 batch_time=0.96333 
Train Epoch: 17 [144/250 18432/32000 (58%)] Loss: 4.49766 (QuantReg: 12.90314) QuantErr: 12.90314 batch_time=2.63496 
Train Epoch: 17 [155/250 19840/32000 (62%)] Loss: 4.05312 (QuantReg: 12.81486) QuantErr: 12.81486 batch_time=0.94861 
Train Epoch: 17 [166/250 21248/32000 (66%)] Loss: 4.31077 (QuantReg: 12.78682) QuantErr: 12.78682 batch_time=0.93505 
Train Epoch: 17 [177/250 22656/32000 (71%)] Loss: 4.73663 (QuantReg: 13.05433) QuantErr: 13.05433 batch_time=0.95151 
Train Epoch: 17 [188/250 24064/32000 (75%)] Loss: 3.61839 (QuantReg: 13.08511) QuantErr: 13.08511 batch_time=0.92651 
Train Epoch: 17 [199/250 25472/32000 (80%)] Loss: 3.90172 (QuantReg: 12.92913) QuantErr: 12.92913 batch_time=0.92581 
Train Epoch: 17 [210/250 26880/32000 (84%)] Loss: 3.90163 (QuantReg: 12.58038) QuantErr: 12.58038 batch_time=0.95009 
Train Epoch: 17 [221/250 28288/32000 (88%)] Loss: 3.47101 (QuantReg: 12.72636) QuantErr: 12.72636 batch_time=0.92276 
Train Epoch: 17 [232/250 29696/32000 (93%)] Loss: 3.93036 (QuantReg: 12.42551) QuantErr: 12.42551 batch_time=0.94633 
Train Epoch: 17 [243/250 31104/32000 (97%)] Loss: 3.90058 (QuantReg: 12.49442) QuantErr: 12.49442 batch_time=0.93115 
Train Epoch: 17 codebook_update_time=8.68438
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch17.pth ...
Done in 3.883s
removing stale ckpt [epoch 16] [took 0.48s]
 epoch          : 17
 loss           : 4.021026626586914
 quant_reg      : 12.773777183532715
 quant_err      : 12.773777183532715
 learning_rate  : 2.2006333432588268e-05
 n_samples      : 544000
 n_steps        : 4250
 MSRVTT_full_val/t2v_metrics/R1: 27.96780684104628
 MSRVTT_full_val/t2v_metrics/R5: 67.20321931589537
 MSRVTT_full_val/t2v_metrics/R10: 79.87927565392354
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.712273641851106
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.14889045404347
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 75.0503018108652
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.156941649899396
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.98244622342173
 MSRVTT_full_test/t2v_metrics/R1: 12.54180602006689
 MSRVTT_full_test/t2v_metrics/R5: 35.18394648829432
 MSRVTT_full_test/t2v_metrics/R10: 49.130434782608695
 MSRVTT_full_test/t2v_metrics/R50: 81.23745819397993
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.54916387959866
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.883786329254583
 MSRVTT_full_test/v2t_metrics/R1: 15.986622073578594
 MSRVTT_full_test/v2t_metrics/R5: 41.90635451505017
 MSRVTT_full_test/v2t_metrics/R10: 56.78929765886288
 MSRVTT_full_test/v2t_metrics/R50: 86.22073578595318
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.904347826086955
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.63316177007631
 mnt_best       : 27.884861856553243
 not_improved_count: 3
Train Epoch: 18 [1/250 128/32000 (0%)] Loss: 3.82512 (QuantReg: 12.60530) QuantErr: 12.60530 batch_time=31.06735 
Train Epoch: 18 [12/250 1536/32000 (5%)] Loss: 4.21245 (QuantReg: 12.74754) QuantErr: 12.74754 batch_time=0.92933 
Train Epoch: 18 [23/250 2944/32000 (9%)] Loss: 3.97261 (QuantReg: 12.73460) QuantErr: 12.73460 batch_time=0.92180 
Train Epoch: 18 [34/250 4352/32000 (14%)] Loss: 3.87682 (QuantReg: 12.81400) QuantErr: 12.81400 batch_time=0.92870 
Train Epoch: 18 [45/250 5760/32000 (18%)] Loss: 3.65200 (QuantReg: 12.46784) QuantErr: 12.46784 batch_time=0.95304 
Train Epoch: 18 [56/250 7168/32000 (22%)] Loss: 3.73878 (QuantReg: 12.59278) QuantErr: 12.59278 batch_time=0.95700 
Train Epoch: 18 [67/250 8576/32000 (27%)] Loss: 4.18786 (QuantReg: 12.99805) QuantErr: 12.99805 batch_time=0.96184 
Train Epoch: 18 [78/250 9984/32000 (31%)] Loss: 4.61289 (QuantReg: 12.53920) QuantErr: 12.53920 batch_time=1.01082 
Train Epoch: 18 [89/250 11392/32000 (36%)] Loss: 5.17442 (QuantReg: 12.78419) QuantErr: 12.78419 batch_time=0.92253 
Train Epoch: 18 [100/250 12800/32000 (40%)] Loss: 3.41785 (QuantReg: 12.76656) QuantErr: 12.76656 batch_time=0.94731 
Train Epoch: 18 [111/250 14208/32000 (44%)] Loss: 2.67927 (QuantReg: 13.04296) QuantErr: 13.04296 batch_time=0.93517 
Train Epoch: 18 [122/250 15616/32000 (49%)] Loss: 3.33447 (QuantReg: 12.98791) QuantErr: 12.98791 batch_time=0.94945 
Train Epoch: 18 [133/250 17024/32000 (53%)] Loss: 3.43512 (QuantReg: 12.89799) QuantErr: 12.89799 batch_time=0.94600 
Train Epoch: 18 [144/250 18432/32000 (58%)] Loss: 3.79219 (QuantReg: 12.83181) QuantErr: 12.83181 batch_time=0.95903 
Train Epoch: 18 [155/250 19840/32000 (62%)] Loss: 3.65642 (QuantReg: 13.46593) QuantErr: 13.46593 batch_time=0.95801 
Train Epoch: 18 [166/250 21248/32000 (66%)] Loss: 3.96074 (QuantReg: 13.31793) QuantErr: 13.31793 batch_time=0.94579 
Train Epoch: 18 [177/250 22656/32000 (71%)] Loss: 3.38765 (QuantReg: 12.98720) QuantErr: 12.98720 batch_time=0.94913 
Train Epoch: 18 [188/250 24064/32000 (75%)] Loss: 4.18513 (QuantReg: 12.95601) QuantErr: 12.95601 batch_time=0.95240 
Train Epoch: 18 [199/250 25472/32000 (80%)] Loss: 3.54855 (QuantReg: 13.13257) QuantErr: 13.13257 batch_time=0.94141 
Train Epoch: 18 [210/250 26880/32000 (84%)] Loss: 3.53273 (QuantReg: 12.64712) QuantErr: 12.64712 batch_time=0.93804 
Train Epoch: 18 [221/250 28288/32000 (88%)] Loss: 3.77021 (QuantReg: 12.73597) QuantErr: 12.73597 batch_time=0.92394 
Train Epoch: 18 [232/250 29696/32000 (93%)] Loss: 3.08582 (QuantReg: 12.88315) QuantErr: 12.88315 batch_time=0.96541 
Train Epoch: 18 [243/250 31104/32000 (97%)] Loss: 4.91593 (QuantReg: 13.03733) QuantErr: 13.03733 batch_time=0.95443 
Train Epoch: 18 codebook_update_time=9.54820
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch18.pth ...
Done in 4.016s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch18.pth ...
Done in 8.497s
removing stale ckpt [epoch 17] [took 0.00s]
 epoch          : 18
 loss           : 3.8507603902816774
 quant_reg      : 12.822002834320068
 quant_err      : 12.822002834320068
 learning_rate  : 2.0906016760958855e-05
 n_samples      : 576000
 n_steps        : 4500
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 67.80684104627767
 MSRVTT_full_val/t2v_metrics/R10: 80.48289738430583
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.400402414486922
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.3554744145301
 MSRVTT_full_val/v2t_metrics/R1: 36.82092555331992
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.169014084507042
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.51259480684894
 MSRVTT_full_test/t2v_metrics/R1: 12.207357859531772
 MSRVTT_full_test/t2v_metrics/R5: 36.05351170568562
 MSRVTT_full_test/t2v_metrics/R10: 49.531772575250834
 MSRVTT_full_test/t2v_metrics/R50: 81.23745819397993
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.92809364548495
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.935152054306
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 42.608695652173914
 MSRVTT_full_test/v2t_metrics/R10: 57.123745819397996
 MSRVTT_full_test/v2t_metrics/R50: 86.22073578595318
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.89598662207358
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.83895119404808
 mnt_best       : 27.935152054306
 not_improved_count: 0
Train Epoch: 19 [1/250 128/32000 (0%)] Loss: 4.62854 (QuantReg: 12.56827) QuantErr: 12.56827 batch_time=33.14945 
Train Epoch: 19 [12/250 1536/32000 (5%)] Loss: 4.27893 (QuantReg: 12.67712) QuantErr: 12.67712 batch_time=0.92942 
Train Epoch: 19 [23/250 2944/32000 (9%)] Loss: 3.15922 (QuantReg: 12.70597) QuantErr: 12.70597 batch_time=0.96143 
Train Epoch: 19 [34/250 4352/32000 (14%)] Loss: 3.85949 (QuantReg: 12.39749) QuantErr: 12.39749 batch_time=0.93549 
Train Epoch: 19 [45/250 5760/32000 (18%)] Loss: 2.72185 (QuantReg: 12.76342) QuantErr: 12.76342 batch_time=2.54290 
Train Epoch: 19 [56/250 7168/32000 (22%)] Loss: 4.55761 (QuantReg: 12.45591) QuantErr: 12.45591 batch_time=1.22216 
Train Epoch: 19 [67/250 8576/32000 (27%)] Loss: 4.08066 (QuantReg: 12.80852) QuantErr: 12.80852 batch_time=1.07232 
Train Epoch: 19 [78/250 9984/32000 (31%)] Loss: 4.06299 (QuantReg: 12.65780) QuantErr: 12.65780 batch_time=0.95164 
Train Epoch: 19 [89/250 11392/32000 (36%)] Loss: 4.61293 (QuantReg: 12.55409) QuantErr: 12.55409 batch_time=0.95091 
Train Epoch: 19 [100/250 12800/32000 (40%)] Loss: 3.93526 (QuantReg: 12.40187) QuantErr: 12.40187 batch_time=0.94364 
Train Epoch: 19 [111/250 14208/32000 (44%)] Loss: 3.85299 (QuantReg: 12.80269) QuantErr: 12.80269 batch_time=0.94375 
Train Epoch: 19 [122/250 15616/32000 (49%)] Loss: 3.01135 (QuantReg: 13.01389) QuantErr: 13.01389 batch_time=0.95929 
Train Epoch: 19 [133/250 17024/32000 (53%)] Loss: 3.72941 (QuantReg: 13.16416) QuantErr: 13.16416 batch_time=0.92745 
Train Epoch: 19 [144/250 18432/32000 (58%)] Loss: 4.08664 (QuantReg: 12.88891) QuantErr: 12.88891 batch_time=0.92451 
Train Epoch: 19 [155/250 19840/32000 (62%)] Loss: 3.00921 (QuantReg: 12.82633) QuantErr: 12.82633 batch_time=1.02233 
Train Epoch: 19 [166/250 21248/32000 (66%)] Loss: 3.51037 (QuantReg: 12.89668) QuantErr: 12.89668 batch_time=1.03670 
Train Epoch: 19 [177/250 22656/32000 (71%)] Loss: 4.28559 (QuantReg: 12.81068) QuantErr: 12.81068 batch_time=0.93962 
Train Epoch: 19 [188/250 24064/32000 (75%)] Loss: 3.37184 (QuantReg: 12.97750) QuantErr: 12.97750 batch_time=0.95222 
Train Epoch: 19 [199/250 25472/32000 (80%)] Loss: 3.99455 (QuantReg: 12.68724) QuantErr: 12.68724 batch_time=0.96215 
Train Epoch: 19 [210/250 26880/32000 (84%)] Loss: 3.40080 (QuantReg: 13.01310) QuantErr: 13.01310 batch_time=1.05122 
Train Epoch: 19 [221/250 28288/32000 (88%)] Loss: 3.41675 (QuantReg: 12.90841) QuantErr: 12.90841 batch_time=0.93504 
Train Epoch: 19 [232/250 29696/32000 (93%)] Loss: 3.32939 (QuantReg: 12.72559) QuantErr: 12.72559 batch_time=0.94342 
Train Epoch: 19 [243/250 31104/32000 (97%)] Loss: 3.40739 (QuantReg: 12.76598) QuantErr: 12.76598 batch_time=0.94704 
Train Epoch: 19 codebook_update_time=10.05653
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch19.pth ...
Done in 4.089s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch19.pth ...
Done in 7.940s
removing stale ckpt [epoch 18] [took 0.00s]
 epoch          : 19
 loss           : 3.723693396568298
 quant_reg      : 12.79081021118164
 quant_err      : 12.79081021118164
 learning_rate  : 1.986071592291091e-05
 n_samples      : 608000
 n_steps        : 4750
 MSRVTT_full_val/t2v_metrics/R1: 29.577464788732396
 MSRVTT_full_val/t2v_metrics/R5: 67.00201207243461
 MSRVTT_full_val/t2v_metrics/R10: 79.87927565392354
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.4325955734406435
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.095478863720416
 MSRVTT_full_val/v2t_metrics/R1: 34.80885311871227
 MSRVTT_full_val/v2t_metrics/R5: 74.64788732394366
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 6.0523138832997985
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 60.75789414603149
 MSRVTT_full_test/t2v_metrics/R1: 12.74247491638796
 MSRVTT_full_test/t2v_metrics/R5: 35.618729096989966
 MSRVTT_full_test/t2v_metrics/R10: 49.93311036789298
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.8933110367893
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.299164178181407
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 42.675585284280935
 MSRVTT_full_test/v2t_metrics/R10: 57.65886287625418
 MSRVTT_full_test/v2t_metrics/R50: 87.35785953177258
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.8933110367893
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.962040421568645
 mnt_best       : 28.299164178181407
 not_improved_count: 0
Train Epoch: 20 [1/250 128/32000 (0%)] Loss: 3.37661 (QuantReg: 12.77515) QuantErr: 12.77515 batch_time=31.76130 
Train Epoch: 20 [12/250 1536/32000 (5%)] Loss: 3.87180 (QuantReg: 12.73158) QuantErr: 12.73158 batch_time=0.92703 
Train Epoch: 20 [23/250 2944/32000 (9%)] Loss: 3.54606 (QuantReg: 12.51292) QuantErr: 12.51292 batch_time=0.95246 
Train Epoch: 20 [34/250 4352/32000 (14%)] Loss: 3.78701 (QuantReg: 12.80966) QuantErr: 12.80966 batch_time=0.95789 
Train Epoch: 20 [45/250 5760/32000 (18%)] Loss: 3.90954 (QuantReg: 12.91141) QuantErr: 12.91141 batch_time=0.94505 
Train Epoch: 20 [56/250 7168/32000 (22%)] Loss: 3.77162 (QuantReg: 12.90619) QuantErr: 12.90619 batch_time=0.96034 
Train Epoch: 20 [67/250 8576/32000 (27%)] Loss: 3.60083 (QuantReg: 12.80964) QuantErr: 12.80964 batch_time=1.05596 
Train Epoch: 20 [78/250 9984/32000 (31%)] Loss: 4.23886 (QuantReg: 12.88290) QuantErr: 12.88290 batch_time=0.91102 
Train Epoch: 20 [89/250 11392/32000 (36%)] Loss: 3.35362 (QuantReg: 12.80563) QuantErr: 12.80563 batch_time=0.91150 
Train Epoch: 20 [100/250 12800/32000 (40%)] Loss: 3.61938 (QuantReg: 12.42633) QuantErr: 12.42633 batch_time=0.91391 
Train Epoch: 20 [111/250 14208/32000 (44%)] Loss: 3.11801 (QuantReg: 13.08453) QuantErr: 13.08453 batch_time=0.91282 
Train Epoch: 20 [122/250 15616/32000 (49%)] Loss: 3.65883 (QuantReg: 12.79342) QuantErr: 12.79342 batch_time=0.91458 
Train Epoch: 20 [133/250 17024/32000 (53%)] Loss: 4.34704 (QuantReg: 12.57245) QuantErr: 12.57245 batch_time=0.93500 
Train Epoch: 20 [144/250 18432/32000 (58%)] Loss: 4.81843 (QuantReg: 12.63885) QuantErr: 12.63885 batch_time=1.18271 
Train Epoch: 20 [155/250 19840/32000 (62%)] Loss: 3.51824 (QuantReg: 12.71804) QuantErr: 12.71804 batch_time=0.91760 
Train Epoch: 20 [166/250 21248/32000 (66%)] Loss: 2.89734 (QuantReg: 12.86073) QuantErr: 12.86073 batch_time=0.97347 
Train Epoch: 20 [177/250 22656/32000 (71%)] Loss: 2.82493 (QuantReg: 12.76291) QuantErr: 12.76291 batch_time=0.91991 
Train Epoch: 20 [188/250 24064/32000 (75%)] Loss: 2.80772 (QuantReg: 12.71816) QuantErr: 12.71816 batch_time=0.99261 
Train Epoch: 20 [199/250 25472/32000 (80%)] Loss: 4.22415 (QuantReg: 12.59856) QuantErr: 12.59856 batch_time=1.69131 
Train Epoch: 20 [210/250 26880/32000 (84%)] Loss: 3.93322 (QuantReg: 12.78892) QuantErr: 12.78892 batch_time=0.95675 
Train Epoch: 20 [221/250 28288/32000 (88%)] Loss: 3.73359 (QuantReg: 12.84568) QuantErr: 12.84568 batch_time=0.92054 
Train Epoch: 20 [232/250 29696/32000 (93%)] Loss: 3.57041 (QuantReg: 13.00775) QuantErr: 13.00775 batch_time=0.93511 
Train Epoch: 20 [243/250 31104/32000 (97%)] Loss: 3.42684 (QuantReg: 12.72234) QuantErr: 12.72234 batch_time=0.96198 
Train Epoch: 20 codebook_update_time=8.85147
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch20.pth ...
Done in 4.260s
removing stale ckpt [epoch 19] [took 0.00s]
 epoch          : 20
 loss           : 3.6800324783325196
 quant_reg      : 12.830180061340332
 quant_err      : 12.830180061340332
 learning_rate  : 1.8867680126765363e-05
 n_samples      : 640000
 n_steps        : 5000
 MSRVTT_full_val/t2v_metrics/R1: 30.18108651911469
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.4325955734406435
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.45876669083694
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 88.12877263581488
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.82092555331992
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.8190929940027
 MSRVTT_full_test/t2v_metrics/R1: 12.341137123745819
 MSRVTT_full_test/t2v_metrics/R5: 35.51839464882943
 MSRVTT_full_test/t2v_metrics/R10: 49.79933110367893
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.42943143812709
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 27.947566951572018
 MSRVTT_full_test/v2t_metrics/R1: 15.785953177257525
 MSRVTT_full_test/v2t_metrics/R5: 42.74247491638796
 MSRVTT_full_test/v2t_metrics/R10: 57.792642140468224
 MSRVTT_full_test/v2t_metrics/R50: 86.68896321070234
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 32.580769230769235
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 33.9105115959413
 mnt_best       : 28.299164178181407
 not_improved_count: 1
Train Epoch: 21 [1/250 128/32000 (0%)] Loss: 3.21549 (QuantReg: 12.99363) QuantErr: 12.99363 batch_time=29.72136 
Train Epoch: 21 [12/250 1536/32000 (5%)] Loss: 4.09508 (QuantReg: 12.92693) QuantErr: 12.92693 batch_time=0.93593 
Train Epoch: 21 [23/250 2944/32000 (9%)] Loss: 4.01407 (QuantReg: 12.90669) QuantErr: 12.90669 batch_time=0.94845 
Train Epoch: 21 [34/250 4352/32000 (14%)] Loss: 3.10039 (QuantReg: 12.63116) QuantErr: 12.63116 batch_time=0.99187 
Train Epoch: 21 [45/250 5760/32000 (18%)] Loss: 4.47780 (QuantReg: 12.71991) QuantErr: 12.71991 batch_time=0.92542 
Train Epoch: 21 [56/250 7168/32000 (22%)] Loss: 3.37684 (QuantReg: 12.86698) QuantErr: 12.86698 batch_time=0.93280 
Train Epoch: 21 [67/250 8576/32000 (27%)] Loss: 4.50072 (QuantReg: 12.63822) QuantErr: 12.63822 batch_time=3.22504 
Train Epoch: 21 [78/250 9984/32000 (31%)] Loss: 3.70028 (QuantReg: 12.82044) QuantErr: 12.82044 batch_time=0.96993 
Train Epoch: 21 [89/250 11392/32000 (36%)] Loss: 4.27539 (QuantReg: 12.79344) QuantErr: 12.79344 batch_time=0.96394 
Train Epoch: 21 [100/250 12800/32000 (40%)] Loss: 3.45729 (QuantReg: 12.80214) QuantErr: 12.80214 batch_time=0.96010 
Train Epoch: 21 [111/250 14208/32000 (44%)] Loss: 3.07416 (QuantReg: 13.01632) QuantErr: 13.01632 batch_time=0.93700 
Train Epoch: 21 [122/250 15616/32000 (49%)] Loss: 4.46855 (QuantReg: 12.53419) QuantErr: 12.53419 batch_time=0.94166 
Train Epoch: 21 [133/250 17024/32000 (53%)] Loss: 4.36780 (QuantReg: 12.48805) QuantErr: 12.48805 batch_time=0.93415 
Train Epoch: 21 [144/250 18432/32000 (58%)] Loss: 2.71239 (QuantReg: 12.89919) QuantErr: 12.89919 batch_time=0.97668 
Train Epoch: 21 [155/250 19840/32000 (62%)] Loss: 4.18408 (QuantReg: 13.01094) QuantErr: 13.01094 batch_time=0.93917 
Train Epoch: 21 [166/250 21248/32000 (66%)] Loss: 3.00032 (QuantReg: 13.08453) QuantErr: 13.08453 batch_time=0.96178 
Train Epoch: 21 [177/250 22656/32000 (71%)] Loss: 3.24965 (QuantReg: 12.96294) QuantErr: 12.96294 batch_time=0.96337 
Train Epoch: 21 [188/250 24064/32000 (75%)] Loss: 3.79963 (QuantReg: 12.87691) QuantErr: 12.87691 batch_time=0.94693 
Train Epoch: 21 [199/250 25472/32000 (80%)] Loss: 3.96604 (QuantReg: 12.90908) QuantErr: 12.90908 batch_time=2.37946 
Train Epoch: 21 [210/250 26880/32000 (84%)] Loss: 2.56211 (QuantReg: 12.82974) QuantErr: 12.82974 batch_time=0.94287 
Train Epoch: 21 [221/250 28288/32000 (88%)] Loss: 2.95525 (QuantReg: 12.51629) QuantErr: 12.51629 batch_time=2.96066 
Train Epoch: 21 [232/250 29696/32000 (93%)] Loss: 3.75565 (QuantReg: 12.90590) QuantErr: 12.90590 batch_time=0.99600 
Train Epoch: 21 [243/250 31104/32000 (97%)] Loss: 2.93333 (QuantReg: 13.06192) QuantErr: 13.06192 batch_time=0.93947 
Train Epoch: 21 codebook_update_time=9.40791
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch21.pth ...
Done in 3.887s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch21.pth ...
Done in 25.338s
removing stale ckpt [epoch 20] [took 0.00s]
 epoch          : 21
 loss           : 3.628684278488159
 quant_reg      : 12.832897563934326
 quant_err      : 12.832897563934326
 learning_rate  : 1.7924296120427095e-05
 n_samples      : 672000
 n_steps        : 5250
 MSRVTT_full_val/t2v_metrics/R1: 28.169014084507044
 MSRVTT_full_val/t2v_metrics/R5: 67.40442655935614
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.323943661971831
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 53.55210869854737
 MSRVTT_full_val/v2t_metrics/R1: 36.61971830985915
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.744466800804829
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.46115639479977
 MSRVTT_full_test/t2v_metrics/R1: 13.110367892976589
 MSRVTT_full_test/t2v_metrics/R5: 35.852842809364546
 MSRVTT_full_test/t2v_metrics/R10: 50.2675585284281
 MSRVTT_full_test/t2v_metrics/R50: 81.37123745819397
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.99732441471572
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.695166960461627
 MSRVTT_full_test/v2t_metrics/R1: 16.287625418060202
 MSRVTT_full_test/v2t_metrics/R5: 42.508361204013376
 MSRVTT_full_test/v2t_metrics/R10: 57.357859531772576
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.577424749163878
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.11732901820904
 mnt_best       : 28.695166960461627
 not_improved_count: 0
Train Epoch: 22 [1/250 128/32000 (0%)] Loss: 3.10089 (QuantReg: 12.83906) QuantErr: 12.83906 batch_time=37.55715 
Train Epoch: 22 [12/250 1536/32000 (5%)] Loss: 3.81927 (QuantReg: 12.68464) QuantErr: 12.68464 batch_time=0.96935 
Train Epoch: 22 [23/250 2944/32000 (9%)] Loss: 3.62278 (QuantReg: 12.81057) QuantErr: 12.81057 batch_time=1.70835 
Train Epoch: 22 [34/250 4352/32000 (14%)] Loss: 3.03927 (QuantReg: 13.06219) QuantErr: 13.06219 batch_time=0.94402 
Train Epoch: 22 [45/250 5760/32000 (18%)] Loss: 3.61512 (QuantReg: 12.74141) QuantErr: 12.74141 batch_time=0.96067 
Train Epoch: 22 [56/250 7168/32000 (22%)] Loss: 4.23517 (QuantReg: 12.31347) QuantErr: 12.31347 batch_time=0.92069 
Train Epoch: 22 [67/250 8576/32000 (27%)] Loss: 3.82738 (QuantReg: 13.01952) QuantErr: 13.01952 batch_time=1.32182 
Train Epoch: 22 [78/250 9984/32000 (31%)] Loss: 4.52628 (QuantReg: 12.77751) QuantErr: 12.77751 batch_time=0.92148 
Train Epoch: 22 [89/250 11392/32000 (36%)] Loss: 4.14597 (QuantReg: 12.78199) QuantErr: 12.78199 batch_time=0.94312 
Train Epoch: 22 [100/250 12800/32000 (40%)] Loss: 3.10440 (QuantReg: 13.03962) QuantErr: 13.03962 batch_time=1.00129 
Train Epoch: 22 [111/250 14208/32000 (44%)] Loss: 3.07837 (QuantReg: 12.97351) QuantErr: 12.97351 batch_time=0.95509 
Train Epoch: 22 [122/250 15616/32000 (49%)] Loss: 3.47484 (QuantReg: 12.74525) QuantErr: 12.74525 batch_time=1.05131 
Train Epoch: 22 [133/250 17024/32000 (53%)] Loss: 3.42576 (QuantReg: 12.86395) QuantErr: 12.86395 batch_time=1.67189 
Train Epoch: 22 [144/250 18432/32000 (58%)] Loss: 3.12519 (QuantReg: 12.85918) QuantErr: 12.85918 batch_time=0.93748 
Train Epoch: 22 [155/250 19840/32000 (62%)] Loss: 3.04224 (QuantReg: 12.83029) QuantErr: 12.83029 batch_time=0.95676 
Train Epoch: 22 [166/250 21248/32000 (66%)] Loss: 4.53584 (QuantReg: 12.41309) QuantErr: 12.41309 batch_time=0.95944 
Train Epoch: 22 [177/250 22656/32000 (71%)] Loss: 4.13502 (QuantReg: 12.76072) QuantErr: 12.76072 batch_time=1.04982 
Train Epoch: 22 [188/250 24064/32000 (75%)] Loss: 3.02801 (QuantReg: 12.80929) QuantErr: 12.80929 batch_time=0.93650 
Train Epoch: 22 [199/250 25472/32000 (80%)] Loss: 3.31949 (QuantReg: 12.95358) QuantErr: 12.95358 batch_time=0.93909 
Train Epoch: 22 [210/250 26880/32000 (84%)] Loss: 3.63020 (QuantReg: 13.24273) QuantErr: 13.24273 batch_time=1.55132 
Train Epoch: 22 [221/250 28288/32000 (88%)] Loss: 3.86812 (QuantReg: 12.66165) QuantErr: 12.66165 batch_time=0.94946 
Train Epoch: 22 [232/250 29696/32000 (93%)] Loss: 3.00075 (QuantReg: 12.78551) QuantErr: 12.78551 batch_time=0.98257 
Train Epoch: 22 [243/250 31104/32000 (97%)] Loss: 4.25807 (QuantReg: 12.91662) QuantErr: 12.91662 batch_time=0.94535 
Train Epoch: 22 codebook_update_time=8.44523
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch22.pth ...
Done in 20.240s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch22.pth ...
Done in 24.140s
removing stale ckpt [epoch 21] [took 0.00s]
 epoch          : 22
 loss           : 3.501323705673218
 quant_reg      : 12.85543159866333
 quant_err      : 12.85543159866333
 learning_rate  : 1.702808131440574e-05
 n_samples      : 704000
 n_steps        : 5500
 MSRVTT_full_val/t2v_metrics/R1: 30.18108651911469
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 98.79275653923541
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 6.985915492957746
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.695977963102266
 MSRVTT_full_val/v2t_metrics/R1: 35.814889336016094
 MSRVTT_full_val/v2t_metrics/R5: 74.84909456740442
 MSRVTT_full_val/v2t_metrics/R10: 88.32997987927565
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.629778672032193
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 61.866103729225514
 MSRVTT_full_test/t2v_metrics/R1: 12.909698996655518
 MSRVTT_full_test/t2v_metrics/R5: 36.32107023411371
 MSRVTT_full_test/t2v_metrics/R10: 50.468227424749166
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.80836120401338
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.709850757555895
 MSRVTT_full_test/v2t_metrics/R1: 15.919732441471572
 MSRVTT_full_test/v2t_metrics/R5: 43.21070234113712
 MSRVTT_full_test/v2t_metrics/R10: 57.591973244147155
 MSRVTT_full_test/v2t_metrics/R50: 86.88963210702342
 MSRVTT_full_test/v2t_metrics/MedR: 8.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.20936454849498
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.09021049415342
 mnt_best       : 28.709850757555895
 not_improved_count: 0
Train Epoch: 23 [1/250 128/32000 (0%)] Loss: 3.63171 (QuantReg: 12.73205) QuantErr: 12.73205 batch_time=35.98741 
Train Epoch: 23 [12/250 1536/32000 (5%)] Loss: 3.39673 (QuantReg: 13.10556) QuantErr: 13.10556 batch_time=0.93958 
Train Epoch: 23 [23/250 2944/32000 (9%)] Loss: 3.55853 (QuantReg: 13.12007) QuantErr: 13.12007 batch_time=0.94291 
Train Epoch: 23 [34/250 4352/32000 (14%)] Loss: 3.35403 (QuantReg: 12.78113) QuantErr: 12.78113 batch_time=0.99891 
Train Epoch: 23 [45/250 5760/32000 (18%)] Loss: 3.14765 (QuantReg: 12.68031) QuantErr: 12.68031 batch_time=0.95837 
Train Epoch: 23 [56/250 7168/32000 (22%)] Loss: 3.49475 (QuantReg: 13.01069) QuantErr: 13.01069 batch_time=0.93497 
Train Epoch: 23 [67/250 8576/32000 (27%)] Loss: 3.27250 (QuantReg: 12.73059) QuantErr: 12.73059 batch_time=0.94848 
Train Epoch: 23 [78/250 9984/32000 (31%)] Loss: 3.71962 (QuantReg: 12.50942) QuantErr: 12.50942 batch_time=0.93329 
Train Epoch: 23 [89/250 11392/32000 (36%)] Loss: 3.36770 (QuantReg: 12.84855) QuantErr: 12.84855 batch_time=0.94264 
Train Epoch: 23 [100/250 12800/32000 (40%)] Loss: 3.10993 (QuantReg: 12.98658) QuantErr: 12.98658 batch_time=0.96317 
Train Epoch: 23 [111/250 14208/32000 (44%)] Loss: 3.10111 (QuantReg: 13.15695) QuantErr: 13.15695 batch_time=0.94481 
Train Epoch: 23 [122/250 15616/32000 (49%)] Loss: 3.11842 (QuantReg: 13.18805) QuantErr: 13.18805 batch_time=0.93371 
Train Epoch: 23 [133/250 17024/32000 (53%)] Loss: 3.75539 (QuantReg: 13.02208) QuantErr: 13.02208 batch_time=6.08581 
Train Epoch: 23 [144/250 18432/32000 (58%)] Loss: 3.56375 (QuantReg: 12.94507) QuantErr: 12.94507 batch_time=0.97621 
Train Epoch: 23 [155/250 19840/32000 (62%)] Loss: 3.55072 (QuantReg: 13.25308) QuantErr: 13.25308 batch_time=0.96325 
Train Epoch: 23 [166/250 21248/32000 (66%)] Loss: 2.65613 (QuantReg: 13.22449) QuantErr: 13.22449 batch_time=0.96839 
Train Epoch: 23 [177/250 22656/32000 (71%)] Loss: 3.98096 (QuantReg: 12.84973) QuantErr: 12.84973 batch_time=0.98640 
Train Epoch: 23 [188/250 24064/32000 (75%)] Loss: 3.42610 (QuantReg: 12.87261) QuantErr: 12.87261 batch_time=0.95389 
Train Epoch: 23 [199/250 25472/32000 (80%)] Loss: 4.44438 (QuantReg: 13.13285) QuantErr: 13.13285 batch_time=1.66227 
Train Epoch: 23 [210/250 26880/32000 (84%)] Loss: 3.69247 (QuantReg: 12.74570) QuantErr: 12.74570 batch_time=1.00082 
Train Epoch: 23 [221/250 28288/32000 (88%)] Loss: 3.79612 (QuantReg: 12.84364) QuantErr: 12.84364 batch_time=0.92792 
Train Epoch: 23 [232/250 29696/32000 (93%)] Loss: 3.38088 (QuantReg: 13.24197) QuantErr: 13.24197 batch_time=0.93452 
Train Epoch: 23 [243/250 31104/32000 (97%)] Loss: 3.27019 (QuantReg: 12.64379) QuantErr: 12.64379 batch_time=0.92148 
Train Epoch: 23 codebook_update_time=8.00636
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch23.pth ...
Done in 3.947s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch23.pth ...
Done in 7.987s
removing stale ckpt [epoch 22] [took 0.00s]
 epoch          : 23
 loss           : 3.4205343914031983
 quant_reg      : 12.900839874267579
 quant_err      : 12.900839874267579
 learning_rate  : 1.6176677248685452e-05
 n_samples      : 736000
 n_steps        : 5750
 MSRVTT_full_val/t2v_metrics/R1: 29.979879275653925
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.2917505030181085
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.48796362912866
 MSRVTT_full_val/v2t_metrics/R1: 36.41851106639839
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 99.59758551307847
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.603621730382294
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.844876466297265
 MSRVTT_full_test/t2v_metrics/R1: 13.478260869565217
 MSRVTT_full_test/t2v_metrics/R5: 36.65551839464883
 MSRVTT_full_test/t2v_metrics/R10: 50.36789297658863
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 39.934615384615384
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.195035145137865
 MSRVTT_full_test/v2t_metrics/R1: 16.588628762541806
 MSRVTT_full_test/v2t_metrics/R5: 44.214046822742475
 MSRVTT_full_test/v2t_metrics/R10: 58.22742474916388
 MSRVTT_full_test/v2t_metrics/R50: 87.25752508361204
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.565217391304348
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.954206365323756
 mnt_best       : 29.195035145137865
 not_improved_count: 0
Train Epoch: 24 [1/250 128/32000 (0%)] Loss: 3.58387 (QuantReg: 12.78007) QuantErr: 12.78007 batch_time=34.46221 
Train Epoch: 24 [12/250 1536/32000 (5%)] Loss: 3.94550 (QuantReg: 12.68088) QuantErr: 12.68088 batch_time=0.93300 
Train Epoch: 24 [23/250 2944/32000 (9%)] Loss: 3.07535 (QuantReg: 12.99866) QuantErr: 12.99866 batch_time=0.95121 
Train Epoch: 24 [34/250 4352/32000 (14%)] Loss: 3.63244 (QuantReg: 13.11994) QuantErr: 13.11994 batch_time=0.94821 
Train Epoch: 24 [45/250 5760/32000 (18%)] Loss: 3.19818 (QuantReg: 12.45478) QuantErr: 12.45478 batch_time=0.95105 
Train Epoch: 24 [56/250 7168/32000 (22%)] Loss: 4.17117 (QuantReg: 12.88268) QuantErr: 12.88268 batch_time=0.95839 
Train Epoch: 24 [67/250 8576/32000 (27%)] Loss: 3.93499 (QuantReg: 12.97913) QuantErr: 12.97913 batch_time=0.94585 
Train Epoch: 24 [78/250 9984/32000 (31%)] Loss: 3.25566 (QuantReg: 12.97447) QuantErr: 12.97447 batch_time=0.95442 
Train Epoch: 24 [89/250 11392/32000 (36%)] Loss: 4.25626 (QuantReg: 12.86489) QuantErr: 12.86489 batch_time=0.95596 
Train Epoch: 24 [100/250 12800/32000 (40%)] Loss: 3.71414 (QuantReg: 13.05022) QuantErr: 13.05022 batch_time=0.96760 
Train Epoch: 24 [111/250 14208/32000 (44%)] Loss: 3.04570 (QuantReg: 13.00945) QuantErr: 13.00945 batch_time=0.96739 
Train Epoch: 24 [122/250 15616/32000 (49%)] Loss: 3.12203 (QuantReg: 12.87913) QuantErr: 12.87913 batch_time=0.91827 
Train Epoch: 24 [133/250 17024/32000 (53%)] Loss: 3.33556 (QuantReg: 13.19463) QuantErr: 13.19463 batch_time=1.04947 
Train Epoch: 24 [144/250 18432/32000 (58%)] Loss: 2.81775 (QuantReg: 12.64122) QuantErr: 12.64122 batch_time=2.60588 
Train Epoch: 24 [155/250 19840/32000 (62%)] Loss: 3.96570 (QuantReg: 13.08142) QuantErr: 13.08142 batch_time=0.95771 
Train Epoch: 24 [166/250 21248/32000 (66%)] Loss: 3.23257 (QuantReg: 12.89962) QuantErr: 12.89962 batch_time=0.95533 
Train Epoch: 24 [177/250 22656/32000 (71%)] Loss: 4.09556 (QuantReg: 12.72766) QuantErr: 12.72766 batch_time=0.96755 
Train Epoch: 24 [188/250 24064/32000 (75%)] Loss: 3.15136 (QuantReg: 12.90981) QuantErr: 12.90981 batch_time=0.93377 
Train Epoch: 24 [199/250 25472/32000 (80%)] Loss: 1.72914 (QuantReg: 13.20684) QuantErr: 13.20684 batch_time=0.96829 
Train Epoch: 24 [210/250 26880/32000 (84%)] Loss: 2.71164 (QuantReg: 12.88198) QuantErr: 12.88198 batch_time=0.96615 
Train Epoch: 24 [221/250 28288/32000 (88%)] Loss: 3.19639 (QuantReg: 12.96447) QuantErr: 12.96447 batch_time=0.94055 
Train Epoch: 24 [232/250 29696/32000 (93%)] Loss: 2.88632 (QuantReg: 12.89273) QuantErr: 12.89273 batch_time=0.96441 
Train Epoch: 24 [243/250 31104/32000 (97%)] Loss: 3.55183 (QuantReg: 13.31044) QuantErr: 13.31044 batch_time=0.95081 
Train Epoch: 24 codebook_update_time=8.17163
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch24.pth ...
Done in 4.255s
removing stale ckpt [epoch 23] [took 0.00s]
 epoch          : 24
 loss           : 3.358127986907959
 quant_reg      : 12.924795486450195
 quant_err      : 12.924795486450195
 learning_rate  : 1.5367843386251178e-05
 n_samples      : 768000
 n_steps        : 6000
 MSRVTT_full_val/t2v_metrics/R1: 29.37625754527163
 MSRVTT_full_val/t2v_metrics/R5: 67.6056338028169
 MSRVTT_full_val/t2v_metrics/R10: 81.48893360160966
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.71830985915493
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.49533542554359
 MSRVTT_full_val/v2t_metrics/R1: 37.02213279678068
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.39034205231388
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.899396378269618
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.98431748062002
 MSRVTT_full_test/t2v_metrics/R1: 13.244147157190636
 MSRVTT_full_test/t2v_metrics/R5: 35.4180602006689
 MSRVTT_full_test/t2v_metrics/R10: 49.66555183946488
 MSRVTT_full_test/t2v_metrics/R50: 81.10367892976589
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.93010033444816
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.560645030015525
 MSRVTT_full_test/v2t_metrics/R1: 15.986622073578594
 MSRVTT_full_test/v2t_metrics/R5: 44.448160535117054
 MSRVTT_full_test/v2t_metrics/R10: 57.25752508361204
 MSRVTT_full_test/v2t_metrics/R50: 87.4247491638796
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.98026755852843
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.39386832890439
 mnt_best       : 29.195035145137865
 not_improved_count: 1
Train Epoch: 25 [1/250 128/32000 (0%)] Loss: 2.84090 (QuantReg: 12.81064) QuantErr: 12.81064 batch_time=37.07198 
Train Epoch: 25 [12/250 1536/32000 (5%)] Loss: 3.37303 (QuantReg: 12.83311) QuantErr: 12.83311 batch_time=0.97585 
Train Epoch: 25 [23/250 2944/32000 (9%)] Loss: 2.82947 (QuantReg: 12.77669) QuantErr: 12.77669 batch_time=0.98087 
Train Epoch: 25 [34/250 4352/32000 (14%)] Loss: 2.95798 (QuantReg: 12.84241) QuantErr: 12.84241 batch_time=0.94537 
Train Epoch: 25 [45/250 5760/32000 (18%)] Loss: 4.46258 (QuantReg: 12.86406) QuantErr: 12.86406 batch_time=0.96752 
Train Epoch: 25 [56/250 7168/32000 (22%)] Loss: 3.07057 (QuantReg: 12.89230) QuantErr: 12.89230 batch_time=0.95225 
Train Epoch: 25 [67/250 8576/32000 (27%)] Loss: 4.24153 (QuantReg: 12.92541) QuantErr: 12.92541 batch_time=2.76761 
Train Epoch: 25 [78/250 9984/32000 (31%)] Loss: 3.76138 (QuantReg: 12.81803) QuantErr: 12.81803 batch_time=0.99232 
Train Epoch: 25 [89/250 11392/32000 (36%)] Loss: 3.82192 (QuantReg: 12.82343) QuantErr: 12.82343 batch_time=0.96232 
Train Epoch: 25 [100/250 12800/32000 (40%)] Loss: 3.34643 (QuantReg: 12.72711) QuantErr: 12.72711 batch_time=0.94619 
Train Epoch: 25 [111/250 14208/32000 (44%)] Loss: 3.43990 (QuantReg: 12.86120) QuantErr: 12.86120 batch_time=0.93598 
Train Epoch: 25 [122/250 15616/32000 (49%)] Loss: 3.61721 (QuantReg: 12.86575) QuantErr: 12.86575 batch_time=0.94512 
Train Epoch: 25 [133/250 17024/32000 (53%)] Loss: 3.65996 (QuantReg: 12.69007) QuantErr: 12.69007 batch_time=1.64799 
Train Epoch: 25 [144/250 18432/32000 (58%)] Loss: 2.83891 (QuantReg: 13.10973) QuantErr: 13.10973 batch_time=0.91288 
Train Epoch: 25 [155/250 19840/32000 (62%)] Loss: 3.24603 (QuantReg: 12.85886) QuantErr: 12.85886 batch_time=0.91222 
Train Epoch: 25 [166/250 21248/32000 (66%)] Loss: 3.01692 (QuantReg: 12.83270) QuantErr: 12.83270 batch_time=0.94194 
Train Epoch: 25 [177/250 22656/32000 (71%)] Loss: 3.13860 (QuantReg: 13.03438) QuantErr: 13.03438 batch_time=0.94290 
Train Epoch: 25 [188/250 24064/32000 (75%)] Loss: 3.39555 (QuantReg: 13.08948) QuantErr: 13.08948 batch_time=0.94103 
Train Epoch: 25 [199/250 25472/32000 (80%)] Loss: 4.16717 (QuantReg: 12.98922) QuantErr: 12.98922 batch_time=1.06534 
Train Epoch: 25 [210/250 26880/32000 (84%)] Loss: 3.65891 (QuantReg: 12.93174) QuantErr: 12.93174 batch_time=1.05212 
Train Epoch: 25 [221/250 28288/32000 (88%)] Loss: 3.42042 (QuantReg: 12.85850) QuantErr: 12.85850 batch_time=1.00768 
Train Epoch: 25 [232/250 29696/32000 (93%)] Loss: 3.26780 (QuantReg: 12.92179) QuantErr: 12.92179 batch_time=0.96061 
Train Epoch: 25 [243/250 31104/32000 (97%)] Loss: 4.06746 (QuantReg: 13.11333) QuantErr: 13.11333 batch_time=0.94353 
Train Epoch: 25 codebook_update_time=8.82285
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch25.pth ...
Done in 4.408s
removing stale ckpt [epoch 24] [took 0.00s]
 epoch          : 25
 loss           : 3.2502387075424193
 quant_reg      : 12.967243564605713
 quant_err      : 12.967243564605713
 learning_rate  : 1.4599451216938618e-05
 n_samples      : 800000
 n_steps        : 6250
 MSRVTT_full_val/t2v_metrics/R1: 29.77867203219316
 MSRVTT_full_val/t2v_metrics/R5: 68.00804828973843
 MSRVTT_full_val/t2v_metrics/R10: 80.28169014084507
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.597585513078471
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.57922715214068
 MSRVTT_full_val/v2t_metrics/R1: 37.625754527162975
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 85.91549295774648
 MSRVTT_full_val/v2t_metrics/R50: 99.3963782696177
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.585513078470825
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.03092515000113
 MSRVTT_full_test/t2v_metrics/R1: 13.511705685618729
 MSRVTT_full_test/t2v_metrics/R5: 35.08361204013378
 MSRVTT_full_test/t2v_metrics/R10: 49.83277591973244
 MSRVTT_full_test/t2v_metrics/R50: 80.8361204013378
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.23377926421405
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.693037036704297
 MSRVTT_full_test/v2t_metrics/R1: 16.321070234113712
 MSRVTT_full_test/v2t_metrics/R5: 43.61204013377927
 MSRVTT_full_test/v2t_metrics/R10: 58.09364548494983
 MSRVTT_full_test/v2t_metrics/R50: 86.75585284280936
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.35752508361204
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.58023091016747
 mnt_best       : 29.195035145137865
 not_improved_count: 2
Train Epoch: 26 [1/250 128/32000 (0%)] Loss: 2.80167 (QuantReg: 13.15224) QuantErr: 13.15224 batch_time=35.11650 
Train Epoch: 26 [12/250 1536/32000 (5%)] Loss: 2.79971 (QuantReg: 13.01149) QuantErr: 13.01149 batch_time=0.94802 
Train Epoch: 26 [23/250 2944/32000 (9%)] Loss: 2.89274 (QuantReg: 12.91929) QuantErr: 12.91929 batch_time=0.93898 
Train Epoch: 26 [34/250 4352/32000 (14%)] Loss: 3.73620 (QuantReg: 12.95265) QuantErr: 12.95265 batch_time=0.94957 
Train Epoch: 26 [45/250 5760/32000 (18%)] Loss: 2.33158 (QuantReg: 13.10761) QuantErr: 13.10761 batch_time=0.93612 
Train Epoch: 26 [56/250 7168/32000 (22%)] Loss: 3.94969 (QuantReg: 12.64070) QuantErr: 12.64070 batch_time=0.93729 
Train Epoch: 26 [67/250 8576/32000 (27%)] Loss: 3.52306 (QuantReg: 12.87539) QuantErr: 12.87539 batch_time=1.04401 
Train Epoch: 26 [78/250 9984/32000 (31%)] Loss: 3.69084 (QuantReg: 12.84327) QuantErr: 12.84327 batch_time=0.95189 
Train Epoch: 26 [89/250 11392/32000 (36%)] Loss: 3.41615 (QuantReg: 13.11633) QuantErr: 13.11633 batch_time=0.97481 
Train Epoch: 26 [100/250 12800/32000 (40%)] Loss: 3.28155 (QuantReg: 12.87649) QuantErr: 12.87649 batch_time=1.28724 
Train Epoch: 26 [111/250 14208/32000 (44%)] Loss: 3.35728 (QuantReg: 13.15703) QuantErr: 13.15703 batch_time=0.92857 
Train Epoch: 26 [122/250 15616/32000 (49%)] Loss: 3.83333 (QuantReg: 12.86299) QuantErr: 12.86299 batch_time=0.94679 
Train Epoch: 26 [133/250 17024/32000 (53%)] Loss: 3.74167 (QuantReg: 12.68586) QuantErr: 12.68586 batch_time=0.93722 
Train Epoch: 26 [144/250 18432/32000 (58%)] Loss: 4.24785 (QuantReg: 12.91223) QuantErr: 12.91223 batch_time=0.93399 
Train Epoch: 26 [155/250 19840/32000 (62%)] Loss: 3.37099 (QuantReg: 12.89521) QuantErr: 12.89521 batch_time=0.95806 
Train Epoch: 26 [166/250 21248/32000 (66%)] Loss: 2.62042 (QuantReg: 13.03407) QuantErr: 13.03407 batch_time=0.94022 
Train Epoch: 26 [177/250 22656/32000 (71%)] Loss: 3.58993 (QuantReg: 12.81895) QuantErr: 12.81895 batch_time=1.01419 
Train Epoch: 26 [188/250 24064/32000 (75%)] Loss: 2.96976 (QuantReg: 13.39505) QuantErr: 13.39505 batch_time=0.99808 
Train Epoch: 26 [199/250 25472/32000 (80%)] Loss: 3.34573 (QuantReg: 12.98904) QuantErr: 12.98904 batch_time=0.93743 
Train Epoch: 26 [210/250 26880/32000 (84%)] Loss: 3.18149 (QuantReg: 12.84851) QuantErr: 12.84851 batch_time=0.94222 
Train Epoch: 26 [221/250 28288/32000 (88%)] Loss: 2.77395 (QuantReg: 12.79228) QuantErr: 12.79228 batch_time=0.94034 
Train Epoch: 26 [232/250 29696/32000 (93%)] Loss: 2.98898 (QuantReg: 12.72464) QuantErr: 12.72464 batch_time=1.09496 
Train Epoch: 26 [243/250 31104/32000 (97%)] Loss: 3.02687 (QuantReg: 13.18465) QuantErr: 13.18465 batch_time=0.93265 
Train Epoch: 26 codebook_update_time=8.66414
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch26.pth ...
Done in 4.447s
removing stale ckpt [epoch 25] [took 0.00s]
 epoch          : 26
 loss           : 3.295137119293213
 quant_reg      : 12.916738918304443
 quant_err      : 12.916738918304443
 learning_rate  : 1.3869478656091687e-05
 n_samples      : 832000
 n_steps        : 6500
 MSRVTT_full_val/t2v_metrics/R1: 29.577464788732396
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 80.88531187122736
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.573440643863179
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 54.860039237892344
 MSRVTT_full_val/v2t_metrics/R1: 37.42454728370221
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 99.59758551307847
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.41851106639839
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.04047755010397
 MSRVTT_full_test/t2v_metrics/R1: 13.311036789297658
 MSRVTT_full_test/t2v_metrics/R5: 35.953177257525084
 MSRVTT_full_test/t2v_metrics/R10: 49.79933110367893
 MSRVTT_full_test/t2v_metrics/R50: 80.8695652173913
 MSRVTT_full_test/t2v_metrics/MedR: 11.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.38227424749164
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 28.777797771149018
 MSRVTT_full_test/v2t_metrics/R1: 15.88628762541806
 MSRVTT_full_test/v2t_metrics/R5: 44.080267558528426
 MSRVTT_full_test/v2t_metrics/R10: 58.09364548494983
 MSRVTT_full_test/v2t_metrics/R50: 87.52508361204013
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.565217391304348
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.392606526224654
 mnt_best       : 29.195035145137865
 not_improved_count: 3
Train Epoch: 27 [1/250 128/32000 (0%)] Loss: 2.60590 (QuantReg: 12.86733) QuantErr: 12.86733 batch_time=33.17062 
Train Epoch: 27 [12/250 1536/32000 (5%)] Loss: 4.21068 (QuantReg: 12.71978) QuantErr: 12.71978 batch_time=0.93115 
Train Epoch: 27 [23/250 2944/32000 (9%)] Loss: 3.66318 (QuantReg: 12.86989) QuantErr: 12.86989 batch_time=1.00019 
Train Epoch: 27 [34/250 4352/32000 (14%)] Loss: 3.89340 (QuantReg: 12.93813) QuantErr: 12.93813 batch_time=0.97168 
Train Epoch: 27 [45/250 5760/32000 (18%)] Loss: 2.83469 (QuantReg: 12.95616) QuantErr: 12.95616 batch_time=1.08011 
Train Epoch: 27 [56/250 7168/32000 (22%)] Loss: 3.70026 (QuantReg: 12.62540) QuantErr: 12.62540 batch_time=0.94108 
Train Epoch: 27 [67/250 8576/32000 (27%)] Loss: 3.93336 (QuantReg: 13.08817) QuantErr: 13.08817 batch_time=0.94788 
Train Epoch: 27 [78/250 9984/32000 (31%)] Loss: 3.93669 (QuantReg: 12.76182) QuantErr: 12.76182 batch_time=1.06349 
Train Epoch: 27 [89/250 11392/32000 (36%)] Loss: 2.92966 (QuantReg: 13.01118) QuantErr: 13.01118 batch_time=0.93466 
Train Epoch: 27 [100/250 12800/32000 (40%)] Loss: 2.81442 (QuantReg: 12.87639) QuantErr: 12.87639 batch_time=0.94923 
Train Epoch: 27 [111/250 14208/32000 (44%)] Loss: 3.09439 (QuantReg: 12.98035) QuantErr: 12.98035 batch_time=0.93761 
Train Epoch: 27 [122/250 15616/32000 (49%)] Loss: 3.13535 (QuantReg: 12.76360) QuantErr: 12.76360 batch_time=0.97115 
Train Epoch: 27 [133/250 17024/32000 (53%)] Loss: 2.67171 (QuantReg: 13.08150) QuantErr: 13.08150 batch_time=1.28448 
Train Epoch: 27 [144/250 18432/32000 (58%)] Loss: 3.46671 (QuantReg: 13.16545) QuantErr: 13.16545 batch_time=4.66100 
Train Epoch: 27 [155/250 19840/32000 (62%)] Loss: 2.75013 (QuantReg: 13.00861) QuantErr: 13.00861 batch_time=0.92771 
Train Epoch: 27 [166/250 21248/32000 (66%)] Loss: 3.15848 (QuantReg: 13.01822) QuantErr: 13.01822 batch_time=0.94392 
Train Epoch: 27 [177/250 22656/32000 (71%)] Loss: 3.01978 (QuantReg: 13.27980) QuantErr: 13.27980 batch_time=1.06589 
Train Epoch: 27 [188/250 24064/32000 (75%)] Loss: 3.15432 (QuantReg: 12.90494) QuantErr: 12.90494 batch_time=0.93628 
Train Epoch: 27 [199/250 25472/32000 (80%)] Loss: 3.29155 (QuantReg: 12.91429) QuantErr: 12.91429 batch_time=1.35201 
Train Epoch: 27 [210/250 26880/32000 (84%)] Loss: 3.07108 (QuantReg: 13.34190) QuantErr: 13.34190 batch_time=1.24230 
Train Epoch: 27 [221/250 28288/32000 (88%)] Loss: 3.26460 (QuantReg: 13.21656) QuantErr: 13.21656 batch_time=1.00859 
Train Epoch: 27 [232/250 29696/32000 (93%)] Loss: 3.61205 (QuantReg: 13.18734) QuantErr: 13.18734 batch_time=1.38536 
Train Epoch: 27 [243/250 31104/32000 (97%)] Loss: 3.31424 (QuantReg: 13.09145) QuantErr: 13.09145 batch_time=0.99146 
Train Epoch: 27 codebook_update_time=9.25545
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch27.pth ...
Done in 5.264s
removing stale ckpt [epoch 26] [took 0.01s]
 epoch          : 27
 loss           : 3.243840364456177
 quant_reg      : 12.974677719116212
 quant_err      : 12.974677719116212
 learning_rate  : 1.3176004723287102e-05
 n_samples      : 864000
 n_steps        : 6750
 MSRVTT_full_val/t2v_metrics/R1: 30.784708249496983
 MSRVTT_full_val/t2v_metrics/R5: 69.21529175050301
 MSRVTT_full_val/t2v_metrics/R10: 82.09255533199195
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 6.899396378269618
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.9259826242262
 MSRVTT_full_val/v2t_metrics/R1: 37.02213279678068
 MSRVTT_full_val/v2t_metrics/R5: 78.47082494969818
 MSRVTT_full_val/v2t_metrics/R10: 88.53118712273641
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.496981891348089
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.59485480449283
 MSRVTT_full_test/t2v_metrics/R1: 13.34448160535117
 MSRVTT_full_test/t2v_metrics/R5: 36.020066889632105
 MSRVTT_full_test/t2v_metrics/R10: 51.070234113712374
 MSRVTT_full_test/t2v_metrics/R50: 81.97324414715719
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 40.40066889632107
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.06283817352979
 MSRVTT_full_test/v2t_metrics/R1: 16.48829431438127
 MSRVTT_full_test/v2t_metrics/R5: 44.147157190635454
 MSRVTT_full_test/v2t_metrics/R10: 57.792642140468224
 MSRVTT_full_test/v2t_metrics/R50: 86.95652173913044
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.86488294314381
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 34.778993377245065
 mnt_best       : 29.195035145137865
 not_improved_count: 4
Train Epoch: 28 [1/250 128/32000 (0%)] Loss: 2.95969 (QuantReg: 13.03508) QuantErr: 13.03508 batch_time=34.89350 
Train Epoch: 28 [12/250 1536/32000 (5%)] Loss: 2.43485 (QuantReg: 13.06817) QuantErr: 13.06817 batch_time=0.92915 
Train Epoch: 28 [23/250 2944/32000 (9%)] Loss: 2.85077 (QuantReg: 13.03084) QuantErr: 13.03084 batch_time=0.93739 
Train Epoch: 28 [34/250 4352/32000 (14%)] Loss: 2.84275 (QuantReg: 13.11049) QuantErr: 13.11049 batch_time=0.96144 
Train Epoch: 28 [45/250 5760/32000 (18%)] Loss: 2.72072 (QuantReg: 12.91840) QuantErr: 12.91840 batch_time=0.92816 
Train Epoch: 28 [56/250 7168/32000 (22%)] Loss: 3.47220 (QuantReg: 12.71601) QuantErr: 12.71601 batch_time=1.05555 
Train Epoch: 28 [67/250 8576/32000 (27%)] Loss: 2.25893 (QuantReg: 13.15963) QuantErr: 13.15963 batch_time=2.82353 
Train Epoch: 28 [78/250 9984/32000 (31%)] Loss: 2.52476 (QuantReg: 13.07528) QuantErr: 13.07528 batch_time=0.93565 
Train Epoch: 28 [89/250 11392/32000 (36%)] Loss: 2.64006 (QuantReg: 12.84340) QuantErr: 12.84340 batch_time=0.94868 
Train Epoch: 28 [100/250 12800/32000 (40%)] Loss: 1.78696 (QuantReg: 13.36731) QuantErr: 13.36731 batch_time=0.95077 
Train Epoch: 28 [111/250 14208/32000 (44%)] Loss: 3.41022 (QuantReg: 13.01571) QuantErr: 13.01571 batch_time=0.93953 
Train Epoch: 28 [122/250 15616/32000 (49%)] Loss: 3.51936 (QuantReg: 13.13321) QuantErr: 13.13321 batch_time=1.00732 
Train Epoch: 28 [133/250 17024/32000 (53%)] Loss: 3.33320 (QuantReg: 13.14354) QuantErr: 13.14354 batch_time=0.93367 
Train Epoch: 28 [144/250 18432/32000 (58%)] Loss: 2.94550 (QuantReg: 13.00546) QuantErr: 13.00546 batch_time=1.00020 
Train Epoch: 28 [155/250 19840/32000 (62%)] Loss: 3.09144 (QuantReg: 12.68779) QuantErr: 12.68779 batch_time=0.94051 
Train Epoch: 28 [166/250 21248/32000 (66%)] Loss: 2.99000 (QuantReg: 13.01055) QuantErr: 13.01055 batch_time=0.94872 
Train Epoch: 28 [177/250 22656/32000 (71%)] Loss: 3.20771 (QuantReg: 13.05147) QuantErr: 13.05147 batch_time=0.93071 
Train Epoch: 28 [188/250 24064/32000 (75%)] Loss: 3.39757 (QuantReg: 13.04283) QuantErr: 13.04283 batch_time=0.93208 
Train Epoch: 28 [199/250 25472/32000 (80%)] Loss: 3.03201 (QuantReg: 13.17911) QuantErr: 13.17911 batch_time=0.95788 
Train Epoch: 28 [210/250 26880/32000 (84%)] Loss: 3.08772 (QuantReg: 13.05846) QuantErr: 13.05846 batch_time=1.00314 
Train Epoch: 28 [221/250 28288/32000 (88%)] Loss: 3.29609 (QuantReg: 12.96517) QuantErr: 12.96517 batch_time=0.94014 
Train Epoch: 28 [232/250 29696/32000 (93%)] Loss: 2.61814 (QuantReg: 13.00419) QuantErr: 13.00419 batch_time=1.09254 
Train Epoch: 28 [243/250 31104/32000 (97%)] Loss: 2.85008 (QuantReg: 12.90894) QuantErr: 12.90894 batch_time=1.42068 
Train Epoch: 28 codebook_update_time=8.81747
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch28.pth ...
Done in 4.392s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch28.pth ...
Done in 17.411s
removing stale ckpt [epoch 27] [took 0.08s]
 epoch          : 28
 loss           : 3.095123528003693
 quant_reg      : 13.013829135894776
 quant_err      : 13.013829135894776
 learning_rate  : 1.2517204487122746e-05
 n_samples      : 896000
 n_steps        : 7000
 MSRVTT_full_val/t2v_metrics/R1: 30.784708249496983
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.2635814889336014
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.28731286472216
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 89.33601609657947
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.293762575452717
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.859200312990836
 MSRVTT_full_test/t2v_metrics/R1: 13.91304347826087
 MSRVTT_full_test/t2v_metrics/R5: 36.82274247491639
 MSRVTT_full_test/t2v_metrics/R10: 50.802675585284284
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.71973244147157
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.635228908246415
 MSRVTT_full_test/v2t_metrics/R1: 17.05685618729097
 MSRVTT_full_test/v2t_metrics/R5: 44.98327759197324
 MSRVTT_full_test/v2t_metrics/R10: 59.59866220735786
 MSRVTT_full_test/v2t_metrics/R50: 88.12709030100335
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.807023411371237
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.75983709782716
 mnt_best       : 29.635228908246415
 not_improved_count: 0
Train Epoch: 29 [1/250 128/32000 (0%)] Loss: 2.79414 (QuantReg: 12.96809) QuantErr: 12.96809 batch_time=29.70866 
Train Epoch: 29 [12/250 1536/32000 (5%)] Loss: 3.39669 (QuantReg: 12.63865) QuantErr: 12.63865 batch_time=0.94440 
Train Epoch: 29 [23/250 2944/32000 (9%)] Loss: 3.46398 (QuantReg: 12.74964) QuantErr: 12.74964 batch_time=0.92380 
Train Epoch: 29 [34/250 4352/32000 (14%)] Loss: 3.35279 (QuantReg: 13.18955) QuantErr: 13.18955 batch_time=1.03768 
Train Epoch: 29 [45/250 5760/32000 (18%)] Loss: 3.53645 (QuantReg: 13.08776) QuantErr: 13.08776 batch_time=0.93511 
Train Epoch: 29 [56/250 7168/32000 (22%)] Loss: 2.81878 (QuantReg: 13.14550) QuantErr: 13.14550 batch_time=0.93532 
Train Epoch: 29 [67/250 8576/32000 (27%)] Loss: 3.29286 (QuantReg: 12.90239) QuantErr: 12.90239 batch_time=0.99320 
Train Epoch: 29 [78/250 9984/32000 (31%)] Loss: 3.29424 (QuantReg: 13.07852) QuantErr: 13.07852 batch_time=0.94412 
Train Epoch: 29 [89/250 11392/32000 (36%)] Loss: 3.41045 (QuantReg: 12.91520) QuantErr: 12.91520 batch_time=0.93975 
Train Epoch: 29 [100/250 12800/32000 (40%)] Loss: 3.54464 (QuantReg: 13.14134) QuantErr: 13.14134 batch_time=0.94990 
Train Epoch: 29 [111/250 14208/32000 (44%)] Loss: 2.86762 (QuantReg: 13.34052) QuantErr: 13.34052 batch_time=0.92283 
Train Epoch: 29 [122/250 15616/32000 (49%)] Loss: 2.73844 (QuantReg: 13.19421) QuantErr: 13.19421 batch_time=0.94429 
Train Epoch: 29 [133/250 17024/32000 (53%)] Loss: 2.38977 (QuantReg: 12.96452) QuantErr: 12.96452 batch_time=2.92968 
Train Epoch: 29 [144/250 18432/32000 (58%)] Loss: 4.27053 (QuantReg: 12.97981) QuantErr: 12.97981 batch_time=2.01699 
Train Epoch: 29 [155/250 19840/32000 (62%)] Loss: 2.93720 (QuantReg: 12.86661) QuantErr: 12.86661 batch_time=0.97039 
Train Epoch: 29 [166/250 21248/32000 (66%)] Loss: 3.59193 (QuantReg: 13.09475) QuantErr: 13.09475 batch_time=0.93825 
Train Epoch: 29 [177/250 22656/32000 (71%)] Loss: 2.62158 (QuantReg: 13.28131) QuantErr: 13.28131 batch_time=0.94626 
Train Epoch: 29 [188/250 24064/32000 (75%)] Loss: 3.23504 (QuantReg: 13.01476) QuantErr: 13.01476 batch_time=0.93727 
Train Epoch: 29 [199/250 25472/32000 (80%)] Loss: 3.39006 (QuantReg: 12.78643) QuantErr: 12.78643 batch_time=0.94108 
Train Epoch: 29 [210/250 26880/32000 (84%)] Loss: 3.29951 (QuantReg: 12.98152) QuantErr: 12.98152 batch_time=0.95754 
Train Epoch: 29 [221/250 28288/32000 (88%)] Loss: 3.06554 (QuantReg: 13.27121) QuantErr: 13.27121 batch_time=0.95434 
Train Epoch: 29 [232/250 29696/32000 (93%)] Loss: 3.01366 (QuantReg: 13.02285) QuantErr: 13.02285 batch_time=0.95555 
Train Epoch: 29 [243/250 31104/32000 (97%)] Loss: 2.81748 (QuantReg: 13.09001) QuantErr: 13.09001 batch_time=1.00138 
Train Epoch: 29 codebook_update_time=7.96327
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch29.pth ...
Done in 13.780s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch29.pth ...
Done in 18.617s
removing stale ckpt [epoch 28] [took 0.00s]
 epoch          : 29
 loss           : 3.174605655670166
 quant_reg      : 13.01498498916626
 quant_err      : 13.01498498916626
 learning_rate  : 1.1891344262766608e-05
 n_samples      : 928000
 n_steps        : 7250
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 71.22736418511066
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.285714285714286
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.28466252913922
 MSRVTT_full_val/v2t_metrics/R1: 39.436619718309856
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.629778672032193
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.24896314303686
 MSRVTT_full_test/t2v_metrics/R1: 14.280936454849499
 MSRVTT_full_test/t2v_metrics/R5: 37.290969899665555
 MSRVTT_full_test/t2v_metrics/R10: 52.0066889632107
 MSRVTT_full_test/t2v_metrics/R50: 81.60535117056857
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.61806020066889
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.255652509797745
 MSRVTT_full_test/v2t_metrics/R1: 16.82274247491639
 MSRVTT_full_test/v2t_metrics/R5: 44.91638795986622
 MSRVTT_full_test/v2t_metrics/R10: 57.9933110367893
 MSRVTT_full_test/v2t_metrics/R50: 87.123745819398
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.623076923076923
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.255469990599394
 mnt_best       : 30.255652509797745
 not_improved_count: 0
Train Epoch: 30 [1/250 128/32000 (0%)] Loss: 3.29739 (QuantReg: 13.05477) QuantErr: 13.05477 batch_time=30.72478 
Train Epoch: 30 [12/250 1536/32000 (5%)] Loss: 3.59851 (QuantReg: 13.16697) QuantErr: 13.16697 batch_time=0.94828 
Train Epoch: 30 [23/250 2944/32000 (9%)] Loss: 3.53866 (QuantReg: 12.85512) QuantErr: 12.85512 batch_time=0.98062 
Train Epoch: 30 [34/250 4352/32000 (14%)] Loss: 3.35088 (QuantReg: 12.85244) QuantErr: 12.85244 batch_time=0.94562 
Train Epoch: 30 [45/250 5760/32000 (18%)] Loss: 3.47747 (QuantReg: 12.90951) QuantErr: 12.90951 batch_time=0.92583 
Train Epoch: 30 [56/250 7168/32000 (22%)] Loss: 3.12688 (QuantReg: 12.96762) QuantErr: 12.96762 batch_time=0.95661 
Train Epoch: 30 [67/250 8576/32000 (27%)] Loss: 3.47090 (QuantReg: 12.76780) QuantErr: 12.76780 batch_time=3.67553 
Train Epoch: 30 [78/250 9984/32000 (31%)] Loss: 4.04977 (QuantReg: 12.92798) QuantErr: 12.92798 batch_time=0.93945 
Train Epoch: 30 [89/250 11392/32000 (36%)] Loss: 3.10393 (QuantReg: 12.86115) QuantErr: 12.86115 batch_time=2.92281 
Train Epoch: 30 [100/250 12800/32000 (40%)] Loss: 3.39511 (QuantReg: 13.00445) QuantErr: 13.00445 batch_time=1.55897 
Train Epoch: 30 [111/250 14208/32000 (44%)] Loss: 3.36940 (QuantReg: 12.70110) QuantErr: 12.70110 batch_time=0.93662 
Train Epoch: 30 [122/250 15616/32000 (49%)] Loss: 2.99187 (QuantReg: 12.98362) QuantErr: 12.98362 batch_time=0.93753 
Train Epoch: 30 [133/250 17024/32000 (53%)] Loss: 3.01591 (QuantReg: 13.14487) QuantErr: 13.14487 batch_time=0.98448 
Train Epoch: 30 [144/250 18432/32000 (58%)] Loss: 3.09962 (QuantReg: 13.10047) QuantErr: 13.10047 batch_time=0.96013 
Train Epoch: 30 [155/250 19840/32000 (62%)] Loss: 2.91255 (QuantReg: 13.13942) QuantErr: 13.13942 batch_time=0.97366 
Train Epoch: 30 [166/250 21248/32000 (66%)] Loss: 3.43447 (QuantReg: 13.09155) QuantErr: 13.09155 batch_time=0.93064 
Train Epoch: 30 [177/250 22656/32000 (71%)] Loss: 3.20027 (QuantReg: 13.17496) QuantErr: 13.17496 batch_time=0.94473 
Train Epoch: 30 [188/250 24064/32000 (75%)] Loss: 3.18562 (QuantReg: 12.76915) QuantErr: 12.76915 batch_time=0.94556 
Train Epoch: 30 [199/250 25472/32000 (80%)] Loss: 3.01726 (QuantReg: 12.99777) QuantErr: 12.99777 batch_time=1.08384 
Train Epoch: 30 [210/250 26880/32000 (84%)] Loss: 3.09964 (QuantReg: 13.09036) QuantErr: 13.09036 batch_time=0.95309 
Train Epoch: 30 [221/250 28288/32000 (88%)] Loss: 2.63313 (QuantReg: 13.07904) QuantErr: 13.07904 batch_time=0.95134 
Train Epoch: 30 [232/250 29696/32000 (93%)] Loss: 2.80103 (QuantReg: 13.28533) QuantErr: 13.28533 batch_time=0.90644 
Train Epoch: 30 [243/250 31104/32000 (97%)] Loss: 2.64591 (QuantReg: 13.33863) QuantErr: 13.33863 batch_time=0.94248 
Train Epoch: 30 codebook_update_time=7.77611
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch30.pth ...
Done in 3.976s
removing stale ckpt [epoch 29] [took 0.02s]
 epoch          : 30
 loss           : 3.0964679260253907
 quant_reg      : 13.04031132888794
 quant_err      : 13.04031132888794
 learning_rate  : 1.1296777049628277e-05
 n_samples      : 960000
 n_steps        : 7500
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.325955734406438
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.19357626183012
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.12273641851107
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.575452716297787
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.43090499229213
 MSRVTT_full_test/t2v_metrics/R1: 14.214046822742475
 MSRVTT_full_test/t2v_metrics/R5: 36.68896321070234
 MSRVTT_full_test/t2v_metrics/R10: 51.80602006688963
 MSRVTT_full_test/t2v_metrics/R50: 81.33779264214047
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.298996655518394
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.00620947693935
 MSRVTT_full_test/v2t_metrics/R1: 17.090301003344482
 MSRVTT_full_test/v2t_metrics/R5: 44.280936454849495
 MSRVTT_full_test/v2t_metrics/R10: 58.46153846153846
 MSRVTT_full_test/v2t_metrics/R50: 86.88963210702342
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.92675585284281
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.36814232293851
 mnt_best       : 30.255652509797745
 not_improved_count: 1
Train Epoch: 31 [1/250 128/32000 (0%)] Loss: 3.79306 (QuantReg: 12.91434) QuantErr: 12.91434 batch_time=33.77367 
Train Epoch: 31 [12/250 1536/32000 (5%)] Loss: 3.08049 (QuantReg: 12.83871) QuantErr: 12.83871 batch_time=0.97137 
Train Epoch: 31 [23/250 2944/32000 (9%)] Loss: 2.67570 (QuantReg: 12.84446) QuantErr: 12.84446 batch_time=0.95187 
Train Epoch: 31 [34/250 4352/32000 (14%)] Loss: 3.74999 (QuantReg: 12.82863) QuantErr: 12.82863 batch_time=0.92028 
Train Epoch: 31 [45/250 5760/32000 (18%)] Loss: 2.71539 (QuantReg: 13.08574) QuantErr: 13.08574 batch_time=0.92536 
Train Epoch: 31 [56/250 7168/32000 (22%)] Loss: 3.47842 (QuantReg: 12.93758) QuantErr: 12.93758 batch_time=0.95111 
Train Epoch: 31 [67/250 8576/32000 (27%)] Loss: 2.75631 (QuantReg: 13.09745) QuantErr: 13.09745 batch_time=0.93526 
Train Epoch: 31 [78/250 9984/32000 (31%)] Loss: 2.67808 (QuantReg: 12.95601) QuantErr: 12.95601 batch_time=0.93020 
Train Epoch: 31 [89/250 11392/32000 (36%)] Loss: 2.51910 (QuantReg: 13.02020) QuantErr: 13.02020 batch_time=0.93506 
Train Epoch: 31 [100/250 12800/32000 (40%)] Loss: 3.94127 (QuantReg: 13.02544) QuantErr: 13.02544 batch_time=0.98214 
Train Epoch: 31 [111/250 14208/32000 (44%)] Loss: 3.64301 (QuantReg: 12.80897) QuantErr: 12.80897 batch_time=0.95687 
Train Epoch: 31 [122/250 15616/32000 (49%)] Loss: 2.68893 (QuantReg: 13.32736) QuantErr: 13.32736 batch_time=0.93621 
Train Epoch: 31 [133/250 17024/32000 (53%)] Loss: 3.13877 (QuantReg: 13.04301) QuantErr: 13.04301 batch_time=0.93075 
Train Epoch: 31 [144/250 18432/32000 (58%)] Loss: 2.82727 (QuantReg: 12.86373) QuantErr: 12.86373 batch_time=4.76140 
Train Epoch: 31 [155/250 19840/32000 (62%)] Loss: 2.91636 (QuantReg: 13.19099) QuantErr: 13.19099 batch_time=0.93669 
Train Epoch: 31 [166/250 21248/32000 (66%)] Loss: 4.01893 (QuantReg: 12.71774) QuantErr: 12.71774 batch_time=0.92880 
Train Epoch: 31 [177/250 22656/32000 (71%)] Loss: 2.89061 (QuantReg: 13.41315) QuantErr: 13.41315 batch_time=1.22664 
Train Epoch: 31 [188/250 24064/32000 (75%)] Loss: 2.53455 (QuantReg: 13.09019) QuantErr: 13.09019 batch_time=0.94680 
Train Epoch: 31 [199/250 25472/32000 (80%)] Loss: 3.15679 (QuantReg: 13.14886) QuantErr: 13.14886 batch_time=0.95392 
Train Epoch: 31 [210/250 26880/32000 (84%)] Loss: 2.40655 (QuantReg: 12.86740) QuantErr: 12.86740 batch_time=0.92960 
Train Epoch: 31 [221/250 28288/32000 (88%)] Loss: 2.78173 (QuantReg: 13.13877) QuantErr: 13.13877 batch_time=0.92675 
Train Epoch: 31 [232/250 29696/32000 (93%)] Loss: 2.50477 (QuantReg: 12.89706) QuantErr: 12.89706 batch_time=0.95889 
Train Epoch: 31 [243/250 31104/32000 (97%)] Loss: 3.44324 (QuantReg: 12.60481) QuantErr: 12.60481 batch_time=0.94043 
Train Epoch: 31 codebook_update_time=8.83460
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch31.pth ...
Done in 3.969s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch31.pth ...
Done in 7.688s
removing stale ckpt [epoch 30] [took 0.00s]
 epoch          : 31
 loss           : 3.0705652446746825
 quant_reg      : 13.047991523742676
 quant_err      : 13.047991523742676
 learning_rate  : 1.0731938197146863e-05
 n_samples      : 992000
 n_steps        : 7750
 MSRVTT_full_val/t2v_metrics/R1: 31.187122736418512
 MSRVTT_full_val/t2v_metrics/R5: 68.61167002012073
 MSRVTT_full_val/t2v_metrics/R10: 80.6841046277666
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.3480885311871225
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.6827182359815
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 86.31790744466801
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.714285714285714
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.855882028436994
 MSRVTT_full_test/t2v_metrics/R1: 14.247491638795987
 MSRVTT_full_test/t2v_metrics/R5: 37.625418060200666
 MSRVTT_full_test/t2v_metrics/R10: 52.17391304347826
 MSRVTT_full_test/t2v_metrics/R50: 82.04013377926421
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.247491638795985
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.35459096118159
 MSRVTT_full_test/v2t_metrics/R1: 16.722408026755854
 MSRVTT_full_test/v2t_metrics/R5: 44.98327759197324
 MSRVTT_full_test/v2t_metrics/R10: 58.52842809364549
 MSRVTT_full_test/v2t_metrics/R50: 87.45819397993311
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.62408026755853
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.31064013331709
 mnt_best       : 30.35459096118159
 not_improved_count: 0
Train Epoch: 32 [1/250 128/32000 (0%)] Loss: 2.33713 (QuantReg: 13.00812) QuantErr: 13.00812 batch_time=36.34887 
Train Epoch: 32 [12/250 1536/32000 (5%)] Loss: 2.88055 (QuantReg: 13.15065) QuantErr: 13.15065 batch_time=1.04040 
Train Epoch: 32 [23/250 2944/32000 (9%)] Loss: 3.01812 (QuantReg: 12.86827) QuantErr: 12.86827 batch_time=1.28287 
Train Epoch: 32 [34/250 4352/32000 (14%)] Loss: 3.03809 (QuantReg: 13.21451) QuantErr: 13.21451 batch_time=1.65634 
Train Epoch: 32 [45/250 5760/32000 (18%)] Loss: 2.95531 (QuantReg: 13.10982) QuantErr: 13.10982 batch_time=0.93039 
Train Epoch: 32 [56/250 7168/32000 (22%)] Loss: 2.44732 (QuantReg: 13.26855) QuantErr: 13.26855 batch_time=0.93842 
Train Epoch: 32 [67/250 8576/32000 (27%)] Loss: 2.87377 (QuantReg: 13.17742) QuantErr: 13.17742 batch_time=0.91329 
Train Epoch: 32 [78/250 9984/32000 (31%)] Loss: 4.09272 (QuantReg: 13.17509) QuantErr: 13.17509 batch_time=0.97599 
Train Epoch: 32 [89/250 11392/32000 (36%)] Loss: 3.14730 (QuantReg: 13.13754) QuantErr: 13.13754 batch_time=1.20692 
Train Epoch: 32 [100/250 12800/32000 (40%)] Loss: 3.22264 (QuantReg: 13.20280) QuantErr: 13.20280 batch_time=1.00992 
Train Epoch: 32 [111/250 14208/32000 (44%)] Loss: 2.77263 (QuantReg: 13.25020) QuantErr: 13.25020 batch_time=0.95599 
Train Epoch: 32 [122/250 15616/32000 (49%)] Loss: 2.90409 (QuantReg: 13.07020) QuantErr: 13.07020 batch_time=0.93078 
Train Epoch: 32 [133/250 17024/32000 (53%)] Loss: 3.23205 (QuantReg: 13.38003) QuantErr: 13.38003 batch_time=0.96831 
Train Epoch: 32 [144/250 18432/32000 (58%)] Loss: 3.08013 (QuantReg: 13.11020) QuantErr: 13.11020 batch_time=2.74923 
Train Epoch: 32 [155/250 19840/32000 (62%)] Loss: 2.42484 (QuantReg: 13.21843) QuantErr: 13.21843 batch_time=0.94376 
Train Epoch: 32 [166/250 21248/32000 (66%)] Loss: 2.41614 (QuantReg: 13.21921) QuantErr: 13.21921 batch_time=0.98260 
Train Epoch: 32 [177/250 22656/32000 (71%)] Loss: 2.82131 (QuantReg: 13.06894) QuantErr: 13.06894 batch_time=0.96259 
Train Epoch: 32 [188/250 24064/32000 (75%)] Loss: 2.65989 (QuantReg: 13.28074) QuantErr: 13.28074 batch_time=1.00965 
Train Epoch: 32 [199/250 25472/32000 (80%)] Loss: 3.20474 (QuantReg: 13.25741) QuantErr: 13.25741 batch_time=0.93134 
Train Epoch: 32 [210/250 26880/32000 (84%)] Loss: 3.04856 (QuantReg: 12.99062) QuantErr: 12.99062 batch_time=0.93806 
Train Epoch: 32 [221/250 28288/32000 (88%)] Loss: 3.09662 (QuantReg: 13.28096) QuantErr: 13.28096 batch_time=0.93279 
Train Epoch: 32 [232/250 29696/32000 (93%)] Loss: 2.77967 (QuantReg: 13.19593) QuantErr: 13.19593 batch_time=0.93362 
Train Epoch: 32 [243/250 31104/32000 (97%)] Loss: 2.99742 (QuantReg: 12.83750) QuantErr: 12.83750 batch_time=0.94395 
Train Epoch: 32 codebook_update_time=9.05986
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch32.pth ...
Done in 3.981s
removing stale ckpt [epoch 31] [took 0.00s]
 epoch          : 32
 loss           : 3.0186473779678344
 quant_reg      : 13.105593441009521
 quant_err      : 13.105593441009521
 learning_rate  : 1.019534128728952e-05
 n_samples      : 1024000
 n_steps        : 8000
 MSRVTT_full_val/t2v_metrics/R1: 30.985915492957748
 MSRVTT_full_val/t2v_metrics/R5: 67.6056338028169
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.702213279678069
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.70038917632867
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.738430583501006
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.80917869847878
 MSRVTT_full_test/t2v_metrics/R1: 13.74581939799331
 MSRVTT_full_test/t2v_metrics/R5: 36.58862876254181
 MSRVTT_full_test/t2v_metrics/R10: 51.438127090301
 MSRVTT_full_test/t2v_metrics/R50: 80.63545150501672
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 45.05886287625418
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.575627753392563
 MSRVTT_full_test/v2t_metrics/R1: 17.32441471571906
 MSRVTT_full_test/v2t_metrics/R5: 44.381270903010034
 MSRVTT_full_test/v2t_metrics/R10: 58.862876254180605
 MSRVTT_full_test/v2t_metrics/R50: 86.75585284280936
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.098996655518395
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.636900828394744
 mnt_best       : 30.35459096118159
 not_improved_count: 1
Train Epoch: 33 [1/250 128/32000 (0%)] Loss: 3.03053 (QuantReg: 12.55142) QuantErr: 12.55142 batch_time=31.50465 
Train Epoch: 33 [12/250 1536/32000 (5%)] Loss: 2.96695 (QuantReg: 13.00025) QuantErr: 13.00025 batch_time=0.94468 
Train Epoch: 33 [23/250 2944/32000 (9%)] Loss: 2.33485 (QuantReg: 13.19515) QuantErr: 13.19515 batch_time=0.94439 
Train Epoch: 33 [34/250 4352/32000 (14%)] Loss: 1.86616 (QuantReg: 13.39310) QuantErr: 13.39310 batch_time=0.94155 
Train Epoch: 33 [45/250 5760/32000 (18%)] Loss: 2.37105 (QuantReg: 13.04535) QuantErr: 13.04535 batch_time=0.90825 
Train Epoch: 33 [56/250 7168/32000 (22%)] Loss: 2.54038 (QuantReg: 13.35968) QuantErr: 13.35968 batch_time=0.98904 
Train Epoch: 33 [67/250 8576/32000 (27%)] Loss: 2.77672 (QuantReg: 13.16249) QuantErr: 13.16249 batch_time=0.97990 
Train Epoch: 33 [78/250 9984/32000 (31%)] Loss: 3.04634 (QuantReg: 13.00269) QuantErr: 13.00269 batch_time=1.07771 
Train Epoch: 33 [89/250 11392/32000 (36%)] Loss: 3.77286 (QuantReg: 12.96169) QuantErr: 12.96169 batch_time=0.97290 
Train Epoch: 33 [100/250 12800/32000 (40%)] Loss: 2.70203 (QuantReg: 13.10678) QuantErr: 13.10678 batch_time=0.95916 
Train Epoch: 33 [111/250 14208/32000 (44%)] Loss: 3.24907 (QuantReg: 13.28746) QuantErr: 13.28746 batch_time=0.95223 
Train Epoch: 33 [122/250 15616/32000 (49%)] Loss: 3.15305 (QuantReg: 13.19302) QuantErr: 13.19302 batch_time=0.93049 
Train Epoch: 33 [133/250 17024/32000 (53%)] Loss: 2.99071 (QuantReg: 13.52813) QuantErr: 13.52813 batch_time=0.96264 
Train Epoch: 33 [144/250 18432/32000 (58%)] Loss: 2.98766 (QuantReg: 13.00427) QuantErr: 13.00427 batch_time=0.90731 
Train Epoch: 33 [155/250 19840/32000 (62%)] Loss: 2.02812 (QuantReg: 12.88574) QuantErr: 12.88574 batch_time=1.03194 
Train Epoch: 33 [166/250 21248/32000 (66%)] Loss: 2.51772 (QuantReg: 13.27360) QuantErr: 13.27360 batch_time=0.92477 
Train Epoch: 33 [177/250 22656/32000 (71%)] Loss: 2.94263 (QuantReg: 13.07741) QuantErr: 13.07741 batch_time=0.92432 
Train Epoch: 33 [188/250 24064/32000 (75%)] Loss: 2.80139 (QuantReg: 13.23210) QuantErr: 13.23210 batch_time=0.96181 
Train Epoch: 33 [199/250 25472/32000 (80%)] Loss: 3.00878 (QuantReg: 12.99815) QuantErr: 12.99815 batch_time=0.95023 
Train Epoch: 33 [210/250 26880/32000 (84%)] Loss: 3.23272 (QuantReg: 13.14854) QuantErr: 13.14854 batch_time=3.18916 
Train Epoch: 33 [221/250 28288/32000 (88%)] Loss: 2.47668 (QuantReg: 12.98179) QuantErr: 12.98179 batch_time=0.95651 
Train Epoch: 33 [232/250 29696/32000 (93%)] Loss: 2.76165 (QuantReg: 13.08214) QuantErr: 13.08214 batch_time=0.94234 
Train Epoch: 33 [243/250 31104/32000 (97%)] Loss: 2.66279 (QuantReg: 13.27087) QuantErr: 13.27087 batch_time=0.94903 
Train Epoch: 33 codebook_update_time=8.61307
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch33.pth ...
Done in 15.618s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch33.pth ...
Done in 19.500s
removing stale ckpt [epoch 32] [took 0.00s]
 epoch          : 33
 loss           : 2.992811317920685
 quant_reg      : 13.106662395477295
 quant_err      : 13.106662395477295
 learning_rate  : 9.685574222925043e-06
 n_samples      : 1056000
 n_steps        : 8250
 MSRVTT_full_val/t2v_metrics/R1: 30.784708249496983
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.3480885311871225
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 55.90844446961763
 MSRVTT_full_val/v2t_metrics/R1: 38.028169014084504
 MSRVTT_full_val/v2t_metrics/R5: 75.65392354124748
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.593561368209255
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 62.9534087667324
 MSRVTT_full_test/t2v_metrics/R1: 14.548494983277592
 MSRVTT_full_test/t2v_metrics/R5: 37.525083612040135
 MSRVTT_full_test/t2v_metrics/R10: 52.675585284280935
 MSRVTT_full_test/t2v_metrics/R50: 82.10702341137124
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.68929765886288
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.637244491244044
 MSRVTT_full_test/v2t_metrics/R1: 17.49163879598662
 MSRVTT_full_test/v2t_metrics/R5: 44.8494983277592
 MSRVTT_full_test/v2t_metrics/R10: 59.163879598662206
 MSRVTT_full_test/v2t_metrics/R50: 86.52173913043478
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.270903010033443
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.9375316806423
 mnt_best       : 30.637244491244044
 not_improved_count: 0
Train Epoch: 34 [1/250 128/32000 (0%)] Loss: 3.42373 (QuantReg: 13.04001) QuantErr: 13.04001 batch_time=34.97758 
Train Epoch: 34 [12/250 1536/32000 (5%)] Loss: 3.12448 (QuantReg: 13.05765) QuantErr: 13.05765 batch_time=1.00803 
Train Epoch: 34 [23/250 2944/32000 (9%)] Loss: 2.32384 (QuantReg: 13.29735) QuantErr: 13.29735 batch_time=0.93330 
Train Epoch: 34 [34/250 4352/32000 (14%)] Loss: 3.00817 (QuantReg: 13.20885) QuantErr: 13.20885 batch_time=0.93687 
Train Epoch: 34 [45/250 5760/32000 (18%)] Loss: 3.16849 (QuantReg: 13.23821) QuantErr: 13.23821 batch_time=0.90985 
Train Epoch: 34 [56/250 7168/32000 (22%)] Loss: 2.64497 (QuantReg: 13.24028) QuantErr: 13.24028 batch_time=0.94443 
Train Epoch: 34 [67/250 8576/32000 (27%)] Loss: 2.44482 (QuantReg: 13.11260) QuantErr: 13.11260 batch_time=1.21664 
Train Epoch: 34 [78/250 9984/32000 (31%)] Loss: 2.56263 (QuantReg: 13.12447) QuantErr: 13.12447 batch_time=0.96939 
Train Epoch: 34 [89/250 11392/32000 (36%)] Loss: 2.84071 (QuantReg: 13.05097) QuantErr: 13.05097 batch_time=1.55310 
Train Epoch: 34 [100/250 12800/32000 (40%)] Loss: 3.04653 (QuantReg: 13.26127) QuantErr: 13.26127 batch_time=0.90672 
Train Epoch: 34 [111/250 14208/32000 (44%)] Loss: 3.31319 (QuantReg: 13.34323) QuantErr: 13.34323 batch_time=0.93334 
Train Epoch: 34 [122/250 15616/32000 (49%)] Loss: 2.61087 (QuantReg: 13.13412) QuantErr: 13.13412 batch_time=0.94395 
Train Epoch: 34 [133/250 17024/32000 (53%)] Loss: 3.56520 (QuantReg: 13.29044) QuantErr: 13.29044 batch_time=0.92906 
Train Epoch: 34 [144/250 18432/32000 (58%)] Loss: 2.48987 (QuantReg: 12.95415) QuantErr: 12.95415 batch_time=1.64164 
Train Epoch: 34 [155/250 19840/32000 (62%)] Loss: 3.13597 (QuantReg: 13.21238) QuantErr: 13.21238 batch_time=1.53820 
Train Epoch: 34 [166/250 21248/32000 (66%)] Loss: 3.48975 (QuantReg: 13.40460) QuantErr: 13.40460 batch_time=0.93555 
Train Epoch: 34 [177/250 22656/32000 (71%)] Loss: 3.28572 (QuantReg: 13.10930) QuantErr: 13.10930 batch_time=0.94257 
Train Epoch: 34 [188/250 24064/32000 (75%)] Loss: 3.12550 (QuantReg: 12.83444) QuantErr: 12.83444 batch_time=0.96618 
Train Epoch: 34 [199/250 25472/32000 (80%)] Loss: 3.04478 (QuantReg: 13.10233) QuantErr: 13.10233 batch_time=0.91198 
Train Epoch: 34 [210/250 26880/32000 (84%)] Loss: 2.73915 (QuantReg: 13.31705) QuantErr: 13.31705 batch_time=0.93146 
Train Epoch: 34 [221/250 28288/32000 (88%)] Loss: 2.65364 (QuantReg: 13.10778) QuantErr: 13.10778 batch_time=0.91663 
Train Epoch: 34 [232/250 29696/32000 (93%)] Loss: 2.15446 (QuantReg: 13.13710) QuantErr: 13.13710 batch_time=0.91436 
Train Epoch: 34 [243/250 31104/32000 (97%)] Loss: 3.59574 (QuantReg: 13.20374) QuantErr: 13.20374 batch_time=0.94578 
Train Epoch: 34 codebook_update_time=8.01713
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch34.pth ...
Done in 5.123s
removing stale ckpt [epoch 33] [took 0.00s]
 epoch          : 34
 loss           : 3.043957200050354
 quant_reg      : 13.09329294204712
 quant_err      : 13.09329294204712
 learning_rate  : 9.20129551177879e-06
 n_samples      : 1088000
 n_steps        : 8500
 MSRVTT_full_val/t2v_metrics/R1: 31.99195171026157
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 81.08651911468813
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.6800804828973845
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.46994522070871
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 75.85513078470825
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.59154929577464
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.71830985915493
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.42565137390188
 MSRVTT_full_test/t2v_metrics/R1: 13.879598662207357
 MSRVTT_full_test/t2v_metrics/R5: 36.42140468227425
 MSRVTT_full_test/t2v_metrics/R10: 50.702341137123746
 MSRVTT_full_test/t2v_metrics/R50: 81.07023411371237
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.08227424749164
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.484054429429968
 MSRVTT_full_test/v2t_metrics/R1: 16.8561872909699
 MSRVTT_full_test/v2t_metrics/R5: 44.34782608695652
 MSRVTT_full_test/v2t_metrics/R10: 58.19397993311037
 MSRVTT_full_test/v2t_metrics/R50: 87.19063545150502
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.987959866220734
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.169801294494576
 mnt_best       : 30.637244491244044
 not_improved_count: 1
Train Epoch: 35 [1/250 128/32000 (0%)] Loss: 2.80709 (QuantReg: 12.99387) QuantErr: 12.99387 batch_time=30.19576 
Train Epoch: 35 [12/250 1536/32000 (5%)] Loss: 3.76762 (QuantReg: 12.99804) QuantErr: 12.99804 batch_time=3.46848 
Train Epoch: 35 [23/250 2944/32000 (9%)] Loss: 3.86144 (QuantReg: 13.08380) QuantErr: 13.08380 batch_time=0.92514 
Train Epoch: 35 [34/250 4352/32000 (14%)] Loss: 2.97388 (QuantReg: 13.05596) QuantErr: 13.05596 batch_time=0.93189 
Train Epoch: 35 [45/250 5760/32000 (18%)] Loss: 3.17722 (QuantReg: 12.95126) QuantErr: 12.95126 batch_time=0.92094 
Train Epoch: 35 [56/250 7168/32000 (22%)] Loss: 2.47575 (QuantReg: 13.05791) QuantErr: 13.05791 batch_time=1.21583 
Train Epoch: 35 [67/250 8576/32000 (27%)] Loss: 2.63600 (QuantReg: 13.23771) QuantErr: 13.23771 batch_time=1.64590 
Train Epoch: 35 [78/250 9984/32000 (31%)] Loss: 2.64575 (QuantReg: 12.91947) QuantErr: 12.91947 batch_time=0.98122 
Train Epoch: 35 [89/250 11392/32000 (36%)] Loss: 2.34817 (QuantReg: 13.13530) QuantErr: 13.13530 batch_time=0.92327 
Train Epoch: 35 [100/250 12800/32000 (40%)] Loss: 2.77384 (QuantReg: 13.14415) QuantErr: 13.14415 batch_time=1.12213 
Train Epoch: 35 [111/250 14208/32000 (44%)] Loss: 3.09857 (QuantReg: 12.96545) QuantErr: 12.96545 batch_time=0.97104 
Train Epoch: 35 [122/250 15616/32000 (49%)] Loss: 3.54953 (QuantReg: 13.07891) QuantErr: 13.07891 batch_time=0.92998 
Train Epoch: 35 [133/250 17024/32000 (53%)] Loss: 3.28225 (QuantReg: 13.11318) QuantErr: 13.11318 batch_time=0.92787 
Train Epoch: 35 [144/250 18432/32000 (58%)] Loss: 2.59104 (QuantReg: 13.29442) QuantErr: 13.29442 batch_time=0.99014 
Train Epoch: 35 [155/250 19840/32000 (62%)] Loss: 3.18114 (QuantReg: 13.22095) QuantErr: 13.22095 batch_time=0.90761 
Train Epoch: 35 [166/250 21248/32000 (66%)] Loss: 3.24477 (QuantReg: 13.24355) QuantErr: 13.24355 batch_time=0.92648 
Train Epoch: 35 [177/250 22656/32000 (71%)] Loss: 2.86861 (QuantReg: 13.24567) QuantErr: 13.24567 batch_time=0.93246 
Train Epoch: 35 [188/250 24064/32000 (75%)] Loss: 3.36741 (QuantReg: 12.98075) QuantErr: 12.98075 batch_time=0.92655 
Train Epoch: 35 [199/250 25472/32000 (80%)] Loss: 3.78248 (QuantReg: 13.09212) QuantErr: 13.09212 batch_time=0.96659 
Train Epoch: 35 [210/250 26880/32000 (84%)] Loss: 3.20521 (QuantReg: 13.09961) QuantErr: 13.09961 batch_time=0.95946 
Train Epoch: 35 [221/250 28288/32000 (88%)] Loss: 2.48097 (QuantReg: 13.16417) QuantErr: 13.16417 batch_time=1.05839 
Train Epoch: 35 [232/250 29696/32000 (93%)] Loss: 3.15157 (QuantReg: 13.19230) QuantErr: 13.19230 batch_time=3.05881 
Train Epoch: 35 [243/250 31104/32000 (97%)] Loss: 3.13907 (QuantReg: 13.48569) QuantErr: 13.48569 batch_time=0.94447 
Train Epoch: 35 codebook_update_time=8.50020
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch35.pth ...
Done in 3.869s
removing stale ckpt [epoch 34] [took 0.00s]
 epoch          : 35
 loss           : 2.9862062721252443
 quant_reg      : 13.114876346588135
 quant_err      : 13.114876346588135
 learning_rate  : 8.74123073618985e-06
 n_samples      : 1120000
 n_steps        : 8750
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 68.2092555331992
 MSRVTT_full_val/t2v_metrics/R10: 82.897384305835
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.382293762575452
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.14223181428934
 MSRVTT_full_val/v2t_metrics/R1: 37.82696177062374
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.422535211267606
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.424770535480356
 MSRVTT_full_test/t2v_metrics/R1: 13.779264214046822
 MSRVTT_full_test/t2v_metrics/R5: 37.290969899665555
 MSRVTT_full_test/t2v_metrics/R10: 51.37123745819398
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.90100334448161
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.774872563643402
 MSRVTT_full_test/v2t_metrics/R1: 17.49163879598662
 MSRVTT_full_test/v2t_metrics/R5: 44.94983277591973
 MSRVTT_full_test/v2t_metrics/R10: 58.12709030100334
 MSRVTT_full_test/v2t_metrics/R50: 87.52508361204013
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.918060200668897
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.75299171333636
 mnt_best       : 30.637244491244044
 not_improved_count: 2
Train Epoch: 36 [1/250 128/32000 (0%)] Loss: 2.12520 (QuantReg: 13.26805) QuantErr: 13.26805 batch_time=31.03161 
Train Epoch: 36 [12/250 1536/32000 (5%)] Loss: 2.90993 (QuantReg: 12.82936) QuantErr: 12.82936 batch_time=0.94899 
Train Epoch: 36 [23/250 2944/32000 (9%)] Loss: 2.67761 (QuantReg: 13.11624) QuantErr: 13.11624 batch_time=0.91686 
Train Epoch: 36 [34/250 4352/32000 (14%)] Loss: 3.74562 (QuantReg: 12.94479) QuantErr: 12.94479 batch_time=0.92675 
Train Epoch: 36 [45/250 5760/32000 (18%)] Loss: 2.85258 (QuantReg: 12.98896) QuantErr: 12.98896 batch_time=0.91681 
Train Epoch: 36 [56/250 7168/32000 (22%)] Loss: 2.96506 (QuantReg: 12.97087) QuantErr: 12.97087 batch_time=0.92554 
Train Epoch: 36 [67/250 8576/32000 (27%)] Loss: 2.70239 (QuantReg: 13.23616) QuantErr: 13.23616 batch_time=1.73243 
Train Epoch: 36 [78/250 9984/32000 (31%)] Loss: 3.26076 (QuantReg: 13.00014) QuantErr: 13.00014 batch_time=0.90952 
Train Epoch: 36 [89/250 11392/32000 (36%)] Loss: 3.31084 (QuantReg: 13.18858) QuantErr: 13.18858 batch_time=0.95434 
Train Epoch: 36 [100/250 12800/32000 (40%)] Loss: 3.54576 (QuantReg: 13.19495) QuantErr: 13.19495 batch_time=0.94182 
Train Epoch: 36 [111/250 14208/32000 (44%)] Loss: 3.53343 (QuantReg: 13.15129) QuantErr: 13.15129 batch_time=1.14890 
Train Epoch: 36 [122/250 15616/32000 (49%)] Loss: 3.48218 (QuantReg: 13.15587) QuantErr: 13.15587 batch_time=0.92920 
Train Epoch: 36 [133/250 17024/32000 (53%)] Loss: 3.61354 (QuantReg: 13.13394) QuantErr: 13.13394 batch_time=0.93094 
Train Epoch: 36 [144/250 18432/32000 (58%)] Loss: 3.01546 (QuantReg: 13.05251) QuantErr: 13.05251 batch_time=0.91886 
Train Epoch: 36 [155/250 19840/32000 (62%)] Loss: 3.07731 (QuantReg: 13.16017) QuantErr: 13.16017 batch_time=0.99139 
Train Epoch: 36 [166/250 21248/32000 (66%)] Loss: 3.22847 (QuantReg: 13.14235) QuantErr: 13.14235 batch_time=0.98510 
Train Epoch: 36 [177/250 22656/32000 (71%)] Loss: 2.66527 (QuantReg: 12.95884) QuantErr: 12.95884 batch_time=0.93909 
Train Epoch: 36 [188/250 24064/32000 (75%)] Loss: 2.35829 (QuantReg: 13.08146) QuantErr: 13.08146 batch_time=0.92132 
Train Epoch: 36 [199/250 25472/32000 (80%)] Loss: 3.66259 (QuantReg: 13.09141) QuantErr: 13.09141 batch_time=0.93779 
Train Epoch: 36 [210/250 26880/32000 (84%)] Loss: 3.06037 (QuantReg: 13.06086) QuantErr: 13.06086 batch_time=0.91967 
Train Epoch: 36 [221/250 28288/32000 (88%)] Loss: 2.63800 (QuantReg: 13.56866) QuantErr: 13.56866 batch_time=0.95519 
Train Epoch: 36 [232/250 29696/32000 (93%)] Loss: 2.66780 (QuantReg: 13.22775) QuantErr: 13.22775 batch_time=0.93056 
Train Epoch: 36 [243/250 31104/32000 (97%)] Loss: 2.63590 (QuantReg: 13.14772) QuantErr: 13.14772 batch_time=0.95037 
Train Epoch: 36 codebook_update_time=8.51484
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch36.pth ...
Done in 3.893s
removing stale ckpt [epoch 35] [took 0.00s]
 epoch          : 36
 loss           : 2.91332639503479
 quant_reg      : 13.135624835968018
 quant_err      : 13.135624835968018
 learning_rate  : 8.304169199380357e-06
 n_samples      : 1152000
 n_steps        : 9000
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.551307847082495
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.464971283411415
 MSRVTT_full_val/v2t_metrics/R1: 38.43058350100603
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.806841046277666
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 63.766862878593
 MSRVTT_full_test/t2v_metrics/R1: 13.444816053511706
 MSRVTT_full_test/t2v_metrics/R5: 37.591973244147155
 MSRVTT_full_test/t2v_metrics/R10: 50.936454849498325
 MSRVTT_full_test/t2v_metrics/R50: 81.67224080267559
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.86086956521739
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.527469815689
 MSRVTT_full_test/v2t_metrics/R1: 17.82608695652174
 MSRVTT_full_test/v2t_metrics/R5: 45.585284280936456
 MSRVTT_full_test/v2t_metrics/R10: 58.896321070234116
 MSRVTT_full_test/v2t_metrics/R50: 87.22408026755853
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.625585284280938
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.30693758507496
 mnt_best       : 30.637244491244044
 not_improved_count: 3
Train Epoch: 37 [1/250 128/32000 (0%)] Loss: 2.40180 (QuantReg: 13.15828) QuantErr: 13.15828 batch_time=30.05461 
Train Epoch: 37 [12/250 1536/32000 (5%)] Loss: 2.97372 (QuantReg: 13.26014) QuantErr: 13.26014 batch_time=0.91842 
Train Epoch: 37 [23/250 2944/32000 (9%)] Loss: 2.32730 (QuantReg: 13.02014) QuantErr: 13.02014 batch_time=0.92323 
Train Epoch: 37 [34/250 4352/32000 (14%)] Loss: 3.04464 (QuantReg: 13.10001) QuantErr: 13.10001 batch_time=0.93235 
Train Epoch: 37 [45/250 5760/32000 (18%)] Loss: 3.20231 (QuantReg: 12.83172) QuantErr: 12.83172 batch_time=0.93378 
Train Epoch: 37 [56/250 7168/32000 (22%)] Loss: 3.75722 (QuantReg: 12.85333) QuantErr: 12.85333 batch_time=0.93261 
Train Epoch: 37 [67/250 8576/32000 (27%)] Loss: 3.76722 (QuantReg: 12.99371) QuantErr: 12.99371 batch_time=0.96246 
Train Epoch: 37 [78/250 9984/32000 (31%)] Loss: 3.00633 (QuantReg: 13.12137) QuantErr: 13.12137 batch_time=0.92603 
Train Epoch: 37 [89/250 11392/32000 (36%)] Loss: 3.29637 (QuantReg: 12.92572) QuantErr: 12.92572 batch_time=2.09697 
Train Epoch: 37 [100/250 12800/32000 (40%)] Loss: 3.13179 (QuantReg: 13.08747) QuantErr: 13.08747 batch_time=0.95256 
Train Epoch: 37 [111/250 14208/32000 (44%)] Loss: 3.12804 (QuantReg: 13.00836) QuantErr: 13.00836 batch_time=0.94031 
Train Epoch: 37 [122/250 15616/32000 (49%)] Loss: 2.27899 (QuantReg: 13.14892) QuantErr: 13.14892 batch_time=0.94855 
Train Epoch: 37 [133/250 17024/32000 (53%)] Loss: 2.46108 (QuantReg: 13.17815) QuantErr: 13.17815 batch_time=0.94276 
Train Epoch: 37 [144/250 18432/32000 (58%)] Loss: 2.54857 (QuantReg: 12.97201) QuantErr: 12.97201 batch_time=0.92615 
Train Epoch: 37 [155/250 19840/32000 (62%)] Loss: 2.64633 (QuantReg: 13.21856) QuantErr: 13.21856 batch_time=1.03369 
Train Epoch: 37 [166/250 21248/32000 (66%)] Loss: 3.20939 (QuantReg: 13.01434) QuantErr: 13.01434 batch_time=0.91883 
Train Epoch: 37 [177/250 22656/32000 (71%)] Loss: 2.80088 (QuantReg: 13.37497) QuantErr: 13.37497 batch_time=0.91942 
Train Epoch: 37 [188/250 24064/32000 (75%)] Loss: 3.46437 (QuantReg: 13.46310) QuantErr: 13.46310 batch_time=1.16700 
Train Epoch: 37 [199/250 25472/32000 (80%)] Loss: 4.01424 (QuantReg: 12.92725) QuantErr: 12.92725 batch_time=0.94647 
Train Epoch: 37 [210/250 26880/32000 (84%)] Loss: 2.39717 (QuantReg: 13.18701) QuantErr: 13.18701 batch_time=1.06392 
Train Epoch: 37 [221/250 28288/32000 (88%)] Loss: 2.98640 (QuantReg: 13.10020) QuantErr: 13.10020 batch_time=0.92204 
Train Epoch: 37 [232/250 29696/32000 (93%)] Loss: 2.82196 (QuantReg: 13.37226) QuantErr: 13.37226 batch_time=0.91331 
Train Epoch: 37 [243/250 31104/32000 (97%)] Loss: 3.20003 (QuantReg: 13.33207) QuantErr: 13.33207 batch_time=0.93786 
Train Epoch: 37 codebook_update_time=8.15781
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch37.pth ...
Done in 3.880s
removing stale ckpt [epoch 36] [took 0.00s]
 epoch          : 37
 loss           : 2.921269239425659
 quant_reg      : 13.141075710296631
 quant_err      : 13.141075710296631
 learning_rate  : 7.888960739411339e-06
 n_samples      : 1184000
 n_steps        : 9250
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 83.09859154929578
 MSRVTT_full_val/t2v_metrics/R50: 98.79275653923541
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 6.901408450704225
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.627702516328654
 MSRVTT_full_val/v2t_metrics/R1: 41.24748490945674
 MSRVTT_full_val/v2t_metrics/R5: 79.47686116700201
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.424547283702213
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.05733913304385
 MSRVTT_full_test/t2v_metrics/R1: 13.979933110367893
 MSRVTT_full_test/t2v_metrics/R5: 37.725752508361204
 MSRVTT_full_test/t2v_metrics/R10: 52.10702341137124
 MSRVTT_full_test/t2v_metrics/R50: 81.93979933110369
 MSRVTT_full_test/t2v_metrics/MedR: 9.5
 MSRVTT_full_test/t2v_metrics/MeanR: 41.66086956521739
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.17725666012385
 MSRVTT_full_test/v2t_metrics/R1: 17.4247491638796
 MSRVTT_full_test/v2t_metrics/R5: 46.15384615384615
 MSRVTT_full_test/v2t_metrics/R10: 59.197324414715716
 MSRVTT_full_test/v2t_metrics/R50: 87.59197324414716
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.75752508361204
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.24311388373037
 mnt_best       : 30.637244491244044
 not_improved_count: 4
Train Epoch: 38 [1/250 128/32000 (0%)] Loss: 2.95139 (QuantReg: 13.09615) QuantErr: 13.09615 batch_time=33.39338 
Train Epoch: 38 [12/250 1536/32000 (5%)] Loss: 2.82841 (QuantReg: 13.21351) QuantErr: 13.21351 batch_time=0.92227 
Train Epoch: 38 [23/250 2944/32000 (9%)] Loss: 2.63981 (QuantReg: 13.19826) QuantErr: 13.19826 batch_time=0.93536 
Train Epoch: 38 [34/250 4352/32000 (14%)] Loss: 3.33777 (QuantReg: 13.04806) QuantErr: 13.04806 batch_time=0.95684 
Train Epoch: 38 [45/250 5760/32000 (18%)] Loss: 3.30457 (QuantReg: 12.92225) QuantErr: 12.92225 batch_time=0.91441 
Train Epoch: 38 [56/250 7168/32000 (22%)] Loss: 3.21299 (QuantReg: 13.11326) QuantErr: 13.11326 batch_time=0.95636 
Train Epoch: 38 [67/250 8576/32000 (27%)] Loss: 2.64986 (QuantReg: 13.08825) QuantErr: 13.08825 batch_time=1.14295 
Train Epoch: 38 [78/250 9984/32000 (31%)] Loss: 2.50717 (QuantReg: 13.30232) QuantErr: 13.30232 batch_time=0.93762 
Train Epoch: 38 [89/250 11392/32000 (36%)] Loss: 3.28295 (QuantReg: 12.89620) QuantErr: 12.89620 batch_time=0.94768 
Train Epoch: 38 [100/250 12800/32000 (40%)] Loss: 3.13337 (QuantReg: 13.27031) QuantErr: 13.27031 batch_time=0.92604 
Train Epoch: 38 [111/250 14208/32000 (44%)] Loss: 2.21793 (QuantReg: 13.28048) QuantErr: 13.28048 batch_time=0.94410 
Train Epoch: 38 [122/250 15616/32000 (49%)] Loss: 2.86243 (QuantReg: 12.99008) QuantErr: 12.99008 batch_time=0.94922 
Train Epoch: 38 [133/250 17024/32000 (53%)] Loss: 2.43061 (QuantReg: 13.35630) QuantErr: 13.35630 batch_time=0.99357 
Train Epoch: 38 [144/250 18432/32000 (58%)] Loss: 3.10676 (QuantReg: 13.06480) QuantErr: 13.06480 batch_time=0.95282 
Train Epoch: 38 [155/250 19840/32000 (62%)] Loss: 2.38780 (QuantReg: 13.14791) QuantErr: 13.14791 batch_time=0.99025 
Train Epoch: 38 [166/250 21248/32000 (66%)] Loss: 4.03732 (QuantReg: 12.96643) QuantErr: 12.96643 batch_time=0.95965 
Train Epoch: 38 [177/250 22656/32000 (71%)] Loss: 2.50466 (QuantReg: 13.12640) QuantErr: 13.12640 batch_time=0.95794 
Train Epoch: 38 [188/250 24064/32000 (75%)] Loss: 2.78738 (QuantReg: 13.15349) QuantErr: 13.15349 batch_time=0.93296 
Train Epoch: 38 [199/250 25472/32000 (80%)] Loss: 2.80930 (QuantReg: 13.04818) QuantErr: 13.04818 batch_time=1.00636 
Train Epoch: 38 [210/250 26880/32000 (84%)] Loss: 3.73978 (QuantReg: 13.02628) QuantErr: 13.02628 batch_time=1.06626 
Train Epoch: 38 [221/250 28288/32000 (88%)] Loss: 3.45987 (QuantReg: 12.91150) QuantErr: 12.91150 batch_time=1.19137 
Train Epoch: 38 [232/250 29696/32000 (93%)] Loss: 2.54654 (QuantReg: 13.18347) QuantErr: 13.18347 batch_time=1.00044 
Train Epoch: 38 [243/250 31104/32000 (97%)] Loss: 3.10045 (QuantReg: 13.36346) QuantErr: 13.36346 batch_time=1.19830 
Train Epoch: 38 codebook_update_time=8.86139
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch38.pth ...
Done in 22.097s
removing stale ckpt [epoch 37] [took 0.00s]
 epoch          : 38
 loss           : 2.895069193840027
 quant_reg      : 13.152933006286622
 quant_err      : 13.152933006286622
 learning_rate  : 7.494512702440772e-06
 n_samples      : 1216000
 n_steps        : 9500
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.114688128772636
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.541514348300005
 MSRVTT_full_val/v2t_metrics/R1: 40.84507042253521
 MSRVTT_full_val/v2t_metrics/R5: 76.86116700201207
 MSRVTT_full_val/v2t_metrics/R10: 89.33601609657947
 MSRVTT_full_val/v2t_metrics/R50: 99.59758551307847
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.368209255533199
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.45724686563044
 MSRVTT_full_test/t2v_metrics/R1: 13.277591973244148
 MSRVTT_full_test/t2v_metrics/R5: 37.625418060200666
 MSRVTT_full_test/t2v_metrics/R10: 51.7056856187291
 MSRVTT_full_test/t2v_metrics/R50: 81.53846153846153
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.8066889632107
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.560582288893567
 MSRVTT_full_test/v2t_metrics/R1: 17.023411371237458
 MSRVTT_full_test/v2t_metrics/R5: 45.11705685618729
 MSRVTT_full_test/v2t_metrics/R10: 58.59531772575251
 MSRVTT_full_test/v2t_metrics/R50: 86.78929765886288
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.536120401337794
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.569963780078695
 mnt_best       : 30.637244491244044
 not_improved_count: 5
Train Epoch: 39 [1/250 128/32000 (0%)] Loss: 2.85424 (QuantReg: 13.37069) QuantErr: 13.37069 batch_time=33.82908 
Train Epoch: 39 [12/250 1536/32000 (5%)] Loss: 2.76091 (QuantReg: 13.09617) QuantErr: 13.09617 batch_time=1.07048 
Train Epoch: 39 [23/250 2944/32000 (9%)] Loss: 3.92320 (QuantReg: 12.81222) QuantErr: 12.81222 batch_time=0.95818 
Train Epoch: 39 [34/250 4352/32000 (14%)] Loss: 3.15265 (QuantReg: 12.94116) QuantErr: 12.94116 batch_time=0.95844 
Train Epoch: 39 [45/250 5760/32000 (18%)] Loss: 3.35492 (QuantReg: 13.05782) QuantErr: 13.05782 batch_time=0.94853 
Train Epoch: 39 [56/250 7168/32000 (22%)] Loss: 2.81446 (QuantReg: 13.10539) QuantErr: 13.10539 batch_time=0.98896 
Train Epoch: 39 [67/250 8576/32000 (27%)] Loss: 2.66028 (QuantReg: 13.05585) QuantErr: 13.05585 batch_time=0.99535 
Train Epoch: 39 [78/250 9984/32000 (31%)] Loss: 2.60540 (QuantReg: 13.00912) QuantErr: 13.00912 batch_time=0.94275 
Train Epoch: 39 [89/250 11392/32000 (36%)] Loss: 3.27645 (QuantReg: 13.27178) QuantErr: 13.27178 batch_time=0.92397 
Train Epoch: 39 [100/250 12800/32000 (40%)] Loss: 3.29000 (QuantReg: 13.05602) QuantErr: 13.05602 batch_time=0.93718 
Train Epoch: 39 [111/250 14208/32000 (44%)] Loss: 2.53083 (QuantReg: 12.93539) QuantErr: 12.93539 batch_time=0.97164 
Train Epoch: 39 [122/250 15616/32000 (49%)] Loss: 2.61683 (QuantReg: 13.30226) QuantErr: 13.30226 batch_time=0.96293 
Train Epoch: 39 [133/250 17024/32000 (53%)] Loss: 3.27704 (QuantReg: 13.15819) QuantErr: 13.15819 batch_time=0.94186 
Train Epoch: 39 [144/250 18432/32000 (58%)] Loss: 2.01894 (QuantReg: 13.30984) QuantErr: 13.30984 batch_time=1.03290 
Train Epoch: 39 [155/250 19840/32000 (62%)] Loss: 3.00312 (QuantReg: 12.86327) QuantErr: 12.86327 batch_time=0.95127 
Train Epoch: 39 [166/250 21248/32000 (66%)] Loss: 2.37874 (QuantReg: 13.29147) QuantErr: 13.29147 batch_time=1.03077 
Train Epoch: 39 [177/250 22656/32000 (71%)] Loss: 2.59157 (QuantReg: 13.20379) QuantErr: 13.20379 batch_time=1.01633 
Train Epoch: 39 [188/250 24064/32000 (75%)] Loss: 3.00994 (QuantReg: 13.32409) QuantErr: 13.32409 batch_time=1.11338 
Train Epoch: 39 [199/250 25472/32000 (80%)] Loss: 2.66757 (QuantReg: 13.17647) QuantErr: 13.17647 batch_time=0.96551 
Train Epoch: 39 [210/250 26880/32000 (84%)] Loss: 2.55230 (QuantReg: 13.08363) QuantErr: 13.08363 batch_time=0.93289 
Train Epoch: 39 [221/250 28288/32000 (88%)] Loss: 2.76866 (QuantReg: 13.23481) QuantErr: 13.23481 batch_time=0.99585 
Train Epoch: 39 [232/250 29696/32000 (93%)] Loss: 2.50279 (QuantReg: 12.95781) QuantErr: 12.95781 batch_time=0.96508 
Train Epoch: 39 [243/250 31104/32000 (97%)] Loss: 2.88008 (QuantReg: 13.03770) QuantErr: 13.03770 batch_time=0.93715 
Train Epoch: 39 codebook_update_time=9.90936
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch39.pth ...
Done in 16.063s
removing stale ckpt [epoch 38] [took 0.00s]
 epoch          : 39
 loss           : 2.8883103494644167
 quant_reg      : 13.160610919952392
 quant_err      : 13.160610919952392
 learning_rate  : 7.119787067318733e-06
 n_samples      : 1248000
 n_steps        : 9750
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 68.81287726358148
 MSRVTT_full_val/t2v_metrics/R10: 81.28772635814889
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.150905432595573
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.704532358224924
 MSRVTT_full_val/v2t_metrics/R1: 39.839034205231385
 MSRVTT_full_val/v2t_metrics/R5: 77.06237424547284
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.408450704225352
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.52995342645744
 MSRVTT_full_test/t2v_metrics/R1: 13.34448160535117
 MSRVTT_full_test/t2v_metrics/R5: 37.15719063545151
 MSRVTT_full_test/t2v_metrics/R10: 51.97324414715719
 MSRVTT_full_test/t2v_metrics/R50: 81.87290969899665
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.17959866220736
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.537572551357698
 MSRVTT_full_test/v2t_metrics/R1: 17.49163879598662
 MSRVTT_full_test/v2t_metrics/R5: 45.551839464882946
 MSRVTT_full_test/v2t_metrics/R10: 59.63210702341137
 MSRVTT_full_test/v2t_metrics/R50: 86.75585284280936
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.155183946488293
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.219200392947236
 mnt_best       : 30.637244491244044
 not_improved_count: 6
Train Epoch: 40 [1/250 128/32000 (0%)] Loss: 2.54464 (QuantReg: 13.06656) QuantErr: 13.06656 batch_time=34.45668 
Train Epoch: 40 [12/250 1536/32000 (5%)] Loss: 2.62556 (QuantReg: 13.14838) QuantErr: 13.14838 batch_time=1.00084 
Train Epoch: 40 [23/250 2944/32000 (9%)] Loss: 2.87844 (QuantReg: 13.07382) QuantErr: 13.07382 batch_time=1.09592 
Train Epoch: 40 [34/250 4352/32000 (14%)] Loss: 2.59786 (QuantReg: 13.23385) QuantErr: 13.23385 batch_time=0.92935 
Train Epoch: 40 [45/250 5760/32000 (18%)] Loss: 2.58792 (QuantReg: 13.41719) QuantErr: 13.41719 batch_time=1.05156 
Train Epoch: 40 [56/250 7168/32000 (22%)] Loss: 2.71757 (QuantReg: 13.28621) QuantErr: 13.28621 batch_time=1.00327 
Train Epoch: 40 [67/250 8576/32000 (27%)] Loss: 2.46789 (QuantReg: 13.24653) QuantErr: 13.24653 batch_time=0.99694 
Train Epoch: 40 [78/250 9984/32000 (31%)] Loss: 2.63273 (QuantReg: 13.10828) QuantErr: 13.10828 batch_time=0.94336 
Train Epoch: 40 [89/250 11392/32000 (36%)] Loss: 2.41484 (QuantReg: 12.85462) QuantErr: 12.85462 batch_time=1.11439 
Train Epoch: 40 [100/250 12800/32000 (40%)] Loss: 2.89291 (QuantReg: 13.22132) QuantErr: 13.22132 batch_time=0.93608 
Train Epoch: 40 [111/250 14208/32000 (44%)] Loss: 2.68987 (QuantReg: 13.21292) QuantErr: 13.21292 batch_time=0.95242 
Train Epoch: 40 [122/250 15616/32000 (49%)] Loss: 3.05584 (QuantReg: 13.16665) QuantErr: 13.16665 batch_time=1.06320 
Train Epoch: 40 [133/250 17024/32000 (53%)] Loss: 2.98562 (QuantReg: 12.96489) QuantErr: 12.96489 batch_time=0.96034 
Train Epoch: 40 [144/250 18432/32000 (58%)] Loss: 2.66665 (QuantReg: 13.21358) QuantErr: 13.21358 batch_time=0.96068 
Train Epoch: 40 [155/250 19840/32000 (62%)] Loss: 2.94082 (QuantReg: 13.07606) QuantErr: 13.07606 batch_time=0.95372 
Train Epoch: 40 [166/250 21248/32000 (66%)] Loss: 2.76979 (QuantReg: 13.20954) QuantErr: 13.20954 batch_time=1.00763 
Train Epoch: 40 [177/250 22656/32000 (71%)] Loss: 2.53692 (QuantReg: 13.24675) QuantErr: 13.24675 batch_time=0.98167 
Train Epoch: 40 [188/250 24064/32000 (75%)] Loss: 2.58206 (QuantReg: 13.07107) QuantErr: 13.07107 batch_time=0.96532 
Train Epoch: 40 [199/250 25472/32000 (80%)] Loss: 3.46482 (QuantReg: 13.22727) QuantErr: 13.22727 batch_time=0.96486 
Train Epoch: 40 [210/250 26880/32000 (84%)] Loss: 3.78955 (QuantReg: 13.01027) QuantErr: 13.01027 batch_time=1.33534 
Train Epoch: 40 [221/250 28288/32000 (88%)] Loss: 2.21134 (QuantReg: 13.34843) QuantErr: 13.34843 batch_time=1.04710 
Train Epoch: 40 [232/250 29696/32000 (93%)] Loss: 3.08988 (QuantReg: 13.03503) QuantErr: 13.03503 batch_time=0.95542 
Train Epoch: 40 [243/250 31104/32000 (97%)] Loss: 2.92627 (QuantReg: 13.26700) QuantErr: 13.26700 batch_time=0.97811 
Train Epoch: 40 codebook_update_time=8.78178
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch40.pth ...
Done in 4.845s
removing stale ckpt [epoch 39] [took 0.00s]
 epoch          : 40
 loss           : 2.831927571296692
 quant_reg      : 13.207536392211914
 quant_err      : 13.207536392211914
 learning_rate  : 6.763797713952796e-06
 n_samples      : 1280000
 n_steps        : 10000
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 70.02012072434607
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.39034205231388
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.279678068410463
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.19700258831732
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 78.06841046277665
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.490945674044266
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.97716540080353
 MSRVTT_full_test/t2v_metrics/R1: 13.377926421404682
 MSRVTT_full_test/t2v_metrics/R5: 36.95652173913044
 MSRVTT_full_test/t2v_metrics/R10: 51.77257525083612
 MSRVTT_full_test/t2v_metrics/R50: 81.53846153846153
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.94314381270903
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.470887883283222
 MSRVTT_full_test/v2t_metrics/R1: 17.65886287625418
 MSRVTT_full_test/v2t_metrics/R5: 45.719063545150505
 MSRVTT_full_test/v2t_metrics/R10: 58.96321070234114
 MSRVTT_full_test/v2t_metrics/R50: 87.52508361204013
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.72541806020067
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.24213119347791
 mnt_best       : 30.637244491244044
 not_improved_count: 7
Train Epoch: 41 [1/250 128/32000 (0%)] Loss: 2.45211 (QuantReg: 13.01766) QuantErr: 13.01766 batch_time=32.62364 
Train Epoch: 41 [12/250 1536/32000 (5%)] Loss: 2.87786 (QuantReg: 13.28884) QuantErr: 13.28884 batch_time=0.93006 
Train Epoch: 41 [23/250 2944/32000 (9%)] Loss: 2.57544 (QuantReg: 13.16260) QuantErr: 13.16260 batch_time=0.98572 
Train Epoch: 41 [34/250 4352/32000 (14%)] Loss: 2.85577 (QuantReg: 13.18793) QuantErr: 13.18793 batch_time=0.95283 
Train Epoch: 41 [45/250 5760/32000 (18%)] Loss: 2.38577 (QuantReg: 13.27454) QuantErr: 13.27454 batch_time=0.95586 
Train Epoch: 41 [56/250 7168/32000 (22%)] Loss: 2.21911 (QuantReg: 13.26305) QuantErr: 13.26305 batch_time=0.96937 
Train Epoch: 41 [67/250 8576/32000 (27%)] Loss: 2.61098 (QuantReg: 13.13665) QuantErr: 13.13665 batch_time=3.58372 
Train Epoch: 41 [78/250 9984/32000 (31%)] Loss: 2.19604 (QuantReg: 13.06287) QuantErr: 13.06287 batch_time=0.95749 
Train Epoch: 41 [89/250 11392/32000 (36%)] Loss: 2.97607 (QuantReg: 13.08289) QuantErr: 13.08289 batch_time=0.94401 
Train Epoch: 41 [100/250 12800/32000 (40%)] Loss: 2.34680 (QuantReg: 13.23324) QuantErr: 13.23324 batch_time=0.94919 
Train Epoch: 41 [111/250 14208/32000 (44%)] Loss: 2.75932 (QuantReg: 13.13266) QuantErr: 13.13266 batch_time=0.99891 
Train Epoch: 41 [122/250 15616/32000 (49%)] Loss: 2.95344 (QuantReg: 13.29244) QuantErr: 13.29244 batch_time=0.93584 
Train Epoch: 41 [133/250 17024/32000 (53%)] Loss: 2.31754 (QuantReg: 13.22666) QuantErr: 13.22666 batch_time=0.96313 
Train Epoch: 41 [144/250 18432/32000 (58%)] Loss: 2.64301 (QuantReg: 13.20663) QuantErr: 13.20663 batch_time=0.98485 
Train Epoch: 41 [155/250 19840/32000 (62%)] Loss: 2.34075 (QuantReg: 13.18507) QuantErr: 13.18507 batch_time=0.94139 
Train Epoch: 41 [166/250 21248/32000 (66%)] Loss: 2.35742 (QuantReg: 13.47796) QuantErr: 13.47796 batch_time=0.92161 
Train Epoch: 41 [177/250 22656/32000 (71%)] Loss: 3.40570 (QuantReg: 13.10717) QuantErr: 13.10717 batch_time=1.83070 
Train Epoch: 41 [188/250 24064/32000 (75%)] Loss: 3.59970 (QuantReg: 12.78339) QuantErr: 12.78339 batch_time=0.92726 
Train Epoch: 41 [199/250 25472/32000 (80%)] Loss: 2.79037 (QuantReg: 13.38950) QuantErr: 13.38950 batch_time=1.03412 
Train Epoch: 41 [210/250 26880/32000 (84%)] Loss: 2.17914 (QuantReg: 13.45089) QuantErr: 13.45089 batch_time=0.96700 
Train Epoch: 41 [221/250 28288/32000 (88%)] Loss: 2.67527 (QuantReg: 13.06587) QuantErr: 13.06587 batch_time=1.03182 
Train Epoch: 41 [232/250 29696/32000 (93%)] Loss: 3.79726 (QuantReg: 13.28414) QuantErr: 13.28414 batch_time=0.94879 
Train Epoch: 41 [243/250 31104/32000 (97%)] Loss: 2.57736 (QuantReg: 13.15934) QuantErr: 13.15934 batch_time=1.01828 
Train Epoch: 41 codebook_update_time=9.60149
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch41.pth ...
Done in 4.730s
removing stale ckpt [epoch 40] [took 0.01s]
 epoch          : 41
 loss           : 2.861626510620117
 quant_reg      : 13.200143489837647
 quant_err      : 13.200143489837647
 learning_rate  : 6.425607828255156e-06
 n_samples      : 1312000
 n_steps        : 10250
 MSRVTT_full_val/t2v_metrics/R1: 32.59557344064386
 MSRVTT_full_val/t2v_metrics/R5: 71.0261569416499
 MSRVTT_full_val/t2v_metrics/R10: 83.90342052313883
 MSRVTT_full_val/t2v_metrics/R50: 98.79275653923541
 MSRVTT_full_val/t2v_metrics/MedR: 2.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.112676056338028
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.91426329665676
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 77.66599597585513
 MSRVTT_full_val/v2t_metrics/R10: 87.72635814889335
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.507042253521127
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.96481526215474
 MSRVTT_full_test/t2v_metrics/R1: 13.946488294314381
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 52.675585284280935
 MSRVTT_full_test/t2v_metrics/R50: 82.17391304347827
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 42.05886287625418
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.217667267949825
 MSRVTT_full_test/v2t_metrics/R1: 17.926421404682273
 MSRVTT_full_test/v2t_metrics/R5: 45.585284280936456
 MSRVTT_full_test/v2t_metrics/R10: 59.197324414715716
 MSRVTT_full_test/v2t_metrics/R50: 87.35785953177258
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.25886287625418
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.43679050578399
 mnt_best       : 30.637244491244044
 not_improved_count: 8
Train Epoch: 42 [1/250 128/32000 (0%)] Loss: 1.96724 (QuantReg: 13.21009) QuantErr: 13.21009 batch_time=34.63435 
Train Epoch: 42 [12/250 1536/32000 (5%)] Loss: 2.95169 (QuantReg: 13.25563) QuantErr: 13.25563 batch_time=1.02171 
Train Epoch: 42 [23/250 2944/32000 (9%)] Loss: 3.25631 (QuantReg: 13.08858) QuantErr: 13.08858 batch_time=1.10171 
Train Epoch: 42 [34/250 4352/32000 (14%)] Loss: 2.69906 (QuantReg: 13.37958) QuantErr: 13.37958 batch_time=1.00113 
Train Epoch: 42 [45/250 5760/32000 (18%)] Loss: 2.40396 (QuantReg: 13.02940) QuantErr: 13.02940 batch_time=1.01642 
Train Epoch: 42 [56/250 7168/32000 (22%)] Loss: 3.36404 (QuantReg: 13.18012) QuantErr: 13.18012 batch_time=1.04048 
Train Epoch: 42 [67/250 8576/32000 (27%)] Loss: 2.61671 (QuantReg: 13.24792) QuantErr: 13.24792 batch_time=0.94645 
Train Epoch: 42 [78/250 9984/32000 (31%)] Loss: 3.08898 (QuantReg: 13.17532) QuantErr: 13.17532 batch_time=0.94763 
Train Epoch: 42 [89/250 11392/32000 (36%)] Loss: 2.63517 (QuantReg: 13.10493) QuantErr: 13.10493 batch_time=0.94386 
Train Epoch: 42 [100/250 12800/32000 (40%)] Loss: 3.32110 (QuantReg: 13.19768) QuantErr: 13.19768 batch_time=0.99072 
Train Epoch: 42 [111/250 14208/32000 (44%)] Loss: 2.66260 (QuantReg: 13.15631) QuantErr: 13.15631 batch_time=1.01280 
Train Epoch: 42 [122/250 15616/32000 (49%)] Loss: 2.45083 (QuantReg: 13.33871) QuantErr: 13.33871 batch_time=1.13827 
Train Epoch: 42 [133/250 17024/32000 (53%)] Loss: 3.48136 (QuantReg: 13.15122) QuantErr: 13.15122 batch_time=0.98399 
Train Epoch: 42 [144/250 18432/32000 (58%)] Loss: 2.59302 (QuantReg: 13.45197) QuantErr: 13.45197 batch_time=2.81304 
Train Epoch: 42 [155/250 19840/32000 (62%)] Loss: 3.09795 (QuantReg: 13.22274) QuantErr: 13.22274 batch_time=1.00357 
Train Epoch: 42 [166/250 21248/32000 (66%)] Loss: 2.64873 (QuantReg: 13.03120) QuantErr: 13.03120 batch_time=0.93770 
Train Epoch: 42 [177/250 22656/32000 (71%)] Loss: 2.82571 (QuantReg: 13.04852) QuantErr: 13.04852 batch_time=0.96644 
Train Epoch: 42 [188/250 24064/32000 (75%)] Loss: 2.77020 (QuantReg: 13.30756) QuantErr: 13.30756 batch_time=0.99530 
Train Epoch: 42 [199/250 25472/32000 (80%)] Loss: 2.58114 (QuantReg: 13.39851) QuantErr: 13.39851 batch_time=1.03638 
Train Epoch: 42 [210/250 26880/32000 (84%)] Loss: 2.92496 (QuantReg: 13.27946) QuantErr: 13.27946 batch_time=1.07278 
Train Epoch: 42 [221/250 28288/32000 (88%)] Loss: 3.36849 (QuantReg: 12.94716) QuantErr: 12.94716 batch_time=0.94909 
Train Epoch: 42 [232/250 29696/32000 (93%)] Loss: 2.91482 (QuantReg: 13.07132) QuantErr: 13.07132 batch_time=0.97778 
Train Epoch: 42 [243/250 31104/32000 (97%)] Loss: 2.44931 (QuantReg: 13.43124) QuantErr: 13.43124 batch_time=1.02256 
Train Epoch: 42 codebook_update_time=9.16124
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch42.pth ...
Done in 13.087s
removing stale ckpt [epoch 41] [took 0.00s]
 epoch          : 42
 loss           : 2.8224582390785216
 quant_reg      : 13.2269147605896
 quant_err      : 13.2269147605896
 learning_rate  : 6.104327436842398e-06
 n_samples      : 1344000
 n_steps        : 10500
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 83.70221327967806
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 6.929577464788732
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.822021527794895
 MSRVTT_full_val/v2t_metrics/R1: 40.04024144869215
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.32394366197182
 MSRVTT_full_val/v2t_metrics/R50: 99.19517102615694
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.334004024144869
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.70106903111261
 MSRVTT_full_test/t2v_metrics/R1: 13.578595317725753
 MSRVTT_full_test/t2v_metrics/R5: 37.357859531772576
 MSRVTT_full_test/t2v_metrics/R10: 52.408026755852845
 MSRVTT_full_test/t2v_metrics/R50: 81.70568561872909
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.761538461538464
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 29.845455587155463
 MSRVTT_full_test/v2t_metrics/R1: 17.692307692307693
 MSRVTT_full_test/v2t_metrics/R5: 44.91638795986622
 MSRVTT_full_test/v2t_metrics/R10: 58.99665551839465
 MSRVTT_full_test/v2t_metrics/R50: 86.98996655518394
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.609698996655517
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.05832649943647
 mnt_best       : 30.637244491244044
 not_improved_count: 9
Train Epoch: 43 [1/250 128/32000 (0%)] Loss: 3.19386 (QuantReg: 13.05435) QuantErr: 13.05435 batch_time=34.13980 
Train Epoch: 43 [12/250 1536/32000 (5%)] Loss: 2.94718 (QuantReg: 13.06001) QuantErr: 13.06001 batch_time=1.00236 
Train Epoch: 43 [23/250 2944/32000 (9%)] Loss: 3.27411 (QuantReg: 13.23820) QuantErr: 13.23820 batch_time=2.08337 
Train Epoch: 43 [34/250 4352/32000 (14%)] Loss: 2.63442 (QuantReg: 13.20106) QuantErr: 13.20106 batch_time=0.96235 
Train Epoch: 43 [45/250 5760/32000 (18%)] Loss: 2.71345 (QuantReg: 13.27143) QuantErr: 13.27143 batch_time=0.96208 
Train Epoch: 43 [56/250 7168/32000 (22%)] Loss: 2.76910 (QuantReg: 13.16863) QuantErr: 13.16863 batch_time=1.14502 
Train Epoch: 43 [67/250 8576/32000 (27%)] Loss: 3.73341 (QuantReg: 13.40190) QuantErr: 13.40190 batch_time=0.95951 
Train Epoch: 43 [78/250 9984/32000 (31%)] Loss: 3.72058 (QuantReg: 13.34697) QuantErr: 13.34697 batch_time=0.95695 
Train Epoch: 43 [89/250 11392/32000 (36%)] Loss: 2.45209 (QuantReg: 13.46455) QuantErr: 13.46455 batch_time=0.98883 
Train Epoch: 43 [100/250 12800/32000 (40%)] Loss: 2.72168 (QuantReg: 13.30591) QuantErr: 13.30591 batch_time=0.99723 
Train Epoch: 43 [111/250 14208/32000 (44%)] Loss: 3.01012 (QuantReg: 13.20007) QuantErr: 13.20007 batch_time=0.95673 
Train Epoch: 43 [122/250 15616/32000 (49%)] Loss: 3.35944 (QuantReg: 13.22635) QuantErr: 13.22635 batch_time=0.94909 
Train Epoch: 43 [133/250 17024/32000 (53%)] Loss: 2.80684 (QuantReg: 13.49168) QuantErr: 13.49168 batch_time=0.97946 
Train Epoch: 43 [144/250 18432/32000 (58%)] Loss: 3.06934 (QuantReg: 13.26488) QuantErr: 13.26488 batch_time=0.95766 
Train Epoch: 43 [155/250 19840/32000 (62%)] Loss: 3.34510 (QuantReg: 13.09173) QuantErr: 13.09173 batch_time=0.95056 
Train Epoch: 43 [166/250 21248/32000 (66%)] Loss: 2.53338 (QuantReg: 13.32203) QuantErr: 13.32203 batch_time=0.96069 
Train Epoch: 43 [177/250 22656/32000 (71%)] Loss: 3.11709 (QuantReg: 13.36312) QuantErr: 13.36312 batch_time=0.93712 
Train Epoch: 43 [188/250 24064/32000 (75%)] Loss: 2.54473 (QuantReg: 13.09740) QuantErr: 13.09740 batch_time=0.97063 
Train Epoch: 43 [199/250 25472/32000 (80%)] Loss: 3.13122 (QuantReg: 13.21204) QuantErr: 13.21204 batch_time=0.95459 
Train Epoch: 43 [210/250 26880/32000 (84%)] Loss: 2.53466 (QuantReg: 13.41726) QuantErr: 13.41726 batch_time=1.05496 
Train Epoch: 43 [221/250 28288/32000 (88%)] Loss: 2.40253 (QuantReg: 13.28537) QuantErr: 13.28537 batch_time=0.95598 
Train Epoch: 43 [232/250 29696/32000 (93%)] Loss: 1.76632 (QuantReg: 13.39108) QuantErr: 13.39108 batch_time=1.01247 
Train Epoch: 43 [243/250 31104/32000 (97%)] Loss: 3.22732 (QuantReg: 13.28765) QuantErr: 13.28765 batch_time=0.94561 
Train Epoch: 43 codebook_update_time=8.69055
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch43.pth ...
Done in 8.559s
removing stale ckpt [epoch 42] [took 0.00s]
 epoch          : 43
 loss           : 2.8475190534591674
 quant_reg      : 13.2276090965271
 quant_err      : 13.2276090965271
 learning_rate  : 5.799111065000278e-06
 n_samples      : 1376000
 n_steps        : 10750
 MSRVTT_full_val/t2v_metrics/R1: 33.601609657947684
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 82.69617706237425
 MSRVTT_full_val/t2v_metrics/R50: 98.59154929577464
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.120724346076459
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.83468953104431
 MSRVTT_full_val/v2t_metrics/R1: 40.241448692152915
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.5392354124748495
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.77136082706161
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 38.59531772575251
 MSRVTT_full_test/t2v_metrics/R10: 52.74247491638796
 MSRVTT_full_test/t2v_metrics/R50: 82.37458193979933
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 41.73779264214047
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.603329457534095
 MSRVTT_full_test/v2t_metrics/R1: 18.26086956521739
 MSRVTT_full_test/v2t_metrics/R5: 45.68561872909699
 MSRVTT_full_test/v2t_metrics/R10: 58.66220735785953
 MSRVTT_full_test/v2t_metrics/R50: 87.52508361204013
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 29.90334448160535
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.5779859451585
 mnt_best       : 30.637244491244044
 not_improved_count: 10
Train Epoch: 44 [1/250 128/32000 (0%)] Loss: 3.31279 (QuantReg: 13.06977) QuantErr: 13.06977 batch_time=34.73760 
Train Epoch: 44 [12/250 1536/32000 (5%)] Loss: 2.70545 (QuantReg: 13.14419) QuantErr: 13.14419 batch_time=1.14668 
Train Epoch: 44 [23/250 2944/32000 (9%)] Loss: 3.10226 (QuantReg: 13.17688) QuantErr: 13.17688 batch_time=0.95403 
Train Epoch: 44 [34/250 4352/32000 (14%)] Loss: 2.66632 (QuantReg: 13.49847) QuantErr: 13.49847 batch_time=1.05515 
Train Epoch: 44 [45/250 5760/32000 (18%)] Loss: 2.74777 (QuantReg: 13.47210) QuantErr: 13.47210 batch_time=0.91195 
Train Epoch: 44 [56/250 7168/32000 (22%)] Loss: 3.09387 (QuantReg: 13.02210) QuantErr: 13.02210 batch_time=0.96731 
Train Epoch: 44 [67/250 8576/32000 (27%)] Loss: 3.02960 (QuantReg: 13.15949) QuantErr: 13.15949 batch_time=1.04945 
Train Epoch: 44 [78/250 9984/32000 (31%)] Loss: 3.65029 (QuantReg: 13.18170) QuantErr: 13.18170 batch_time=3.90675 
Train Epoch: 44 [89/250 11392/32000 (36%)] Loss: 2.76208 (QuantReg: 13.22526) QuantErr: 13.22526 batch_time=1.00994 
Train Epoch: 44 [100/250 12800/32000 (40%)] Loss: 3.20532 (QuantReg: 13.42841) QuantErr: 13.42841 batch_time=0.97145 
Train Epoch: 44 [111/250 14208/32000 (44%)] Loss: 3.20961 (QuantReg: 13.30631) QuantErr: 13.30631 batch_time=0.92875 
Train Epoch: 44 [122/250 15616/32000 (49%)] Loss: 2.73391 (QuantReg: 13.36408) QuantErr: 13.36408 batch_time=0.93433 
Train Epoch: 44 [133/250 17024/32000 (53%)] Loss: 2.52701 (QuantReg: 13.02931) QuantErr: 13.02931 batch_time=1.92727 
Train Epoch: 44 [144/250 18432/32000 (58%)] Loss: 2.50044 (QuantReg: 13.30737) QuantErr: 13.30737 batch_time=0.92423 
Train Epoch: 44 [155/250 19840/32000 (62%)] Loss: 2.67999 (QuantReg: 13.22840) QuantErr: 13.22840 batch_time=0.97647 
Train Epoch: 44 [166/250 21248/32000 (66%)] Loss: 2.78420 (QuantReg: 13.24678) QuantErr: 13.24678 batch_time=0.96297 
Train Epoch: 44 [177/250 22656/32000 (71%)] Loss: 2.54437 (QuantReg: 13.55087) QuantErr: 13.55087 batch_time=1.03725 
Train Epoch: 44 [188/250 24064/32000 (75%)] Loss: 2.62080 (QuantReg: 13.19209) QuantErr: 13.19209 batch_time=1.03124 
Train Epoch: 44 [199/250 25472/32000 (80%)] Loss: 2.30153 (QuantReg: 13.27048) QuantErr: 13.27048 batch_time=0.94661 
Train Epoch: 44 [210/250 26880/32000 (84%)] Loss: 2.78015 (QuantReg: 13.31944) QuantErr: 13.31944 batch_time=1.06542 
Train Epoch: 44 [221/250 28288/32000 (88%)] Loss: 2.83530 (QuantReg: 13.08319) QuantErr: 13.08319 batch_time=1.10562 
Train Epoch: 44 [232/250 29696/32000 (93%)] Loss: 2.82502 (QuantReg: 13.40034) QuantErr: 13.40034 batch_time=1.08003 
Train Epoch: 44 [243/250 31104/32000 (97%)] Loss: 2.76235 (QuantReg: 13.34174) QuantErr: 13.34174 batch_time=1.09337 
Train Epoch: 44 codebook_update_time=8.94257
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch44.pth ...
Done in 4.120s
removing stale ckpt [epoch 43] [took 0.00s]
 epoch          : 44
 loss           : 2.82266764831543
 quant_reg      : 13.232670391082763
 quant_err      : 13.232670391082763
 learning_rate  : 5.5091555117502635e-06
 n_samples      : 1408000
 n_steps        : 11000
 MSRVTT_full_val/t2v_metrics/R1: 31.187122736418512
 MSRVTT_full_val/t2v_metrics/R5: 69.01408450704226
 MSRVTT_full_val/t2v_metrics/R10: 82.29376257545272
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.462776659959759
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.15994235459209
 MSRVTT_full_val/v2t_metrics/R1: 39.03420523138833
 MSRVTT_full_val/v2t_metrics/R5: 78.87323943661971
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.472837022132797
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.68943468639479
 MSRVTT_full_test/t2v_metrics/R1: 14.247491638795987
 MSRVTT_full_test/t2v_metrics/R5: 37.290969899665555
 MSRVTT_full_test/t2v_metrics/R10: 52.207357859531776
 MSRVTT_full_test/t2v_metrics/R50: 81.80602006688963
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.52173913043478
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.270848988422777
 MSRVTT_full_test/v2t_metrics/R1: 17.25752508361204
 MSRVTT_full_test/v2t_metrics/R5: 44.78260869565217
 MSRVTT_full_test/v2t_metrics/R10: 59.03010033444816
 MSRVTT_full_test/v2t_metrics/R50: 87.19063545150502
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.636454849498328
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 35.73171059378559
 mnt_best       : 30.637244491244044
 not_improved_count: 11
Train Epoch: 45 [1/250 128/32000 (0%)] Loss: 3.45687 (QuantReg: 13.28526) QuantErr: 13.28526 batch_time=28.55154 
Train Epoch: 45 [12/250 1536/32000 (5%)] Loss: 2.69436 (QuantReg: 13.22639) QuantErr: 13.22639 batch_time=5.38437 
Train Epoch: 45 [23/250 2944/32000 (9%)] Loss: 2.35303 (QuantReg: 13.29251) QuantErr: 13.29251 batch_time=0.94724 
Train Epoch: 45 [34/250 4352/32000 (14%)] Loss: 2.93075 (QuantReg: 13.08248) QuantErr: 13.08248 batch_time=0.95603 
Train Epoch: 45 [45/250 5760/32000 (18%)] Loss: 3.75695 (QuantReg: 12.89412) QuantErr: 12.89412 batch_time=0.98741 
Train Epoch: 45 [56/250 7168/32000 (22%)] Loss: 3.97701 (QuantReg: 13.01511) QuantErr: 13.01511 batch_time=0.93266 
Train Epoch: 45 [67/250 8576/32000 (27%)] Loss: 2.57496 (QuantReg: 12.90274) QuantErr: 12.90274 batch_time=1.52400 
Train Epoch: 45 [78/250 9984/32000 (31%)] Loss: 2.46394 (QuantReg: 13.06151) QuantErr: 13.06151 batch_time=0.97787 
Train Epoch: 45 [89/250 11392/32000 (36%)] Loss: 3.24922 (QuantReg: 13.27126) QuantErr: 13.27126 batch_time=0.97763 
Train Epoch: 45 [100/250 12800/32000 (40%)] Loss: 3.30660 (QuantReg: 13.42374) QuantErr: 13.42374 batch_time=0.95625 
Train Epoch: 45 [111/250 14208/32000 (44%)] Loss: 2.95700 (QuantReg: 13.36126) QuantErr: 13.36126 batch_time=0.99736 
Train Epoch: 45 [122/250 15616/32000 (49%)] Loss: 3.46647 (QuantReg: 12.99771) QuantErr: 12.99771 batch_time=0.92283 
Train Epoch: 45 [133/250 17024/32000 (53%)] Loss: 3.45651 (QuantReg: 13.14660) QuantErr: 13.14660 batch_time=2.01147 
Train Epoch: 45 [144/250 18432/32000 (58%)] Loss: 2.89324 (QuantReg: 13.27996) QuantErr: 13.27996 batch_time=1.99951 
Train Epoch: 45 [155/250 19840/32000 (62%)] Loss: 2.84074 (QuantReg: 12.95549) QuantErr: 12.95549 batch_time=0.97730 
Train Epoch: 45 [166/250 21248/32000 (66%)] Loss: 2.58568 (QuantReg: 13.24985) QuantErr: 13.24985 batch_time=0.92140 
Train Epoch: 45 [177/250 22656/32000 (71%)] Loss: 2.80395 (QuantReg: 13.41173) QuantErr: 13.41173 batch_time=0.96287 
Train Epoch: 45 [188/250 24064/32000 (75%)] Loss: 1.91484 (QuantReg: 13.16320) QuantErr: 13.16320 batch_time=1.07604 
Train Epoch: 45 [199/250 25472/32000 (80%)] Loss: 2.63757 (QuantReg: 13.25385) QuantErr: 13.25385 batch_time=0.98520 
Train Epoch: 45 [210/250 26880/32000 (84%)] Loss: 3.11150 (QuantReg: 13.13555) QuantErr: 13.13555 batch_time=0.95990 
Train Epoch: 45 [221/250 28288/32000 (88%)] Loss: 3.50130 (QuantReg: 13.41344) QuantErr: 13.41344 batch_time=0.95882 
Train Epoch: 45 [232/250 29696/32000 (93%)] Loss: 2.39865 (QuantReg: 13.20144) QuantErr: 13.20144 batch_time=0.99081 
Train Epoch: 45 [243/250 31104/32000 (97%)] Loss: 2.77489 (QuantReg: 13.18307) QuantErr: 13.18307 batch_time=0.98373 
Train Epoch: 45 codebook_update_time=8.60925
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch45.pth ...
Done in 3.826s
removing stale ckpt [epoch 44] [took 0.00s]
 epoch          : 45
 loss           : 2.8854164452552795
 quant_reg      : 13.240154079437255
 quant_err      : 13.240154079437255
 learning_rate  : 5.23369773616275e-06
 n_samples      : 1440000
 n_steps        : 11250
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 70.4225352112676
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.18913480885311
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.325955734406438
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.94819200294816
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.305835010060362
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.17406207332974
 MSRVTT_full_test/t2v_metrics/R1: 14.080267558528428
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 52.575250836120404
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.40869565217391
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.294720005100398
 MSRVTT_full_test/v2t_metrics/R1: 17.759197324414714
 MSRVTT_full_test/v2t_metrics/R5: 45.618729096989966
 MSRVTT_full_test/v2t_metrics/R10: 59.83277591973244
 MSRVTT_full_test/v2t_metrics/R50: 86.72240802675586
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.752508361204015
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.461558020285
 mnt_best       : 30.637244491244044
 not_improved_count: 12
Train Epoch: 46 [1/250 128/32000 (0%)] Loss: 2.97516 (QuantReg: 13.37868) QuantErr: 13.37868 batch_time=35.61917 
Train Epoch: 46 [12/250 1536/32000 (5%)] Loss: 2.59270 (QuantReg: 13.26896) QuantErr: 13.26896 batch_time=0.95287 
Train Epoch: 46 [23/250 2944/32000 (9%)] Loss: 3.13360 (QuantReg: 12.97253) QuantErr: 12.97253 batch_time=0.97018 
Train Epoch: 46 [34/250 4352/32000 (14%)] Loss: 2.64533 (QuantReg: 12.99109) QuantErr: 12.99109 batch_time=1.02584 
Train Epoch: 46 [45/250 5760/32000 (18%)] Loss: 3.27401 (QuantReg: 13.15561) QuantErr: 13.15561 batch_time=1.04932 
Train Epoch: 46 [56/250 7168/32000 (22%)] Loss: 2.66370 (QuantReg: 13.12607) QuantErr: 13.12607 batch_time=0.93024 
Train Epoch: 46 [67/250 8576/32000 (27%)] Loss: 3.03130 (QuantReg: 13.20738) QuantErr: 13.20738 batch_time=1.08569 
Train Epoch: 46 [78/250 9984/32000 (31%)] Loss: 2.75573 (QuantReg: 13.21915) QuantErr: 13.21915 batch_time=1.01495 
Train Epoch: 46 [89/250 11392/32000 (36%)] Loss: 2.47885 (QuantReg: 13.42583) QuantErr: 13.42583 batch_time=0.94672 
Train Epoch: 46 [100/250 12800/32000 (40%)] Loss: 2.41354 (QuantReg: 13.46137) QuantErr: 13.46137 batch_time=0.95854 
Train Epoch: 46 [111/250 14208/32000 (44%)] Loss: 2.79743 (QuantReg: 13.32548) QuantErr: 13.32548 batch_time=1.01597 
Train Epoch: 46 [122/250 15616/32000 (49%)] Loss: 2.70947 (QuantReg: 13.24489) QuantErr: 13.24489 batch_time=0.95621 
Train Epoch: 46 [133/250 17024/32000 (53%)] Loss: 2.71660 (QuantReg: 13.18478) QuantErr: 13.18478 batch_time=0.96586 
Train Epoch: 46 [144/250 18432/32000 (58%)] Loss: 2.60691 (QuantReg: 13.47617) QuantErr: 13.47617 batch_time=1.00551 
Train Epoch: 46 [155/250 19840/32000 (62%)] Loss: 2.06901 (QuantReg: 13.26810) QuantErr: 13.26810 batch_time=0.97811 
Train Epoch: 46 [166/250 21248/32000 (66%)] Loss: 2.27345 (QuantReg: 13.23258) QuantErr: 13.23258 batch_time=0.95667 
Train Epoch: 46 [177/250 22656/32000 (71%)] Loss: 3.08310 (QuantReg: 13.21500) QuantErr: 13.21500 batch_time=1.01137 
Train Epoch: 46 [188/250 24064/32000 (75%)] Loss: 2.63306 (QuantReg: 13.32023) QuantErr: 13.32023 batch_time=0.95711 
Train Epoch: 46 [199/250 25472/32000 (80%)] Loss: 2.58366 (QuantReg: 13.16934) QuantErr: 13.16934 batch_time=3.43382 
Train Epoch: 46 [210/250 26880/32000 (84%)] Loss: 1.65907 (QuantReg: 13.33036) QuantErr: 13.33036 batch_time=0.93778 
Train Epoch: 46 [221/250 28288/32000 (88%)] Loss: 2.80380 (QuantReg: 13.11049) QuantErr: 13.11049 batch_time=0.97434 
Train Epoch: 46 [232/250 29696/32000 (93%)] Loss: 3.21127 (QuantReg: 13.43551) QuantErr: 13.43551 batch_time=0.93955 
Train Epoch: 46 [243/250 31104/32000 (97%)] Loss: 2.41156 (QuantReg: 13.27775) QuantErr: 13.27775 batch_time=0.99612 
Train Epoch: 46 codebook_update_time=8.85069
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch46.pth ...
Done in 4.221s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch46.pth ...
Done in 16.818s
removing stale ckpt [epoch 45] [took 0.02s]
 epoch          : 46
 loss           : 2.7493615436553953
 quant_reg      : 13.242433784484863
 quant_err      : 13.242433784484863
 learning_rate  : 4.972012849354612e-06
 n_samples      : 1472000
 n_steps        : 11500
 MSRVTT_full_val/t2v_metrics/R1: 32.394366197183096
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 98.79275653923541
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.2354124748490944
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.032168813878286
 MSRVTT_full_val/v2t_metrics/R1: 42.454728370221325
 MSRVTT_full_val/v2t_metrics/R5: 77.2635814889336
 MSRVTT_full_val/v2t_metrics/R10: 88.73239436619718
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.317907444668008
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 66.27163739474926
 MSRVTT_full_test/t2v_metrics/R1: 14.481605351170568
 MSRVTT_full_test/t2v_metrics/R5: 38.22742474916388
 MSRVTT_full_test/t2v_metrics/R10: 52.608695652173914
 MSRVTT_full_test/t2v_metrics/R50: 81.93979933110369
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.29197324414716
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.766854294100007
 MSRVTT_full_test/v2t_metrics/R1: 18.294314381270905
 MSRVTT_full_test/v2t_metrics/R5: 46.05351170568562
 MSRVTT_full_test/v2t_metrics/R10: 59.331103678929765
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.212709030100335
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.83724187610662
 mnt_best       : 30.766854294100007
 not_improved_count: 0
Train Epoch: 47 [1/250 128/32000 (0%)] Loss: 2.54768 (QuantReg: 13.38081) QuantErr: 13.38081 batch_time=39.55850 
Train Epoch: 47 [12/250 1536/32000 (5%)] Loss: 3.48722 (QuantReg: 13.33646) QuantErr: 13.33646 batch_time=0.96362 
Train Epoch: 47 [23/250 2944/32000 (9%)] Loss: 3.35048 (QuantReg: 13.24958) QuantErr: 13.24958 batch_time=0.95370 
Train Epoch: 47 [34/250 4352/32000 (14%)] Loss: 3.18599 (QuantReg: 13.29178) QuantErr: 13.29178 batch_time=0.96674 
Train Epoch: 47 [45/250 5760/32000 (18%)] Loss: 2.82593 (QuantReg: 13.29757) QuantErr: 13.29757 batch_time=0.94442 
Train Epoch: 47 [56/250 7168/32000 (22%)] Loss: 2.60663 (QuantReg: 13.31161) QuantErr: 13.31161 batch_time=0.96287 
Train Epoch: 47 [67/250 8576/32000 (27%)] Loss: 2.67060 (QuantReg: 13.39010) QuantErr: 13.39010 batch_time=1.09364 
Train Epoch: 47 [78/250 9984/32000 (31%)] Loss: 3.85683 (QuantReg: 13.26786) QuantErr: 13.26786 batch_time=1.65653 
Train Epoch: 47 [89/250 11392/32000 (36%)] Loss: 2.08545 (QuantReg: 13.20489) QuantErr: 13.20489 batch_time=0.98936 
Train Epoch: 47 [100/250 12800/32000 (40%)] Loss: 2.18827 (QuantReg: 13.47692) QuantErr: 13.47692 batch_time=1.03420 
Train Epoch: 47 [111/250 14208/32000 (44%)] Loss: 2.86782 (QuantReg: 13.48315) QuantErr: 13.48315 batch_time=0.97447 
Train Epoch: 47 [122/250 15616/32000 (49%)] Loss: 2.22845 (QuantReg: 13.41166) QuantErr: 13.41166 batch_time=0.93982 
Train Epoch: 47 [133/250 17024/32000 (53%)] Loss: 3.22850 (QuantReg: 13.18406) QuantErr: 13.18406 batch_time=0.94915 
Train Epoch: 47 [144/250 18432/32000 (58%)] Loss: 2.73838 (QuantReg: 13.21881) QuantErr: 13.21881 batch_time=1.22637 
Train Epoch: 47 [155/250 19840/32000 (62%)] Loss: 3.23512 (QuantReg: 13.23353) QuantErr: 13.23353 batch_time=1.15921 
Train Epoch: 47 [166/250 21248/32000 (66%)] Loss: 2.83105 (QuantReg: 13.09849) QuantErr: 13.09849 batch_time=0.94828 
Train Epoch: 47 [177/250 22656/32000 (71%)] Loss: 2.86915 (QuantReg: 13.32847) QuantErr: 13.32847 batch_time=1.00274 
Train Epoch: 47 [188/250 24064/32000 (75%)] Loss: 3.46172 (QuantReg: 13.35101) QuantErr: 13.35101 batch_time=0.91813 
Train Epoch: 47 [199/250 25472/32000 (80%)] Loss: 2.11017 (QuantReg: 13.30127) QuantErr: 13.30127 batch_time=0.93826 
Train Epoch: 47 [210/250 26880/32000 (84%)] Loss: 3.01181 (QuantReg: 13.19116) QuantErr: 13.19116 batch_time=0.93113 
Train Epoch: 47 [221/250 28288/32000 (88%)] Loss: 3.00364 (QuantReg: 13.37205) QuantErr: 13.37205 batch_time=0.99066 
Train Epoch: 47 [232/250 29696/32000 (93%)] Loss: 2.70222 (QuantReg: 13.30533) QuantErr: 13.30533 batch_time=0.94562 
Train Epoch: 47 [243/250 31104/32000 (97%)] Loss: 2.46530 (QuantReg: 13.26735) QuantErr: 13.26735 batch_time=1.06903 
Train Epoch: 47 codebook_update_time=8.77988
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch47.pth ...
Done in 10.213s
removing stale ckpt [epoch 46] [took 0.00s]
 epoch          : 47
 loss           : 2.834795030117035
 quant_reg      : 13.285067642211914
 quant_err      : 13.285067642211914
 learning_rate  : 4.723412206886882e-06
 n_samples      : 1504000
 n_steps        : 11750
 MSRVTT_full_val/t2v_metrics/R1: 32.796780684104625
 MSRVTT_full_val/t2v_metrics/R5: 69.81891348088531
 MSRVTT_full_val/t2v_metrics/R10: 81.89134808853119
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.329979879275654
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.23751549077746
 MSRVTT_full_val/v2t_metrics/R1: 40.84507042253521
 MSRVTT_full_val/v2t_metrics/R5: 77.8672032193159
 MSRVTT_full_val/v2t_metrics/R10: 87.92756539235413
 MSRVTT_full_val/v2t_metrics/R50: 99.3963782696177
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.3843058350100605
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.39427930787127
 MSRVTT_full_test/t2v_metrics/R1: 14.481605351170568
 MSRVTT_full_test/t2v_metrics/R5: 37.558528428093645
 MSRVTT_full_test/t2v_metrics/R10: 52.207357859531776
 MSRVTT_full_test/t2v_metrics/R50: 81.27090301003345
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.017391304347825
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.508369445579437
 MSRVTT_full_test/v2t_metrics/R1: 17.65886287625418
 MSRVTT_full_test/v2t_metrics/R5: 45.719063545150505
 MSRVTT_full_test/v2t_metrics/R10: 59.197324414715716
 MSRVTT_full_test/v2t_metrics/R50: 86.82274247491638
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 31.19933110367893
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.29003436825788
 mnt_best       : 30.766854294100007
 not_improved_count: 1
Train Epoch: 48 [1/250 128/32000 (0%)] Loss: 2.72137 (QuantReg: 13.37876) QuantErr: 13.37876 batch_time=31.02390 
Train Epoch: 48 [12/250 1536/32000 (5%)] Loss: 3.04998 (QuantReg: 13.34194) QuantErr: 13.34194 batch_time=0.91628 
Train Epoch: 48 [23/250 2944/32000 (9%)] Loss: 3.40007 (QuantReg: 13.39626) QuantErr: 13.39626 batch_time=0.95533 
Train Epoch: 48 [34/250 4352/32000 (14%)] Loss: 2.50949 (QuantReg: 13.02561) QuantErr: 13.02561 batch_time=0.95379 
Train Epoch: 48 [45/250 5760/32000 (18%)] Loss: 3.85561 (QuantReg: 13.18257) QuantErr: 13.18257 batch_time=1.00646 
Train Epoch: 48 [56/250 7168/32000 (22%)] Loss: 2.68547 (QuantReg: 13.40100) QuantErr: 13.40100 batch_time=1.03234 
Train Epoch: 48 [67/250 8576/32000 (27%)] Loss: 2.91348 (QuantReg: 13.38147) QuantErr: 13.38147 batch_time=0.94409 
Train Epoch: 48 [78/250 9984/32000 (31%)] Loss: 3.18251 (QuantReg: 13.38115) QuantErr: 13.38115 batch_time=0.95714 
Train Epoch: 48 [89/250 11392/32000 (36%)] Loss: 2.54382 (QuantReg: 13.34572) QuantErr: 13.34572 batch_time=0.98329 
Train Epoch: 48 [100/250 12800/32000 (40%)] Loss: 2.52843 (QuantReg: 13.32917) QuantErr: 13.32917 batch_time=0.97415 
Train Epoch: 48 [111/250 14208/32000 (44%)] Loss: 3.06304 (QuantReg: 13.30056) QuantErr: 13.30056 batch_time=0.99393 
Train Epoch: 48 [122/250 15616/32000 (49%)] Loss: 2.95147 (QuantReg: 13.08031) QuantErr: 13.08031 batch_time=0.96562 
Train Epoch: 48 [133/250 17024/32000 (53%)] Loss: 2.96028 (QuantReg: 13.35407) QuantErr: 13.35407 batch_time=1.80816 
Train Epoch: 48 [144/250 18432/32000 (58%)] Loss: 2.54151 (QuantReg: 13.24547) QuantErr: 13.24547 batch_time=0.92660 
Train Epoch: 48 [155/250 19840/32000 (62%)] Loss: 2.94188 (QuantReg: 13.18995) QuantErr: 13.18995 batch_time=1.06716 
Train Epoch: 48 [166/250 21248/32000 (66%)] Loss: 2.98186 (QuantReg: 13.27445) QuantErr: 13.27445 batch_time=0.99898 
Train Epoch: 48 [177/250 22656/32000 (71%)] Loss: 2.22055 (QuantReg: 13.20010) QuantErr: 13.20010 batch_time=0.97867 
Train Epoch: 48 [188/250 24064/32000 (75%)] Loss: 3.21004 (QuantReg: 13.33231) QuantErr: 13.33231 batch_time=0.92677 
Train Epoch: 48 [199/250 25472/32000 (80%)] Loss: 3.18423 (QuantReg: 13.31772) QuantErr: 13.31772 batch_time=4.77639 
Train Epoch: 48 [210/250 26880/32000 (84%)] Loss: 2.48636 (QuantReg: 13.43508) QuantErr: 13.43508 batch_time=1.03157 
Train Epoch: 48 [221/250 28288/32000 (88%)] Loss: 2.92040 (QuantReg: 13.48175) QuantErr: 13.48175 batch_time=0.92149 
Train Epoch: 48 [232/250 29696/32000 (93%)] Loss: 3.53102 (QuantReg: 13.26294) QuantErr: 13.26294 batch_time=0.93643 
Train Epoch: 48 [243/250 31104/32000 (97%)] Loss: 3.56466 (QuantReg: 13.22179) QuantErr: 13.22179 batch_time=0.96829 
Train Epoch: 48 codebook_update_time=9.33009
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch48.pth ...
Done in 4.345s
removing stale ckpt [epoch 47] [took 0.01s]
 epoch          : 48
 loss           : 2.8042907490730284
 quant_reg      : 13.29515121459961
 quant_err      : 13.29515121459961
 learning_rate  : 4.487241596542537e-06
 n_samples      : 1536000
 n_steps        : 12000
 MSRVTT_full_val/t2v_metrics/R1: 31.790744466800806
 MSRVTT_full_val/t2v_metrics/R5: 69.41649899396378
 MSRVTT_full_val/t2v_metrics/R10: 82.49496981891348
 MSRVTT_full_val/t2v_metrics/R50: 97.98792756539235
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.392354124748491
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 56.675708446656216
 MSRVTT_full_val/v2t_metrics/R1: 41.64989939637827
 MSRVTT_full_val/v2t_metrics/R5: 76.05633802816901
 MSRVTT_full_val/v2t_metrics/R10: 86.72032193158954
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.48692152917505
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.00649488561773
 MSRVTT_full_test/t2v_metrics/R1: 14.046822742474916
 MSRVTT_full_test/t2v_metrics/R5: 38.02675585284281
 MSRVTT_full_test/t2v_metrics/R10: 52.240802675585286
 MSRVTT_full_test/t2v_metrics/R50: 81.17056856187291
 MSRVTT_full_test/t2v_metrics/MedR: 10.0
 MSRVTT_full_test/t2v_metrics/MeanR: 44.874581939799334
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.331396517716616
 MSRVTT_full_test/v2t_metrics/R1: 18.127090301003346
 MSRVTT_full_test/v2t_metrics/R5: 45.585284280936456
 MSRVTT_full_test/v2t_metrics/R10: 59.39799331103679
 MSRVTT_full_test/v2t_metrics/R50: 87.1571906354515
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.609364548494984
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.613522467605314
 mnt_best       : 30.766854294100007
 not_improved_count: 2
Train Epoch: 49 [1/250 128/32000 (0%)] Loss: 3.00735 (QuantReg: 13.17895) QuantErr: 13.17895 batch_time=33.34167 
Train Epoch: 49 [12/250 1536/32000 (5%)] Loss: 2.90177 (QuantReg: 12.81127) QuantErr: 12.81127 batch_time=0.93306 
Train Epoch: 49 [23/250 2944/32000 (9%)] Loss: 2.21190 (QuantReg: 13.17411) QuantErr: 13.17411 batch_time=1.02990 
Train Epoch: 49 [34/250 4352/32000 (14%)] Loss: 2.58314 (QuantReg: 13.24987) QuantErr: 13.24987 batch_time=0.97447 
Train Epoch: 49 [45/250 5760/32000 (18%)] Loss: 2.86706 (QuantReg: 13.45885) QuantErr: 13.45885 batch_time=1.10759 
Train Epoch: 49 [56/250 7168/32000 (22%)] Loss: 3.32367 (QuantReg: 13.27997) QuantErr: 13.27997 batch_time=0.95681 
Train Epoch: 49 [67/250 8576/32000 (27%)] Loss: 3.54769 (QuantReg: 13.22778) QuantErr: 13.22778 batch_time=1.05526 
Train Epoch: 49 [78/250 9984/32000 (31%)] Loss: 3.10616 (QuantReg: 13.43305) QuantErr: 13.43305 batch_time=0.94681 
Train Epoch: 49 [89/250 11392/32000 (36%)] Loss: 2.20619 (QuantReg: 13.44161) QuantErr: 13.44161 batch_time=1.04708 
Train Epoch: 49 [100/250 12800/32000 (40%)] Loss: 3.42565 (QuantReg: 13.15928) QuantErr: 13.15928 batch_time=2.00981 
Train Epoch: 49 [111/250 14208/32000 (44%)] Loss: 2.69636 (QuantReg: 13.35469) QuantErr: 13.35469 batch_time=1.02552 
Train Epoch: 49 [122/250 15616/32000 (49%)] Loss: 2.84294 (QuantReg: 13.26668) QuantErr: 13.26668 batch_time=1.11590 
Train Epoch: 49 [133/250 17024/32000 (53%)] Loss: 2.79506 (QuantReg: 13.39989) QuantErr: 13.39989 batch_time=0.94888 
Train Epoch: 49 [144/250 18432/32000 (58%)] Loss: 2.74165 (QuantReg: 13.40282) QuantErr: 13.40282 batch_time=1.04733 
Train Epoch: 49 [155/250 19840/32000 (62%)] Loss: 2.14802 (QuantReg: 13.19737) QuantErr: 13.19737 batch_time=1.05813 
Train Epoch: 49 [166/250 21248/32000 (66%)] Loss: 2.53194 (QuantReg: 13.46745) QuantErr: 13.46745 batch_time=1.04400 
Train Epoch: 49 [177/250 22656/32000 (71%)] Loss: 3.74575 (QuantReg: 13.29340) QuantErr: 13.29340 batch_time=0.92370 
Train Epoch: 49 [188/250 24064/32000 (75%)] Loss: 2.39954 (QuantReg: 13.40508) QuantErr: 13.40508 batch_time=0.92138 
Train Epoch: 49 [199/250 25472/32000 (80%)] Loss: 3.17700 (QuantReg: 12.99896) QuantErr: 12.99896 batch_time=0.93728 
Train Epoch: 49 [210/250 26880/32000 (84%)] Loss: 1.87884 (QuantReg: 13.47270) QuantErr: 13.47270 batch_time=1.22098 
Train Epoch: 49 [221/250 28288/32000 (88%)] Loss: 3.35982 (QuantReg: 13.26401) QuantErr: 13.26401 batch_time=0.96562 
Train Epoch: 49 [232/250 29696/32000 (93%)] Loss: 3.24217 (QuantReg: 13.66680) QuantErr: 13.66680 batch_time=1.01057 
Train Epoch: 49 [243/250 31104/32000 (97%)] Loss: 3.07155 (QuantReg: 13.28860) QuantErr: 13.28860 batch_time=0.98054 
Train Epoch: 49 codebook_update_time=9.15790
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch49.pth ...
Done in 4.388s
removing stale ckpt [epoch 48] [took 0.00s]
 epoch          : 49
 loss           : 2.7986552577018737
 quant_reg      : 13.305128429412841
 quant_err      : 13.305128429412841
 learning_rate  : 4.26287951671541e-06
 n_samples      : 1568000
 n_steps        : 12250
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 69.61770623742454
 MSRVTT_full_val/t2v_metrics/R10: 83.29979879275653
 MSRVTT_full_val/t2v_metrics/R50: 97.78672032193158
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.458752515090543
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.62580968363741
 MSRVTT_full_val/v2t_metrics/R1: 40.643863179074444
 MSRVTT_full_val/v2t_metrics/R5: 76.65995975855131
 MSRVTT_full_val/v2t_metrics/R10: 86.51911468812877
 MSRVTT_full_val/v2t_metrics/R50: 98.79275653923541
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.682092555331992
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 64.59891319003064
 MSRVTT_full_test/t2v_metrics/R1: 14.31438127090301
 MSRVTT_full_test/t2v_metrics/R5: 37.82608695652174
 MSRVTT_full_test/t2v_metrics/R10: 52.575250836120404
 MSRVTT_full_test/t2v_metrics/R50: 81.47157190635451
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.605016722408024
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.533865172259347
 MSRVTT_full_test/v2t_metrics/R1: 18.528428093645484
 MSRVTT_full_test/v2t_metrics/R5: 46.25418060200669
 MSRVTT_full_test/v2t_metrics/R10: 59.364548494983275
 MSRVTT_full_test/v2t_metrics/R50: 87.29096989966555
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.144147157190634
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 37.05432551770942
 mnt_best       : 30.766854294100007
 not_improved_count: 3
Train Epoch: 50 [1/250 128/32000 (0%)] Loss: 3.02801 (QuantReg: 13.19557) QuantErr: 13.19557 batch_time=33.06700 
Train Epoch: 50 [12/250 1536/32000 (5%)] Loss: 2.80382 (QuantReg: 13.29980) QuantErr: 13.29980 batch_time=1.05184 
Train Epoch: 50 [23/250 2944/32000 (9%)] Loss: 2.46213 (QuantReg: 13.21460) QuantErr: 13.21460 batch_time=0.92268 
Train Epoch: 50 [34/250 4352/32000 (14%)] Loss: 2.84854 (QuantReg: 13.33479) QuantErr: 13.33479 batch_time=1.09628 
Train Epoch: 50 [45/250 5760/32000 (18%)] Loss: 2.58805 (QuantReg: 13.25065) QuantErr: 13.25065 batch_time=0.94949 
Train Epoch: 50 [56/250 7168/32000 (22%)] Loss: 2.67886 (QuantReg: 13.27714) QuantErr: 13.27714 batch_time=1.06637 
Train Epoch: 50 [67/250 8576/32000 (27%)] Loss: 2.64776 (QuantReg: 13.33370) QuantErr: 13.33370 batch_time=1.06311 
Train Epoch: 50 [78/250 9984/32000 (31%)] Loss: 2.62771 (QuantReg: 13.23679) QuantErr: 13.23679 batch_time=1.02001 
Train Epoch: 50 [89/250 11392/32000 (36%)] Loss: 3.21017 (QuantReg: 13.39576) QuantErr: 13.39576 batch_time=1.00476 
Train Epoch: 50 [100/250 12800/32000 (40%)] Loss: 3.57639 (QuantReg: 13.09558) QuantErr: 13.09558 batch_time=1.00035 
Train Epoch: 50 [111/250 14208/32000 (44%)] Loss: 2.85186 (QuantReg: 13.18017) QuantErr: 13.18017 batch_time=0.98053 
Train Epoch: 50 [122/250 15616/32000 (49%)] Loss: 2.85139 (QuantReg: 13.19339) QuantErr: 13.19339 batch_time=1.16605 
Train Epoch: 50 [133/250 17024/32000 (53%)] Loss: 2.52489 (QuantReg: 13.32364) QuantErr: 13.32364 batch_time=3.15489 
Train Epoch: 50 [144/250 18432/32000 (58%)] Loss: 2.32586 (QuantReg: 13.41421) QuantErr: 13.41421 batch_time=1.01155 
Train Epoch: 50 [155/250 19840/32000 (62%)] Loss: 2.65875 (QuantReg: 13.09401) QuantErr: 13.09401 batch_time=0.95982 
Train Epoch: 50 [166/250 21248/32000 (66%)] Loss: 2.26221 (QuantReg: 13.26414) QuantErr: 13.26414 batch_time=1.02594 
Train Epoch: 50 [177/250 22656/32000 (71%)] Loss: 2.33566 (QuantReg: 13.52154) QuantErr: 13.52154 batch_time=0.95865 
Train Epoch: 50 [188/250 24064/32000 (75%)] Loss: 2.81806 (QuantReg: 13.58300) QuantErr: 13.58300 batch_time=0.95092 
Train Epoch: 50 [199/250 25472/32000 (80%)] Loss: 2.86485 (QuantReg: 13.07541) QuantErr: 13.07541 batch_time=0.94428 
Train Epoch: 50 [210/250 26880/32000 (84%)] Loss: 2.52337 (QuantReg: 13.28479) QuantErr: 13.28479 batch_time=0.96375 
Train Epoch: 50 [221/250 28288/32000 (88%)] Loss: 2.99611 (QuantReg: 13.36686) QuantErr: 13.36686 batch_time=1.04772 
Train Epoch: 50 [232/250 29696/32000 (93%)] Loss: 2.94257 (QuantReg: 13.80521) QuantErr: 13.80521 batch_time=0.98986 
Train Epoch: 50 [243/250 31104/32000 (97%)] Loss: 2.17329 (QuantReg: 13.64527) QuantErr: 13.64527 batch_time=0.95551 
Train Epoch: 50 codebook_update_time=9.16013
Saving checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch50.pth ...
Done in 4.100s
Updating 'best' checkpoint: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/checkpoint-epoch50.pth ...
Done in 8.138s
removing stale ckpt [epoch 49] [took 0.00s]
 epoch          : 50
 loss           : 2.843654549598694
 quant_reg      : 13.320678932189942
 quant_err      : 13.320678932189942
 learning_rate  : 4.04973554087964e-06
 n_samples      : 1600000
 n_steps        : 12500
 MSRVTT_full_val/t2v_metrics/R1: 32.99798792756539
 MSRVTT_full_val/t2v_metrics/R5: 70.22132796780684
 MSRVTT_full_val/t2v_metrics/R10: 81.69014084507042
 MSRVTT_full_val/t2v_metrics/R50: 97.58551307847083
 MSRVTT_full_val/t2v_metrics/MedR: 3.0
 MSRVTT_full_val/t2v_metrics/MeanR: 7.392354124748491
 MSRVTT_full_val/t2v_metrics/geometric_mean_R1-R5-R10: 57.41720496241655
 MSRVTT_full_val/v2t_metrics/R1: 42.052313883299796
 MSRVTT_full_val/v2t_metrics/R5: 77.46478873239437
 MSRVTT_full_val/v2t_metrics/R10: 87.5251509054326
 MSRVTT_full_val/v2t_metrics/R50: 98.99396378269617
 MSRVTT_full_val/v2t_metrics/MedR: 2.0
 MSRVTT_full_val/v2t_metrics/MeanR: 5.446680080482897
 MSRVTT_full_val/v2t_metrics/geometric_mean_R1-R5-R10: 65.8176495323229
 MSRVTT_full_test/t2v_metrics/R1: 14.481605351170568
 MSRVTT_full_test/t2v_metrics/R5: 38.561872909699
 MSRVTT_full_test/t2v_metrics/R10: 52.642140468227424
 MSRVTT_full_test/t2v_metrics/R50: 81.60535117056857
 MSRVTT_full_test/t2v_metrics/MedR: 9.0
 MSRVTT_full_test/t2v_metrics/MeanR: 43.41404682274248
 MSRVTT_full_test/t2v_metrics/geometric_mean_R1-R5-R10: 30.862856690724968
 MSRVTT_full_test/v2t_metrics/R1: 18.093645484949832
 MSRVTT_full_test/v2t_metrics/R5: 45.986622073578594
 MSRVTT_full_test/v2t_metrics/R10: 59.66555183946488
 MSRVTT_full_test/v2t_metrics/R50: 87.22408026755853
 MSRVTT_full_test/v2t_metrics/MedR: 7.0
 MSRVTT_full_test/v2t_metrics/MeanR: 30.537123745819397
 MSRVTT_full_test/v2t_metrics/geometric_mean_R1-R5-R10: 36.753080807155044
 mnt_best       : 30.862856690724968
 not_improved_count: 0
Final evaluation ...
Loading checkpoint from: /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/trained_model.pth ...
Ckpt loaded at epoch 50.
Saved similarity matrix (quantize videos) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/MSRVTT-test-qv-sims.npy
Saved v2t similarity matrix (quantize texts) to /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/MSRVTT-test-qt-sims.npy
MSRVTT_full_test:
 t2v_metrics/R1/final_eval: 14.481605351170568
 t2v_metrics/R5/final_eval: 38.561872909699
 t2v_metrics/R10/final_eval: 52.642140468227424
 t2v_metrics/R50/final_eval: 81.60535117056857
 t2v_metrics/MedR/final_eval: 9.0
 t2v_metrics/MeanR/final_eval: 43.41404682274248
 t2v_metrics/geometric_mean_R1-R5-R10/final_eval: 30.862856690724968
 v2t_metrics/R1/final_eval: 18.093645484949832
 v2t_metrics/R5/final_eval: 45.986622073578594
 v2t_metrics/R10/final_eval: 59.66555183946488
 v2t_metrics/R50/final_eval: 87.22408026755853
 v2t_metrics/MedR/final_eval: 7.0
 v2t_metrics/MeanR/final_eval: 30.537290969899665
 v2t_metrics/geometric_mean_R1-R5-R10/final_eval: 36.753080807155044
Best epoch for the monitored metric: 50
Script took 05h56m38s
The best performing ckpt can be found at /apdcephfs/share_47076/gimwang/HCQ/exps/HCQ_MSRVTT_full_L31/trained_model.pth
